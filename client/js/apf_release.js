var apf={VERSION:"3.0beta",CDN:"",READY:false,NODE_HIDDEN:101,NODE_VISIBLE:102,NODE_O3:103,KEYBOARD:2,KEYBOARD_MOUSE:true,SUCCESS:1,TIMEOUT:2,ERROR:3,OFFLINE:4,debug:true,debugType:"Memory",debugFilter:"!teleport",includeStack:[],initialized:false,AppModules:[],autoLoadSkin:false,started:false,crypto:{},config:{},_GET:{},$asyncObjects:{"apf.oHttp":1,"apf.ajax":1},basePath:"",ns:{apf:"http://ajax.org/2005/aml",aml:"http://ajax.org/2005/aml",xsd:"http://www.w3.org/2001/XMLSchema",xhtml:"http://www.w3.org/1999/xhtml",xslt:"http://www.w3.org/1999/XSL/Transform",xforms:"http://www.w3.org/2002/xforms",ev:"http://www.w3.org/2001/xml-events"},xPathAxis:{self:1,"following-sibling":1,ancestor:1},hasRequireJS:window.require&&typeof require.def=="function",availHTTP:[],releaseHTTP:function(http){if(apf.brokenHttpAbort){return;
}if(self.XMLHttpRequestUnSafe&&http.constructor==XMLHttpRequestUnSafe){return;}http.onreadystatechange=function(){};
http.abort();this.availHTTP.push(http);},browserDetect:function(){if(this.$bdetect){return;
}this.$bdetect=true;var sAgent=navigator.userAgent.toLowerCase()||"",b=(typeof/./)[0]=="f"?+"1\0"?3:2:+"1\0"?5:1-"\0"?1:+{valueOf:function(x){return !x;
}}?4:0;if((typeof/./)[0]=="f"&&parseFloat((sAgent.match(/(?:firefox|minefield)\/([\d\.]+)/i)||{})[1])<=2){b=0;
}if(b==2&&sAgent.indexOf("chrome")==-1){b=3;}this.isOpera=b===4||b===5;this.isKonqueror=b===5;
this.isSafari=b===3;this.isSafariOld=false;this.isIphone=sAgent.indexOf("iphone")!=-1||sAgent.indexOf("aspen simulator")!=-1;
this.isChrome=b===2;this.isWebkit=this.isSafari||this.isChrome||this.isKonqueror;
if(this.isWebkit){var matches=sAgent.match(/applewebkit\/(\d+)/);if(matches){this.webkitRev=parseInt(matches[1]);
this.isSafariOld=parseInt(matches[1])<420;}}this.isAIR=sAgent.indexOf("adobeair")!=-1;
this.isGecko=b===0;this.isGecko3=this.isGecko;this.isGecko35=this.isGecko&&(/a/[-1]&&Object.getPrototypeOf)?true:false;
this.versionGecko=this.isGecko?parseFloat(sAgent.match(/(?:gecko)\/([\d\.]+)/i)[1]):-1;
var m=sAgent.match(/(?:firefox(-[\d.]+)?|minefield)\/([\d.]+)/i);this.versionFF=this.isGecko&&m&&m.length?parseFloat(m[2]):4;
this.versionSafari=this.isSafari&&!this.isAIR?parseFloat(sAgent.match(/(?:version)\/([\d\.]+)/i)[1]):-1;
this.versionChrome=this.isChrome?parseFloat(sAgent.match(/(?:chrome)\/([\d\.]+)/i)[1]):-1;
this.versionOpera=this.isOpera?parseFloat(sAgent.match(b===4?/(?:version)\/([\d\.]+)/i:/(?:opera)\/([\d\.]+)/i)[1]):-1;
var found;this.isIE=b===1;if(this.isIE){this.isIE=parseFloat(sAgent.match(/msie ([\d\.]*)/)[1]);
}this.isIE8=this.isIE==8&&(found=true);this.isIE7=!found&&this.isIE==7&&(found=true);
if(document.documentMode==7){apf.isIE7=true;apf.isIE8=false;apf.isIE7Emulate=true;
apf.isIE=7;}this.isIE6=!found&&this.isIE==6&&(found=true);var os=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();
this.isWin=(os=="win");this.isMac=(os=="mac");this.isLinux=(os=="linux");try{}catch(e){this.isDeskrun=false;
}},setCompatFlags:function(){this.TAGNAME=apf.isIE?"baseName":"localName";this.styleSheetRules=apf.isIE?"rules":"cssRules";
this.brokenHttpAbort=apf.isIE6;this.canUseHtmlAsXml=apf.isIE;this.supportNamespaces=!apf.isIE;
this.cannotSizeIframe=apf.isIE;this.hasConditionCompilation=apf.isIE;this.supportOverflowComponent=apf.isIE;
this.hasFlexibleBox=apf.versionGecko>2||apf.webkitRev>2;this.hasEventSrcElement=apf.isIE;
this.canHaveHtmlOverSelects=!apf.isIE6&&!apf.isIE5;this.hasInnerText=apf.isIE;this.hasMsRangeObject=apf.isIE;
this.descPropJs=apf.isIE;this.hasClickFastBug=apf.isIE;this.hasExecScript=window.execScript?true:false;
this.canDisableKeyCodes=apf.isIE;this.hasTextNodeWhiteSpaceBug=apf.isIE||apf.isIE>=8;
this.hasCssUpdateScrollbarBug=apf.isIE;this.canUseInnerHtmlWithTables=!apf.isIE;
this.hasSingleResizeEvent=!apf.isIE;this.hasStyleFilters=apf.isIE;this.supportOpacity=!apf.isIE||apf.isIE>=9;
this.supportPng24=!apf.isIE6&&!apf.isIE5;this.cantParseXmlDefinition=apf.isIE50;
this.hasDynamicItemList=!apf.isIE||apf.isIE>=7;this.canImportNode=apf.isIE;this.hasSingleRszEvent=!apf.isIE;
this.hasXPathHtmlSupport=!apf.isIE;this.hasFocusBug=apf.isIE;this.hasHeightAutoDrawBug=apf.isIE&&apf.isIE<8;
this.hasReadyStateBug=apf.isIE50;this.dateSeparator=apf.isIE?"-":"/";this.canCreateStyleNode=!apf.isIE;
this.supportFixedPosition=!apf.isIE||apf.isIE>=7;this.hasHtmlIdsInJs=apf.isIE&&apf.isIE<8||apf.isWebkit;
this.needsCssPx=!apf.isIE;this.hasCSSChildOfSelector=!apf.isIE||apf.isIE>=8;this.hasStyleAnchors=!apf.isIE||apf.isIE>=8;
this.styleAttrIsObj=apf.isIE<8;this.hasAutocompleteXulBug=apf.isGecko;this.loadsLocalFilesSync=apf.isIE||apf.isGecko;
this.mouseEventBuffer=apf.isIE?20:6;this.hasComputedStyle=typeof document.defaultView!="undefined"&&typeof document.defaultView.getComputedStyle!="undefined";
this.w3cRange=Boolean(window.getSelection);this.locale=(apf.isIE?navigator.userLanguage:navigator.language).toLowerCase();
this.characterSet=document.characterSet||document.defaultCharset||"utf-8";var t=document.createElement("div");
this.hasContentEditable=(typeof t.contentEditable=="string"||typeof t.contentEditable=="boolean");
apf.hasContentEditableContainerBug=apf.isWebkit;var props=["transform","OTransform","KhtmlTransform","MozTransform","WebkitTransform"],prefixR=["","O","Khtml","Moz","Webkit"],prefixC=["","o-","khtml-","moz-","webkit-"],events=["transitionend","transitionend","transitionend","transitionend","webkitTransitionEnd"],i=0,l=5;
this.supportCSSAnim=false;this.supportCSSTransition=false;for(;i<l&&!this.supportCSSAnim;
++i){if(typeof t.style[props[i]]=="undefined"){continue;}this.supportCSSAnim=props[i];
this.runtimeStylePrefix=prefixR[i];this.classNamePrefix=prefixC[i];this.cssAnimEvent=events[i];
}t=null;delete t;this.supportVML=apf.isIE;this.supportSVG=!apf.isIE||apf.isIE>8;
this.hasHtml5XDomain=apf.versionGecko>=3.5;this.supportCanvas=!!document.createElement("canvas").getContext;
this.supportCanvasText=!!(this.supportCanvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function");
this.hasVideo=!!document.createElement("video")["canPlayType"];this.hasAudio=!!document.createElement("audio")["canPlayType"];
this.supportHashChange=("onhashchange" in self)&&(!apf.isIE||apf.isIE>=8);if(self.XMLHttpRequest){var xhr=new XMLHttpRequest();
this.hasXhrProgress=!!xhr.upload;if(this.hasXhrBinary=!!(xhr.sendAsBinary||xhr.upload)){this.hasHtml5File=!!(File&&File.prototype.getAsDataURL);
this.hasHtml5FileSlice=!!(File&&File.prototype.slice);}}else{this.hasXhrProgress=this.hasXhrBinary=this.hasHtml5File=this.hasHtml5FileSlice=false;
}this.windowHorBorder=this.windowVerBorder=apf.isIE8&&(!self.frameElement||parseInt(self.frameElement.frameBorder))?4:0;
t=document.createElement("input");var _self=this;(function(props){for(var i in props){t.setAttribute("type",i);
_self["hasInput"+i.charAt(0).toUpperCase()+i.substr(1).replace("-l","L")]=!!(t.type!=="text");
}})({search:1,tel:1,url:1,email:1,datetime:1,date:1,month:1,week:1,time:1,"datetime-local":1,number:1,range:1,color:1});
t=null;delete t;this.enableAnim=!apf.isIE||apf.isIE>8;this.animSteps=apf.isIE?0.3:1;
this.animInterval=apf.isIE?7:1;this.CSSFLOAT=apf.isIE?"styleFloat":"cssFloat";this.CSSPREFIX=apf.isGecko?"Moz":(apf.isWebkit?"webkit":"");
this.CSSPREFIX2=apf.isGecko?"-moz":(apf.isWebkit?"-webkit":"");this.INLINE=apf.isIE&&apf.isIE<8?"inline":"inline-block";
this.needZoomForLayout=apf.isIE&&apf.isIE<8;this.maxHttpRetries=apf.isOpera?0:3;
this.percentageMatch=new RegExp();this.percentageMatch.compile("([\\-\\d\\.]+)\\%","g");
this.reMatchXpath=new RegExp();this.reMatchXpath.compile("(^|\\|)(?!\\@|[\\w-]+::)","g");
apf.isGears=!!apf.initGears()||0;},hasGeoLocation:function(){return typeof apf.geolocation!="undefined"&&apf.geolocation.init();
},reboot:function(){apf.console.info("Restarting application...");location.href=location.href;
},extend:function(dest,src){var prop,i,x=!dest.notNull;if(arguments.length==2){for(prop in src){if(x||src[prop]){dest[prop]=src[prop];
}}return dest;}for(i=1;i<arguments.length;i++){src=arguments[i];for(prop in src){if(x||src[prop]){dest[prop]=src[prop];
}}}return dest;},$extend:function(dest,src){for(var prop in src){dest[prop]=src[prop];
}return dest;},ajax:(function(){var f=function(){return this.oHttp.get.apply(this.oHttp,arguments);
};f.exec=function(method,args,callback,options){if(method=="ajax"&&args[0]){var opt=args[1]||{};
return this.oHttp.exec(opt.method||"GET",[args[0]],opt.callback,apf.extend(options||{},opt));
}};return f;})(),start:function(){this.started=true;var sHref=location.href.split("#")[0].split("?")[0];
this.host=location.hostname&&sHref.replace(/(\/\/[^\/]*)\/.*$/,"$1");this.hostPath=sHref.replace(/\/[^\/]*$/,"")+"/";
apf.console.info("Starting Ajax.org Platform Application...");apf.console.warn("Debug build of Ajax.org Platform "+(apf.VERSION?"version "+apf.VERSION:""));
this.setCompatFlags();if(apf.onstart&&apf.onstart()===false){return false;}if(this.isIE){apf.runIE();
}if(apf.isWebkit){apf.runWebkit();}if(this.isOpera){apf.runOpera();}if(this.isGecko||!this.isIE&&!apf.isWebkit&&!this.isOpera){apf.runGecko();
}for(var i,l2,a,m,n,o,v,p=location.href.split(/[?&]/),l=p.length,k=1;k<l;k++){if(m=p[k].match(/(.*?)(\..*?|\[.*?\])?=([^#]*)/)){n=decodeURI(m[1]).toLowerCase(),o=this._GET;
if(m[2]){for(a=decodeURI(m[2]).replace(/\[\s*\]/g,"[-1]").split(/[\.\[\]]/),i=0,l2=a.length;
i<l2;i++){v=a[i],o=o[n]?o[n]:o[n]=(parseInt(v)==v)?[]:{},n=v.replace(/^["\'](.*)["\']$/,"$1");
}}o[n!="-1"?n:o.length]=unescape(decodeURI(m[3]));}}this.oHttp=new this.http();
this.Init.addConditional(this.parseAppMarkup,apf,["body"]);try{if(apf.isIE){document.execCommand("BackgroundImageCache",false,true);
}}catch(e){}this.started=true;if(this.load_done){this.execDeferred();}this.root=true;
for(var i=0;i<apf.$required.length;i++){apf.include(apf.$required[i]);}apf.require=apf.include;
},nsqueue:{},findPrefix:function(xmlNode,xmlns){var docEl;if(xmlNode.nodeType==9){if(!xmlNode.documentElement){return false;
}if(xmlNode.documentElement.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}docEl=xmlNode.documentElement;}else{if(xmlNode.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}docEl=xmlNode.ownerDocument.documentElement;if(docEl&&docEl.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}while(xmlNode.parentNode){xmlNode=xmlNode.parentNode;if(xmlNode.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}}}if(docEl){for(var i=0;i<docEl.attributes.length;i++){if(docEl.attributes[i].nodeValue==xmlns){return docEl.attributes[i][apf.TAGNAME];
}}}return false;},importClass:function(ref,strip,win){if(!ref){throw new Error(apf.formatErrorString(1018,null,"importing class","Could not load reference. Reference is null"));
}if(!strip){return apf.jsexec(ref.toString(),win);}var q=ref.toString().replace(/^\s*function\s*\w*\s*\([^\)]*\)\s*\{/,"").replace(/\}\s*$/,"");
return apf.jsexec(q,win);},toString:function(){return"[Ajax.org Platform (apf)]";
},all:[],implement:function(classRef){if(arguments.length==1){if(!classRef){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+classRef[i]+"'",this));
}classRef.call(this);}else{for(var a,i=0,l=arguments.length;i<l;i++){a=arguments[i];
if(!a){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+arguments[i]+"'",this));
}arguments[i].call(this);}}return this;},uniqueHtmlIds:0,setUniqueHtmlId:function(oHtml){var id;
oHtml.setAttribute("id",id="q"+this.uniqueHtmlIds++);return id;},getUniqueId:function(){return this.uniqueHtmlIds++;
},lookup:function(uniqueId){return this.all[uniqueId];},findHost:function(o){while(o&&o.parentNode){try{if((o.host||o.host===false)&&typeof o.host!="string"){return o.host;
}}catch(e){}o=o.parentNode;}return null;},setReference:function(name,o){return self[name]&&self[name].hasFeature?0:(self[name]=o);
},console:{data:{time:{messages:{}},log:{messages:{}},custom:{messages:{}},warn:{messages:{}},error:{messages:{}},repeat:{messages:{}}},toggle:function(node,id){var sPath=apf.$debugwin?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";
if(node.style.display=="block"){node.style.display="none";node.parentNode.style.backgroundImage="url("+sPath+"splus.gif)";
node.innerHTML="";}else{node.style.display="block";node.parentNode.style.backgroundImage="url("+sPath+"smin.gif)";
node.innerHTML=this.cache[id].replace(/\&/g,"&amp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;").replace(/\</g,"&lt;").replace(/\n/g,"<br />");
var p=node.parentNode.parentNode.parentNode,el=node.parentNode.parentNode;if(p.scrollTop+p.offsetHeight<el.offsetTop+el.offsetHeight){p.scrollTop=el.offsetTop+el.offsetHeight-p.offsetHeight;
}}},cache:[],history:[],typeLut:{time:"log",repeat:"log"},$lastmsg:"",$lastmsgcount:0,$detectSameMessage:function(){apf.console.$lastmsg="";
if(apf.console.$lastmsgcount){var msg=apf.console.$lastmsgcount+" times the same message";
apf.console.$lastmsgcount=0;apf.console.write(msg,"repeat");clearTimeout(apf.console.$timer);
}},teleportList:[],teleport:function(log){if(this.teleportModel){log.setXml(this.teleportModel.data);
}this.teleportList.push(log);},setTeleportModel:function(mdl){if(this.teleportModel==mdl){return;
}this.teleportModel=mdl;var xml=apf.getXml("<teleport />");for(var i=0;i<this.teleportList.length;
i++){this.teleportList[i].setXml(xml);}mdl.load(xml);},write:function(msg,type,subtype,data,forceWin,nodate){clearTimeout(this.$timer);
if(msg==this.$lastmsg){this.$lastmsgcount++;this.$timer=$setTimeout(this.$detectSameMessage,1000);
return;}this.$detectSameMessage();this.$lastmsg=msg;this.$timer=$setTimeout(this.$detectSameMessage,1000);
if(!Number.prototype.toPrettyDigit){Number.prototype.toPrettyDigit=function(){var n=this.toString();
return(n.length==1)?"0"+n:n;};}var dt=new Date(),ms=String(dt.getMilliseconds());
while(ms.length<3){ms+="0";}var date=dt.getHours().toPrettyDigit()+":"+dt.getMinutes().toPrettyDigit()+":"+dt.getSeconds().toPrettyDigit()+"."+ms;
msg=(!nodate?"<span class='console_date'>["+date+"]</span> ":"")+String(msg).replace(/(<[^>]+>)| /g,function(m,tag,sp){if(tag){return tag;
}return"&nbsp;";}).replace(/\t/g,"&nbsp;&nbsp;&nbsp;");var sPath=apf.$debugwin&&apf.$debugwin.resPath?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";
if(data){msg+="<blockquote style='margin:2px 0 0 0;background:url("+sPath+"splus.gif) no-repeat 2px 3px'><strong style='width:120px;cursor:default;display:block;padding:0 0 0 17px' onmousedown='(self.apf || window.opener.apf).console.toggle(this.nextSibling, "+(this.cache.push(data)-1)+")'>More information</strong><div style='display:none;background-color:#EEEEEE;padding:3px 3px 20px 3px;overflow:auto;max-height:200px'></div></blockquote>";
}msg="<div class='console_line console_"+type+"' >"+msg+"</div>";if(!subtype){subtype="default";
}this.history.push([this.typeLut[type]||type,msg]);if(this.win&&!this.win.closed){this.showWindow(msg);
}this.debugInfo.push(msg);if(self.console&&(!document.all||apf.config.debug)){console[type=="warn"?"warn":(type=="error"?"error":"log")](apf.html_entity_decode(msg.replace(/<[^>]*>/g,"")));
}if(apf.dispatchEvent){apf.dispatchEvent("debug",{message:msg,type:type});}},clear:function(){this.history=[];
},getAll:function(err,wrn,log){var hash={error:err,warn:wrn,log:log,custom:1};var out=[];
for(var i=0,l=this.history.length;i<l;i++){if(hash[this.history[i][0]]){out.push(this.history[i][1]);
}}return out.join("");},debug:function(msg,subtype,data){this.write(msg,"time",subtype,data);
},time:function(msg,subtype,data){this.write(msg,"time",subtype,data);},log:function(msg,subtype,data){this.write(apf.htmlentities(msg).replace(/\n/g,"<br />"),"log",subtype,data);
},info:function(msg,subtype,data){this.log(apf.htmlentities(msg).replace(/\n/g,"<br />"),subtype,data);
},warn:function(msg,subtype,data){this.write(apf.htmlentities(msg).replace(/\n/g,"<br />"),"warn",subtype,data);
},error:function(msg,subtype,data){this.write(msg.replace(/\n/g,"<br />"),"error",subtype,data);
},dir:function(obj){var s=apf.$debugwin.$serializeObject(obj,"Inspected via apf.console.dir");
if(typeof s=="string"){this.write(s,"custom",null,null,null,true);}else{this.write(obj?"Could not serialize object: "+s.message:obj,"error",null,null,null,true);
}},debugInfo:[],debugType:"",showWindow:function(msg){if(!this.win||this.win.closed){this.win=window.open("","debug");
this.win.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><body style="margin:0;font-family:Verdana;font-size:8pt;"></body>');
}if(!this.win){if(!this.haspopupkiller){alert("Could not open debug window, please check your popupkiller");
}this.haspopupkiller=true;}else{this.win.document.write((msg||this.debugInfo.join("")).replace(/\{imgpath\}/g,apf.debugwin?apf.debugwin.resPath:apf.basePath+"core/debug/resources/"));
}}},html_entity_decode:function(s){return s;},htmlentities:function(s){return s;
},formatErrorString:function(number,control,process,message,amlContext,outputname,output){var str=[];
if(amlContext&&amlContext.ownerDocument){if(amlContext.nodeType==9){amlContext=amlContext.documentElement;
}if(amlContext.ownerDocument.documentElement){var file=amlContext.ownerDocument.documentElement.getAttribute("filename");
if(!file&&amlContext.ownerDocument.documentElement.tagName=="html"){file=location.href;
}file=file?apf.removePathContext(apf.hostPath,file):"Unkown filename";}else{file="Unknown filename";
}if(apf.$debugwin){var amlStr=apf.$debugwin.$serializeObject(amlContext);}else{var amlStr=(amlContext.outerHTML||amlContext.xml||amlContext.serialize()).replace(/\<\?xml\:namespace prefix = j ns = "http\:\/\/ajax.org\/2005\/aml" \/\>/g,"").replace(/xmlns:a="[^"]*"\s*/g,"");
}var diff,linenr=0,w=amlContext.previousSibling||amlContext.parentNode&&amlContext.parentNode.previousSibling;
while(w&&w[apf.TAGNAME]!="body"){diff=(w.outerHTML||w.xml||w.serialize()).split("\n").length;
linenr+=diff-1;w=w.previousSibling||w.parentNode&&w.parentNode.previousSibling;
}if(w&&w[apf.TAGNAME]!="body"){linenr="unknown";}else{if(amlContext.ownerDocument&&amlContext.ownerDocument.documentElement.tagName=="html"){linenr+=apf.lineBodyStart;
}}str.push("aml file: [line: "+linenr+"] "+file);}if(control){str.push("Element: "+(apf.$debugwin&&!apf.isDebugWindow?apf.$debugwin.$serializeObject(control):"'"+(control.name||(control.$aml?control.getAttribute("id"):null)||"{Anonymous}")+"' ["+control.tagName+"]"));
}if(process){str.push("Process: "+process.replace(/ +/g," "));}if(message){str.push("Message: ["+number+"] "+message.replace(/ +/g," "));
}if(outputname){str.push(outputname+": "+output);}if(amlContext&&amlStr){str.push("Related Markup: "+amlStr);
}return(apf.lastErrorMessage=str.join("\n"));},getDirname:function(url){return((url||"").match(/^([^#]*\/)[^\/]*(?:$|\#)/)||{})[1];
},getFilename:function(url){return((url||"").split("?")[0].match(/(?:\/|^)([^\/]+)$/)||{})[1];
},getAbsolutePath:function(base,url){return url&&url.charAt(0)=="/"?url:(!url||!base||url.match(/^\w+\:\/\//)?url:base.replace(/\/$/,"")+"/"+url.replace(/^\//,""));
},include:function(sourceFile,doBase,type,text,callback){if(apf.started){apf.console.info("including js file: "+sourceFile);
}var sSrc=doBase?apf.getAbsolutePath(apf.basePath||"",sourceFile):sourceFile;var head=document.getElementsByTagName("head")[0],elScript=document.createElement("script");
if(type){elScript.setAttribute("_apf_type",type);}if(text){if(apf.isIE){window.execScript(text);
}else{elScript.text=text;}}else{elScript.src=sSrc;}head.appendChild(elScript);if(callback){elScript[apf.isIE?"onreadystatechange":"onload"]=callback;
}return elScript;},$required:[],require:function(){var dir=apf.getDirname(location.href),i=0,l=arguments.length;
for(;i<l;i++){this.$required.push(apf.getAbsolutePath(dir,arguments[i]));}},Init:{queue:[],cond:{combined:[]},done:{},add:function(func,o){if(this.inited){func.call(o);
}else{if(func){this.queue.push([func,o]);}}},addConditional:function(func,o,strObj){if(typeof strObj!="string"){if(this.checkCombined(strObj)){return func.call(o);
}this.cond.combined.push([func,o,strObj]);}else{if(self[strObj]){func.call(o);}else{if(!this.cond[strObj]){this.cond[strObj]=[];
}this.cond[strObj].push([func,o]);this.checkAllCombined();}}},checkAllCombined:function(){for(var i=0;
i<this.cond.combined.length;i++){if(!this.cond.combined[i]){continue;}if(this.checkCombined(this.cond.combined[i][2])){this.cond.combined[i][0].call(this.cond.combined[i][1]);
this.cond.combined[i]=null;}}},checkCombined:function(arr){for(var i=0;i<arr.length;
i++){if(!this.done[arr[i]]){return false;}}return true;},run:function(strObj){this.inited=this.done[strObj]=true;
this.checkAllCombined();var data=strObj?this.cond[strObj]:this.queue;if(!data){return;
}for(var i=0;i<data.length;i++){data[i][0].call(data[i][1]);}}},amlParts:[],parseStrategy:0,parsePartialAml:function(docElement){apf.console.warn("The aml namespace definition wasn't found on the root node of this document. We're assuming you want to load a partial piece of aml embedded in this document. Starting to search for it now.");
var findAml;if(apf.isIE){findAml=function(htmlNode){if(htmlNode.outerHTML.match(/\/>$/)){throw new Error("Cannot have self closing elements!\n"+htmlNode.outerHTML);
}try{var tags={IMG:1,LINK:1,META:1,INPUT:1,BR:1,HR:1,AREA:1,BASEFONT:1},regex=new RegExp(htmlNode.outerHTML.replace(/([\(\)\|\\\.\^\$\{\}\[\]])/g,"\\$1")+".*"+htmlNode.tagName),match=htmlNode.parentNode.outerHTML.replace(/\n/g,"").match(regex),strXml=match[0]+">".replace(/(\w+)\s*=\s*([^\>="'\s ]+)( |\s|\>|\/\>)/g,'$1="$2"$3').replace(/ disabled /g," disabled='true' ").replace(/\]\]\&gt;/g,"]]>").replace(/<(\w+)(\s[^>]*[^\/])?>/g,function(m,tag,c){if(tags[tag]){return"<"+tag+(c||"")+"/>";
}else{return m;}});}catch(e){throw new Error(apf.formatErrorString(0,null,"Parsing inline aml (without xmlns on root node)","Could not parse inline aml. This happens when the htmlis mangled too much by Internet Explorer. Either you are using a cdata section or javascript containing symbols that throw off the browser. Please put this aml in a seperate file and load it using an include element."));
return;}var xmlNode=apf.getAmlDocFromString("<div jid='"+(id++)+"' "+strXmlns+">"+strXml+"</div>").documentElement;
while(xmlNode.childNodes.length>1){xmlNode.removeChild(xmlNode.lastChild);}apf.AppNode.appendChild(xmlNode);
};}else{findAml=function(htmlNode){var strXml=htmlNode.outerHTML.replace(/ _moz-userdefined=""/g,""),xmlNode=apf.getAmlDocFromString("<div jid='"+(id++)+"' "+strXmlns+">"+strXml+"</div>").documentElement;
while(xmlNode.childNodes.length>1){xmlNode.removeChild(xmlNode.lastChild);}if(apf.isWebkit){xmlNode=apf.AppNode.ownerDocument.importNode(xmlNode,true);
}apf.AppNode.appendChild(xmlNode);};}var match=document.body.outerHTML.match(/(\w+)\s*=\s*["']http:\/\/ajax\.org\/2005\/aml["']/);
if(!match){return false;}var strXmlns="xmlns:"+match[0],prefix=(RegExp.$1||"").toUpperCase();
if(apf.isOpera){prefix=prefix.toLowerCase();}if(!prefix){return false;}prefix+=":";
apf.AppNode=apf.getAmlDocFromString("<"+prefix.toLowerCase()+"application "+strXmlns+" />").documentElement;
var temp,loop,cnode,isPrefix=false,id=0,node=document.body;while(node){isPrefix=node.nodeType==1&&node.tagName.substr(0,2)==prefix;
if(isPrefix){findAml(cnode=node);if(apf.isIE){loop=node;var count=1,next=loop.nextSibling;
if(next){loop.parentNode.removeChild(loop);while(next&&(next.nodeType!=1||next.tagName.indexOf(prefix)>-1)){if(next.nodeType==1){count+=next.tagName.charAt(0)=="/"?-1:1;
}if(count==0){if(temp){temp.parentNode.removeChild(temp);}temp=next;break;}next=(loop=next).nextSibling;
if(!next){next=loop;break;}if(loop.nodeType==1){loop.parentNode.removeChild(loop);
if(temp){temp.parentNode.removeChild(temp);temp=null;}}else{if(temp){temp.parentNode.removeChild(temp);
}temp=loop;}}node=next;}else{if(temp){temp.parentNode.removeChild(temp);}temp=loop;
}}else{if(temp){temp.parentNode.removeChild(temp);}temp=node;}if(apf.amlParts.length&&apf.amlParts[apf.amlParts.length-1][1]==cnode){apf.amlParts[apf.amlParts.length-1][1]=-1;
}apf.amlParts.push([node.parentNode,apf.isIE?node.nextSibling:node.nextSibling]);
}else{if(node.tagName=="SCRIPT"&&node.getAttribute("src")&&(node.getAttribute("src").indexOf("ajax.org")>-1)){var strXml=node.outerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/<SCRIPT[^>]*\>\s*<\!\[CDATA\[>?/i,"").replace(/<SCRIPT[^>]*\>(?:<\!\-\-)?/i,"").replace(/(\/\/)?\s*\&\#8211;>\s*<\/SCRIPT>/i,"").replace(/\-\->\s*<\/SCRIPT>/i,"").replace(/\]\](?:\&gt\;|>)\s*<\/SCRIPT>/i,"").replace(/<\/SCRIPT>$/mi,"").replace(/<\/?\s*(?:p|br)\s*\/?>/ig,"").replace(/<\!--\s*.*?\s*-->\s*<script.*/ig,"").replace(/\\+(['"])/g,"$1");
if(strXml.trim()){var xmlNode=apf.getAmlDocFromString("<div jid='"+(id++)+"' "+strXmlns+">"+strXml+"</div>").documentElement;
if(apf.isWebkit){xmlNode=apf.AppNode.ownerDocument.importNode(xmlNode,true);}apf.AppNode.appendChild(xmlNode);
apf.amlParts.push([node.parentNode,node.nextSibling]);}}}if(!isPrefix&&node.firstChild||node.nextSibling){if(!isPrefix&&node.firstChild){node=node.firstChild;
}else{node=node.nextSibling;}}else{do{node=node.parentNode;if(node.tagName=="BODY"){node=null;
}}while(node&&!node.nextSibling);if(node){node=node.nextSibling;}}}if(temp){temp.parentNode.removeChild(temp);
}},parseAppMarkup:function(docElement){var isEmptyDocument=false;if(this.parseStrategy==1||!this.parseStrategy&&!docElement&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){this.parsePartialAml(docElement);
if(this.parseStrategy==1||apf.amlParts.length){if(apf.amlParts.length){apf.console.warn("Aml found, parsing...");
}apf.isParsingPartial=true;apf.loadAmlIncludes(apf.AppNode);if(!self.ERROR_HAS_OCCURRED){apf.initialize();
}return;}else{apf.console.warn("No aml found.");isEmptyDocument=true;}}if(isEmptyDocument&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){apf.console.warn("The aml namespace declaration wasn't found. No aml elements were found in the body. Exiting");
return false;}if(this.parseStrategy==21||!this.parseStrategy&&!docElement){return apf.oHttp.get((apf.alternativeAml||document.body&&document.body.getAttribute("xmlurl")||location.href).split(/#/)[0],{type:"markup",callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){var oError=new Error(apf.formatErrorString(0,null,"Loading XML application data","Could not load XML from remote source: "+extra.message));
if(extra.tpModule.retryTimeout(extra,state,null,oError)===true){return true;}throw oError;
}apf.lineBodyStart=(xmlString.replace(/\n/g,"\\n").match(/(.*)<body/)||[""])[0].split("\\n").length;
var str=xmlString.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){str=str.replace(/xmlns\=\"[^"]*\"/g,"");
}if(self.ERROR_HAS_OCCURRED){return;}if(apf.isIE){document.body.innerHTML="";}else{var nodes=document.body.childNodes;
for(var i=nodes.length-1;i>=0;i--){nodes[i].parentNode.removeChild(nodes[i]);}}document.documentElement.style.display="block";
document.body.style.display="block";apf.initialize(str);},ignoreOffline:true});
}else{document.body.style.display="block";if(!self.ERROR_HAS_OCCURRED){apf.initialize(docElement.outerHTML||docElement.xml);
}}},namespaces:{},setNamespace:function(namespaceURI,oNamespace){this.namespaces[namespaceURI]=oNamespace;
oNamespace.namespaceURI=namespaceURI;},initialize:function(xmlStr){if(apf.initialized){return;
}apf.initialized=true;apf.console.info("Initializing...");clearInterval(apf.Init.interval);
apf.Init.run();var bodyMarginTop=parseFloat(apf.getStyle(document.body,"marginTop"));
apf.doesNotIncludeMarginInBodyOffset=(document.body.offsetTop!==bodyMarginTop);
if(apf.isParsingPartial){apf.config.setDefaults();apf.hasSingleRszEvent=true;var pHtmlNode=document.body;
var lastChild=pHtmlNode.lastChild;apf.AmlParser.parseMoreAml(apf.AppNode,pHtmlNode,null,true,false);
var pNode,firstNode,next,info,lastBefore=null,loop=pHtmlNode.lastChild;while(loop&&lastChild!=loop){info=apf.amlParts[loop.getAttribute("jid")];
next=loop.previousSibling;if(info){pNode=info[0];if("P".indexOf(pNode.tagName)>-1){lastBefore=pNode.parentNode.insertBefore(apf.getNode(loop,[0]),pNode);
}else{firstNode=apf.getNode(loop,[0]);while(firstNode){if(firstNode){lastBefore=pNode.insertBefore(firstNode,typeof info[1]=="number"?lastBefore:info[1]);
}else{lastBefore=typeof info[1]=="number"?lastBefore:info[1];}firstNode=apf.getNode(loop,[0]);
}}loop.parentNode.removeChild(loop);}loop=next;}$setTimeout("apf.layout.forceResize();");
}else{apf.window.init(xmlStr);}},execDeferred:function(){var len=apf.load_events.length;
while(len--){(apf.load_events.shift())();}},load_events:[],load_timer:null,load_done:false,load_init:null,addDomLoadEvent:function(func){if(!this.$bdetect){this.browserDetect();
}if(apf.load_done){return func();}if(!apf.load_init){apf.load_init=function(){if(apf.load_done){return;
}clearInterval(apf.load_timer);apf.load_timer=null;apf.load_done=true;if(apf.started){apf.execDeferred();
}};}apf.load_events.push(func);if(func&&apf.load_events.length==1){var doc=document,UNDEF="undefined";
if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(doc.getElementsByTagName("body")[0]||doc.body)){return apf.load_init();
}if(doc.addEventListener&&!apf.isOpera){window.addEventListener("DOMContentLoaded",apf.load_init,false);
}else{if(apf.isIE&&window==top){apf.load_timer=setInterval(function(){try{doc.documentElement.doScroll("left");
}catch(ex){$setTimeout(arguments.callee,0);return;}apf.load_init();},10);}else{if(apf.isOpera){doc.addEventListener("DOMContentLoaded",function(){apf.load_timer=setInterval(function(){for(var i=0,l=doc.styleSheets.length;
i<l;i++){if(doc.styleSheets[i].disabled){return;}}apf.load_init();},10);},false);
}else{if(apf.isWebkit&&!apf.isIphone){var aSheets=doc.getElementsByTagName("link"),i=aSheets.length,iSheets;
for(;i>=0;i++){if(!aSheets[i]||aSheets[i].getAttribute("rel")!="stylesheet"){aSheets.splice(i,0);
}}iSheets=aSheets.length;apf.load_timer=setInterval(function(){if(/loaded|complete/.test(doc.readyState)&&doc.styleSheets.length==iSheets){apf.load_init();
}},10);}else{var old_onload=window.onload;window.onload=function(){apf.load_init();
if(old_onload){old_onload();}};}}}}}},fireEvent:function(el,type,e,capture){if(el.dispatchEvent){el.dispatchEvent(type,e,capture);
}else{el.fireEvent("on"+type,e);}},addListener:function(el,type,fn){if(el.addEventListener){el.addEventListener(type,fn,false);
}else{if(el.attachEvent){el.attachEvent("on"+type,fn);}}return this;},removeListener:function(el,type,fn){if(el.removeEventListener){el.removeEventListener(type,fn,false);
}else{if(el.detachEvent){el.detachEvent("on"+type,fn);}}return this;},stopEvent:function(e){this.stopPropagation(e).preventDefault(e);
return false;},stopPropagation:function(e){if(e.stopPropagation){e.stopPropagation();
}else{e.cancelBubble=true;}return this;},preventDefault:function(e){if(e.preventDefault){e.preventDefault();
}else{e.returnValue=false;}return this;},unload:function(exclude){apf.console.info("Initiating self destruct...");
this.isDestroying=true;this.popup.destroy();var node,i=0,l=this.all.length;for(;
i<l;i++){node=this.all[i];if(node&&node!=exclude&&node.destroy&&!node.apf){node.destroy(false);
}}for(i=0,l=this.availHTTP.length;i<l;i++){this.availHTTP[i]=null;}this.availHTTP.length=0;
if(apf.xmldb){apf.xmldb.unbind(apf.window);}this.isDestroying=false;}};var $xmlns=function(xmlNode,tag,xmlns,prefix){if(!apf.supportNamespaces){if(!prefix){prefix=apf.findPrefix(xmlNode,xmlns);
}if(xmlNode.style||xmlNode==document){return xmlNode.getElementsByTagName(tag);
}else{if(prefix){(xmlNode.nodeType==9?xmlNode:xmlNode.ownerDocument).setProperty("SelectionNamespaces","xmlns:"+prefix+"='"+xmlns+"'");
}return xmlNode.selectNodes(".//"+(prefix?prefix+":":"")+tag);}}return xmlNode.getElementsByTagNameNS(xmlns,tag);
};var $setTimeout=setTimeout;var $setInterval=setInterval;apf.setTimeout=function(f,t){apf.$eventDepth++;
return $setTimeout(function(){f();if(--apf.$eventDepth==0){apf.queue.empty();}},t);
};document.documentElement.className+=" has_apf";document.documentElement.style.display="none";
apf.browserDetect();apf.Init.run("apf");apf.Class=function(){};apf.Class.prototype=new (function(){var FUN="function",OBJ="object",UNDEF="undefined",SEL="model",PROP="prop.",MODEL="model",VALUE="value";
this.$regbase=0;this.hasFeature=function(test){return this.$regbase&test;};this.$initStack=[];
this.$bufferEvents=[];this.$init=function(callback,nodeFunc,struct){if(typeof callback==FUN||callback===true){this.$bufferEvents=this.$bufferEvents.slice();
if(callback===true){return this;}this.$initStack=this.$initStack.slice();this.$initStack.push(callback);
return this;}this.addEventListener=realAddEventListener;if(this.nodeType!=2){this.$uniqueId=apf.all.push(this)-1;
}this.$captureStack={};this.$eventsStack={};this.$funcHandlers={};var i=0,l=this.$initStack.length;
for(;i<l;i++){this.$initStack[i].apply(this,arguments);}for(i=0,l=this.$bufferEvents.length;
i<l;i++){this.addEventListener.apply(this,this.$bufferEvents[i]);}delete realAddEventListener;
delete this.$initStack;delete this.$bufferEvents;if(struct&&(struct.htmlNode||this.nodeFunc==apf.NODE_HIDDEN)){this.$pHtmlNode=struct.htmlNode;
this.ownerDocument.$domParser.$continueParsing(this);apf.queue.empty();}return this;
};this.implement=apf.implement;this.$handlePropSet=function(prop,value){this[prop]=value;
};this.$bindProperty=function(myProp,bObject,bProp,fParsed,bRecip){if(!fParsed){return bObject.$handlePropSet(bProp,this[myProp]);
}var eventName=PROP+myProp,eFunc,isBeingCalled,isLang;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(eFunc=function(e){if(isBeingCalled){return;
}apf.$lm_has_lang=false;isBeingCalled=true;try{if(fParsed.asyncs){return fParsed.call(bObject,bObject.xmlRoot,function(value){bObject.setProperty(bProp,value,true,false,10);
if(apf.$lm_has_lang&&!isLang){isLang=true;apf.language.addProperty(bObject,bProp,fParsed);
}isBeingCalled=false;});}else{var value=fParsed.call(bObject,bObject.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding for property "+bProp+"\n\n"+e.message);
isBeingCalled=false;return;}bObject.setProperty(bProp,value,true,false,10);if(apf.$lm_has_lang&&!isLang){isLang=true;
apf.language.addProperty(bObject,bProp,fParsed);}isBeingCalled=false;});if(bRecip){eventName=PROP+bProp;
var _self=this;if(!this.$funcHandlers[bProp]){this.$funcHandlers[bProp]=[];}this.$funcHandlers[bProp].push({amlNode:bObject,prop:bProp});
(bObject.$eventsStack[eventName]||(bObject.$eventsStack[eventName]=[])).push(eFunc.recip=function(){if(isBeingCalled){return;
}isBeingCalled=true;_self.setProperty(myProp,bObject[bProp],true,false,10);isBeingCalled=false;
});}return eFunc;};this.$attrExcludePropBind=false;this.$setDynamicProperty=function(prop,pValue){var exclNr=this.$attrExcludePropBind[prop],options;
if(SEL.indexOf(prop)>-1||exclNr==3){options={xpathmode:2};}else{if(exclNr==2){options={nostring:true};
}else{if(exclNr===0){options={parsecode:true,nothrow:this.target.match(/-debug$/)?true:false};
}}}if(this.liveedit){(options||(options={})).liveedit=true;}if(apf.config.debugLm){(options||(options={})).nothrow=true;
}if(pValue&&pValue.dataType==apf.FUNCTION){var fParsed=pValue;pValue="";}else{var fParsed=apf.lm.compile(pValue,options);
}if(prop==MODEL){(this.$modelParsed=fParsed).instruction=pValue;}else{if(exclNr===0){this.$lastFParsed=fParsed;
}}if(fParsed.type==2){this[prop]=!pValue;return this.setProperty(prop,fParsed.str,null,null,10);
}var check=1;if(exclNr==2||fParsed.xpaths.length&&exclNr!=1){if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);
if(this.$attrExcludePropBind[prop]==1){check=0;}}if(check){this.$addAttrBind(prop,fParsed,pValue);
}}var matches=exclNr&&exclNr!=3&&prop!=MODEL?{}:fParsed.props,found=false,_self=this,o,node,bProp,p;
for(p in matches){if(typeof matches[p]==FUN){continue;}o=p.split(".");if(o.length>2){bProp=o.pop();
try{node=eval(o.join("."));}catch(e){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);
}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);
_self.$setDynamicProperty(prop,pValue,true);});}continue;}if(!node||typeof node!=OBJ||(!node.$regbase&&node.$regbase!==0)){bProp=o[1];
node=self[o[0]];}else{o.push(bProp);}}else{bProp=o[1];node=self[o[0]]||o[0]=="this"&&this;
}if(!node){if(arguments[2]){apf.console.warn("[287] Could not create property binding:  '"+o[0]+"' does not exist. \n"+pValue.replace(/</g,"&lt;").substr(0,400));
var _self=this;apf.nameserver.waitFor(o[0],function(){_self.$setDynamicProperty(prop,pValue);
});return;}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);
_self.$setDynamicProperty(prop,pValue,true);});return;}}if(!node.$bindProperty){continue;
}if(!this.$funcHandlers[prop]){this.$funcHandlers[prop]=[];}var last;this.$funcHandlers[prop].push(last={amlNode:node,prop:bProp,handler:node.$bindProperty(bProp,this,prop,fParsed,fParsed.type==4&&SEL.indexOf(prop)==-1)});
found=true;}if(found){last.handler({initial:true});}else{if(exclNr){return this.setProperty(prop,pValue,null,null,10);
}apf.$lm_has_lang=false;try{if(fParsed.asyncs){return fParsed.call(this,this.xmlRoot,function(value){_self.setProperty(prop,value,true,null,10);
if(apf.$lm_has_lang){apf.language.addProperty(this,prop,fParsed);}});}else{var value=fParsed.call(this,this.xmlRoot);
}}catch(e){apf.console.warn("[331] Could not execute binding test or: "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);
return;}this[prop]=!value;this.setProperty(prop,value,true,null,10);if(apf.$lm_has_lang){apf.language.addProperty(this,prop,fParsed);
}}};this.$clearDynamicProperty=function(prop){if(this.$removeAttrBind){this.$removeAttrBind(prop);
}apf.language.removeProperty(this,prop);if(this.$inheritProperties){delete this.$inheritProperties[prop];
}if(prop==MODEL){this.$modelParsed=null;}var f,i,l,h=this.$funcHandlers[prop];if(h&&typeof h!=FUN){for(i=0,l=h.length;
i<l;i++){(f=h[i]).amlNode.removeEventListener(PROP+f.prop,f.handler);if(f.handler&&f.handler.recip){this.removeEventListener(PROP+prop,f.handler.recip);
}}delete this.$funcHandlers[prop];}};this.watch=function(propName,callback){var eventName=PROP+propName,wrapper=function(e){callback.call(this,propName,e.oldvalue,e.value);
};wrapper.callback=callback;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(wrapper);
};this.unwatch=function(propName,callback){var list,eventName=PROP+propName;if(!(list=this.$eventsStack[eventName])){return;
}for(var i=0,l=list.length;i<l;i++){if(list[i].callback==callback){list.remove(i);
return;}}};this.getAvailableProperties=function(){return this.$supportedProperties.slice();
};this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){var s,r,arr,e,i,l,oldvalue=this[prop],eventName=PROP+prop;
try{var isChanged=(typeof value==OBJ)?value!=(typeof oldvalue==OBJ?oldvalue:null):String(oldvalue)!==String(value);
}catch(e){var isChanged=true;}if(isChanged){if(!forceOnMe){if(typeof value!=OBJ&&(!(s=this.$attrExcludePropBind[prop]))&&(r=(this.$attrBindings&&this.$attrBindings[prop]||prop!=VALUE&&this.xmlRoot&&this.$bindings[prop]&&this.$bindings[prop][0]))){if(r.cvalue.type==3){return apf.setNodeValue(this.$getDataNode(prop.toLowerCase(),this.xmlRoot,true),value,true);
}}else{if(typeof apf.offline!=UNDEF){if(apf.loaded&&apf.offline.state.enabled){apf.offline.state.set(this,prop,typeof value==OBJ?value.name:value);
}else{if(apf.offline.enabled){}}}}}if(setAttr){this.setAttribute(prop,value,true);
}if(this.$handlePropSet(prop,value,forceOnMe)===false){return;}value=this[prop];
}if(arr=this.$eventsStack[eventName]){if(this.dispatchEvent(eventName,{prop:prop,value:value,oldvalue:oldvalue,changed:isChanged})===false){e.returnValue=false;
}}if((aci||(aci=apf.config.$inheritProperties))[prop]){var resetting=value===""||typeof value=="undefined";
if(inherited!=10&&!value){delete this.$inheritProperties[prop];if(this.$setInheritedAttribute&&this.$setInheritedAttribute(prop)){return;
}}else{if(inherited!=10){this.$inheritProperties[prop]=inherited||-1;}}if(this.$amlLoaded&&(!e||e.returnValue!==false)&&this.childNodes){var inheritType=aci[prop];
(function recur(nodes){var i,l,node,n;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.nodeType!=1&&node.nodeType!=7){continue;}n=node.$inheritProperties[prop];
if(inheritType==1&&!n){recur(node.childNodes);}else{if(!(n<0)){if(n==3||inherited==3){var sameValue=node[prop];
node[prop]=null;}node.setProperty(prop,n!=3?value:sameValue,false,false,n||2);}}}})(this.childNodes);
}}return value;};var aci;this.getProperty=function(prop){return this[prop];};apf.$eventDepth=0;
this.$eventDepth=0;this.dispatchEvent=function(eventName,options,e){var arr,result,rValue,i,l;
apf.$eventDepth++;this.$eventDepth++;e=options&&options.name?options:e;if(options&&!options.bubbles&&options.currentTarget&&options.currentTarget!=this){throw new Error("Invalid use of options detected in dispatch Event");
}if((!e||!e.currentTarget)&&(!options||!options.currentTarget)){if(!(options||(options={})).currentTarget){options.currentTarget=this;
}if(arr=this.$captureStack[eventName]){for(i=0,l=arr.length;i<l;i++){rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));
if(typeof rValue!=UNDEF){result=rValue;}}}}if(options&&options.captureOnly){return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;
}else{if(this["on"+eventName]){result=this["on"+eventName].call(this,e||(e=new apf.AmlEvent(eventName,options)));
}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(!arr[i]){continue;
}rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;
}}}}if((e&&e.bubbles&&!e.cancelBubble||!e&&options&&options.bubbles)&&this!=apf){rValue=(this.parentNode||this.ownerElement||apf).dispatchEvent(eventName,options,e);
if(typeof rValue!=UNDEF){result=rValue;}}if(--apf.$eventDepth==0&&this.ownerDocument&&!this.ownerDocument.$domParser.$parseContext&&!apf.isDestroying&&apf.loaded&&eventName!="debug"&&apf.queue){apf.queue.empty();
}this.$eventDepth--;if(options){try{delete options.currentTarget;}catch(ex){options.currentTarget=null;
}}return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;};this.addEventListener=function(a,b,c){this.$bufferEvents.push([a,b,c]);
};var realAddEventListener=function(eventName,callback,useCapture){if(eventName.substr(0,2)=="on"){eventName=eventName.substr(2);
}var s,stack=useCapture?this.$captureStack:this.$eventsStack;if(!(s=stack[eventName])){s=stack[eventName]=[];
}if(s.indexOf(callback)>-1){return;}s.unshift(callback);var f;if(f=this.$eventsStack["$event."+eventName]){f[0].call(this,callback);
}};this.removeEventListener=function(eventName,callback,useCapture){var stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName];
if(stack){if(this.$eventDepth){stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName]=stack.slice();
}stack.remove(callback);if(!stack.length){delete (useCapture?this.$captureStack:this.$eventsStack)[eventName];
}}};this.hasEventListener=function(eventName){return(this.$eventsStack[eventName]&&this.$eventsStack[eventName].length>0);
};this.destroy=function(deep,clean){if(typeof this.$uniqueId==UNDEF&&this.nodeType!=2){return;
}this.$amlLoaded=false;this.$amlDestroyed=true;if(this.$destroy){this.$destroy();
}this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:!apf.isDestroying});
this.dispatchEvent("DOMNodeRemovedFromDocument");apf.all[this.$uniqueId]=undefined;
if(!this.nodeFunc&&!this.nodeType){try{if(this.id||this.name){self[this.id||this.name]=null;
}}catch(ex){}return;}if(this.$ext&&!this.$ext.isNative){if(this.nodeType==1&&this.localName!="a"){this.$ext.oncontextmenu=this.$ext.host=null;
}if(clean){if(this.localName!="collection"){this.$ext.parentNode.removeChild(this.$ext);
}}}if(this.$int&&!this.$int.isNative&&this.$int.nodeType==1&&this.localName!="a"){this.$int.host=null;
}this.$aml=null;if(deep&&this.childNodes){var nodes=this.childNodes;for(i=nodes.length-1;
i>=0;i--){if(nodes[i].destroy){nodes[i].destroy(true,clean&&this.localName=="collection");
}}this.childNodes=null;}if(this.parentNode&&this.removeNode){this.removeNode();
}else{if(this.ownerElement&&!this.ownerElement.$amlDestroyed){this.ownerElement.removeAttributeNode(this);
}}if(this.$focussable&&this.focussable){apf.window.$removeFocus(this);}if(this.attributes){var attr=this.attributes;
for(var i=attr.length-1;i>=0;i--){this.$clearDynamicProperty(attr[i].nodeName);
attr[i].destroy();}}if(deep!==false&&this.childNodes&&this.childNodes.length){apf.console.warn("You have destroyed an Aml Node without destroying it's children. Please be aware that if you don't maintain a reference, memory might leak");
}try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}apf.nameserver.remove(this.localName,this);
};})();apf.extend(apf,new apf.Class().$init());apf.Init.run("class");apf.color={colorshex:{aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662680,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14184595,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fixHSB:function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))};
},fixRGB:function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))};
},fixHex:function(hex){var len=6-hex.length;if(len>0){var o=[],i=0;for(;i<len;i++){o.push("0");
}o.push(hex);hex=o.join("");}return hex;},hexToRGB:function(hex){hex=parseInt(((hex.indexOf("#")>-1)?hex.substring(1):hex),16);
return{r:hex>>16,g:(hex&65280)>>8,b:(hex&255)};},hexToHSB:function(hex){return this.RGBToHSB(this.hexToRGB(hex));
},RGBToHSB:function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b),max=Math.max(rgb.r,rgb.g,rgb.b),delta=max-min;
hsb.b=max;if(max!=0){}hsb.s=max!=0?255*delta/max:0;if(hsb.s!=0){if(rgb.r==max){hsb.h=(rgb.g-rgb.b)/delta;
}else{if(rgb.g==max){hsb.h=2+(rgb.b-rgb.r)/delta;}else{hsb.h=4+(rgb.r-rgb.g)/delta;
}}}else{hsb.h=-1;}hsb.h*=60;if(hsb.h<0){hsb.h+=360;}hsb.s*=100/255;hsb.b*=100/255;
return hsb;},HSBToRGB:function(hsb){var rgb={},h=Math.round(hsb.h),s=Math.round(hsb.s*255/100),v=Math.round(hsb.b*255/100);
if(s==0){rgb.r=rgb.g=rgb.b=v;}else{var t1=v,t2=(255-s)*v/255,t3=(t1-t2)*(h%60)/60;
if(h==360){h=0;}if(h<60){rgb.r=t1,rgb.b=t2,rgb.g=t2+t3;}else{if(h<120){rgb.g=t1,rgb.b=t2,rgb.r=t1-t3;
}else{if(h<180){rgb.g=t1,rgb.r=t2,rgb.b=t2+t3;}else{if(h<240){rgb.b=t1,rgb.r=t2,rgb.g=t1-t3;
}else{if(h<300){rgb.b=t1,rgb.g=t2,rgb.r=t2+t3;}else{if(h<360){rgb.r=t1,rgb.g=t2,rgb.b=t1-t3;
}else{rgb.r=0,rgb.g=0,rgb.b=0;}}}}}}}return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)};
},RGBToHex:function(rgb){return("00000"+(rgb.r<<16|rgb.g<<8|rgb.b).toString(16)).slice(-6);
},HSBToHex:function(hsb){return this.RGBToHex(this.HSBToRGB(hsb));}};apf.AbstractEvent=function(event,win){win=win||window;
var doc=win.document;event=event||win.event;if(event.$extended){return event;}this.$extended=true;
this.event=event;this.type=event.type;this.target=event.target||event.srcElement;
while(this.target&&this.target.nodeType==3){this.target=this.target.parentNode;
}if(this.type.indexOf("key")!=-1){this.code=event.which||event.keyCode;}else{if(this.type.match(/(click|mouse|menu)/i)){doc=(!doc.compatMode||doc.compatMode=="CSS1Compat")?doc.html:doc.body;
this.page={x:event.pageX||event.clientX+(doc?doc.scrollLeft:0),y:event.pageY||event.clientY+(doc?doc.scrollTop:0)};
this.client={x:(event.pageX)?event.pageX-win.pageXOffset:event.clientX,y:(event.pageY)?event.pageY-win.pageYOffset:event.clientY};
if(this.type.match(/DOMMouseScroll|mousewheel/)){this.wheel=(event.wheelDelta)?event.wheelDelta/120:-(event.detail||0)/3;
}this.rightClick=(event.which==3)||(event.button==2);this.relatedTarget=null;if(this.type.match(/over|out/)){if(this.type=="mouseover"){this.relatedTarget=event.relatedTarget||event.fromElement;
}else{if(this.type=="mouseout"){this.relatedTarget=event.relatedTarget||event.toElement;
}else{try{while(this.relatedTarget&&this.relatedTarget.nodeType==3){this.relatedTarget=this.relatedTarget.parentNode;
}}catch(e){}}}}}}this.shift=Boolean(event.shiftKey);this.control=Boolean(event.ctrlKey);
this.alt=Boolean(event.altKey);this.meta=Boolean(event.metaKey);this.stop=function(){return this.stopPropagation().preventDefault();
};this.stopPropagation=function(){if(this.event.stopPropagation){this.event.stopPropagation();
}else{this.event.cancelBubble=true;}return this;};this.preventDefault=function(){if(this.event.preventDefault){this.event.preventDefault();
}else{this.event.returnValue=false;}return this;};};apf.AbstractEvent.KEYS={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46,fromCode:function(code){for(var i in this){if(this[i]==code){return i;
}return null;}}};apf.AbstractEvent.stop=function(event){return(new apf.AbstractEvent(event)).stop();
};apf.asyncForEach=function(list,async,callback){var i=0;var len=list.length;if(!len){return callback(null,[]);
}async(list[i],function handler(err){if(err){return callback(err);}i++;if(i<len){async(list[i],handler,i);
}else{callback(null);}},i);};apf.asyncWhile=function(condition,async,callback){var i=0;
async(i,function handler(err){if(err){return callback?callback(err,i):null;}++i;
if(condition(i)){async(i,handler);}else{callback&&callback(null,i);}});};apf.asyncMap=function(list,mapper,callback){var i=0;
var len=list.length;if(!len){return callback(null,[]);}var map=[];async(list[i],function handler(err,value){if(err){return callback(err);
}map[i]=value;i++;if(i<len){async(list[i],handler);}else{callback(null,map);}});
};apf.asyncChain=function(funcs){var i=0;var len=funcs.length;function next(){var f=funcs[i++];
if(i==len){f();}else{f(next);}}next();};apf.setcookie=function(name,value,expire,path,domain,secure){var ck=name+"="+escape(value)+";";
if(expire){ck+="expires="+new Date(expire+new Date().getTimezoneOffset()*60).toGMTString()+";";
}if(path){ck+="path="+path+";";}if(domain){ck+="domain="+domain+";";}if(secure){ck+="secure";
}document.cookie=ck;return value;};apf.getcookie=function(name){var aCookie=document.cookie.split("; ");
for(var i=0;i<aCookie.length;i++){var aCrumb=aCookie[i].split("=");if(name==aCrumb[0]){return unescape(aCrumb[1]);
}}return"";};apf.delcookie=function(name,domain){document.cookie=name+"=blah; expires=Fri, 31 Dec 1999 23:59:59 GMT;"+(domain?"domain="+domain:"");
};if(typeof isFinite=="undefined"){function isFinite(val){return val+1!=val;}}apf.NUMBER=1;
apf.BOOLEAN=2;apf.STRING=3;apf.ARRAY=4;apf.DATE=5;apf.REGEXP=6;apf.FUNCTION=7;Array.prototype.dataType=apf.ARRAY;
Number.prototype.dataType=apf.NUMBER;Date.prototype.dataType=apf.DATE;Boolean.prototype.dataType=apf.BOOLEAN;
String.prototype.dataType=apf.STRING;RegExp.prototype.dataType=apf.REGEXP;Function.prototype.dataType=apf.FUNCTION;
apf.getCgiString=function(args,multicall,mcallname){var vars=[];function recur(o,stack){var prop;
if(apf.isArray(o)){for(var j=0;j<o.length;j++){recur(o[j],stack+"%5B%5D");}}else{if(typeof o=="object"){for(prop in o){if(apf.isSafariOld&&(!o[prop]||typeof p[prop]!="object")){continue;
}if(typeof o[prop]=="function"){continue;}recur(o[prop],stack+"%5B"+encodeURIComponent(prop)+"%5D");
}}else{vars.push(stack+"="+encodeURIComponent(o));}}}if(multicall){vars.push("func="+mcallname);
for(var i=0;i<args[0].length;i++){recur(args[0][i],"f%5B"+i+"%5D");}}else{for(prop in args){if(apf.isSafariOld&&(!args[prop]||typeof args[prop]=="function")){continue;
}recur(args[prop],prop);}}return vars.join("&");};apf.fromCgiString=function(args){if(!args){return false;
}var obj={};args=args.split("&");for(var data,i=0;i<args.length;i++){data=args[i].split("=");
data[0]=decodeURIComponent(data[0]);var path=data[0].replace(/\]/g,"").split("[");
var spare=obj;for(var j=0;j<path.length;j++){if(spare[path[j]]){spare=spare[path[j]];
}else{if(path.length==j+1){if(path[j]){spare[path[j]]=decodeURIComponent(data[1]);
}else{spare.push(decodeURIComponent(data[1]));}break;}else{spare[path[j]]=!path[j+1]?[]:{};
spare=spare[path[j]];}}}}return obj;};Function.prototype.extend=function(){apf.extend.apply(this,[this].concat(Array.prototype.slice.call(arguments)));
return this;};Function.prototype.bindWithEvent=function(){var __method=this,args=Array.prototype.slice.call(arguments),o=args.shift(),ev=args.shift();
return function(event){if(!event){event=window.event;}if(ev===true){event=new apf.AbstractEvent(event,window);
}return __method.apply(o,[event].concat(args).concat(Array.prototype.slice.call(arguments)));
};};if(!Function.prototype.bind){Function.prototype.bind=function(context){if(typeof this!=="function"){throw new TypeError();
}var _arguments=Array.prototype.slice.call(arguments,1),_this=this,_concat=Array.prototype.concat,_function=function(){return _this.apply(this instanceof _dummy?this:context,_concat.apply(_arguments,arguments));
},_dummy=function(){};_dummy.prototype=_this.prototype;_function.prototype=new _dummy();
return _function;};}Array.prototype.copy=function(){var ar=[];for(var i=0,j=this.length;
i<j;i++){ar[i]=this[i]&&this[i].copy?this[i].copy():this[i];}return ar;};Array.prototype.merge=function(){for(var i=0,k=arguments.length;
i<k;i++){for(var j=0,l=arguments[i].length;j<l;j++){this.push(arguments[i][j]);
}}};Array.prototype.arrayAdd=function(){var s=this.copy();for(var i=0,k=arguments.length;
i<k;i++){for(var j=0,l=s.length;j<l;j++){s[j]+=arguments[i][j];}}return s;};Array.prototype.equals=function(obj){for(var i=0,j=this.length;
i<j;i++){if(this[i]!=obj[i]){return false;}}return true;};Array.prototype.makeUnique=function(){var i,length,newArr=[];
for(i=0,length=this.length;i<length;i++){if(newArr.indexOf(this[i])==-1){newArr.push(this[i]);
}}this.length=0;for(i=0,length=newArr.length;i<length;i++){this.push(newArr[i]);
}return this;};Array.prototype.contains=function(obj,from){return this.indexOf(obj,from)!=-1;
};Array.prototype.indexOf=Array.prototype.indexOf||function(obj,from){var len=this.length;
for(var i=(from<0)?Math.max(0,len+from):from||0;i<len;i++){if(this[i]===obj){return i;
}}return -1;};Array.prototype.lastIndexOf=Array.prototype.lastIndexOf||function(obj,from){var len=this.length;
for(var i=(from>=len)?len-1:(from<0)?from+len:len-1;i>=0;i--){if(this[i]===obj){return i;
}}return -1;};Array.prototype.pushUnique=function(){var item,i=0,l=arguments.length;
for(;i<l;++i){item=arguments[i];if(this.indexOf(item)==-1){this.push(item);}}return this;
};Array.prototype.search=function(){for(var i=0,length=arguments.length;i<length;
i++){if(typeof this[i]!="array"){continue;}for(var j=0;j<length;j++){if(this[i][j]!=arguments[j]){break;
}else{if(j==(length-1)){return this[i];}}}}};Array.prototype.each=Array.prototype.forEach=Array.prototype.forEach||function(fn){for(var i=0,l=this.length;
i<l;i++){fn.call(this,this[i],i,this)===false;}return this;};Array.prototype.remove=function(obj){for(var i=this.length-1;
i>=0;i--){if(this[i]!=obj){continue;}this.splice(i,1);}return this;};Array.prototype.removeIndex=function(i){if(!this.length){return null;
}return this.splice(i,1);};Array.prototype.insertIndex=function(obj,i){this.splice(i,0,obj);
};Array.prototype.invert=Array.prototype.reverse=Array.prototype.reverse||function(){var l=this.length-1;
for(var temp,i=0;i<Math.ceil(0.5*l);i++){temp=this[i];this[i]=this[l-i];this[l-i]=temp;
}return this;};Array.prototype.filter=Array.prototype.filter||function(fn,bind){var results=[];
for(var i=0,l=this.length;i<l;i++){if(fn.call(bind,this[i],i,this)){results.push(this[i]);
}}return results;};Array.prototype.every=Array.prototype.every||function(fn,bind){for(var i=0,l=this.length;
i<l;i++){if(!fn.call(bind,this[i],i,this)){return false;}}return true;};Array.prototype.map=Array.prototype.map||function(fn,bind){var results=[];
for(var i=0,l=this.length;i<l;i++){results[i]=fn.call(bind,this[i],i,this);}return results;
};Array.prototype.some=Array.prototype.some||function(fn,bind){for(var i=0,l=this.length;
i<l;i++){if(fn.call(bind,this[i],i,this)){return true;}}return false;};Number.prototype.toPrettyDigit=Number.prototype.toPrettyDigit||function(){var n=this.toString();
return(n.length==1)?"0"+n:n;};RegExp.prototype.getNativeFlags=function(){return(this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":"");
};RegExp.prototype.addFlags=function(flags){return new RegExp(this.source,(flags||"")+this.getNativeFlags());
};String.prototype.uCaseFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1);
};String.prototype.trim=function(){return this.replace(/[\s\n\r]*$/,"").replace(/^[\s\n\r]*/,"");
};String.prototype.repeat=function(times){return Array(times+1).join(this);};String.prototype.count=function(str){return this.split(str).length-1;
};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"");
};String.prototype.escape=function(){return escape(this);};String.prototype.toXml=function(){var node=apf.getXml("<root>"+this+"</root>");
if(node.childNodes.length==1){return node.childNodes[0];}else{var docFrag=node.ownerDocument.createDocumentFragment(),nodes=node.childNodes;
while(nodes.length){docFrag.appendChild(nodes[0]);}return docFrag;}};if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement=="function"){String.prototype.escapeHTML=function(){this.escapeHTML.text.data=this;
return this.escapeHTML.div.innerHTML;};String.prototype.unescapeHTML=function(){var div=document.createElement("div");
div.innerHTML=this.stripTags();if(div.childNodes[0]){if(div.childNodes.length>1){var out=[];
for(var i=0;i<div.childNodes.length;i++){out.push(div.childNodes[i].nodeValue);
}return out.join("");}else{return div.childNodes[0].nodeValue;}}return"";};String.prototype.escapeHTML.div=document.createElement("div");
String.prototype.escapeHTML.text=document.createTextNode("");String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);
if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=null;}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=null;
}}if(!String.prototype.escapeHTML){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
};}if(!String.prototype.unescapeHTML){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");
};}String.prototype.truncate=function(nr,ellipsis){return this.length>=nr?this.substring(0,nr-(ellipsis?4:1))+(ellipsis?"...":""):this;
};String.prototype.pad=function(len,pad,dir){return dir?(this+Array(len).join(pad)).slice(0,len):(Array(len).join(pad)+this).slice(-len);
};apf.PAD_LEFT=false;apf.PAD_RIGHT=true;String.prototype.splitSafe=function(separator,limit,bLowerCase){return(bLowerCase&&this.toLowerCase()||this).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+separator+"[\\s ]*","g"),limit||999);
};String.prototype.appendRandomNumber=function(length){for(var arr=[],i=1;i<=length;
i++){arr.push(apf.randomGenerator.generate(1,9));}return this.toString()+arr.join("");
};String.prototype.prependRandomNumber=function(length){for(var arr=[],i=1;i<=length;
i++){arr.push(apf.randomGenerator.generate(1,9));}return arr.join("")+this.toString();
};String.prototype.sprintf=function(){var str=this.toString(),i=0,inx=str.indexOf("%s");
while(inx>=0){var replacement=arguments[i++]||" ";str=str.substr(0,inx)+replacement+str.substr(inx+2);
inx=str.indexOf("%s");}return str;};if(!Date.now){Date.now=function now(){return +new Date();
};}apf.flash=(function(){function getControlVersion(){var version,axo;try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
version=axo.GetVariable("$version");}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
version="WIN 6,0,21,0";axo.AllowScriptAccess="always";version=axo.GetVariable("$version");
}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
version="WIN 3,0,18,0";}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
version="WIN 2,0,0,11";}catch(e){version=-1;}}return version;}function getSwfVersion(){var flashVer=-1,sAgent=navigator.userAgent.toLowerCase();
if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",swfDescr=navigator.plugins["Shockwave Flash"+swVer2].description,aDescr=swfDescr.split(" "),aTempMaj=aDescr[2].split("."),nMajor=aTempMaj[0],nMinor=aTempMaj[1],sRev=aDescr[3];
if(sRev==""){sRev=aDescr[4];}if(sRev[0]=="d"){sRev=sRev.substring(1);}else{if(sRev[0]=="r"){sRev=sRev.substring(1);
if(sRev.indexOf("d")>0){sRev=sRev.substring(0,sRev.indexOf("d"));}}}flashVer=nMajor+"."+nMinor+"."+sRev;
}}else{if(sAgent.indexOf("webtv/2.6")!=-1){flashVer=4;}else{if(sAgent.indexOf("webtv/2.5")!=-1){flashVer=3;
}else{if(sAgent.indexOf("webtv")!=-1){flashVer=2;}else{if(apf.isIE&&!apf.isOpera){flashVer=getControlVersion();
}}}}}return flashVer;}function detectFlashVersion(reqMajorVer,reqMinorVer,reqRevision){var versionStr=getSwfVersion();
if(versionStr==-1){return false;}if(versionStr!=0){var aVersions;if(apf.isIE&&!apf.isOpera){var aTemp=versionStr.split(" "),sTemp=aTemp[1];
aVersions=sTemp.split(",");}else{aVersions=versionStr.split(".");}var nMajor=aVersions[0],nMinor=aVersions[1],sRev=aVersions[2];
if(nMajor>parseFloat(reqMajorVer)){return true;}if(nMajor==parseFloat(reqMajorVer)){if(nMinor>parseFloat(reqMinorVer)){return true;
}if(nMinor==parseFloat(reqMinorVer)&&sRev>=parseFloat(reqRevision)){return true;
}}return false;}}function generateObj(objAttrs,params,embedAttrs,stdout){if(stdout=="undefined"){stdout=false;
}var i,str=[];if(apf.isIE&&!apf.isOpera){str.push("<object ");for(i in objAttrs){str.push(i,'="',objAttrs[i],'" ');
}str.push(">");for(i in params){str.push('<param name="',i,'" value="',params[i],'" />');
}str.push("</object>");}else{str.push("<embed ");for(i in embedAttrs){str.push(i,'="',embedAttrs[i],'" ');
}str.push("></embed>");}var sOut=str.join("");if(stdout===true){document.write(sOut);
}return sOut;}function AC_FL_RunContent(options){var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");
return generateObj(ret.objAttrs,ret.params,ret.embedAttrs);}function buildContent(options){var v=isEightAvailable();
if(isAvailable()&&!v){return buildInstaller(options||{});}if(v){return AC_FL_RunContent(options);
}return'This content requires the             <a href="http://www.adobe.com/go/getflash/">Adobe Flash Player</a>.';
}function embed(options){var obj=options.context,node=options.htmlNode,prop=options.property||"$player";
delete options.context,delete options.htmlNode,delete options.property;var content=buildContent(options),cb=function(){$setTimeout(function(){node.innerHTML=content;
obj[prop]=getElement(options.id);$setTimeout(function(){var fail=null;if(!obj[prop]){fail="The Flash movie failed to load. Please check if you're loading the movie on a website running through http://.";
}else{if(!obj[prop].parentNode){fail="The movie has to be enabled manually because of Flashblock. No browser refresh is required.";
}else{if(obj[prop].style.display=="none"){fail="Adblock Plus blocks or hides the movie. Please enable it and refresh your browser.";
}else{if(!obj[prop].offsetWidth){fail="The Flash movie failed to load. Please check if the file exists and the path is correct.";
}}}}if(fail){apf.console.error(fail,"flash");if(options.onError){options.onError({message:fail});
}else{obj.dispatchEvent("error",{message:fail});}}},1000);},200);};return apf.loaded?cb():apf.addEventListener("load",cb);
}function buildInstaller(options){if(!options){options={};}var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash"),MMPlayerType=(apf.isIE==true)?"ActiveX":"PlugIn",MMredirectURL=window.location;
document.title=document.title.slice(0,47)+" - Flash Player Installation";var MMdoctitle=document.title;
return AC_FL_RunContent({src:"playerProductInstall",FlashVars:"MMredirectURL="+MMredirectURL+"&MMplayerType="+MMPlayerType+"&MMdoctitle="+MMdoctitle+"",width:"100%",height:"100%",align:"middle",id:ret.embedAttrs.name,quality:"high",bgcolor:"#000000",name:ret.embedAttrs.name,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer"});
}var sSrc="src|movie",sObj="onafterupdate|onbeforeupdate|onblur|oncellchange|onclick|ondblclick|ondrag|ondragend|ondragenter|ondragleave|ondragover|ondrop|onfinish|onfocus|onhelp|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup|onload|onlosecapture|onpropertychange|onreadystatechange|onrowsdelete|onrowenter|onrowexit|onrowsinserted|onstart|onscroll|onbeforeeditfocus|onactivate|onbeforedeactivate|ondeactivate|type|codebase|id",sEmb="width|height|align|vspace|hspace|class|title|accesskey|name|tabindex";
function AC_GetArgs(options,srcParamName,classid,mimeType){var i,name,ret={embedAttrs:{},params:{},objAttrs:{}};
for(i in options){name=i.toLowerCase();if(name=="classid"){continue;}if(name=="pluginspage"){ret.embedAttrs[i]=options[i];
}else{if(sSrc.indexOf(name)>-1){ret.embedAttrs.src=options[i];ret.params[srcParamName]=options[i];
}else{if(sObj.indexOf(name)>-1){ret.objAttrs[i]=options[i];}else{if(sEmb.indexOf(name)>-1){ret.embedAttrs[i]=ret.objAttrs[i]=options[i];
}else{ret.embedAttrs[i]=ret.params[i]=options[i];}}}}}ret.objAttrs.classid=classid;
if(mimeType){ret.embedAttrs.type=mimeType;}return ret;}function getElement(id){var elem;
if(typeof id=="object"){return id;}if(apf.isIE){return self[id];}else{elem=document[id]?document[id]:document.getElementById(id);
if(!elem){elem=apf.lookup(id);}return elem;}}var hash={},uniqueID=1;function addPlayer(player){hash[++uniqueID]=player;
return uniqueID;}function getPlayer(id){return hash[id];}function callMethod(id,methodName){var player=hash[id];
if(player==null){throw new Error(apf.formatErrorString(0,this,"Player with id: "+id+" not found"));
}if(player[methodName]==null){throw new Error(apf.formatErrorString(0,this,"Method "+methodName+" Not found"));
}apf.console.info("[FLASH] received method call for player '"+id+"', '"+methodName+"'");
var args=[],i=2,l=arguments.length;for(;i<l;i++){args.push(decode(arguments[i]));
}player[methodName].apply(player,args);}function remote(o,fn){if(typeof o=="string"){o=hash[o];
}var rs=o.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");
return eval(rs);}function encode(data){if(!data||typeof data!="string"){return data;
}return data.replace(/\&([^;]*)\;/g,"&amp;$1;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("\\","&custom_backslash;").replace(/\0/g,"\\0").replace(/\"/g,"&quot;");
}function decode(data){if(data&&data.length&&typeof data!="string"){data=data[0];
}if(!data||typeof data!="string"){return data;}return data.replace(/\&custom_lt\;/g,"<").replace(/\&custom_gt\;/g,">").replace(/\&custom_backslash\;/g,"\\").replace(/\\0/g,"\0");
}var aIsAvailable={};function isAvailable(sVersion){if(typeof sVersion!="string"){sVersion="6.0.65";
}var aVersion=sVersion.split(".");while(aVersion.length<3){aVersion.push("0");}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=detectFlashVersion(parseInt(aVersion[0]),parseInt(aVersion[1]),parseInt(aVersion[2]));
}return aIsAvailable[sVersion];}function isEightAvailable(){return isAvailable("8.0.0");
}var oSandboxTypes={remote:"remote (domain-based) rules",localwithfile:"local with file access (no internet access)",localwithnetwork:"local with network (internet access only, no local access)",localtrusted:"local, trusted (local + internet access)"};
function getSandbox(sType){var oSandbox={type:null,description:null,noRemote:false,noLocal:false,error:null};
oSandbox.type=sType.toLowerCase();oSandbox.description=oSandboxTypes[(typeof oSandboxTypes[oSandbox.type]!="undefined"?oSandbox.type:"unknown")];
if(oSandbox.type=="localwithfile"){oSandbox.noRemote=true;oSandbox.noLocal=false;
oSandbox.error="Flash security note: Network/internet URLs will not                                  load due to security restrictions.                                 Access can be configured via Flash Player Global Security                                 Settings Page:                                  http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html";
}else{if(oSandbox.type=="localwithnetwork"){oSandbox.noRemote=false;oSandbox.noLocal=true;
}else{if(oSandbox.type=="localtrusted"){oSandbox.noRemote=false;oSandbox.noLocal=false;
}}}return oSandbox;}return{isAvailable:isAvailable,isEightAvailable:isEightAvailable,buildContent:buildContent,embed:embed,encode:encode,decode:decode,getElement:getElement,addPlayer:addPlayer,getPlayer:getPlayer,callMethod:callMethod,getSandbox:getSandbox,remote:remote};
})();apf.hotkeys={};(function(){var keyMods={ctrl:1,alt:2,option:2,shift:4,meta:8,command:8};
this.keyNames={"8":"Backspace","9":"Tab","13":"Enter","27":"Esc","32":"Space","33":"PageUp","34":"PageDown","35":"End","36":"Home","37":"Left","38":"Up","39":"Right","40":"Down","45":"Insert","46":"Del","107":"+","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12","188":",","219":"[","221":"]"};
var macUnicode={meta:"\u2318",command:"\u2318",alt:"\u2325",option:"\u2325",shift:"\u21E7",esc:"\u238B",control:"\u2303",backspace:"\u232B",del:"\u2326",enter:"\u21A9"};
var macUnicodeHtml={meta:"&#8984;",command:"&#8984;",alt:"&#8997;",option:"&#8997;",shift:"&#8679;",esc:"&#9099;",control:"&#2303;",backspace:"&#232B;",del:"&#2326;",enter:"&#21A9;"};
this.$keys={};var _self=this,trace=0;function register(hotkey,handler){var key,hashId=0,keys=hotkey.splitSafe("\\-",null,true),i=0,l=keys.length;
for(;i<l;++i){if(keyMods[keys[i]]){hashId=hashId|keyMods[keys[i]];}else{key=keys[i]||"-";
}}if(!hashId){console.warn("missing modifier keys for hotkey: "+hotkey);}if(!key){throw new Error("missing key for hotkey: "+hotkey);
}if(!_self.$keys[hashId]){_self.$keys[hashId]={};}_self.$keys[hashId][key]=handler;
}apf.registerHotkey=this.register=function(hotkey,handler){var parts=hotkey.split("|"),i=0,l=parts.length;
for(;i<l;++i){register(parts[i],handler);}};this.$exec=function(eInfo){var hashId=0|(eInfo.ctrlKey?1:0)|(eInfo.altKey?2:0)|(eInfo.shiftKey?4:0)|(eInfo.metaKey?8:0),code=eInfo.keyCode;
var key=_self.keyNames[code]||(code&&code>46&&code!=91?String.fromCharCode(code):null);
if(!hashId||!key){return;}if(_self.$keys[hashId]&&(handler=_self.$keys[hashId][key.toLowerCase()])){handler(eInfo.htmlEvent);
eInfo.returnValue=false;apf.queue.empty();}return eInfo.returnValue;};apf.removeHotkey=this.remove=this.unregister=function(hotkey){var parts=hotkey.split("|"),i=0,l=parts.length;
for(;i<l;++i){register(parts[i],null);}};function toMacNotation(hotkey,bHtml){var t,keys=hotkey.splitSafe("\\-"),i=0,l=keys.length;
for(;i<l;++i){if(!keys[i]){continue;}if(t=(bHtml?macUnicodeHtml:macUnicode)[keys[i].toLowerCase()]){keys[i]=t;
}}return keys.join(" ");}this.toMacNotation=function(hotkey,bHtml){var parts=hotkey.split("|"),i=0,l=parts.length,res=[];
for(;i<l;++i){res.push(toMacNotation(parts[i],bHtml));}return res.join(" | ");};
apf.addEventListener("keydown",function(eInfo){var e=eInfo.htmlEvent;if(
/*eInfo.isTextInput && */
_self.$exec(eInfo)===false||eInfo.returnValue===false){apf.stopEvent(e);
if(apf.canDisableKeyCodes){try{e.keyCode=0;}catch(e){}}return false;}var keys=[];
if(e.altKey){keys.push("Alt");}if(e.ctrlKey){keys.push("Ctrl");}if(e.shiftKey){keys.push("Shift");
}if(e.metaKey){keys.push("Meta");}if(_self.keyNames[e.keyCode]){keys.push(_self.keyNames[e.keyCode]);
}if(keys.length){if(e.keyCode>46&&!_self.keyNames[e.keyCode]){keys.push(String.fromCharCode(e.keyCode));
}apf.setProperty("hotkey",keys.join("-"));}});}).call(apf.hotkeys);apf.iepngfix=(function(){var sNodes=null,aNodes=null,applyPositioning=true,shim,fnLoadPngs=function(){if(!shim){shim=apf.skins.skins["default"].mediaPath+"/blank.gif";
}if(aNodes===null){if(sNodes){aNodes=sNodes.splitSafe(",");}else{aNodes=[document];
}}function fixMe(obj){if(obj.currentStyle.backgroundImage.match(/\.png/i)!==null){bg_fnFixPng(obj);
}if(obj.tagName=="IMG"&&obj.src.match(/\.png$/i)!==null){el_fnFixPng(obj);}if(applyPositioning&&(obj.tagName=="A"||obj.tagName=="INPUT")&&obj.style.position===""){obj.style.position="relative";
}}for(var j=0,l=aNodes.length,node;j<l;j++){if(typeof aNodes[j]=="string"){aNodes[j]=document.getElementById(aNodes[j]);
}node=aNodes[j];if(!node){continue;}if(node!=document){fixMe(node);}for(var i=node.all.length-1,obj=null;
(obj=node.all[i]);i--){fixMe(obj);}}},bg_fnFixPng=function(obj){var mode="scale",bg=obj.currentStyle.backgroundImage,src=bg.substring(5,bg.length-2);
if(obj.currentStyle.backgroundRepeat=="no-repeat"){mode="crop";}obj.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='"+mode+"')";
obj.style.backgroundImage="url("+shim+")";},el_fnFixPng=function(img){var src=img.src;
img.style.width=img.width+"px";img.style.height=img.height+"px";img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')";
img.src=shim;};return{limitTo:function(s){sNodes=s;return this;},run:fnLoadPngs};
})();apf.json2xml_Obj={};apf.json2xml_Attr={};apf.json2xml_ObjByAttr={};apf.json2Xml=(function(){var jsonToXml=function(v,name,xml,notag){var i,n,m,t;
function cleanString(s){return s.replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;");
}if(!notag){if(name!=(m=name.replace(/[^a-zA-Z0-9_-]/g,"_"))){apf.console.warn("Json2XML, invalid characters found in JSON tagname '"+name,"json2Xml");
}name=m;}if(apf.isArray(v)){for(i=0,n=v.length;i<n;i++){jsonToXml(v[i],name,xml);
}}else{if(typeof v=="object"){var hasChild=false,objAttr=null;if(!notag){xml.push("<",name);
}for(i in v){if((n=apf.json2xml_Attr[i])||i.charAt(0)=="@"){if(!n&&!objAttr){objAttr=apf.json2xml_ObjByAttr[i.slice(1)];
}if(!notag){xml.push(" ",n?n:i.slice(1),'="',cleanString(v[i].toString()),'"');
}}else{hasChild=true;}}if(hasChild){if(!notag){xml.push(">");}if(t=(objAttr||apf.json2xml_Obj[name])){if(t==1){t={child:name.replace(/(.*)s$/,"$1")||name,key:"name",value:"value"};
}for(i in v){if(i.charAt(0)!="@"&&!apf.json2xml_Attr[i]){if(typeof(m=v[i])=="object"){if(apf.json2xml_Obj[i]){jsonToXml(m,i,xml);
}else{xml.push("<",t.child," ",t.key,'="',cleanString(i.toString()),'" >');jsonToXml(m,i,xml,true);
xml.push("</",t.child,">\n");}}else{xml.push("<",t.child," ",t.key,'="',i,'" ');
if(t.value){if(t.value==1){xml.push("/>");}else{xml.push(t.value,'="',cleanString(v[i].toString()),'"/>');
}}else{xml.push(">",cleanString(v[i].toString()),"</",t.child,">");}}}}if(!notag){xml.push("</",name,">\n");
}}else{for(i in v){if(!apf.json2xml_Attr[i]&&i.charAt(0)!="@"){if(i.match(/[^a-zA-Z0-9_-]/g)){apf.console.warn("Json2XML, invalid characters found in JSON tagname: '"+i,"json2Xml");
}else{jsonToXml(v[i],i,xml,false);}}}if(!notag){xml.push("</",name,">");}}}else{if(!notag){xml.push("/>");
}}}else{if(!notag){xml.push("<",name,">",cleanString(v.toString()),"</",name,">");
}else{xml.push(cleanString(v.toString()));}}}};return function(strJson,noError,preserveWhiteSpace){var o=(typeof strJson=="string"&&apf.isJson(strJson))?JSON.parse(strJson.replace(/""/g,'" "')):strJson,xml=[],i;
jsonToXml(o,"jsondoc",xml,false);return apf.getXmlDom(xml.join("").replace(/\t|\n/g,""),noError,true);
};})();apf.xml2json=function(xml,noattrs){var filled,out={},o,nodes=xml.childNodes,cn,i,j,n,m,u,v,w,s,t,cn1,u1,v1,t1,name;
if(!noattrs){if(m=(xml.attributes)){for(u=0,v=m.length;u<v;u++){t=apf.json2xml_Attr[w=m[u].nodeName]||("@"+w);
if(t.indexOf("@a_")!=0){out[t]=m[u].nodeValue,filled=true;}}}}for(var i=0,j=nodes.length;
i<j;i++){if((n=nodes[i]).nodeType!=1){continue;}name=n.tagName;filled=true;t=s=null,o={};
if(m=(n.attributes)){for(u=0,v=m.length;u<v;u++){o["@"+(w=m[u].nodeName)]=m[u].nodeValue;
if(!s){s=apf.json2xml_ObjByAttr[w];}}}if(t=s||apf.json2xml_Obj[name]){if(t==1){t={key:"name",value:"value"};
}for(cn=n.childNodes,u=0,v=cn.length;u<v;u++){if((s=cn[u]).nodeType!=1){continue;
}if(t1=apf.json2xml_Obj[s.nodeName]){var o2={};for(cn1=s.childNodes,u1=0,v1=cn1.length;
u1<v1;u1++){if((s1=cn1[u1]).nodeType!=1){continue;}if(w=s1.getAttribute(t1.key)){o2[w]=(t1.value==1?(s1.childNodes.length?apf.xml2json(s1,1):1):(s1.getAttribute(t1.value||"value"))||apf.xml2json(s1,1));
}}o[s.nodeName]=o2;}else{if(w=s.getAttribute(t.key)){o[w]=(t.value==1?(s.childNodes.length?apf.xml2json(s,1):1):(s.getAttribute(t.value||"value"))||apf.xml2json(s,1));
}}}}else{o=apf.xml2json(n);}if(out[name]!==undefined){if((s=out[name]).dataType!=apf.ARRAY){out[name]=[s,o];
}else{out[name].push(o);}}else{out[name]=o;}}return filled?out:apf.queryValue(xml,"text()");
};apf.isJson=(function(){var escapes=/\\["\\\/bfnrtu@]/g,values=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,brackets=/(?:^|:|,)(?:\s*\[)+/g,invalid=/^[\],:{}\s]*$/;
return function(value){if(!value){return false;}return invalid.test(value.replace(escapes,"@").replace(values,"]").replace(brackets,""));
};})();if(!self.JSON){if(!this.JSON){this.JSON={};}(function(){function f(n){return n<10?"0"+n:n;
}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;
};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();
};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];
return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];
if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);
}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);
case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;
for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;
i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);
if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;
gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";
}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");
}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);
}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");
};}}());}apf.serialize=function(o){return self.JSON.stringify(o);};apf.unserialize=function(str){if(!str){return str;
}return self.JSON.parse(str);};apf.nameserver={lookup:{},add:function(type,item){if(!this.lookup[type]){this.lookup[type]=[];
}if(this.onchange){this.onchange(type,item);}return this.lookup[type].push(item)-1;
},register:function(type,id,item){if(!this.lookup[type]){this.lookup[type]={};}if(this.onchange){this.onchange(type,item,id);
}if(this.waiting[id]){var list=this.waiting[id];for(var i=0;i<list.length;i++){list[i]();
}delete this.waiting[id];}return(this.lookup[type][id]=item);},waiting:{},waitFor:function(name,callback){(this.waiting[name]||(this.waiting[name]=[])).push(callback);
},remove:function(type,item){var list=this.lookup[type];if(list){for(var prop in list){if(list[prop]==item){delete list[prop];
}}}},get:function(type,id){return this.lookup[type]?this.lookup[type][id]:null;
},getAll:function(type){var name,arr=[],l=this.lookup[type];if(!l){return arr;}if(l.dataType==apf.ARRAY){for(var i=0;
i<l.length;i++){arr.push(l[i]);}}else{for(name in l){if(apf.isSafariOld&&(!l[name]||typeof l[name]!="object")){continue;
}arr.push(l[name]);}}return arr;},getAllNames:function(type){var name,arr=[];for(name in this.lookup[type]){if(parseInt(name)==name){continue;
}arr.push(name);}return arr;}};apf.registry=apf.extend({put:function(key,value,namespace){this.register(namespace,key,value);
},getNamespaces:function(){},getKeys:function(namespace){return this.getAllNames(namespace);
},remove:function(key,namespace){delete this.lookup[namespace][key];},clear:function(namespace){this.lookup={};
},$export:function(storage){var namespace,key;for(namespace in this.lookup){for(key in this.lookup[namespace]){storage.put(key,this.lookup[key][namespace],namespace);
}}}},apf.nameserver);apf.registry.lookup={};apf.registry.get=function(key,namespace){return this.lookup[namespace]?this.lookup[namespace][key]:null;
};apf.Init.run("nameserver");apf.plane={$set:[],$lookup:{},$find:function(id){if(this.$lookup[id]){return this.$lookup[id];
}var item=this.$set.pop();if(!item){item=this.$factory();}this.$lookup[id]=item;
return item;},get:function(options){return this.$find(options&&options.protect||"default");
},show:function(o,reAppend,copyCursor,useRealSize,options){var item=this.$find(options&&options.protect||"default");
item.show(o,reAppend,copyCursor,useRealSize,options);},hide:function(protect,noAnim){var item=this.$lookup[protect||"default"];
if(item){item.hide(noAnim);delete this.$lookup[protect||"default"];this.$set.push(item);
}},$factory:function(){var plane=document.body.appendChild(document.createElement("DIV"));
plane.style.background="url(images/spacer.gif)";plane.style.position="fixed";plane.style.left=0;
plane.style.top=0;plane.host=false;return{host:this,plane:plane,lastCursor:null,show:function(o,reAppend,copyCursor,useRealSize,options){var plane=this.plane;
this.plane.style.background=options&&options.color||"url(images/spacer.gif)";this.animate=options&&options.animate;
this.protect=options&&options.protect;if(this.protect){apf.setProperty("planes",(apf.planes||0)+1);
}if(o){this.current=o;if(reAppend){this.$originalPlace=[o.parentNode,o.nextSibling];
this.plane.appendChild(o);}}apf.window.zManager.set("plane",this.plane,!reAppend&&o);
useRealSize=apf.isIE;var pWidth=(plane.parentNode==document.body?useRealSize?document.documentElement.offsetWidth:apf.getWindowWidth():plane.parentNode.offsetWidth);
var pHeight=(plane.parentNode==document.body?useRealSize?document.documentElement.offsetHeight:apf.getWindowHeight():plane.parentNode.offsetHeight);
if(copyCursor){if(this.lastCursor===null){this.lastCursor=document.body.style.cursor;
}document.body.style.cursor=apf.getStyle(o,"cursor");}this.plane.style.display="block";
var toOpacity=parseFloat(options&&options.opacity)||1;if(this.animate){var _self=this;
apf.setOpacity(this.plane,0);setTimeout(function(){apf.tween.single(_self.plane,{steps:5,interval:10,type:"fade",from:0,to:toOpacity});
},100);}else{apf.setOpacity(this.plane,toOpacity);}var diff=apf.getDiff(plane);
this.plane.style.width="100%";this.plane.style.height="100%";return plane;},hide:function(noAnim){if(this.protect){apf.setProperty("planes",apf.planes-1);
}var isChild;try{isChild=apf.isChildOf(this.plane,document.activeElement);}catch(ex){isChild=false;
}if(this.current&&this.current.parentNode==this.plane){this.$originalPlace[0].insertBefore(this.current,this.$originalPlace[1]);
}if(this.animate&&!noAnim){var _self=this;setTimeout(function(){apf.tween.single(_self.plane,{steps:5,interval:10,type:"fade",from:apf.getOpacity(_self.plane),to:0,onfinish:function(){_self.plane.style.display="none";
if(_self.current){apf.window.zManager.clear(_self.current);}}});},100);}else{apf.setOpacity(this.plane,0);
if(this.current){apf.window.zManager.clear(this.plane,this.current);}this.plane.style.display="none";
}if(isChild&&apf.document.activeElement){if(!apf.isIE){document.activeElement.focus();
}apf.document.activeElement.$focus();}this.current=null;if(this.lastCursor!==null){document.body.style.cursor=this.lastCursor;
this.lastCursor=null;}return this.plane;}};}};apf.popup={cache:{},focusFix:{INPUT:1,TEXTAREA:1,SELECT:1},setContent:function(cacheId,content,style,width,height){if(!this.popup){this.init();
}this.cache[cacheId]={content:content,style:style,width:width,height:height};content.style.position="absolute";
content.onmousedown=function(e){if(!e){e=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(e.srcElement||e.target).tagName]){apf.window.$focusfix();
}};return content.ownerDocument;},removeContent:function(cacheId){this.cache[cacheId]=null;
delete this.cache[cacheId];},init:function(){this.popup={};apf.addEventListener("hotkey",function(e){if(e.keyCode=="27"||e.altKey){apf.popup.forceHide();
}});},show:function(cacheId,options){if(!this.popup){this.init();}options=apf.extend({x:0,y:0,animate:false,ref:null,width:null,height:null,callback:null,draggable:false,resizable:false,allowTogether:false,autoCorrect:true,noleft:false},options);
if((!options.allowTogether||options.allowTogether!==true&&options.allowTogether!=this.last)&&this.last!=cacheId&&this.cache[this.last]&&(!this.cache[this.last].options||this.cache[this.last].options.autohide!==false)){this.hide();
}var o=this.cache[cacheId];o.options=options;var dp,popup=o.content,moveUp=false,fixed=false;
apf.window.zManager.set("popup",o.content);if((dp=o.content.style.display)&&dp.indexOf("none")>-1){o.content.style.display="";
}var x=options.x;var y=options.y;var refNode=options.ref;while(refNode&&refNode.nodeType==1){if(fixed=apf.getStyle(refNode,"position")=="fixed"){break;
}refNode=refNode.parentNode||refNode.$parentNode;}if(!fixed){if(refNode){var pos=apf.getAbsolutePosition(options.ref,o.content.offsetParent||o.content.parentNode);
x=(x||0)+pos[0];y=(y||0)+pos[1];}if(options.width||o.width){popup.style.width=((options.width||o.width)-3)+"px";
}popup.style.position="absolute";var pOverflow=apf.getOverflowParent(o.content);
var edgeY=(pOverflow==document.documentElement?(apf.isIE?pOverflow.offsetHeight:(window.innerHeight+window.pageYOffset))+pOverflow.scrollTop:pOverflow.offsetHeight+pOverflow.scrollTop);
moveUp=options.autoCorrect&&(y+(options.height||o.height||o.content.offsetHeight))>edgeY;
if(moveUp){var value;if(refNode){value=(pos[1]-(options.height||o.height||o.content.offsetHeight));
}else{value=(edgeY-(options.height||o.height||o.content.offsetHeight));}popup.style.top=value<0?y:value+"px";
}else{popup.style.top=y+"px";}if(!options.noleft){var edgeX=(pOverflow==document.documentElement?(apf.isIE?pOverflow.offsetWidth:(window.innerWidth+window.pageXOffset))+pOverflow.scrollLeft:pOverflow.offsetWidth+pOverflow.scrollLeft);
moveLeft=options.autoCorrect&&(x+(options.width||o.width||o.content.offsetWidth))>edgeX;
if(moveLeft){var value=(edgeX-(options.width||o.width||o.content.offsetWidth));
popup.style.left=value<0?x:value+"px";}else{popup.style.left=x+"px";}}}else{pos=apf.getAbsolutePosition(options.ref,refNode);
y=(y||0)+pos[1]+refNode.offsetTop;pos[0]+=refNode.offsetLeft;popup.style.position="fixed";
popup.style.top=y+"px";if(!options.noleft){popup.style.left=x+"px";}}apf.setStyleClass(popup,moveUp?"upward":"downward",[moveUp?"downward":"upward"]);
if(options.animate){if(options.animate=="fade"){apf.tween.single(popup,{type:"fade",from:0,to:1,anim:apf.tween.NORMAL,steps:options.steps||15*apf.animSteps});
}else{var iVal,steps=apf.isIE8?5:7,i=0;iVal=setInterval(function(){var value=++i*((options.height||o.height)/steps);
popup.style.height=value+"px";if(moveUp){popup.style.top=(y-value-(options.y||0))+"px";
}else{(options.container||popup).scrollTop=-1*(i-steps)*((options.height||o.height)/steps);
}popup.style.display="block";if(i>=steps){clearInterval(iVal);if(options.callback){options.callback(popup);
}}},10);}}else{if(!refNode){if(options.height||o.height){popup.style.height=(options.height||o.height)+"px";
}popup.style.top=y+"px";}popup.style.display="block";if(options.callback){options.callback(popup);
}}$setTimeout(function(){apf.popup.last=cacheId;});if(options.draggable){options.id=cacheId;
this.makeDraggable(options);}},hide:function(){if(this.isDragging){return;}var o=this.cache[this.last];
if(o){if(o.content){o.content.style.display="none";}if(o.options&&o.options.onclose){o.options.onclose(apf.extend(o.options,{htmlNode:o.content}));
o.options.onclose=false;}}},isShowing:function(cacheId){return this.last&&this.last==cacheId&&this.cache[this.last]&&this.cache[this.last].content.style.display!="none";
},isDragging:false,makeDraggable:function(options){if(!apf.Interactive||this.cache[options.id].draggable){return;
}var oHtml=this.cache[options.id].content;this.cache[options.id].draggable=true;
var o={$propHandlers:{},minwidth:10,minheight:10,maxwidth:10000,maxheight:10000,dragOutline:false,resizeOutline:false,draggable:true,resizable:options.resizable,$ext:oHtml,oDrag:oHtml.firstChild};
oHtml.onmousedown=oHtml.firstChild.onmousedown=function(e){if(!e){e=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(e.srcElement||e.target).tagName]){apf.window.$focusfix();
}(e||event).cancelBubble=true;};apf.implement.call(o,apf.Interactive);o.$propHandlers.draggable.call(o,true);
o.$propHandlers.resizable.call(o,true);},getCurrentElement:function(){return typeof this.last=="number"&&apf.lookup(this.last);
},forceHide:function(){if(this.last&&!apf.plane.current&&this.isShowing(this.last)&&this.cache[this.last]&&this.cache[this.last].options&&this.cache[this.last].options.autohide!==false){var o=apf.lookup(this.last);
if(!o){this.last=null;}else{if(o.dispatchEvent("popuphide")!==false){this.hide();
}}}},destroy:function(){for(var cacheId in this.cache){if(this.cache[cacheId]){this.cache[cacheId].content.onmousedown=null;
apf.destroyHtmlNode(this.cache[cacheId].content);this.cache[cacheId].content=null;
this.cache[cacheId]=null;}}if(!this.popup){return;}}};apf.silverlight=(function(){var silverlightCount=0;
var __onSilverlightInstalledCalled=false;var fwlinkRoot="http://go2.microsoft.com/fwlink/?LinkID=";
var __installationEventFired=false;var onGetSilverlight=null;function onSilverlightInstalled(){window.location.reload(false);
}function isInstalled(version){if(version==undefined){version=null;}var isVersionSupported=false;
var container=null;try{var control=null;var tryNS=false;if(window.ActiveXObject){try{control=new ActiveXObject("AgControl.AgControl");
if(version===null){isVersionSupported=true;}else{if(control.IsVersionSupported(version)){isVersionSupported=true;
}}control=null;}catch(e){tryNS=true;}}else{tryNS=true;}if(tryNS){var plugin=navigator.plugins["Silverlight Plug-In"];
if(plugin){if(version===null){isVersionSupported=true;}else{var actualVer=plugin.description;
if(actualVer==="1.0.30226.2"){actualVer="2.0.30226.2";}var actualVerArray=actualVer.split(".");
while(actualVerArray.length>3){actualVerArray.pop();}while(actualVerArray.length<4){actualVerArray.push(0);
}var reqVerArray=version.split(".");while(reqVerArray.length>4){reqVerArray.pop();
}var requiredVersionPart;var actualVersionPart;var index=0;do{requiredVersionPart=parseInt(reqVerArray[index]);
actualVersionPart=parseInt(actualVerArray[index]);index++;}while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);
if(requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)){isVersionSupported=true;
}}}}}catch(e){isVersionSupported=false;}return isVersionSupported;}function WaitForInstallCompletion(){if(!apf.silverlight.isBrowserRestartRequired&&onSilverlightInstalled){try{navigator.plugins.refresh();
}catch(e){}if(isInstalled(null)&&!__onSilverlightInstalledCalled){onSilverlightInstalled();
__onSilverlightInstalledCalled=true;}else{$setTimeout(WaitForInstallCompletion,3000);
}}}function startup(){navigator.plugins.refresh();apf.silverlight.isBrowserRestartRequired=isInstalled(null);
if(!apf.silverlight.isBrowserRestartRequired){WaitForInstallCompletion();if(!__installationEventFired){onInstallRequired();
__installationEventFired=true;}}else{if(window.navigator.mimeTypes){var mimeSL2=navigator.mimeTypes["application/x-silverlight-2"];
var mimeSL2b2=navigator.mimeTypes["application/x-silverlight-2-b2"];var mimeSL2b1=navigator.mimeTypes["application/x-silverlight-2-b1"];
var mimeHighestBeta=mimeSL2b1;if(mimeSL2b2){mimeHighestBeta=mimeSL2b2;}if(!mimeSL2&&(mimeSL2b1||mimeSL2b2)){if(!__installationEventFired){onUpgradeRequired();
__installationEventFired=true;}}else{if(mimeSL2&&mimeHighestBeta){if(mimeSL2.enabledPlugin&&mimeHighestBeta.enabledPlugin){if(mimeSL2.enabledPlugin.description!=mimeHighestBeta.enabledPlugin.description){if(!__installationEventFired){onRestartRequired();
__installationEventFired=true;}}}}}}}}function createObject(source,parentElement,id,properties,events,initParams,userContext){var slPluginHelper={},slProperties=properties,slEvents=events;
slPluginHelper.version=slProperties.version;slProperties.source=source;slPluginHelper.alt=slProperties.alt;
if(initParams){slProperties.initParams=initParams;}if(slProperties.isWindowless&&!slProperties.windowless){slProperties.windowless=slProperties.isWindowless;
}if(slProperties.framerate&&!slProperties.maxFramerate){slProperties.maxFramerate=slProperties.framerate;
}if(id&&!slProperties.id){slProperties.id=id;}delete slProperties.ignoreBrowserVer;
delete slProperties.inplaceInstallPrompt;delete slProperties.version;delete slProperties.isWindowless;
delete slProperties.framerate;delete slProperties.data;delete slProperties.src;
delete slProperties.alt;var slPluginHTML;if(isInstalled(slPluginHelper.version)){for(var name in slEvents){if(slEvents[name]){if(name=="onLoad"&&typeof slEvents[name]=="function"&&slEvents[name].length!=1){var onLoadHandler=slEvents[name];
slEvents[name]=function(sender){return onLoadHandler(document.getElementById(id),userContext,sender);
};}var handlerName=__getHandlerName(slEvents[name]);if(handlerName!=null){slProperties[name]=handlerName;
slEvents[name]=null;}else{throw"typeof events."+name+" must be 'function' or 'string'";
}}}slPluginHTML=buildHTML(slProperties);}else{slPluginHTML=buildPromptHTML(slPluginHelper);
}if(parentElement){parentElement.innerHTML=slPluginHTML;}else{return slPluginHTML;
}}function buildHTML(slProperties){var htmlBuilder=[];htmlBuilder.push('<object type="application/x-silverlight" data="data:application/x-silverlight,"');
if(slProperties.id!=null){htmlBuilder.push(' id="'+HtmlAttributeEncode(slProperties.id)+'"');
}if(slProperties.width!=null){htmlBuilder.push(' width="'+slProperties.width+'"');
}if(slProperties.height!=null){htmlBuilder.push(' height="'+slProperties.height+'"');
}htmlBuilder.push(" >");delete slProperties.id;delete slProperties.width;delete slProperties.height;
for(var name in slProperties){if(slProperties[name]){htmlBuilder.push('<param name="'+HtmlAttributeEncode(name)+'" value="'+HtmlAttributeEncode(slProperties[name])+'" />');
}}htmlBuilder.push("</object>");return htmlBuilder.join("");}function createObjectEx(params){var parameters=params;
var html=createObject(parameters.source,parameters.parentElement,parameters.id,parameters.properties,parameters.events,parameters.initParams,parameters.context);
if(parameters.parentElement==null){return html;}}function buildPromptHTML(slPluginHelper){var slPluginHTML="";
var urlRoot=fwlinkRoot;var version=slPluginHelper.version;if(slPluginHelper.alt){slPluginHTML=slPluginHelper.alt;
}else{if(!version){version="";}slPluginHTML="<a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a>";
slPluginHTML=slPluginHTML.replace("{1}",version);slPluginHTML=slPluginHTML.replace("{2}",urlRoot+"108181");
}return slPluginHTML;}function getSilverlight(version){if(onGetSilverlight){onGetSilverlight();
}var shortVer="";var reqVerArray=String(version).split(".");if(reqVerArray.length>1){var majorNum=parseInt(reqVerArray[0]);
if(isNaN(majorNum)||majorNum<2){shortVer="1.0";}else{shortVer=reqVerArray[0]+"."+reqVerArray[1];
}}var verArg="";if(shortVer.match(/^\d+\056\d+$/)){verArg="&v="+shortVer;}followFWLink("114576"+verArg);
}function followFWLink(linkid){top.location=fwlinkRoot+String(linkid);}function HtmlAttributeEncode(strInput){var c;
var retVal="";if(strInput==null){return null;}for(var cnt=0;cnt<strInput.length;
cnt++){c=strInput.charCodeAt(cnt);if(((c>96)&&(c<123))||((c>64)&&(c<91))||((c>43)&&(c<58)&&(c!=47))||(c==95)){retVal=retVal+String.fromCharCode(c);
}else{retVal=retVal+"&#"+c+";";}}return retVal;}function default_error_handler(sender,args){var iErrorCode;
var errorType=args.ErrorType;iErrorCode=args.ErrorCode;var errMsg=["\nSilverlight error message     \n          ErrorCode: ",iErrorCode,"\n          ErrorType: ",errorType,"       \n          Message: ",args.ErrorMessage,"     \n"];
if(errorType=="ParserError"){errMsg.push("XamlFile: ",args.xamlFile,"     \n              Line: ",args.lineNumber,"     \n              Position: ",args.charPosition,"     \n");
}else{if(errorType=="RuntimeError"){if(args.lineNumber!=0){errMsg.push("Line: ",args.lineNumber,"     \n                    Position: ",args.charPosition,"     \n");
}errMsg.push("MethodName: ",args.methodName,"     \n");}}throw new Error(apf.formatErrorString(0,this,errMsg.join("")));
}function __cleanup(){for(var i=silverlightCount-1;i>=0;i--){window["__slEvent"+i]=null;
}silverlightCount=0;if(window.removeEventListener){window.removeEventListener("unload",__cleanup,false);
}else{window.detachEvent("onunload",__cleanup);}}function __getHandlerName(handler){var handlerName="";
if(typeof handler=="string"){handlerName=handler;}else{if(typeof handler=="function"){if(silverlightCount==0){if(window.addEventListener){window.addEventListener("onunload",__cleanup,false);
}else{window.attachEvent("onunload",__cleanup);}}var count=silverlightCount++;handlerName="__slEvent"+count;
window[handlerName]=handler;}else{handlerName=null;}}return handlerName;}function onRequiredVersionAvailable(){}function onRestartRequired(){}function onUpgradeRequired(){}function onInstallRequired(){}function IsVersionAvailableOnError(sender,args){var retVal=false;
try{if(args.ErrorCode==8001&&!__installationEventFired){onUpgradeRequired();__installationEventFired=true;
}else{if(args.ErrorCode==8002&&!__installationEventFired){onRestartRequired();__installationEventFired=true;
}else{if(args.ErrorCode==5014||args.ErrorCode==2106){if(__verifySilverlight2UpgradeSuccess(args.getHost())){retVal=true;
}}else{retVal=true;}}}}catch(e){}return retVal;}function IsVersionAvailableOnLoad(sender){var retVal=false;
try{if(__verifySilverlight2UpgradeSuccess(sender.getHost())){retVal=true;}}catch(e){}return retVal;
}function __verifySilverlight2UpgradeSuccess(host){var retVal=false,version="2.0.31005",installationEvent=null;
try{if(host.IsVersionSupported(version+".99")){installationEvent=onRequiredVersionAvailable;
retVal=true;}else{if(host.IsVersionSupported(version+".0")){installationEvent=onRestartRequired;
}else{installationEvent=onUpgradeRequired;}}if(installationEvent&&!__installationEventFired){installationEvent();
__installationEventFired=true;}}catch(e){}return retVal;}var aIsAvailable={};function isAvailable(sVersion){if(typeof sVersion=="undefined"){sVersion="1.0";
}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=isInstalled(sVersion);
}return aIsAvailable[sVersion];}return{onGetSilverlight:null,isBrowserRestartRequired:false,startup:startup,createObject:createObject,createObjectEx:createObjectEx,getSilverlight:getSilverlight,default_error_handler:default_error_handler,isAvailable:isAvailable};
})();apf.setStyleRule=function(name,type,value,stylesheet,win){name=name.toLowerCase();
if(!stylesheet){var sheets=(win||self).document.styleSheets;for(var j=sheets.length-1;
j>=0;j--){try{var rules=sheets[j][apf.styleSheetRules];for(var i=0;i<rules.length;
i++){if(rules.item(i).selectorText.toLowerCase()==name){rules.item(i).style[type]=value;
return true;}}}catch(e){}}}else{var rules=(win||self).document.styleSheets[stylesheet||0][apf.styleSheetRules];
for(var i=0;i<rules.length;i++){if(rules.item(i).selectorText.toLowerCase()==name){rules.item(i).style[type]=value;
return true;}}}return false;};apf.getStyleRule=function(name,type,stylesheet,win){name=name.toLowerCase();
if(!stylesheet){var sheets=(win||self).document.styleSheets;for(var j=sheets.length-1;
j>=0;j--){try{var rules=sheets[j][apf.styleSheetRules];for(var i=0;i<rules.length;
i++){if(rules.item(i).selectorText.toLowerCase()==name){return rules.item(i).style[type];
}}}catch(e){}}}else{var rules=(win||self).document.styleSheets[stylesheet||0][apf.styleSheetRules];
for(var i=0;i<rules.length;i++){if(rules.item(i).selectorText.toLowerCase()==name){return rules.item(i).style[type];
}}}return false;};apf.setStyleClass=function(oHtml,className,exclusion,userAction){if(!oHtml||userAction&&this.disabled){return;
}if(oHtml.nodeFunc){throw new Error(apf.formatErrorString(0,this,"Setting style class","Trying to set style class on aml node. Only xml or html nodes can              be passed to this function"));
}if(className){if(exclusion){exclusion[exclusion.length]=className;}else{exclusion=[className];
}}var re=new RegExp("(^| +)(?:"+(exclusion?exclusion.join("|"):"")+")","gi");oHtml.className!=null?(oHtml.className=oHtml.className.replace(re," ")+(className?" "+className:"")):oHtml.setAttribute("class",(oHtml.getAttribute("class")||"").replace(re," ")+(className?" "+className:""));
return oHtml;};apf.importCssString=function(cssString,doc,media){doc=doc||document;
var htmlNode=doc.getElementsByTagName("head")[0];if(!apf.supportOpacity){cssString=cssString.replace(/opacity[ \s]*\:[ \s]*([\d\.]+)/g,function(m,m1){return"filter:progid:DXImageTransform.Microsoft.Alpha(opacity="+(m1*100)+")";
});}if(apf.canCreateStyleNode){var style=doc.createElement("style");style.appendChild(doc.createTextNode(cssString));
if(media){style.setAttribute("media",media);}htmlNode.appendChild(style);}else{htmlNode.insertAdjacentHTML("beforeend",".<style media='"+(media||"all")+"'>"+cssString+"</style>");
}};apf.getStyleRecur=function(el,prop){var value=apf.hasComputedStyle?document.defaultView.getComputedStyle(el,"").getPropertyValue(prop.replace(/([A-Z])/g,function(m,m1){return"-"+m1.toLowerCase();
})):el.currentStyle[prop];return((!value||value=="transparent"||value=="inherit")&&el.parentNode&&el.parentNode.nodeType==1)?this.getStyleRecur(el.parentNode,prop):value;
};apf.importStylesheet=function(def,win){if(!def.length){return;}var re=new RegExp("^"+document.domain,"g");
var doc=(win||window).document;for(var index=0;index<document.styleSheets.length;
index++){if(!doc.styleSheets[index].href||doc.styleSheets[index].href.match(re)){break;
}}var styleSheet=doc.styleSheets[index];if(!styleSheet){if(doc.createStyleSheet){styleSheet=doc.createStyleSheet();
}else{var elem=doc.createElement("style");elem.type="text/css";doc.getElementsByTagName("head")[0].appendChild(elem);
styleSheet=elem.sheet;}}for(var i=0;i<def.length;i++){if(!def[i][1]){continue;}if(apf.isIE){styleSheet.addRule(def[i][0],def[i][1]);
}else{styleSheet.insertRule(def[i][0]+" {"+def[i][1]+"}",0);}}};apf.isInRect=function(oHtml,x,y){var pos=this.getAbsolutePosition(oHtml);
if(x<pos[0]||y<pos[1]||x>oHtml.offsetWidth+pos[0]-10||y>oHtml.offsetHeight+pos[1]-10){return false;
}return true;};apf.getOverflowParent=function(o){o=o.offsetParent;while(o&&(this.getStyle(o,"overflow")!="hidden"||"absolute|relative".indexOf(this.getStyle(o,"position"))==-1)){o=o.offsetParent;
}return o||document.documentElement;};apf.getPositionedParent=function(o){o=o.offsetParent;
while(o&&o.tagName.toLowerCase()!="body"&&"absolute|relative".indexOf(this.getStyle(o,"position"))==-1){o=o.offsetParent;
}return o||document.documentElement;};apf.getAbsolutePosition=function(o,refParent,inclSelf){if("getBoundingClientRect" in document.documentElement){if(apf.doesNotIncludeMarginInBodyOffset&&o==document.body){return[o.offsetLeft+(parseFloat(apf.getStyle(o,"marginLeft"))||0),+(o.scrollLeft||0),o.offsetTop+(parseFloat(apf.getStyle(o,"marginTop"))||0)+(o.scrollTop||0)];
}var box=o.getBoundingClientRect(),top=box.top,left=box.left,corr=(apf.isIE&&apf.isIE<8);
if(refParent&&refParent!=document.body){var pos=apf.getAbsolutePosition(refParent,null,true);
top-=pos[1];left-=pos[0];}if(!(apf.isIE&&o==document.documentElement)){left+=(refParent||document.body).scrollLeft||document.documentElement.scrollLeft||0;
top+=(refParent||document.body).scrollTop||document.documentElement.scrollTop||0;
}if(inclSelf&&!refParent){left+=parseInt(apf.getStyle(o,"borderLeftWidth"))||0;
top+=parseInt(apf.getStyle(o,"borderTopWidth"))||0;}return[left-(corr?2:0),top-(corr?2:0)];
}var wt=inclSelf?0:o.offsetLeft,ht=inclSelf?0:o.offsetTop;o=inclSelf?o:o.offsetParent||o.parentNode;
if(apf.isIE8&&refParent){bw=this.getStyle(o,"borderLeftWidth");wt-=(apf.isIE&&o.currentStyle.borderLeftStyle!="none"&&bw=="medium"?2:parseInt(bw)||0);
bh=this.getStyle(o,"borderTopWidth");ht-=(apf.isIE&&o.currentStyle.borderTopStyle!="none"&&bh=="medium"?2:parseInt(bh)||0);
}var bw,bh,fl;while(o&&o!=refParent){bw=apf.isOpera||apf.isIE8?0:this.getStyle(o,"borderLeftWidth");
wt+=(apf.isIE&&o.currentStyle.borderLeftStyle!="none"&&bw=="medium"?2:parseInt(bw)||0)+o.offsetLeft;
if(apf.isIE&&!apf.isIE8&&apf.getStyle(o,"styleFloat")=="none"&&apf.getStyle(o,"position")=="relative"){var q=o.previousSibling;
while(q){if(q.nodeType==1){fl=apf.getStyle(q,"styleFloat");if(fl=="left"){wt-=parseInt(apf.getStyle(o,"marginLeft"))||0;
break;}else{if(fl=="right"){break;}}}q=q.previousSibling;}}bh=apf.isOpera||apf.isIE8?0:this.getStyle(o,"borderTopWidth");
ht+=(apf.isIE&&o.currentStyle.borderTopStyle!="none"&&bh=="medium"?2:parseInt(bh)||0)+o.offsetTop;
if(!apf.isGecko&&o!=refParent&&(o.tagName!="HTML"||o.ownerDocument!=document)){wt-=o.scrollLeft;
ht-=o.scrollTop;}if(o.tagName.toLowerCase()=="table"){ht-=parseInt(o.border||0)+parseInt(o.cellSpacing||0);
wt-=parseInt(o.border||0)+parseInt(o.cellSpacing||0)*2;}else{if(o.tagName.toLowerCase()=="tr"){var cp;
ht-=(cp=parseInt(o.parentNode.parentNode.cellSpacing));while(o.previousSibling){ht-=(o=o.previousSibling).offsetHeight+cp;
}}}if(apf.isIE&&!o.offsetParent&&o.parentNode.nodeType==1){wt-=o.parentNode.scrollLeft;
ht-=o.parentNode.scrollTop;}o=o.offsetParent;}return[wt,ht];};apf.getHorBorders=function(oHtml){return Math.max(0,(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0));
};apf.getVerBorders=function(oHtml){return Math.max(0,(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0));
};apf.getWidthDiff=function(oHtml){if(apf.hasFlexibleBox&&apf.getStyle(oHtml,apf.CSSPREFIX+"BoxSizing")!="content-box"){return 0;
}return Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingLeft"))||0)+(parseInt(apf.getStyle(oHtml,"paddingRight"))||0)+(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0));
};apf.getHeightDiff=function(oHtml){if(apf.hasFlexibleBox&&apf.getStyle(oHtml,apf.CSSPREFIX+"BoxSizing")!="content-box"){return 0;
}return Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingTop"))||0)+(parseInt(apf.getStyle(oHtml,"paddingBottom"))||0)+(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0));
};apf.getDiff=function(oHtml){if(apf.hasFlexibleBox&&apf.getStyle(oHtml,apf.CSSPREFIX+"BoxSizing")!="content-box"){return[0,0];
}return[Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingLeft"))||0)+(parseInt(apf.getStyle(oHtml,"paddingRight"))||0)+(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0)),Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingTop"))||0)+(parseInt(apf.getStyle(oHtml,"paddingBottom"))||0)+(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0))];
};apf.getMargin=function(oHtml){return[(parseInt(apf.getStyle(oHtml,"marginLeft"))||0)+(parseInt(apf.getStyle(oHtml,"marginRight"))||0),(parseInt(apf.getStyle(oHtml,"marginTop"))||0)+(parseInt(apf.getStyle(oHtml,"marginBottom"))||0)];
};apf.getHtmlInnerWidth=function(oHtml){return(oHtml.offsetWidth-(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)-(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0));
};apf.getHtmlInnerHeight=function(oHtml){return(oHtml.offsetHeight-(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)-(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0));
};apf.getViewPort=function(win){win=win||window;var doc=(!win.document.compatMode||win.document.compatMode=="CSS1Compat")?win.document.html||win.document.documentElement:win.document.body;
return{x:win.pageXOffset||doc.scrollLeft,y:win.pageYOffset||doc.scrollTop,width:win.innerWidth||doc.clientWidth,height:win.innerHeight||doc.clientHeight};
};apf.highlightXml=apf.highlightCode=function(strCode){var lines=strCode.split(/\n\r?/);
for(var min=1000,i=0,l=lines.length;i<l;i++){min=Math.min(min,lines[i].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);
if(!min){break;}}strCode=strCode.replace(new RegExp("^ {"+min+"}","gm"),"").replace(/<!doctype([\s\S]+?)>|<!--([\s\S]+?)-->|<\?([\w\-]+)([\s\S]+?)\?>|<\!\[CDATA\[([\s\S]*?)\]\]>|<(\w+:)?script([\s\S]*?)>([\s\S]*?)<\/(?:\w+:)?script>|<([\/\w\:\-]+)([\s\S]*?)(\/?)>/g,function(m,doctype,comment,ptarget,pcontents,cdata,sprefix,sattr,scontent,tagName,attrs,bl){if(doctype){return'<span style="color:gray">&lt;!doctype'+doctype.replace(/</g,"&lt;")+"&gt;</span>";
}else{if(comment){return'<span style="color:green">&lt;!--'+comment.replace(/</g,"&lt;")+"--&gt;</span>";
}else{if(ptarget){return'<span style="color:orange">&lt;?'+ptarget+"</span>"+apf.highlightJs(pcontents,true)+'<span style="color:orange">?&gt;</span>';
}else{if(cdata){return'<span style="color:gray">&lt;![CDATA['+cdata+"]]&gt;</span>";
}else{if(sprefix){return'<span style="color:#127ac6">&lt;'+sprefix+"script"+(attrs?"</span>"+attrs.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(m,s,w){if(s){return s;
}return'<span style="color:red">'+w+"</span>";})+'<span style="color:#127ac6">&gt;</span>':"&gt;</span>")+apf.highlightJs(scontent,true)+'<span style="color:#127ac6">&lt;/'+sprefix+"script&gt;</span>";
}else{if(tagName){return'<span style="color:#127ac6">&lt;'+(tagName.substr(0,2)=="a:"?"<a href='element."+tagName.substr(2)+"'>"+tagName+"</a>":tagName)+(attrs?"</span>"+attrs.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(m,s,w){if(s){return s;
}return'<span style="color:red">'+w+"</span>";})+'<span style="color:#127ac6">'+bl+"&gt;</span>":"&gt;</span>");
}}}}}}});return strCode;};apf.removeStartWhitespaces=function(strCode){var lines=strCode.split(/\n\r?/);
for(var min=1000,i=0,l=lines.length;i<l;i++){min=Math.min(min,lines[i].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);
if(!min){break;}}return strCode.replace(new RegExp("^ {"+min+"}","gm"),"");};apf.convertAmlToJson=function(strCode){var xml=apf.getXml("<a:app xmlns:a='"+apf.ns.apf+"'>"+strCode+"</a:app>",null,true);
var script=[],bool={"true":1,"false":1};var x=(function recur(nodes,depth,paout){var pre=new Array(depth+2).join("  "),output=[];
for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType==3||node.nodeType==4){if(node.nodeValue.replace(/[\s]*$/,"").replace(/^[\s]*/,"")){(paout||output).push("data",'"'+node.nodeValue.trim().replace(/"/g,'\\"').replace(/\n/g,"\\\n")+'"');
}continue;}else{if(node.nodeType==8){output.push(pre+"//"+node.nodeValue);continue;
}else{if(node.nodeType!=1){continue;}else{if(node[apf.TAGNAME]=="script"){var s=node.childNodes;
for(var j=0,jl=s.length;j<jl;j++){if(s[j].nodeValue.trim()!="//"){script.push(s[j].nodeValue.replace(/^ {16}/gm,"").replace(/\/\/$/,"")+"\n");
}}continue;}}}}var attr,childLength=node.childNodes.length+(attr=node.attributes).length;
var max=0,aout=[];output.push(pre+"new apf."+node[apf.TAGNAME]+(childLength||!depth?"({":"()"+(depth==0?";":(i==l-1?"":","))));
if(!depth){aout.push("htmlNode","document.body");max=Math.max(8,max);}for(var a,j=0,jl=attr.length;
j<jl;j++){aout.push((a=attr[j]).nodeName,a.nodeName.substr(0,2)=="on"?"function(){"+a.nodeValue+"}":(parseInt(a.nodeValue)==a.nodeValue||bool[a.nodeValue]?a.nodeValue:'"'+a.nodeValue.replace(/"/g,'\\"')+'"'));
max=Math.max(a.nodeName.length,max);}var c="";if(node[apf.TAGNAME]=="model"&&node.childNodes.length){aout.push("data",'"'+apf.serializeChildren(node).trim().replace(/"/g,'\\"').replace(/\r?\n/g,"\\\n")+'"');
}else{if(childLength){var c=recur(node.childNodes,depth+2,aout);}}max=Math.max(c?10:4,max);
max++;for(j=0,jl=aout.length;j<jl;j+=2){output.push(pre+"  "+aout[j].pad(max," ",apf.PAD_RIGHT)+": "+aout[j+1]+(j!=jl-2||c?",":""));
}if(c){output.push(pre+"  "+"childNodes".pad(max," ",apf.PAD_RIGHT)+": [");output.push(c.substr(0,c.length-1));
output.push(pre+"  ]");}if(childLength||!depth){output.push(pre+"})"+(depth==0?";":(i==l-1?"":",")));
}}return output.join("\n")+(depth==0?"\n\n"+script.join("").trim():"");})(xml.childNodes,0);
return x+"\n\n";};apf.highlightJs=function(x,notrim){if(!notrim){var lines=x.split(/\n\r?/);
for(var min=1000,i=0,l=lines.length;i<l;i++){min=Math.min(min,lines[i].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);
if(!min){break;}}x=x.replace(new RegExp("^ {"+min+"}","gm"),"");}return x.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/(\/\*[\s\S]+\*\/)|(\/\/.*)$|("(?:[^"\\]+|\\[\s\S])*")|('(?:[^'\\]+|\\[\s\S])*')|(\W)(apf|break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)|(\W)(\w+)(\s*\()/gm,function(m,colong,co,str1,str2,nw,kw,nw2,fW,f,fws){if(f){return fW+'<span style="color:#ff8000">'+f+"</span>"+fws;
}else{if(co||colong){return'<span style="color:green">'+(co||colong)+"</span>";
}else{if(str1||str2){return'<span style="color:#808080">'+(str1||str2)+"</span>";
}else{if(nw){return nw+'<span style="color:#127ac6">'+kw+"</span>"+nw2;}}}}});};
apf.highlightCode2=function(strCode){var comment=[],str=[];return strCode.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(a){comment.push(a);
return"###n"+(comment.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(a,b){str.push(b);
return"###s"+(str.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(a,b){str.push(b);
return"###q"+(str.length-1)+"###";}).replace(/(\<)|(\>)/g,function(n,a,b){return"<span stylecolorwhite>"+(a?"@lt@":"@gt@")+"</span>";
}).replace(/(\W)-?([\d\.]+)(\W)/g,"$1<span stylecolor#127ac6>$2</span>$3").replace(/([\|\&\=\;\,\:\?\+\*\-]+)/g,"<span stylecolorwhite>$1</span>").replace(/(\W)(break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)/g,"$1<span stylecolorgreen>$2</span>$3").replace(/([\(\)\{\}\[\]])/g,"<span stylecoloryellow>$1</span>").replace(/###n(\d+)###/g,function(a,b){return"<span stylecolorpurple>"+comment[b].escapeHTML()+"</span>";
}).replace(/###s(\d+)###/g,function(a,b){return'<span stylecolorgray>"'+str[b].escapeHTML()+'"</span>';
}).replace(/###q(\d+)###/g,function(a,b){return"<span stylecolorgray>'"+str[b].escapeHTML()+"'</span>";
}).replace(/stylecolor(.*?)\>/g,"style='color:$1'>").replace(/@(.*?)@/g,"&$1;");
};apf.formatJS=function(strJs){var d=0,r=0;var comment=[],str=[];return strJs.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(a){comment.push(a);
return"###n"+(comment.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(a,b){str.push(b);
return"###s"+(str.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(a,b){str.push(b);
return"###q"+(str.length-1)+"###";}).replace(/;+/g,";").replace(/{;/g,"{").replace(/({)|(})|(\()|(\))|(;)/g,function(m,co,cc,ro,rc,e){if(co){d++;
}if(cc){d--;}if(ro){r++;return ro;}if(rc){r--;return rc;}var o="";for(var i=0;i<d;
i++){o+="\t";}if(co){return"{\n"+o;}if(cc){return"\n"+o+"}";}if(e){return(r>0)?e:(";\n"+o);
}}).replace(/;\s*\n\s*\n/g,";\n").replace(/}var/g,"}\nvar").replace(/([\n\s]*)###n(\d+)###[\n\s]*/g,function(a,b,c){return b+comment[c]+b;
}).replace(/###s(\d+)###/g,function(a,b,c){return'"'+str[b]+'"';}).replace(/###q(\d+)###/g,function(a,b,c){return"'"+str[b]+"'";
});};apf.diff_match_patch=new (function(){this.diffTimeout=1;this.diffEditCost=4;
this.diffDualThreshold=32;this.matchThreshold=0.5;this.matchDistance=1000;this.patchDeleteThreshold=0.5;
this.patchMargin=4;var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0,getMaxBits=function(){var maxbits=0,oldi=1,newi=2;
while(oldi!=newi){maxbits++;oldi=newi;newi=newi<<1;}return maxbits;},patch_obj=function(){this.diffs=[];
this.start1=null;this.start2=null;this.length1=0;this.length2=0;},opMap=[];opMap[DIFF_INSERT]="+";
opMap[DIFF_DELETE]="-";opMap[DIFF_EQUAL]=" ";patch_obj.prototype.toString=function(){var coords1=(this.length1===0)?this.start1+",0":(this.length1==1)?this.start1+1:(this.start1+1)+","+this.length1,coords2=(this.length2===0)?this.start2+",0":(this.length2==1)?this.start2+1:(this.start2+1)+","+this.length2,text=["@@ -"+coords1+" +"+coords2+" @@\n"],x=0,l=this.diffs.length;
for(;x<l;x++){text[x+1]=opMap[this.diffs[x][0]]+encodeURI(this.diffs[x][1])+"\n";
}return text.join("").replace(/\x00/g,"%00").replace(/%20/g," ");};this.matchMaxBits=getMaxBits();
this.diff_main=function(text1,text2,opt_checklines){if(text1==text2){return[[DIFF_EQUAL,text1]];
}if(typeof opt_checklines=="undefined"){opt_checklines=true;}var checklines=opt_checklines,commonlength=this.diff_commonPrefix(text1,text2),commonprefix=text1.substring(0,commonlength);
text1=text1.substring(commonlength);text2=text2.substring(commonlength);commonlength=this.diff_commonSuffix(text1,text2);
var commonsuffix=text1.substring(text1.length-commonlength);text1=text1.substring(0,text1.length-commonlength);
text2=text2.substring(0,text2.length-commonlength);var diffs=diff_compute.call(this,text1,text2,checklines);
if(commonprefix){diffs.unshift([DIFF_EQUAL,commonprefix]);}if(commonsuffix){diffs.push([DIFF_EQUAL,commonsuffix]);
}this.diff_cleanupMerge(diffs);return diffs;};var diff_compute=function(text1,text2,checklines){var diffs;
if(!text1){return[[DIFF_INSERT,text2]];}if(!text2){return[[DIFF_DELETE,text1]];
}var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,i=longtext.indexOf(shorttext);
if(i!=-1){diffs=[[DIFF_INSERT,longtext.substring(0,i)],[DIFF_EQUAL,shorttext],[DIFF_INSERT,longtext.substring(i+shorttext.length)]];
if(text1.length>text2.length){diffs[0][0]=diffs[2][0]=DIFF_DELETE;}return diffs;
}longtext=shorttext=null;var a,linearray,hm=this.diff_halfMatch(text1,text2);if(hm){return this.diff_main(hm[0],hm[2],checklines).concat([[DIFF_EQUAL,hm[4]]],this.diff_main(hm[1],hm[3],checklines));
}if(checklines&&(text1.length<100||text2.length<100)){checklines=false;}if(checklines){a=this.diff_linesToChars(text1,text2);
text1=a[0];text2=a[1];linearray=a[2];}diffs=this.diff_map(text1,text2);if(!diffs){diffs=[[DIFF_DELETE,text1],[DIFF_INSERT,text2]];
}if(checklines){this.diff_charsToLines(diffs,linearray);this.diff_cleanupSemantic(diffs);
diffs.push([DIFF_EQUAL,""]);var pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";
while(pointer<diffs.length){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++;
text_insert+=diffs[pointer][1];break;case DIFF_DELETE:count_delete++;text_delete+=diffs[pointer][1];
break;case DIFF_EQUAL:if(count_delete>=1&&count_insert>=1){a=this.diff_main(text_delete,text_insert,false);
diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert);pointer=pointer-count_delete-count_insert;
for(var j=a.length-1;j>=0;j--){diffs.splice(pointer,0,a[j]);}pointer=pointer+a.length;
}count_insert=0;count_delete=0;text_delete="";text_insert="";break;}pointer++;}diffs.pop();
}return diffs;};this.diff_linesToChars=function(text1,text2){var lineArray=[""],lineHash={};
function diff_linesToCharsMunge(text){var chars="",lineStart=0,lineEnd=-1,lineArrayLength=lineArray.length;
while(lineEnd<text.length-1){lineEnd=text.indexOf("\n",lineStart);if(lineEnd==-1){lineEnd=text.length-1;
}var line=text.substring(lineStart,lineEnd+1);lineStart=lineEnd+1;if(lineHash.hasOwnProperty?lineHash.hasOwnProperty(line):(lineHash[line]!==undefined)){chars+=String.fromCharCode(lineHash[line]);
}else{chars+=String.fromCharCode(lineArrayLength);lineHash[line]=lineArrayLength;
lineArray[lineArrayLength++]=line;}}return chars;}return[diff_linesToCharsMunge(text1),diff_linesToCharsMunge(text2),lineArray];
};this.diff_charsToLines=function(diffs,lineArray){var x=0,chars,text,y;for(;x<diffs.length;
x++){chars=diffs[x][1];text=[];for(y=0;y<chars.length;y++){text[y]=lineArray[chars.charCodeAt(y)];
}diffs[x][1]=text.join("");}};this.diff_map=function(text1,text2){var ms_end=(new Date()).getTime()+this.diffTimeout*1000,text1_length=text1.length,text2_length=text2.length,d=0,max_d=text1_length+text2_length-1,doubleEnd=this.diffDualThreshold*2<max_d,v_map1=[],v_map2=[],v1={},v2={},footsteps={},done=false,hasOwnProperty=!!(footsteps.hasOwnProperty),front=(text1_length+text2_length)%2,x,y,k,a,footstep;
v1[1]=0;v2[1]=0;for(;d<max_d;d++){if(this.diffTimeout>0&&(new Date()).getTime()>ms_end){return null;
}v_map1[d]={};for(k=-d;k<=d;k+=2){if(k==-d||k!=d&&v1[k-1]<v1[k+1]){x=v1[k+1];}else{x=v1[k-1]+1;
}y=x-k;if(doubleEnd){footstep=x+","+y;if(front&&(hasOwnProperty?footsteps.hasOwnProperty(footstep):(footsteps[footstep]!==undefined))){done=true;
}if(!front){footsteps[footstep]=d;}}while(!done&&x<text1_length&&y<text2_length&&text1.charAt(x)==text2.charAt(y)){x++;
y++;if(doubleEnd){footstep=x+","+y;if(front&&(hasOwnProperty?footsteps.hasOwnProperty(footstep):(footsteps[footstep]!==undefined))){done=true;
}if(!front){footsteps[footstep]=d;}}}v1[k]=x;v_map1[d][x+","+y]=true;if(x==text1_length&&y==text2_length){return this.diff_path1(v_map1,text1,text2);
}else{if(done){v_map2=v_map2.slice(0,footsteps[footstep]+1);a=this.diff_path1(v_map1,text1.substring(0,x),text2.substring(0,y));
return a.concat(this.diff_path2(v_map2,text1.substring(x),text2.substring(y)));
}}}if(doubleEnd){v_map2[d]={};for(k=-d;k<=d;k+=2){x=(k==-d||k!=d&&v2[k-1]<v2[k+1])?v2[k+1]:v2[k-1]+1;
y=x-k;footstep=(text1_length-x)+","+(text2_length-y);if(!front&&(hasOwnProperty?footsteps.hasOwnProperty(footstep):(footsteps[footstep]!==undefined))){done=true;
}if(front){footsteps[footstep]=d;}while(!done&&x<text1_length&&y<text2_length&&text1.charAt(text1_length-x-1)==text2.charAt(text2_length-y-1)){x++;
y++;footstep=(text1_length-x)+","+(text2_length-y);if(!front&&(hasOwnProperty?footsteps.hasOwnProperty(footstep):(footsteps[footstep]!==undefined))){done=true;
}if(front){footsteps[footstep]=d;}}v2[k]=x;v_map2[d][x+","+y]=true;if(done){v_map1=v_map1.slice(0,footsteps[footstep]+1);
a=this.diff_path1(v_map1,text1.substring(0,text1_length-x),text2.substring(0,text2_length-y));
return a.concat(this.diff_path2(v_map2,text1.substring(text1_length-x),text2.substring(text2_length-y)));
}}}}return null;};this.diff_path1=function(v_map,text1,text2){var path=[],x=text1.length,y=text2.length,last_op=null,d=v_map.length-2;
for(;d>=0;d--){while(1){if(v_map[d].hasOwnProperty?v_map[d].hasOwnProperty((x-1)+","+y):(v_map[d][(x-1)+","+y]!==undefined)){x--;
if(last_op===DIFF_DELETE){path[0][1]=text1.charAt(x)+path[0][1];}else{path.unshift([DIFF_DELETE,text1.charAt(x)]);
}last_op=DIFF_DELETE;break;}else{if(v_map[d].hasOwnProperty?v_map[d].hasOwnProperty(x+","+(y-1)):(v_map[d][x+","+(y-1)]!==undefined)){y--;
if(last_op===DIFF_INSERT){path[0][1]=text2.charAt(y)+path[0][1];}else{path.unshift([DIFF_INSERT,text2.charAt(y)]);
}last_op=DIFF_INSERT;break;}else{x--;y--;if(last_op===DIFF_EQUAL){path[0][1]=text1.charAt(x)+path[0][1];
}else{path.unshift([DIFF_EQUAL,text1.charAt(x)]);}last_op=DIFF_EQUAL;}}}}return path;
};this.diff_path2=function(v_map,text1,text2){var path=[],pathLength=0,x=text1.length,y=text2.length,last_op=null,d=v_map.length-2;
for(;d>=0;d--){while(1){if(v_map[d].hasOwnProperty?v_map[d].hasOwnProperty((x-1)+","+y):(v_map[d][(x-1)+","+y]!==undefined)){x--;
if(last_op===DIFF_DELETE){path[pathLength-1][1]+=text1.charAt(text1.length-x-1);
}else{path[pathLength++]=[DIFF_DELETE,text1.charAt(text1.length-x-1)];}last_op=DIFF_DELETE;
break;}else{if(v_map[d].hasOwnProperty?v_map[d].hasOwnProperty(x+","+(y-1)):(v_map[d][x+","+(y-1)]!==undefined)){y--;
if(last_op===DIFF_INSERT){path[pathLength-1][1]+=text2.charAt(text2.length-y-1);
}else{path[pathLength++]=[DIFF_INSERT,text2.charAt(text2.length-y-1)];}last_op=DIFF_INSERT;
break;}else{x--;y--;if(last_op===DIFF_EQUAL){path[pathLength-1][1]+=text1.charAt(text1.length-x-1);
}else{path[pathLength++]=[DIFF_EQUAL,text1.charAt(text1.length-x-1)];}last_op=DIFF_EQUAL;
}}}}return path;};this.diff_commonPrefix=function(text1,text2){if(!text1||!text2||text1.charCodeAt(0)!==text2.charCodeAt(0)){return 0;
}var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerstart=0;
while(pointermin<pointermid){if(text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)){pointermin=pointermid;
pointerstart=pointermin;}else{pointermax=pointermid;}pointermid=Math.floor((pointermax-pointermin)/2+pointermin);
}return pointermid;};this.diff_commonSuffix=function(text1,text2){if(!text1||!text2||text1.charCodeAt(text1.length-1)!==text2.charCodeAt(text2.length-1)){return 0;
}var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerend=0;
while(pointermin<pointermid){if(text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)){pointermin=pointermid;
pointerend=pointermin;}else{pointermax=pointermid;}pointermid=Math.floor((pointermax-pointermin)/2+pointermin);
}return pointermid;};this.diff_halfMatch=function(text1,text2){var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,_self=this;
if(longtext.length<10||shorttext.length<1){return null;}function diff_halfMatchI(longtext,shorttext,i){var seed=longtext.substring(i,i+Math.floor(longtext.length/4)),j=-1,best_common="",best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,prefixLength,suffixLength;
while((j=shorttext.indexOf(seed,j+1))!=-1){prefixLength=_self.diff_commonPrefix(longtext.substring(i),shorttext.substring(j));
suffixLength=_self.diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));
if(best_common.length<suffixLength+prefixLength){best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength);
best_longtext_a=longtext.substring(0,i-suffixLength);best_longtext_b=longtext.substring(i+prefixLength);
best_shorttext_a=shorttext.substring(0,j-suffixLength);best_shorttext_b=shorttext.substring(j+prefixLength);
}}if(best_common.length>=longtext.length/2){return[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common];
}else{return null;}}var hm1=diff_halfMatchI(longtext,shorttext,Math.ceil(longtext.length/4)),hm2=diff_halfMatchI(longtext,shorttext,Math.ceil(longtext.length/2)),hm;
if(!hm1&&!hm2){return null;}else{if(!hm2){hm=hm1;}else{if(!hm1){hm=hm2;}else{hm=hm1[4].length>hm2[4].length?hm1:hm2;
}}}var text1_a,text1_b,text2_a,text2_b;if(text1.length>text2.length){text1_a=hm[0];
text1_b=hm[1];text2_a=hm[2];text2_b=hm[3];}else{text2_a=hm[0];text2_b=hm[1];text1_a=hm[2];
text1_b=hm[3];}return[text1_a,text1_b,text2_a,text2_b,hm[4]];};this.diff_cleanupSemantic=function(diffs){var changes=false,equalities=[],equalitiesLength=0,lastequality=null,pointer=0,length_changes1=0,length_changes2=0;
while(pointer<diffs.length){if(diffs[pointer][0]==DIFF_EQUAL){equalities[equalitiesLength++]=pointer;
length_changes1=length_changes2;length_changes2=0;lastequality=diffs[pointer][1];
}else{length_changes2+=diffs[pointer][1].length;if(lastequality!==null&&(lastequality.length<=length_changes1)&&(lastequality.length<=length_changes2)){diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]);
diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT;equalitiesLength--;equalitiesLength--;
pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1;length_changes1=0;
length_changes2=0;lastequality=null;changes=true;}}pointer++;}if(changes){this.diff_cleanupMerge(diffs);
}this.diff_cleanupSemanticLossless(diffs);};this.diff_cleanupSemanticLossless=function(diffs){var punctuation=/[^a-zA-Z0-9]/,whitespace=/\s/,linebreak=/[\r\n]/,blanklineEnd=/\n\r?\n$/,blanklineStart=/^\r?\n\r?\n/;
function diff_cleanupSemanticScore(one,two){if(!one||!two){return 5;}var score=0;
if(one.charAt(one.length-1).match(punctuation)||two.charAt(0).match(punctuation)){score++;
if(one.charAt(one.length-1).match(whitespace)||two.charAt(0).match(whitespace)){score++;
if(one.charAt(one.length-1).match(linebreak)||two.charAt(0).match(linebreak)){score++;
if(one.match(blanklineEnd)||two.match(blanklineStart)){score++;}}}}return score;
}var pointer=1,equality1,edit,equality2,commonOffset,commonString,bestEquality1,bestEdit,bestEquality2,bestScore,score;
while(pointer<diffs.length-1){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){equality1=diffs[pointer-1][1];
edit=diffs[pointer][1];equality2=diffs[pointer+1][1];commonOffset=this.diff_commonSuffix(equality1,edit);
if(commonOffset){commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset);
edit=commonString+edit.substring(0,edit.length-commonOffset);equality2=commonString+equality2;
}bestEquality1=equality1;bestEdit=edit;bestEquality2=equality2;bestScore=diff_cleanupSemanticScore(equality1,edit)+diff_cleanupSemanticScore(edit,equality2);
while(edit.charAt(0)===equality2.charAt(0)){equality1+=edit.charAt(0);edit=edit.substring(1)+equality2.charAt(0);
equality2=equality2.substring(1);score=diff_cleanupSemanticScore(equality1,edit)+diff_cleanupSemanticScore(edit,equality2);
if(score>=bestScore){bestScore=score;bestEquality1=equality1;bestEdit=edit;bestEquality2=equality2;
}}if(diffs[pointer-1][1]!=bestEquality1){if(bestEquality1){diffs[pointer-1][1]=bestEquality1;
}else{diffs.splice(pointer-1,1);pointer--;}diffs[pointer][1]=bestEdit;if(bestEquality2){diffs[pointer+1][1]=bestEquality2;
}else{diffs.splice(pointer+1,1);pointer--;}}}pointer++;}};this.diff_cleanupEfficiency=function(diffs){var changes=false,equalities=[],equalitiesLength=0,lastequality="",pointer=0,pre_ins=false,pre_del=false,post_ins=false,post_del=false;
while(pointer<diffs.length){if(diffs[pointer][0]==DIFF_EQUAL){if(diffs[pointer][1].length<this.diffEditCost&&(post_ins||post_del)){equalities[equalitiesLength++]=pointer;
pre_ins=post_ins;pre_del=post_del;lastequality=diffs[pointer][1];}else{equalitiesLength=0;
lastequality="";}post_ins=post_del=false;}else{if(diffs[pointer][0]==DIFF_DELETE){post_del=true;
}else{post_ins=true;}if(lastequality&&((pre_ins&&pre_del&&post_ins&&post_del)||((lastequality.length<this.diffEditCost/2)&&(pre_ins+pre_del+post_ins+post_del)==3))){diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]);
diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT;equalitiesLength--;lastequality="";
if(pre_ins&&pre_del){post_ins=post_del=true;equalitiesLength=0;}else{equalitiesLength--;
pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1;post_ins=post_del=false;
}changes=true;}}pointer++;}if(changes){this.diff_cleanupMerge(diffs);}};this.diff_cleanupMerge=function(diffs){diffs.push([DIFF_EQUAL,""]);
var pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="",commonlength;
while(pointer<diffs.length){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++;
text_insert+=diffs[pointer][1];pointer++;break;case DIFF_DELETE:count_delete++;
text_delete+=diffs[pointer][1];pointer++;break;case DIFF_EQUAL:if(count_delete!==0||count_insert!==0){if(count_delete!==0&&count_insert!==0){commonlength=this.diff_commonPrefix(text_insert,text_delete);
if(commonlength!==0){if((pointer-count_delete-count_insert)>0&&diffs[pointer-count_delete-count_insert-1][0]==DIFF_EQUAL){diffs[pointer-count_delete-count_insert-1][1]+=text_insert.substring(0,commonlength);
}else{diffs.splice(0,0,[DIFF_EQUAL,text_insert.substring(0,commonlength)]);pointer++;
}text_insert=text_insert.substring(commonlength);text_delete=text_delete.substring(commonlength);
}commonlength=this.diff_commonSuffix(text_insert,text_delete);if(commonlength!==0){diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1];
text_insert=text_insert.substring(0,text_insert.length-commonlength);text_delete=text_delete.substring(0,text_delete.length-commonlength);
}}if(count_delete===0){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_INSERT,text_insert]);
}else{if(count_insert===0){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_DELETE,text_delete]);
}else{diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_DELETE,text_delete],[DIFF_INSERT,text_insert]);
}}pointer=pointer-count_delete-count_insert+(count_delete?1:0)+(count_insert?1:0)+1;
}else{if(pointer!==0&&diffs[pointer-1][0]==DIFF_EQUAL){diffs[pointer-1][1]+=diffs[pointer][1];
diffs.splice(pointer,1);}else{pointer++;}}count_insert=0;count_delete=0;text_delete="";
text_insert="";break;}}if(diffs[diffs.length-1][1]===""){diffs.pop();}var changes=false;
pointer=1;while(pointer<diffs.length-1){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){if(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)==diffs[pointer-1][1]){diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length);
diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1];diffs.splice(pointer-1,1);
changes=true;}else{if(diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]){diffs[pointer-1][1]+=diffs[pointer+1][1];
diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1];
diffs.splice(pointer+1,1);changes=true;}}}pointer++;}if(changes){this.diff_cleanupMerge(diffs);
}};this.diff_xIndex=function(diffs,loc){var chars1=0,chars2=0,last_chars1=0,last_chars2=0,x=0,l=diffs.length;
for(;x<l;x++){if(diffs[x][0]!==DIFF_INSERT){chars1+=diffs[x][1].length;}if(diffs[x][0]!==DIFF_DELETE){chars2+=diffs[x][1].length;
}if(chars1>loc){break;}last_chars1=chars1;last_chars2=chars2;}if(diffs.length!=x&&diffs[x][0]===DIFF_DELETE){return last_chars2;
}return last_chars2+(loc-last_chars1);};this.diff_prettyHtml=function(diffs){var html=[],i=0,x=0,l=diffs.length,op,data,text;
for(;x<l;x++){op=diffs[x][0];data=diffs[x][1];text=data.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");
switch(op){case DIFF_INSERT:html[x]='<INS STYLE="background:#E6FFE6;" TITLE="i='+i+'">'+text+"</INS>";
break;case DIFF_DELETE:html[x]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+i+'">'+text+"</DEL>";
break;case DIFF_EQUAL:html[x]='<SPAN TITLE="i='+i+'">'+text+"</SPAN>";break;}if(op!==DIFF_DELETE){i+=data.length;
}}return html.join("");};this.diff_text1=function(diffs){var text=[],x=0,l=diffs.length;
for(;x<l;x++){if(diffs[x][0]!==DIFF_INSERT){text[x]=diffs[x][1];}}return text.join("");
};this.diff_text2=function(diffs){var text=[],x=0,l=diffs.length;for(;x<l;x++){if(diffs[x][0]!==DIFF_DELETE){text[x]=diffs[x][1];
}}return text.join("");};this.diff_levenshtein=function(diffs){var levenshtein=0,insertions=0,deletions=0,x=0,l=diffs.length,op,data;
for(;x<l;x++){op=diffs[x][0];data=diffs[x][1];switch(op){case DIFF_INSERT:insertions+=data.length;
break;case DIFF_DELETE:deletions+=data.length;break;case DIFF_EQUAL:levenshtein+=Math.max(insertions,deletions);
insertions=0;deletions=0;break;}}return levenshtein+Math.max(insertions,deletions);
};this.diff_toDelta=function(diffs){var text=[],x=0,l=diffs.length;for(;x<l;x++){switch(diffs[x][0]){case DIFF_INSERT:text[x]="+"+encodeURI(diffs[x][1]);
break;case DIFF_DELETE:text[x]="-"+diffs[x][1].length;break;case DIFF_EQUAL:text[x]="="+diffs[x][1].length;
break;}}return text.join("\t").replace(/\x00/g,"%00").replace(/%20/g," ");};this.diff_fromDelta=function(text1,delta){var diffs=[],diffsLength=0,pointer=0;
delta=delta.replace(/%00/g,"\0");var tokens=delta.split(/\t/g),x=0,l=tokens.length,param,n,text;
for(;x<l;x++){param=tokens[x].substring(1);switch(tokens[x].charAt(0)){case"+":try{diffs[diffsLength++]=[DIFF_INSERT,decodeURI(param)];
}catch(ex){throw new Error("Illegal escape in diff_fromDelta: "+param);}break;case"-":case"=":n=parseInt(param,10);
if(isNaN(n)||n<0){throw new Error("Invalid number in diff_fromDelta: "+param);}text=text1.substring(pointer,pointer+=n);
if(tokens[x].charAt(0)=="="){diffs[diffsLength++]=[DIFF_EQUAL,text];}else{diffs[diffsLength++]=[DIFF_DELETE,text];
}break;default:if(tokens[x]){throw new Error("Invalid diff operation in diff_fromDelta: "+tokens[x]);
}}}if(pointer!=text1.length){throw new Error("Delta length ("+pointer+") does not equal source text length ("+text1.length+").");
}return diffs;};this.match_main=function(text,pattern,loc){loc=Math.max(0,Math.min(loc,text.length));
if(text==pattern){return 0;}else{if(!text.length){return -1;}else{if(text.substring(loc,loc+pattern.length)==pattern){return loc;
}else{return this.match_bitap(text,pattern,loc);}}}};this.match_bitap=function(text,pattern,loc){if(pattern.length>this.matchMaxBits){throw new Error("Pattern too long for this browser.");
}var s=this.match_alphabet(pattern),_self=this;function match_bitapScore(e,x){var accuracy=e/pattern.length,proximity=Math.abs(loc-x);
if(!_self.matchDistance){return proximity?1:accuracy;}return accuracy+(proximity/_self.matchDistance);
}var score_threshold=this.matchThreshold,best_loc=text.indexOf(pattern,loc);if(best_loc!=-1){score_threshold=Math.min(match_bitapScore(0,best_loc),score_threshold);
}best_loc=text.lastIndexOf(pattern,loc+pattern.length);if(best_loc!=-1){score_threshold=Math.min(match_bitapScore(0,best_loc),score_threshold);
}best_loc=-1;var matchmask=1<<(pattern.length-1),bin_max=pattern.length+text.length,d=0,l=pattern.length,bin_min,bin_mid,last_rd,start,finish,rd,j,charMatch,score;
for(;d<l;d++){bin_min=0;bin_mid=bin_max;while(bin_min<bin_mid){if(match_bitapScore(d,loc+bin_mid)<=score_threshold){bin_min=bin_mid;
}else{bin_max=bin_mid;}bin_mid=Math.floor((bin_max-bin_min)/2+bin_min);}bin_max=bin_mid;
start=Math.max(1,loc-bin_mid+1);finish=Math.min(loc+bin_mid,text.length)+pattern.length;
rd=Array(finish+2);rd[finish+1]=(1<<d)-1;for(j=finish;j>=start;j--){charMatch=s[text.charAt(j-1)];
if(d===0){rd[j]=((rd[j+1]<<1)|1)&charMatch;}else{rd[j]=((rd[j+1]<<1)|1)&charMatch|(((last_rd[j+1]|last_rd[j])<<1)|1)|last_rd[j+1];
}if(rd[j]&matchmask){score=match_bitapScore(d,j-1);if(score<=score_threshold){score_threshold=score;
best_loc=j-1;if(best_loc>loc){start=Math.max(1,2*loc-best_loc);}else{break;}}}}if(match_bitapScore(d+1,loc)>score_threshold){break;
}last_rd=rd;}return best_loc;};this.match_alphabet=function(pattern){var s={},i=0,l=pattern.length;
for(;i<l;i++){s[pattern.charAt(i)]=0;}for(i=0;i<pattern.length;i++){s[pattern.charAt(i)]|=1<<(pattern.length-i-1);
}return s;};this.patch_addContext=function(patch,text){var pattern=text.substring(patch.start2,patch.start2+patch.length1),padding=0;
while(text.indexOf(pattern)!=text.lastIndexOf(pattern)&&pattern.length<this.matchMaxBits-this.patchMargin-this.patchMargin){padding+=this.patchMargin;
pattern=text.substring(patch.start2-padding,patch.start2+patch.length1+padding);
}padding+=this.patchMargin;var prefix=text.substring(patch.start2-padding,patch.start2);
if(prefix){patch.diffs.unshift([DIFF_EQUAL,prefix]);}var suffix=text.substring(patch.start2+patch.length1,patch.start2+patch.length1+padding);
if(suffix){patch.diffs.push([DIFF_EQUAL,suffix]);}patch.start1-=prefix.length;patch.start2-=prefix.length;
patch.length1+=prefix.length+suffix.length;patch.length2+=prefix.length+suffix.length;
};this.patch_make=function(a,opt_b,opt_c){var text1,diffs;if(typeof a=="string"&&typeof opt_b=="string"&&typeof opt_c=="undefined"){text1=a;
diffs=this.diff_main(text1,opt_b,true);if(diffs.length>2){this.diff_cleanupSemantic(diffs);
this.diff_cleanupEfficiency(diffs);}}else{if(typeof a=="object"&&typeof opt_b=="undefined"&&typeof opt_c=="undefined"){diffs=a;
text1=this.diff_text1(diffs);}else{if(typeof a=="string"&&typeof opt_b=="object"&&typeof opt_c=="undefined"){text1=a;
diffs=opt_b;}else{if(typeof a=="string"&&typeof opt_b=="string"&&typeof opt_c=="object"){text1=a;
diffs=opt_c;}else{throw new Error("Unknown call format to patch_make.");}}}}if(diffs.length===0){return[];
}var patches=[],patch=new patch_obj(),patchDiffLength=0,char_count1=0,char_count2=0,prepatch_text=text1,postpatch_text=text1,x=0,l=diffs.length,diff_type,diff_text;
for(;x<l;x++){diff_type=diffs[x][0];diff_text=diffs[x][1];if(!patchDiffLength&&diff_type!==DIFF_EQUAL){patch.start1=char_count1;
patch.start2=char_count2;}switch(diff_type){case DIFF_INSERT:patch.diffs[patchDiffLength++]=diffs[x];
patch.length2+=diff_text.length;postpatch_text=postpatch_text.substring(0,char_count2)+diff_text+postpatch_text.substring(char_count2);
break;case DIFF_DELETE:patch.length1+=diff_text.length;patch.diffs[patchDiffLength++]=diffs[x];
postpatch_text=postpatch_text.substring(0,char_count2)+postpatch_text.substring(char_count2+diff_text.length);
break;case DIFF_EQUAL:if(diff_text.length<=2*this.patchMargin&&patchDiffLength&&l!=x+1){patch.diffs[patchDiffLength++]=diffs[x];
patch.length1+=diff_text.length;patch.length2+=diff_text.length;}else{if(diff_text.length>=2*this.patchMargin){if(patchDiffLength){this.patch_addContext(patch,prepatch_text);
patches.push(patch);patch=new patch_obj();patchDiffLength=0;prepatch_text=postpatch_text;
char_count1=char_count2;}}}break;}if(diff_type!==DIFF_INSERT){char_count1+=diff_text.length;
}if(diff_type!==DIFF_DELETE){char_count2+=diff_text.length;}}if(patchDiffLength){this.patch_addContext(patch,prepatch_text);
patches.push(patch);}return patches;};var patch_deepCopy=function(patches){var patchesCopy=[],x=0,l=patches.length,patch,patchCopy,y;
for(;x<l;x++){patch=patches[x];patchCopy=new patch_obj();patchCopy.diffs=[];for(y=0;
y<patch.diffs.length;y++){patchCopy.diffs[y]=patch.diffs[y].slice();}patchCopy.start1=patch.start1;
patchCopy.start2=patch.start2;patchCopy.length1=patch.length1;patchCopy.length2=patch.length2;
patchesCopy[x]=patchCopy;}return patchesCopy;};this.patch_apply=function(patches,text){if(patches.length==0){return[text,[]];
}patches=patch_deepCopy(patches);var nullPadding=this.patch_addPadding(patches);
text=nullPadding+text+nullPadding;this.patch_splitMax(patches);var delta=0,results=[],x=0,l=patches.length,patch,expected_loc,text1,start_loc,end_loc,text2,diffs,index1,index2,y,mod,l2;
for(;x<l;x++){patch=patches[x];expected_loc=patch.start2+delta;text1=this.diff_text1(patch.diffs);
end_loc=-1;if(text1.length>this.matchMaxBits){start_loc=this.match_main(text,text1.substring(0,this.matchMaxBits),expected_loc);
if(start_loc!=-1){end_loc=this.match_main(text,text1.substring(text1.length-this.matchMaxBits),expected_loc+text1.length-this.matchMaxBits);
if(end_loc==-1||start_loc>=end_loc){start_loc=-1;}}}else{start_loc=this.match_main(text,text1,expected_loc);
}if(start_loc==-1){results[x]=false;delta-=patch.length2-patch.length1;}else{results[x]=true;
delta=start_loc-expected_loc;if(end_loc==-1){text2=text.substring(start_loc,start_loc+text1.length);
}else{text2=text.substring(start_loc,end_loc+this.matchMaxBits);}if(text1==text2){text=text.substring(0,start_loc)+this.diff_text2(patch.diffs)+text.substring(start_loc+text1.length);
}else{diffs=this.diff_main(text1,text2,false);if(text1.length>this.matchMaxBits&&this.diff_levenshtein(diffs)/text1.length>this.patchDeleteThreshold){results[x]=false;
}else{this.diff_cleanupSemanticLossless(diffs);index1=0;for(y=0,l2=patch.diffs.length;
y<l2;y++){mod=patch.diffs[y];if(mod[0]!==DIFF_EQUAL){index2=this.diff_xIndex(diffs,index1);
}if(mod[0]===DIFF_INSERT){text=text.substring(0,start_loc+index2)+mod[1]+text.substring(start_loc+index2);
}else{if(mod[0]===DIFF_DELETE){text=text.substring(0,start_loc+index2)+text.substring(start_loc+this.diff_xIndex(diffs,index1+mod[1].length));
}}if(mod[0]!==DIFF_DELETE){index1+=mod[1].length;}}}}}}text=text.substring(nullPadding.length,text.length-nullPadding.length);
return[text,results];};this.patch_addPadding=function(patches){var paddingLength=this.patchMargin,nullPadding="",x=1,l=patches.length;
for(;x<=paddingLength;x++){nullPadding+=String.fromCharCode(x);}for(x=0;x<l;x++){patches[x].start1+=paddingLength;
patches[x].start2+=paddingLength;}var patch=patches[0],diffs=patch.diffs,extraLength;
if(diffs.length==0||diffs[0][0]!=DIFF_EQUAL){diffs.unshift([DIFF_EQUAL,nullPadding]);
patch.start1-=paddingLength;patch.start2-=paddingLength;patch.length1+=paddingLength;
patch.length2+=paddingLength;}else{if(paddingLength>diffs[0][1].length){extraLength=paddingLength-diffs[0][1].length;
diffs[0][1]=nullPadding.substring(diffs[0][1].length)+diffs[0][1];patch.start1-=extraLength;
patch.start2-=extraLength;patch.length1+=extraLength;patch.length2+=extraLength;
}}patch=patches[patches.length-1];diffs=patch.diffs;if(diffs.length==0||diffs[diffs.length-1][0]!=DIFF_EQUAL){diffs.push([DIFF_EQUAL,nullPadding]);
patch.length1+=paddingLength;patch.length2+=paddingLength;}else{if(paddingLength>diffs[diffs.length-1][1].length){extraLength=paddingLength-diffs[diffs.length-1][1].length;
diffs[diffs.length-1][1]+=nullPadding.substring(0,extraLength);patch.length1+=extraLength;
patch.length2+=extraLength;}}return nullPadding;};this.patch_splitMax=function(patches){var x=0,bigpatch,patch_size,start1,start2,precontext,patch,empty,diff_type,diff_text,postcontext;
for(;x<patches.length;x++){if(patches[x].length1<=this.matchMaxBits){continue;}bigpatch=patches[x];
patches.splice(x--,1);patch_size=this.matchMaxBits;start1=bigpatch.start1;start2=bigpatch.start2;
precontext="";while(bigpatch.diffs.length!==0){patch=new patch_obj();empty=true;
patch.start1=start1-precontext.length;patch.start2=start2-precontext.length;if(precontext!==""){patch.length1=patch.length2=precontext.length;
patch.diffs.push([DIFF_EQUAL,precontext]);}while(bigpatch.diffs.length!==0&&patch.length1<patch_size-this.patchMargin){diff_type=bigpatch.diffs[0][0];
diff_text=bigpatch.diffs[0][1];if(diff_type===DIFF_INSERT){patch.length2+=diff_text.length;
start2+=diff_text.length;patch.diffs.push(bigpatch.diffs.shift());empty=false;}else{if(diff_type===DIFF_DELETE&&patch.diffs.length==1&&patch.diffs[0][0]==DIFF_EQUAL&&diff_text.length>2*patch_size){patch.length1+=diff_text.length;
start1+=diff_text.length;empty=false;patch.diffs.push([diff_type,diff_text]);bigpatch.diffs.shift();
}else{diff_text=diff_text.substring(0,patch_size-patch.length1-this.patchMargin);
patch.length1+=diff_text.length;start1+=diff_text.length;if(diff_type===DIFF_EQUAL){patch.length2+=diff_text.length;
start2+=diff_text.length;}else{empty=false;}patch.diffs.push([diff_type,diff_text]);
if(diff_text==bigpatch.diffs[0][1]){bigpatch.diffs.shift();}else{bigpatch.diffs[0][1]=bigpatch.diffs[0][1].substring(diff_text.length);
}}}}precontext=this.diff_text2(patch.diffs).substring(precontext.length-this.patchMargin);
postcontext=this.diff_text1(bigpatch.diffs).substring(0,this.patchMargin);if(postcontext!==""){patch.length1+=postcontext.length;
patch.length2+=postcontext.length;if(patch.diffs.length!==0&&patch.diffs[patch.diffs.length-1][0]===DIFF_EQUAL){patch.diffs[patch.diffs.length-1][1]+=postcontext;
}else{patch.diffs.push([DIFF_EQUAL,postcontext]);}}if(!empty){patches.splice(++x,0,patch);
}}}};this.patch_toText=function(patches){var text=[],x=0,l=patches.length;for(;
x<l;x++){text[x]=patches[x];}return text.join("");};this.patch_fromText=function(textline){var patches=[];
if(!textline){return patches;}textline=textline.replace(/%00/g,"\0");var text=textline.split("\n"),textPointer=0,len=text.length,re=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/,m,patch,sign,line;
while(textPointer<len){m=text[textPointer].match(re);if(!m){throw new Error("Invalid patch string: "+text[textPointer]);
}patch=new patch_obj();patches.push(patch);patch.start1=parseInt(m[1],10);if(m[2]===""){patch.start1--;
patch.length1=1;}else{if(m[2]=="0"){patch.length1=0;}else{patch.start1--;patch.length1=parseInt(m[2],10);
}}patch.start2=parseInt(m[3],10);if(m[4]===""){patch.start2--;patch.length2=1;}else{if(m[4]=="0"){patch.length2=0;
}else{patch.start2--;patch.length2=parseInt(m[4],10);}}textPointer++;while(textPointer<len){sign=text[textPointer].charAt(0);
try{line=decodeURI(text[textPointer].substring(1));}catch(ex){throw new Error("Illegal escape in patch_fromText: "+line);
}if(sign=="-"){patch.diffs.push([DIFF_DELETE,line]);}else{if(sign=="+"){patch.diffs.push([DIFF_INSERT,line]);
}else{if(sign==" "){patch.diffs.push([DIFF_EQUAL,line]);}else{if(sign=="@"){break;
}else{if(sign===""){}else{throw new Error("Invalid patch mode '"+sign+"' in: "+line);
}}}}}textPointer++;}}return patches;};})();apf.pasteWindow=function(str){var win=window.open("about:blank");
win.document.write(str);};apf.xmlEntityMap={quot:"34",amp:"38",apos:"39",lt:"60",gt:"62",nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",agrave:"192",aacute:"193",acirc:"194",atilde:"195",auml:"196",aring:"197",aelig:"198",ccedil:"199",egrave:"200",eacute:"201",ecirc:"202",euml:"203",igrave:"204",iacute:"205",icirc:"206",iuml:"207",eth:"208",ntilde:"209",ograve:"210",oacute:"211",ocirc:"212",otilde:"213",ouml:"214",times:"215",oslash:"216",ugrave:"217",uacute:"218",ucirc:"219",uuml:"220",yacute:"221",thorn:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",yuml:"255",oelig:"338",oelig:"339",scaron:"352",scaron:"353",yuml:"376",fnof:"402",circ:"710",tilde:"732",alpha:"913",beta:"914",gamma:"915",delta:"916",epsilon:"917",zeta:"918",eta:"919",theta:"920",iota:"921",kappa:"922",lambda:"923",mu:"924",nu:"925",xi:"926",omicron:"927",pi:"928",rho:"929",sigma:"931",tau:"932",upsilon:"933",phi:"934",chi:"935",psi:"936",omega:"937",alpha:"945",beta:"946",gamma:"947",delta:"948",epsilon:"949",zeta:"950",eta:"951",theta:"952",iota:"953",kappa:"954",lambda:"955",mu:"956",nu:"957",xi:"958",omicron:"959",pi:"960",rho:"961",sigmaf:"962",sigma:"963",tau:"964",upsilon:"965",phi:"966",chi:"967",psi:"968",omega:"969",thetasym:"977",upsih:"978",piv:"982",ensp:"8194",emsp:"8195",thinsp:"8201",zwnj:"8204",zwj:"8205",lrm:"8206",rlm:"8207",ndash:"8211",mdash:"8212",lsquo:"8216",rsquo:"8217",sbquo:"8218",ldquo:"8220",rdquo:"8221",bdquo:"8222",dagger:"8224",dagger:"8225",bull:"8226",hellip:"8230",permil:"8240",prime:"8242",prime:"8243",lsaquo:"8249",rsaquo:"8250",oline:"8254",frasl:"8260",euro:"8364",image:"8465",weierp:"8472",real:"8476",trade:"8482",alefsym:"8501",larr:"8592",uarr:"8593",rarr:"8594",darr:"8595",harr:"8596",crarr:"8629",larr:"8656",uarr:"8657",rarr:"8658",darr:"8659",harr:"8660",forall:"8704",part:"8706",exist:"8707",empty:"8709",nabla:"8711",isin:"8712",notin:"8713",ni:"8715",prod:"8719",sum:"8721",minus:"8722",lowast:"8727",radic:"8730",prop:"8733",infin:"8734",ang:"8736",and:"8743",or:"8744",cap:"8745",cup:"8746","int":"8747",there4:"8756",sim:"8764",cong:"8773",asymp:"8776",ne:"8800",equiv:"8801",le:"8804",ge:"8805",sub:"8834",sup:"8835",nsub:"8836",sube:"8838",supe:"8839",oplus:"8853",otimes:"8855",perp:"8869",sdot:"8901",lceil:"8968",rceil:"8969",lfloor:"8970",rfloor:"8971",lang:"9001",rang:"9002",loz:"9674",spades:"9824",clubs:"9827",hearts:"9829",diams:"9830"};
apf.htmlentities=function(str){return str.escapeHTML();};apf.xmlentities=function(str){return str.replace(/&([a-z]+);/gi,function(a,m){if(apf.xmlEntityMap[m=m.toLowerCase()]){return"&#"+apf.xmlEntityMap[m]+";";
}return a;});};apf.html_entity_decode=function(str){return(str||"").replace(/\&\#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ");
};apf.isCharacter=function(charCode){return(charCode<112||charCode>122)&&(charCode==32||charCode>42||charCode==8);
};apf.randomGenerator={d:new Date(),seed:null,A:48271,M:2147483647,Q:null,R:null,oneOverM:null,generate:function(lnr,unr){if(this.seed==null){this.seed=2345678901+(this.d.getSeconds()*16777215)+(this.d.getMinutes()*65535);
}this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1/this.M;return Math.floor((unr-lnr+1)*this.next()+lnr);
},next:function(){var hi=this.seed/this.Q;var lo=this.seed%this.Q;var test=this.A*lo-this.R*hi;
if(test>0){this.seed=test;}else{this.seed=test+this.M;}return(this.seed*this.oneOverM);
}};apf.getNoCacheUrl=function(url){return url+(url.indexOf("?")==-1?"?":"&")+"nocache="+new Date().getTime();
};apf.parseExpression=function(str){if(!apf.parseExpression.regexp.test(str)){return str;
}try{return eval(RegExp.$1);}catch(e){throw new Error(apf.formatErrorString(0,null,"Parsing Expression","Invalid expression given '"+str+"'"));
}};apf.parseExpression.regexp=/^\{([\s\S]*)\}$/;apf.formatNumber=function(num,prefix){var nr=parseFloat(num);
if(!nr){return num;}var str=new String(Math.round(nr*100)/100).replace(/(\.\d?\d?)$/,function(m1){return m1.pad(3,"0",apf.PAD_RIGHT);
});if(str.indexOf(".")==-1){str+=".00";}return prefix+str;};apf.jsexec=function(str,win){if(!str){return str;
}if(!win){win=self;}if(apf.isO3){eval(str,self);}else{if(apf.hasExecScript){win.execScript(str);
}else{var head=win.document.getElementsByTagName("head")[0];if(head){var script=win.document.createElement("script");
script.setAttribute("type","text/javascript");script.text=str;head.appendChild(script);
head.removeChild(script);}else{eval(str,win);}}}return str;};apf.K=function(){};
apf.isNumber=function(value){return parseFloat(value)==value;};apf.isArray=function(value){return Object.prototype.toString.call(value)==="[object Array]";
};apf.isTrue=function(c){return(c===true||c==="true"||c==="on"||typeof c=="number"&&c>0||c==="1");
};apf.isFalse=function(c){return(c===false||c==="false"||c==="off"||c===0||c==="0");
};apf.isNot=function(c){return(!c&&typeof c!="string"&&c!==0||(typeof c=="number"&&!isFinite(c)));
};apf.removePathContext=function(base,url){if(!url){return"";}if(url.indexOf(base)>-1){return url.substr(base.length);
}return url;};apf.cancelBubble=function(e,o,noPropagate){if(e.stopPropagation){e.stopPropagation();
}else{e.cancelBubble=true;}if(!noPropagate){if(o&&o.$ext&&o.$ext["on"+(e.type||e.name)]){o.$ext["on"+(e.type||e.name)](e);
}apf.window.$mousedown(e);}};apf.destroyHtmlNode=function(element){if(!element){return;
}if(!apf.isIE||element.ownerDocument!=document){if(element.parentNode){element.parentNode.removeChild(element);
}return;}var garbageBin=document.getElementById("IELeakGarbageBin");if(!garbageBin){garbageBin=document.createElement("DIV");
garbageBin.id="IELeakGarbageBin";garbageBin.style.display="none";document.body.appendChild(garbageBin);
}garbageBin.appendChild(element);garbageBin.innerHTML="";};apf.getRules=function(node){var rules={};
for(var w=node.firstChild;w;w=w.nextSibling){if(w.nodeType!=1){continue;}else{if(!rules[w[apf.TAGNAME]]){rules[w[apf.TAGNAME]]=[];
}rules[w[apf.TAGNAME]].push(w);}}return rules;};apf.isCoord=function(n){return n||n===0;
};apf.getCoord=function(n,other){return n||n===0?n:other;};apf.getBox=function(value,base){if(!base){base=0;
}if(value==null||(!parseInt(value)&&parseInt(value)!=0)){return[0,0,0,0];}var x=String(value).splitSafe(" ");
for(var i=0;i<x.length;i++){x[i]=parseInt(x[i])||0;}switch(x.length){case 1:x[1]=x[0];
x[2]=x[0];x[3]=x[0];break;case 2:x[2]=x[0];x[3]=x[1];break;case 3:x[3]=x[1];break;
}return x;};apf.getNode=function(data,tree){var nc=0;if(data!=null){for(var i=0;
i<data.childNodes.length;i++){if(data.childNodes[i].nodeType==1){if(nc==tree[0]){data=data.childNodes[i];
if(tree.length>1){tree.shift();data=this.getNode(data,tree);}return data;}nc++;
}}}return null;};apf.getFirstElement=function(xmlNode){try{xmlNode.firstChild.nodeType==1?xmlNode.firstChild:xmlNode.firstChild.nextSibling;
}catch(e){throw new Error(apf.formatErrorString(1052,null,"Xml Selection","Could not find element:\n"+(xmlNode?xmlNode.xml:"null")));
}return xmlNode.firstChild.nodeType==1?xmlNode.firstChild:xmlNode.firstChild.nextSibling;
};apf.getLastElement=function(xmlNode){try{xmlNode.lastChild.nodeType==1?xmlNode.lastChild:xmlNode.lastChild.nextSibling;
}catch(e){throw new Error(apf.formatErrorString(1053,null,"Xml Selection","Could not find last element:\n"+(xmlNode?xmlNode.xml:"null")));
}return xmlNode.lastChild.nodeType==1?xmlNode.lastChild:xmlNode.lastChild.previousSibling;
};apf.selectTextHtml=function(oHtml){if(!apf.hasMsRangeObject){return;}var r=document.selection.createRange();
try{r.moveToElementText(oHtml);}catch(e){}r.select();};apf.visibilitymanager=function(){var tree={};
var _self=this;var inited=false;this.check=function(amlNode,type,callback){if(amlNode.$ext.offsetHeight||amlNode.$ext.offsetWidth){return true;
}if(amlNode.$visibleCheck){if(amlNode.$visibleCheck[type]){return;}}else{amlNode.$visibleCheck={};
}function cleanup(setInsertion){var p=amlNode;while(p){p.removeEventListener("prop.visible",check);
p.removeEventListener("DOMNodeRemoved",remove);p.removeEventListener("DOMNodeRemovedFromDocument",remove);
if(setInsertion){p.addEventListener("DOMNodeInserted",add);}p=p.parentNode||p.$parentNode;
}delete amlNode.$visibleCheck[type];}function check(e){if(!amlNode.$ext.offsetHeight&&!amlNode.$ext.offsetWidth){return;
}callback.call(amlNode);cleanup();}function remove(e){if(e.currentTarget!=this){return;
}cleanup(e.name=="DOMNodeRemoved");}function add(){var p=amlNode;while(p){p.addEventListener("prop.visible",check);
p.addEventListener("DOMNodeRemoved",remove);p.addEventListener("DOMNodeRemovedFromDocument",remove);
p.removeEventListener("DOMNodeInserted",add);p=p.parentNode||p.$parentNode;}amlNode.$visibleCheck[type]=true;
}add();return false;};this.permanent=function(amlNode,show,hide){var state=amlNode.$ext.offsetHeight&&amlNode.$ext.offsetWidth;
function check(e){var newState=amlNode.$ext.offsetHeight&&amlNode.$ext.offsetWidth;
if(newState==state){return;}if(newState){show();}else{hide();}state=newState;}var p=amlNode;
while(p){p.addEventListener("prop.visible",check);p=p.parentNode||p.$parentNode;
}return state;};};apf.isChildOf=function(pNode,childnode,orItself){if(!pNode||!childnode){return false;
}if(childnode.nodeType==2){childnode=childnode.ownerElement||childnode.selectSingleNode("..");
}if(orItself&&pNode==childnode){return true;}var loopnode=childnode.parentNode;
while(loopnode){if(loopnode==pNode){return true;}loopnode=loopnode.parentNode;}return false;
};apf.escapeXML=function(str){return((str||"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;"));
};apf.isOnlyChild=function(node,nodeType){if(!node||!node.parentNode||nodeType&&nodeType.indexOf(node.nodeType)==-1){return false;
}var i,l,cnode,nodes=node.parentNode.childNodes;for(i=0,l=nodes.length;i<l;i++){cnode=nodes[i];
if(cnode.nodeType==1&&cnode!=node){return false;}if(cnode.nodeType==3&&!cnode.nodeValue.trim()){return false;
}}return true;};apf.getChildNumber=function(node,fromList){if(!node){return -1;
}var p=node.parentNode,j=0;if(!p){return 0;}if(!fromList){fromList=p.childNodes;
}if(fromList.indexOf){var idx=fromList.indexOf(node);return idx==-1?fromList.length:idx;
}for(var i=0,l=fromList.length;i<l;i++){if(fromList[i]==node){return j;}j++;}return j;
};apf.mergeXml=function(XMLRoot,parentNode,options){if(typeof parentNode!="object"){parentNode=getElementById(parentNode);
}if(options&&options.clearContents){var node,j,i,nodes=parentNode.selectNodes("descendant::node()[@"+apf.xmldb.xmlListenTag+"]");
for(i=nodes.length-1;i>=0;i--){var s=nodes[i].getAttribute(apf.xmldb.xmlListenTag).split(";");
for(j=s.length-1;j>=0;j--){node=apf.all[s[j]];if(!node){continue;}if(node.dataParent&&node.dataParent.xpath){node.dataParent.parent.signalXmlUpdate[node.$uniqueId]=true;
}else{if(node.$model){node.$model.$waitForXml(node);}}}}nodes=parentNode.childNodes;
for(i=nodes.length-1;i>=0;i--){parentNode.removeChild(nodes[i]);}}if(options&&options.start){var reserved,beforeNode,nodes,doc,i,l,marker=options.marker;
if(!marker){}if(marker.getAttribute("start")-options.start==0){marker.setAttribute("start",options.start+options.length);
reserved=parseInt(marker.getAttribute("reserved"));marker.setAttribute("reserved",reserved+options.length);
beforeNode=marker;}else{if(options.start+options.length==marker.getAttribute("end")){marker.setAttribute("end",options.start+options.length);
beforeNode=marker.nextSibling;reserved=parseInt(marker.getAttribute("reserved"))+parseInt(marker.getAttribute("end"))-options.length;
}else{var m2=marker.parentNode.insertBefore(marker.cloneNode(true),marker);m2.setAttribute("end",options.start-1);
marker.setAttribute("start",options.start+options.length);reserved=parseInt(marker.getAttribute("reserved"));
marker.setAttribute("reserved",reserved+options.length);beforeNode=marker;}}nodes=XMLRoot.childNodes;
if(parentNode.ownerDocument.importNode){doc=parentNode.ownerDocument;for(i=0,l=nodes.length;
i<l;i++){parentNode.insertBefore(doc.importNode(nodes[i],true),beforeNode).setAttribute(apf.xmldb.xmlIdTag,options.documentId+"|"+(reserved+i));
}}else{for(i=nodes.length-1;i>=0;i--){parentNode.insertBefore(nodes[0],beforeNode).setAttribute(apf.xmldb.xmlIdTag,options.documentId+"|"+(reserved+i));
}}}else{beforeNode=options&&options.beforeNode?options.beforeNode:apf.getNode(parentNode,[0]);
nodes=XMLRoot.childNodes;if(parentNode.ownerDocument.importNode){doc=parentNode.ownerDocument;
for(i=0,l=nodes.length;i<l;i++){parentNode.insertBefore(doc.importNode(nodes[i],true),beforeNode);
}}else{for(i=nodes.length-1;i>=0;i--){parentNode.insertBefore(nodes[0],beforeNode);
}}}if(options&&options.copyAttributes){var attr=XMLRoot.attributes;for(i=0;i<attr.length;
i++){if(attr[i].nodeName!=apf.xmldb.xmlIdTag){parentNode.setAttribute(attr[i].nodeName,attr[i].nodeValue);
}}}return parentNode;};apf.setNodeValue=function(xmlNode,nodeValue,applyChanges,options){if(!xmlNode){return;
}var undoObj,xpath,newNodes;if(options){undoObj=options.undoObj;xpath=options.xpath;
newNodes=options.newNodes;undoObj.extra.oldValue=options.forceNew?"":apf.queryValue(xmlNode,xpath);
undoObj.xmlNode=xmlNode;if(xpath){xmlNode=apf.createNodeFromXpath(xmlNode,xpath,newNodes,options.forceNew);
}undoObj.extra.appliedNode=xmlNode;}if(xmlNode.nodeType==1){if(!xmlNode.firstChild){xmlNode.appendChild(xmlNode.ownerDocument.createTextNode(""));
}xmlNode.firstChild.nodeValue=apf.isNot(nodeValue)?"":nodeValue;if(applyChanges){apf.xmldb.applyChanges("text",xmlNode,undoObj);
}}else{if(apf.isO3&&xmlNode.nodeType==2){nodeValue=nodeValue.replace(/&/g,"&amp;");
}var oldValue=xmlNode.nodeValue;xmlNode.nodeValue=apf.isNot(nodeValue)?"":nodeValue;
if(undoObj){undoObj.name=xmlNode.nodeName;}if(xmlNode.$triggerUpdate){xmlNode.$triggerUpdate(null,oldValue);
}if(applyChanges){apf.xmldb.applyChanges(xmlNode.nodeType==2?"attribute":"text",xmlNode.parentNode||xmlNode.ownerElement||xmlNode.selectSingleNode(".."),undoObj);
}}if(applyChanges){var node;if(xpath){var node=undoObj.xmlNode;if(node.nodeType==9){node=node.documentElement;
xpath=xpath.replace(/^[^\/]*\//,"");}}else{node=xmlNode;}apf.xmldb.applyRDB(["setValueByXpath",node,nodeValue,xpath,options&&options.forceNew],undoObj||{xmlNode:xmlNode});
}};apf.setQueryValue=function(xmlNode,xpath,value,local){var node=apf.createNodeFromXpath(xmlNode,xpath);
if(!node){return null;}apf.setNodeValue(node,value,!local);return node;};apf.removeQueryNode=function(xmlNode,xpath,local){var node=apf.queryNode(xmlNode,xpath);
if(!node){return false;}if(local){node.parentNode.removeChild(node);}else{apf.xmldb.removeNode(node);
}return node;};apf.queryValue=function(xmlNode,xpath){if(!xmlNode){return"";}if(xmlNode.nodeType==2){return xmlNode.nodeValue;
}if(xpath){xmlNode=xmlNode.selectSingleNode(xpath);if(!xmlNode){return"";}}return xmlNode.nodeType==1?(!xmlNode.firstChild?"":xmlNode.firstChild.nodeValue):xmlNode.nodeValue;
};apf.queryValues=function(xmlNode,xpath){var out=[];if(!xmlNode){return out;}var nodes=xmlNode.selectNodes(xpath);
if(!nodes.length){return out;}for(var i=0;i<nodes.length;i++){var n=nodes[i];if(n.nodeType==1){n=n.firstChild;
}out.push(n.nodeValue||"");}return out;};apf.queryNodes=function(contextNode,sExpr){if(contextNode&&(apf.hasXPathHtmlSupport&&contextNode.selectSingleNode||!contextNode.style)){return contextNode.selectNodes(sExpr);
}return apf.XPath.selectNodes(sExpr,contextNode);};apf.queryNode=function(contextNode,sExpr){if(contextNode&&(apf.hasXPathHtmlSupport&&contextNode.selectSingleNode||!contextNode.style)){return contextNode.selectSingleNode(sExpr);
}var nodeList=apf.queryNodes(contextNode?contextNode:null,sExpr+(apf.isIE?"":"[1]"));
return nodeList.length>0?nodeList[0]:null;};apf.getInheritedAttribute=function(xml,attr,func){var result,avalue;
if(xml.nodeType!=1){xml=xml.parentNode;}while(xml&&(xml.nodeType!=1||!(result=attr&&((avalue=xml.getAttribute(attr))||typeof avalue=="string")||func&&func(xml)))){xml=xml.parentNode;
}if(avalue==""){return"";}return !result&&attr&&apf.config?apf.config[attr]:result;
};apf.createNodeFromXpath=function(contextNode,xPath,addedNodes,forceNew){var xmlNode,foundpath="",paths=xPath.replace(/('.*?')|(".*?")|\|/g,function(m,m1,m2){if(m1||m2){return m1||m2;
}return"-%-|-%-";}).split("-%-|-%-")[0].split(/\/(?!\/)/);if(!forceNew&&(xmlNode=contextNode.selectSingleNode(xPath))){return xmlNode;
}var len=paths.length-1;if(forceNew){if(paths[len].trim().match(/^\@(.*)$|^text\(\)$/)){len--;
}}if(!paths[0]){contextNode=contextNode.ownerDocument.documentElement;paths.shift();
paths.shift();len--;len--;}for(var addedNode,isAdding=false,i=0;i<len;i++){if(!isAdding&&contextNode.selectSingleNode(foundpath+(i!=0?"/":"")+paths[i])){foundpath+=(i!=0?"/":"")+paths[i];
continue;}var isAddId=paths[i].match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(!isAddId&&paths[i].match(/\@|\[.*\]|\(.*\)/)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+xPath));
}if(!isAddId&&paths[i].match(/\/\//)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+xPath));
}if(isAddId){paths[i]=isAddId[1];}isAdding=true;addedNode=contextNode.selectSingleNode(foundpath||".").appendChild(contextNode.ownerDocument.createElement(paths[i]));
if(isAddId){addedNode.setAttribute(isAddId[2],isAddId[3]);foundpath+=(foundpath?"/":"")+isAddId[0];
}else{foundpath+=(foundpath?"/":"")+paths[i];}if(addedNodes){addedNodes.push(addedNode);
}}if(!foundpath){foundpath=".";}if(addedNodes){addedNodes.foundpath=foundpath;}var newNode,lastpath=paths[len],doc=contextNode.nodeType==9?contextNode:contextNode.ownerDocument;
do{if(lastpath.match(/^\@(.*)$/)){(newNode||contextNode.selectSingleNode(foundpath)).setAttributeNode(newNode=doc.createAttribute(RegExp.$1));
}else{if(lastpath.trim()=="text()"){newNode=(newNode||contextNode.selectSingleNode(foundpath)).appendChild(doc.createTextNode(""));
}else{var hasId=lastpath.match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(hasId){lastpath=hasId[1];
}newNode=(newNode||contextNode.selectSingleNode(foundpath)).appendChild(doc.createElement(lastpath));
if(hasId){newNode.setAttribute(hasId[2],hasId[3]);}}}if(addedNodes){addedNodes.push(newNode);
}foundpath+=(foundpath?"/":"")+paths[len];}while((lastpath=paths[++len]));return newNode;
};apf.convertMethods={json:function(xml){return JSON.stringify(apf.xml2json(xml));
},cgivars:function(xml,basename){if(!basename){basename="";}var value,name,sameNodes,j,l2,str=[],nodes=xml.childNodes,done={},i=0,l=nodes.length;
for(;i<l;++i){if(nodes[i].nodeType!=1){continue;}name=nodes[i].tagName;if(done[name]){continue;
}sameNodes=xml.selectNodes(name);if(sameNodes.length>1){done[name]=true;for(j=0,l2=sameNodes.length;
j<l2;j++){value=this.cgivars(sameNodes[j],basename+name+"["+j+"]");if(value){str.push(value);
}}}else{value=this.cgivars(nodes[i],basename+name);if(value){str.push(value);}}}var attr=xml.attributes;
for(i=0,l=attr.length;i<l;i++){if(attr[i].nodeValue){if(basename){str.push(basename+"["+attr[i].nodeName+"]="+escape(attr[i].nodeValue));
}else{str.push(attr[i].nodeName+"="+escape(attr[i].nodeValue));}}}if(str.length){return str.join("&");
}value=apf.queryValue(xml,"text()");if(basename&&value){return basename+"="+escape(value);
}return"";},cgiobjects:function(xml,basename,isSub,includeEmpty){if(!basename){basename="";
}var node,name,value,a,i,j,attr,attr_len,isOnly,nodes=xml.childNodes,output=[],tagNames={},nm="";
for(i=0;i<nodes.length;i++){node=nodes[i];if(node.nodeType==1){name=node.tagName;
isOnly=node.parentNode.selectNodes(name).length==1?true:false;if(typeof tagNames[name]=="undefined"){tagNames[name]=0;
}nm=basename+(isSub?"[":"")+name+(isSub?"]":"")+(isOnly?"":"["+tagNames[name]+"]");
attr=node.attributes;attr_len=node.attributes.length;if(attr_len>0){for(j=0;j<attr_len;
j++){if(!(a=attr[j]).nodeValue){continue;}output.push(nm+"[_"+a.nodeName+"]="+escape(a.nodeValue.trim()));
}}value=this.cgiobjects(node,nm,true);if(value.dataType!==1){output.push(value);
}else{if(node.firstChild&&node.firstChild.nodeValue.trim()){output.push(nm+(attr_len>0?"[_]=":"=")+escape(node.firstChild.nodeValue.trim()));
}else{if(attr_len==0){if(includeEmpty){output.push(nm);}}}}tagNames[name]++;}else{if(node.nodeType==3&&isSub){var nval=node.nodeValue;
if(nval&&nval.trim()!==""){output.push(basename+"="+escape(nval));}}}}if(!isSub&&xml.getAttribute("id")){output.push("id="+escape(xml.getAttribute("id")));
}if(output.length){return output.join("&");}return output;}};apf.convertXml=function(xml,to){return apf.convertMethods[to](xml);
};apf.getTextNode=function(x){for(var i=0,l=x.childNodes.length;i<l;++i){if(x.childNodes[i].nodeType==3||x.childNodes[i].nodeType==4){return x.childNodes[i];
}}return false;};apf.getBoundValue=function(amlNode,xmlRoot,applyChanges){if(!xmlRoot&&!amlNode.xmlRoot){return"";
}var xmlNode=amlNode.$getDataNode("value",amlNode.xmlRoot);return xmlNode?apf.queryValue(xmlNode):"";
};apf.getArrayFromNodelist=function(nodelist){for(var nodes=[],j=0,l=nodelist.length;
j<l;++j){nodes.push(nodelist[j]);}return nodes;};apf.serializeChildren=function(xmlNode){var node,s=[],nodes=xmlNode.childNodes,i=0,l=nodes.length;
for(;i<l;++i){s[i]=(node=nodes[i]).nodeType==1?node.xml||node.serialize():(node.nodeType==8?"":node.nodeValue);
}return s.join("");};apf.getXmlString=function(xmlNode){var xml=apf.xmldb.cleanNode(xmlNode.cloneNode(true));
return xml.xml||xml.serialize();};apf.getXml=function(strXml,noError,preserveWhiteSpace){return apf.getXmlDom(strXml,noError,preserveWhiteSpace).documentElement;
};apf.formatXml=function(strXml){strXml=strXml.trim();var lines=strXml.split("\n"),depth=0,i=0,l=lines.length;
for(;i<l;++i){lines[i]=lines[i].trim();}lines=lines.join("\n").replace(/\>\n/g,">").replace(/\>/g,">\n").replace(/\n\</g,"<").replace(/\</g,"\n<").split("\n");
lines.removeIndex(0);lines.removeIndex(lines.length);for(i=0,l=lines.length;i<l;
i++){lines[i]="    ".repeat((lines[i].match(/^\s*\<\//)?(depth==0)?0:--depth:(lines[i].match(/^\s*\<[^\?][^>]+[^\/]\>/)?depth++:depth)))+lines[i];
}if(!strXml){return"";}return lines.join("\n");};apf.xmlToXpath=function(xmlNode,xmlContext,useAID){if(!xmlNode){return"";
}if(useAID===true&&xmlNode.nodeType==1&&xmlNode.getAttribute(apf.xmldb.xmlIdTag)){return"//node()[@"+apf.xmldb.xmlIdTag+"='"+xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"']";
}if(apf!=this&&this.lookup&&this.select){var unique,def=this.lookup[xmlNode.tagName];
if(def){unique=xmlNode.selectSingleNode(def).nodeValue;return"//"+xmlNode.tagName+"["+def+"='"+unique+"']";
}for(var i=0,l=this.select.length;i<l;i++){if(xmlNode.selectSingleNode(this.select[i][0])){unique=xmlNode.selectSingleNode(this.select[i][1]).nodeValue;
return"//"+this.select[i][0]+"["+this.select[i][1]+"='"+unique+"']";}}}if(xmlNode==xmlContext){return".";
}if(xmlNode.nodeType!=2&&!xmlNode.parentNode&&!xmlNode.ownerElement){throw new Error(apf.formatErrorString(0,null,"Converting XML to Xpath","Error xml node without parent and non matching context cannot             be converted to xml.",xmlNode));
return false;}var str=[],lNode=xmlNode;if(lNode.nodeType==2){str.push("@"+lNode.nodeName);
lNode=lNode.ownerElement||xmlNode.selectSingleNode("..");}var id;while(lNode&&lNode.nodeType==1){if(lNode==xmlContext){break;
}str.unshift((lNode.nodeType==1?lNode.tagName:"text()")+"["+(useAID&&(id=lNode.nodeType==1&&lNode.getAttribute(apf.xmldb.xmlIdTag))?"@"+apf.xmldb.xmlIdTag+"='"+id+"'":(apf.getChildNumber(lNode,lNode.parentNode.selectNodes(lNode.nodeType==1?lNode.tagName:"text()"))+1))+"]");
lNode=lNode.parentNode;}return(str[0]=="/"||xmlContext&&xmlContext.nodeType==1?"":"/")+str.join("/");
};apf.xpathToXml=function(xpath,xmlNode){if(!xmlNode){throw new Error(apf.formatErrorString(0,null,"Converting Xpath to XML","Error context xml node is empty, thus xml node cannot              be found for '"+xpath+"'"));
return false;}return xmlNode.selectSingleNode(xpath);};apf.n=function(xml,xpath){return new apf.xmlset(xml,xpath,true);
};apf.b=function(xml,xpath){return new apf.xmlset(xml,xpath);};apf.b.$queue=[];
apf.b.$state=0;apf.xmlset=function(xml,xpath,local,previous){if(typeof(xml)=="string"){xml=apf.getXml(xml);
}this.$xml=xml;if(xml){this.$nodes=xml.dataType==apf.ARRAY?xml:(xpath?xml.selectNodes(xpath):[xml]);
}this.$xpath=xpath||".";this.$local=local;this.$previous=previous;};(function(){this.add=function(){};
this.begin=function(){apf.b.$state=1;return this;};this.commit=function(at,rmt,uri){if(apf.b.$queue.length){if(rmt){var _self=this;
rmt.addEventListener("rdbsend",function(e){if(!uri||e.uri==uri){_self.rdbstack=e.message;
rmt.removeEventListener("rdbsend",arguments.callee);}});}at.execute({action:"multicall",args:apf.b.$queue});
if(rmt){rmt.$processQueue(rmt);}}apf.b.$queue=[];apf.b.$state=0;return this;};this.rollback=function(){apf.b.$queue=[];
apf.b.$state=0;return this;};this.getRDBMessage=function(){return this.rdbstack||[];
};this.before=function(el){el=typeof el=="function"?el(i):el;for(var node,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];if(this.$local){node.parentNode.insertBefore(el,node);
}else{apf.xmldb.appendChild(node.parentNode,el,node);}}return this;};this.after=function(el){el=typeof el=="function"?el(i):el;
for(var node,i=0,l=this.$nodes.length;i<l;i++){node=this.$nodes[i];if(this.$local){node.parentNode.insertBefore(el,node.nextSibling);
}else{apf.xmldb.appendChild(node.parentNode,el,node.nextSibling);}}return this;
};this.andSelf=function(){};this.append=function(el){for(var node,child,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];child=typeof el=="function"?el(i,node):el;if(apf.b.$state){apf.b.$queue.push({action:"appendChild",args:[node,child]});
}else{if(this.$local){node.appendChild(child);}else{apf.xmldb.appendChild(node,child);
}}}return this;};this.appendTo=function(target){for(var i=0,l=this.$nodes.length;
i<l;i++){target.appendChild(this.$nodes[i]);}return this;};this.prepend=function(content){for(var node,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];node.insertBefore(typeof el=="function"?el(i,node):el,node.firstChild);
}return this;};this.prependTo=function(content){for(var i=0,l=this.$nodes.length;
i<l;i++){target.insertBefore(this.$nodes[i],target.firstChild);}return this;};this.attr=function(attrName,value){if(value===undefined){return this.$nodes&&this.$nodes[0]&&this.$nodes[0].getAttribute(attrName)||"";
}else{for(var i=0,l=this.$nodes.length;i<l;i++){if(apf.b.$state){apf.b.$queue.push({action:"setAttribute",args:[this.$nodes[i],attrName,value]});
}else{if(this.$local){this.$nodes[i].setAttribute(attrName,value);}else{apf.xmldb.setAttribute(this.$nodes[i],attrName,value);
}}}}return this;};this.removeAttr=function(attrName){for(var i=0,l=this.$nodes.length;
i<l;i++){if(apf.b.$state){apf.b.$queue.push({action:"removeAttribute",args:[this.$nodes[i],attrName]});
}else{if(this.$local){this.$nodes[i].removeAttribute(attrName);}else{apf.xmldb.removeAttribute(this.$nodes[i],attrName);
}}}return this;};this.xml=function(){var str=[];for(var i=0,l=this.$nodes.length;
i<l;i++){str.push(this.$nodes[i].xml);}return str.join("\n");};this.get=this.index=function(idx){if(idx==undefined){return apf.getChildNumber(this.$nodes[0],this.$nodes[0].parentNode.getElementsByTagName("*"));
}};this.eq=function(index){return index<0?this.$nodes[this.$nodes.length-index]:this.$nodes[index];
};this.size=this.length=function(){return this.$nodes.length;};this.load=function(url){};
this.next=function(selector){if(!selector){selector="node()[local-name()]";}return new apf.xmlset(this.$xml,"((following-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[1])[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.nextAll=function(selector){if(!selector){selector="node()[local-name()]";
}return new apf.xmlset(this.$xml,"(following-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.nextUntil=function(){};this.prev=function(selector){if(!selector){selector="node()[local-name()]";
}return new apf.xmlset(this.$xml,"((preceding-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[1])[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.prevAll=function(selector){if(!selector){selector="node()[local-name()]";
}return new apf.xmlset(this.$xml,"(preceding-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.not=function(){};this.parent=function(selector){return new apf.xmlset(this.$xml.parentNode,this.$local,this);
};this.parents=function(selector){};this.pushStack=function(){};this.replaceAll=function(){};
this.replaceWith=function(el){for(var node,child,i=0,l=this.$nodes.length;i<l;i++){node=this.$nodes[i];
child=typeof el=="function"?el(i,node):el;if(apf.b.$state){apf.b.$queue.push({action:"replaceNode",args:[child,node]});
}else{if(this.$local){node.parentNode.replaceChild(child,node);}else{apf.xmldb.replaceNode(child,node);
}}}return this;};this.siblings=function(selector){};this.text=function(){};this.toArray=function(){var arr=[];
for(var i=0,l=this.$nodes.length;i<l;i++){arr.push(this.$nodes[i]);}return arr;
};this.detach=function(selector){var items=[];for(var node,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];if(!node.selectSingleNode("self::node()["+selector+"]")){continue;
}if(apf.b.$state){apf.b.$queue.push({action:"removeNode",args:[node]});}else{if(this.$local){node.parentNode.removeChild(node);
}else{apf.xmldb.removeNode(node);}}items.push(node);}return new apf.xmlset(items,"",this.$local,this);
};this.remove=function(selector){for(var node,n=this.$nodes,i=n.length-1;i>=0;i--){node=n[i];
if(selector&&!node.selectSingleNode("self::node()["+selector+"]")){continue;}if(apf.b.$state){apf.b.$queue.push({action:"removeNode",args:[node]});
}else{if(this.$local){node.parentNode.removeChild(node);}else{apf.xmldb.removeNode(node);
}}}return this;};this.children=function(selector){var nodes=[];for(var node,child,i=0,l=this.$nodes.length;
i<l;i++){var list=(node=this.$nodes[i]).selectNodes(selector);for(var j=0,jl=list.length;
j<jl;j++){nodes.push(list[j]);}}return new apf.xmlset(nodes,null,this.$local,this);
};this.children2=function(selector){return new apf.xmlset(this.$xml,"("+this.$xpath+")/node()[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.has=this.find=function(path){return new apf.xmlset(this.$xml,"("+this.$xpath+")//"+path.split("|").join("|self::"),this.$local,this);
};this.query=function(path){return new apf.xmlset(this.$xml,"("+this.$xpath+")/"+path.split("|").join("|("+this.$xpath+")/"),this.$local,this);
};this.filter=function(filter){var newList=[];for(var i=0,l=this.$nodes.length;
i<l;i++){if(this.$nodes[i].selectSingleNode("self::node()["+filter+"]")){newList.push(this.$nodes[i]);
}}return new apf.xmlset(newList,null,this.$local,this);};this.end=function(){return this.$previous||this;
};this.is=function(selector){return this.filter(selector)?true:false;};this.contents=function(){return this.children("node()");
};this.has=function(){};this.val=function(value){if(value!==undefined){apf.setQueryValue(this.$xml,this.$xpath,value);
return this;}else{return apf.queryValue(this.$xml,this.$xpath);}};this.vals=function(){return apf.queryValues(this.$xml,this.$xpath);
};this.node=function(){return apf.queryNode(this.$xml,this.$xpath);};this.nodes=function(){return apf.queryNodes(this.$xml,this.$xpath);
};this.clone=function(deep){if(this.$nodes.length==1){return new apf.xmlset(this.$nodes[0].cloneNode(true),"",this.$local,this);
}var nodes=[];for(var i=0,l=this.$nodes.length;i<l;i++){nodes.push(this.$nodes[i].cloneNode(deep==undefined?true:deep));
}return new apf.xmlset(nodes,"",this.$local,this);};this.context=function(){return this.$xml;
};this.data=function(data){for(var i=0,l=this.$nodes.length;i<l;i++){apf.setQueryValue(this.$nodes[i],".",data);
}return this;};this.each=function(func){for(var i=0,l=this.$nodes.length;i<l;i++){func.call(this.$nodes[i],i);
}return this;};this.eachrev=function(func){for(var i=this.$nodes.length-1;i>=0;
i--){func.call(this.$nodes[i],i);}return this;};this.map=function(callback){var values=[];
for(var i=0,l=this.$nodes.length;i<l;i++){values.push(callback(this.$nodes[i]));
}return new apf.xmlset(values,"",this.$local,this);};this.empty=function(){this.children().detach();
return this;};this.first=function(){return new apf.xmlset(this.$xml,"("+this.$xpath+")[1]",this.$local,this);
};this.last=function(){return new apf.xmlset(this.$xml,"("+this.$xpath+")[last()]",this.$local,this);
};}).call(apf.xmlset.prototype);apf.xmlDiff=function(doc1,doc2){var debug=true,hash={},rules=[],appendRules=[],reorderRules=[],preserveWhiteSpace=doc1.ownerDocument.$domParser.preserveWhiteSpace,dt=new Date().getTime(),APPEND=1,UPDATE=2,REMOVE=3,SETATTRIBUTE=4,notFoundEl={},notFoundAttr={},foundEl={},foundTxt={},foundAttr={},curNode={include:{}},arr,arrPath,l,lPath,found,path,p,t,j,i,a,item,subitem,arrIndex,lastRule,prop,emptyArr=[],node;
(function createHash(el,curPath,hash){var i,nodes,attr,l,a,e,p;curPath+="/"+el.tagName;
if(l=(nodes=el.childNodes).length){for(i=0;i<l;i++){if((e=nodes[i]).nodeType==1){createHash(nodes[i],curPath,hash);
nodes[i].$childNumber=i;}else{p=curPath+"/"+e.nodeType,(hash[p]||(hash[p]=[])).push(e),e.$isValid=false;
e.$childNumber=i;}}}if(l=(attr=el.attributes).length){for(i=0;i<l;i++){p=curPath+"/@"+(a=attr[i]).nodeName,(hash[p]||(hash[p]=[])).push(a),a.$isValid=false;
}}(hash[curPath]||(hash[curPath]=[])).push(el);el.$isValid=false;if(el.$amlList){delete el.$amlList;
}})(doc1,"",hash);curNode.include[doc1.parentNode.$uniqueId]=doc1;(function match(el,curPath,hash,pNode,curParentNode,childNumber){var total,first,v,jl,item,include,i,nodes,attr,l,a,e,p,s,sh,tn,curNode,pcur,pcurl,id,count,node,max=0,found=[],pInclude={length:0},oldInclude=curParentNode.include;
curPath+="/"+el.tagName;if(!(s=hash[curPath])){(notFoundEl[curPath]||(notFoundEl[curPath]=[])).push({arr:null,node:el,curNode:curParentNode});
return false;}else{include=(curNode={}).include={};for(i=0,l=s.length;i<l;i++){if((item=s[i])){include[item.$uniqueId]=item;
}}include.length=l;}if(l=(nodes=el.childNodes).length){for(i=0;i<l;i++){if((e=nodes[i]).nodeType==1){match(e,curPath,hash,pNode,curNode,i);
}else{if((sh=hash[p=curPath+"/"+e.nodeType])){for(total=0,first=null,v=e.nodeValue,j=0,jl=sh.length;
j<jl;j++){if((tn=sh[j])&&tn.nodeValue==v){if(!first){first={node:e,index:j,arr:sh,curNode:curNode,pcur:[tn.parentNode.$uniqueId],found:[j],childNumber:i};
}else{first.found.push(j),first.pcur.push(tn.parentNode.$uniqueId);}total++;}}if(total){pcur=first.pcur,pcurl=pcur.length;
for(j=0;j<pcurl;j++){if(curNode[pcur[j]]){curNode[pcur[j]]+=(1/total);}else{curNode[pcur[j]]=(1/total);
}}(foundTxt[p]||(foundTxt[p]=[])).push(first);continue;}(notFoundEl[p]||(notFoundEl[p]=[])).push({arr:sh,node:e,curNode:curNode});
continue;}(notFoundEl[p]||(notFoundEl[p]=[])).push({isNew:true,arr:null,node:e,curNode:curNode});
}}}if(l=(attr=el.attributes).length){for(i=0;i<l;i++){pattr=curPath+"/@"+(a=attr[i]).nodeName;
if(sh=hash[pattr]){for(total=0,first=null,v=a.nodeValue,j=0,jl=sh.length;j<jl;j++){if((tn=sh[j])&&tn.nodeValue==v){if(!first){first={node:a,index:j,arr:sh,curNode:curNode,pcur:[tn.ownerElement.$uniqueId],found:[j]};
}else{first.found.push(j),first.pcur.push(tn.ownerElement.$uniqueId);}total++;}}if(total){pcur=first.pcur,pcurl=pcur.length;
for(j=0;j<pcurl;j++){if(curNode[pcur[j]]){curNode[pcur[j]]+=(1/total);}else{curNode[pcur[j]]=(1/total);
}}(foundAttr[pattr]||(foundAttr[pattr]=[])).push(first);continue;}(notFoundAttr[pattr]||(notFoundAttr[pattr]=[])).push({arr:sh,node:a,curNode:curNode});
continue;}(notFoundAttr[pattr]||(notFoundAttr[pattr]=[])).push({isNew:true,arr:null,node:a,curNode:curNode});
}}for(id in curNode){if(curNode[id]>max){max=curNode[id];count=1;}else{if(curNode[id]==max){count++;
}}}if(!max){count=s.length;for(i=count;i>=0;i--){if(!s[i]){continue;}pNode=(node=s[i]).parentNode;
if(node.$isValid||!include[node.$uniqueId]||!oldInclude[pNode.$uniqueId]){delete include[node.$uniqueId],count--;
continue;}if(!pInclude[pNode.$uniqueId]){pInclude[pNode.$uniqueId]=pNode,pInclude.length++;
}found.push(node);}}else{for(id in curNode){if(curNode[id]!=max){continue;}pNode=(node=apf.all[id]).parentNode;
if(node.$isValid||!include[node.$uniqueId]||!oldInclude[pNode.$uniqueId]){delete include[node.$uniqueId];
count--;continue;}if(!pInclude[pNode.$uniqueId]){pInclude[pNode.$uniqueId]=pNode,pInclude.length++;
}found.push(node);}}if(found.length){curParentNode.include=pInclude;}for(first=null,i=0,l=found.length;
i<l;i++){pNode=(item=found[i]).parentNode;if(curParentNode[pNode.$uniqueId]){curParentNode[pNode.$uniqueId]+=1/count;
}else{curParentNode[pNode.$uniqueId]=1/count;}if(count>1){if(!first){first={node:el,arr:s,curNode:curNode,curParentNode:curParentNode,found:found,childNumber:childNumber};
(foundEl[curPath]||(foundEl[curPath]=[])).push(first);}if(count>(item.$matchedNodes||0)){item.$matchedNodes=count;
}}else{item.$isValid=true;for(var j=s.length-1;j>=0;j--){if(s[j]==item){delete s[j];
break;}}}}if(!found.length){var found=[];for(var prop in curNode.include){if(prop=="length"){continue;
}found.push(curNode.include[prop]);}(foundEl[curPath]||(foundEl[curPath]=[])).push({arr:s,node:el,curParentNode:curParentNode,curNode:curNode,found:found,childNumber:childNumber});
}curNode.curNode=found[0],curNode.parent=curParentNode,curNode.curPath=curPath;
})(doc2,"",hash,doc1,curNode);function checkOrder(node1,node2){if(node1.$childNumber!=node2.childNumber){reorderRules.push([node1,node2.childNumber]);
}}function recurEl(path){var pathCollision=foundEl[path];if(!pathCollision){return;
}var curItem,curMatch,l,count,nMatch,j,i,potentialMatches,leastMatchNodes,pl,pNode;
for(i=0,pl=pathCollision.length;i<pl;i++){potentialMatches=(curItem=pathCollision[i]).found,leastMatchNodes=100000;
for(count=j=0,l=potentialMatches.length;j<l;j++){if((curMatch=potentialMatches[j]).$isValid){continue;
}nMatch=curMatch.$matchedNodes;if(nMatch<leastMatchNodes){leastMatchNodes=nMatch,count=1;
}else{if(nMatch==leastMatchNodes){count++;}}}if(count==1){for(j=0,l=potentialMatches.length;
j<l;j++){if(!(curMatch=potentialMatches[j]).$isValid&&curMatch.$matchedNodes==leastMatchNodes){curMatch.$isValid=true,curItem.curNode.curNode=curMatch;
checkOrder(curMatch,curItem);break;}}}else{if(count){var include=curItem.curParentNode.include;
if(include.length==1){pNode=curItem.curParentNode.curNode;for(j=0,l=potentialMatches.length;
j<l;j++){if(!(curMatch=potentialMatches[j]).$isValid&&curMatch.$matchedNodes==leastMatchNodes&&curMatch.parentNode==pNode){curMatch.$isValid=true,curItem.curNode.curNode=curMatch;
checkOrder(curMatch,curItem);break;}}continue;}recurEl(curItem.curParentNode.curPath);
pNode=curItem.curParentNode.curNode;for(j=0,l=potentialMatches.length;j<l;j++){if(!(curMatch=potentialMatches[j]).$isValid&&curMatch.$matchedNodes==leastMatchNodes&&curMatch.parentNode==pNode){curMatch.$isValid=true,curItem.curNode.curNode=curMatch;
checkOrder(curMatch,curItem);break;}}}else{var nodes=hash[path],foundLast=false;
for(var k=0;k<nodes.length;k++){if(nodes[k]&&!nodes[k].$isValid){nodes[k].$isValid=true;
curItem.curNode.curNode=nodes[k];checkOrder(nodes[k],curItem);foundLast=true;break;
}}if(!foundLast){curItem.curNode.isAdding=true;if(!curItem.curParentNode.isAdding){(notFoundEl[path]||(notFoundEl[path]=[])).push({isNew:true,arr:null,node:curItem.node,curNode:curItem.curParentNode});
}}}}}delete foundEl[path];}for(path in foundEl){recurEl(path);}for(path in foundTxt){arr=foundTxt[path],l=arr.length,arrPath=arr[0].arr;
var lost=[];for(i=0;i<l;i++){t=arr[i],arrIndex=t.found;if((p=t.curNode)&&(p=p.curNode)){if(arrPath[t.index]&&p==arrPath[t.index].parentNode){checkOrder(arrPath[t.index],t);
delete arrPath[t.index];}else{for(found=false,j=0;j<arrIndex.length;j++){if(arrPath[arrIndex[j]]&&arrPath[arrIndex[j]].parentNode==p){checkOrder(arrPath[arrIndex[j]],t);
delete arrPath[arrIndex[j]],found=true;break;}}if(!found&&!t.curNode.isAdding){(notFoundEl[path]||(notFoundEl[path]=[])).push(t);
}}}else{if(!t.curNode.isAdding){(notFoundEl[path]||(notFoundEl[path]=[])).push(t);
}}}}for(path in foundAttr){arr=foundAttr[path],l=arr.length,arrPath=arr[0].arr;
for(i=0;i<l;i++){t=arr[i],arrIndex=t.found;if((p=t.curNode)&&(p=p.curNode)){if(arrPath[t.index]&&p==arrPath[t.index].ownerElement){delete arrPath[t.index];
}else{for(found=false,j=0;j<arrIndex.length;j++){if(arrPath[arrIndex[j]]&&arrPath[arrIndex[j]].ownerElement==p){delete arrPath[arrIndex[j]],found=true;
break;}}if(!found&&!t.curNode.isAdding){(notFoundAttr[path]||(notFoundAttr[path]=[])).push(t);
}}}else{if(!t.curNode.isAdding){(notFoundAttr[path]||(notFoundAttr[path]=[])).push(t);
}}}}for(path in notFoundAttr){arr=notFoundAttr[path],l=arr.length,arrPath=arr[0].arr||emptyArr,lPath=arrPath.length;
for(i=0;i<l;i++){a=arr[i];if((p=t.curNode)&&p.isAdding){continue;}if((p=a.curNode)&&(p=p.curNode)){if(a.node.nodeName=="id"){p.setAttribute("id",a.node.nodeValue);
}else{rules.push([SETATTRIBUTE,p,a.node]);}for(j=0;j<lPath;j++){if(arrPath[j]&&arrPath[j].ownerElement==p){delete arrPath[j];
break;}}}else{}}}for(path in notFoundEl){arr=notFoundEl[path],l=arr.length,arrPath=arr[0].arr||emptyArr,lPath=arrPath.length;
for(i=0;i<l;i++){t=arr[i];if((p=t.curNode)&&p.isAdding){continue;}if(p=p.curNode){appendRules.push(lastRule=[APPEND,p,t.node]);
for(j=0;j<lPath;j++){if(arrPath[j]&&arrPath[j].parentNode==p){if(t.node.nodeType!=1){lastRule[0]=UPDATE;
lastRule[1]=arrPath[j];}else{appendRules.length--;}delete arrPath[j];break;}}}else{}}}for(prop in hash){item=hash[prop];
for(i=0,l=item.length;i<l;i++){subitem=item[i];if(subitem&&!subitem.$isValid&&(subitem.parentNode||subitem.ownerElement).$isValid){rules.push([REMOVE,subitem]);
}}}var dt=new Date().getTime();var q={},doc=doc1.ownerDocument;for(i=0,l=appendRules.length;
i<l;i++){switch((item=appendRules[i])[0]){case UPDATE:if(debug){apf.console.log("XmlDiff: UPDATE "+item[1].nodeValue+" with "+item[2].nodeValue);
}item[1].$setValue(item[2].nodeValue);if(item[1].nodeType!=2){var childNr1=apf.getChildNumber(item[1]),childNr2=apf.getChildNumber(item[2]);
if(childNr1!=childNr2){item[1].parentNode.insertBefore(item[1],item[1].parentNode.childNodes[childNr2]);
}}break;case APPEND:if(debug){apf.console.log("XmlDiff: APPEND "+(item[2].tagName?"<"+item[2].tagName+">":item[2].nodeValue)+" to <"+item[1].localName+"> ["+item[1].$uniqueId+"]");
}if(!item[1].canHaveChildren){item[1].$aml=item[2].parentNode;if(item[1].$redraw){item[1].$redraw();
}continue;}if(item[1].render!="runtime"){var xml=item[1].parentNode;while(xml&&xml.nodeType==1&&!xml.getAttribute("render")){xml=xml.parentNode;
}if(xml&&xml.render){if(xml.$amlList){xml.$amlList.push(item);}else{xml.$amlList=[item];
xml.addEventListener("beforerender",function(e){var nodes=this.$amlList;this.$amlList=null;
for(var item,i=0,l=nodes.length;i<l;i++){item=nodes[i];var childNr=apf.getChildNumber(node=item[2]);
item[1].insertBefore(doc.importNode(node,true),item[1].childNodes[childNr]);}this.$rendered=true;
this.removeEventListener("beforerender",arguments.callee);return false;});xml.$rendered=false;
}}else{(item[1].$amlList||(item[1].$amlList=[]))[apf.getChildNumber(item[2])]=item;
q[item[1].$uniqueId]=item[1];}}else{item[1].$aml=item[2].parentNode;item[1].$rendered=false;
}break;}}var list,newNode;for(var id in q){list=q[id].$amlList;for(var item,i=0;
i<list.length;i++){item=list[i];if(!item){continue;}newNode=doc.importNode(item[2],true);
if(newNode){item[1].insertBefore(newNode,item[1].childNodes[i]);}}}for(i=0,l=rules.length;
i<l;i++){switch((item=rules[i])[0]){case REMOVE:if(debug){apf.console.log("XmlDiff: REMOVE "+(item[1].localName?"<"+item[1].localName+">":item[1].nodeValue)+" ["+item[1].$uniqueId+"] ");
}if((node=item[1]).destroy){node.destroy(true,true);}else{if(node.parentNode){node.parentNode.removeChild(node);
}else{node.ownerElement.removeAttributeNode(node);}}break;case SETATTRIBUTE:if(debug){apf.console.log("XmlDiff: ATTRIBUTE <"+item[1].localName+"> ["+item[1].$uniqueId+"] "+item[2].nodeName+'="'+item[2].nodeValue+'"');
}item[1].setAttribute((item=item[2]).nodeName,item.nodeValue);break;}}for(var node,pnode,next,nr,tonr,i=0;
i<reorderRules.length;i++){node=reorderRules[i][0];nr=node.$childNumber;tonr=reorderRules[i][1];
pnode=node.parentNode;next=pnode.childNodes[tonr+(nr<tonr?1:0)];if(node.nextSibling!=next&&node!=next){pnode.insertBefore(node,next);
}}apf.queue.empty();if(debug){apf.console.time("Diff time:"+(time=(new Date()-dt)));
}};apf.zmanager=function(){var count={"default":{level:10},plane:{level:100000},popup:{level:200000},notifier:{level:300000},drag:{level:400000},print:{level:1000000}};
this.set=function(type,main,companion){main.style.zIndex=count[type].level++;if(companion){if(companion.$storedZ==undefined){companion.$storedZ=companion.style.zIndex;
}companion.style.zIndex=count[type].level++;}};this.clear=function(main,companion){if(companion.$storedZ==main.style.zIndex+1){companion.style.zIndex=companion.$storedZ;
companion.$storedZ=undefined;}};};apf.history={inited:false,page:null,past:[],future:[],delay:1,init:function(defName,getVar,delay){if(this.inited||window.history.pushState){return;
}if(delay){this.delay=delay;}this.inited=true;var name,_self=this;function preInit(){name=apf.dispatchEvent("hashinit")||location.href.match(/#(.*)$/)&&decodeURI(RegExp.$1)||apf._GET[getVar||-1]||defName;
location.hash=name;_self.hasChanged(name||null);}if(apf.supportHashChange){$setTimeout(function(){preInit();
window.onhashchange=function(){var page=location.hash.replace("#","");apf.history.hasChanged(decodeURI(page));
};});}else{if(apf.isIE){preInit();var str="<style>                    BODY, HTML{margin:0}                    h1{height:100px; margin:0; padding:0; overflow:hidden}                </style>                <body>                    <h1 id='"+name+"'>0</h1>                </body>                <script>                    var lastURL = -1;                    if (document.all)                        document.body.onscroll = checkUrl;                    else                        setInterval('checkUrl()', 200);                                        function checkUrl(){                        var iScr = (document.all ? document.body : document.documentElement).scrollTop;                        if (lastURL == iScr) return;                        top.apf.history.hasChanged(document.getElementsByTagName('h1')[Math.round(iScr / 100)].id, true);                        lastURL = iScr;                        }                    checkUrl();                <\/script>";
if(top==self){document.body.insertAdjacentHTML("beforeend","<iframe name='nav' style2='position:absolute;left:10px;top:10px;height:100px;width:100px;z-index:1000'                       style='width:1px;height:1px;' src='about:blank'></iframe>");
document.frames.nav.document.open();document.frames.nav.document.write(str);document.frames.nav.document.close();
}this.iframe=document.frames.nav;this.timer2=setInterval(function(){if(!apf.history.changingHash&&location.hash!="#"+apf.history.page){var name=location.hash.replace(/^#/,"");
var page=apf.history.page;apf.history.setHash(name,true,true);apf.history.page=page;
apf.history.hasChanged(name);}},apf.history.delay||1);}else{preInit();apf.history.lastUrl=location.href.toString();
this.timer2=setInterval(function(){if(apf.history.lastUrl==location.href.toString()){return;
}apf.history.lastUrl=location.href.toString();var page=location.hash.replace("#","");
apf.history.hasChanged(decodeURI(page));},20);}}},to_name:null,setHash:function(name,timed,force){if(this.changing||this.page==name||!force&&decodeURIComponent(location.hash)=="#"+decodeURIComponent(name)){this.to_name=name;
return;}if(!apf.supportHashChange&&apf.isIE&&!timed){this.to_name=name;return $setTimeout(function(){apf.history.setHash(apf.history.to_name,true,force);
},200);}this.changePage(name);if(!this.inited){return this.init(name);}if(!apf.supportHashChange&&apf.isIE){var h=this.iframe.document.body.appendChild(this.iframe.document.createElement("h1"));
h.id=name;h.innerHTML="1";}(!apf.supportHashChange&&apf.isIE?this.iframe:window).location.href="#"+name;
if(!apf.isIE&&!apf.isGecko&&!apf.isIphone){apf.history.lastUrl=location.href.toString();
}},timer:null,changePage:function(page,force){if(!apf.supportHashChange&&apf.isIE){this.page=page;
this.changingHash=true;clearTimeout(this.timer);this.timer=$setTimeout(function(){location.hash=page;
apf.history.changingHash=false;},1);}},update:function(page){var i,l,idx=0;for(i=0,l=this.past.length;
i<l&&idx===0;i++){if(this.past[i]==page){idx=i+1;}}if(idx>0){this.future=this.past.slice(idx,this.past.length-1).concat(this.future).makeUnique();
this.past.splice(idx,this.past.length-(idx));idx=-idx;}else{for(i=0,l=this.future.length;
i<l&&idx===0;i++){if(this.future[i]==page){idx=i+1;this.past=this.past.concat(this.future.splice(0,this.future.length-idx)).makeUnique();
}}if(idx===0){this.past.push(page);idx=1;}}return idx;},hasChanged:function(page,force){if(page==this.page&&!force){return;
}this.changePage(page,force);this.changing=true;if(apf.dispatchEvent("hashchange",{oldURL:this.page,newURL:page,page:page,index:this.update(page)})===false){page=location.hash=this.page;
}this.changing=false;this.page=page;}};apf.config=new apf.Class().$init();apf.extend(apf.config,{disableRightClick:false,allowSelect:false,allowBlur:true,autoDisableActions:true,autoDisable:false,disableF5:true,autoHideLoading:true,disableSpace:true,defaultPage:"home",disableBackspace:true,undokeys:false,outline:false,dragOutline:false,resizeOutline:false,autoDisableNavKeys:true,disableTabbing:false,resourcePath:null,initdelay:true,liveText:false,iePngFix:false,iphoneFullscreen:true,iphoneStatusbar:"default",iphoneIcon:null,iphoneIconIsGlossy:false,iphoneFixedViewport:true,x:"",y:"",w:"",h:"",snapcontainer:true,snapelement:true,snapguide:true,snapgrid:false,showgrid:false,gridsize:10,$setGridSize:function(value){if(value){this.gridsize=value;
}if(this.showgrid){app.$int.style.backgroundImage="url(images/grid/"+this.gridSize+".gif)";
app.$int.style.backgroundRepeat="repeat";}else{app.$int.style.backgroundImage="";
app.$int.style.backgroundRepeat="";}},skinset:"default",name:apf.isO3?"o3App":self.window&&window.location.href.replace(/[^0-9A-Za-z_]/g,"_"),tags:{},defaults:{},baseurl:"",model:"@default","empty-message":"No items","loading-message":"Loading...","offline-message":"You are currently offline.",setDefaults:function(){if(apf.isParsingPartial){this.disableRightClick=false;
this.allowSelect=true;this.autoDisableActions=true;this.autoDisable=false;this.disableF5=false;
this.autoHideLoading=true;this.disableSpace=false;this.disableBackspace=false;this.undokeys=false;
this.disableTabbing=true;this.allowBlur=true;}},getDefault:function(type,prop){var d=this.defaults[type];
if(!d){return;}for(var i=d.length-1;i>=0;i--){if(d[i][0]==prop){return d[i][1];
}}},$handlePropSet:function(name,value){this[name.replace(/-(\w)/g,function(m,m1){return m1.toUpperCase();
})]=this[name]=value;(this.$propHandlers&&this.$propHandlers[name]||apf.GuiElement.propHandlers[name]||apf.K).call(this,value);
},$inheritProperties:{},$propHandlers:{baseurl:function(value){this.baseurl=apf.parseExpression(value);
},language:function(value){apf.addEventListener("load",function(){apf.setModel(apf.config.language,apf.language);
});},"resource-path":function(value){this.resourcePath=apf.parseExpression(value||"").replace(/resources\/?|\/$/g,"");
},iepngfix:function(value,x){this.iePngFix=(!apf.supportPng24&&(apf.isTrue(value)||x.getAttribute("iepngfix-elements")));
if(this.iePngFix){$setTimeout(function(){apf.iepngfix.limitTo(x.getAttribute("iepngfix-elements")||"").run();
});}},skinset:function(value){if(this.$amlLoaded){apf.skins.changeSkinset(value);
}},outline:function(value){this.dragOutline=this.resizeOutline=this.outline=apf.isTrue(value);
},"drag-outline":function(value){this.dragOutline=value?apf.isTrue(value):false;
},"resize-outline":function(value){this.resizeOutline=value?!apf.isFalse(value):false;
},login:function(value,x){apf.auth.init(x);},storage:function(value){if(value){apf.storage.init(value);
}},offline:function(value){if(value&&typeof apf.offline!="undefined"){apf.offline.init(value);
}},"disable-f5":function(value){if(apf.isDeskrun&&value){shell.norefresh=true;}},showgrid:function(value){this.$setGridSize();
},gridsize:function(value){this.$setGridSize(value);},debug:function(value){if(value){apf.$debugwin.activate();
apf.addEventListener("load",function(){apf.removeEventListener("load",arguments.callee);
});}apf.debug=value;}}});if(apf.history){apf.addEventListener("load",function(){apf.history.init(apf.config.defaultPage,"page");
});}apf.offline={enabled:false,onLine:-1,resources:["application","models","transactions","queue","state"],autoInstall:false,storage:null,inited:false,rdbTimeout:600000,init:function(aml){apf.makeClass(this);
if(aml){this.$aml=aml;if(typeof aml=="string"){}else{if(aml.nodeType){if(aml.getAttribute("resources")){this.providers=aml.getAttribute("resources").split("|");
}if(aml.getAttribute("rdb-timeout")){this.rdbTimeout=parseInt(aml.getAttribute("rdb-timeout"));
}var a,i,attr=aml.attributes;for(i=0;i<attr.length;i++){a=attr[i];if(a.nodeName.indexOf("on")==0){this.addEventListener(a.nodeName,apf.lm.compile(a.nodeValue,{event:true,parsecode:true}));
}}}else{apf.extend(this,aml);}}}var provider=apf.offline.application.init(aml);
if(provider){this.storage=apf.storage.getProvider(provider);if(this.storage){apf.console.info("Installed storage provider '"+provider+"'");
}}if(!this.storage){this.storage=apf.storage.initialized?apf.storage:apf.storage.init();
}if(!this.storage){throw new Error("Offline failed to attain access                                to a storage provider");
return;}if(!this.storage.isPermanent()){apf.addEventListener("exit",function(){return apf.offline.dispatchEvent("losechanges");
});}if(this.storage.asyncInit){apf.document.$domParser.$shouldWait++;this.storage.ready(function(){apf.offline.storage.onready=null;
apf.offline.continueInit();apf.document.$domParser.$continueParsing(apf.document.documentElement);
});return;}this.continueInit();},continueInit:function(){for(var i=this.resources.length-1;
i>=0;i--){if(!this[this.resources[i]]){this.resources.removeIndex(i);}else{this[this.resources[i]].init(this.$aml);
}}this.enabled=true;this.detector.init(this.$aml);this.offlineTime=parseInt(this.storage.get("offlinetime",this.namespace));
if(this.offlineTime){this.goOffline();}else{this.goOnline();}apf.offline.dispatchEvent("load");
},$destroy:function(){apf.console.info("Cleaning offline");if(this.provider&&this.provider.destroy){this.provider.destroy();
}if(this.storage&&this.storage.destroy){this.storage.destroy();}for(var i=this.resources.length-1;
i>=0;i--){if(this[this.resources[i]]&&this[this.resources[i]].destroy){this[this.resources[i]].destroy();
}}},IDLE:0,TO_OFFLINE:1,TO_ONLINE:2,STOPPING:3,inProcess:0,$supportedProperties:["syncing","position","length","progress","onLine"],handlePropSet:function(prop,value,force){this[prop]=value;
},goOffline:function(){if(!this.enabled||this.onLine===false||this.inProcess==this.TO_OFFLINE){return false;
}if(this.inProcess){this.inProcess=this.STOPPING;return false;}if(this.dispatchEvent("beforeoffline")===false){return false;
}this.setProperty("onLine",false);this.inProcess=this.TO_OFFLINE;if(!this.offlineTime){this.offlineTime=new Date().getTime();
this.storage.put("offlinetime",this.offlineTime,this.namespace);}if(this.detector.enabled&&this.detector.detection!="manual"){this.detector.start();
}if(!this.initial){this.initial={disableRDB:apf.xmldb.disableRDB};}apf.xmldb.disableRDB=true;
this.inProcess=this.IDLE;this.dispatchEvent("afteroffline");apf.console.info("The application is now working offline.");
return true;},goOnline:function(){if(!this.enabled||this.onLine===true||this.inProcess==this.TO_ONLINE){return false;
}if(this.dispatchEvent("beforeonline")===false){return false;}this.setProperty("onLine",true);
this.inProcess=this.TO_ONLINE;this.onlineTime=new Date().getTime();this.reloading=false;
apf.console.info("Trying to go online.");if(this.detector.enabled&&this.detector.detection=="error"){this.detector.stop();
}this.$checkRsbTimeout();if(this.initial){apf.xmldb.disableRDB=this.initial.disableRDB;
}var callback=function(){this.startSync();this.dispatchEvent("afteronline");};var auth=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}if(auth.needsLogin&&auth.loggedIn){auth.authRequired({object:this,retry:callback});
}else{callback.call(this);}return true;},$checkRsbTimeout:function(){if(!this.rdbTimeout){return;
}var i,j,k,rdbs=apf.nameserver.getAll("remote");for(i=0;i<rdbs.length;i++){var rdb=rdbs[i];
if(this.reloading||this.onlineTime-this.offlineTime>this.rdbTimeout){if(!this.reloading){if(this.dispatchEvent("beforereload")===false){apf.console.warn("Warning, potential data corruption                            because you've cancelled reloading the data of all                             remote databinding synchronized models.");
break;}this.reloading=true;}rdb.discardBefore=this.onlineTime;for(j=0;k<rdb.models.length;
j++){rdb.models[j].clear();apf.offline.models.addToInitQueue(rdb.models[j]);}}}if(this.reloading){apf.console.warn("The application has been offline longer than the                               server timeout. To maintain consistency the models                              are reloaded. All undo stacks will be purged.");
apf.offline.transactions.clear("undo|redo");var ats=apf.nameserver.getAll("actiontracker");
for(var i=0;i<ats.length;i++){ats[i].reset();}}},$goOnlineDone:function(success){this.inProcess=this.IDLE;
this.setProperty("syncing",false);if(success){this.offlineTime=null;this.initial=null;
this.storage.remove("offlinetime",this.namespace);apf.console.info("Syncing done.");
apf.console.info("The application is now working online.");}else{apf.console.info("Syncing was cancelled. Going online failed");
this.goOffline();}},clear:function(){if(!this.enabled){return false;}apf.console.info("Clearing all offline and state cache");
for(var i=this.resources.length-1;i>=0;i--){if(this[this.resources[i]].clear){this[this.resources[i]].clear();
}}},startSync:function(){if(this.syncing){return;}this.setProperty("syncing",true);
apf.console.info("Start syncing offline changes.");var syncResources=[],syncLength=0,syncPos=0,syncRes=null,len,i;
for(i=this.resources.length-1;i>=0;i--){if(this[this.resources[i]].sync){len=this[this.resources[i]].getSyncLength();
if(len){syncResources.push(this[this.resources[i]]);syncLength+=len;}}}var fln=apf.offline;
var callback=function(extra){if(fln.inProcess==fln.STOPPING){if(!extra.finished&&extra.length-1!=extra.position){syncRes.stopSync(function(){fln.$goOnlineDone(false);
});}else{fln.$goOnlineDone(false);}return;}if(extra.finished){if(syncResources.length){syncRes=syncResources.pop();
syncRes.sync(callback);}else{fln.$goOnlineDone(true);}return;}if(!extra.start){syncPos++;
}fln.setProperty("progress",parseInt(syncPos/syncLength*100));fln.setProperty("position",syncPos);
fln.setProperty("length",syncLength);fln.dispatchEvent("sync",apf.extend(extra,{position:syncPos,length:syncLength}));
};if(syncLength){callback({start:true});callback({finished:true});}else{apf.console.info("Nothing to synchronize.");
this.$goOnlineDone(true);}var nodes=apf.all;for(i=0;i<nodes.length;i++){if(nodes[i].$loadedWhenOffline){nodes[i].reload();
}}},stopSync:function(){if(this.syncing){this.inProcess=this.STOPPING;}}};apf.offline.application={enabled:false,urls:[],providers:["deskrun","gears"],init:function(aml){if(this.enabled){return;
}this.namespace=apf.config.name+".apf.offline.application";if(typeof aml=="string"){this.providers=aml.split("|");
}else{if(aml.nodeType){if(aml.getAttribute("version-get")){this.application.versionGet=aml.getAttribute("version-get");
}if(aml.getAttribute("providers")){this.providers=aml.getAttribute("providers").split("|");
}if(aml.getAttribute("auto-install")){this.autoInstall=apf.isTrue(aml.getAttribute("auto-install"));
}}}for(var i=0;i<this.providers.length;i++){if(!this[this.providers[i]]){apf.console.warn("Module not loaded for offline provider: "+this.providers[i]);
continue;}if(this[this.providers[i]].isAvailable()){this.provider=this[this.providers[i]].init(this.storeName);
if(this.provider!==false){this.provider.name=this.providers[i];break;}}}if(!this.provider){if(this.autoInstall){if(this.install()===false){apf.console.warn("Could not install any of the preferred                                          offline providers:"+this.providers.join(", "));
apf.offline.application=null;return this.providers[0];}}else{apf.console.warn("Could not find any of the specified                                      offline providers:"+this.providers.join(", "));
apf.offline.application=null;return this.providers[0];}}if(!apf.loaded){apf.addEventListener("load",function(){if(apf.offline.application.enabled){apf.offline.application.save();
}apf.removeEventListener("load",arguments.callee);});}else{apf.offline.addEventListener("load",function(){apf.offline.application.save();
});}this.enabled=true;return this.provider.name;},install:function(){if(apf.offline.dispatchEvent("beforeinstall")===false){apf.console.warn("Installation cancelled");
return false;}for(var i=0;i<this.providers.length;i++){if(!this[this.providers[i]]){continue;
}if(this[this.providers[i]].install()){this.provider=this[this.providers[i]].init(this.storeName);
if(this.provider!==false){break;}}}apf.offline.dispatchEvent("afterinstall");if(!this.provider){return false;
}},clear:function(){if(this.provider){this.provider.clear();}},cache:function(url){if(url.indexOf(":")>-1&&url.indexOf("http://"+location.host)==-1){return;
}this.urls.pushUnique(url.replace(/\#.*$/,""));},remove:function(url){this.urls.remove(url);
},refresh:function(callback){var storage=apf.offline.storage;if(this.versionGet){var oldVersion=storage.get("oldVersion",this.namespace);
var newVersion=null;var _self=this;apf.getData(this.versionGet,{callback:function(newVersion,state,extra){if(state==apf.TIMEOUT){return extra.tpModule.retryTimeout(extra,state,apf.offline);
}if(state==apf.OFFLINE){return;}if(state==apf.ERROR){storage.remove("oldVersion",_self.namespace);
}if(apf.debug||!newVersion||!oldVersion||oldVersion!=newVersion){apf.console.info("Refreshing offline file list");
if(apf.offline.state.enabled){apf.offline.state.clear();if(apf.offline.state.realtime){apf.offline.state.search();
}}_self.search();_self.provider.store(_self.urls,callback,newVersion);}else{apf.console.info("No need to refresh offline file list");
callback({finished:true});}}});}else{apf.console.info("Refreshing offline file list");
this.search();this.provider.store(this.urls,callback);}},search:function(){this.cache(window.location.href);
var i,nodes=document.getElementsByTagName("script");for(i=0;i<nodes.length;i++){this.cache(nodes[i].getAttribute("src"));
}nodes=document.getElementsByTagName("link");for(i=0;i<nodes.length;i++){if((nodes[i].getAttribute("rel")||"").toLowerCase()=="stylesheet"){continue;
}this.cache(nodes[i].getAttribute("href"));}nodes=document.getElementsByTagName("img");
for(i=0;i<nodes.length;i++){this.cache(nodes[i].getAttribute("src"));}nodes=document.getElementsByTagName("a");
for(i=0;i<nodes.length;i++){this.cache(nodes[i].getAttribute("href"));}var _self=this,j,rule,sheet,sheets=document.styleSheets;
for(i=0;i<sheets.length;i++){sheet=sheets[i];if(apf.isIE){if(sheet.readOnly){sheet.cssText.replace(/url\(\s*([^\) ]*)\s*\)/gi,function(m,url){_self.cache(url);
return"";});}}else{if(sheet.ownerNode.tagName=="STYLE"){continue;}for(j=0;j<sheet.cssRules.length;
j++){rule=sheet.cssRules[j].cssText;if(!rule){continue;}rule.replace(/url\(\s*([^\) ]*)\s*\)/gi,function(m,url){_self.cache(url);
return"";});}}}apf.skins.loadedCss.replace(/url\(\s*([^\) ]*)\s*\)/gi,function(m,url){_self.cache(url);
return"";});},save:function(callback){if(!apf.offline.onLine){var func=function(){apf.offline.application.save();
apf.offline.removeEventListener("afteronline",func);};apf.offline.addEventListener("afteronline",func);
return;}this.refresh(callback);}};apf.offline.application.gears={localServer:null,lastStore:null,cancelID:null,refreshing:false,fileIndex:0,init:function(){this.name=this.storeName.truncate(64);
this.storeName=apf.config.name+".apf.offline";try{this.localServer=apf.nameserver.get("google","gears").create("beta.localserver","1.0");
}catch(e){apf.console.warn("Error loading gears: "+e.message);return false;}return this;
},install:function(){apf.isGears=true;},isAvailable:function(){return apf.isGears&&location.protocol!="file:";
},clear:function(){this.localServer.removeStore(this.name);},store:function(listOfURLs,callback,newVersion){this.localServer.removeStore(this.name);
this.localServer.openStore(this.name);try{var store=this.lastStore=this.localServer.createStore(this.name);
}catch(e){apf.console.warn("Gears failed to start local storage: "+e.message);return false;
}var _self=this;this.refreshing=true;this.fileIndex=0;this.cancelID=store.capture(listOfURLs,function(url,success,captureId){if(!success&&_self.refreshing){_self.cancelID=null;
_self.refreshing=false;if(callback){callback({error:true,message:"Unable to capture "+url});
}return;}else{if(success){_self.fileIndex++;if(callback){callback({position:_self.fileIndex,length:listOfURLS.length});
}}}if(success&&_self.fileIndex>=listOfURLs.length){_self.cancelID=null;_self.refreshing=false;
if(newVersion){apf.storage.put("oldVersion",newVersion,null,apf.offline.application.storeName);
}if(callback){callback({finished:true});}}});},abort:function(){if(!this.refreshing){return;
}this.lastStore.abortCapture(this.cancelID);this.refreshing=false;}};apf.offline.detector={detectUrl:apf.basePath+"core/lib/offline/network_check.txt",detection:"auto",interval:5000,init:function(aml){if(aml.nodeType){if(aml.getAttribute("detect-url")){this.detectUrl=aml.getAttribute("detect-url");
}else{this.detectUrl=(apf.config.resourcePath||apf.basePath)+"resources/network_check.txt";
}this.detection=apf.isTrue(aml.getAttribute("detection"))?"auto":aml.getAttribute("detection")||"auto";
if(aml.getAttribute("interval")){this.interval=parseInt(aml.getAttribute("interval"));
}}if("error|auto".indexOf(this.detection)>-1){apf.addEventListener("error",function(e){if(e.state==apf.TIMEOUT){return !apf.offline.goOffline();
}});}this.oHttp=new apf.http();this.oHttp.timeout=this.interval;this.isSiteAvailable();
if(this.detection=="auto"){this.start();}},isSiteAvailable:function(callback){this.oHttp.get(apf.getNoCacheUrl(this.detectUrl),{callback:function(data,state,extra){if(state!=apf.SUCCESS||!window.navigator.onLine){apf.offline.goOffline(callback);
}else{apf.offline.goOnline(callback);}},ignoreOffline:true,hideLogMessage:true});
},start:function(){clearInterval(this.timer);apf.console.info("Automatic detection of network state is activated");
var _self=this;this.timer=setInterval(function(){_self.isSiteAvailable();},this.interval);
},stop:function(){clearInterval(this.timer);apf.console.info("Detection of network state is deactivated");
}};apf.offline.models={enabled:false,timer:null,models:{},initQueue:[],realtime:true,init:function(aml){this.namespace=apf.config.name+".apf.offline.models";
if(aml.nodeType&&aml.getAttribute("realtime")){this.realtime=!apf.isFalse(aml.getAttribute("realtime"));
}if(!this.realtime){apf.addEventListener("exit",function(){apf.offline.models.search();
});}this.enabled=true;},markForUpdate:function(model){this.models[model.$uniqueId]=model;
if(!this.timer){var _self=this;this.timer=$setTimeout(function(){_self.timer=null;
var models=_self.models;for(var mId in models){_self.updateModel(models[mId]);}_self.models={};
},2000);}},clear:function(){apf.offline.storage.clear(this.namespace);},removeModel:function(model){var name=model.name||model.$uniqueId+".model";
apf.offline.storage.remove(name,this.namespace);this.initQueue.remove(model);},updateModel:function(model){var name=model.name||model.$uniqueId+".model";
apf.console.info("Updating model '"+name+"'");var docId=model.data.getAttribute(apf.xmldb.xmlDocTag);
model.data.setAttribute(apf.xmldb.xmlDocTag+"_length",apf.xmldb.nodeCount[docId]);
apf.offline.storage.put(name,model.data.xml||model.data.serialize(),this.namespace);
},loadModel:function(model){var name=model.name||model.$uniqueId+".model";var data=apf.offline.storage.get(name,this.namespace);
if(!data){return false;}apf.console.info("Loading model '"+name+"' from local storage");
var xmlNode=apf.getXmlDom(data).documentElement;var docId=xmlNode.getAttribute(apf.xmldb.xmlDocTag);
apf.xmldb.nodeCount[docId]=parseInt(xmlNode.getAttribute(apf.xmldb.xmlDocTag+"_length"));
model.load(xmlNode);return true;},search:function(){var done={},models=apf.nameserver.getAll("model");
for(var i=0;i<models.length;i++){if(done[models[i].$uniqueId]){continue;}done[models[i].$uniqueId]=true;
this.updateModel(models[i]);}return true;},addToInitQueue:function(model){this.initQueue.pushUnique(model);
model.session=false;},stopSync:function(callback){callback();},getSyncLength:function(){return this.initQueue.length;
},sync:function(callback){var queue=this.initQueue.slice();this.initQueue.length=0;
var qNr=0,len=queue.length;for(var i=0;i<queue.length;i++){queue[i].init(function(){callback({position:++qNr,length:len});
if(qNr==len-1){callback({finished:true});}});}}};apf.offline.queue={enabled:false,stack:[],init:function(){this.namespace=apf.config.name+".apf.offline.queue";
this.enabled=true;},add:function(commInfo){var namespace=this.namespace;var storage=apf.offline.storage;
var len=parseInt(storage.get("length",namespace))||0;this.stack[len]=commInfo;storage.put(len,apf.serialize(commInfo),namespace);
storage.put("length",++len,namespace);var callback=commInfo.callback;if(!commInfo.undoObj&&callback){var strWarn="The application is currently offline. Your                            request will be retried when the application                            goes online again. Please be aware that when the                           request is finally made, this callback might                           not be available anymore. Therefore the state of                           the data should already represent the state of                           the application that a succesfull execution of                           the request communicates. You might want to look                           at using an actiontracker.";
apf.console.warn(strWarn);callback(null,apf.OFFLINE,apf.extend({offline:true,message:strWarn},commInfo));
}},stopSync:function(callback){this.stop=callback;},getSyncLength:function(){return parseInt(apf.offline.storage.get("length",this.namespace))||0;
},sync:function(callback,isStarted){if(this.stop){this.stop();this.stop=null;return;
}var namespace=this.namespace;var storage=apf.offline.storage;var len=parseInt(storage.get("length",namespace))||0;
var start=parseInt(storage.get("start",namespace))||0;var commInfo;if(this.stack[start]){commInfo=this.stack[start];
}else{commInfo=this.$getCommInfo(storage.get(start,namespace));if(!commInfo){apf.console.error("Error syncing queue items. This is a serious                error. The queue stack has become corrupted. It will now be                 cleared and the queued offline messages will be lost!");
this.clear();apf.offline.stopSync();return callback({finished:true});}this.stack[start]=commInfo;
}if(!commInfo.callback2){commInfo.callback2=commInfo.callback;commInfo.callback=function(data,state,extra){if(commInfo.callback2&&commInfo.callback2.apply(window,arguments)===true){return true;
}storage.remove(start,namespace);storage.put("start",start+1,namespace);apf.offline.queue.stack[start]=null;
callback({position:start,length:len,info:commInfo});if(start==len-1){storage.clear(namespace);
callback({finished:true});}else{apf.offline.queue.sync(callback,true);}};}this.stack[start].retry();
},clear:function(){apf.offline.storage.clear(this.namespace);},$getCommInfo:function(strCommItem){if(!strCommItem){return false;
}var commObject,commInfo=apf.unserialize(strCommItem);for(var i=0;i<commInfo.$object.length;
i++){commObject=self[commInfo.$object[i]]||eval(commInfo.$object[i]);if(commObject){break;
}}if(!commObject){}commInfo.object=commObject;commInfo.retry=new Function(commInfo.$retry);
return commInfo;}};apf.offline.state={enabled:false,states:{},realtime:true,lookup:{},init:function(aml){this.namespace=apf.config.name+".apf.offline.state";
if(aml.nodeType){if(aml.getAttribute("realtime")){this.realtime=!apf.isFalse(aml.getAttribute("realtime"));
}if(aml.getAttribute("set")){this.setInstruction=aml.getAttribute("set");}}apf.addEventListener("exit",function(){if(!apf.offline.state.realtime){var lookup=apf.offline.state.lookup;
var storage=apf.offline.storage;var ns=apf.offline.state.namespace;for(var key in lookup){var ns=apf.offline.state.namespace;
storage.put(key,lookup[key],ns);}}if(apf.offline.state.setInstruction){apf.offline.state.send();
}});var registry=apf.extend({},apf.offline.storage||apf.storage);registry.namespace=apf.config.name+".apf.registry";
apf.registry.$export(registry);apf.registry=registry;if(apf.offline.storage.getAllPairs(this.namespace,this.lookup)){if(apf.offline.dispatchEvent("restore")===false){this.clear();
this.lookup={};apf.offline.transactions.clear("undo|redo");}}apf.offline.transactions.doStateSync=true;
this.enabled=true;},warned:false,timeout:{},set:function(obj,key,value){if(!obj.name&&!this.warned){this.warned=true;
apf.console.warn("Components found without name. This means that                               when the application changes the state                               serialization can break.");
}if(!obj.tagName){return;}var name=obj.name||obj.$uniqueId+"_"+obj.tagName;var storage=apf.offline.storage;
if(!name||!storage.isValidKey(name)){throw new Error("invalid");}if(!storage.isValidKey(key)){throw new Error("invalid");
}key=name+"."+key;this.lookup[key]=value;if(!this.realtime){return;}var ns=this.namespace;
clearTimeout(this.timeout[key]);this.timeout[key]=$setTimeout(function(){storage.put(key,value,ns);
},200);},get:function(obj,key,value){return this.lookup[(obj.name||obj.$uniqueId+"_"+obj.tagName)+"."+key];
},getAll:function(obj){var prop,res={},x,name=obj.name||obj.$uniqueId+"_"+obj.tagName;
for(prop in this.lookup){x=prop.split(".");if(x[0]==name){res[x[1]]=this.lookup[prop];
}}return res;},clear:function(){apf.offline.storage.clear(this.namespace);var ns=apf.registry.getNamespaces();
for(var i=0;i<ns.length;i++){apf.registry.clear(ns[i]);}apf.offline.transactions.clear("undo|redo");
},search:function(){var storage=apf.offline.storage;var props,i,j,nodes=apf.all;
for(i=0;i<nodes.length;i++){if(nodes[i].name&&nodes[i].getAvailableProperties){props=nodes[i].getAvailableProperties();
for(j=0;j<props.length;j++){if(nodes[i][props[j]]){this.set(nodes[i],props[j],nodes[i][props[j]]);
}}}}},send:function(){var storage=apf.offline.storage;var data={};var keys=storage.getKeys(this.namespace);
for(var i=0;i<keys.length;i++){data[keys[i]]=storage.get(keys[i],this.namespace);
}apf.saveData(this.setInstruction,{ignoreOffline:true,data:apf.serialize(data),callback:function(data,state,extra){if(extra.tpModule.retryTimeout(extra,state,apf.offline)===true){return true;
}}});}};apf.offline.transactions={enabled:false,init:function(){this.namespace=apf.config.name+".apf.offline.transactions";
this.enabled=true;apf.addEventListener("load",function(){apf.offline.transactions.rebuildActionQueues();
apf.removeEventListener("load",arguments.callee);});},actionNotAllowed:function(){apf.offline.dispatchEvent("transactioncancel",{message:"Transaction is not allowed",bubbles:true});
return;},addAction:function(at,qItem,type){if(!at.name||!apf.storage.base.isValidKey(at.name)){throw new Error("Invalid or missing name for actiontracker                 used for offline transactions '"+at.name+"'.");
}var namespace=this.namespace+"."+at.name+"."+type;var storage=apf.offline.storage;
var len=parseInt(storage.get("length",namespace))||0;storage.put(len,apf.serialize(type=="queue"?{undo:qItem.undo,undoObj:qItem.undoObj.$export()}:qItem.$export()),namespace);
storage.put("length",++len,namespace);},removeAction:function(at,fromTop,type){var namespace=this.namespace+"."+at.name+"."+type;
var storage=apf.offline.storage;if(fromTop){var len=parseInt(storage.get("length",namespace))-1;
var start=parseInt(storage.get("start",namespace))||0;if(len<0){throw new Error("something went terribly wrong");
}if(start==len||len<0){storage.clear(namespace);return;}storage.remove(len,namespace);
storage.put("length",len,namespace);}else{var start=parseInt(storage.get("start",namespace))||0;
var len=parseInt(storage.get("length",namespace))||0;if(start+1==len){storage.clear(namespace);
return;}storage.remove(start,namespace);storage.put("start",++start,namespace);
}},rebuildActionQueues:function(){var storage=apf.offline.storage;var namespaces=storage.getNamespaces();
if(!namespaces){return;}var lookup,re=new RegExp(this.namespace+"\\.([^\\.]*)\\.([^\\.]*)");
for(var ats=[],i=0;i<namespaces.length;i++){if(namespaces[i].match(re)){ats.push([RegExp.$1,RegExp.$2]);
}}var i,j,qItem,stack,namespace,at,start,len,type;for(i=0;i<ats.length;i++){at=apf.nameserver.get("actiontracker",ats[i][0]);
type=ats[i][1];if(!at){throw new Error(apf.formatErrorString(0,null,"Rebuilding Action Queue","An actiontracker could not be found by the name of '"+ats[i][0]+"'"));
}lookup={};namespace=this.namespace+"."+at.name+"."+type;storage.getAllPairs(namespace,lookup);
start=parseInt(lookup.start)||0;len=parseInt(lookup.length)||0;stack=[];apf.console.info("Restoring "+type+" stack for "+(at.name=="default"?"the default actiontracker":"the '"+at.name+"' actiontracker")+" of "+len+" items.");
if(type=="queue"){for(j=len-1;j>=start;j--){qItem=apf.unserialize(lookup[j]);qItem.undoObj=new apf.UndoData(qItem.undoObj,at).$import();
stack.unshift(qItem);}}else{for(j=len-1;j>=start;j--){qItem=apf.unserialize(lookup[j]);
stack.unshift(new apf.UndoData(qItem,at).$import());}}at.$loadQueue(stack,type);
apf.offline.sLookup=null;}},clearActions:function(at,type){apf.offline.storage.clear(this.namespace+"."+at.name+"."+type);
},clear:function(queues){if(!queues){queues="undo|redo|queue";}var storage=apf.offline.storage;
var namespaces=storage.getNamespaces();var re=new RegExp(this.namespace+"\\.([^\\.]*)\\.("+queues+")");
for(var i=0;i<namespaces.length;i++){if(namespaces[i].match(re)){storage.clear(namespaces[i]);
}}},stopSync:function(callback){callback();},getSyncLength:function(){var ats=apf.nameserver.getAll("actiontracker");
var len=0;for(var i=0;i<ats.length;i++){len+=ats[i].$getQueueLength();}return len;
},sync:function(callback){var ats=apf.nameserver.getAll("actiontracker");var qNr=0,len=0;
for(var i=0;i<ats.length;i++){if(ats[i].$getQueueLength()){len+=ats[i].$getQueueLength();
ats[i].$startQueue(function(last){if(qNr>=len-1){return false;}if(last){qNr=len;
}callback({position:++qNr,length:len});if(qNr>=len-1){callback({finished:true});
}});}}}};apf.offline.canTransact=function(){if(!apf.offline.enabled||this.onLine||this.transactions.enabled){return true;
}if(this.dispatchEvent("transactioncancel",{message:"Could not execute transaction whilst being offline,                   silently doing nothing",bubbles:true})===true){return true;
}return false;};apf.saveData=apf.getData=function(instruction,options){if(!instruction){return false;
}var result,chr=instruction.charAt(0),callback=options.callback;var gCallback=function(data,state,extra){var _self=this;
$setTimeout(function(){s2.call(_self,data,state,extra);});};var s2=function(data,state,extra){var callback=options.callback;
if(state!=apf.SUCCESS){return callback(data,state,extra||{});}return callback(data,state,extra||{});
};if(!options){options={};}var fParsed=options.fParsed||(instruction.indexOf("{")>-1||instruction.indexOf("[")>-1?apf.lm.compile(instruction,{withopt:true,precall:options.precall,alwayscb:true,simplexpath:true}):{str:instruction,type:2});
if(options.precall&&!options._pc){options.asyncs=fParsed.asyncs;options._pc=1;}if(fParsed.type==3){if(fParsed.xpaths[0]){var model=fParsed.xpaths[0],xpath=fParsed.xpaths[1];
if(model=="#"||xpath=="#"){var m=(apf.lm.compile(instruction,{xpathmode:5}))();
if(typeof m!="string"){model=m.model&&m.model.$isModel&&m.model;if(model){xpath=m.xpath;
}else{if(m.model){model=apf.xmldb.findModel(m.model);xpath=apf.xmlToXpath(m.model,model.data)+(m.xpath?"/"+m.xpath:"");
}else{return;}}}else{model=null;}}else{model=apf.nameserver.get("model",model);
}if(!model){throw new Error("Could not find model '"+model+"' in "+instruction);
}return gCallback(model.data.selectSingleNode(xpath),apf.SUCCESS,{});}else{if(!options.xmlNode){return apf.console.error(apf.formatErrorString(0,null,"Loading data","Xpath found without model and no xmlNode specified"+instruction));
}return gCallback(options.xmlNode.data.selectSingleNode(fParsed.xpaths[1]),apf.SUCCESS,{});
}}if(chr=="<"){if(fParsed.type==2){result=fParsed.str;}else{return fParsed(options.xmlNode,gCallback,options);
}}else{if((chr=="["||chr=="{")){return fParsed(options.xmlNode,gCallback,options);
}else{if(fParsed.type==1||fParsed.type==3){var callback2=callback;callback=options.callback=function(data,state,extra){if(options._pc===true){return;
}if(state!=apf.SUCCESS){return callback2.apply(this,arguments);}var url=data.split(" "),method="get";
if(url.length>1&&url[0].length<10){method=url.shift();url=url.join(" ");}else{url=data;
}callback=options.callback=callback2;apf.oHttp.exec(method,[url],gCallback,options);
};fParsed(options.xmlNode,gCallback,options);}else{if(options._pc===true){return;
}var url=instruction.split(" "),method="get";if(url.length>1&&url[0].length<10){method=url.shift();
url=url.join(" ");}else{url=instruction;}apf.oHttp.exec(method,[url.replace(/\\/g,"")],gCallback,options);
}}}if(result){if(callback){gCallback(result,apf.SUCCESS,{});}else{return result;
}}};apf.setModel=function(instruction,amlNode){if(!instruction){return;}var fParsed=instruction.indexOf("{")>-1||instruction.indexOf("[")>-1?apf.lm.compile(instruction,{alwayscb:true}):{type:2,str:instruction};
if(instruction=="@default"||fParsed.type==2){var model=apf.nameserver.get("model",instruction);
if(model){return model.register(amlNode);}else{if(instruction=="@default"){return;
}}if(instruction.indexOf(".")==-1&&instruction.indexOf("/")==-1){apf.console.warn("Could not find model '"+instruction+"'");
return;}}if(fParsed.type==3){if(fParsed.models){if(fParsed.xpaths.length==2&&fParsed.xpaths[0]!="#"&&fParsed.xpaths[1]!="#"){if(!apf.nameserver.get("model",fParsed.xpaths[0])){throw new Error("Could not find model '"+fParsed.xpaths[0]+"' in "+instruction);
}apf.nameserver.get("model",fParsed.xpaths[0]).register(amlNode,fParsed.xpaths[1]);
return;}}else{apf.console.warn("Xpath found without model. This might fail if no                context is specified using local(): "+instruction);
}}if(amlNode.clear){amlNode.clear("loading");}apf.getData(instruction,{parsed:fParsed,xmlNode:amlNode&&amlNode.xmlRoot,callback:function(data,state,extra){if(state!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,null,"Loading new data","Could not load data into model.                 \nMessage: "+extra.message+"                \nInstruction: '"+instruction+"'"));
}if(!data){return amlNode.clear&&amlNode.clear();}if(typeof data=="string"){if(data.charAt(0)=="<"){data=apf.getXml(data);
}else{if(data.indexOf("http://")==0){return apf.setModel(data,amlNode);}else{throw new Error("Invalid data from server");
}}}if(data.nodeFunc){data.register(amlNode);return;}var model=apf.xmldb.findModel(data);
if(model){model.register(amlNode,apf.xmlToXpath(data,model.data));}else{new apf.model().register(amlNode).load(data);
}}});};(function(){var $C={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};
var $D=Date,$P=$D.prototype,p=function(s,l){if(!l){l=2;}return("000"+s).slice(l*-1);
};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);
this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();
this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());
this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();
};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);
}else{if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;
}else{throw new TypeError(date1+" - "+date2);}}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);
};$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();
for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;
}}return -1;};$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();
for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;
}}return -1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);
};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];
};$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;
i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}return null;};$D.getTimezoneOffset=function(name){var z=$C.timezones,p;
for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;
}}return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);
};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();
};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);
};$P.isToday=$P.isSameDay=function(date){return this.clone().clearTime().equals((date||new Date()).clone().clearTime());
};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value*1);
return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);
};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);
};$P.addDays=function(value){this.setDate(this.getDate()+value*1);return this;};
$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();
this.setDate(1);this.setMonth(this.getMonth()+value*1);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));
return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;
return this;}var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);
}if(x.seconds){this.addSeconds(x.seconds);}if(x.minutes){this.addMinutes(x.minutes);
}if(x.hours){this.addHours(x.hours);}if(x.weeks){this.addWeeks(x.weeks);}if(x.months){this.addMonths(x.months);
}if(x.years){this.addYears(x.years);}if(x.days){this.addDays(x.days);}return this;
};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;
$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);
c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;
b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;
f=$d+((153*($m-3)+2)/5)+58+s;}g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);
}else{if(n>364+s){w=1;}else{w=(n/7|0)+1;}}$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();
$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());
};var validate=function(n,min,max,name){if(typeof n=="undefined"){return false;
}else{if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else{if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");
}}}return true;};$D.validateMillisecond=function(value){return validate(value,0,999,"millisecond");
};$D.validateSecond=function(value){return validate(value,0,59,"second");};$D.validateMinute=function(value){return validate(value,0,59,"minute");
};$D.validateHour=function(value){return validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return validate(value,1,$D.getDaysInMonth(year,month),"day");
};$D.validateMonth=function(value){return validate(value,0,11,"month");};$D.validateYear=function(value){return validate(value,0,9999,"year");
};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());
}if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());
}if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());
}if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());
}if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());
}if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());
}if(config.timezone){this.setTimezone(config.timezone);}if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);
}if(config.week&&validate(config.week,0,53,"week")){this.setWeek(config.week);}return this;
};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});
};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;
}else{if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);
}return this;}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);
};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;
return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;
return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;
};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());
};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;
return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));
};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());
};$P.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset();
};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();
return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);
}};$P.getUTCTime=function(){return Date.UTC(this.getUTCFullYear(),this.getUTCMonth(),this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds(),this.getUTCMilliseconds());
};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?"0"+n:n;
}return'"'+this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+'Z"';
};}$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;
x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);
case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);
case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);
case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);
}}var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";
case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");
}x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));
case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());
case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();
case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);
case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];
case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];
case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));
case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);
case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());
default:return m;}}):this._toString();};}());apf.draw={initDriver:function(){if(!this.initLayer){var k,o=apf.supportVML?apf.draw.vml:apf.draw.canvas;
for(k in o){this[k]=o[k];}}},basevars:function(){return["var  _math_,v,t=0,n=(new Date()).getTime()*0.001",",e=Math.E, p=Math.PI, p2=2*p, p12=0.5*p",",x, y, z, _x,_y,_z, zt, i, j, k, _opt_;"].join("");
},vars:function(ml,mt,mr,mb){return["var  _math_,vx1 = v.vx1, vy1 = v.vy1,_rseed=1",",vx2 = v.vx2, vy2 = v.vy2, vw = vx2-vx1, vh = vy1-vy2",",vz2 = v.vz2, vz1 = v.vz1, vd = vz2-vz1",",zoom = 1/v.zoom",",a=v.a,b=v.b,c=v.c,d=v.d",",dw = l.dw",ml?"-"+(ml+mr):"",",dh = l.dh",mt?"-"+(mt+mb):"",",dw12 = dw*0.5, dh12 = dh*0.5",",dzw = dw/v.zoomx, dzh = -dh/v.zoomy",",dx = ",ml?ml:0,",dy = ",mt?mt:0,",mx = m&&m.x, my = m&&m.y",",db = dy+dh, dr = dx+dw",",tw = dw/vw, th = dh/vh, ty = -vy2*th+dy, tx = -vx1*tw+dx",",v,t=0,nt=0,n=(new Date()).getTime()*0.001, dt=-(l._n?l._n:n)+(l._n=n)",",e=Math.E, p=Math.PI, p2=2*p, p12=0.5*p",",x, y = 0, z = 0, _x,_y,_z, zt, i, j, k, _opt_, _anim = 0,","_storelut,_storelist,_translut,_speedlut,_overlaylut;"].join("");
},defCamVec:function(){return"var inv=1/m00*(m11*m22-m12*m21)-m01*(m10*m22-m12*m20)+m02*(m10*m21-m11*m20);var mcx = inv*(m11*m22-m12*m21)*m03 + inv*(m02*m21-m01*m22)*m13 + inv*(m01*m12-m02*m11)*m23,    mcy = inv*(m12*m20-m10*m22)*m03 + inv*(m00*m22-m02*m20)*m13 + inv*(m02*m10-m00*m12)*m23,    mcz = inv*(m10*m21-m11*m20)*m03 + inv*(m01*m20-m00*m21)*m13 + inv*(m00*m11-m01*m10)*m23;";
},setMatrix3D:function(m){var l=this.l;var s=["var m00=",m[0],",m01=",m[1],",m02=",m[2],",m03=",m[3],",m10=",m[4],",m11=",m[5],",m12=",m[6],",m13=",m[7],",m20=",m[8],",m21=",m[9],",m22=",m[10],",m23=",m[11],";"];
if(l.p3d<0){this.ortho=1;s.push("var persp = dw / v.p3d/-v.tz, perspd = persp / ",l.ds,";");
}else{this.ortho=0;s.push("var persp = dw / v.p3d, perspd = persp / ",l.ds,";");
}return s.join("");},sincos3:function(pre,rx,ry,rz){return["var ",pre,"cx = __cos(",rx,"),",pre,"sx = __sin(",rx,"),",pre,"cy = __cos(",ry,"),",pre,"sy = __sin(",ry,"),",pre,"cz = __cos(",rz,"),",pre,"sz = __sin(",rz,");"].join("");
},matrix4S:function(sx,sy,sz){return[sx,0,0,0,0,sy,0,0,0,0,sz,0,0,0,0,1];},matrix4T:function(tx,ty,tz){return[1,0,0,tx,0,1,0,ty,0,0,1,tz,0,0,0,1];
},matrix4RP:function(pre){return this.matrix4R(pre+"cx",pre+"sx",pre+"cy",pre+"sy",pre+"cz",pre+"sz");
},matrix4R:function(cx,sx,cy,sy,cz,sz){return[[cy,"*",cz].join(""),["(-",sz,"*",cy,")"].join(""),sy,0,["(",cz,"*",sx,"*",sy,"+",sz,"*",cx,")"].join(""),["(-",sx,"*",sy,"*",sz,"+",cx,"*",cz,")"].join(""),["(-",sx,"*",cy,")"].join(""),0,["(-",cx,"*",sy,"*",cz,"+",sx,"*",sz,")"].join(""),["(",cx,"*",sy,"*",sz,"+",cz,"*",sx,")"].join(""),["(",cx,"*",cy,")"].join(""),0,0,0,0,1];
},matrixMul:function(){var m=arguments[arguments.length-1];for(var i=arguments.length-2;
i>=0;i--){m=this.matrixAB(m,arguments[i]);}return m;},matrixAB:function(a,b){var out=[],x,y,i,j,t,v;
for(y=0;y<16;y+=4){for(x=0;x<4;x++){v=[];if((i=a[y])&&(j=b[x])){v[v.length]=i==1?j:(j==1?i:(i+"*"+j));
}if((i=a[y+1])&&(j=b[x+4])){v[v.length]=i==1?j:(j==1?i:(i+"*"+j));}if((i=a[y+2])&&(j=b[x+8])){v[v.length]=i==1?j:(j==1?i:(i+"*"+j));
}if((i=a[y+3])&&(j=b[x+12])){v[v.length]=i==1?j:(j==1?i:(i+"*"+j));}out[out.length]=v.length?((v.length>1)?"("+v.join("+")+")":v[0]):0;
}}return out;},backface3D:function(pts,cm,zmode){var a=pts[0],b=pts[1],c=pts[2],x=0,y=1,z=2;
if(cm){x=cm[0],y=cm[1],z=cm[2];}return this.ortho?["-((m00*",b[x],"+m01*",b[y],"+m02*",b[z],"+m03)-(__ax=m00*",a[x],"+m01*",a[y],"+m02*",a[z],"+m03))*","((m10*",c[x],"+m11*",c[y],"+m12*",c[z],"+m13)-(__ay=m10*",a[x],"+m11*",a[y],"+m12*",a[z],"+m13))+","((m10*",b[x],"+m11*",b[y],"+m12*",b[z],"+m13)-__ay)*((m00*",c[x],"+m01*",c[y],"+m02*",c[z],"+m03)-__ax)"].join(""):["(((__by=m10*",b[x],"+m11*",b[y],"+m12*",b[z],"+m13) - (__ay=m10*",a[x],"+m11*",a[y],"+m12*",a[z],"+m13)) *","((__cz=m20*",c[x],"+m21*",c[y],"+m22*",c[z],"+m23) - (__az=m20*",a[x],"+m21*",a[y],"+m22*",a[z],"+m23)) -","((__bz=m20*",b[x],"+m21*",b[y],"+m22*",b[z],"+m23) - __az) * ((__cy=m10*",c[x],"+m11*",c[y],"+m12*",c[z],"+m13) - __ay) ) * ","(__ax=m00*",a[x],"+m01*",a[y],"+m02*",a[z],"+m03) + ","((__bz - __az) * ((__cx=m00*",c[x],"+m01*",c[y],"+m02*",c[z],"+m03) - __ax) -","((__bx=m00*",b[x],"+m01*",b[y],"+m02*",b[z],"+m03) - __ax) * (__cz - __az) ) * __ay + ","((__bx - __ax) * (__cy - __ay) - (__by - __ay) * (__cx - __ax) ) * __az "].join("");
},text3D:function(p,cm,zc,text){var i=0,d,pt,q,s=["__n=0;"],x=0,y=1,z=2,sx,sy,vx,vy,vxi,vyi;
if(cm){x=cm[0],y=cm[1],z=cm[2];}return["if((__z = m20*",p[x],"+m21*",p[y],"+m22*",p[z],"+m23) < ",zc,"){",this.text(["dw12+(m00*",p[x],"+m01*",p[y],"+m02*",p[z],"+m03)*",this.ortho?"persp":"(persp/__z)"].join(""),["dh12+(m10*",p[x],"+m11*",p[y],"+m12*",p[z],"+m13)*",this.ortho?"persp":"(persp/__z)"].join(""),text),"}"].join("");
},poly3DClip:function(idx,pt,cm,zc,open){var i=0,d,p,pt,q,s=["__n=0;"],x=0,y=1,z=2,sx,sy,vx,vy,vxi,vyi;
if(cm){x=cm[0],y=cm[1],z=cm[2];}for(var i=0;i<idx.length;i++){p=pt[idx[i]];s.push(["if(__n",i,"=(__z",i," = m20*",p[x],"+m21*",p[y],"+m22*",p[z],"+m23) < ",zc,")__n++;"].join(""));
}s.push("if(__n){","if(__n==",idx.length,"){");for(var i=0;i<idx.length;i++){p=pt[idx[i]];
vx=["dw12+(m00*",p[x],"+m01*",p[y],"+m02*",p[z],"+m03)*",this.ortho?"persp":"(persp/__z"+i+")"].join("");
vy=["dh12+(m10*",p[x],"+m11*",p[y],"+m12*",p[z],"+m13)*",this.ortho?"persp":"(persp/__z"+i+")"].join("");
if(i==0){s.push(this.moveTo(vx,vy));}else{s.push(this.lineTo(vx,vy));}}if(!open){s.push(this.close());
}s.push("}else{");for(var i=0;i<idx.length;i++){p=pt[idx[i]];if(i==0){s.push(["__x0=m00*",p[x],"+m01*",p[y],"+m02*",p[z],"+m03;","__y0=m10*",p[x],"+m11*",p[y],"+m12*",p[z],"+m13;","if( __o=__n0){",this.moveTo("dw12+__x0*"+(this.ortho?"persp":"(persp/__z0)"),"dh12+__y0*"+(this.ortho?"persp":"(persp/__z0)")),"}"].join(""));
}else{s.push(["__xn=dw12+(__x",i,"=m00*",p[x],"+m01*",p[y],"+m02*",p[z],"+m03)*",(this.ortho?"persp;":"(persp/__z"+i+");"),"__yn=dh12+(__y",i,"=m10*",p[x],"+m11*",p[y],"+m12*",p[z],"+m13)*",(this.ortho?"persp;":"(persp/__z"+i+");"),"if( __n",i," && !__n",i-1," || !__n",i,"&& __n",i-1,"){","__z=(__zc=(",zc,"-__z",i-1,")/(__z",i,"-__z",i-1,")) * __z",i,"+(__ze=1-__zc)* __z",i-1,";","__xi=dw12+(__zc*__x",i,"+__ze* __x",i-1,")*",(this.ortho?"persp":"(persp/__z)"),";","__yi=dh12+(__zc*__y",i,"+__ze* __y",i-1,")*",(this.ortho?"persp":"(persp/__z)"),";","if(!__o){__o=true;",this.moveTo("__xi","__yi"),"}else{",this.lineTo("__xi","__yi"),"}","}","if( __n",i,"){",this.lineTo("__xn","__yn"),"}"].join(""));
}if(i==idx.length-1){s.push(["if(!__n0 && __n",i," || __n0 && ! __n",i,"){","__z=(__zc=(",zc,"-__z",i,")/(__z0-__z",i,")) * __z0+(__ze=1-__zc)* __z",i,";",this.lineTo(["dw12+(__zc*__x0+__ze* __x",i,")*",(this.ortho?"persp":"(persp/__z)")].join(""),["dh12+(__zc*__y0+__ze* __y",i,")*",(this.ortho?"persp":"(persp/__z)")].join("")),"}",open?"":this.close()].join(""));
}}s.push("}};");return s.join("").replace(/m\d\d\*\(?0\)?\+/g,"");},poly3D:function(indices,pts,fl){var v,f=1,i,j=0,d,pt,q,s=[],cc=new Array(pts.length),cf=new Array(pts.length),f0,f1,f2;
if(fl){f0=fl[0],f1=fl[1],f2=fl[2];}else{f0=0,f1=1,f2=2;}for(i=0;i<indices.length;
i++){d=indices[i];if(d>=0){cc[d]++;}}for(i=0;i<pts.length;i++){if(cc[i]>1){cc[i]=j++;
}else{cc[i]=0;}}for(var i=0;i<indices.length;i++){d=indices[i];if(d>=0){pt=pts[d];
q=[this.ortho?"":"zt = persp / ((zt=(m20*"+pt[f0]+"+m21*"+pt[f1]+"+m22*"+pt[f2]+"+m23)<-0.01)?zt:-0.01);","dw12+(m00*"+pt[f0]+"+m01*"+pt[f1]+"+m02*"+pt[f2]+"+m03)*"+(this.ortho?"persp":"zt"),"dh12+(m10*"+pt[f0]+"+m11*"+pt[f1]+"+m12*"+pt[f2]+"+m13)*"+(this.ortho?"persp":"zt")];
d=f?0:i;if(cc[d]){q[1]="__t"+cc[d]+(cf[d]?"":"="+q[1]),q[2]="__t"+cc[d]+(cf[d]++?"":"="+q[2]);
}}switch(d){case -1:f=1;s.push(this.close());break;case 0:f=0;s.push(q[0],this.moveTo(q[1],q[2]));
break;case indices.length-1:s.push(q[0],this.lineTo(q[1],q[2]),this.close());break;
default:s.push(q[0],this.lineTo(q[1],q[2]));break;}}return s.join("").replace(/m\d\d\*\(?0\)?\+/g,"");
},lineTo3D:function(x,y,z,sx,sy,fl){return this.$do3D("lineTo",x,y,z,sx,sy,fl);
},moveTo3D:function(x,y,z,sx,sy,fl){return this.$do3D("moveTo",x,y,z,sx,sy,fl);
},$store3D:function(x,y){return x+";"+y+";";},store3D:function(x,y,z,sx,sy,fl){return this.$do3D("$store3D",x,y,z,sx,sy,fl);
},$do3D:function(f,x,y,z,sx,sy,fl){var _x,_y,_z;if(typeof x=="string"&&x.match(/[\[\]\*\+\-\/]/)){x="(_x="+x+")",_x="_x";
}else{x="("+x+")",_x=x;}if(typeof y=="string"&&y.match(/[\[\]\*\+\-\/]/)){y="(_y="+y+")",_y="_y";
}else{y="("+y+")",_y=y;}if(typeof z=="string"&&z.match(/[\[\]\*\+\-\/]/)){z="(_z="+z+")",_z="_z";
}else{z="("+z+")",_z=z;}if(fl){var v=[x,y,z],_v=[_x,_y,_z];x=v[_x=fl[0]],y=v[_y=fl[1]],z=v[_z=fl[2]];
_x=_v[_x],_y=_v[_y],_z=_v[_z];}var r=[];if(!this.ortho){r.push("zt =persp/((zt=m20*"+x+"+m21*"+y+"+m22*"+z+"+m23)<-0.01?zt:-0.01);");
}r.push(this[f]((sx===undefined?"":sx)+"dw12+(m00*"+_x+"+m01*"+_y+"+m02*"+_z+"+m03)*"+(this.ortho?"persp":"zt"),(sy===undefined?"":sy)+"dh12+(m10*"+_x+"+m11*"+_y+"+m12*"+_z+"+m13)*"+(this.ortho?"persp":"zt")));
return r.join("").replace(/m\d\d\*\(?0\)?\+/g,"");},parseStyle:function(def,ovl,err){var style={},o,v,k,s,t,i,j,n,m;
var _self=this;if(!(t=_self.stateTransition)[262145]){s={};for(v in t){for(i=0;
i<32;i++){s[v|i]=t[v]|i;}}_self.stateTransition=s;}ovl=ovl?this.parseJSS(ovl.item?ovl.join(""):ovl,err):{};
function stylecopy(dst,src,key){var t,k,v,o;for(k in src){if(dst[k]===undefined){dst[k]=_self.isDynamic(v=src[k])?_self.parseJSS(v):v;
}}if(t=src.inherit){stylecopy(dst,def[t]||_self["$"+t],t);}if(o=ovl[key]){for(k in o){dst[k]=o[k];
}}}for(k in def){if(typeof(v=def[k])=="object"&&v!==null&&v["$"]==1){stylecopy(style[k]={},v,k);
}}function styleinherit(dst,b,c,s){var o,v,k;do{if(!c&&!s){o=style[b];}else{o=ovl[b+(c?"."+c:"")+(s?":"+s:"")];
}if(typeof(o)=="object"){for(k in o){if(k.indexOf("$")==-1&&dst[k]===undefined){dst[k]=o[k];
}}}if(s){s=_self.$stateInherit[v];}}while(s);}for(k in ovl){if(typeof(v=ovl[k])=="object"){t=k.match(/([\w\_-]+)\.?([\w\_-]+)?\:?([\w\_-]+)?/);
var base=t[1],cls=t[2],state=t[3];if(cls||state){o=style[k]={};if(state){if(cls){styleinherit(o,base,cls,state);
}styleinherit(o,base,0,state);}if(cls){styleinherit(o,base,cls,0);}styleinherit(o,base,0,0);
o.$cls=cls?cls:"",o.$state=state?state:"";o.$base=s=style[base];if(!s){alert("ERROR, baseless style found: "+base);
return;}(s.$stylelist?s.$stylelist:(s.$stylelist=[])).push(o);if(!cls){(s.$baselist?s.$baselist:(s.$baselist={}))[state]=1;
}else{(s.$clslist?s.$clslist:(s.$clsc=1,s.$clslist={}))[cls]=s.$clsc++;}}}}function initShape(s){if(s.stroke===null||s.stroke=="null"||s.stroke==0){delete s.stroke;
}if(s.fill===null||s.fill=="null"||s.fill==0){delete s.fill;}if(s.family===null||s.family=="null"||s.family==0){delete s.family;
}if((s.isshape&&s.fill===undefined&&s.stroke===undefined&&s.tile===undefined)||(s.isfont&&s.family===undefined)){return false;
}if(s.isshape){s.opacity=s.opacity!==undefined?s.opacity:1;s.fillopacity=s.fillopacity!==undefined?s.fillopacity:s.opacity;
s.gradopacity=s.gradopacity!==undefined?s.gradopacity:s.fillopacity;s.strokeopacity=s.strokeopacity!==undefined?s.strokeopacity:s.opacity;
s.angle=s.angle!==undefined?s.angle:0;s.weight=s.weight!==undefined?s.weight:1;
}return true;}for(k in style){if(typeof(s=style[k])=="object"){if(s.$baselist&&s.$clslist){delete s.$clsc;
for(i in s.$clslist){for(j in s.$baselist){if(!style[t=k+"."+i+":"+j]){if((m=style[k+":"+j])&&m.overlay){(m.$clsovl?m.$clsovl:m.$clsovl=[]).push(i);
}else{style[t]=o={};for(v in (t=style[k+"."+i])){o[v]=t[v];}for(v in (t=ovl[k+":"+j])){o[v]=t[v];
}o.$cls=i,o.$state=j,o.$base=s;initShape(o);s.$stylelist.push(o);}}}}}if(s.$stylelist){s.$storelut={};
s.$speedlut={};s.$overlaylut={};var cls,state,ovl,idx;j=s.$stylelist;for(i=0;i<j.length;
i++){o=j[i];cls=s.$clslist?(s.$clslist[o.$cls]||0):0;state=apf.draw.stateBit[o.$state]||0;
o.$lutvalue=state|cls;o.$store=n;if(t=o.overlay){if(t=="base"){ovl=cls?cls:268435456;
}else{ovl=(s.$clslist?(s.$clslist[t]||0):0)|(apf.draw.stateBit[t]||0);}}else{ovl=0;
}s.$storelut[state|cls]=i;s.$speedlut[state|cls]=o.speed||1;if(ovl){s.$overlaylut[state|cls]=ovl;
}if(o.$clsovl){for(m=o.$clsovl.length-1;m>=0;m--){cls=s.$clslist?(s.$clslist[o.$clsovl[m]]||0):0;
s.$storelut[state|cls]=i;s.$speedlut[state|cls]=o.speed||1;if(ovl){s.$overlaylut[state|cls]=(ovl==268435456)?cls:ovl;
}}}}}if(!initShape(s)){delete style[k];}}}return style;},stateBit:{0:0,init:16777216,hidden:65536,deinit:33554432,hover:131072,hoverin:16908288,hoverout:33685504,select:196608,selectin:16973824,selectout:33751040,selecthover:262144,selecthoverin:17039360,selecthoverout:33816576,animating:50659328},stateTransition:{16777216:0,33554432:65536,16908288:131072,33685504:0,16973824:196608,33751040:0,17039360:262144,33816576:196608,17104896:17104896},stateMask:{selected:16777216|8388608|2097152|1048576|524288,normal:536870912|134217728|67108864|33554432|262144,dynamic:536870912|268435456|67108864|33554432|8388608|4194304|1048576|524288|262144,hover:134217728|67108864|2097152|1048576},$stateInherit:{hidden:0,init:0,deinit:0,hover:0,hoverin:"hover",hoverout:"hover",select:0,selectin:"select",selectout:"select",selecthover:"hover",selecthoverin:"selecthover",selecthoverout:"selecthover",animating:0},$stateFallback:{init:1,hover:1,hoverin:"hover",hoverout:1,select:1,selectin:"select",selectout:1,selecthover:"hover",selecthoverin:"selecthover",selecthoverout:"select",hidden:1},getXYWH:function(m,p,noflatten){var t;
if(!((t=this.$getXYWH_NT[p])||(p=this.$getXYWH_TN[t=p]))){return"0";}if(m==null){return"0";
}if(typeof(m)=="object"){if(m.sort){return --p>=m.length?"0":((t=m[p])&&t.sort&&!noflatten?t.join(""):t);
}return(t=m[t])===undefined||p>1?"0":(t&&t.sort&&!noflatten?t.join(""):t);}return p==1?m:"0";
},$getXYWH_NT:{1:"x",2:"y",3:"z",4:"w"},$getXYWH_TN:{x:1,y:2,z:3,w:4},getTRBL:function(m,p,noflatten){var t;
if(!((t=this.$getTRBL_NT[p])||(p=this.$getTRBL_TN[t=p]))){return"0";}if(m==null){return"0";
}if(typeof(m)=="object"){if(m.sort){return --p>=m.length?"0":((t=m[p])&&t.sort&&!noflatten?t.join(""):t);
}return(t=m[t])===undefined||p>1?"0":(t&&t.sort&&!noflatten?t.join(""):t);}return p==1?m:"0";
},$getTRBL_NT:{1:"t",2:"r",3:"b",4:"l"},$getTRBL_TN:{t:1,y1:1,r:2,x2:2,b:3,y2:3,l:4,x1:4},getFlat:function(m){if(typeof(m)=="object"&&m.sort){return m.join("");
}return m;},getColor:function(a){if(a.match(/\(/)){return a;}if(a.match(/^#/)){return"'"+a+"'";
}var b=a.toLowerCase();return(this.colors[b])?"'"+this.colors[b]+"'":a;},getX:function(s,pre,val,post,def){var v;
return(typeof(v=s[val+"-x"])=="undefined"&&(typeof(v=s[val])!="object"||typeof(v=v[0])=="undefined"))?(typeof(def)!="undefined"?def:""):(pre+v+post);
},getY:function(s,pre,val,post,def,ovl){var v;return(typeof(v=s[val+"-y"])=="undefined"&&(typeof(v=s[val])!="object"||typeof(v=v[1])=="undefined"))?(typeof(def)!="undefined"?def:""):(pre+v+post);
},checkX:function(s,val,ovl,no){var v;return(typeof(v=s[val+"-x"])=="undefined"&&(typeof(v=s[val])!="object"||typeof(v=v[0])=="undefined"))?(typeof(no)=="undefined"?"":no):ovl;
},checkY:function(s,val,ovl,no){var v;return(typeof(v=s[val+"-y"])=="undefined"&&(typeof(v=s[val])!="object"||typeof(v=v[1])=="undefined"))?(typeof(no)=="undefined"?"":no):ovl;
},isDynamic:function(a){return a&&typeof(a)=="string"&&!(a.indexOf(".")!=-1&&a.match(/^[\s:a-zA-Z0-9\/\\\._-]+$/))&&a.match(/[\(+*\/-]/)!=null;
},baseMacro:function(code){for(var j=code.length,i=0,v;i<j;i++){if(typeof(v=code[i])=="object"){code[i]=this.parseJSS(v[0]);
}}var r=this.optimize([this.basevars(),code.join(""),]);return r;},optimize:function(code){var c2,c3,s=[],cnt={},n=0;
if(typeof(code)=="object"){code=code.join("");}code.replace(/\_\_(\w+)/g,function(m,a){if(!cnt[a]){if(a.length<=2){s.push("__"+a);
}else{s.push("__"+a+"=Math."+a);}cnt[a]=1;}});code=code.replace(/(__(\w+))\((\-?\d+\.?\d*)\)/g,function(m,a,b,c){if(a=="__round"){return Math.round(c);
}return Math[b](c);});if(code.match("_rndtab")){s.push("_rndtab=apf.draw.$rndtab");
}code=s.length?code.replace(/\_math\_/,s.join(",")):code;cnt={},n=0,s=[];code=s.length?code.replace(/\_opt\_/,s.join(",")):code;
code=code.replace(/__round\((d[wh])\)/g,"$1");return code;},parseJSS:function(s,err,inobj,debug){if(!s){return{};
}var mulinsert=true;var lp=0,sm=0,t,i,len,fn=0,sfn=[],arg=[],sarg=[],ac=[],sac=[],sn=[],obj=inobj||{},prop=0,sobj=[],_self=this,mn={1:"}",2:")",3:"]",4:")",5:"}"},rn={"{":1,"(":2,"[":3},ln=6;
try{s=s.replace(/\/\*[\S\s]*?\*\/|\/\/.*?;/g,"");s.replace(/(["'])|(\^)|([\w\.\_]+\:?[\w\_\s-]*)\s*\{\s*|([\w\_]+)\s*[:]+\s*|([\w\.\_]+)\s*\(\s*|(\#[0-9a-zA-Z]+|0x[0-9a-zA-Z]+)|(\d+\.?\d*[\_a-zA-Z]+)|([({\[])|([)}\]])|(\\["'{}\[\](),;\:]|\s*[\<\>\=*+\%@&\/]\s*|\s*\-\s+)|([,\s]+)|(;)|$/g,function(m,str,exp,openobj,openval,openmac,hexobj,numobj,open,close,skip,sep,split,pos){if(skip||hexobj){return m;
}if(sm||str){if(str&&!sm){sm=str;}else{if(sm==str){sm=0;}}return m;}if(sep){ac.push(s.slice(lp,pos));
arg.push(ac.join(""));lp=pos+sep.length,ac=[];return m;}if(openval){if(ln>=5){ln=6,prop=openval,lp=pos+m.length;
arg=[],ac=[];}return m;}if(numobj){ac.push(s.slice(lp,pos));t=m.match(/(\d\.?\d*)(.+)/);
ac.push(t[1],"*",t[2]);lp=pos+m.length;return m;}if(openmac){sn.push(ln=4);if(pos>lp){ac.push(s.slice(lp,pos));
}if(ac.length&&ac[ac.length-1].match(/\)\s*$/)){ac.push("*");}if(t=openmac.match(/(\d\.?\d*)(.+)/)){ac.push(t[1]+"*");
openmac=t[2];}sac.push(ac);sarg.push(arg);sfn.push(fn);fn=openmac;arg=[],ac=[],lp=pos+m.length;
return m;}if(openobj){if(ln<5){throw ({t:"JSS Error - object scope found inside macro",p:pos});
}lp=pos+m.length;sn.push(ln=5);(openobj=openobj.replace(/^\s*/,"").replace(/\s*$/,"").split(" ")).length>1?(openobj=openobj[1]+"@"+openobj[0]):openobj=openobj[0];
sobj.push(obj);obj=(typeof(t=obj[openobj])=="object")?t:(obj[openobj]={});return m;
}if(open){sn.push(ln=rn[open]);if(ln==1&&prop){sn.pop();lp=pos+m.length;sn.push(ln=5);
sobj.push(obj);obj=(typeof(t=obj[prop])=="object")?t:(obj[prop]={});}else{if(ln==3){if(pos>lp){ac.push(s.slice(lp,pos));
}sac.push(ac);sarg.push(arg);arg=[],ac=[],lp=pos+open.length;}}return m;}if(close){if(!sn.length||mn[ln=sn.pop()]!=close){throw ({t:"JSS Error - closed "+ln+" with "+close,p:pos});
log();}switch(ln){case 3:ac.push(s.slice(lp,pos));arg.push(ac.join(""));if(sarg.length!=1){(ac=sac.pop()).push("[",arg.join(","),"]");
arg=sarg.pop();}else{sac.pop();t=sarg.pop();ac=[];for(i=0,len=arg.length;i<len;
i++){t.push(arg[i]);}arg=t;}lp=pos+close.length;break;case 4:ac.push(s.slice(lp,pos));
arg.push(ac.join(""));(ac=sac.pop()).push((t=_self[fn])?t.apply(_self,arg):fn+"*("+arg.join(",")+")");
arg=sarg.pop(),fn=sfn.pop(),lp=pos+1;break;case 5:ac.push(s.slice(lp,pos));arg.push(ac.join(""));
lp=pos+close.length,ac=[];if(prop){obj[prop]=arg.length>1?arg:arg[0];}arg=[],prop=null,obj=sobj.pop();
break;}if(!sarg.length){ln=6;}return m;}if(ln>=5){ac.push(s.slice(lp,pos));if((t=ac.join("")).length){arg.push(t);
}lp=pos+m.length,ac=[];if(prop){obj[prop]=arg.length>1?arg:arg[0];}else{if(t&&sn.length==0){obj=arg.length>1?arg:arg[0];
}}arg=[],prop=null;}return m;});if(sm){throw ({t:"JSS Error - Unclosed string found "+sm,p:lp});
}if(sn.length>0){throw ({t:"JSS Error - Unclosed object found "+sn[sn.length-1],p:lp});
}}catch(e){apf.alert_r(e);if(err){err.v=e.p>=0?e.t+" at: "+e.p+" ->"+s.slice((t=e.p-4)<0?0:t,7)+"<-":e.t;
}return null;}return obj;},sin:function(a){return"__sin("+a+")";},cos:function(a){return"__cos("+a+")";
},tan:function(a){return"__tan("+a+")";},asin:function(a){return"__asin("+a+")";
},acos:function(a){return"__acos("+a+")";},atan:function(a){return"__atan("+a+")";
},atan2:function(a){return"__atan2("+a+")";},floor:function(a){return"__floor("+a+")";
},exp:function(a){return"__exp("+a+")";},log:function(a){return"__log("+a+")";},pow:function(a,b){return"__pow("+a+","+b+")";
},random:function(a){return"__random("+a+")";},round:function(a){return"__round("+a+")";
},sqrt:function(a){return"__sqrt("+a+")";},$pal:function(imode,n){var s=["'#'+('000000'+(__round(","((__a=parseInt((__t=["];
for(var i=2,len=arguments.length;i<len;i++){var t=arguments[i];s.push(i>2?",":"");
if(apf.draw.colors[t]){s.push("'",apf.draw.colors[t],"'");}else{if(t.match(/\(/)){s.push(t);
}else{if(t.match(/^#/)){s.push("'",t,"'");}else{s.push(t);}}}}if(imode&2){s.push("])[ (__g=__floor( __c=(__f=(",n,")",(imode&1)?"*"+(len-3):"",")<0?0:__f))>",len-3,"?",len-3,":__g].slice(1),16))&0xff)","*(__d=1-(__c-__floor(__c)))","+((__b=parseInt(__t[ (__g=__ceil(__c))>",len-3,"?",len-3,":__g","].slice(1),16))&0xff)*(__e=1-__d) )","+(__round(__d*(__a&0xff00)+__e*(__b&0xff00))&0xff00)","+(__round(__d*(__a&0xff0000)+__e*(__b&0xff0000))&0xff0000)",").toString(16)).slice(-6)");
}else{s.push("])[ __floor( __c=(__f=(",n,")",imode?"*"+(len-3):"",")<0?-__f:__f)%",len-2,"].slice(1),16))&0xff)","*(__d=1-(__c-__floor(__c)))","+((__b=parseInt(__t[ __ceil(__c)%",len-2,"].slice(1),16))&0xff)*(__e=1-__d) )","+(__round(__d*(__a&0xff00)+__e*(__b&0xff00))&0xff00)","+(__round(__d*(__a&0xff0000)+__e*(__b&0xff0000))&0xff0000)",").toString(16)).slice(-6)");
}return s.join("");},$lut:function(imode,n){var s=["(["],a,i=2,len=arguments.length;
for(;i<len;i++){a=arguments[i];s.push(i>2?",":"");if(typeof(a)=="string"&&a.match(/\(/)||a.match(/^['"]/)){s.push(a);
}else{s.push("'",a,"'");}}s.push("])[__floor((__b=((",n,")",imode?"*"+(len-3):"",")%",len-2,")<0?-__b:__b)]");
return s.join("");},$lin:function(imode,n){var s=["((__t=["],a,i=2,len=arguments.length;
for(;i<len;i++){a=arguments[i];s.push(i>2?",":"");if(typeof(a)=="string"&&a.match(/\(/)||a.match(/^['"]/)){s.push(a);
}else{s.push("'",a,"'");}}s.push("])[__floor( __c=(__f=(",n,")",imode?"*"+(len-3):"",")<0?-__f:__f)%",len-2,"]","*(__d=1-(__c-__floor(__c)))","+__t[ __ceil(__c)%",len-2,"]*(__e=1-__d) )");
return s.join("");},fixed:function(a,v,nz){v="parseFloat(("+a+").toFixed("+v+"))";
return parseInt(nz)?this.nozero(a,v):v;},padded:function(a,v,nz){v="("+a+").toFixed("+v+")";
return parseInt(nz)?this.nozero(a,v):v;},abs:function(a){if(parseFloat(a)==a){return Math.abs(a);
}if(typeof(a)=="number"||a.match(/$[a-z0-9_]+^/)){return"("+a+"<0?-"+a+":"+a+")";
}return"((__t="+a+")<0?-__t:__t)";},min:function(a,b){if(b===null){return a;}if(parseFloat(a)==a&&parseFloat(b)==b){return Math.min(a,b);
}var a1=a,b1=b,a2=a,b2=b;if(typeof(a)=="string"&&!a.match(/$-?[a-z0-9\_]+^/)){a1="(__a="+a+")",a2="__a";
}if(typeof(b)=="string"&&!b.match(/$-?[a-z0-9\_]+^/)){b1="(__b="+b+")",b2="__b";
}return"(("+a1+")<("+b1+")?"+a2+":"+b2+")";},max:function(a,b){if(b===null){return a;
}if(parseFloat(a)==a&&parseFloat(b)==b){return Math.max(a,b);}var a1=a,b1=b,a2=a,b2=b;
if(typeof(a)=="string"&&!a.match(/$-?[a-z0-9\_]+^/)){a1="(__c="+a+")",a2="__c";
}if(typeof(b)=="string"&&!b.match(/$-?[a-z0-9\_]+^/)){b1="(__d="+b+")",b2="__d";
}return"(("+a1+")>("+b1+")?"+a2+":"+b2+")";},clamp:function(a,b,c){if(b===null||c==null){return a;
}return this.max(this.min(a,c),b);},pal:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(1);return this.$pal.apply(this,arg);},pali:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(0);return this.$pal.apply(this,arg);},palc:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(3);return this.$pal.apply(this,arg);},palci:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(2);return this.$pal.apply(this,arg);},lin:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(1);return this.$lin.apply(this,arg);},lini:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(0);return this.$lin.apply(this,arg);},lut:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(1);return this.$lut.apply(this,arg);},luti:function(){var arg=Array.prototype.slice.call(arguments,0);
arg.unshift(0);return this.$lut.apply(this,arg);},$rgbpack:function(r,g,b){return a;
},rgb:function(r,g,b){if(parseFloat(r)==r&&parseFloat(g)==g&&parseFloat(b)==b){return this.$rgbpack(r,g,b);
}return["('#'+('000000'+(",(parseFloat(r)==r?((r<0?0:(r>255?255:parseInt(r)))<<16):"(((__t="+r+")<0?0:(__t>255?255:parseInt(__t)))<<16)"),"+",(parseFloat(g)==g?((g<0?0:(g>255?255:parseInt(g)))<<8):"(((__t="+g+")<0?0:(__t>255?255:parseInt(__t)))<<8)+"),"+",(parseFloat(b)==b?((b<0?0:(b>255?255:parseInt(b)))):"(((__t="+b+")<0?0:(__t>255?255:parseInt(__t))))"),").toString(16)).slice(-6))"].join("");
},$hsvpack:function(h,s,v){var i,m=v*(1-s),n=v*(1-s*((i=Math.floor(((h<0?-h:h)%1)*6))?h-i:1-(h-i)));
switch(i){case 6:case 0:return this.$rgbpack(v,n,m);case 1:return this.$rgbpack(n,v,m);
case 2:return this.$rgbpack(m,v,n);case 3:return this.$rgbpack(m,n,v);case 4:return this.$rgbpack(n,m,v);
default:case 5:return this.$rgbpack.rgb(v,m,n);}},hsv:function(h,s,v){if(parseFloat(r)==r&&parseFloat(g)==g&&parseFloat(b)==b){return this.$hsvpack(r,g,b);
}return"apf.draw.$hsvpack("+h+","+s+","+v+");";},rgbf:function(r,g,b){return this.rgb(parseFloat(r)==r?r*255:"255*("+r+")",parseFloat(g)==g?g*255:"255*("+g+")",parseFloat(b)==b?b*255:"255*("+b+")");
},nozero:function(a,v,z){return"(("+a+")>-0.0000000001 && ("+a+")<0.0000000001)?"+(z!==undefined?z:"''")+":("+(v!==undefined?v:a)+")";
},$rndtab:null,rnd:function(a){if(a){if(!this.$rndtab){var i,t=this.$rndtab=Array(256);
for(i=-256;i<256;i++){t[i]=Math.random();}}return"_rndtab[__round(("+a+")*255)%255]";
}return"((_rseed=(_rseed * 16807)%2147483647)/2147483647)";},ang:function(a){if(a==parseFloat(a)){return a*(Math.PI/180);
}return"(("+a+")*p/180)";},snap:function(a,b){return"(__round(("+a+")/(__t=("+b+")))*__t)";
},rnds:function(a,b){return this.rnd(this.snap(a,b));},tsin:function(a){return"(0.5+0.5*__sin("+a+"))";
},tcos:function(a){return"(0.5+0.5*__cos("+a+"))";},usin:function(a){return"(0.5-0.5*__sin("+a+"))";
},ucos:function(a){return"(0.5-0.5*__cos("+a+"))";},two:function(a){return"(0.5+0.5*("+a+"))";
},easein:function(t,pow){if(!pow){pow="3";}return["__pow(",t,",",pow,")"].join("");
},easeout:function(t,pow){if(!pow){pow="3";}return["(1-__pow(1-(",t,"),",pow,"))"].join("");
},ease:function(t,powin,powout){if(!powin){powin="3";}if(!powout){powout=powin;
}return["(0.5*((__a=2*(",t,"))<1?","__pow(__a,",powin,"):","(2-__pow(2-__a,",powout,"))))"].join("");
},fontz:function(a,b){return(-a/b)+(this.ortho?"*perspd":"*(perspd/__z)");},$canJoin:function(a,b){if(a.isfont&&b.isfont){return a.join!=null&&b.join!=null&&a.family===b.family&&a.join===b.join&&a.height==b.height&&a.width==b.width&&a.align===b.align&&a.color===b.color&&a.size===b.size&&a.style===b.style;
}if(a.isshape&&b.isshape){return a.join!=null&&b.join!=null&&a.stroke===b.stroke&&a.join===b.join&&a.weight==b.weight&&a.fill===b.fill&&a.fillopacity===b.fillopacity&&a.strokeopacity===b.strokeopacity&&a.angle===b.angle;
}return false;},$shape:{isshape:true,stroke:null,fill:null,tilex:"(this.$tilex)",tiley:"(this.$tiley)"},$font:{isfont:true,height:12,family:"verdana",weight:"normal",color:"#00000",size:10},draw3D:function(x,y,z,w,h,d){return"";
},beginMouseState:function(style,sthis,func,nargs){var s=[],l=this.l;this.mousestyle=style;
this.mousethis=sthis;this.mousefunc=func;this.mousestates=[];var v=style.$statelist,i,j,t,u;
if(!v||!v.length){return"";}v=this.mousestates=v.slice(0);if(v[0]!=style){v.unshift(style);
}if(!l._mousestyles){l._mousestyles=[];}for(i=0,j=v.length;i<j;i++){u=(t=v[i])._mid=l._mousestyles.push(t)-1;
if(t.$store){t.$store._mid=u;}}s.push("_s = l._mousestyles[",style._mid,"], _sh = _s.$statehash, _sp = _s.$speedhash;");
return s.join("");},checkMouseState:function(state,time){var a=[],t,i,j,v=this.mousestates,s;
if(!v||!v.length){for(i=2,j=arguments.length;i<j;i++){a.push(arguments[i]);}a.push(true);
this.style=this.mousestyle;s=this.mousefunc.apply(this.mousethis,a);this.style=0;
return s;}s=["t=(n-",time,")*(_sp[_t=_sh[",state,"]]||100000);"];for(i=2,j=arguments.length;
i<j;i++){a.push(t="_s"+(i-1));s.push(t,"=",arguments[i],(i!=j-1)?",":";");}a.push(true);
s.push("switch(_t?_t._mid:0){");for(i=0,j=v.length;i<j;i++){var style=v[i];this.style=style;
if(v[i]){s[s.length]=["case ",style._mid,":{","/*"+apf.vardump(style,0,1)+"*/\n",this.mousefunc.apply(this.mousethis,a),"}break;"].join("");
}}s.push("};");this.style=0;return s.join("");},$endMouseState:function(){this.mousestyle=0;
return"";},shapedPart:function(x,y,w,h,rs,rw,m){var t=this.style;var ds="0",dw="1";
var gx=this.getX,gy=this.getY,cx=this.checkX,cy=this.checkY;switch(t.shape){default:case"pie":if(gx(t,"","scale","","1")!="1"){rs=["_x5=(",gx(t,"(","offset",")+"),"(",rs,")","+",gx(t,"(","center",")","0.5"),"*(_x3=",rw,")",gx(t,"*(1-(_x4=","scale","))"),")*p2"].join("");
rw="_x5+(_x3*_x4)*p2";}else{rs=["_x5=(",gx(t,"(","offset",")+"),"(",rs,")",")*p2"].join("");
rw="_x5+("+rw+")*p2";}if(gy(t,"","scale","","1")!="1"){ds=[gy(t,"(","offset",")+"),gy(t,"(","center",")","0.5"),gy(t,"*(1-(_y4=","scale","))")].join("");
dw="_y4";}else{ds=[gy(t,"(","offset",")","0")].join("");dw="1";}if(ds!="0"){x="_x6=__sin(_y8=((_x9="+rs+")+(_y9="+rw+"))*0.5)*(_x8="+ds+")*(_x7="+w+")+("+x+")"+gx(t,"+_x7*(","move",")");
y="_y6=__cos(_y8)*_x8*(_y7="+h+")+("+y+")"+gy(t,"+_y7*(","move",")");w="_x7*(_x3="+dw+")";
h="_y7*_x3";rs="_x9";rw="_y9";}else{x="_x6=("+x+")";y="_y6=("+y+")";w=dw=="1"?"("+w+")":"("+w+")*(_x3="+dw+")";
h=dw=="1"?"("+h+")":"("+h+")*_x3";}if(m){return["if( ((_x1=((",x,")-mx)/(",w,"))*_x1+(_y1=((",y,")-my)/(",h,"))*_y1) < 1 ){","_x1=(p+__atan2(_x1,_y1));","if( ((_x2=(",rs,")%p2)<0?(_x2=p2-_x2):_x2) >","((_y2=(",rw,")%p2)<0?(_y2=p2-_y2):_y2) ){","if(_x1 >= _x2 || _x1<=_y2 )return x;","}else{","if(_x1 >= _x2 && _x1<=_y2 )return x;","}","}"].join("");
}else{return[this.moveTo(x,y),this.ellipse("_x6","_y6",w,h,rs,rw,1),this.close()].join("");
}}},shapedRect:function(x,y,w,h,m){var t=this.style;var gx=this.getX,gy=this.getY,cx=this.checkX,cy=this.checkY;
function rect(){if(gx(t,"","scale","","1")!="1"){x=[gx(t,"dzw*(","offset",")+"),"(",x,")","+",gx(t,"(","center",")","0.5"),"*(_x3=",w,")",gx(t,"*(1-(_x4=","scale","))"),gx(t,"+_x3*(","move",")")].join("");
w="_x3*_x4";}else{x=[gx(t,"dzw*(","offset",")+"),"(",x,")",gx(t,"+(_x3="+w+")*(","move",")")].join("");
w=cx(t,"move","_x3",w);}if(gy(t,"","scale","","1")!="1"){y=[gy(t,"dzh*(","offset",")+"),"(",y,")","+",gy(t,"(","center",")","0.5"),"*(_y3=",h,")",gy(t,"*(1-(_y4=","scale","))"),gy(t,"+_y3*(","move",")")].join("");
h="_y3*_y4";}else{y=[gy(t,"dzh*(","offset",")+"),"(",y,")",gy(t,"+(_y3="+h+")*(","move",")")].join("");
h=cy(t,"move","_y3",h);}}switch(t.shape){case"rect":default:if(!t.rotate){rect();
if(m){return["if( (_x9 = mx - (",x,"))>=0 && _x9<(",w,")&&","    (_y9 = my - (",y,"))>=0 && _y9<(",h,")) return x;",].join("");
}return this.rect(x,y,w,h);}else{return["_x9=(_x8=(_x6=",gx(t,"(","center",")","0.5"),"*(_x3=",w,"))*(",gx(t,"(1-(_x4=","scale","))","0"),"-1))+_x3",cx(t,"scale","*_x4"),";","_y9=(_y8=(_y6=",gy(t,"(","center",")","0.5"),"*(_y3=",h,"))*(",gy(t,"(1-(_y4=","scale","))","0"),"-1))+_y3",cy(t,"scale","*_y4"),";",this.moveTo("(_cr=__cos(_t="+t.rotate+"))*_x8-(_sr=__sin(_t))*_y8+(_x5="+gx(t,"(","offset",")+")+x+"+_x6)","_sr*_x8+_cr*_y8+(_y5="+gy(t,"(","offset",")+")+y+"+_y6)"),this.lineTo("_cr*_x9-_sr*_y8+_x5","_sr*_x9+_cr*_y8+_y5"),this.lineTo("_cr*_x9-_sr*_y9+_x5","_sr*_x9+_cr*_y9+_y5"),this.lineTo("_cr*_x8-_sr*_y9+_x5","_sr*_x8+_cr*_y9+_y5"),this.close()].join("");
}case"circle":rect();if(m){return["if( (_x9 = mx - (",x,"))>=0 && _x9<(",w,")&&","    (_y9 = my - (",y,"))>=0 && _y9<(",h,")) return x;",].join("");
}return t.pie?[this.moveTo("_x6="+x+"+(_x5=0.5*("+w+"))","_y6="+y+"+(_y5=0.5*("+h+"))"),this.ellipse("_x6","_y6","_x5","_y5",gx(t,"","range",""),gy(t,"","range","")),this.close()].join(""):[this.ellipse(x+"+(_x5=0.5*("+w+"))",y+"+(_y5=0.5*("+h+"))","_x5","_y5",gx(t,"","range",""),gy(t,"","range","")),this.close()].join("");
break;case"polygon":if(t.frames){}else{return["_x3=((_x2=",gy(t,"","range","","2*p"),")-(_x1=",gx(t,"","range","","0"),"))/(",t.steps||10,");v=_x1;",this.moveTo("(_x4="+x+")+__sin(_x1)*(_x5="+w+")","(_y4="+y+")+__cos(_x1)*(_y5="+h+")"),"for(v=_x1+_x3;v<_x2;v+=_x3){",this.lineTo("_x4+__sin(_x1)*_x5","_y4+__cos(_x1)*_y5"),"}",this.close()].join("");
}break;case"math":if(t.frames){}else{rect();return["_x7=((_x6=",gy(t,"","range","","2*p"),")-(_x5=",gx(t,"","range","","0"),"))/(",t.steps||10,");v=_x5;",this.moveTo("(_x8="+x+")+"+gx(t,"(","path",")","0")+"*(_x9="+w+")","(_y8="+y+")+"+gy(t,"(","path",")","0")+"*(_y9="+h+")"),"for(v=_x5+_x7;v<_x6;v+=_x7){",this.lineTo("_x8"+gx(t,"+(","path",")*_x9"),"_y8"+gy(t,"+(","path",")*_y9")),"}",this.close()].join("");
}break;}return"";},$endDraw:function(){if(this.mousemode){return this.$endMouse();
}if(this.statemode){return this.$endState();}var t=this.style;if(t){if(t.isshape){return this.$endShape();
}if(t.isfont){return this.$endFont();}}return"";},serializeStyleState:function(style){var s=[],h,v,k,f;
if(!style.$stylelist){return"";}s.push("$storelist:_n=[",Array(style.$stylelist.length).join("[],"),"[]]");
s.push(",$storelut:{");h=style.$storelut;f=1;for(k in h){s.push(--f?",":"","0x",parseInt(k).toString(16),":_n[",h[k],"]");
}s.push("},$speedlut:{");h=style.$speedlut;f=1;for(k in h){s.push(--f?",":"","0x",parseInt(k).toString(16),":",h[k]);
}s.push("},$overlaylut:{");h=style.$overlaylut;f=1;for(k in h){s.push(--f?",":"","0x",parseInt(k).toString(16),":0x",parseInt(h[k]).toString(16));
}s.push("}");return s.join("");},beginState:function(style,sthis,func,nargs,dyns){var s=[this.beginShape(style.$shadow||style)];
this.statemode=1;this.statethis=sthis;this.stateargs=nargs;this.statefunc=func;
this.statedyns=dyns||[];this.statedyns.push("t","x");var v=style.$stylelist,i,n;
if(!v||!v.length){return s.join("");}s.push("_storelut = _s.$storelut, _storelist = _s.$storelist,_overlaylut = _s.$overlaylut,","_translut = apf.draw.stateTransition, _speedlut = _s.$speedlut ;\n");
for(i=0,n=v.length;i<n;i++){s[s.length]="_storelist["+i+"].length=";}s[s.length]="0;";
return s.join("");},drawState:function(state,time){var a=[],t,i,j,v=this.style.$stylelist,d;
if(!v||!v.length){for(i=2,j=arguments.length;i<j;i++){a.push(arguments[i]);}return this.statefunc.apply(this.statethis,a);
}var s=["if((_t=",state,")&0x0f000000){","if((t=(n-(",time,"))*(_speedlut[_t]||100000))>1){","_t=",state,"=_translut[_t],",time,"=n,t=0;","}","if(_t&0x0f000000)_anim=1,nt=1-t;","}"];
for(i=2,j=arguments.length;i<j;i++){a.push(t="_s"+(i-1));s.push(t,"=",arguments[i],(i!=j-1)?",":";");
}d=this.statedyns.join(",");t=a.join(",");s.push("if(_st=_storelut[_t]){","_st.push(",d,",",t,");","while(_t=_overlaylut[_t]){","if(_st = _storelut[_t]){_st.push(",d,",",t,");}","};","};","if(!_st){",this.statefunc.apply(this.statethis,a),"}\n");
return s.join("");},$endState:function(){this.statemode=0;var style=this.style,s=[this.$endDraw()];
var v=style.$stylelist,i,j,l,m,n=this.stateargs+this.statedyns.length,a=[],d=[];
if(!v||!v.length){return s.join("");}for(i=this.statedyns.length;i<n;i++){a.push("_su[_sv+"+i+"]");
}for(i=0;i<this.statedyns.length;i++){d.push(this.statedyns[i]+"=_su[_sv+"+i+"]");
}d=d.join(",");for(i=0,j=v.length;i<j;i++){style=v[i];s[s.length]=["if((_st=(_su=_storelist["+i+"]).length)>0){","_sv=0,",d,";",this.beginShape(style),"for(_sv=0;_sv<_st;_sv+=",n,"){",d,",nt = 1-t;",this.statefunc.apply(this.statethis,a),"}",this.$endDraw(),"}else _styles[",style._id,"]._path=[];\n"].join("");
}return s.join("");},beginFont:function(style,needed,ml,mt,mr,mb){if(!style||needed===undefined){return"document.title='beginFont Failed';";
}var l=this.l,html=l._htmljoin,s=[this.$endDraw()];this.style=style;style._id=l._styles.push(style)-1;
ml=ml!==undefined?ml/l.ds:0;mt=mt!==undefined?mt/l.ds:0;mr=mr!==undefined?mr/l.ds:0;
mb=mb!==undefined?mb/l.ds:0;if(parseInt(style.left)!=style.left){this.mx="+("+style.left+")"+(ml?"-"+ml:"");
}else{this.mx="+"+(style.left-ml);}if(parseInt(style.top)!=style.top){this.my="+("+style.top+")"+(mt?"-"+mt:"");
}else{this.my="+"+(style.top-mt);}this.dynsize=(parseInt(style.size)!=style.size);
style._txtdiv=["<div style='",(style.vertical)?"filter: flipv() fliph(); writing-mode: tb-rl;":"","position:absolute;cursor:default;overflow:hidden;left:0;top:0;display:none;font-family:",style.family,";color:",style.color,";font-weight:",style.weight,";",";font-size:",this.dynsize?10:style.size,"px;",(style.stroke!==undefined)?"border:1px solid "+style.stroke+";":"",(style.fill!==undefined)?"background:"+style.fill+";":"",(style.width!==undefined)?"width:"+style.width+"px;":"",(style.height!==undefined)?"height:"+style.height+"px;":"",(style.style!==undefined)?"font-style:"+style.style+";":"",(style.align!==undefined)?"text-align:"+style.align+";":"","'>-</div>"].join("");
html.push("<div onmousedown='return false' style='cursor:default;position:absolute;left:",ml,"px;top:",mt,"px;width:",l.width-(mr+ml),"px;height:",l.height-(mb+mt),"px;overflow:hidden;'></div>");
s.push("_s=_styles[",style._id,"],_tn=_s._txtnodes,_tc = 0;\n");s.push("if((_l=(",needed,")) > _tn.length-_tc)apf.draw.$allocText(_s,_l);");
return s.join("");},text:function(x,y,text){var t=((this.l.ds>1)?"/"+this.l.ds:"");
return["if( (_t=_tn[_tc++]).s!=(_v=",text,") )_t.v.nodeValue=_t.s=_v;","if(_t.x!=(_v=__round(",x,")))_t.n.style.left=_t.x=(_v",t,this.mx,")+'px';","if(_t.y!=(_v=__round(",y,")))_t.n.style.top=_t.y=(_v",t,this.my,")+'px';",this.dynsize?["if(_t.sz!=(_v=__round(",this.style.size,"))&&_v>0)_t.n.style.fontSize=_t.sz=_v+'px';"].join(""):""].join("");
},$allocText:function(style,needed){var t,tn=style._domnode,ts=style._txtnodes;
if(!ts.length){tn.innerHTML=Array(needed+1).join(style._txtdiv);}else{tn.insertAdjacentHTML("beforeend",Array(needed+1).join(style._txtdiv));
}while(needed-->0){t=tn.childNodes[ts.length];ts.push({x:-10000000000,y:-10000000000,n:t,v:t.firstChild,sz:-1,s:null});
}},$endFont:function(){this.last=this.style._id;this.style=0;this.mx="",this.my="";
return"_s._txtcount = _tc;";},$finalizeFont:function(style){var s=["if((_lc=(_s=_styles[",style._id,"])._txtused)>","(_tc=_s._txtcount)){_tn=_s._txtnodes;","for(;_lc>_tc;)_tn[--_lc].n.style.display='none';","_s._txtused=_tc;","} else if(_lc<_tc) {_tn=_s._txtnodes;","for(;_lc<_tc;)_tn[_lc++].n.style.display='block';","_s._txtused=_tc;","}\n"];
return s.join("");},colors:apf.color.colors};apf.flow={isMoved:false,objCanvases:{},connectionsTemp:null,connectionsManager:null,sSize:7,fsSize:15,init:function(){document.body.onmousedown=function(e){e=(e||event);
var target=e.target||e.srcElement,isDragged=false;if(target.tagName=="HTML"){return;
}while(target!=document.body&&!apf.flow.findBlock(target.id)){target=target.parentNode||target.parentElement;
}var objBlock=apf.flow.isBlock(target);if(!objBlock){return;}if(!objBlock.draggable){return;
}var sx=e.clientX,sy=e.clientY,dx=0,dy=0,l=parseInt(target.style.left),t=parseInt(target.style.top),newTop,newLeft;
var snap=objBlock.canvas.snap,gridW=objBlock.canvas.gridW,gridH=objBlock.canvas.gridH;
if(e.preventDefault){e.preventDefault();}document.body.onmousemove=function(e){e=(e||event);
isDragged=true;dx=e.clientX-sx;dy=e.clientY-sy;newTop=t+dy;newLeft=l+dx;if(snap){target.style.left=Math.round(newLeft/gridW)*gridW+"px";
target.style.top=Math.round(newTop/gridH)*gridH+"px";}else{target.style.left=newLeft+"px";
target.style.top=newTop+"px";}objBlock.onMove();apf.flow.onblockmove();return false;
};document.body.onmouseup=function(e){document.body.onmousemove=null;if(apf.flow.onaftermove&&isDragged){apf.flow.onaftermove(dy,dx);
isDragged=false;}};};}};apf.flow.canvas=function(htmlElement){if(!htmlElement.getAttribute("id")){apf.setUniqueHtmlId(htmlElement);
}this.id=htmlElement.getAttribute("id");this.htmlElement=htmlElement;this.htmlBlocks={};
this.htmlConnectors={};this.scrollPointer=null;this.lastTop=0;this.lastLeft=0;this.mode="normal";
this.disableremove=false;this.snap=false;this.gridW=48;this.gridH=48;this.initCanvas=function(){apf.flow.objCanvases[this.htmlElement.getAttribute("id")]=this;
};this.removeConnector=function(id){var c=this.htmlConnectors[id];c.htmlElement.parentNode.removeChild(c.htmlElement);
this.htmlConnectors[id]=c=null;delete this.htmlConnectors[id];};this.deselectConnections=function(){for(var id in this.htmlConnectors){var con=this.htmlConnectors[id];
if(con.selected){con.deselect("selected");con.deselectInputs("Selected");con.selected=false;
}}};this.setMode=function(mode){this.mode=mode;};this.getMode=function(){return this.mode;
};this.getWindowScrollLeft=function(){return document.documentElement.scrollLeft||document.body.scrollLeft;
};this.getWindowScrollTop=function(){return document.documentElement.scrollTop||document.body.scrollTop;
};this.scrollLeft=function(){this.htmlElement.scrollLeft=9999;};this.scrollTop=function(){this.htmlElement.scrollTop=9999;
};this.getScrollLeft=function(){return this.htmlElement.scrollLeft;};this.getScrollTop=function(){return this.htmlElement.scrollTop;
};this.addScrollPointer=function(){this.scrollPointer=this.htmlElement.appendChild(document.createElement("div"));
this.scrollPointer.className="scrollPointer";};this.moveLeftScrollPointer=function(left){var value=parseInt(left)+150;
this.scrollPointer.style.left=value+"px";this.lastLeft=parseInt(left);};this.moveTopScrollPointer=function(top){var value=parseInt(top)+150;
this.scrollPointer.style.top=value+"px";this.lastTop=parseInt(top);};this.getWidth=function(){return this.htmlElement.offsetWidth;
};this.getHeight=function(){return this.htmlElement.offsetHeight;};};apf.flow.block=function(htmlElement,objCanvas,other){this.canvas=objCanvas;
this.htmlElement=htmlElement;this.id=htmlElement.getAttribute("id");this.moveListeners=new Array();
this.draggable=true;this.htmlOutputs={};this.image=null;this.other=other;var _self=this;
this.destroy=function(){this.htmlElement.onmouseover=this.htmlElement.onmouseout=this.htmlElement.onclick=null;
for(var i=this.moveListeners.length-1;i>=0;i--){this.moveListeners[i].destroy();
this.moveListeners.removeIndex(i);}delete this.canvas.htmlBlocks[this.id];};this.initBlock=function(){this.canvas.htmlBlocks[this.id]=this;
var tag,dChilds,j,l2,bChilds=this.htmlElement.childNodes,i=0,l=bChilds.length;for(;
i<l;i++){tag=bChilds[i].tagName;if(tag&&(tag=tag.toLowerCase())){if(tag=="div"){dChilds=bChilds[i].childNodes;
for(j=0,l2=dChilds.length;j<l2;j++){if(dChilds[j].tagName&&dChilds[j].tagName.toLowerCase()=="img"){this.imageContainer=bChilds[i];
this.image=dChilds[j];}}}else{if(tag=="blockquote"){this.caption=bChilds[i];}}}}if(!this.other.type){apf.setStyleClass(this.htmlElement,"empty");
this.image.style.display="none";}else{if(this.other.picture==null){this.image.style.display="none";
}else{this.image.style.display="block";this.image.src=this.other.picture;this.image.onload=function(){_self.changeRotation(_self.other.rotation,_self.other.fliph,_self.other.flipv,true);
};}}this.other.ratio=this.other.dwidth/this.other.dheight;this.changeRotation(_self.other.rotation,_self.other.fliph,_self.other.flipv,true);
this.setCaption(this.other.caption);this.setLock(this.other.lock,true);this.updateOutputs();
};this.updateOutputs=function(){var id,input,pos,_x,_y,inp=this.other.inputList;
if(this.other.lock){return;}for(id in inp){input=this.htmlOutputs[id]?this.htmlOutputs[id]:new apf.flow.input(this,id);
if(!this.htmlOutputs[id]){this.htmlOutputs[id]=input;}pos=this.updateInputPos(inp[id]);
_x=pos[0]-(pos[2]=="left"||pos[2]=="right"?Math.ceil(parseInt(apf.getStyle(input.htmlElement,"width"))/2):Math.ceil(apf.flow.sSize/2));
_y=pos[1]-(pos[2]=="top"||pos[2]=="bottom"?Math.ceil(parseInt(apf.getStyle(input.htmlElement,"height"))/2):Math.ceil(apf.flow.sSize/2));
input.lastUpdate=pos;input.moveTo(_x,_y);}};this.outputsVisibility=function(visible){var inp=this.htmlOutputs;
for(var id in inp){var input=inp[id];if(visible){input.show();}else{input.hide();
}}};this.setLock=function(lock,init){if(this.other.lock!==lock||init){this.draggable=!lock;
this.other.lock=lock;this.outputsVisibility(!lock);if(lock){apf.setStyleClass(this.htmlElement,"locked");
}else{apf.setStyleClass(this.htmlElement,"",["locked"]);}}};this.setCaption=function(caption){var c=this.caption;
if(!c||c.nodeType!=1){return;}c.innerHTML=caption;if(this.other.capPos=="inside"){if(c.offsetWidth!==0&&c.offsetHeight!==0){c.style.marginLeft="-"+(Math.ceil(c.offsetWidth/2))+"px";
c.style.marginTop="-"+(Math.ceil(c.offsetHeight/2))+"px";}}};this.moveTo=function(top,left){var t=parseInt(this.htmlElement.style.top),l=parseInt(this.htmlElement.style.left);
if(t!==top||l!==left){this.htmlElement.style.top=top+"px";this.htmlElement.style.left=left+"px";
if(this.canvas.lastTop<top||top>this.canvas.getHeight()-100){this.canvas.moveTopScrollPointer(top);
this.canvas.scrollTop();}if(this.canvas.lastLeft<left&&left>this.canvas.getWidth()-100){this.canvas.moveLeftScrollPointer(left);
this.canvas.scrollLeft();}}};this.resize=function(width,height){var w=parseInt(this.htmlElement.style.width),h=parseInt(this.htmlElement.style.height);
if(w!==width||h!==height){this.htmlElement.style.width=this.imageContainer.style.width=width+"px";
this.htmlElement.style.height=this.imageContainer.style.height=height+"px";this.image.style.height=height+"px";
this.image.style.width=width+"px";this.image.style.filter="";}};this.changeRotation=function(rotation,fliph,flipv,init){var o=this.other,prev=[o.rotation,o.fliph,o.flipv];
if(!o.type){return;}o.rotation=parseInt(rotation)%360||0;o.fliph=String(fliph)=="true"?true:false;
o.flipv=String(flipv)=="true"?true:false;var flip=(o.fliph&&!o.flipv?"horizontal":(!o.fliph&&o.flipv?"vertical":"none"));
this.repaintImage(flip,o.rotation,"rel");};this.repaintImage=function(flip,angle,whence){var p=this.image;
if(p.style.display=="none"){return;}p.style.display="block";p.angle=!whence?((p.angle==undefined?0:p.angle)+angle)%360:angle;
var canvas,rotation=Math.PI*(p.angle>=0?p.angle:360+p.angle)/180,costheta=Math.cos(rotation),sintheta=Math.sin(rotation);
if(document.all&&!window.opera){canvas=document.createElement("img");canvas.src=p.src;
canvas.style.height=p.height+"px";canvas.style.width=p.width+"px";canvas.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+costheta+",M12="+(-sintheta)+",M21="+sintheta+",M22="+costheta+",SizingMethod='auto expand')";
if(flip!=="none"){canvas.style.filter+="progid:DXImageTransform.Microsoft.BasicImage("+(flip=="horizontal"?"mirror=1":"rotation=2, mirror=1")+")";
}}else{canvas=document.createElement("canvas");if(!p.oImage){canvas.oImage=new Image();
canvas.oImage.src=p.src;}else{canvas.oImage=p.oImage;}canvas.style.width=canvas.width=Math.abs(costheta*canvas.oImage.width)+Math.abs(sintheta*canvas.oImage.height);
canvas.style.height=canvas.height=Math.abs(costheta*canvas.oImage.height)+Math.abs(sintheta*canvas.oImage.width);
var context=canvas.getContext("2d");context.save();switch(flip){case"vertical":context.translate(0,canvas.oImage.height);
context.scale(1,-1);break;case"horizontal":context.translate(canvas.oImage.height,0);
context.scale(-1,1);break;}if(rotation<=Math.PI/2){context.translate(sintheta*canvas.oImage.height,0);
}else{if(rotation<=Math.PI){context.translate(canvas.width,-costheta*canvas.oImage.height);
}else{if(rotation<=1.5*Math.PI){context.translate(-costheta*canvas.oImage.width,canvas.height);
}else{context.translate(0,-sintheta*canvas.oImage.width);}}}context.rotate(rotation);
try{context.drawImage(canvas.oImage,0,0,canvas.oImage.width,canvas.oImage.height);
context.restore();}catch(e){}}canvas.angle=p.angle;this.imageContainer.replaceChild(canvas,p);
this.image=canvas;};this.onMove=function(){for(var i=0,ml=this.moveListeners,l=ml.length;
i<l;i++){ml[i].onMove();}};this.updateInputPos=function(input,dPos){var b=this.htmlElement,o=this.other,w=parseInt(b.style.width),h=parseInt(b.style.height),ior=input?input.position:"auto",x=input?input.x:w/2,y=input?input.y:h/2,dw=o.dwidth,dh=o.dheight,fv=o.flipv,fh=o.fliph,r=o.rotation,positions={0:"top",1:"right",2:"bottom",3:"left",top:0,right:1,bottom:2,left:3},sSize=apf.flow.sSize,hSize=Math.floor(apf.flow.sSize/2);
ior=(ior=="auto")?"auto":positions[(positions[ior]+parseInt(r)/90)%4];if(ior!=="auto"){if(fv){ior=ior=="top"?"bottom":(ior=="bottom"?"top":ior);
}if(fh){ior=ior=="left"?"right":(ior=="right"?"left":ior);}x=(r==90||r==270)?x*h/dh:x*w/dw;
y=(r==90||r==270)?y*w/dw:y*h/dh;var _x=x,_y=y;_x=(r==90)?w-y-1:(r==180?w-x-1:(r==270?y:x));
_y=(r==90)?x:(r==180?h-y-1:(r==270?h-x-1:y));_x=fh?w-_x:_x;_y=fv?h-_y:_y;_x=fh?(ior=="top"||ior=="bottom"?_x-1:_x):_x;
_y=fv?(ior=="left"||ior=="right"?_y-1:_y):_y;_x=ior=="top"||ior=="bottom"?_x-(sSize/2)+(apf.isIE||apf.isOpera||apf.isChrome?1:0):_x;
_y=ior=="left"||ior=="right"?_y-(sSize/2)+(apf.isIE||apf.isOpera||apf.isChrome?1:0):_y;
}else{var st=parseInt(b.style.top),sl=parseInt(b.style.left),dt=dPos[1],dl=dPos[0];
dw=dPos[2],dh=dPos[3];if(st+h*1.5<dt){ior="bottom";}else{if(st>dt+dh*1.5){ior="top";
}else{if(sl>dl+dw/2){ior="left";}else{if(sl<dl){ior="right";}else{ior="left";}}}}_x=(ior=="top"||ior=="bottom")?w/2-hSize:ior=="right"?w:0;
_y=(ior=="left"||ior=="right")?h/2-hSize:ior=="bottom"?h:0;}return[_x,_y,ior];};
this.htmlElement.onmouseup=function(e){if(!_self.other.type&&_self.canvas.mode=="connection-add"){apf.flow.connectionsManager.addBlock(_self,0);
}};};apf.flow.input=function(objBlock,number){this.objBlock=objBlock;this.htmlElement=objBlock.htmlElement.appendChild(document.createElement("div"));
this.number=number;this.lastUpdate=null;var _self=this;apf.setStyleClass(this.htmlElement,"input");
this.hide=function(){this.htmlElement.style.display="none";};this.show=function(){this.htmlElement.style.display="block";
};this.moveTo=function(x,y){this.htmlElement.style.left=x+"px";this.htmlElement.style.top=y+"px";
};var connection;var vMB;this.htmlElement.onmousedown=function(e){e=(e||event);
e.cancelBubble=true;apf.flow.isMoved=true;var canvas=_self.objBlock.canvas,pn=_self.htmlElement.parentNode,mode=canvas.mode;
if(e.preventDefault){e.preventDefault();}vMB=new apf.flow.virtualMouseBlock(canvas,e);
var con=apf.flow.findConnector(_self.objBlock,_self.number);if(con){var source=con.source?con.connector.objDestination:con.connector.objSource,destination=con.source?con.connector.objSource:con.connector.objDestination,sourceInput=con.source?con.connector.other.input:con.connector.other.output,destinationInput=con.source?con.connector.other.output:con.connector.other.input;
vMB.other.inputList[1].position=destination.updateInputPos(destination.other.inputList[destinationInput])[2];
_self.objBlock.onremoveconnection([con.connector.other.xmlNode]);apf.flow.removeConnector(con.connector.htmlElement);
connection=new apf.flow.addConnector(canvas,source,vMB,{output:sourceInput,input:1});
apf.flow.connectionsManager.addBlock(source,sourceInput);canvas.setMode("connection-change");
}else{connection=new apf.flow.addConnector(canvas,_self.objBlock,vMB,{output:_self.number});
apf.flow.connectionsManager.addBlock(_self.objBlock,_self.number);canvas.setMode("connection-add");
}connection.newConnector.virtualSegment=true;vMB.onMove(e);document.body.onmousemove=function(e){e=(e||event);
if(vMB){vMB.onMove(e);}};document.body.onmouseup=function(e){e=(e||event);var t=e.target||e.srcElement;
document.body.onmousemove=null;apf.flow.isMoved=false;if(t&&canvas.mode=="connection-change"){if((t.className||"").indexOf("input")==-1){apf.flow.connectionsManager.addBlock(destination,destinationInput);
}}apf.flow.connectionsManager.clear();if(connection){apf.flow.removeConnector(connection.newConnector.htmlElement);
}if(vMB){vMB.onMove(e);vMB.destroy();vMB=null;_self.objBlock.canvas.setMode("normal");
}};};this.htmlElement.onmouseup=function(e){apf.flow.connectionsManager.addBlock(_self.objBlock,_self.number);
};this.htmlElement.onmouseover=function(e){var mode=_self.objBlock.canvas.mode;
if(mode=="connection-add"||mode=="connection-change"){apf.setStyleClass(_self.htmlElement,"inputHover");
}};this.htmlElement.onmouseout=function(e){apf.setStyleClass(_self.htmlElement,"",["inputHover"]);
};};apf.flow.connectionsManager=new (function(){this.addBlock=function(objBlock,inputNumber){if(objBlock&&(inputNumber||inputNumber==0)){var s=apf.flow.connectionsTemp;
if(!s){apf.flow.connectionsTemp={objBlock:objBlock,inputNumber:inputNumber};}else{if(s.objBlock.id!==objBlock.id||s.inputNumber!==inputNumber){objBlock.oncreateconnection(s.objBlock.other.xmlNode,s.inputNumber,objBlock.other.xmlNode,inputNumber);
objBlock.canvas.setMode("normal");}this.clear();}}};this.clear=function(){apf.flow.connectionsTemp=null;
};})();apf.flow.virtualMouseBlock=function(canvas){var hook=[0,0,"virtual"];this.canvas=canvas;
this.htmlElement=document.createElement("div");this.canvas.htmlElement.appendChild(this.htmlElement);
this.htmlElement.style.display="block";this.moveListeners=new Array();this.draggable=0;
this.htmlOutputs={};this.htmlOutputs[1]={htmlElement:this.htmlElement.appendChild(document.createElement("div")),number:1,lastUpdate:hook};
this.other={};this.other.inputList={};this.other.inputList[1]={x:hook[0],y:hook[1],position:hook[2]};
apf.setStyleClass(this.htmlElement,"vMB");var sPos=apf.getAbsolutePosition(this.canvas.htmlElement);
this.onMove=function(e){this.htmlElement.style.left=(e.clientX+2+this.canvas.getWindowScrollLeft()+this.canvas.getScrollLeft()-sPos[0])+"px";
this.htmlElement.style.top=(e.clientY+2+this.canvas.getWindowScrollTop()+this.canvas.getScrollTop()-sPos[1])+"px";
for(var i=0,l=this.moveListeners.length;i<l;i++){this.moveListeners[i].onMove();
}};this.destroy=function(){this.htmlElement.parentNode.removeChild(this.htmlElement);
};this.updateInputPos=function(input){return hook;};};apf.flow.connector=function(htmlElement,objCanvas,objSource,objDestination,other){this.htmlSegments=[];
var htmlSegmentsTemp=[];this.htmlLabel=null;this.htmlStart=null;this.htmlEnd=null;
this.objSource=objSource;this.objDestination=objDestination;this.other=other;this.selected=false;
this.htmlElement=htmlElement;this.virtualSegment=null;var sSize=apf.flow.sSize,fsSize=apf.flow.fsSize,hSize=Math.floor(sSize/2),sourceHtml=this.objSource.htmlElement,destinationHtml=this.objDestination.htmlElement,_self=this;
this.initConnector=function(){if(!htmlElement.getAttribute("id")){apf.setUniqueHtmlId(htmlElement);
}objCanvas.htmlConnectors[htmlElement.getAttribute("id")]=this;this.objSource.moveListeners.push(this);
this.objDestination.moveListeners.push(this);this.activateInputs();this.onMove();
};this.activateInputs=function(){this.i1=other.output&&this.objSource.other.inputList[other.output]?this.objSource.other.inputList[other.output]:{x:0,y:0,position:"auto"};
this.i2=other.input&&this.objDestination.other.inputList[other.input]?this.objDestination.other.inputList[other.input]:{x:0,y:0,position:"auto"};
};this.destroy=function(){this.deselectInputs("Selected");var sl=this.objSource.moveListeners,i=0,l=sl.length;
for(;i<l;i++){if(sl[i]==this){this.objSource.moveListeners.removeIndex(i);}}var dl=this.objDestination.moveListeners;
for(i=0,l=dl.length;i<l;i++){if(dl[i]==this){this.objDestination.moveListeners.removeIndex(i);
}}objCanvas.removeConnector(this.htmlElement.getAttribute("id"));};this.onMove=function(){this.draw();
if(this.selected){this.deselectInputs("Hover");this.deselect("selected");this.deselectInputs("Selected");
this.selected=false;}};this.draw=function(){var sIPos,dIPos,l=[],s=[parseInt(sourceHtml.style.left),parseInt(sourceHtml.style.top),parseInt(sourceHtml.style.width),parseInt(sourceHtml.style.height)],d=[parseInt(destinationHtml.style.left),parseInt(destinationHtml.style.top),parseInt(destinationHtml.style.width),parseInt(destinationHtml.style.height)];
htmlSegmentsTemp=this.htmlSegments;this.htmlSegments=[];if(this.i1.position=="auto"||this.i2.position=="auto"){sIPos=this.objSource.updateInputPos(this.i1,d);
dIPos=this.objDestination.updateInputPos(this.i2,s);}else{sIPos=this.objSource.htmlOutputs[other.output].lastUpdate;
dIPos=this.objDestination.htmlOutputs[other.input].lastUpdate;}var sO=sIPos[2];
var dO=dIPos[2];s[0]+=sIPos[0];s[1]+=sIPos[1];d[0]+=dIPos[0];d[1]+=dIPos[1];if(sO!=="virtual"){s=this.createSegment(s,[fsSize,sO],true);
}if(dO!=="virtual"){d=this.createSegment(d,[fsSize,dO],true);}l=s;var position=s[0]>d[0]?(s[1]>d[1]?"TL":(s[1]<d[1]?"BL":"ML")):(s[0]<d[0]?(s[1]>d[1]?"TR":(s[1]<d[1]?"BR":"MR")):(s[1]>d[1]?"TM":(s[1]<d[1]?"MM":"BM"))),condition=position+(sO=="left"?1:(sO=="right"?2:sO=="top"?4:8))+(dO=="left"?1:(dO=="right"?2:dO=="top"?4:8));
switch(condition){case"TR41":l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);
l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.ceil(d[0]-s[0]),"right"]);break;
case"TR44":case"TR14":case"TR11":l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);
l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);break;
case"BR22":case"BR24":case"BR42":case"BR44":l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);
l=this.createSegment(l,[Math.ceil(Math.abs(d[1]-s[1])),"bottom"]);break;case"BR41":l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:(d[0]-s[0])/2,"right"]);
l=this.createSegment(l,[d[1]-s[1],"bottom"]);l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:Math.ceil((d[0]-s[0])/2),"right"]);
break;case"BR48":case"BR28":l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:(d[0]-s[0])/2,"right"]);
l=this.createSegment(l,[apf.isGecko?d[1]-s[1]:Math.ceil(d[1]-s[1]),"bottom"]);l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:(d[0]-s[0])/2,"right"]);
break;case"BR21":l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:(d[0]-s[0])/2,"right"]);
l=this.createSegment(l,[apf.isGecko?d[1]-s[1]:Math.ceil(d[1]-s[1]),"bottom"]);l=this.createSegment(l,[parseInt((d[0]-s[0])/2)+1,"right"]);
break;case"TL44":case"TL42":case"TL24":case"TL22":l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);
l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);break;
case"TR21":case"TR24":case"TR81":case"TR84":case"TR21":case"TR24":case"TR81":case"TR84":l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:(d[0]-s[0])/2,"right"]);
l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);l=this.createSegment(l,[apf.isGecko?(d[0]-s[0])/2:(d[0]-s[0])/2,"right"]);
break;case"BR18":case"BR88":case"BR81":case"BR11":l=this.createSegment(l,[d[1]-s[1],"bottom"]);
l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.ceil(d[0]-s[0]),"right"]);break;
case"BR14":l=this.createSegment(l,[apf.isGecko?(d[1]-s[1])/2:Math.ceil((d[1]-s[1])/2),"bottom"]);
l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);l=this.createSegment(l,[Math.ceil((d[1]-s[1])/2),"bottom"]);
break;case"BR84":case"BR82":case"BR12":l=this.createSegment(l,[apf.isGecko?(d[1]-s[1])/2:Math.ceil((d[1]-s[1])/2),"bottom"]);
l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);l=this.createSegment(l,[(d[1]-s[1])/2,"bottom"]);
break;case"BL84":case"BL24":case"BL21":l=this.createSegment(l,[apf.isGecko?(d[1]-s[1])/2:Math.ceil((d[1]-s[1])/2),"bottom"]);
l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);l=this.createSegment(l,[apf.isGecko?(d[1]-s[1])/2:Math.ceil((d[1]-s[1])/2),"bottom"]);
break;case"BL11":case"BL14":case"BL41":case"BL44":case"BL81":l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);
l=this.createSegment(l,[apf.isGecko?d[1]-s[1]:Math.ceil(d[1]-s[1]),"bottom"]);break;
case"BL12":case"BL18":case"BL42":case"BL48":l=this.createSegment(l,[apf.isGecko?(s[0]-d[0])/2:(s[0]-d[0])/2,"left"]);
l=this.createSegment(l,[apf.isGecko?d[1]-s[1]:Math.ceil(d[1]-s[1]),"bottom"]);l=this.createSegment(l,[apf.isGecko?(s[0]-d[0])/2:(s[0]-d[0])/2,"left"]);
break;case"BL88":case"BL82":case"BL28":case"BL22":l=this.createSegment(l,[apf.isGecko?d[1]-s[1]:Math.ceil(d[1]-s[1]),"bottom"]);
l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);break;
case"TL88":case"TL81":case"TL18":case"TL11":l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);
l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);break;
case"TL41":l=this.createSegment(l,[apf.isGecko?(s[1]-d[1])/2:Math.floor((s[1]-d[1])/2),"top"]);
l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);l=this.createSegment(l,[apf.isGecko?(s[1]-d[1])/2:Math.ceil((s[1]-d[1])/2),"top"]);
break;case"TL48":case"TL28":case"TL21":l=this.createSegment(l,[apf.isGecko?(s[1]-d[1])/2:Math.floor((s[1]-d[1])/2),"top"]);
l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);l=this.createSegment(l,[apf.isGecko?(s[1]-d[1])/2:Math.floor((s[1]-d[1])/2),"top"]);
break;case"TL12":case"TL14":case"TL82":case"TL84":l=this.createSegment(l,[apf.isGecko?(s[0]-d[0])/2:(s[0]-d[0])/2,"left"]);
l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);l=this.createSegment(l,[apf.isGecko?(s[0]-d[0])/2:(s[0]-d[0])/2,"left"]);
break;case"TR12":case"TR18":case"TR42":case"TR48":l=this.createSegment(l,[apf.isGecko?(s[1]-d[1])/2:Math.floor((s[1]-d[1])/2),"top"]);
l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);l=this.createSegment(l,[apf.isGecko?(s[1]-d[1])/2:Math.floor((s[1]-d[1])/2),"top"]);
break;case"TR22":case"TR28":case"TR82":case"TR88":l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);
l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);break;
default:switch(position){case"ML":l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);
break;case"MM":l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);
l=this.createSegment(l,[apf.isGecko?d[1]-s[1]:Math.ceil(d[1]-s[1]),"bottom"]);break;
case"TM":l=this.createSegment(l,[apf.isGecko?s[1]-d[1]:Math.ceil(s[1]-d[1]),"top"]);
l=this.createSegment(l,[apf.isGecko?s[0]-d[0]:Math.ceil(s[0]-d[0]),"left"]);break;
case"MR":l=this.createSegment(l,[apf.isGecko?d[0]-s[0]:Math.floor(d[0]-s[0]),"right"]);
if(condition.substring(2,4)=="41"){break;}l=this.createSegment(l,[Math.abs(d[1]-s[1]),"bottom"]);
break;}break;}for(var i=htmlSegmentsTemp.length-1;i>=0;i--){htmlSegmentsTemp[i][0].style.display="none";
}if(this.other.label){this.htmlLabel=apf.flow.label(this);}if(this.other.type){var _type=this.other.type.split("-");
if(_type[0]!=="none"){this.htmlStart=apf.flow.connectorsEnds(this,"start",_type[0]);
}if(_type[1]!=="none"){this.htmlEnd=apf.flow.connectorsEnds(this,"end",_type[1]);
}}};this.createSegment=function(coor,lines,startSeg){var or=lines[1],l=lines[0],sX=coor[0]||0,sY=coor[1]||0,_temp=htmlSegmentsTemp.shift(),_self=this,segment=_temp?_temp[0]:null,plane=(or=="top"||or=="bottom")?"ver":"hor";
if(!segment){segment=htmlElement.appendChild(document.createElement("div"));apf.setUniqueHtmlId(segment);
apf.setStyleClass(segment,"segment");if(_self.selected){_self.select("selected");
}var canvas=this.objSource.canvas;segment.onmouseover=function(e){if(!apf.flow.isMoved&&((canvas.mode=="connection-change"&&_self.selected)||canvas.mode=="connection-add")){_self.select("hover");
}};segment.onmouseout=function(e){_self.deselect("hover");};segment.onmousedown=function(e){e=e||event;
e.cancelBubble=true;_self.deselect("selected");_self.select("clicked");};segment.onmouseup=function(e){e=(e||event);
e.cancelBubble=true;var ctrlKey=e.ctrlKey,temp=_self.selected;if(!ctrlKey){_self.objSource.canvas.deselectConnections();
}_self.selected=temp?false:_self.selected?false:true;if(_self.selected){_self.selectInputs("Selected");
_self.deselect("clicked");_self.select("selected");canvas.setMode("connection-change");
}else{_self.deselectInputs("Selected");_self.deselect("clicked");_self.deselect("selected");
canvas.setMode("normal");}};}segment.plane=plane;var w=plane=="ver"?sSize:l,h=plane=="ver"?l:sSize,className="segment seg_"+plane;
if(_self.virtualSegment){className+=" seg_"+plane+"_virtual";}segment.className=className;
if(or=="top"){sY-=l;}if(or=="left"){sX-=l;}segment.style.display="block";segment.style.left=sX+(plane=="hor"&&!startSeg||(or=="left"&&startSeg)?3:0)+"px";
segment.style.top=sY+(plane=="ver"?3:0)+"px";segment.style.width=w+(or=="left"&&startSeg?-3:(or=="right"&&startSeg?3:0))+"px";
segment.style.height=h+"px";if(or=="bottom"){sY+=h;}if(or=="right"){sX+=w;}this.htmlSegments.push([segment,or]);
return[sX,sY];};this.deselect=function(type){var segments=this.htmlElement.childNodes,i=0,l=segments.length;
for(;i<l;i++){if((segments[i].className||"").indexOf("segment")!=-1){apf.setStyleClass(segments[i],"",["seg_"+segments[i].plane+"_"+type]);
}}if(!this.selected){this.deselectInputs("Selected");}if(this.htmlLabel&&type=="selected"){this.htmlLabel.className="label";
}};this.select=function(type){var segments=this.htmlElement.childNodes,i=0,l=segments.length;
for(;i<l;i++){if((segments[i].className||"").indexOf("segment")!=-1){apf.setStyleClass(segments[i],"seg_"+segments[i].plane+"_"+type);
}}this.selectInputs();if(this.htmlLabel&&type=="selected"){this.htmlLabel.className="label labelSelected";
}};this.selectInputs=function(type){if(this.other.output&&this.objSource.htmlOutputs[other.output]){var output=this.objSource.htmlOutputs[other.output].htmlElement;
apf.setStyleClass(output,"input"+type);}if(this.other.input&&this.objDestination.htmlOutputs[other.input]){var input=this.objDestination.htmlOutputs[other.input].htmlElement;
apf.setStyleClass(input,"input"+type);}};this.deselectInputs=function(type){if(this.other.output&&this.objSource.htmlOutputs[this.other.output]){var output=this.objSource.htmlOutputs[this.other.output].htmlElement;
apf.setStyleClass(output,"",["input"+type]);}if(this.other.input&&this.objDestination.htmlOutputs[this.other.input]){var input=this.objDestination.htmlOutputs[this.other.input].htmlElement;
apf.setStyleClass(input,"",["input"+type]);}};};apf.flow.connectorsEnds=function(connector,place,type){var conEnd=(place=="start")?connector.htmlStart:connector.htmlEnd,segment=connector.htmlSegments[place=="start"?0:1],l=parseInt(segment[0].style.left),t=parseInt(segment[0].style.top),htmlElement=conEnd?conEnd:connector.htmlElement.appendChild(document.createElement("div"));
t+=(segment[1]=="top")?parseInt(segment[0].style.height)-14:0;l+=(segment[1]=="left")?parseInt(segment[0].style.width)-11:(segment[1]=="right"?3:0);
htmlElement.style.left=l+"px";htmlElement.style.top=t+"px";htmlElement.className="connector-end "+type+" or"+segment[1];
return htmlElement;};apf.flow.label=function(connector,number){number=number||Math.ceil(connector.htmlSegments.length/2);
var htmlElement,segment=connector.htmlSegments[number],l=parseInt(segment[0].style.left),t=parseInt(segment[0].style.top);
if(connector.htmlLabel){htmlElement=connector.htmlLabel;}else{htmlElement=connector.htmlElement.appendChild(document.createElement("span"));
apf.setStyleClass(htmlElement,"label");}l+=segment[1]=="top"||segment[1]=="bottom"?segment[0].offsetWidth+3:(segment[0].offsetWidth-htmlElement.offsetWidth)/2;
t+=segment[1]=="top"||segment[1]=="bottom"?(segment[0].offsetHeight-htmlElement.offsetHeight)/2:segment[0].offsetHeight-2;
htmlElement.style.left=l+"px";htmlElement.style.top=t+"px";htmlElement.innerHTML=connector.other.label;
return htmlElement;};apf.flow.findBlock=function(blockId){var c=apf.flow.objCanvases;
for(var id in c){if(c[id].htmlBlocks[blockId]){return c[id].htmlBlocks[blockId];
}}};apf.flow.isBlock=function(htmlNode){if(!htmlNode){return;}var id,block,c=apf.flow.objCanvases;
for(id in c){block=c[id].htmlBlocks[htmlNode.getAttribute("id")];if(block){return block;
}}};apf.flow.isCanvas=function(htmlNode){if(htmlNode){return apf.flow.objCanvases[htmlNode.id];
}};apf.flow.findConnector=function(objBlock,iNumber,objBlock2,iNumber2){var id,id2,cobjS,cobjD,co,ci,connectors,c=apf.flow.objCanvases;
for(id in c){connectors=c[id].htmlConnectors;for(id2 in connectors){if(connectors[id2]){cobjS=connectors[id2].objSource,cobjD=connectors[id2].objDestination,co=connectors[id2].other.output,ci=connectors[id2].other.input;
if(objBlock2&&iNumber2){if(cobjS.id==objBlock.id&&co==iNumber&&cobjD.id==objBlock2.id&&ci==iNumber2){return{connector:connectors[id2],source:true};
}else{if(cobjD.id==objBlock.id&&ci==iNumber&&cobjS.id==objBlock2.id&&co==iNumber2){return{connector:connectors[id2],source:false};
}}}else{if(cobjS==objBlock&&co==iNumber){return{connector:connectors[id2],source:true};
}else{if(cobjD==objBlock&&ci==iNumber){return{connector:connectors[id2],source:false};
}}}}}}};apf.flow.isConnector=function(htmlNode){var c=apf.flow.objCanvases;for(var id in c){if(c[id].htmlConnectors[htmlNode.id]){return c[id].htmlConnectors[htmlNode.id];
}}};apf.flow.getCanvas=function(htmlNode){var newCanvas=apf.flow.isCanvas(htmlNode);
if(!newCanvas){newCanvas=new apf.flow.canvas(htmlNode);newCanvas.initCanvas();}return newCanvas;
};apf.flow.removeCanvas=function(htmlNode){var canvas=apf.flow.isCanvas(htmlNode);
canvas.destroy();};apf.flow.addBlock=function(htmlElement,objCanvas,other){if(htmlElement&&!apf.flow.isBlock(htmlElement)){if(!htmlElement.getAttribute("id")){apf.setUniqueHtmlId(htmlElement);
}var newBlock=new apf.flow.block(htmlElement,objCanvas,other);newBlock.initBlock();
return newBlock;}};apf.flow.removeBlock=function(htmlElement){var block=apf.flow.isBlock(htmlElement);
block.destroy();};apf.flow.addConnector=function(c,s,d,o){var htmlElement=c.htmlElement.appendChild(document.createElement("div"));
this.newConnector=new apf.flow.connector(htmlElement,c,s,d,o);this.newConnector.initConnector();
};apf.flow.removeConnector=function(htmlElement){var connector=apf.flow.isConnector(htmlElement);
if(connector){connector.destroy();}delete connector;};apf.geolocation=(function(){var bb_successCallback,bb_errorCallback,bb_blackberryTimeout_id=-1,pub={},provider=null,cache=null,UNDEF="undefined",UNAVAILABLE="Position unavailable";
function handleBlackBerryLocationTimeout(){if(bb_blackberryTimeout_id!=-1){bb_errorCallback({message:"Timeout error",code:3});
}}function handleBlackBerryLocation(){clearTimeout(bb_blackberryTimeout_id);bb_blackberryTimeout_id=-1;
if(bb_successCallback&&bb_errorCallback){if(blackberry.location.latitude==0&&blackberry.location.longitude==0){bb_errorCallback({message:UNAVAILABLE,code:2});
}else{var timestamp=null;if(blackberry.location.timestamp){timestamp=new Date(blackberry.location.timestamp);
}bb_successCallback({timestamp:timestamp,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}});
}bb_successCallback=bb_errorCallback=null;}}pub.getCurrentPosition=function(successCallback,errorCallback,options){provider.getCurrentPosition(successCallback,errorCallback,options);
};pub.init=function(){if(provider){return true;}try{if(typeof(geo_position_js_simulator)!=UNDEF){provider=geo_position_js_simulator;
}else{if(typeof bondi!=UNDEF&&typeof bondi.geolocation!=UNDEF){provider=bondi.geolocation;
}else{if(!!navigator.geolocation){provider=navigator.geolocation;pub.getCurrentPosition=function(successCallback,errorCallback,options){function _successCallback(p){if(typeof p.latitude!=UNDEF){successCallback({timestamp:p.timestamp,coords:{latitude:p.latitude,longitude:p.longitude}});
}else{successCallback(p);}}provider.getCurrentPosition(_successCallback,errorCallback,options);
if(provider.watchCurrentPosition){provider.watchCurrentPosition(_successCallback,errorCallback,options);
}};}else{if(typeof window.google!=UNDEF&&typeof google.gears!=UNDEF){provider=google.gears.factory.create("beta.geolocation");
}else{if(typeof Mojo!=UNDEF&&typeof Mojo.Service.Request!="Mojo.Service.Request"){provider=true;
pub.getCurrentPosition=function(successCallback,errorCallback,options){var parameters={};
if(options){if(options.enableHighAccuracy&&options.enableHighAccuracy==true){parameters.accuracy=1;
}if(options.maximumAge){parameters.maximumAge=options.maximumAge;}if(options.responseTime){if(options.responseTime<5){parameters.responseTime=1;
}else{if(options.responseTime<20){parameters.responseTime=2;}else{parameters.timeout=3;
}}}}new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:parameters,onSuccess:function(p){successCallback({timestamp:p.timestamp,coords:{latitude:p.latitude,longitude:p.longitude,heading:p.heading}});
},onFailure:function(e){if(e.errorCode==1){errorCallback({code:3,message:"Timeout"});
}else{if(e.errorCode==2){errorCallback({code:2,message:UNAVAILABLE});}else{errorCallback({code:0,message:"Unknown Error: webOS-code"+e.errorCode});
}}}});};}else{if(typeof device!=UNDEF&&typeof device.getServiceObject!=UNDEF){provider=device.getServiceObject("Service.Location","ILocation");
pub.getCurrentPosition=function(successCallback,errorCallback,options){function callback(transId,eventCode,result){if(eventCode==4){errorCallback({message:UNAVAILABLE,code:2});
}else{successCallback({timestamp:null,coords:{latitude:result.ReturnValue.Latitude,longitude:result.ReturnValue.Longitude,altitude:result.ReturnValue.Altitude,heading:result.ReturnValue.Heading}});
}}provider.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},callback);
};}else{if(typeof window.blackberry!=UNDEF&&blackberry.location.GPSSupported){if(typeof blackberry.location.setAidMode==UNDEF){return false;
}blackberry.location.setAidMode(2);pub.getCurrentPosition=function(successCallback,errorCallback,options){bb_successCallback=successCallback;
bb_errorCallback=errorCallback;bb_blackberryTimeout_id=setTimeout("handleBlackBerryLocationTimeout()",options.timeout||60000);
blackberry.location.onLocationUpdate("handleBlackBerryLocation()");blackberry.location.refreshLocation();
};provider=blackberry.location;}}}}}}}}catch(e){apf.console.error("GeoLocation error: "+e.toString());
provider="google";pub.getCurrentPosition=function(successCallback,errorCallback,options){if(cache){return successCallback(cache);
}apf.include((document.location.protocol=="https:"?"https:":"http:")+"//www.google.com/jsapi",false,null,null,function(){if(typeof google==UNDEF||typeof google.loader==UNDEF||typeof google.loader.ClientLocation==UNDEF){return errorCallback({message:UNAVAILABLE});
}successCallback(cache={timestamp:null,coords:{latitude:google.loader.ClientLocation.latitude,longitude:google.loader.ClientLocation.longitude,address:google.loader.ClientLocation.address}});
});};}return provider!=null;};return pub;})();apf.htmlCleaner=(function(){var prepareRE=null,exportRE=null,noMarginTags={table:1,TABLE:1},selfClosing={br:1,img:1,input:1,hr:1};
return{prepare:function(html,bNoEnclosing){if(!prepareRE){prepareRE=[/<(\/?)strong>|<strong( [^>]+)>/gi,/<(\/?)em>|<em( [^>]+)>/gi,/&apos;/g,/(<(\/?)(span|strong|em|u|i|b|a|strike|sup|sub|font|img)(?:\s+[\s\S]*?)?>)|(<br[\s\S]*?>)|(<(\/?)([\w\-]+)(?:\s+[\s\S]*?)?>)|([^<>]*)/gi,/(<a[^>]*href=)([^\s^>]+)*([^>]*>)/gi,/<p><\/p>/gi,/<a( )([^>]+)\/>|<a\/>/gi];
}if(apf.isGecko){html=html.replace(prepareRE[0],"<$1b$2>").replace(prepareRE[1],"<$1i$2>");
}else{if(apf.isIE){html=html.replace(prepareRE[2],"&#39;").replace(prepareRE[4],"$1$2 _apf_href=$2$3");
var str=[],capture=false,strP=[],depth=[],bdepth=[],lastBlockClosed=false;html.replace(prepareRE[3],function(m,inline,close,tag,br,block,bclose,btag,any){if(inline){var id=strP.push(inline);
tag=tag.toLowerCase();if(!selfClosing[tag]){if(close){if(!depth[depth.length-1]||depth[depth.length-1][0]!=tag){strP.length--;
}else{depth.length--;}}else{depth.push([tag,id]);}}capture=true;}else{if(any){strP.push(any);
capture=true;}else{if(br){if(capture){if(depth.length){strP.push(br);}else{str.push("<p>",strP.join(""),"</p>");
strP=[];}if(!depth.length){capture=false;}}else{if((bdepth.length||lastBlockClosed)&&br.indexOf("_apf_marker")>-1){}else{str.push("<p>&nbsp;</p>");
}}}else{if(block){if(bclose){if(bdepth[bdepth.length-1]!=btag.toLowerCase()){return;
}else{bdepth.length--;}if(strP.length){str.push(strP.join(""));strP=[];}lastBlockClosed=2;
}else{var useStrP=strP.length&&strP.join("").trim();var last=useStrP?strP:str;if(!noMarginTags[btag]){if(last[last.length-1]=="<p>&nbsp;</p>"){last[last.length-1]="";
}else{if(useStrP&&!bdepth.length){last.push("<p></p>");}}}if(strP.length){if(!useStrP||bdepth.length){str.push(strP.join(""));
strP=[];}else{str.push("<p>",strP.join(""),"</p>");strP=[];}}bdepth.push(btag.toLowerCase());
}str.push(block);capture=false;}}}}lastBlockClosed=lastBlockClosed==2?1:false;});
var s;if((s=strP.join("")).trim()){str.push(bNoEnclosing?s:"<p>"+s+"</p>");}html=str.join("");
}}html=(apf.xmlentities?apf.xmlentities(html):html).replace(prepareRE[6],"<a$1$2></a>");
return html;},parse:function(html,noEntities,noParagraph){if(!exportRE){exportRE=[/<br[^>]*><\/li>/gi,/<br[^>]*_apf_placeholder="1"\/?>/gi,/<(a|span|div|h1|h2|h3|h4|h5|h6|pre|address)>[\s\n\r\t]*<\/(a|span|div|h1|h2|h3|h4|h5|h6|pre|address)>/gi,/<(tr|td)>[\s\n\r\t]*<\/(tr|td)>/gi,/[\s]*_apf_href="?[^\s^>]+"?/gi,/(".*?"|'.*?')|(\w)=([^'"\s>]+)/gi,/<((?:br|input|hr|img)(?:[^>]*[^\/]|))>/ig,/<p>&nbsp;$/mig,/(<br[^>]*?>(?:[\r\n\s]|&nbsp;)*<br[^>]*?>)|(<(\/?)(span|strong|em|u|i|b|a|br|strike|sup|sub|font|img)(?:\s+.*?)?>)|(<(\/?)([\w\-]+)(?:\s+.*?)?>)|([^<>]*)/gi,/<\/p>/gi,/<p>/gi,/<\s*\/?\s*(?:\w+:\s*)?[\w-]*[\s>\/]/g];
}if(apf.isIE){html=html.replace(exportRE[7],"<p></p>").replace(exportRE[9],"<br />").replace(exportRE[10],"");
}else{if(html=="<br>"){html="";}}html=(!noEntities&&apf.xmlentities?apf.xmlentities(html):html).replace(exportRE[0],"</li>").replace(exportRE[1],"").replace(exportRE[2],"").replace(exportRE[3],"<$1>&nbsp;</$2>").replace(exportRE[4],"").replace(exportRE[6],"<$1 />").replace(exportRE[11],function(m){return m.toLowerCase();
});if(apf.isIE&&!noParagraph){var str=[],capture=true,strP=[],depth=[],bdepth=[];
html.replace(exportRE[8],function(m,br,inline,close,tag,block,bclose,btag,any){if(inline){if(apf.isIE){inline=inline.replace(exportRE[5],function(m1,str,m2,v){return str||m2+'="'+v+'"';
});}var id=strP.push(inline);if(!selfClosing[tag]){if(close){if(!depth[depth.length-1]||depth[depth.length-1][0]!=tag){strP.length--;
}else{depth.length--;}}else{depth.push([tag,id]);}}capture=true;}else{if(any){strP.push(any);
capture=true;}else{if(br){if(capture){if(depth.length){strP.push(br);}else{str.push("<p>",strP.join("").trim()||"&nbsp;","</p>");
strP=[];capture=false;}}else{str.push("<p>&nbsp;</p>");}}else{if(block){if(bclose){if(bdepth[bdepth.length-1]!=btag){return;
}else{bdepth.length--;}if(strP.length){str.push(strP.join(""));strP=[];}}else{if(apf.isIE){block=block.replace(exportRE[5],function(m1,str,m2,v){return str||m2+'="'+v+'"';
});}var last=strP.length?strP:str;if(last[last.length-1]=="<p>&nbsp;</p>"){last.length--;
}if(strP.length){var s;if(bdepth.length||(s=strP.join("").trim()).replace(/<.*?>/g,"").trim()==""){str.push(s||strP.join(""));
strP=[];}else{str.push("<p>",(s||strP.join("").trim()||"&nbsp;").replace(/<br \/>[\s\r\n]*$/,""),"</p>");
strP=[];}}bdepth.push(btag);}str.push(block);capture=false;}}}}});if(strP.length){str.push("<p>"+strP.join("").replace(/<br \/>[\s\r\n]*$/,"")+"</p>");
}html=str.join("");}else{html=html.replace(/<br[^>]*_apf_marker="1"[^>]*>/gi,"<br />");
}try{apf.getXml("<source>"+html.replace(/&.{3,5};/g,"")+"</source>");}catch(ex){apf.console.error(ex.message+"\n"+html.escapeHTML());
}return html;}};})();apf.language={automatch:false,loaded:false,prefix:"sub.main.",words:{},texts:{},elements:{},bindings:{},count:0,load:function(xmlNode,prefix){if(!xmlNode){return;
}if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){xmlNode=apf.getXmlDom(xmlNode).documentElement;
}else{return this.loadFrom(xmlNode);}}this.parseSection(xmlNode,prefix);this.redraw();
this.loaded=true;},loadFrom:function(instruction){apf.getData(instruction,{callback:function(xmlNode){if(!xmlNode){return;
}if(!xmlNode){throw new Error(apf.formatErrorString(0,null,"Loading language","Could not find language symbols using processing                      instruction: '"+instruction+"'"));
return;}apf.language.load(xmlNode);}});},parseSection:function(xmlNode,prefix){if(!prefix){prefix=xmlNode.getAttribute("id")||"";
}if(xmlNode.tagName=="key"){prefix+="/"+xmlNode.getAttribute("id");this.words[prefix]=xmlNode.firstChild?xmlNode.firstChild.nodeValue:"";
return;}if(xmlNode.tagName=="group"){prefix+=(prefix?"/":"")+xmlNode.getAttribute("id");
}var nodes=xmlNode.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType==1){this.parseSection(nodes[i],prefix);
}}},redraw:function(){var id,fParsed,prop,props,els=this.elements,amlNode;for(id in els){props=els[id],amlNode=apf.all[id];
for(prop in props){fParsed=props[prop];try{if(fParsed.asyncs){return fParsed.call(this,amlNode.xmlRoot,function(value){amlNode.setProperty(prop,value,true);
});}else{var value=fParsed.call(amlNode,amlNode.xmlRoot);}}catch(e){apf.console.warn("[275] Could not execute language update for "+prop+"\n\n"+e.message);
continue;}amlNode.setProperty(prop,value,true);}}var sel,amlNode,bds=this.bindings;
for(id in bds){amlNode=apf.all[id];if(amlNode.selection){sel=amlNode.getSelection();
amlNode.reload();amlNode.selectList(sel);}else{amlNode.reload();}}},getWord:function(symbol){return this.words[symbol];
},addProperty:function(amlNode,prop,func){(this.elements[amlNode.$uniqueId]||(this.elements[amlNode.$uniqueId]={}))[prop]=func;
},removeProperty:function(amlNode,prop){delete (this.elements[amlNode.$uniqueId]||false)[prop];
},addBinding:function(amlNode){this.bindings[amlNode.$uniqueId]=true;},removeBinding:function(amlNode){delete this.bindings[amlNode.$uniqueId];
}};apf.layout={compile:function(oHtml){var l=this.layouts[oHtml.getAttribute("id")];
if(!l){return false;}var root=l.root.copy();l.layout.compile(root);l.layout.reset();
},removeAll:function(aData){aData.children.length=null;var htmlId=this.getHtmlId(aData.pHtml);
if(!this.rules[htmlId]){delete this.qlist[htmlId];}},timer:null,qlist:{},dlist:[],$hasQueue:false,queue:function(oHtml,obj,compile,q){if(!q){this.$hasQueue=true;
q=this.qlist;}var id;if(!(id=this.getHtmlId(oHtml))){id=apf.setUniqueHtmlId(oHtml);
}if(q[id]){if(obj){q[id][2].push(obj);}if(compile){q[id][1]=compile;}return;}q[id]=[oHtml,compile,[obj]];
if(!this.timer){this.timer=apf.setZeroTimeout(function(){apf.layout.processQueue();
});}},processQueue:function(){var i,id,l,qItem,list;for(i=0;i<this.dlist.length;
i++){if(this.dlist[i].hidden){this.dlist[i].hide();}else{this.dlist[i].show();}}do{var newq={};
var qlist=this.qlist;this.qlist={};this.$hasQueue=false;for(id in qlist){qItem=qlist[id];
if(qItem[1]){apf.layout.compileAlignment(qItem[1]);}list=qItem[2];for(i=0,l=list.length;
i<l;i++){if(list[i]){if(list[i].$amlDestroyed){continue;}list[i].$updateLayout();
}}apf.layout.activateRules(qItem[0]);}}while(this.$hasQueue);if(apf.hasSingleRszEvent){apf.layout.forceResize();
}this.dlist=[];clearTimeout(this.timer);this.timer=null;},rules:{},onresize:{},getHtmlId:function(oHtml){return oHtml.getAttribute?oHtml.getAttribute("id"):1;
},setRules:function(oHtml,id,rules,overwrite){if(!this.getHtmlId(oHtml)){apf.setUniqueHtmlId(oHtml);
}if(!this.rules[this.getHtmlId(oHtml)]){this.rules[this.getHtmlId(oHtml)]={};}var ruleset=this.rules[this.getHtmlId(oHtml)][id];
if(!overwrite&&ruleset){this.rules[this.getHtmlId(oHtml)][id]=rules+"\n"+ruleset;
}else{this.rules[this.getHtmlId(oHtml)][id]=rules;}},getRules:function(oHtml,id){return id?this.rules[this.getHtmlId(oHtml)][id]:this.rules[this.getHtmlId(oHtml)];
},removeRule:function(oHtml,id){var htmlId=this.getHtmlId(oHtml);if(!this.rules[htmlId]){return;
}var ret=this.rules[htmlId][id]||false;delete this.rules[htmlId][id];var prop;for(prop in this.rules[htmlId]){}if(!prop){delete this.rules[htmlId];
}if(apf.hasSingleRszEvent){if(this.onresize[htmlId]){this.onresize[htmlId]=null;
}else{var p=oHtml.parentNode;while(p&&p.nodeType==1&&!this.onresize[p.getAttribute("id")]){p=p.parentNode;
}if(p&&p.nodeType==1){var x=this.onresize[p.getAttribute("id")];if(x.children){delete x.children[htmlId];
}}}}return ret;},activateRules:function(oHtml,no_exec){if(!oHtml){var prop,obj;
for(prop in this.rules){obj=document.getElementById(prop);if(!obj||obj.onresize){continue;
}this.activateRules(obj);}if(apf.hasSingleRszEvent&&window.onresize){window.onresize();
}return;}var rsz,id,rule,rules,strRules=[];if(!apf.hasSingleRszEvent){rules=this.rules[this.getHtmlId(oHtml)];
if(!rules){oHtml.onresize=null;return false;}for(id in rules){if(typeof rules[id]!="string"){continue;
}strRules.push(rules[id]);}rsz=apf.needsCssPx?new Function(strRules.join("\n")):new Function(strRules.join("\n").replace(/ \+ 'px'|try\{\}catch\(e\)\{\}\n/g,""));
oHtml.onresize=rsz;if(!no_exec){rsz();}}else{var htmlId=this.getHtmlId(oHtml);rules=this.rules[htmlId];
if(!rules){return false;}for(id in rules){if(typeof rules[id]!="string"){continue;
}strRules.push(rules[id]);}var p=oHtml.parentNode;while(p&&p.nodeType==1&&!this.onresize[p.getAttribute("id")]){p=p.parentNode;
}var f=new Function(strRules.join("\n"));if(this.onresize[htmlId]){f.children=this.onresize[htmlId].children;
}if(p&&p.nodeType==1){var x=this.onresize[p.getAttribute("id")];this.onresize[htmlId]=(x.children||(x.children={}))[htmlId]=f;
}else{this.onresize[htmlId]=f;}if(!no_exec){f();}if(!window.onresize){var rsz=function(f){try{var c=[];
for(var name in f){if(f[name]){c.unshift(f[name]);}}for(var i=0;i<c.length;i++){c[i]();
if(c[i].children){rsz(c[i].children);}}}catch(e){}};window.onresize=function(){rsz(apf.layout.onresize);
};}}},forceResize:function(oHtml){if(apf.hasSingleRszEvent){return window.onresize&&window.onresize();
}var rsz=oHtml.onresize;if(rsz){rsz();}var els=oHtml.getElementsByTagName("*");
for(var i=0,l=els.length;i<l;i++){if(els[i]&&els[i].onresize){els[i].onresize();
}}},paused:{},pause:function(oHtml,replaceFunc){if(apf.hasSingleRszEvent){var htmlId=this.getHtmlId(oHtml);
this.paused[htmlId]=this.onresize[htmlId]||true;if(replaceFunc){this.onresize[htmlId]=replaceFunc;
this.onresize[htmlId].children=this.paused[htmlId].children;replaceFunc();}else{delete this.onresize[htmlId];
}}else{this.paused[this.getHtmlId(oHtml)]=oHtml.onresize||true;if(replaceFunc){oHtml.onresize=replaceFunc;
replaceFunc();}else{oHtml.onresize=null;}}},play:function(oHtml){if(!this.paused[this.getHtmlId(oHtml)]){return;
}if(apf.hasSingleRszEvent){var htmlId=this.getHtmlId(oHtml);var oldFunc=this.paused[htmlId];
if(typeof oldFunc=="function"){this.onresize[htmlId]=oldFunc;}else{delete this.onresize[htmlId];
}if(window.onresize){window.onresize();}this.paused[this.getHtmlId(oHtml)]=null;
}else{var oldFunc=this.paused[this.getHtmlId(oHtml)];if(typeof oldFunc=="function"){oHtml.onresize=oldFunc;
oldFunc();}else{oHtml.onresize=null;}this.paused[this.getHtmlId(oHtml)]=null;}}};
apf.getWindowWidth=function(){return apf.isIE?document.documentElement.offsetWidth-apf.windowHorBorder:window.innerWidth;
};apf.getWindowHeight=function(){return apf.isIE?document.documentElement.offsetHeight-apf.windowVerBorder:window.innerHeight;
};apf.printer={tagName:"printer",nodeFunc:apf.NODE_HIDDEN,lastContent:"",inited:false,panel:null,init:function(aml){if(this.inited){return this;
}this.inited=true;this.$aml=aml;this.panel=document.body.appendChild(document.createElement("div"));
this.panel.setAttribute("id","print_content");this.panel.onmousedown=function(){apf.printer.hide();
};with(this.panel.style){position="absolute";top="0";left="0";width="100%";height="100%";
backgroundColor="white";}apf.window.zManager.set("print",this.panel);apf.importCssString("#print_content{display:none}");
apf.importCssString(apf.hasCSSChildOfSelector&&!apf.isIE?"body #print_content{display:block} body>*{display:none}":"body #print_content, body #print_content *{display:block} body *{display:none}",document,"print");
if(aml){var a,i,attr=aml.attributes;for(i=0;i<attr.length;i++){a=attr[i];if(a.nodeName.indexOf("on")==0){apf.addEventListener(a.nodeName,apf.lm.compile(a.nodeValue,{event:true,parsecode:true}));
}}}function printPNGFix(disable){if(apf.supportPng24){return;}if(!apf.config.iePngFix){return;
}for(var e,i=0,j=document.all.length;i<j;i++){e=document.all[i];if(e.filters["DXImageTransform.Microsoft.AlphaImageLoader"]||e._png_print){if(disable){e._png_print=e.style.filter;
e.style.filter="";}else{e.style.filter=e._png_print;e._png_print="";}}}}window.onbeforeprint=function(){printPNGFix(true);
apf.dispatchEvent("beforeprint");};window.onafterprint=function(){printPNGFix(false);
apf.dispatchEvent("afterprint");};return this;},preview:function(strHtml,show){this.init();
if(typeof strHtml!="string"){strHtml=strHtml.outerHTML||strHtml.xml||strHtml.serialize();
}this.lastContent=strHtml;this.panel.innerHTML=strHtml;if(show){this.show();}return this;
},show:function(){if(!this.inited){return this;}this.panel.style.display="block";
return this;},hide:function(){if(!this.inited){return this;}this.panel.style.display="none";
this.panel.style.height=document.body.scrollHeight+"px";this.panel.style.width=document.body.scrollWidth+"px";
return this;}};apf.print=function(strHtml){apf.printer.init().preview(strHtml);
window.print();};apf.setZeroTimeout=(apf.isIE&&apf.isIE<9)||apf.isO3||apf.isAIR?setTimeout:(function(){var timeouts=[];
var messageName="zero-timeout-message";function setZeroTimeout(fn){timeouts.push(fn);
window.postMessage(messageName,"*");}function handleMessage(e){if(!e){e=event;}if(e.source==window&&e.data==messageName){apf.stopPropagation(e);
if(timeouts.length>0){var fn=timeouts.shift();fn();}}}apf.addListener(window,"message",handleMessage,true);
return setZeroTimeout;})();apf.queue={q:{},timer:null,add:function(id,f){this.q[id]=f;
if(!this.timer){this.timer=apf.setZeroTimeout(function(){apf.queue.empty();});}},remove:function(id){delete this.q[id];
},empty:function(prop){clearTimeout(this.timer);this.timer=null;if(apf.layout&&apf.layout.$hasQueue){apf.layout.processQueue();
}if(apf.xmldb&&apf.xmldb.$hasQueue){apf.xmldb.notifyQueued();}var q=this.q;this.q={};
for(var prop in q){var f=q[prop];if(f){delete q[prop];f();}}}};apf.resize=function(){this.scales={scalex:false,scaley:false,scaleratio:false,dwidth:0,dheight:0,snap:false,gridW:48,gridH:48};
this.htmlElement;var squares=[];this.init=function(){squares=[new apf.resize.square("top","left",this),new apf.resize.square("top","middle",this),new apf.resize.square("top","right",this),new apf.resize.square("middle","left",this),new apf.resize.square("middle","right",this),new apf.resize.square("bottom","left",this),new apf.resize.square("bottom","middle",this),new apf.resize.square("bottom","right",this)];
};this.grab=function(oHtml,scales){this.htmlElement=oHtml;this.scales=scales;if(!squares.length){this.init();
}this.show();};this.hide=function(){for(var i=0,l=squares.length;i<l;i++){squares[i].visible=false;
squares[i].repaint();}};this.show=function(){var sx=this.scales.scalex;var sy=this.scales.scaley;
var sr=this.scales.scaleratio;for(var i=0,l=squares.length,s;i<l;i++){s=squares[i];
s.visible=sx&&sy?true:(sy&&!sx?(s.posX=="middle"?true:false):(sx&&!sy?(s.posY=="middle"?true:false):(sr?((s.posY=="top"||s.posY=="bottom")&&s.posX!=="middle"?true:false):false)));
s.repaint();}};this.destroy=function(){for(var i=0;i<squares.length;i++){squares[i].destroy();
}};};apf.resize.square=function(posY,posX,objResize){this.visible=true;this.posX=posX;
this.posY=posY;var margin=0;var _self=this;this.htmlElement=objResize.htmlElement.parentNode.appendChild(document.createElement("div"));
apf.setStyleClass(this.htmlElement,"square");this.repaint=function(){if(this.visible){var block=objResize.htmlElement;
this.htmlElement.style.display="block";var bw=parseInt(block.style.width)+apf.getDiff(block)[0];
var bh=parseInt(block.style.height)+apf.getDiff(block)[1];var bt=parseInt(block.style.top);
var bl=parseInt(block.style.left);var sw=this.htmlElement.offsetWidth;var sh=this.htmlElement.offsetHeight;
var t=posY=="top"?bt-margin-sh:posY=="middle"?bt+bh/2-sh/2:bt+bh+margin;var l=posX=="left"?bl-margin-sw:posX=="middle"?bl+bw/2-sw/2:bl+bw+margin;
var c=(posY=="middle"?"w-resize":(posX=="middle"?"n-resize":(posY+posX=="topleft"||posY+posX=="bottomright")?"nw-resize":"ne-resize"));
this.htmlElement.style.top=(t-1)+"px";this.htmlElement.style.left=(l-1)+"px";this.htmlElement.style.cursor=c;
}else{var sw=this.htmlElement.offsetWidth;this.htmlElement.style.display="none";
}};this.destroy=function(){apf.destroyHtmlNode(this.htmlElement);};this.htmlElement.onmouseover=function(e){apf.setStyleClass(_self.htmlElement,"squareHover");
};this.htmlElement.onmouseout=function(e){apf.setStyleClass(_self.htmlElement,"",["squareHover"]);
};this.htmlElement.onmousedown=function(e){e=(e||event);var block=objResize.htmlElement,sx=e.clientX,sy=e.clientY,pt=block.parentNode.offsetTop,pl=block.parentNode.offsetLeft,dw=objResize.scales.dwidth,dh=objResize.scales.dheight,snap=objResize.scales.snap,gridH=objResize.scales.gridH,gridW=objResize.scales.gridW,objBlock=apf.flow.isBlock(block),r=objBlock.other.ratio,posX=_self.posX,posY=_self.posY,width,height,top,left,dx,dy,prev_w,prev_h,l=parseInt(block.style.left),t=parseInt(block.style.top),w=parseInt(block.style.width),h=parseInt(block.style.height),resized=false;
objResize.onresizedone(w,h,t,l);if(e.preventDefault){e.preventDefault();}document.onmousemove=function(e){e=(e||event);
dx=e.clientX-sx;dy=e.clientY-sy;var shiftKey=e.shiftKey,proportion=r;if(shiftKey){if(posX=="right"&&posY=="bottom"){width=w+dx;
height=width/proportion;left=l;top=t;}else{if(posX=="right"&&posY=="top"){width=w+dx;
height=width/proportion;left=l;top=t-dx/proportion;}else{if(posX=="left"&&posY=="bottom"){width=w-dx;
height=width/proportion;left=l+dx;top=t;}else{if(posX=="left"&&posY=="top"){width=w-dx;
height=width/proportion;left=l+dx;top=t+dx/proportion;}}}}if(width>=dw&&height>=dh){width=prev_w=Math.max(dw,width);
height=prev_h=Math.max(dh,height);}else{width=prev_w;height=prev_h;return false;
}}else{width=posX=="right"?w+dx:(posX=="left"?w-dx:w);height=posY=="bottom"?h+dy:(posY=="top"?h-dy:h);
left=posX=="right"?l:(posX=="left"?Math.min(l+w-dw,l+dx):l);top=posY=="bottom"?t:(posY=="top"?Math.min(t+h-dh,t+dy):t);
width=Math.max(dw,width);height=Math.max(dh,height);}if(snap){left=Math.floor(left/gridW)*gridW;
top=Math.floor(top/gridH)*gridH;width=Math.ceil(width/gridW)*gridW;height=Math.ceil(height/gridH)*gridH;
}if(objResize.onresize){objResize.onresize(block,top,left,width,height);}objResize.show();
resized=true;};document.onmouseup=function(e){document.onmousemove=null;if(objResize.onresizedone&&resized){objResize.onresizedone(width,height,top,left);
objBlock.other.ratio=width/height;resized=false;}};};};apf.selection=function(oWin,oDoc,editor){oWin=oWin||window;
oDoc=oDoc||window.document;this.current=null;var FUNC="function",UNDEF="undefined",CHAR="character",TEXT="Text",CTRL="Control",NONE="None",csLock,vfocus=(editor&&typeof editor.$visualFocus==FUNC),_self=this;
this.get=function(){return apf.w3cRange?oWin.getSelection():oDoc.selection;};this.set=function(){if(!this.current){return null;
}if(apf.w3cRange){this.moveToBookmark(this.current);return this.current;}try{if(vfocus){editor.$visualFocus();
}else{oWin.focus();}this.current.select();}catch(ex){}if(vfocus){editor.$visualFocus();
}else{oWin.focus();}return this.current;};this.cache=function(w3cToo){if(apf.w3cRange){if(w3cToo){this.current=this.getBookmark();
}return this;}var oSel=oDoc.selection;this.current=oSel.createRange();this.current.type=oSel.type;
if(this.current.type==TEXT&&this.current.text==""&&!csLock){csLock=$setTimeout(this.cache,0);
}else{clearTimeout(csLock);csLock=null;}return this;};this.getRange=function(){var oSel=this.get(),range;
try{if(oSel){range=oSel.rangeCount>0?oSel.getRangeAt(0):(oSel.createRange?oSel.createRange():oDoc.createRange());
}}catch(ex){}if(!range){range=apf.w3cRange?oDoc.createRange():oDoc.body.createTextRange();
}return range;};this.setRange=function(range){if(apf.w3cRange){var oSel=this.get();
if(oSel){oSel.removeAllRanges();oSel.addRange(range);}}else{try{range.select();
}catch(ex){}}return this;};var activeEl,_inline="BR|IMG|HR|INPUT",_block="P|BUTTON|TEXTAREA|SELECT|DIV|H[1-6]|ADDRESS|PRE|OL|UL|LI|TABLE|TBODY|TR|DT|DE|TD|SUB|SUP",_form="SELECT|BUTTON|TEXTAREA",reBlock=new RegExp("^(?:"+_block+")$","i"),reForm=new RegExp("^(?:"+_form+")$","i"),reInline=new RegExp("^(?:"+_inline+")$","i");
this.inline=_inline;this.block=_block;this.form=_form;function trimNl(str){return(apf.isOpera||apf.isIE)?str:str.replace(/\r\n/g," ");
}function getText(node){return String(apf.isIE?node.nodeType==3?node.nodeValue:node.innerText:node.textContent);
}function getHtml(node){return String(node.nodeType==3?apf.isIE?node.nodeValue:node.textContent:node.innerHTML);
}function textContent(node,o){var cn,sp=0,str="",i=0,l=node.childNodes.length;for(;
i<l;i++){cn=node.childNodes[i];if(reForm.test(cn.nodeName)){str+="<->"+(apf.isIE?"":trimNl(getText(cn)).replace(/./gi," "))+"</->";
}else{if(reBlock.test(cn.nodeName)){str+="<+>"+(apf.isIE?"":trimNl(getText(cn)).replace(/./gi," "))+"</+>";
}else{if(reInline.test(cn.nodeName)){str+="<>";}else{if(cn.nodeName=="SPAN"&&(sp=_4.attr(cn,"scaytid"))){str+="<"+sp+">"+trimNl(getHtml(cn))+"</>";
}else{str+=trimNl(getHtml(cn));}}}}}return str;}function getParent(node,eltype,attr,root){var k;
root=root||this.containerNode;eltype=eltype?new RegExp("^(?:"+eltype+")$"):null;
while(node&&node!=root){if(eltype&&eltype.test(node.nodeName.toUpperCase())){return node;
}if(attr){for(k in attr){if(node.getAttribute(k)!==null&&attr[k]===null){return node;
}if((attr[k]!==null&&node.getAttribute(k)!==null&&!(node.getAttribute(k)===false))?!attr[k]:attr[k]){return node;
}}}node=node.parentNode;}return false;}this.getBookmark=function(type,callback){var ch=-16777215,range=this.getRange(),vp=apf.getViewPort(oWin),c=oDoc.body,o={scrollX:vp.x,scrollY:vp.y,collapse:0,start:0},sel=this.get();
activeEl=null;if(type=="simple"){o.rng=range;return o;}if(!apf.w3cRange){if(range.item){var e=range.item(0),n=c.getElementsByTagName(e.nodeName),i=0,l=n.length;
for(;i<l;i++){if(e==n[i]){return !(sp=i);}}return apf.extend(o,{tag:e.nodeName,index:sp});
}var tr,bp,sp,tr1;tr=range.duplicate();tr.moveToElementText(c);tr.collapse(true);
bp=Math.abs(tr.move(CHAR,ch));tr=range.duplicate();tr.collapse(true);sp=Math.abs(tr.move(CHAR,ch));
tr=range.duplicate();tr.collapse(false);var offset=0;tr1=tr.duplicate();tr1.moveEnd(CHAR,1);
tr1.collapse(false);var parN=tr1.parentElement();if(reBlock.test(parN.nodeName)){if(getParent(tr.parentElement(),_block,null,c)!=parN){activeEl=parN;
}}return apf.extend(o,{start:sp-bp-offset,length:Math.abs(tr.move(CHAR,ch))-sp});
}var p=sel.anchorNode;while(p&&(p.nodeType!=1)){p=p.parentNode;}if(p&&p.nodeName=="IMG"){return o;
}if(!sel){return null;}var w,sc=range.startContainer,an=sel.anchorNode,custom=callback?callback(an):null;
if(sel.isCollapsed&&an){o.collapse=1;p=getParent(an,_block)||c;if(an.nodeType==3){w=oDoc.createTreeWalker(p,NodeFilter.SHOW_TEXT,null,false);
while(n=w.nextNode()){if(n==an){o.start=o.start+sel.anchorOffset;break;}o.start+=trimNl(n.nodeValue||"").length;
}}else{if(an!=p){w=oDoc.createTreeWalker(p,NodeFilter.SHOW_ALL,null,false);while(n=w.nextNode()){if(n==an){break;
}o.start+=trimNl(n.nodeValue||"").length;}}for(i=0,l=range.startOffset;i<l;i++){o.start+=parseInt(String(sc.childNodes[i].textContent).length);
}}o.end=o.start;if(!custom){o.content=sc.textContent||sc.innerHTML;try{if(range.startOffset==0&&sc.previousSibling&&(/IMG|BR|INPUT/.test(sc.previousSibling.nodeName))){o.br=sc.previousSibling;
}if(sc.childNodes[range.startOffset-1]&&(/IMG|BR|INPUT/.test(sc.childNodes[range.startOffset-1].nodeName))){o.br=sc.childNodes[range.startOffset-1];
}}catch(e){}}if(custom&&range.startOffset==0){n=custom.previousSibling;while(n&&((n.nodeType==3&&n.textContent=="")||(n.nodeType!=3&&n.innerHTML==""))){if(n&&(/IMG|BR|INPUT/.test(n.nodeName))){o.br=n;
o.br2=n.nextSibling;break;}n=n.previousSibling;}}apf.extend(o,{block:p,node:sc,offset:range.startOffset});
return o;}var s=[];p=0;w=oDoc.createTreeWalker(c,NodeFilter.SHOW_TEXT,null,false);
while((n=w.nextNode())!=null){if(n==sc){s[0]=p;}if(n==range.endContainer){s[1]=p;
break;}p+=trimNl(n.nodeValue||"").length;}apf.extend(o,{start:s[0]+range.startOffset,end:s[1]+range.endOffset,block:c});
return o;};this.moveToBookmark=function(b){var crt,sel=this.get(),c=oDoc.body,rng=this.getRange();
function getPos(sp,ep){var n,par,nv,nvl,o,p=0,d={},k=-1,w=oDoc.createTreeWalker(b.block,NodeFilter.SHOW_TEXT,null,false);
while(n=w.nextNode()){nv=n.nodeValue||"";nvl=trimNl(nv).length;p+=nvl;if(b.collapse){if(p>=sp){par=getParent(n,_block)||c;
}if(p==sp){k=par==b.block?1:0;}if(k==-1&&p>sp||k==1){d.endNode=d.startNode=n;d.endOffset=d.startOffset=sp-(p-nvl);
return d;}}else{if(p>=sp&&!d.startNode){o=sp-(p-nvl);d.startNode=n;d.startOffset=sp-(p-nvl);
}if(p>=ep){d.endNode=n;d.endOffset=ep-(p-nvl);return d;}}}return null;}if(!b){return false;
}if(!apf.w3cRange){oDoc.body.setActive();if(crt=b.rng){try{crt.select();}catch(ex){}return true;
}if(b.tag){crt=c.createControlRange();var n=oDoc.getElementsByTagName(b.tag),i=0,l=n.length;
for(;i<l;i++){if(i==b.index){crt.addElement(n[i]);}}}else{try{if(b.start<0){return true;
}crt=sel.createRange();if(activeEl){crt.moveToElementText(activeEl);crt.moveStart(CHAR,-2);
crt.expand(word);crt.collapse(false);}else{crt.moveToElementText(c);crt.collapse(true);
crt.moveStart(CHAR,b.start);crt.moveEnd(CHAR,b.length);}}catch(e){return true;}}try{crt.select();
}catch(ex){}return true;}if(!sel){return false;}crt=rng.cloneRange();if(b.rng){sel.removeAllRanges();
sel.addRange(b.rng);}else{if(typeof b.node!=UNDEF){var a=false;if((b.node.nodeType==3&&b.node.parentNode!=null&&b.node.textContent==b.content)||(b.node.nodeType!=3&&b.node.innerHTML==b.content)){crt.setStart(b.node,b.offset);
crt.collapse(true);a=true;}if(typeof b.br!=UNDEF&&(/IMG|BR|INPUT/.test(b.br.nodeName))){if(b.br.nextSibling){crt.selectNode(b.br.nextSibling);
crt.collapse(true);}else{crt.selectNode(b.br);crt.collapse(false);}a=true;}if(a){if(!apf.isOpera){sel.removeAllRanges();
}sel.addRange(crt);c.focus();oWin.scrollTo(b.scrollX,b.scrollY);return;}}if(typeof b.start!=UNDEF&&typeof b.end!=UNDEF){try{var sd=getPos(b.start,b.end);
if(sd){crt.setStart(sd.startNode,sd.startOffset);crt.setEnd(sd.endNode,sd.endOffset);
oWin.scrollTo(b.scrollX,b.scrollY);if(!apf.isOpera){sel.removeAllRanges();}sel.addRange(crt);
}}catch(ex){apf.console.error(ex);}}return;}};this.getContent=function(retType){if(typeof retType!="string"){retType="html";
}var range=this.getRange(),oSel=this.get(),prefix,suffix,n,oNode=oDoc.body;if(retType=="text"){return this.isCollapsed()?"":(range.text||(oSel.toString?oSel.toString():""));
}if(this.isCollapsed()){return"";}if(typeof range.htmlText!=UNDEF){return range.htmlText;
}var pNode,n=range.cloneContents();if(!n.childNodes.length){return"";}pNode=n.childNodes[0].ownerDocument.createElement("div");
pNode.appendChild(n);return pNode.innerHTML;};this.setContent=function(html,bNoPrepare){var range=this.getRange();
if(!bNoPrepare){html=apf.htmlCleaner.prepare(html,true);}if(range.insertNode){html+='<span id="__caret">_</span>';
range.deleteContents();range.insertNode(this.getRange().createContextualFragment(html));
var oCaret=oDoc.getElementById("__caret");var htmlNode=oCaret.previousSibling;range=oDoc.createRange();
range.setStartBefore(oCaret);range.setEndAfter(oCaret);this.setRange(range);oDoc.execCommand("Delete",false,null);
if(oCaret&&oCaret.parentNode){oCaret.parentNode.removeChild(oCaret);}return htmlNode;
}else{if(range.item){this.remove();range=this.getRange();}html=html.replace(/^<(\w+)/,'<$1 id="__caret"');
range.pasteHTML(html);var htmlNode=oDoc.getElementById("__caret");if(htmlNode){htmlNode.removeAttribute("id");
return htmlNode;}}};var styleObjNodes={img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1};
this.getType=function(){var oSel=this.get();if(apf.isIE){return oSel.type;}else{var type="Text";
if(oSel&&oSel.rangeCount==1){var range=oSel.getRangeAt(0);if(range.startContainer==range.endContainer&&(range.endOffset-range.startOffset)==1&&range.startContainer.nodeType==1&&styleObjNodes[range.startContainer.childNodes[range.startOffset].nodeName.toLowerCase()]){type=CTRL;
}}return type;}};this.getSelectedNode=function(){var range=this.getRange();if(!apf.isIE){if(!range){return oDoc;
}var oSel=this.get(),oNode=range.commonAncestorContainer;if(!range.collapsed){if(apf.isWebkit&&oSel.anchorNode&&oSel.anchorNode.nodeType==1){return oSel.anchorNode.childNodes[oSel.anchorOffset];
}if(range.startContainer==range.endContainer){if(range.startOffset-range.endOffset<2){if(range.startContainer.hasChildNodes()){oNode=range.startContainer.childNodes[range.startOffset];
}}}}return oNode;}return range.item?range.item(0):range.parentElement();};this.getParentNode=function(){switch(this.getType()){case CTRL:if(apf.isIE){return this.getSelectedNode().parentElement;
}else{return this.getSelectedNode().parentNode;}case NONE:return;default:var oSel=this.get();
if(apf.isIE){return oSel.createRange().parentElement();}else{if(oSel){var oNode=oSel.anchorNode;
while(oNode&&oNode.nodeType!=1){oNode=oNode.parentNode;}return oNode;}}break;}};
this.selectNode=function(node){var oSel,range;while(node.nodeType==1&&node.firstChild){node=node.firstChild;
}if(apf.isIE){oSel=this.get();if(!node){node=oSel.createRange().parentElement();
}try{oSel.empty();}catch(e){}try{range=oDoc.body.createControlRange();range.addElement(node);
}catch(e){range=oDoc.body.createTextRange();try{range.moveToElementText(node.nodeType!=1?node.parentNode:node);
}catch(e2){if(node.nodeValue){range.findText(node.nodeValue);}}}try{range.select();
}catch(e){}}else{range=this.getRange();if(node){range.selectNode(node);}oSel=this.get();
oSel.removeAllRanges();oSel.addRange(range);}return this;};this.collapse=function(toEnd){var range=this.getRange(),n;
if(range.item){n=range.item(0);range=oDoc.body.createTextRange();range.moveToElementText(n);
}range.collapse(!!toEnd);this.setRange(range);return this;};this.isCollapsed=function(){var range=this.getRange(),oSel=this.get();
if(!range||range.item){return false;}return !oSel||range.boundingWidth==0||range.collapsed;
};this.hasAncestorNode=function(nodeTagName){var oContainer,range=this.getRange();
if(this.getType()==CTRL||!apf.isIE){oContainer=this.getSelectedNode();if(!oContainer&&!apf.isIE){try{oContainer=range.startContainer;
}catch(e){}}}else{oContainer=range.parentElement();}while(oContainer){if(apf.isIE){if(oContainer.tagName==nodeTagName){return true;
}else{if(oContainer.nodeType==1&&oContainer.tagName==nodeTagName){return true;}}}oContainer=oContainer.parentNode;
}return false;};this.moveToAncestorNode=function(nodeTagName){var oNode,i,range=this.getRange();
nodeTagName=nodeTagName.toUpperCase();if(apf.isIE){if(this.getType()==CTRL){for(i=0;
i<range.length;i++){if(range(i).parentNode){oNode=range(i).parentNode;break;}}}else{oNode=range.parentElement();
}while(oNode&&oNode.nodeName!=nodeTagName){oNode=oNode.parentNode;}return oNode;
}else{var oContainer=this.getSelectedNode();if(!oContainer){oContainer=oWin.getSelection().getRangeAt(0).startContainer;
}while(oContainer){if(oContainer.tagName==nodeTagName){return oContainer;}oContainer=oContainer.parentNode;
}return null;}};this.remove=function(){var oSel=this.get(),i;if(apf.isIE){if(oSel.type!=NONE){oSel.clear();
}}else{if(oSel){for(i=0;i<oSel.rangeCount;i++){oSel.getRangeAt(i).deleteContents();
}}}return this;};this.$destroy=function(){oWin=oDoc=editor=this.current=_self=null;
delete oWin;delete oDoc;delete editor;delete this.current;delete _self;};};apf.skins={skins:{},css:[],events:["onmousemove","onmousedown","onmouseup","onmouseout","onclick","ondragcopy","ondragstart","ondblclick"],Init:function(xmlNode,refNode,path){var name=(refNode?refNode.getAttribute("id"):null)||xmlNode.getAttribute("id");
var base=(refNode?refNode.getAttribute("src").match(/\//)||path:"")?(path||refNode.getAttribute("src")).replace(/\/[^\/]*$/,"")+"/":"";
var mediaPath=null,iconPath=null;mediaPath=xmlNode.getAttribute("media-path");if(mediaPath!==null){mediaPath=apf.getAbsolutePath(base||apf.hostPath,mediaPath);
}else{if(refNode){mediaPath=refNode.getAttribute("media-path");if(mediaPath!==null){mediaPath=apf.getAbsolutePath(apf.hostPath,mediaPath);
}else{mediaPath=apf.getAbsolutePath(base||apf.hostPath,"images/");}}}iconPath=xmlNode.getAttribute("icon-path");
if(iconPath!==null){iconPath=apf.getAbsolutePath(base||apf.hostPath,iconPath);}else{if(refNode){iconPath=refNode.getAttribute("icon-path");
if(iconPath!==null){iconPath=apf.getAbsolutePath(apf.hostPath,iconPath);}else{iconPath=apf.getAbsolutePath(base||apf.hostPath,"icons/");
}}}if(!name){name="default";}if(xmlNode.getAttribute("id")){document.body.className+=" "+xmlNode.getAttribute("id");
}var names=name.split("|");name=names[0];if(!this.skins[name]||name=="default"){this.skins[name]={base:base,name:name,iconPath:iconPath,mediaPath:mediaPath,templates:{},originals:{},xml:xmlNode};
if(names.length>1){for(var i=0;i<names.length;i++){this.skins[names[i]]=this.skins[name];
}}}if(!this.skins["default"]&&this.$first==refNode){this.skins["default"]=this.skins[name];
}var nodes=xmlNode.childNodes;for(var i=nodes.length-1;i>=0;i--){if(nodes[i].nodeType!=1){continue;
}this.skins[name].templates[nodes[i].getAttribute("name")]=nodes[i];if(nodes[i].ownerDocument){this.importSkinDef(nodes[i],base,name);
}}this.purgeCss(mediaPath,iconPath);if(this.queue[name]){for(var prop in this.queue[name]){this.queue[name][prop]();
}}},loadStylesheet:function(filename,title){var o;with(o=document.getElementsByTagName("head")[0].appendChild(document.createElement("LINK"))){rel="stylesheet";
type="text/css";href=filename;title=title;}return o;},importSkinDef:function(xmlNode,basepath,name){var i,l,nodes=$xmlns(xmlNode,"style",apf.ns.aml),tnode,node;
for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.getAttribute("src")){this.loadStylesheet(apf.getAbsolutePath(basepath,node.getAttribute("src")));
}else{var test=true;if(node.getAttribute("condition")){try{test=eval(node.getAttribute("condition"));
}catch(e){test=false;}}if(test){tnode=node.firstChild;while(tnode){this.css.push(tnode.nodeValue);
tnode=tnode.nextSibling;}}}}nodes=$xmlns(xmlNode,"alias",apf.ns.apf);var t=this.skins[name].templates;
for(i=0;i<nodes.length;i++){if(!nodes[i].firstChild){continue;}t[nodes[i].firstChild.nodeValue.toLowerCase()]=xmlNode;
}},loadedCss:"",purgeCss:function(imagepath,iconpath){if(!this.css.length){return;
}var cssString=this.css.join("\n").replace(/images\//g,imagepath).replace(/icons\//g,iconpath);
apf.importCssString(cssString);this.loadedCss+=cssString;this.css=[];},loadCssInWindow:function(skinName,win,imagepath,iconpath){this.css=[];
var name=skinName.split(":");var skin=this.skins[name[0]];var template=skin.templates[name[1]];
this.importSkinDef(template,skin.base,skin.name);var cssString=this.css.join("\n").replace(/images\//g,imagepath).replace(/icons\//g,iconpath);
apf.importCssString(cssString);this.css=[];},setSkinPaths:function(skinName,amlNode){skinName=skinName.split(":");
var name=skinName[0];var type=skinName[1];if(!this.skins[name]){throw new Error(apf.formatErrorString(1076,null,"Retrieving Skin","Could not find skin '"+name+"'",amlNode.$aml));
}amlNode.iconPath=this.skins[name].iconPath;amlNode.mediaPath=this.skins[name].mediaPath;
},getTemplate:function(skinName,noError){skinName=skinName.split(":");var name=skinName[0];
var type=skinName[1];if(!this.skins[name]){if(noError){return false;}throw new Error(apf.formatErrorString(1077,null,"Retrieving Template","Could not find skin '"+name+"'"));
return false;}if(!this.skins[name].templates[type]){return false;}var skin=this.skins[name].templates[type];
var originals=this.skins[name].originals[type];if(!originals){originals=this.skins[name].originals[type]={};
if(!$xmlns(skin,"presentation",apf.ns.aml)[0]){throw new Error(apf.formatErrorString(1078,null,"Retrieving Template","Missing presentation tag in '"+name+"'"));
}var nodes=$xmlns(skin,"presentation",apf.ns.aml)[0].childNodes;for(var i=0;i<nodes.length;
i++){if(nodes[i].nodeType!=1){continue;}originals[nodes[i].baseName||nodes[i][apf.TAGNAME]]=nodes[i];
}}return originals;},getCssString:function(skinName){return apf.queryValue($xmlns(this.skins[skinName.split(":")[0]].xml,"style",apf.ns.aml)[0],"text()");
},changeSkinset:function(value){var node=apf.document.documentElement;while(node){if(node&&node.nodeFunc==apf.NODE_VISIBLE&&node.hasFeature(apf.__PRESENTATION__)&&!node.skinset){node.$propHandlers.skinset.call(node,value);
node.skinset=null;}if(node.firstChild||node.nextSibling){node=node.firstChild||node.nextSibling;
}else{do{node=node.parentNode;}while(node&&!node.nextSibling);if(node){node=node.nextSibling;
}}}},queue:{},waitForSkin:function(skinset,id,callback){if(this.skins[skinset]){return;
}(this.queue[skinset]||(this.queue[skinset]={}))[id]=callback;return true;},iconMaps:{},addIconMap:function(options){this.iconMaps[options.name]=options;
if(options.size){options.width=options.height=options.size;}else{if(!options.width){options.width=1;
}if(!options.height){options.height=1;}}},setIcon:function(oHtml,strQuery,iconPath){if(!strQuery){oHtml.style.backgroundImage="";
return;}if(oHtml.tagName.toLowerCase()=="img"){oHtml.setAttribute("src",strQuery?(iconPath||"")+strQuery:"");
return;}var parts=strQuery.split(":");var map=this.iconMaps[parts[0]];if(map){var left,top,coords=parts[1].split(",");
left=(coords[(map.type=="vertical")?1:0]||0)*map.width;top=(coords[(map.type=="vertical")?0:1]||0)*map.height;
oHtml.style.backgroundImage="url("+(iconPath||"")+map.src+")";oHtml.style.backgroundPosition=((-1*left)-map.offset[0])+"px "+((-1*top)-map.offset[1])+"px";
}else{oHtml.style.backgroundImage="url("+(iconPath||"")+strQuery+")";}}};apf.Sort=function(xmlNode){var settings={};
this.parseXml=function(xmlNode,clear){if(clear){settings={};}settings.order=xmlNode.order;
settings.getValue=xmlNode.csort||xmlNode.$compile("sort");settings.getNodes=self[xmlNode["nodes-method"]];
settings.ascending=(settings.order||"").indexOf("desc")==-1;settings.order=null;
if(xmlNode["data-type"]){settings.method=sort_methods[xmlNode["data-type"]];}else{if(xmlNode["sort-method"]){settings.method=self[xmlNode["sort-method"]];
if(!settings.method){throw new Error(apf.formatErrorString(0,null,"Sorting nodes","Invalid or missing sort function name provided '"+xmlNode["sort-method"]+"'",xmlNode));
}}else{settings.method=sort_methods.alpha;}}var str=xmlNode["date-format"];if(str){settings.sort_dateFmtStr=str;
settings.method=sort_methods.date;var result=str.match(/(D+|Y+|M+|h+|m+|s+)/g);
if(result){for(var pos={},i=0;i<result.length;i++){pos[result[i].substr(0,1)]=i+1;
}settings.dateFormat=new RegExp(str.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));
settings.dateReplace="$"+pos.M+"/$"+pos.D+"/$"+pos.Y;if(pos.h){settings.dateReplace+=" $"+pos.h+":$"+pos.m+":$"+pos.s;
}}}};this.set=function(struct,clear){if(clear){settings={};}apf.extend(settings,struct);
if(settings.ascending==undefined){settings.ascending=struct.order?struct.order.indexOf("desc")==-1:true;
}settings.order=null;if(struct.type){settings.method=sort_methods[struct.type];
}else{if(struct.method){settings.method=self[struct.method];}else{if(!settings.method){settings.method=sort_methods.alpha;
}}}if(struct.format){settings.sort_dateFmtStr=struct.format;var result=str.match(/(D+|Y+|M+|h+|m+|s+)/g);
if(result){for(var pos={},i=0;i<result.length;i++){pos[result[i].substr(0,1)]=i+1;
}settings.dateFormat=new RegExp(str.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));
settings.dateReplace="$"+pos.M+"/$"+pos.D+"/$"+pos.Y;if(pos.h){settings.dateReplace+=" $"+pos.h+":$"+pos.m+":$"+pos.s;
}}}if(!settings.getValue){settings.getValue=function(item){return apf.queryValue(item,settings.xpath);
};}};this.get=function(){return apf.extend({},settings);};this.findSortSibling=function(pNode,xmlNode){var nodes=getNodes?getNodes(pNode,xmlNode):this.getTraverseNodes(pNode);
for(var i=0;i<nodes.length;i++){if(!compare(xmlNode,nodes[i],true,sortSettings)){return nodes[i];
}}return null;};var sort_intmask=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000"];
var sort_methods={alpha:function(n){return n.toString().toLowerCase();},number:function(t){return(t.length<sort_intmask.length?sort_intmask[sort_intmask.length-t.length]:"")+t;
},date:function(t,args){var sort_dateFormat=settings.dateFormat;var sort_dateReplace=settings.dateReplace;
var sort_dateFmtStr=settings.sort_dateFmtStr;var d;if(!sort_dateFormat){d=new Date(t);
}else{if(sort_dateFmtStr=="*"){d=apf.date.getDateTime(t);}else{d=(new Date(t.replace(sort_dateFormat,sort_dateReplace))).getTime();
}}t=""+d.getTime();if(t=="NaN"){t="0";}return(t.length<sort_intmask.length?sort_intmask[sort_intmask.length-t.length]:"")+t;
}};this.apply=function(n,args,func,start,len){var sa=[],i=n.length;while(i--){var v=settings.getValue(n[i]);
if(n){sa[sa.length]={toString:function(){return this.v;},xmlNode:n[i],v:(settings.method||sort_methods.alpha)(v||"",args,n[i])};
}}sa.sort();var end=len?Math.min(sa.length,start+len):sa.length;if(!start){start=0;
}if(func){if(settings.ascending){for(i=start;i<end;i++){f(i,end,sa[i].xmlNode,sa[i].v);
}}else{for(i=end-1;i>=start;i--){f(end-i-1,end,sa[i].xmlNode,sa[i].v);}}}else{var res=[];
if(settings.ascending){for(i=start;i<end;i++){res[res.length]=sa[i].xmlNode;}}else{for(i=end-1;
i>=start;i--){res[res.length]=sa[i].xmlNode;}}return res;}};if(xmlNode){this.parseXml(xmlNode);
}};apf.storage={modules:{},init:function(name){if(!name||name=="autodetect"){name=this.autodetect();
}var provider=this.getProvider(name);apf.storage=apf.extend(this,provider);apf.storage.init=null;
apf.console.info("Installed storage provider '"+name+"'");return provider;},getProvider:function(name){var provider=apf.storage.modules[name];
if(!provider||typeof provider!="object"){apf.console.warn("Could not find storage provider '"+name+"'");
return false;}if(!provider.isAvailable()){apf.console.warn("Storage provider '"+name+"' is not available");
return false;}if(!provider.initialized&&(!provider.init||provider.init()===false)){apf.console.warn("Could not install storage provider '"+name+"");
return false;}provider.name=name;apf.extend(provider,this.base);return provider;
},autodetect:function(){for(var name in this.modules){if("memory|cookie".indexOf(name)>-1){continue;
}if(this.modules[name].isAvailable()){return name;}}return !location.host&&this.modules.cookie?"cookie":(this.modules.memory?"memory":null);
},base:{namespace:"default",isValidKeyArray:function(keys){return(!keys||!keys.join)?false:/^[0-9A-Za-z_\.\-]*$/.test(keys.join(""));
},isValidKey:function(keyName){return(keyName===null||keyName===undefined)?false:/^[0-9A-Za-z_\.\-]*$/.test(keyName);
},getAllPairs:function(namespace,store){var keys=this.getKeys(namespace);if(!keys||!keys.length){return;
}var values=this.getMultiple(keys,namespace);for(var i=0;i<keys.length&&values;
i++){if(values[i]){store[keys[i]]=values[i];}}return keys.length;}}};apf.tween=(function(apf){var modules={left:function(oHtml,value){oHtml.style.left=value+PX;
},right:function(oHtml,value){oHtml.style.left="";oHtml.style.right=value+PX;},top:function(oHtml,value){oHtml.style.top=value+PX;
},bottom:function(oHtml,value){oHtml.style.top="";oHtml.style.bottom=value+PX;},width:function(oHtml,value,center){oHtml.style.width=value+PX;
},height:function(oHtml,value,center){oHtml.style.height=value+PX;},scrollTop:function(oHtml,value,center){oHtml.scrollTop=value;
},scrollLeft:function(oHtml,value,center){oHtml.scrollLeft=value;},"height-rsz":function(oHtml,value,center){oHtml.style.height=value+PX;
if(apf.hasSingleResizeEvent){window.onresize();}},mwidth:function(oHtml,value,info){var diff=apf.getDiff(oHtml);
oHtml.style.width=value+PX;oHtml.style.marginLeft=-1*(value/2+(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||diff[0]/2)+(info.margin||0))+PX;
},mheight:function(oHtml,value,info){var diff=apf.getDiff(oHtml);oHtml.style.height=value+PX;
oHtml.style.marginTop=(-1*value/2-(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||diff[1]/2)+(info.margin||0))+PX;
},scrollwidth:function(oHtml,value){oHtml.style.width=value+PX;oHtml.scrollLeft=oHtml.scrollWidth;
},scrollheight_old:function(oHtml,value){try{oHtml.style.height=value+PX;oHtml.scrollTop=oHtml.scrollHeight;
}catch(e){alert(value);}},scrollheight:function(oHtml,value,info){var diff=apf.getHeightDiff(oHtml),oInt=info.$int||oHtml;
oHtml.style.height=Math.max((value+(info.diff||0)),0)+PX;oInt.scrollTop=oInt.scrollHeight-oInt.offsetHeight-diff+(info.diff||0)-(apf.isGecko?16:0);
},scrolltop:function(oHtml,value){oHtml.style.height=value+PX;oHtml.style.top=(-1*value-2)+PX;
oHtml.scrollTop=0;},clipright:function(oHtml,value,center){oHtml.style.clip="rect(auto, auto, auto, "+value+"px)";
oHtml.style.marginLeft=(-1*value)+PX;},fade:function(oHtml,value){if(!apf.supportOpacity&&apf.hasStyleFilters){oHtml.style.filter=value==1?"":"alpha(opacity="+parseInt(value*100)+")";
}else{oHtml.style.opacity=value;}},bgcolor:function(oHtml,value){oHtml.style.backgroundColor=value;
},textcolor:function(oHtml,value){oHtml.style.color=value;},htmlcss:function(oHtml,value,obj){if(apf.hasStyleFilters&&obj.type=="filter"){oHtml.style.filter=value==1?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+value+")";
}else{oHtml.style[obj.type]=value+(obj.needsPx?PX:"");}},transformscale:function(oHtml,value,obj){oHtml.style[obj.type]=SCALEA+parseFloat(value)+SCALEB;
},transformrotate:function(oHtml,value,obj){oHtml.style[obj.type]=ROTATEA+parseFloat(value)+ROTATEB;
},transformvalscale:function(value){return SCALEA+parseFloat(value)+SCALEB;},transformvalrotate:function(value){return ROTATEA+parseFloat(value)+ROTATEB;
}};var ID="id",PX="px",NUM="number",TRANSVAL="transformval",TRANSFORM="transform",SCALE="scale",SCALEA="scale(",ROTATEA="rotate(",SCALEB=")",ROTATEB="deg)",CSSTIMING=["linear","ease-in","ease-out","ease","ease-in-out","cubic-bezier"],CSSPROPS={left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",scrollTop:false,scrollLeft:false,mwidth:false,mheight:false,scrollwidth:false,scrollheight:false,fade:"opacity",opacity:"opacity",bgcolor:"background-color",textcolor:"color",transform:"transform"},__pow=Math.pow,__round=Math.round,queue={},current=null,setQueue=function(oHtml,stepFunction){var id=oHtml.getAttribute(ID);
if(!id){apf.setUniqueHtmlId(oHtml);id=oHtml.getAttribute(ID);}if(!queue[id]){queue[id]=[];
}queue[id].push(stepFunction);if(queue[id].length==1){stepFunction(0);}},nextQueue=function(oHtml){var q=queue[oHtml.getAttribute(ID)];
if(!q){return;}q.shift();if(q.length){q[0](0);}},clearQueue=function(oHtml,bStop){var q=queue[oHtml.getAttribute(ID)];
if(!q){return;}if(bStop&&current&&current.control){current.control.stop=true;}q.length=0;
},purgeQueue=function(oHtml){var id=oHtml.getAttribute(ID);if(!id){apf.setUniqueHtmlId(oHtml);
id=oHtml.getAttribute(ID);}for(var i in queue){if(i==id){queue[i]=[];}}},calcSteps=function(func,fromValue,toValue,nrOfSteps){var i=0,l=nrOfSteps-1,steps=[fromValue];
if(typeof func==NUM){if(!func){func=apf.tween.linear;}else{if(func==1){func=apf.tween.easeInCubic;
}else{if(func==2){func=apf.tween.easeOutCubic;}}}}for(i=0;i<l;++i){steps.push(func(i/nrOfSteps,fromValue,toValue-fromValue));
}steps.push(toValue);return steps;},calcColorSteps=function(animtype,fromValue,toValue,nrOfSteps){var d2,d1,c=apf.color.colorshex,a=parseInt((c[fromValue]||fromValue).slice(1),16),b=parseInt((c[toValue]||toValue).slice(1),16),i=0,out=[];
for(;i<nrOfSteps;i++){d1=i/(nrOfSteps-1),d2=1-d1;out[out.length]="#"+("000000"+((__round((a&255)*d2+(b&255)*d1)&255)|(__round((a&65280)*d2+(b&65280)*d1)&65280)|(__round((a&16711680)*d2+(b&16711680)*d1)&16711680)).toString(16)).slice(-6);
}return out;},single=function(oHtml,info){info=apf.extend({steps:10,interval:5,anim:apf.tween.linear,control:{}},info);
info.steps=Math.ceil(info.steps*apf.animSteps);info.interval=Math.ceil(info.interval*apf.animInterval);
if(oHtml.nodeFunc>100){info.$int=oHtml.$int;oHtml=oHtml.$ext;}try{if("fixed|absolute|relative".indexOf(apf.getStyle(oHtml,"position"))==-1){oHtml.style.position="relative";
}}catch(e){}var useCSSAnim=(apf.supportCSSAnim&&apf.supportCSSTransition&&CSSPROPS[info.type]),isTransform=(info.type==TRANSFORM);
info.method=useCSSAnim?info.type:isTransform?modules[TRANSFORM+(info.subType||SCALE)]:modules[info.type]?modules[info.type]:(info.needsPx=needsPix[info.type]||false)?modules.htmlcss:modules.htmlcss;
if(!info.method){throw new Error(apf.formatErrorString(0,this,"Single Value Tween","Could not find method for tweening operation '"+info.type+"'"));
}if(useCSSAnim){var type=CSSPROPS[info.type];if(type===false){return apf.tween;
}info.type=type||info.type;if(isTransform){if(!info.subType){info.subType=SCALE;
}info.type=apf.supportCSSAnim;}var transform=(isTransform)?modules[TRANSVAL+(info.subType||SCALE)]:null;
oHtml.style[info.type]=isTransform?transform(info.from):info.from+(needsPix[info.type]?PX:"");
$setTimeout(function(){oHtml.style[info.type]=isTransform?transform(info.to):info.to+(needsPix[info.type]?PX:"");
oHtml.offsetTop;oHtml.style[apf.cssPrefix+"Transition"]=info.type+" "+((info.steps*info.interval)/1000)+"s "+CSSTIMING[info.anim||0];
var f=function(){if(info.onfinish){info.onfinish(oHtml,info.userdata);}oHtml.style[apf.cssPrefix+"Transition"]="";
oHtml.removeEventListener(apf.cssAnimEvent,f);};oHtml.addEventListener(apf.cssAnimEvent,f);
});return apf.tween;}if(info.control){info.control.state=apf.tween.RUNNING;info.control.stop=function(){info.control.state=apf.tween.STOPPING;
clearQueue(oHtml);if(info.onstop){info.onstop(oHtml,info.userdata);}};}var steps=info.color?calcColorSteps(info.anim,info.from,info.to,info.steps):calcSteps(info.anim,parseFloat(info.from),parseFloat(info.to),info.steps),stepFunction=function(step){if(info.control&&info.control.state){info.control.state=apf.tween.STOPPED;
return;}current=info;if(info.onbeforeeach&&info.onbeforeeach(oHtml,info.userdata)===false){return;
}try{info.method(oHtml,steps[step],info);}catch(e){}if(info.oneach){info.oneach(oHtml,info.userdata);
}if(step<info.steps){return $setTimeout(function(){stepFunction(step+1);},info.interval);
}current=null;if(info.control){info.control.state=apf.tween.STOPPED;}if(info.onfinish){info.onfinish(oHtml,info.userdata);
}nextQueue(oHtml);};if(info.type.indexOf("scroll")>-1){purgeQueue(oHtml);}setQueue(oHtml,stepFunction);
return apf.tween;},multi=function(oHtml,info){info=apf.extend({steps:10,interval:5,anim:apf.tween.linear,control:{}},info);
info.steps=Math.ceil(info.steps*apf.animSteps);info.interval=Math.ceil(info.interval*apf.animInterval);
if(oHtml.nodeFunc>100){info.$int=oHtml.$int;oHtml=oHtml.$ext;}var animCSS,isTransform,useCSSAnim=apf.supportCSSAnim&&apf.supportCSSTransition,hasCSSAnims=false,cssDuration=((info.steps*info.interval)/1000),cssAnim=CSSTIMING[info.anim||0],steps=[],stepsTo=[],i=0,l=info.tweens.length;
for(;i<l;i++){var data=info.tweens[i];if(data.oHtml&&data.oHtml.nodeFunc>100){data.$int=data.oHtml.$int;
data.oHtml=data.oHtml.$ext;}animCSS=(useCSSAnim&&CSSPROPS[data.type]);isTransform=(data.type==TRANSFORM);
if(isTransform){if(!data.subType){data.subType=SCALE;}data.type=apf.supportCSSAnim;
}data.method=animCSS?data.type:isTransform?modules[TRANSFORM+(data.subType)]:modules[data.type]?modules[data.type]:(data.needsPx=needsPix[data.type]||false)?modules.htmlcss:modules.htmlcss;
if(!data.method){throw new Error(apf.formatErrorString(0,this,"Multi Value Tween","Could not find method for tweening operation '"+data.type+"'"));
}if(animCSS){var type=isTransform?data.type:CSSPROPS[data.type];data.type=type||data.type;
var transform=modules[TRANSVAL+(data.subType)];oHtml.style[data.type]=isTransform?transform(data.from):data.from+(needsPix[data.type]?PX:"");
stepsTo.push([data.type,isTransform?transform(data.to):data.to+(needsPix[data.type]?PX:"")]);
steps.push(data.type+" "+cssDuration+"s "+cssAnim+" 0");hasCSSAnims=true;}else{steps.push(data.color?calcColorSteps(info.anim,data.from,data.to,info.steps):calcSteps(info.anim,parseFloat(data.from),parseFloat(data.to),info.steps));
}}if(hasCSSAnims){oHtml.style[apf.cssPrefix+"Transition"]=steps.join(",");oHtml.offsetTop;
var count=0,func=function(){count++;if(count==stepsTo.length){if(info.onfinish){info.onfinish(oHtml,info.userdata);
}oHtml.style[apf.cssPrefix+"Transition"]="";oHtml.removeEventListener(apf.cssAnimEvent,func);
}};oHtml.addEventListener(apf.cssAnimEvent,func,false);for(var k=0,j=stepsTo.length;
k<j;k++){oHtml.style[stepsTo[k][0]]=stepsTo[k][1];}return apf.tween;}if(info.control){info.control.state=apf.tween.RUNNING;
info.control.stop=function(){info.control.state=apf.tween.STOPPING;clearQueue(oHtml);
if(info.onstop){info.onstop(oHtml,info.userdata);}};}var tweens=info.tweens,stepFunction=function(step){if(info.control&&info.control.state){info.control.state=apf.tween.STOPPED;
return;}current=info;try{for(var i=0;i<steps.length;i++){tweens[i].method(tweens[i].oHtml||oHtml,steps[i][step],tweens[i]);
}}catch(e){}if(info.oneach){info.oneach(oHtml,info.userdata);}if(step<info.steps){return $setTimeout(function(){stepFunction(step+1);
},info.interval);}current=null;if(info.control){info.control.state=apf.tween.STOPPED;
}if(info.onfinish){info.onfinish(oHtml,info.userdata);}nextQueue(oHtml);};setQueue(oHtml,stepFunction);
return apf.tween;},css=function(oHtml,className,info,remove){(info=info||{}).tweens=[];
if(oHtml.nodeFunc>100){oHtml=oHtml.$ext;}if(remove){apf.setStyleClass(oHtml,"",[className]);
}var resetAnim=function(remove,callback){if(remove){apf.setStyleClass(oHtml,"",[className]);
}else{apf.setStyleClass(oHtml,className);}for(var i=0;i<info.tweens.length;i++){if(info.tweens[i].type=="filter"){continue;
}oHtml.style[info.tweens[i].type]="";}if(callback){callback.apply(this,arguments);
}};var onfinish=info.onfinish,onstop=info.onstop;info.onfinish=function(){resetAnim(remove,onfinish);
};info.onstop=function(){resetAnim(!remove,onstop);};var result,newvalue,curvalue,j,isColor,style,rules,i,tweens={};
for(i=0;i<document.styleSheets.length;i++){rules=document.styleSheets[i][apf.styleSheetRules];
for(j=rules.length-1;j>=0;j--){var rule=rules[j];if(!rule.style||!rule.selectorText.match("."+className+"$")){continue;
}for(style in rule.style){if(!rule.style[style]||cssProps.indexOf("|"+style+"|")==-1){continue;
}if(style=="filter"){if(!rule.style[style].match(/opacity\=([\d\.]+)/)){continue;
}newvalue=RegExp.$1;result=(apf.getStyleRecur(oHtml,style)||"").match(/opacity\=([\d\.]+)/);
curvalue=result?RegExp.$1:100;isColor=false;if(newvalue==curvalue){if(remove){curvalue=100;
}else{newvalue=100;}}}else{newvalue=remove&&oHtml.style[style]||rule.style[style];
if(remove){oHtml.style[style]="";}curvalue=apf.getStyleRecur(oHtml,style);isColor=style.match(/color/i)?true:false;
}tweens[style]={type:style,from:(isColor?String:parseFloat)(remove?newvalue:curvalue),to:(isColor?String:parseFloat)(remove?curvalue:newvalue),color:isColor,needsPx:needsPix[style.toLowerCase()]||false};
}}}for(var prop in tweens){info.tweens.push(tweens[prop]);}if(remove){apf.setStyleClass(oHtml,className);
}return multi(oHtml,info);},cssRemove=function(oHtml,className,info){css(oHtml,className,info,true);
},needsPix={left:true,top:true,bottom:true,right:true,width:true,height:true,fontSize:true,lineHeight:true,textIndent:true,marginLeft:true,marginTop:true,marginRight:true,marginBottom:true},cssProps="|backgroundColor|backgroundPosition|color|width|filter|height|left|top|bottom|right|fontSize|letterSpacing|lineHeight|textIndent|opacity|paddingLeft|paddingTop|paddingRight|paddingBottom|borderLeftWidth|borderTopWidth|borderRightWidth|borderBottomWidth|borderLeftColor|borderTopColor|borderRightColor|borderBottomColor|marginLeft|marginTop|marginRight|marginBottom|transform|",cssTransforms="|scale|rotate|";
return{single:single,multi:multi,css:css,cssRemove:cssRemove,clearQueue:clearQueue,addModule:function(name,func,force){if(typeof name!="string"||typeof func!="function"||(modules[name]&&!force)){return this;
}modules[name]=func;return this;},NORMAL:0,EASEIN:1,EASEOUT:2,RUNNING:0,STOPPING:1,STOPPED:2,calcColorSteps:calcColorSteps,linear:function(t,x_min,dx){return dx*t+x_min;
},easeInQuad:function(t,x_min,dx){return dx*__pow(t,2)+x_min;},easeOutQuad:function(t,x_min,dx){return -dx*t*(t-2)+x_min;
},easeInOutQuad:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*t*t+x_min;}return -dx/2*((--t)*(t-2)-1)+x_min;
},easeInCubic:function(t,x_min,dx){return dx*__pow(t,3)+x_min;},easeOutCubic:function(t,x_min,dx){return dx*(__pow(t-1,3)+1)+x_min;
},easeInOutCubic:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*__pow(t,3)+x_min;
}return dx/2*(__pow(t-2,3)+2)+x_min;},easeInQuart:function(t,x_min,dx){return dx*__pow(t,4)+x_min;
},easeOutQuart:function(t,x_min,dx){return -dx*(__pow(t-1,4)-1)+x_min;},easeInOutQuart:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*__pow(t,4)+x_min;
}return -dx/2*(__pow(t-2,4)-2)+x_min;},easeInQuint:function(t,x_min,dx){return dx*__pow(t,5)+x_min;
},easeOutQuint:function(t,x_min,dx){return dx*(__pow(t-1,5)+1)+x_min;},easeInOutQuint:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*__pow(t,5)+x_min;
}return dx/2*(__pow(t-2,5)+2)+x_min;},easeInSine:function(t,x_min,dx){return -dx*Math.cos(t*(Math.PI/2))+dx+x_min;
},easeOutSine:function(t,x_min,dx){return dx*Math.sin(t*(Math.PI/2))+x_min;},easeInOutSine:function(t,x_min,dx){return -dx/2*(Math.cos(Math.PI*t)-1)+x_min;
},easeInExpo:function(t,x_min,dx){return(t==0)?x_min:dx*__pow(2,10*(t-1))+x_min;
},easeOutExpo:function(t,x_min,dx){return(t==1)?x_min+dx:dx*(-__pow(2,-10*t)+1)+x_min;
},easeInOutExpo:function(t,x_min,dx){if(t==0){return x_min;}if(t==1){return x_min+dx;
}if((t/=0.5)<1){return dx/2*__pow(2,10*(t-1))+x_min;}return dx/2*(-__pow(2,-10*--t)+2)+x_min;
},easeInCirc:function(t,x_min,dx){return -dx*(Math.sqrt(1-t*t)-1)+x_min;},easeOutCirc:function(t,x_min,dx){return dx*Math.sqrt(1-(t-=1)*t)+x_min;
},easeInOutCirc:function(t,x_min,dx){if((t/=0.5)<1){return -dx/2*(Math.sqrt(1-t*t)-1)+x_min;
}return dx/2*(Math.sqrt(1-(t-=2)*t)+1)+x_min;},easeInElastic:function(t,x_min,dx){var s=1.70158,p=0.3,a=dx;
if(t==0){return x_min;}if(t==1){return x_min+dx;}if(!a||a<Math.abs(dx)){a=dx;s=p/4;
}else{s=p/(2*Math.PI)*Math.asin(dx/a);}return -(a*__pow(2,10*(t-=1))*Math.sin((t*1-s)*(2*Math.PI)/p))+x_min;
},easeOutElastic:function(t,x_min,dx){var s=1.70158,p=0.3,a=dx;if(t==0){return x_min;
}if(t==1){return x_min+dx;}if(a<Math.abs(dx)){a=dx;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(dx/a);
}return a*__pow(2,-10*t)*Math.sin((t-s)*(2*Math.PI)/p)+dx+x_min;},easeInOutElastic:function(t,x_min,dx){var s=1.70158,p=0,a=dx;
if(t==0){return x_min;}if((t/2)==2){return x_min+dx;}if(!p){p=0.3*1.5;}if(a<Math.abs(dx)){a=dx;
s=p/4;}else{s=p/(2*Math.PI)*Math.asin(dx/a);}if(t<1){return -0.5*(a*__pow(2,10*(t-=1))*Math.sin((t-s)*(2*Math.PI)/p))+x_min;
}return a*__pow(2,-10*(t-=1))*Math.sin((t-s)*(2*Math.PI)/p)*0.5+dx+x_min;},easeInBack:function(t,x_min,dx){var s=1.70158;
return dx*__pow(t,2)*((s+1)*t-s)+x_min;},easeOutBack:function(t,x_min,dx){var s=1.70158;
return dx*((t-=1)*t*((s+1)*t+s)+1)+x_min;},easeInOutBack:function(t,x_min,dx){var s=1.70158;
if((t/2)<1){return dx/2*(t*t*(((s*=(1.525))+1)*t-s))+x_min;}return dx/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+x_min;
},easeInBounce:function(t,x_min,dx){return dx-apf.tween.easeOutBounce(1-t,0,dx)+x_min;
},easeOutBounce:function(t,x_min,dx){if(t<(1/2.75)){return dx*(7.5625*t*t)+x_min;
}else{if(t<(2/2.75)){return dx*(7.5625*(t-=(1.5/2.75))*t+0.75)+x_min;}else{if(t<(2.5/2.75)){return dx*(7.5625*(t-=(2.25/2.75))*t+0.9375)+x_min;
}else{return dx*(7.5625*(t-=(2.625/2.75))*t+0.984375)+x_min;}}}},easeInOutBounce:function(t,x_min,dx){if(t<1/2){return apf.tween.easeInBounce(t*2,0,dx)*0.5+x_min;
}return apf.tween.easeOutBounce(t*2-1,0,dx)*0.5+dx*0.5+x_min;}};})(apf);apf.xmldb=new (function(){this.xmlDocTag="a_doc";
this.xmlIdTag="a_id";this.xmlListenTag="a_listen";this.htmlIdTag="id";this.disableRDB=false;
this.$xmlDocLut=[];this.$nodeCount={};var cleanRE=/(?:a_doc|a_id|a_listen|a_loaded)=(?:"|')[^'"]+(?:"|')/g,whiteRE=/>[\s\n\r\t]+</g;
this.getElementById=function(id,doc){if(!doc){doc=this.$xmlDocLut[id.split("|")[0]];
}if(!doc){return false;}return doc.selectSingleNode("descendant-or-self::node()[@"+this.xmlIdTag+"='"+id+"']");
};this.getNode=function(htmlNode){if(!htmlNode||!htmlNode.getAttribute(this.htmlIdTag)){return false;
}return this.getElementById(htmlNode.getAttribute(this.htmlIdTag).split("|",2).join("|"));
};this.getNodeById=function(id,doc){var q=id.split("|");q.pop();return this.getElementById(q.join("|"),doc);
};this.getDocumentById=function(id){return this.$xmlDocLut[id];};this.getDocument=function(node){return this.$xmlDocLut[node.getAttribute(this.xmlIdTag).split("|")[0]];
};this.getID=function(xmlNode,o){return xmlNode.getAttribute(this.xmlIdTag)+"|"+o.$uniqueId;
};this.getElement=function(parent,nr){var nodes=parent.childNodes;for(var j=0,i=0;
i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;}if(j++==nr){return nodes[i];
}}};this.setModel=function(model){apf.nameserver.register("model",model.data.ownerDocument.documentElement.getAttribute(this.xmlDocTag),model);
};this.findModel=function(xmlNode){return apf.nameserver.get("model",xmlNode.ownerDocument.documentElement.getAttribute(this.xmlDocTag));
};this.getXmlId=function(xmlNode){return xmlNode.getAttribute(this.xmlIdTag)||this.nodeConnect(apf.xmldb.getXmlDocId(xmlNode),xmlNode);
};this.getHtmlNode=function(xmlNode,oComp){if(xmlNode&&xmlNode.nodeType==1&&xmlNode.getAttribute(this.xmlIdTag)){return oComp.$findHtmlNode(xmlNode.getAttribute(this.xmlIdTag)+"|"+oComp.$uniqueId);
}return null;};this.findHtmlNode=function(xmlNode,oComp){do{if(xmlNode.nodeType==1&&xmlNode.getAttribute(this.xmlIdTag)){return oComp.$findHtmlNode(xmlNode.getAttribute(this.xmlIdTag)+"|"+oComp.$uniqueId);
}if(xmlNode==oComp.xmlRoot){return null;}xmlNode=xmlNode.parentNode;}while(xmlNode&&xmlNode.nodeType!=9);
return null;};this.findXmlNode=function(htmlNode){if(!htmlNode){return false;}var id;
while(htmlNode&&htmlNode.nodeType==1&&(htmlNode.tagName.toLowerCase()!="body"&&!(id=htmlNode.getAttribute(this.htmlIdTag))||(id||(id=htmlNode.getAttribute(this.htmlIdTag)))&&id.match(/^q/))){if(htmlNode.host&&htmlNode.host.$ext==htmlNode){return htmlNode.host.xmlRoot;
}htmlNode=htmlNode.parentNode;}if(!htmlNode||htmlNode.nodeType!=1){return false;
}if(htmlNode.tagName.toLowerCase()=="body"){return false;}return this.getNode(htmlNode);
};this.getXml=apf.getXml;this.nodeConnect=function(documentId,xmlNode,htmlNode,o){if(!this.$nodeCount[documentId]){this.$nodeCount[documentId]=0;
}var xmlId;xmlId=xmlNode.getAttribute(this.xmlIdTag)||xmlNode.setAttribute(this.xmlIdTag,(xmlId=documentId+"|"+ ++this.$nodeCount[documentId]))||xmlId;
if(!o){return xmlId;}var htmlId=xmlId+"|"+o.$uniqueId;if(htmlNode){htmlNode.setAttribute(this.htmlIdTag,htmlId);
}return htmlId;};this.$listeners=[null];this.addNodeListener=function(xmlNode,o,uId){if(!o||(!o.$xmlUpdate&&!o.setProperty)){throw new Error(apf.formatErrorString(1040,null,"Adding Node listener","Interface not supported."));
}var id,listen=String(xmlNode.getAttribute(this.xmlListenTag)||"");if(!uId){uId=String(o.$uniqueId);
}if(uId.charAt(0)=="p"){var sUId=uId.split("|");id=this.$listeners.push(function(args){var amlNode=apf.all[sUId[1]];
if(amlNode){var model=apf.all[sUId[3]];if(!model){return;}var xpath=model.$propBinds[sUId[1]][sUId[2]].listen;
var node=xpath?apf.queryNode(model.data,xpath):xmlNode;if(node){amlNode.$execProperty(sUId[2],node,args[3]);
}}})-1;this.$listeners[uId]=id;}else{id="e"+uId;if(!this.$listeners[id]){this.$listeners[id]=function(args){var amlNode=apf.all[uId];
if(amlNode){amlNode.$xmlUpdate.apply(amlNode,args);}};}if(xmlNode.$regbase){var lut={DOMCharacterDataModified:"text",DOMAttrModified:"attribute",DOMNodeInserted:"add",DOMNodeRemoved:"remove"};
var rFn=this.$listeners[id].rFn||(this.$listeners[id].rFn=function(e){var node=e.relatedNode&&e.relatedNode.nodeType!=1?e.relatedNode:e.currentTarget;
if(node.nodeName&&node.nodeName.substr(0,2)=="a_"){return;}var action=lut[e.name];
if(node.nodeType!=1){action=node.nodeType==2?"attribute":"text";node=node.parentNode||node.ownerElement;
}apf.xmldb.$listeners[id]([action,node,this,null,node.parentNode]);});xmlNode.addEventListener("DOMCharacterDataModified",rFn);
xmlNode.addEventListener("DOMAttrModified",rFn);xmlNode.addEventListener("DOMNodeInserted",rFn);
xmlNode.addEventListener("DOMNodeRemoved",rFn);return;}}if(!listen||listen.indexOf(";"+id+";")==-1){xmlNode.setAttribute(this.xmlListenTag,(listen?listen+id:";"+id)+";");
}return xmlNode;};this.removeNodeListener=function(xmlNode,o,id){var listen=xmlNode.getAttribute(this.xmlListenTag);
var nodes=(listen?listen.split(";"):[]);if(id&&id.charAt(0)=="p"){id=this.$listeners[id];
delete this.$listeners[id];}else{id="e"+o.$uniqueId;if(xmlNode.$regbase){var rFn=this.$listeners[id].rFn;
xmlNode.removeEventListener("DOMCharacterDataModified",rFn);xmlNode.removeEventListener("DOMAttrModified",rFn);
xmlNode.removeEventListener("DOMNodeInserted",rFn);xmlNode.removeEventListener("DOMNodeRemoved",rFn);
}}for(var newnodes=[],i=0;i<nodes.length;i++){if(nodes[i]!=id){newnodes.push(nodes[i]);
}}xmlNode.setAttribute(this.xmlListenTag,newnodes.join(";"));return xmlNode;};this.setTextNode=apf.setTextNode=function(pNode,value,xpath,undoObj,range){var tNode;
if(xpath){tNode=pNode.selectSingleNode(xpath);if(!tNode){return;}pNode=tNode.nodeType==1?tNode:null;
}if(pNode.nodeType!=1){tNode=pNode;}else{if(pNode||!tNode){tNode=pNode.selectSingleNode("text()");
if(!tNode){tNode=pNode.appendChild(pNode.ownerDocument.createTextNode(""));}}}if(undoObj&&!undoObj.$filled){undoObj.extra.oldValue=tNode.nodeValue;
undoObj.$filled=true;}if(range){undoObj.extra.range=range;}else{tNode.nodeValue=value;
if(tNode.$regbase){tNode.$setValue(value);}}this.applyChanges("text",tNode.parentNode,undoObj);
this.applyRDB(["setTextNode",pNode,value,xpath],undoObj||{xmlNode:pNode});};this.setAttribute=apf.setAttribute=function(xmlNode,name,value,xpath,undoObj,range){if(undoObj&&!undoObj.$filled){undoObj.name=name;
undoObj.$filled=true;}if(range){undoObj.extra.range=range;}else{(xpath?xmlNode.selectSingleNode(xpath):xmlNode).setAttribute(name,value);
}this.applyChanges("attribute",xmlNode,undoObj);this.applyRDB(["setAttribute",xmlNode,name,value,xpath],undoObj||{xmlNode:xmlNode});
};this.removeAttribute=apf.removeAttribute=function(xmlNode,name,xpath,undoObj){if(undoObj&&!undoObj.$filled){undoObj.name=name;
undoObj.$filled=true;}(xpath?xmlNode.selectSingleNode(xpath):xmlNode).removeAttribute(name);
this.applyChanges("attribute",xmlNode,undoObj);this.applyRDB(["removeAttribute",xmlNode,name,xpath],undoObj||{xmlNode:xmlNode});
};this.replaceNode=apf.replaceNode=function(newNode,oldNode,xpath,undoObj){if(xpath){oldNode=oldNode.selectSingleNode(xpath);
}if(oldNode.ownerDocument.importNode&&newNode.ownerDocument!=oldNode.ownerDocument){newNode=oldNode.ownerDocument.importNode(newNode,true);
}this.applyRDB(["replaceNode",oldNode,this.cleanXml(newNode.xml),xpath],undoObj||{xmlNode:oldNode});
if(undoObj&&!undoObj.$filled){undoObj.$filled=true;undoObj.oldNode=oldNode;undoObj.xmlNode=newNode;
}this.cleanNode(newNode);var parentNode=oldNode.parentNode;if(!parentNode){return;
}parentNode.replaceChild(newNode,oldNode);this.copyConnections(oldNode,newNode);
this.applyChanges("replacenode",newNode,undoObj);return newNode;};this.addChildNode=apf.addChildNode=function(pNode,tagName,attr,beforeNode,undoObj){var xmlNode=pNode.insertBefore(pNode.ownerDocument.createElement(tagName),beforeNode);
for(var i=0;i<attr.length;i++){xmlNode.setAttribute(attr[i][0],attr[i][1]);}if(undoObj&&!undoObj.$filled){undoObj.extra.addedNode=xmlNode;
undoObj.$filled=true;}this.applyChanges("add",xmlNode,undoObj);this.applyRDB(["addChildNode",pNode,tagName,attr,beforeNode],undoObj||{xmlNode:pNode});
return xmlNode;};this.appendChild=apf.appendChild=function(pNode,xmlNode,beforeNode,unique,xpath,undoObj){if(pNode==xmlNode.parentNode){return apf.xmldb.moveNode(pNode,xmlNode,beforeNode,null,xpath,undoObj);
}if(unique&&pNode.selectSingleNode(xmlNode.tagName)){return false;}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;
this.cleanNode(xmlNode);}else{this.cleanNode(xmlNode);}if(pNode.ownerDocument.importNode&&pNode.ownerDocument!=xmlNode.ownerDocument){xmlNode=pNode.ownerDocument.importNode(xmlNode,true);
}this.applyRDB(["appendChild",pNode,this.cleanXml(xmlNode.xml),beforeNode,unique,xpath],undoObj||{xmlNode:pNode});
if(xpath){var addedNodes=[];pNode=apf.createNodeFromXpath(pNode,xpath,addedNodes);
if(addedNodes.length){pNode.appendChild(xmlNode);while(addedNodes.length){if(pNode==addedNodes.pop()&&addedNodes.length){pNode=pNode.parentNode;
}}}}else{if(xmlNode.parentNode){this.removeNode(xmlNode);}}pNode.insertBefore(xmlNode,beforeNode);
this.applyChanges("add",xmlNode,undoObj);return xmlNode;};this.moveNode=apf.moveNode=function(pNode,xmlNode,beforeNode,xpath,undoObj){if(!undoObj){undoObj={extra:{}};
}undoObj.extra.oldParent=xmlNode.parentNode;undoObj.extra.beforeNode=xmlNode.nextSibling;
undoObj.extra.parent=(xpath?pNode.selectSingleNode(xpath):pNode);this.applyChanges("move-away",xmlNode,undoObj);
if(pNode.ownerDocument.importNode&&pNode.ownerDocument!=xmlNode.ownerDocument){xmlNode=pNode.ownerDocument.importNode(xmlNode,true);
}this.applyRDB(["moveNode",pNode,xmlNode,beforeNode,xpath],undoObj||{xmlNode:pNode});
undoObj.extra.parent.insertBefore(xmlNode,beforeNode);this.applyChanges("move",xmlNode,undoObj);
};this.removeNode=apf.removeNode=function(xmlNode,xpath,undoObj){if(xpath){xmlNode=xmlNode.selectSingleNode(xpath);
}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;undoObj.extra.parent=xmlNode.parentNode;
undoObj.extra.removedNode=xmlNode;undoObj.extra.beforeNode=xmlNode.nextSibling;
}this.applyRDB(["removeNode",xmlNode,xpath],undoObj||{xmlNode:xmlNode});this.applyChanges("remove",xmlNode,undoObj);
var p=xmlNode.parentNode;if(!p){return;}p.removeChild(xmlNode);this.applyChanges("redo-remove",xmlNode,null,p);
};this.removeNodeList=apf.removeNodeList=function(xmlNodeList,undoObj){this.applyRDB(["removeNodeList",xmlNodeList,null],undoObj||{xmlNode:p});
for(var rData=[],i=0;i<xmlNodeList.length;i++){if(undoObj){rData.push({pNode:xmlNodeList[i].parentNode,removedNode:xmlNodeList[i],beforeNode:xmlNodeList[i].nextSibling});
}this.applyChanges("remove",xmlNodeList[i],undoObj);var p=xmlNodeList[i].parentNode;
p.removeChild(xmlNodeList[i]);this.applyChanges("redo-remove",xmlNodeList[i],null,p);
}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;undoObj.extra.removeList=rData;
}};var notifyQueue={},notifyTimer;this.$hasQueue=false;this.applyChanges=function(action,xmlNode,undoObj,nextloop){if(undoObj&&undoObj.$dontapply){return;
}if(typeof apf.offline!="undefined"&&apf.offline.models.enabled&&apf.offline.models.realtime){var model=apf.nameserver.get("model",apf.xmldb.getXmlDocId(xmlNode));
if(model){apf.offline.models.markForUpdate(model);}}if(undoObj&&!undoObj.xmlNode){undoObj.xmlNode=xmlNode;
}var oParent=nextloop,loopNode=(xmlNode.nodeType==1?xmlNode:xmlNode.parentNode);
if(!this.delayUpdate&&"|remove|move-away|".indexOf("|"+action+"|")>-1){this.notifyQueued();
}var listen,uId,uIds,i,j,hash,info,amlNode,runTimer,found,done={};while(loopNode&&loopNode.nodeType==1){listen=loopNode.getAttribute(this.xmlListenTag);
if(listen){uIds=listen.split(";");for(i=0;i<uIds.length;i++){uId=uIds[i];if(!uId||done[uId]){continue;
}done[uId]=true;hash=notifyQueue[uId];if(!hash){notifyQueue[uId]=hash=[];}if(!apf.isO3&&"|update|attribute|text|".indexOf("|"+action+"|")>-1){found=false;
for(j=0;j<hash.length;j++){if(hash[j]&&xmlNode==hash[j][1]&&"|update|attribute|text|".indexOf("|"+hash[j][0]+"|")>-1){hash[j]=null;
found=true;continue;}}hash.push([action,xmlNode,loopNode,undoObj,oParent]);runTimer=true;
continue;}if(apf.isO3||"|remove|move-away|move|add|".indexOf("|"+action+"|")>-1){if(this.$listeners[uId]){this.$listeners[uId]([action,xmlNode,loopNode,undoObj,oParent]);
}}else{hash.push([action,xmlNode,loopNode,undoObj,oParent]);runTimer=true;}}}loopNode=loopNode.parentNode||nextloop;
if(loopNode==nextloop){nextloop=null;}}if(undoObj&&!this.delayUpdate){apf.xmldb.notifyQueued();
}else{if(runTimer){clearTimeout(notifyTimer);this.$hasQueue=true;notifyTimer=apf.setZeroTimeout(function(){apf.xmldb.notifyQueued();
});}}};this.notifyQueued=function(){this.$hasQueue=false;var myQueue=notifyQueue;
notifyQueue={};clearTimeout(notifyTimer);for(var uId in myQueue){if(!uId){continue;
}var q=myQueue[uId];var func=this.$listeners[uId];if(!q||!func){continue;}for(var i=0;
i<q.length;i++){if(!q[i]){continue;}func(q[i]);}}};this.notifyListeners=function(xmlNode){var listen=xmlNode.getAttribute(apf.xmldb.xmlListenTag);
if(listen){listen=listen.split(";");for(var j=0;j<listen.length;j++){apf.all[listen[j]].$xmlUpdate("synchronize",xmlNode,xmlNode);
}}};this.applyRDB=function(args,undoObj){if(apf.xmldb.disableRDB){return;}var xmlNode=undoObj.localName||!undoObj.xmlNode?args[1]&&args[1].length&&args[1][0]||args[1]:undoObj.xmlNode;
if(xmlNode.nodeType==2){xmlNode=xmlNode.ownerElement||xmlNode.selectSingleNode("..");
}var mdlId=apf.xmldb.getXmlDocId(xmlNode),model=apf.nameserver.get("model",mdlId);
if(!model&&apf.isO3){model=self[mdlId];}if(!model){if(!apf.nameserver.getAll("remote").length){return;
}apf.console.log("Could not find model '"+mdlId+"' for Remote DataBinding connection, not sending change");
return;}if(!model.rdb){return;}var rdb=model.rdb;if(undoObj.action){rdb.$queueMessage(args,model,undoObj);
}else{clearTimeout(rdb.queueTimer);rdb.$queueMessage(args,model,rdb);rdb.queueTimer=$setTimeout(function(){rdb.$processQueue(rdb);
});}};this.copyConnections=function(fromNode,toNode){try{toNode.setAttribute(this.xmlListenTag,fromNode.getAttribute(this.xmlListenTag));
}catch(e){}try{toNode.setAttribute(this.xmlIdTag,fromNode.getAttribute(this.xmlIdTag));
}catch(e){}};this.cleanXml=function(xml){if(typeof xml!="string"){return xml;}return xml.replace(cleanRE,"").replace(whiteRE,"><");
};this.cleanNode=function(xmlNode){try{var i,nodes=xmlNode.selectNodes("descendant-or-self::node()[@"+this.xmlListenTag+"]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute(this.xmlListenTag);}nodes=xmlNode.selectNodes("descendant-or-self::node()[@"+this.xmlIdTag+"]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute(this.xmlIdTag);}nodes=xmlNode.selectNodes("descendant-or-self::node()[@"+this.xmlDocTag+"]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute(this.xmlDocTag);}nodes=xmlNode.selectNodes("descendant-or-self::node()[@a_loaded]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute("a_loaded");}}catch(e){}return xmlNode;
};this.copy=this.getCleanCopy=apf.getCleanCopy=function(xmlNode){return apf.xmldb.cleanNode(xmlNode.cloneNode(true));
};this.unbind=function(frm){for(var lookup={},i=0;i<frm.apf.all.length;i++){if(frm.apf.all[i]&&frm.apf.all[i].unloadBindings){lookup[frm.apf.all[i].unloadBindings()]=true;
}}for(var k=0;k<this.$xmlDocLut.length;k++){if(!this.$xmlDocLut[k]){continue;}var Nodes=this.$xmlDocLut[k].selectNodes("//self::node()[@"+this.xmlListenTag+"]");
if(!Nodes){continue;}for(var i=0;i<Nodes.length;i++){var listen=Nodes[i].getAttribute(this.xmlListenTag).split(";");
for(var nListen=[],j=0;j<listen.length;j++){if(!lookup[listen[j]]){nListen.push(listen[j]);
}}if(nListen.length!=listen.length){Nodes[i].setAttribute(this.xmlListenTag,nListen.join(";"));
}}}};this.getXmlDocId=function(xmlNode,model){var docEl=xmlNode.ownerDocument.documentElement;
if(!apf.isChildOf(docEl,xmlNode)){docEl=xmlNode;}var docId=(docEl||xmlNode).getAttribute(this.xmlDocTag)||this.$xmlDocLut.indexOf(docEl||xmlNode.ownerDocument||xmlNode);
if(model&&apf.nameserver.get("model",docId)!=model){docId=null;docEl=xmlNode;}if(!docId||docId==-1){docId=this.$xmlDocLut.push(docEl||xmlNode.ownerDocument||xmlNode)-1;
if(docEl){docEl.setAttribute(this.xmlDocTag,String(docId));}}if(model){apf.nameserver.register("model",docId,model);
}return docId;};});apf.draw.canvas={initRoot:function(r){var canvas=document.createElement("canvas");
canvas.setAttribute("width",r.canvaswidth=r.width);canvas.setAttribute("height",r.canvasheight=r.height);
canvas.className="canvas";r.$int.appendChild(canvas);r.canvaselem=canvas;r.canvas=canvas.getContext("2d");
r.canvas.translate(0.5,0.5);r.imgcache={};return this;},resizeRoot:function(r){r.canvaselem.setAttribute("width",r.width);
r.canvaselem.setAttribute("height",r.height);for(var n=r.canvaselem.nextSibling;
n!=null;n=n.nextSibling){n.style.width=r.width+"px",n.style.height=r.height+"px";
}},initLayer:function(l,r){l.imgcache=r.imgcache;l.canvas=r.canvas;l.textroot=r.$int;
l.dx=l.left;l.dy=l.top;l.dw=l.width;l.dh=l.height;l.ds=1;l._styles=[];l._htmljoin=[];
return this;},resizeLayer:function(l,r){l.dx=l.left;l.dy=l.top;l.dw=l.width;l.dh=l.height;
},destroyLayer:function(l){},beginLayer:function(l){this.l=l,this.mx="",this.my="",this.last=null;
this.tiletrans=0;this.dodraw=0;if(l._styles.length){for(var j=l._styles.length,i=0;
i<j;i++){var s=l._styles[i];if(s._txtnode){s._txtnode.removeNode();}}l._styles=[];
l._htmljoin=[];}var s=["if(!l._styles)_initStyles();","var _c=l.canvas,_styles=l._styles,","_s1,_s2,_s3,_s4,_s5,_s6,_s7,_s8,_s9,","_x1,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10,","_y1,_y2,_y3,_y4,_y5,_y6,_y7,_y8,_y9,_y10,","_s,_sh,_sp,_sl,_sv,_su,_st,_dx,_dy,_td,_l,_lc,","_tc,_cv,_t,_u,_r,_q,_o,_m,_sr,_cr;"];
if(l.dx!=0){s.push("_c.save();_c.beginPath();_c.translate(l.dx,l.dy);","_c.moveTo(0,0);_c.lineTo(l.dw,0);_c.lineTo(l.dw,l.dh);","_c.lineTo(0,l.dh);_c.closePath();_c.clip();\n");
}return s.join("");},clear:function(){var l=this.l;var s=["_c.clearRect(l.dx,l.dy,l.dw,l.dh);\n"];
return s.join("");},endLayer:function(){var l=this.l;var s=[this.$endDraw()];var p=[];
var i=0,j=0,style,len=l._styles.length;for(;i<len;i++){style=l._styles[i];if(style._prev===undefined&&style.isfont){p.push("_styles[",i,"]={","_domnode:_n=l.textroot.childNodes[b+",j,"]",',_txtused:0,_txtcount:0,_txtnodes:[],_txtdiv:"',style._txtdiv,'"');
s.push(this.$finalizeFont(style));p.push("};");j++;}else{p.push("_styles[",i,"]={");
if(style.$stylelist){p.push(apf.draw.serializeStyleState(style));}p.push("};");
}}s.push(["l._anim = _anim;","function _initStyles(){","var _n, _styles = l._styles = [], b=l.textroot.childNodes.length;","l.textroot.insertAdjacentHTML('beforeend', \"",l._htmljoin.join(""),'");',p.join(""),"}"].join(""));
if(l.dx!=0){s.push("_c.restore();");}l._styles=null;this.l=null;return s.join("");
},beginShape:function(style,ml,mt,mr,mb){var pstyle=(this.style&&this.style.isshape)?this.style:{fill:"-",gradient:"-",angle:"-",stroke:"-",fillopacity:"-",strokeopacity:"-",weight:"-"};
var s=[this.$endDraw(),"_c.beginPath();"],l=this.l;this.style=style;if(style._id===undefined){style._id=l._styles.push(style)-1;
}s.push("_s=_styles[",style._id,"];");if(ml!==undefined&&ml!=""){this._clip=1;s.push("_c.save();_c.moveTo(",ml,",",mt,");_c.lineTo(l.dw-",mr,",",mt,");_c.lineTo(l.dw-",mr,",l.dh-",mb,");","_c.lineTo(",mt,",l.dh-",mb,");_c.closePath();_c.clip();","_c.beginPath();\n");
}else{this._clip=0;}var a,g,i,fillmode=0,fill=style.fill;if(style.tile!==undefined){var tilemove="";
if(style.tilex||style.tiley){tilemove=["_dx=__round(",(style.tilex||"0"),")%((_s._img&&_s._img.width)?_s._img.width:1),","_dy=__round(",(style.tiley||"0"),")%((_s._img&&_s._img.height)?_s._img.height:1);","_c.save();_c.translate(-_dx,-_dy);"].join("");
this.tiletrans=1,this.mx="+_dx",this.my="+_dy";}fillmode|=1;if(this.isDynamic(style.tile)){if(apf.isGecko&&style.fillopacity!=1){if(this.isDynamic(style.fillopacity)){s.push("if(!(_u=l.imgcache[_t=",style.tile,"])){","l.imgcache[_t]=_u=new Image();","_u.onload=function(){","_u._canvas = document.createElement('canvas');","_u._canvas.setAttribute('width', _u.width);","_u._canvas.setAttribute('height', _u.height);","_u._ctx = _u._canvas.getContext('2d');","_u.onload=null;","};","_u.src=_t;","}","if(_u && !_u.onload && _u._opacity !== (_q=",style.fillopacity,")){","_u._ctx.clearRect(0,0,_u.width,_u.height);","_u._ctx.globalAlpha=_u._opacity=_q;","_u._ctx.drawImage(_u,0,0);","_s._pattern=l.canvas.createPattern(_u._canvas,","'repeat');","}","if(_t=_s._pattern)_c.fillStyle=_t;\n",tilemove);
}else{s.push("if(!(_u=l.imgcache[_t=",style.tile,"])){","l.imgcache[_t]=_u=new Image();","_u.onload=function(){","_u._canvas = document.createElement('canvas');","_u._canvas.setAttribute('width', _u.width);","_u._canvas.setAttribute('height', _u.height);","_u._ctx = _s._canvas.getContext('2d');","_u._ctx.globalAlpha="+style.fillopacity+";_u._ctx.drawImage(_u,0,0);","_u._pattern=l.canvas.createPattern(_u._canvas,'repeat');","_u.onload=null;","};","_u.src=_t;","}","if(_u && !_u.onload && _u!=_s._img){","_s._img=_u,_s.pattern=_u._pattern;","}","if(_t=_s._pattern)_c.fillStyle=_t;\n",tilemove);
}}else{s.push("if(!(_u=l.imgcache[_t=",style.tile,"])){","l.imgcache[_t]=_u=new Image();","_u.onload=function(){","_u.onload=null;","_u._pattern=l.canvas.createPattern(_u,'repeat');","};","_u.src=_t;","}","if(_u && !_u.onload && _u!=_s._img){","_s._img=_u,_s.pattern=_u._pattern;","}","if(_t=_s._pattern)_c.fillStyle=_t;\n",tilemove);
}}else{if(l.imgcache[style.tile]){style._pattern=l.canvas.createPattern(l.imgcache[style.tile],"repeat");
}else{var img=new Image();img.onload=function(){style._img=img;if(apf.isGecko&&style.fillopacity!=1){style._canvas=document.createElement("canvas");
style._canvas.setAttribute("width",img.width);style._canvas.setAttribute("height",img.height);
style._ctx=style._canvas.getContext("2d");if(!apf.draw.isDynamic(style.fillopacity)){style._ctx.globalAlpha=style.fillopacity;
style._ctx.drawImage(img,0,0);}style._pattern=l.canvas.createPattern(style._canvas,"repeat");
}else{style._pattern=l.canvas.createPattern(style._img=this,"repeat");}};if(apf.isGecko&&this.isDynamic(style.fillopacity)){s.push("if(_s._ctx){","_s._ctx.clearRect(0,0,_s._img.width,_s._img.height);","_s._ctx.globalAlpha=",style.fillopacity,";","_s._ctx.drawImage(_s._img,0,0);","_s._pattern=l.canvas.createPattern(_s._canvas,","'repeat');}\n");
}img.src=style.tile;}s.push("if(_t=(_s._pattern))_c.fillStyle=_t;",tilemove);}}else{if(fill!==undefined){fillmode|=1;
if(fill.sort&&fill.length<=1){fill=fill.length&&fill[0]?fill[0]:"black";}if(fill.sort){var f=fill,len=f.length;
for(i=0;i<len&&!this.isDynamic(fill[i]);i++){}if(i!=len||this.isDynamic(style.angle)||this.isDynamic(style.fillopacity)){s.push("_o=",style.fillopacity,",_r=",style.gradopacity,",_t=_s._colors,_m=0;");
for(i=0;i<len;i++){if(this.isDynamic(fill[len-i-1])){s.push("if(_t[",i,"]!=(_l=[","'rgba(',(((_q=parseInt((",this.getColor(fill[len-i-1]),").slice(1),16))>>16)&0xff),","',',((_q>>8)&0xff),',',(_q&0xff),',',","(",i/(len-1),"*_o+",1-(i/(len-1)),"*_r)",",')'].join(''))",")_t[",i,"]=_l,_m=1;");
}else{var t=parseInt((this.colors[fill[len-i-1].toLowerCase()]||fill[len-i-1]).slice(1),16);
s.push("if(_t[",i,"]!=(_l=","['rgba(",(t>>16)&255,",",(t>>8)&255,",",t&255,",',","(",i/(len-1),"*_o+",1-(i/(len-1)),"*_r),')'].join(''))",")_t[",i,"]=_l,_m=1;");
}}s.push("if(_s._angle!=(_u=(",style.angle,")*2*p) || _m){","_s._grad=_q=_c.createLinearGradient(","dtx+(__sin(_s._angle=_u)*0.5+0.5)*dw,","dty+(__cos(_u)*0.5+0.5)*dh,","dtx+(__sin(p+_u)*0.5+0.5)*dw,","dty+(__cos(p+_u)*0.5+0.5)*dh);");
for(i=0;i<len;i++){s.push("_q.addColorStop(",i/(len-1),",_t[",i,"]);");}s.push("_c.fillStyle=_q;}else _c.fillStyle=_s._grad;\n");
style._colors=[];}else{var g=l.canvas.createLinearGradient((Math.sin(style.angle)*0.5+0.5)*l.dw,(Math.cos(style.angle)*0.5+0.5)*l.dh,(Math.sin(Math.PI+style.angle)*0.5+0.5)*l.dw,(Math.cos(Math.PI+style.angle)*0.5+0.5)*l.dh);
var u,o=style.fillopacity,r=style.gradopacity;for(i=0;i<len;i++){a=this.colors[a=fill[len-i-1].toLowerCase()]||fill[len-i-1];
g.addColorStop(u=i/(len-1),"rgba("+(((a=parseInt(a.slice(1),16))>>16)&255)+","+((a>>8)&255)+","+((a)&255)+","+(u*o+(1-u)*r)+")");
}style._gradient=g;s.push("_c.fillStyle=_styles[",style._id,"]._gradient;");}}else{if(this.isDynamic(fill)||pstyle.fill!=fill){s.push("_c.fillStyle=",this.getColor(fill),";");
}}}}if(style.stroke!==undefined){fillmode|=2;if(this.isDynamic(style.stroke)||pstyle.stroke!=style.stroke){s.push("_c.strokeStyle=",this.getColor(style.stroke),";");
}if(this.isDynamic(style.weight)||pstyle.weight!=style.weight){s.push("_c.lineWidth=",style.weight,";");
}}this.fillopacity="";this.strokeopacity="";this.fillmode=fillmode;switch(fillmode){case 3:if(style.fillopacity!=style.strokeopacity){this.fillopacity="_c.globalAlpha="+style.fillopacity+";";
this.strokeopacity="_c.globalAlpha="+style.strokeopacity+";";}else{if(this.isDynamic(style.fillopacity)||style.fillopacity!=pstyle.fillopacity){s.push("_c.globalAlpha=",style.fillopacity,";");
}}break;case 2:if(this.isDynamic(style.strokeopacity)||style.strokeopacity!=pstyle.strokeopacity){s.push("_c.globalAlpha=",style.strokeopacity,";");
}break;case 1:if(this.isDynamic(style.fillopacity)||style.fillopacity!=pstyle.fillopacity){s.push("_c.globalAlpha=",style.fillopacity,";");
}break;}return s.join("");},moveTo:function(x,y){return"_c.moveTo("+x+this.mx+","+y+this.my+");\n";
},lineTo:function(x,y){this.dodraw=1;return"_c.lineTo("+x+this.mx+","+y+this.my+");\n";
},lineH:function(x,y,w){this.dodraw=1;return["_c.moveTo(",x,this.mx,",",y,this.my,");","_c.lineTo(",x,this.mx,"+",w,",",y,this.my,");\n"].join("");
},lineV:function(x,y,h){this.dodraw=1;return["_c.moveTo(",x,this.mx,",",y,this.my,");","_c.lineTo(",x,this.mx,",",y,this.my,"+",h,");\n"].join("");
},dot:function(x,y){this.dodraw=1;return["_c.moveTo(",x,this.mx,",",y,this.my,");","_c.lineTo(",x,this.mx,",",y,this.my,");\n"].join("");
},circle:function(x,y,r,s,e,c){this.dodraw=1;if(!s){s="0";}if(!e){e="p";}c=c?1:0;
return["_c.arc(",x,",",y,",",r,",",s,",",e,",",c,");"].join("");},ellipse:function(x,y,w,h,s,e,c){this.dodraw=1;
if(!s){s="0";}if(!e){e="p2";}c=c?1:0;return["if((_x2=(",w,"))!=0 && (_y2=-(",h,"))!=0){_c.translate(_x1=(",x,"),_y1=(",y,"));_c.scale(_x2,_y2);","_c.arc(0,0,1,(",s,")-1.5707965,(",e,")-1.5707965,",!c,");_c.scale(1/_x2,1/_y2);_c.translate(-_x1,-_y1);}"].join("");
},rect:function(x,y,w,h){switch(this.fillmode){case 3:return this.fillopacity+"_c.fillRect(_x1="+x+this.mx+",_y1="+y+this.my+",_x2="+w+",_y2="+h+");"+this.strokeopacity+"_c.strokeRect(_x1,_y1,_x2,_y2);";
case 2:return"_c.strokeRect("+x+this.mx+","+y+this.my+","+w+","+h+");\n";case 1:return"_c.fillRect("+x+this.mx+","+y+this.my+","+w+","+h+");\n";
}},close:function(){return["_c.closePath();",this.$dodraw()].join("");},$dodraw:function(){this.dodraw=0;
switch(this.fillmode){case 3:return this.fillopacity+"_c.fill();"+this.strokeopacity+"_c.stroke();_c.beginPath();\n";
case 2:return"_c.stroke();_c.beginPath();\n";case 1:return"_c.fill();_c.beginPath();\n";
}},$endShape:function(){var s=this.dodraw?[this.$dodraw()]:[];this.mx="",this.my="";
this.last=this.style._id;this.style=0;if(this.tiletrans){s.push("_c.restore();");
}this.tiletrans=0;if(this._clip){s.push("_c.restore();");}this._clip=0;return s.join("");
},$finalizeShape:function(){return"";}};apf.chart_draw={_axis2D:{margin:{left:30,top:30,right:30,bottom:30,$:1},layout:{pow:10,step:4,onsidex:0,onaxisx:0,onsidey:1,onaxisy:0,$:1},plane:{inherit:"shape",stroke:"#cfcfcf",fill:"#e6f1f8",$:1},plane2:{inherit:"shape",$:1},label:{inherit:"font",join:"label",left:0,top:0,format:"fixed(v,1)",$:0},labelx:{inherit:"label",width:40,top:5,left:-19,side:0,axis:0,edgeclip:2,align:"center",$:1},labely:{inherit:"label",left:-110,top:-6,width:100,side:1,edgeclip:0,align:1?"right":"left",$:1},grid:{inherit:"shape",join:"grid",extend:0,$:0},hgrid:{inherit:"grid",$:1},vgrid:{inherit:"grid",$:1},tiles:{inherit:"shape",join:"tiles",fill:"#dfe7f5",$:1},bar:{inherit:"shape",join:"bar",$:0},hbar:{inherit:"bar",$:1},vbar:{inherit:"bar",$:1},axis:{inherit:"shape",join:"grid",stroke:"black",weight:1,extend:2,$:0},axisx:{inherit:"axis",$:1},axisy:{inherit:"axis",$:1},tick:{inherit:"shape",join:"grid",steps:5,left:0,top:0,size:4,stroke:"#000000",$:0},tickx:{inherit:"tick",$:1},ticky:{inherit:"tick",$:1},tickgx:{inherit:"tick",weight:2,size:6,$:1},tickgy:{inherit:"tick",weight:2,size:6,$:1}},axis2D:function(l,s){var e=apf.draw;
if(!s.margin||!s.layout){return new Function("");}var ml=s.margin.left*l.ds,mt=s.margin.top*l.ds,mr=s.margin.right*l.ds,mb=s.margin.bottom*l.ds;
var c=e.optimize([e.beginLayer(l),e.vars(ml,mt,mr,mb),e.clear(),"var v,d,u,h,","vcx = 0.5*__pow(",s.layout.pow,", __round(__log(__abs(vw)/",s.layout.pow,")/__log(",s.layout.pow,")))*",s.layout.step,",","vcy = 0.5*__pow(",s.layout.pow,", __round(__log(__abs(vh)/",s.layout.pow,")/__log(",s.layout.pow,")))*",s.layout.step,",","vbx = __ceil(vx1/vcx) * vcx,","vby = __ceil(vy1/vcy) * vcy,","vex = __floor(vx2/vcx) * vcx,","vey = __floor(vy2/vcy) * vcy,","dcx = vcx*tw, dcy = vcy*th,","dbx = vbx*tw+tx, dby = vby*th+ty,","dex = vex*tw+tx, dey = vey*th+ty,","dcx2 = dcx*2, dcy2 = dcy*2,","dbx2 = __ceil(vx1/(2*vcx))*2*vcx*tw+tx,","dex2 = __floor(vx2/(2*vcx))*2*vcx*tw+tx,","dby2 = __floor(vy1/(2*vcy))*2*vcy*th+ty,","dey2 = __floor(vy2/(2*vcy))*2*vcy*th+ty;","var xmaxstep = __ceil( (dex-dbx)/dcx )+4,","ymaxstep = __ceil( (dey-dby)/dcy )+4;",s.plane?[e.beginShape(s.plane),e.rect(ml,mt,"dw","dh")].join(""):"",s.tiles?[e.rectInv?[e.beginShape(s.tiles),"if((u=dbx2-dcx-",ml,")>0){",e.rectInv(ml,mt,"u","dh"),"}","for( v = dbx2, u  = dex-dcx; v < u; v += dcx2){",e.rectInv("v",mt,"dcx","dh"),"};","if((u=dr-v)>0){",e.rectInv("v",mt,"__min(dcx,u)","dh"),"}","if((u=dey2+dcy-",mt,")>0){",e.rectInv(ml,mt,"dw","u"),"}","for( v = dey2,u = dby+dcy; v < u; v -= dcy2){",e.rectInv(ml,"v","dw","-dcy"),"};","if((u=db-v)>0){",e.rectInv(ml,"v","dw","__min(-dcy,u)"),"}"].join(""):[e.beginShape(s.tiles,ml,mt,mr,mb),"for( u = dey2+dcy2, t = dby2-dcy2; u <= t; u -= dcy2){","for( v = dbx2-dcx2, d = dex2+dcx2; v <= d; v += dcx2){",e.rect("v+dcx","u","dcx","-dcy"),e.rect("v","u-dcy","dcx","-dcy"),"};","}"].join("")].join(""):"",s.vbar?[e.beginShape(s.vbar),"if((u=dbx2-dcx-",ml,")>0){",e.rect(ml,mt,"u","dh"),"}","for( v = dbx2, u  = dex-dcx; v < u; v += dcx2){",e.rect("v",mt,"dcx","dh"),"};","if((u=dr-v)>0){",e.rect("v",mt,"__min(dcx,u)","dh"),"}"].join(""):"",s.hbar?[e.beginShape(s.hbar),"if((u=dey2+dcy-",mt,")>0){",e.rect(ml,mt,"dw","u"),"}","for( v = dey2, u = dby+dcy; v < u; v -= dcy2){",e.rect(ml,"v","dw","-dcy"),"};","if((u=db-v)>0){",e.rect(ml,"v","dw","__min(-dcy,u)"),"}"].join(""):"",s.tickx?[e.beginShape(s.tickx),"u = ",s.layout.onaxisx?("ty+"+(s.tickx.top*l.ds)):(s.layout.onsidex?s.tickx.size*-l.ds+ml:("db")),";","t = dcx/",s.tickx.steps,";","h = ",s.tickx.size*l.ds,";",s.layout.onaxisx?["if(u+h>",mt," && u<dh+",mb,"){","if(u<dy)h=h-(dy-u),u=dy;","if(u+h>db)h=db-u;"].join(""):"","x = dbx-dcx;while(x<dx)x+=t;","for(; x < dr; x += t){",e.lineV("x","u","h"),"};",s.layout.onaxisx?"}":"",].join(""):"",s.ticky?[e.beginShape(s.ticky),"t = dcy/",s.ticky.steps,";","u = ",s.layout.onaxisy?("tx+"+s.ticky.left*l.ds):(s.layout.onsidey?s.ticky.size*-l.ds+mt:"dr"),";","h = ",s.ticky.size*l.ds,";",s.layout.onaxisy?["if(u+h>dx && u<dr){","if(u<dx)h=h-(dx-u),u=dx;","if(u+h>dr)h=dr-u;"].join(""):"","y = dey+dcy;while(y<dy)y-=t;","for(; y < db; y -= t){",e.lineH("u","y","h"),"};",s.layout.onaxisy?"}":"",].join(""):"",s.hgrid?[e.beginShape(s.hgrid),"t=dw+",s.hgrid.extend*l.ds,";","u=",(s.hgrid.extend*l.ds*-s.layout.onsidey)+ml,";","for(y = dby; y >= dy; y += dcy){",e.lineH("u","y","t"),"};"].join(""):"",s.vgrid?[e.beginShape(s.vgrid),"t=dh+",s.vgrid.extend*l.ds,";","u=",(s.vgrid.extend*l.ds*-s.layout.onsidex)+mt,";","for(x = dbx; x <= dr; x += dcx){",e.lineV("x","u","t"),"};"].join(""):"",s.tickgx?[e.beginShape(s.tickgx),"u = ",s.layout.onaxisx?("ty+"+s.tickgx.top*l.ds):(s.layout.onsidex?s.tickgx.size*-l.ds+ml:("db")),";","h = ",s.tickgx.size*l.ds,";",s.layout.onaxisx?["if(u+h>dy && u<db){","if(u<dy)h=h-(dy-u),u=dy;","if(u+h>db)h=db-u;"].join(""):"","for(v=dbx; v <= dr; v += dcx){",e.lineV("v","u","h"),"};",s.layout.onaxisx?"}":"",].join(""):"",s.tickgy?[e.beginShape(s.tickgy),"u = ",s.layout.onaxisy?("tx+"+s.tickgy.left*l.ds):(s.layout.onsidey?s.tickgy.size*-l.ds+mt:"dr"),";","h = ",s.tickgy.size*l.ds,";",s.layout.onaxisy?["if(u+h>dx && u<dr){","if(u<dx)h=h-(dx-u),u=dx;","if(u+h>dr)h=dr-u;"].join(""):"","for(v=dby; v >= dy; v += dcy){",e.lineH("u","v","h"),"};",s.layout.onaxisy?"}":"",].join(""):"",s.axisx?[e.beginShape(s.axisx),"if(ty>=dy && ty<=dy+dh){","t=dw+",s.axisx.extend*l.ds,";","u=dx+",(s.axisx.extend*l.ds*-s.layout.onsidey),";",e.lineH("u","ty","t"),"}"].join(""):"",s.axisy?[e.beginShape(s.axisy),"if(tx>=dx && tx<=dx+dw){","t=dh+",s.axisy.extend*l.ds,";","u=dy+",(s.axisy.extend*l.ds*-s.layout.onsidex),";",e.lineV("tx","u","t"),"}"].join(""):"",s.plane2?[e.beginShape(s.plane2),e.rect(ml,mt,"dw","dh")].join(""):"",s.labelx?[s.layout.onaxisx?e.beginFont(s.labelx,"xmaxstep",ml,mt,mr,mb):e.beginFont(s.labelx,"xmaxstep",ml-s.labelx.edgeclip*l.ds,0,mr-s.labelx.edgeclip*l.ds,0),"for( v = vbx, u = vex,d = dbx; v <= u; v+= vcx, d+= dcx ){",e.text("d",s.layout.onaxisx?"ty":(s.layout.onsidex?"dy":"db"),s.labelx.format),"}"].join(""):"",s.labely?[s.layout.onaxisy?e.beginFont(s.labely,"ymaxstep",ml,mt,mr,mb):e.beginFont(s.labely,"ymaxstep",0,mt-s.labely.edgeclip*l.ds,0,mb-s.labely.edgeclip*l.ds),"for( v = vby, u = vey,d = dby;v<= u; v+= vcy, d+= dcy ){;",e.text(s.layout.onaxisy?"tx":(s.layout.onsidey?"dx":"dr"),"d",s.labelx.format),"}"].join(""):"",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert("Failed to compile:\n"+x.message+"\n"+c);
return 0;}},_axis3D:{layout:{pow:10,step:4,$:1},plane:{inherit:"shape",side:1,oneside:0,fill:"#e6f1f8",$:0},plane2:{inherit:"shape",$:1},planexy:{inherit:"plane",$:1},planexz:{inherit:"plane",$:1},planeyz:{inherit:"plane",$:1},bar:{inherit:"shape",join:"bar",oneside:0,$:0},hbar:{side:1,inherit:"bar",stroke:"#cfcfcf",$:0},vbar:{side:1,inherit:"bar",stroke:"#cfcfcf",fill:"blue",opacity:0.25,$:0},hbarxy:{inherit:"hbar",$:1},vbarxy:{inherit:"vbar",$:1},hbarxz:{inherit:"hbar",stroke:"black",opacity:0.25,$:1},vbarxz:{inherit:"vbar",fill:"#e6f1f8",stroke:"black",$:1},hbaryz:{inherit:"hbar",fill:"#blue",opacity:0.25,$:1},vbaryz:{inherit:"vbar",stroke:"black",opacity:0.25,fill:null,$:1},axis:{inherit:"shape",join:"grid",stroke:"black",opacity:0.5,weight:3,$:0},axisx:{inherit:"axis",$:1},axisy:{inherit:"axis",$:1},axisz:{inherit:"axis",$:1},tick:{inherit:"shape",join:"grid",steps:5,size:4,scale:0.1,angle:"ang(180)",stroke:"#000000",$:0},tickx:{inherit:"tick",angle:"ang(90+f1*90)",$:1},ticky:{inherit:"tick",angle:"ang(90+f2*90)",$:1},tickz:{inherit:"tick",$:1},label:{inherit:"font",join:"label",width:40,height:40,left:-20,top:"fontz(-5,200)",size:"fontz(10,200)",scale:0.2,stroke:null,angle:"ang(180)",format:"fixed(v,1)",$:0},labelx:{inherit:"label",angle:"ang(90+f1*90)",align:"center",$:1},labely:{inherit:"label",angle:"ang(90+f2*90)",align:"center",$:1},labelz:{inherit:"label",align:"center",$:1},$:0},chartView3D:function(l,e){return["var s3x=v.x3d/vw,s3xi=1/s3x,s3y=v.y3d/vh,s3yi=1/s3y,s3z=v.z3d/vd,s3zi=1/s3z;",e.sincos3("_m","v.rx","v.ry","v.rz"),e.setMatrix3D(e.matrixMul(e.matrix4T("(-0.5*vx1-0.5*vx2)","(-0.5*vy1-0.5*vy2)","(-0.5*vz1-0.5*vz2)"),e.matrix4S("s3x","s3y","s3z"),e.matrix4RP("_m"),e.matrix4T("v.tx","v.ty","v.tz")))].join("");
},axis3D:function(l,s){if(!s.layout){return new Function("");}var e=apf.draw;var dt=(new Date()).getTime();
var zclip=-0.01;function drawPlane(pr,fl,z1,z2,side,vx1,vx2,vbx,vex,vbx2,vex2,vcx,vcx2,vy1,vy2,vby,vey,vby2,vey2,vcy,vcy2){function plane(z){return e.poly3DClip([0,1,2,3],[[vx1,vy1,z],[vx1,vy2,z],[vx2,vy2,z],[vx2,vy1,z]],fl,zclip);
}function hbar(z){return["if((u=(",vbx2,"-",vcx,")-",vx1,")<",vcx," && u>0){",e.poly3DClip([0,1,2,3],[[vx1,vy1,z],["("+vx1+"+u)",vy1,z],["("+vx1+"+u)",vy2,z],[vx1,vy2,z]],fl,zclip),"}","for( v = ",vbx2,", u  = ",vex2,"-0.000001; v < u; v += ",vcx2,"){",e.poly3DClip([0,1,2,3],[["v",vy1,z],["(v+"+vcx+")",vy1,z],["(v+"+vcx+")",vy2,z],["v",vy2,z]],fl,zclip),"};","if( v<",vx2," ){",e.poly3DClip([0,1,2,3],[["v",vy1,z],["(u="+e.min("v+"+vcx,vx2)+")",vy1,z],["u",vy2,z],["v",vy2,z]],fl,zclip),"}"].join("");
}function vbar(z){return["if((u=(",vby2,"-",vcy,")-",vy1,")<",vcy," && u>0){",e.poly3DClip([0,1,2,3],[[vx1,vy1,z],[vx1,"("+vy1+"+u)",z],[vx2,"("+vy1+"+u)",z],[vx2,vy1,z]],fl,zclip),"}","for( v = ",vby2,", u  = ",vey2,"-0.000001; v < u; v += ",vcy2,"){",e.poly3DClip([0,1,2,3],[[vx1,"v",z],[vx1,"(v+"+vcy+")",z],[vx2,"(v+"+vcy+")",z],[vx2,"v",z]],fl,zclip),"};","if( v<",vy2," ){",e.poly3DClip([0,1,2,3],[[vx1,"v",z],[vx1,"(u="+e.min("v+"+vcy,vy2)+")",z],[vx2,"u",z],[vx2,"v",z]],fl,zclip),"}"].join("");
}return["s1=-(",e.backface3D([[vx1,vy1,z1],[vx1,vy2,z1],[vx2,vy1,z1]],fl),");","s2=",e.backface3D([[vx1,vy1,z2],[vx1,vy2,z2],[vx2,vy1,z2]],fl),";","s",pr,"=s1*",side,">=s2*",side,";",s["plane"+pr]?[e.beginShape(s["plane"+pr]),"sa = s1*",e.style.side*side,";","sb = s2*",e.style.side*side,";",e.style.oneside?"if(sa>=sb)sb = -1;if(sb>=sa)sa = -1;":"","for(i=1;i>=0;i--){if((i?sa:sb)>=0){z=i?",z1,":",z2,";",plane("z"),"}};",].join(""):"",s["hbar"+pr]?[e.beginShape(s["hbar"+pr]),"sa = s1*",e.style.side*side,";","sb = s2*",e.style.side*side,";",e.style.oneside?"if(sa>=sb)sb = -1;if(sb>=sa)sa = -1;":"","for(i=1;i>=0;i--){if((i?sa:sb)>=0){z=i?",z1,":",z2,";",hbar("z"),"}};"].join(""):"",s["vbar"+pr]?[e.beginShape(s["vbar"+pr]),"sa = s1*",e.style.side*side,";","sb = s2*",e.style.side*side,";",e.style.oneside?"if(sa>=sb)sb = -1;if(sb>=sa)sa = -1;":"","for(i=1;i>=0;i--){if((i?sa:sb)>=0){z=i?",z1,":",z2,";",vbar("z"),"}};"].join(""):"",s["plane2"+pr]?[e.beginShape(s["plane2"+pr]),e.poly3DClip([0,1,2,3],[[vx1,vy1,z1],[vx2,vy1,z1],[vx2,vy2,z1],[vx1,vy2,z1]],fl,zclip),].join(""):""].join("");
}function drawAxis(pr,fl,z1,z2,side1,side2,us,ws,wind,vx1,vx2,vbx,vex,vbx2,vex2,vcx,vcx2,vy1,vy2,vby,vey,vby2,vey2,vcy,vcy2){var zclip=-1,sider,sd;
if(s["axis"+pr]){if((sd=s["axis"+pr].side1)!==undefined){side1=sd;}if((sd=s["axis"+pr].side2)!==undefined){side2=sd;
}}var sideloop=["for(i=0;i<4;i++)if((i&2?(",side2,"?((f1=0,c=1,y=",vy1,"),1):0):(",side2,"?0:((f1=1,c=-1,y=",vy2,"),1)))&&","(i&1?(",side1,"?((f2=0,d=1,z=",z1,"),1):0):(",side1,"?0:((f2=1,d=-1,z=",z2,"),1))))"].join("");
return[s["axis"+pr]?[e.beginShape(s["axis"+pr]),sideloop,"{",e.poly3DClip([0,1],[[vx1,"y","z"],[vx2,"y","z"]],fl,zclip,true),"};"].join(""):"",s["tick"+pr]?[e.beginShape(s["tick"+pr]),sideloop,"{",";u=y+",us,"*__sin(f=(",e.style.angle,")*",wind,")*(",e.style.scale,")*c;w=z+",ws,"*__cos(f)*(",e.style.scale,")*d;","for(v=",vbx,";v<=",vex,";v+=",vcx,"){",e.poly3DClip([0,1],[["v","y","z"],["v","u","w"]],fl,zclip,true),"};","};"].join(""):"",s["label"+pr]?[e.beginFont(s["label"+pr],["__ceil(((",vex,")-(",vbx,"))/(",vcx,"))*2"].join("")),sideloop,"{",";u=y+",us,"*__sin(f=(",e.style.angle,")*",wind,")*(",e.style.scale,")*c;w=z+",ws,"*__cos(f)*(",e.style.scale,")*d;","for(v=",vbx,";v<=",vex,";v+=",vcx,"){",e.text3D(["v","u","w"],fl,zclip,e.style.format),"}","}"].join(""):"",].join("");
}var c=e.optimize([e.beginLayer(l),e.vars(),this.chartView3D(l,e),e.defCamVec(),e.clear(),"var v,d,c,u,h,w,f1,f2,","vcx = 0.5*__pow(",s.layout.pow,", __round(__log(__abs(vw)/",s.layout.pow,")/__log(",s.layout.pow,")))*",s.layout.step,",","vcy = 0.5*__pow(",s.layout.pow,", __round(__log(__abs(vh)/",s.layout.pow,")/__log(",s.layout.pow,")))*",s.layout.step,",","vcz = 0.5*__pow(",s.layout.pow,", __round(__log(__abs(vd)/",s.layout.pow,")/__log(",s.layout.pow,")))*",s.layout.step,",","vbx = __ceil(vx1/vcx) * vcx,","vby = __ceil(vy1/vcy) * vcy,","vbz = __ceil(vz1/vcz) * vcz,","vex = __floor(vx2/vcx) * vcx,","vey = __floor(vy2/vcy) * vcy,","vez = __floor(vz2/vcz) * vcz,","vcx2 = vcx*2, vcy2 = vcy*2, vcz2 = vcz*2,","vbx2 = __ceil(vx1/vcx2)*vcx2,","vex2 = __floor(vx2/vcx2)*vcx2,","vby2 = __ceil(vy1/vcy2)*vcy2,","vey2 = __floor(vy2/vcy2)*vcy2,","vbz2 = __ceil(vz1/vcz2)*vcz2,","vez2 = __floor(vz2/vcz2)*vcz2,","s1, s2, sa, sb, sxy, sxz, syz;","var xmaxstep = __ceil( (vex-vbx)/vcx )+4,","ymaxstep = __ceil( (vey-vby)/vcy )+4,","zmaxstep = __ceil( (vez-vbz)/vcz )+4;",drawPlane("xy",[0,1,2],"vz1","vz2",1,"vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2","vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2"),drawPlane("xz",[0,2,1],"vy1","vy2",-1,"vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2","vz1","vz2","vbz","vez","vbz2","vez2","vcz","vcz2"),drawPlane("yz",[2,0,1],"vx1","vx2",1,"vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2","vz1","vz2","vbz","vez","vbz2","vez2","vcz","vcz2"),drawAxis("x",[0,1,2],"vz1","vz2","sxy","sxz","s3yi","s3zi",1,"vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2","vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2"),drawAxis("y",[1,0,2],"vz1","vz2","sxy","syz","s3xi","s3zi",-1,"vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2","vx1","vx2","vbx","vex","vbx2","vex2","vcx","vcx2"),drawAxis("z",[2,1,0],"vx1","vx2","syz","sxz","s3yi","s3xi",1,"vz1","vz2","vbz","vez","vbz2","vez2","vcz","vcz2","vy1","vy2","vby","vey","vby2","vey2","vcy","vcy2"),e.endLayer()]);
try{var f=new Function("l","v","m",c);return f;}catch(x){alert("Failed to compile:\n"+x.message+"\n"+c);
return 0;}},_line2D:{graph:{inherit:"shape",stroke:"#000000",weight:1,$:1}},line2D:function(l,d,s){if(!s.graph){return new Function("");
}var wrap=s.graph.weight*8,e=apf.draw;var clipy=s.graph.fillout?"db":"ty";var c=e.optimize([e.vars(),"if(m){","return -1;","}",e.beginLayer(l),d.vars,d.stats,e.beginShape(s.graph),"var x1=",d.x1,",x2=",d.x2,",xs=",d.xs,",x = x1,xw=x2-x1,idx=xw/xs;",d.begin,"var xfirst = x,dx=-vx1*tw,dy=-vy1*th;",d.seek,d.ifdraw,"{",s.graph.fill?[e.moveTo(d.x+"*tw+tx",clipy),e.lineTo(d.x+"*tw+tx",d.y+"*th+ty"),].join(""):e.moveTo(d.x+"*tw+tx",d.y+"*th+ty"),"for(x+=idx;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.lineTo(d.x+"*tw+tx",d.y+"*th+ty"),"}",s.graph.fill?["x-=idx;",e.lineTo(d.x+"*tw+tx",clipy)].join(""):"","}",e.endLayer()].join(""));
try{return new Function("l","v","m",c);}catch(x){alert("Failed to compile:\n"+c);
return 0;}},_line3D:{graph:{inherit:"shape",steps:50,zpos:0,depth:0.5,stroke:"black",fill:"red",opacity:0.3,$:1}},line3D:function(l,d,s){if(!s.graph){return new Function("");
}var e=apf.draw,wrap=s.graph.weight*4;var c=e.optimize([e.vars(),"if(m){","return -1;","}",e.beginLayer(l),this.chartView3D(l,e),d.vars,d.stats,"var x1=",d.x1,",x2=",d.x2,",xs=",d.xs,",x=x1,xw=x2-x1,idx=xw/xs,","k = 0, xi, yi, xa, ya, xb, yb, xc, yc, xd, yd;",d.seek,e.beginShape(s.graph),d.ifdraw,"{",e.moveTo3D("xb="+d.x,"yb="+d.y,s.graph.zpos),"for(x+=idx,i=0;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{","xa = ",d.x,",ya=",d.y,";",e.lineTo3D("xa","ya",s.graph.zpos,"xi=","yi="),e.lineTo3D("xa","ya",s.graph.zpos+"+"+s.graph.depth,"xc=","yc="),"if(!i){i++;",e.lineTo3D("xb","yb",s.graph.zpos+"+"+s.graph.depth),"} else {",e.lineTo("xd","yd"),"}",e.close(),e.moveTo("xi","yi"),"xd=xc, yd=yc, xb = xa, yb = ya;","}","}",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert("Failed to compile:\n"+c);
return 0;}},_bar3D:{graph:{inherit:"shape",stroke:"#000000",weight:1,fill:"red",$:1}},bar3D:function(l,d,s){if(!s.graph){return new Function("");
}var e=apf.draw,g=apf.visualize;var c=e.optimize(["if(m){return -1;}",e.beginLayer(l),e.vars(),this.chartView3D(l,e),e.defCamVec(),d.vars,"var x1=",d.x1,",x2=",d.x2,",xs=",d.xs,",x,xw=x2-x1,idx=xw/xs,","wx = idx*tw,wy,cx1,cx2,cy1,cy2;",d.seek,e.beginState(s.graph,e,e.shapedRect,4),d.ifdraw,"{","for(x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{","cx1=",d.x,",cy1=",d.y,",cx2=cx1+idx,cy2=0;",e.poly3DClip([0,1,2,3],[["cx1","cy1",0],["cx2","cy1",0],["cx2","cy2",0],["cx1","cy2",0]],[0,1,2],-1),"};","}",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert(x.message+"\nFailed to compile:\n"+c);
return 0;}},_height3D:{graph:{inherit:"shape",steps:50,zpos:0,depth:0.5,stroke:"black",fill:"red",opacity:0.3,$:1}},height3D:function(l,d,s){if(!s.graph){return new Function("");
}var e=apf.draw;var c=e.optimize([e.vars(),"if(m){","return -1;","}",e.beginLayer(l),this.chartView3D(l,e),d.vars,d.stats,"var x1=",d.x1,",x2=",d.x2,",xs=",d.xs,",x=x1,xw=x2-x1,idx=xw/xs,","z1=",d.z1,",z2=",d.z2,",zs=",d.zs,",z=z1,zw=z2-z1,idz=zw/zs,","k = 0, xi, yi, xa, ya, xb, yb, xc, yc, xd, yd;",d.seek,e.beginShape(s.graph),d.ifdraw,"{",(s.graph.fill)?["var ar1=[], ar2=[];","for(x=x1,i=0;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.store3D(d.x,d.y,d.z,"ar1[i++]=","ar1[i++]="),"};","for(z+=idz;z<z2",d.forz,";z+=idz",d.incz,")",d.ifz,"{","x=x1, i=0, j=0;",e.store3D(d.x,d.y,d.z,"ar2[i++]=","ar2[i++]="),"for(x+=idx;x<x2",d.forx,";x+=idx,j+=2",d.incx,")",d.ifx,"{",e.moveTo("ar1[j]","ar1[j+1]"),e.lineTo("ar1[j+2]","ar1[j+3]"),e.lineTo3D(d.x,d.y,d.z,"ar2[i++]=","ar2[i++]="),e.lineTo("ar2[j]","ar2[j+1]"),e.close(),"}","ar1=ar2,ar2=[];","}"].join(""):["for(;z<z2",d.forz,";z+=idz",d.incz,")",d.ifz,"{","x=x1;",e.moveTo3D(d.x,d.y,d.z),"for(x+=idx;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.lineTo3D(d.x,d.y,d.z),"}","}",(s.graph.single>0)?"":["for(x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{","z=z1;",e.moveTo3D(d.x,d.y,d.z),"for(z+=idz;z<z2",d.forz,";z+=idz",d.incz,")",d.ifz,"{",e.lineTo3D(d.x,d.y,d.z),"}","}"].join(""),].join(""),"}",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert("Failed to compile:\n"+c);
return 0;}},_bar2D:{graph:{inherit:"shape",shape:"rect",stroke:"#000000",weight:1,fill:"red",$:1}},bar2D:function(l,d,s){var e=apf.draw,g=apf.visualize;
if(!s.graph){return new Function("");}var c=e.optimize([e.vars(),d.vars,"var x1=",d.x1,",x2=",d.x2,",xs=",d.xs,",x,xw=x2-x1,idx=xw/xs,","wx = idx*tw,wy;",d.seek,"\n\n/*------ bar2D Mousecode ------ */\n","if(m){",e.beginMouseState(s.graph,e,e.shapedRect,4),"for(x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.checkMouseState(d.state,d.time,"("+d.x+")*tw+tx","wy=("+d.y+")*th+ty","wx","ty-wy"),"};","return -1;","}","\n\n/*------ bar2D Drawcode ------ */\n",e.beginLayer(l),e.beginState(s.graph,e,e.shapedRect,4),d.ifdraw,"{","for(x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.drawState(d.state,d.time,"("+d.x+")*tw+tx","wy=("+d.y+")*th+ty","wx","ty-wy"),"};","}",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert(x.message+"\nFailed to compile:\n"+c);
return 0;}},_shape2D:{graph:{inherit:"shape",stroke:"#000000",weight:1,left:-1.5,top:-1.5,height:3,width:4,fill:"red",$:1}},shape2D:function(l,d,s){if(!s.graph){return new Function("");
}var e=apf.draw,g=apf.visualize;var c=e.optimize(["if(m){return -1;}",e.beginLayer(l),e.vars(),d.vars,"var x1=",d.x1,",x2=",d.x2,",xs=",d.xs,",x,xw=x2-x1,idx=xw/xs,","wx = idx*tw,wy;","tx += ",s.graph.left*l.ds,";","ty += ",s.graph.top*l.ds,";",d.seek,e.beginState(s.graph,e,e.draw2D,4),d.ifdraw,"{","for(x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.drawState(d.state,d.time,"("+d.x+")*tw+tx","wy=("+d.y+")*th+ty",s.graph.width*l.ds,s.graph.height*l.ds),"};","}",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert(x.message+"\nFailed to compile:\n"+c);
return 0;}},_pie2D:{margin:{left:0,top:0,width:1,height:1,$:1},graph:{inherit:"shape",stroke:"#000000",weight:1,fill:"red",$:1}},pie2D:function(l,d,s){if(!s.graph){return new Function("");
}var e=apf.draw,g=apf.visualize;var c=e.optimize(["/*------ pie2D Init ------*/\n",e.vars(),d.vars,d.stats,"var x1=",d.vx1,",x2=",d.vx2,",xw=x2-x1,","idx=1,sum=1/(",d.sum,"),rx=0,","xp=(",s.margin.left,")*tw+tx,","yp=(",s.margin.top,")*th+ty,","wp=(",s.margin.width,")*tw,","hp=(",s.margin.height,")*th,","wq=0.5*wp, hq = 0.5*hp,","xc=xp+wq, yc=yp+hq, piesize;",d.seek,"\n\n/*------ pie2D Mousecode ------ */\n","if(m){",e.beginMouseState(s.graph,e,e.shapedPart,6,["piesize"]),"for(rx=0,x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{",e.checkMouseState(d.state,d.time,"xc","yc","wq","hq","rx","-rx+(rx+=("+d.y+")*sum)"),"};","return -1;","}","\n\n/*------ pie2D Drawcode ------ */\n",e.beginLayer(l),e.beginState(s.graph,e,e.shapedPart,6,["piesize"]),"for(rx=0,x=x1;x<x2",d.forx,";x+=idx",d.incx,")",d.ifx,"{","piesize = ("+d.y+")*sum;",e.drawState(d.state,d.time,"xc","yc","wq","hq","rx","-rx+(rx+=piesize)"),"};","\n\n/*------ pie2D End ------ */\n",e.endLayer()]);
try{return new Function("l","v","m",c);}catch(x){alert(x.message+"\nFailed to compile:\n"+c);
return 0;}},dt_math1X:function(l){return{type:"math1X",vars:"var _stp= l.step&&(vx2-vx1)/l.step<l.steps?l.step:(vx2-vx1)/l.steps;",vx1:0,vx2:1,vy1:0,vy2:1,vz1:0,vz2:1,x1:"__floor(vx1/_stp)*_stp",x2:"__ceil(vx2/_stp+1)*_stp",xs:"(x2-x1)/_stp",stats:"",seek:"",forx:"",ifx:"",incx:"",ifdraw:"",x:"x",y:"("+apf.draw.getXYWH(l.pformula,"x")+")"};
},dt_math2X:function(l){return{type:"math2X",vars:"var _stp= l.step&&(vx2-vx1)/l.step<l.steps?l.step:(vx2-vx1)/l.steps;",vx1:-1,vx2:1,vy1:-1,vy2:1,vz1:0,vz2:1,x1:"__floor(vx1/_stp)*_stp",x2:"__ceil(vx2/_stp+1)*_stp",xs:"(x2-x1)/_stp",stats:"",seek:"",forx:"",ifx:"",incx:"",ifdraw:"",x:"("+apf.draw.getXYWH(l.pformula,"x")+")",y:"("+apf.draw.getXYWH(l.pformula,"y")+")"};
},dt_math1XZ:function(l){return{type:"math1XY",vars:"var _stpx= l.step&&(vx2-vx1)/l.step<l.steps?l.step:(vx2-vx1)/l.steps,_stpz=l.step&&(vz2-vz1)/l.step<l.steps?l.step:(vz2-vz1)/l.steps;",vx1:-1,vx2:1,vy1:-1,vy2:1,vz1:0,vz2:1,x1:"vx1",x2:"vx2",xs:"(x2-x1)/_stpx",z1:"vz1",z2:"vz2",zs:"(z2-z1)/_stpz",stats:"",seek:"",forx:"",ifx:"",incx:"",ifdraw:"",forz:"",ifz:"",incz:"",ifdraw:"",x:"x",z:"z",y:"("+apf.draw.getXYWH(l.pformula,"x")+")"};
},dt_math1R:function(l){var part=l.formula.split(";");return{type:"math1R",vx1:-1,vx2:1,vy1:-1,vy2:1,vz1:0,vz2:1,x1:0,x2:"Math.PI*2+(Math.PI*2/(l.style.steps-1))",xs:"l.style.steps",x:"__sin(_p="+apf.visualize.mathParse(part[0])+")*(_r="+apf.visualize.mathParse(part[1])+")",y:"__cos(_p)*_r"};
},dt_series1XM:function(l){return{type:"series1XM",vars:"var _mf = __min(__ceil(vx2)+1,l.v_yvalmip[0].length)-__max(__floor(vx1),0);var _ms = l.mipstep, _mt = 1;while(_mf>l.mipthres && _mt<l.v_yvalmip.length){_mf = _mf / _ms;_mt++;}var _div = __pow(_ms,_mt-1);var _off = _mt>1?__pow(_ms,_mt-2):0;var _yv = l.v_yvalmip[_mt-1],_i;",vx1:0,vx2:"_yv.length",vy1:-1,vy2:1,vz1:0,vz2:1,state:"0",time:"0",sum:"l.v_sum",min:"l.v_min",max:"l.v_max",avg:"l.v_avg",seek:"",stats:"",ifdraw:"if((!l.mipmin || _mt>l.mipmin) && (!l.mipmax || _mt<l.mipmax))",forx:"",ifx:"",incx:"",x1:"__max(__floor(vx1/_div-1),0)",x2:"__min((__ceil(vx2/_div)+1),_yv.length)",xs:"x2-x1",x:"(x*_div+_off)",y:"_yv[x]"};
},dt_series1X:function(l){return{type:"series1X",vars:"var _yv = l.v_yval,_sv = l.v_state, _tv = l.v_time,_i,_mi,_ma;",vx1:0,vx2:"_yv.length",vy1:-1,vy2:1,vz1:0,vz2:1,state:"_sv[x]",time:"_tv[x]",sum:"l.v_sum",min:"l.v_min",max:"l.v_max",avg:"l.v_avg",forx:"",ifx:"",incx:"",stats:"if(!l.v_sum){for(i=_yv.length-1,j=0,_mi=10000000,_ma=-10000000;i>=0;--i)j+=((m=_yv[i])<_mi?_mi=m:m)>_ma?_ma=m:m;l.v_avg=(l.v_sum=j)/_yv.length;l.v_min=_mi;l.v_max=_ma;}",x1:"__max(__floor(vx1),0)",x2:"__min(__ceil(vx2)+1,_yv.length)",x1c:"__max(__floor(vx1),0)",x2c:"__min(__ceil(vx2)+1,_yv.length)",xs:"x2-x1",x:"x",y:"_yv[x]"};
},dt_series2X:function(l){var len=l.yvalue.length;return{type:"series2X",vx1:0,vx2:len,vy1:-1,vy2:1,vz1:0,vz2:1,vars:"var _vx = l.xvalue, _vy = l.yvalue, _len = _vy.length;",x1:0,x2:"_len",xs:"_len",x:"_vx[x]",y:"_vy[x]"};
},$:0};apf.chart_draw.height2D=apf.chart_draw.line2D;apf.chart_draw._height2D=apf.chart_draw._line2D;
apf.draw.vml={initRoot:function(r){if(!apf.isIE8){apf.importCssString("v\\:fill {behavior: url(#default#VML);display:inline-block} v\\:stroke {behavior: url(#default#VML);} v\\:shape {behavior: url(#default#VML);} v\\:path {behavior: url(#default#VML);}");
r.$ext.innerHTML="                <div style='z-index:10000;position:absolute;left:0px;width:0px;                            background:url(images/spacer.gif);width:"+r.width+"px;height:"+r.height+"px;'>                </div>                <div style='margin: 0 0 0 0;padding: 0px 0px 0px 0px;                             position:absolute;display:inline-block;left:0;top:0;width:"+r.width+"px;height:"+r.height+"px;overflow:hidden;'>                </div>";
r.vmlroot=r.$ext.lastChild;}else{r.$ext.innerHTML="                <div style='z-index:10000;position:absolute;left:0px;width:0px;                            background:url(images/spacer.gif);width:"+r.width+"px;height:"+r.height+"px;'>                </div>                <iframe style='margin:0 0 0 0;padding:0 0 0 0;background:transparent;                             position:absolute;border:0px;display:inline-block;left:0;top:0;width:"+r.width+"px;height:"+r.height+"px;overflow:hidden;'>                </iframe>";
r.vmliframe=r.$ext.lastChild;r.vmliframe.allowTransparency=true;var doc=r.vmliframe.contentWindow.document;
doc.open();doc.writeln("<head><meta http-equiv='X-UA-Compatible' content='IE=EmulateIE7' /></head>                        <style>v\\:fill {behavior: url(#default#VML);display:inline-block} v\\:stroke {behavior: url(#default#VML);}                        v\\:shape {behavior: url(#default#VML);} v\\:path {behavior: url(#default#VML);}</style>                        <html><body style='margin: 0 0 0 0;padding: 0 0 0 0;border: 0px;background:transparent;'>                        <div style='position:absolute;display:inline-block;'></div></body></html>");
doc.close();r.vmlroot=doc.body.firstChild;}return this;},resizeRoot:function(r){var t=r.vmliframe||r.vmlroot;
t.style.width=r.width;t.style.height=r.height;t=t.previousSibling;t.style.width=r.width,t.style.height=r.height;
if(r.vmliframe){t=r.vmlroot;t.style.width=r.width;t.style.height=r.height;}},initLayer:function(l,r){l.ds=1;
l.dx=0,l.dy=0;l.dw=parseFloat(l.width)*l.ds;l.dh=parseFloat(l.height)*l.ds;l._styles=[];
l._htmljoin=[];l._vmlroot=r.vmlroot;},resizeLayer:function(l,r){var lx,ly,lw,lh,t;
l.dx=0,l.dy=0;l.dw=parseFloat(lw=l.width)*l.ds;l.dh=parseFloat(lh=l.height)*l.ds;
var coord=(l.dw+1)+","+(l.dh+1);if(l._vmlgroup){(t=l._vmlgroup).style.left=lx=l.left,t.style.top=ly=l.top,t.style.width=lw,t.style.height=lh;
for(var n=l._vmlgroup.childNodes,l=n.length,i=0;i<l;i++){(t=n[i]).style.width=lw,t.style.height=lh;
if(t.coordsize){t.coordsize=coord;}}}},deinitLayer:function(l){if(l._vmlgroup){l._vmlgroup.removeNode();
l._vmlgroup=0;}},beginLayer:function(l){if(l._styles.length){if(l._vmlgroup){l._vmlgroup.innerHTML="";
}l._styles=[];l._htmljoin=[];}this.l=l,this.mx="",this.my="",this.last=null;return[this.jssVars,"if(!l._styles)_initStyles();","var _s1,_s2,_s3,_s4,_s5,_s6,_s7,_s8,_s9,_st,_su,_sv,","_x1,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10,","_y1,_y2,_y3,_y4,_y5,_y6,_y7,_y8,_y9,_y10,","_t,_u,_l,_dx,_dy,_tn,_tc,_lc,_s,_p,","_styles = l._styles;"].join("");
},clear:function(){return"";},endLayer:function(){var l=this.l;var s=[this.$endDraw()],k,h,v,f;
var p=[];var i=0,j=0,style,len=l._styles.length;for(;i<len;i++){style=l._styles[i];
if(style._prev===undefined){p.push("_styles[",i,"]={","_domnode:_n=l._vmlgroup.childNodes[",j,"]");
if(style.$stylelist){p.push(",",apf.draw.serializeStyleState(style));}if(style.isshape){s.push(this.$finalizeShape(style));
p.push(",_vmlfill:_n.lastChild?_n.lastChild.previousSibling:0,_vmlstroke:_n.lastChild");
}else{p.push(',_txtused:0,_txtcount:0,_txtnodes:[],_txtdiv:"',style._txtdiv,'"');
s.push(this.$finalizeFont(style));}p.push("};");j++;}}s.push(["l._anim = _anim;","function _initStyles(){","l._vmlroot.insertAdjacentHTML('beforeend',[",'"<div style=\'position:absolute;display:inline-block;left:",l.left,"','px;top:",l.top,"px;width:",l.width,"px;height:",l.height,"',"px;overflow:hidden;'>\",",'"',l._htmljoin.join(""),'",',"\"</div>\"].join(''));","l._vmlgroup = l._vmlroot.lastChild;","var _n, _styles = l._styles = [];",p.join(""),"};"].join(""));
l._styles=null;this.l=null;return s.join("");},beginShape:function(style){if(!style){return"document.title='beginShape Failed';";
}var l=this.l,html=l._htmljoin,i,t,shape=[],path=[],child=[],opacity="",s=[this.$endDraw()];
style._path=[];if(style._id===undefined){style._id=l._styles.push(style)-1;}this.style=style;
for(i=l._styles.length-2;i>=0;i--){if(!l._styles[i]._prev&&this.$canJoin(t=l._styles[i],style)){style._prev=(t._prev!==undefined)?t._prev:i;
break;}}if(style._prev===undefined){s.push("_p=(_s=_styles[",style._id,"])._path=[];");
if(typeof style.tile!="undefined"){var fillopacity=style.fillopacity;if(this.isDynamic(fillopacity)){fillopacity="1";
s.push("_s._vmlfill.opacity=",style.fillopacity,";");}if(this.isDynamic(style.tile)){s.push("if(_s._vmlimg!=(_t=",style.tile,"))_s._vmlfill.src=_t;");
child.push("<v:fill origin='0,0' position='0,0' opacity='",fillopacity,"' src='' type='tile'/>");
}else{child.push("<v:fill origin='0,0' position='0,0' opacity='",fillopacity,"'  src='",style.tile,"' type='tile'/>");
if(style.tilex||style.tiley){style._img=new Image();style._img.src=style.tile;if(style.tilex){s.push("_s._vmlfill.origin.x=((_t=((",style.tilex,")/(_s._img.width))%1)<0?1+_t:_t);");
}if(style.tiley){s.push("_s._vmlfill.origin.y=((_t=((",style.tiley,")/_s._img.height)%1)<0?1+_t:_t);");
}}}s.push("_p.push('m',_dx=-_s._img.width*100,' ',_dy=-_s._img.height*100,","',l',_dx,' ',_dy);");
}else{if(style.fill!==undefined){var fill=style.fill,fillopacity=style.fillopacity,angle=style.angle,gradopacity=style.gradopacity;
if(!fill.sort){fill=[fill];}var len=fill.length;var color="black",colors,color2,getColorors;
if(len>2){for(i=1;i<len-1&&!this.isDynamic(fill[i]);i++){}if(i!=len-1){for(t=[],i=1;
i<len-1;i++){t.push(i>1?'+",':'"',Math.round((i/(len-1))*100),'% "+',this.getColor(fill[i]));
}colors=t.join("");getColorors=1;}else{for(t=[],i=1;i<len-1;i++){t.push(i>1?",":"",Math.round((i/(len-1))*100),"% ",fill[i]);
}colors=t.join("");}}if(len>1){if(this.isDynamic(gradopacity)||this.isDynamic(fillopacity)){if(gradopacity==fillopacity){fillopacity="_t="+fillopacity,gradopacity="_t";
}if(len>2){t=gradopacity,gradopacity=fillopacity,fillopacity=t;}s.push("if(_s._vmldata!=(_t=",'["<v:fill opacity=\'",(',fillopacity,"),\"' method='none' ","o:opacity2='\",",gradopacity,",\"' color='\",",this.getColor(fill[0]),",\"' color2='\",",this.getColor(fill[len-1]),",\"' type='gradient' angle='\",parseInt(((",angle,")*360+180)%360),\"' ",colors?(getColorors?"colors='\","+colors+",\"'":"colors='"+colors+"'"):"","/>\"].join(''))){","_s._domnode.removeChild(_s._vmlfill);","_s._domnode.insertAdjacentHTML( 'beforeend',_s._vmldata=_t);","_s._vmlfill = _s._domnode.lastChild;};");
child.push("<v:fill opacity='0' color='black' type='fill'/>");}else{if(len>2){t=gradopacity,gradopacity=fillopacity,fillopacity=t;
}if(this.isDynamic(fill[0])){s.push("_s._vmlfill.color=",this.getColor(fill[0]),";");
}else{color=fill[0];}if(this.isDynamic(fill[len-1])){s.push("_s._vmlfill.color2=",this.getColor(fill[len-1]),";");
}else{color2=fill[len-1];}if(getColorors){s.push("_s._vmlfill.colors.value=",colors,";");
}if(this.isDynamic(angle)){angle="0";s.push("_s._vmlfill.angle=(((",style.angle,")+180)*360)%360;");
}if(this.isDynamic(fillopacity)){fillopacity="1";s.push("_s._vmlfill.opacity=",style.fillopacity,";");
}child.push("<v:fill opacity='",fillopacity,"' method='none' o:opacity2='",gradopacity,colors?"' colors='"+colors+"'":"","' color='",color,"' color2='",color2,"' type='gradient' angle='",(angle*360+180)%360,"'/>");
}}else{if(this.isDynamic(fillopacity)){fillopacity="1";s.push("_s._vmlfill.opacity=",style.fillopacity,";");
}if(this.isDynamic(fill[0])){s.push("_s._vmlfill.color=",this.getColor(fill[0]),";");
}else{color=fill[0];}child.push("<v:fill opacity='",fillopacity,"' color=",this.getColor(color)," type='fill'/>");
}shape.push("fill='t'"),path.push("fillok='t'");}else{shape.push("fill='f'"),path.push("fillok='f'");
}}if(style.stroke!==undefined){var weight=style.weight,opacity=style.strokeopacity,stroke=style.stroke;
if(this.isDynamic(opacity)){opacity="1";s.push("_s._vmlstroke.opacity=",style.opacity,";");
}if(this.isDynamic(weight)){weight="1";s.push("_t=",style.weight,";_s._vmlstroke.weight=_t;if(_t<",opacity,")_s._vmlstroke.opacity=_t;");
}if(this.isDynamic(stroke)){stroke="black";s.push("_s._vmlstroke.color=",this.getColor(style.stroke),";");
}child.push("<v:stroke opacity='",weight<1?(opacity<weight?opacity:weight):opacity,"' weight='",weight,"' color=",this.getColor(stroke.dataType==apf.ARRAY?stroke[0]:stroke),"/>");
}else{shape.push("stroke='f'"),path.push("strokeok='f'");}html.push(["<v:shape alignshape='f' ","style='position:absolute;display:inline-block;left:0;top:0;width:",'",l.width,"px;height:",l.height,"px;overflow:hidden;\' ',"coordorigin='0,0' coordsize='\",(l.dw+1),\",\",(l.dh+1),\"'","path='' ",shape.join(" "),"><v:path ",path.join(" "),"/>",child.join(" "),"</v:shape>"].join(""));
}else{if(style._prev!==undefined){if(this.last!==style._prev){s.push("_p=(_s=_styles[",style._prev,"])._path;");
}}}return s.join("");},moveTo:function(x,y){return["_p.push('m',__round(",x,")",",' ',__round(",y+"),'l');\n"].join("");
},lineTo:function(x,y){return["_p.push(__round(",x,")",",' ',__round("+y+"));\n"].join("");
},lineH:function(x,y,w){return["_p.push('m',__round(",x,")",",' ',__round(",y,")",",'r',__round(",w,"),' 0');"].join("");
},lineV:function(x,y,h){return["_p.push('m',__round(",x,")",",' ',__round(",y,")",",'r0 ',__round(",h,"));"].join("");
},dot:function(x,y){return["_p.push('m',__round(",x,")",",' ',__round(",y,")",",'r0 0');"].join("");
},rect:function(x,y,w,h,inv){return["_u=",x,";if((_t=__round(",w,"))>0)_p.push('m',__round(_u),' ',__round(",y,")",",'r',_t,' 0r0 ',__round(",h,inv?"),'r-'+_t,' 0x');":"),'r-'+_t,' 0xe');"].join("");
},ellipse:function(x,y,w,h,s,e,c){if(!s){return["_p.push('at ',(_x1=__round(",x,"))-(_x2=__round(",w,")),' ',(_y1=__round(",y,"))-(_y2=__round(",h,")),' ',","_x1+_x2,' ',_y1+_y2,' 0 0 0 0');"].join("");
}else{return["if( (_t=",s,")+0.000001<(_u=",e,")){","_p.push('",c?"wa":"at"," ',(_x1=__round(",x,"))-(_x2=__round(",w,")),' ',(_y1=__round(",y,"))-(_y2=__round(",h,")),' ',_x1+_x2,' ',_y1+_y2,' ',","__round(_x1+__sin(_t)*_x2*4000),' ',","__round(_y1+__cos(_t)*_y2*4000),' ',","__round(_x1+__sin(_u)*_x2*4000),' ',","__round(_y1+__cos(_u)*_y2*4000),'x');}else{","_p.push('l',__round((",x,")+__sin(_t)*(",w,")),' ',__round((",y,")+__cos(_t)*(",h,")),'x');","}",].join("");
}},rectInv:function(x,y,w,h){return this.rect(x,y,w,h,1);},close:function(){return"_p.push('xe');";
},$endShape:function(){this.mx="",this.my="";this.last=this.style._id;this.style=0;
return"";},$finalizeShape:function(style){return["if((_s=_styles[",style._id,"])._pathstr!=(_t=","(_p=_s._path).length?_p.join(' '):'m'))_s._domnode.path=_t;\n"].join("");
}};apf.storage.modules["air.file"]={initialized:false,init:function(){this.File=window.runtime.flash.filesystem.File;
this.FileStream=window.runtime.flash.filesystem.FileStream;this.FileMode=window.runtime.flash.filesystem.FileMode;
this.storagePath="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE")+"/";
try{var dir=this.File.applicationStorageDirectory.resolvePath(this.storagePath);
if(!dir.exists){dir.createDirectory();}this.initialized=true;}catch(e){apf.console.warn(e.message);
return false;}},isAvailable:function(){return apf.isAIR;},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}try{this.remove(key,namespace);var dir=this.File.applicationStorageDirectory.resolvePath(this.storagePath+namespace);
if(!dir.exists){dir.createDirectory();}var file=dir.resolvePath(key);var stream=new this.FileStream();
stream.open(file,this.FileMode.WRITE);stream.writeObject(value);stream.close();
}catch(e){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+e.message));
return false;}return true;},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}var file=this.File.applicationStorageDirectory.resolvePath(this.storagePath+namespace+"/"+key);
if(!file.exists||file.isDirectory){return false;}var stream=new this.FileStream();
stream.open(file,this.FileMode.READ);var results=stream.readObject();stream.close();
return results;},getNamespaces:function(){var results=[this.namespace];var dir=this.File.applicationStorageDirectory.resolvePath(this.storagePath);
var files=dir.getDirectoryListing();for(var i=0;i<files.length;i++){if(files[i].isDirectory&&files[i].name!=this.namespace){results.push(files[i].name);
}}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var results=[];var dir=this.File.applicationStorageDirectory.resolvePath(this.storagePath+namespace);
if(dir.exists&&dir.isDirectory){var files=dir.getDirectoryListing();for(var i=0;
i<files.length;i++){results.push(files[i].name);}}return results;},clear:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var dir=this.File.applicationStorageDirectory.resolvePath(this.storagePath+namespace);
if(dir.exists&&dir.isDirectory){dir.deleteDirectory(true);}},remove:function(key,namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}var file=this.File.applicationStorageDirectory.resolvePath(this.storagePath+namespace+"/"+key);
if(file.exists&&!file.isDirectory){file.deleteFile();}},putMultiple:function(keys,values,namespace){if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"], values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}try{for(var i=0;i<keys.length;i++){this.put(keys[i],values[i],null,namespace);
}}catch(e){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+e.message));
return false;}return true;},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}var results=[];for(var i=0;i<keys.length;i++){results[i]=this.get(keys[i],namespace);
}return results;},removeMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+namespace));
}for(var i=0;i<keys.length;i++){this.remove(keys[i],namespace);}},isPermanent:function(){return true;
},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;
},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
}};apf.storage.modules.air={init:function(){this.ByteArray=window.runtime.flash.utils.ByteArray;
this.EncryptedLocalStore=window.runtime.flash.data.EncryptedLocalStore;},isAvailable:function(){return apf.isAIR;
},_getItem:function(key){var storedValue=this.EncryptedLocalStore.getItem("__apf_"+key);
return storedValue?storedValue.readUTFBytes(storedValue.length):"";},_setItem:function(key,value){var bytes=new this.ByteArray();
bytes.writeUTFBytes(value);this.EncryptedLocalStore.setItem("__apf_"+key,bytes);
},_removeItem:function(key){this.EncryptedLocalStore.removeItem("__apf_"+key);},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}try{var namespaces=this._getItem("namespaces")||"";if(namespaces.indexOf("|"+namespace+"|")==-1){this._setItem("namespaces",namespaces+namespace+"|");
}var keys=this._getItem(namespace+"_keys")||"";if(keys.indexOf("|"+key+"|")==-1){this._setItem(namespace+"_keys",keys+key+"|");
}this._setItem("_"+namespace+"_"+key,value);}catch(e){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing: "+e.message));
return false;}return true;},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}return this._getItem("_"+namespace+"_"+key);},getNamespaces:function(){var results=[this.namespace];
var namespaces=(this._getItem("namespaces")||"").split("|");for(var i=0;i<namespaces.length;
i++){if(namespaces[i]&&namespaces[i]!=this.namespace){results.push(namespaces[i]);
}}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+namespace));
}var results=[];var keys=(this._getItem(namespace+"_keys")||"").split("|");for(var i=0;
i<keys.length;i++){if(keys[i]){results.push(keys[i]);}}return results;},clear:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var namespaces=this._getItem("namespaces")||"";if(namespaces.indexOf("|"+namespace+"|")!=-1){this._setItem("namespaces",namespaces.replace("|"+namespace+"|","|"));
}var keys=(this._getItem(namespace+"_keys")||"").split("|");for(var i=0;i<keys.length;
i++){if(keys[i].length){this._removeItem(namespace+"_"+keys[i]);}}this._removeItem(namespace+"_keys");
},remove:function(key,namespace){if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}var keys=this._getItem(namespace+"_keys")||"";if(keys.indexOf("|"+key+"|")!=-1){this._setItem(namespace+"_keys",keys.replace("|"+key+"|","|"));
}this._removeItem("_"+namespace+"_"+key);},putMultiple:function(keys,values,namespace){if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"], values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}try{for(var i=0;i<keys.length;i++){this.put(keys[i],value[i],null,namespace);}}catch(e){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+e.message));
return false;}return true;},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}var results=[];for(var i=0;i<keys.length;i++){results[i]=this.get(keys[i],namespace);
}return results;},removeMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+namespace));
}for(var i=0;i<keys.length;i++){this.remove(keys[i],namespace);}},isPermanent:function(){return true;
},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;
},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
}};apf.storage.modules["air.sql"]={database_file:"apf.db",initialized:false,_db:null,init:function(){this.File=window.runtime.flash.filesystem.File;
this.SQLConnection=window.runtime.flash.data.SQLConnection;this.SQLStatement=window.runtime.flash.data.SQLStatement;
this.table_name="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE");
try{this._db=new this.SQLConnection();this._db.open(this.File.applicationStorageDirectory.resolvePath(this.database_file));
this._sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(namespace TEXT, key TEXT, value TEXT)");
this._sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");
this.initialized=true;}catch(e){apf.console.warn(e.message);return false;}},_sql:function(query,params){var stmt=new this.SQLStatement();
stmt.sqlConnection=this._db;stmt.text=query;if(params){apf.extend(stmt.parameters,params);
}stmt.execute();return stmt.getResult();},isAvailable:function(){return apf.isAIR;
},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}try{this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":namespace,":key":key});
this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":namespace,":key":key,":value":value});
}catch(e){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+e.message));
return false;}return true;},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}var results=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":namespace,":key":key});
if(results.data&&results.data.length){return results.data[0].value;}return null;
},getNamespaces:function(){var results=[this.namespace];var rs=this._sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");
if(rs.data){for(var i=0;i<rs.data.length;i++){if(rs.data[i].namespace!=this.namespace){results.push(rs.data[i].namespace);
}}}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var results=[];var rs=this._sql("SELECT key FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":namespace});
if(rs.data){for(var i=0;i<rs.data.length;i++){results.push(rs.data[i].key);}}return results;
},clear:function(namespace){if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":namespace});
},remove:function(key,namespace){if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":namespace,":key":key});
},putMultiple:function(keys,values,namespace){if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"], values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}try{this._db.begin();for(var i=0;i<keys.length;i++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":namespace,":key":key[i]});
this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":namespace,":key":key[i],":value":value});
}this._db.commit();}catch(e){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+e.message));
return false;}return true;},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}var results=[];for(var i=0;i<keys.length;i++){var result=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":namespace,":key":keys[i]});
results[i]=result.data&&result.data.length?result.data[0].value:null;}return results;
},removeMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+namespace));
}this._db.begin();for(var i=0;i<keys.length;i++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = namespace = :namespace AND key = :key",{":namespace":namespace,":key":keys[i]});
}this._db.commit();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;
},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
}};apf.storage.modules.cookie={initialized:true,isAvailable:function(){return true;
},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}value=apf.serialize(value);apf.setcookie(namespace+"~"+key,value,new Date().getTime()+(60*60*24*365*10000));
},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}var value=apf.getcookie(namespace+"~"+key);return value?apf.unserialize(value):null;
},getNamespaces:function(){throw new Error("Not Implemented");var results=[this.namespace];
for(var ns in this.store){results.push(ns);}return results;},getKeys:function(namespace){throw new Error("Not Implemented");
if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var results=[];for(var prop in this.store[namespace]){results.push(prop);}return results;
},clear:function(namespace){throw new Error("Not Implemented");if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}delete this.store[namespace];},remove:function(key,namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}apf.delcookie(namespace+"~"+key);},putMultiple:function(keys,values,namespace){throw new Error("Not Implemented");
if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"],                                     values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}if(!this.store[namespace]){this.store[namespace]={};}for(var i=0;i<keys.length;
i++){this.store[namespace][keys[i]]=apf.serialize(values[i]);}return true;},getMultiple:function(keys,namespace){throw new Error("Not Implemented");
if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}if(!this.store[namespace]){return[];}var results=[];for(var i=0;i<keys.length;
i++){if(this.store[namespace][keys[i]]){results.push(apf.unserialize(this.store[namespace][keys[i]]));
}}return results;},removeMultiple:function(keys,namespace){throw new Error("Not Implemented");
if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+namespace));
}if(!this.store[namespace]){return;}for(var i=0;i<keys.length;i++){delete this.store[namespace][keys[i]];
}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;
},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
}};apf.storage.modules.flash={initialized:false,asyncInit:true,_available:null,_statusHandler:null,_flashReady:false,_pageReady:false,delayCalls:[],init:function(){this.name="flashStorage";
this.id=apf.flash.addPlayer(this);this.STORAGE_SWF=(apf.config.resourcePath||apf.basePath)+"resources/apfStorage.swf?cachebust="+new Date().getTime();
var flash=apf.flash.buildContent("src",this.STORAGE_SWF,"width","215","height","138","align","middle","id",this.name,"quality","high","bgcolor","#ffffff","allowFullScreen","true","name",this.name,"flashvars","playerID="+this.id,"allowScriptAccess","always","type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer","menu","true");
this.container=document.createElement("div");this.container.id=this.name+"_Container";
this.container.className="apfVideo";with(this.container.style){width=height="0px";
overflow="hidden";}document.body.appendChild(this.container);this.container.innerHTML=flash;
this.player=apf.flash.getElement(this.name);this._allNamespaces=this.getNamespaces();
this._flashReady=this._pageReady=true;},setVisible:function(visible){if(visible==true){this.container.style.position="absolute";
this.container.style.visibility="visible";}else{with(this.container.style){position="absolute";
x="-1000px";y="-1000px";visibility="hidden";}}return this;},callMethod:function(){if(!this.initialized||typeof this.player.callMethod!="function"){this.delayCalls.push(arguments);
}else{var args=[this.player,"callMethod"],f=apf.flash,i=0,l=arguments.length;for(;
i<l;i++){args.push(f.encode(args[i]));}f.remote.apply(null,args);}},delayedCallTimer:null,makeDelayCalls:function(){clearTimeout(this.delayedCallTimer);
if(!this.delayCalls.length){if(typeof this["onready"]=="function"){this.onready();
}return this;}this.callMethod.apply(this,this.delayCalls[0]);this.delayCalls.splice(0,1);
var _self=this;this.delayedCallTimer=window.setTimeout(function(){_self.makeDelayCalls();
},1);return this;},ready:function(callback){if(this.initialized){callback();}else{this.onready=callback;
}},event:function(sEventName,oData){if(sEventName=="status"){var ds=apf.storage;
if(statusResult==ds.PENDING){this.setVisible(true);}else{this.setVisible(false);
}if(ds._statusHandler){ds._statusHandler.call(null,oData.status,oData.keyName,oData.namespace);
}}else{if(sEventName=="loaded"){this.initialized=true;this.setVisible(false).makeDelayCalls();
}}},setFlushDelay:function(newDelay){if(newDelay===null||typeof newDelay==="undefined"||isNaN(newDelay)){throw new Error("Invalid argunment: "+newDelay);
}this.callMethod("setFlushDelay",String(newDelay));},getFlushDelay:function(){return Number(this.callMethod("getFlushDelay"));
},flush:function(namespace){if(namespace==null||typeof namespace=="undefined"){namespace=apf.storage.namespace;
}this.callMethod("flush",namespace);},isAvailable:function(){return location.protocol!="file:"&&apf.flash.isEightAvailable();
},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}this.callMethod("put",key,apf.serialize(value),namespace);},putMultiple:function(keys,values,namespace){if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"], values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}var metaKey=keys.join(",");var lengths=[];for(var i=0;i<values.length;i++){values[i]=apf.unserialize(values[i]);
lengths[i]=values[i].length;}var metaValue=values.join("");var metaLengths=lengths.join(",");
this.callMethod("putMultiple",metaKey,metaValue,metaLengths,namespace);},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}var results=this.callMethod("get",key,namespace);if(results==""){return null;}return apf.unserialize(apf.flash.decode(results));
},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}var metaKey=keys.join(",");var metaResults=this.callMethod("getMultiple",metaKey,namespace);
if(!metaResults){return null;}var results=eval("("+metaResults.replace(/""([^",\]]+)/g,'"\\"$1').replace(/([^",]+)""/g,'$1\\""')+")");
for(var i=0;i<results.length;i++){results[i]=(results[i]=="")?null:apf.unserialize(apf.flash.decode(results[i]));
}return results;},_destringify:function(results){if(typeof results=="string"&&(/^string:/.test(results))){results=results.substring("string:".length);
}else{results=eval(results);}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var results=this.callMethod("getKeys",namespace);if(results==this||results==null||results=="null"){results="";
}results=results.split(",");results.sort();return results;},getNamespaces:function(){var results=this.callMethod("getNamespaces");
if(results==this||results==null||results=="null"){results=apf.storage.namespace||"default";
}results=results.split(",");results.sort();return results;},clear:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}this.callMethod("clear",namespace);},remove:function(key,namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}this.callMethod("remove",key,namespace);},removeMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}var metaKey=keys.join(",");this.callMethod("removeMultiple",metaKey,namespace);
},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;
},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));
},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));
},getResourceList:function(){return[];}};apf.storage.modules.gears=apf.storage.modules["gears.sql"]={table_name:"STORAGE",initialized:false,$available:null,$db:null,init:function(){this.factory=apf.nameserver.get("google","gears");
this.database_name=apf.config.name.substr(0,46)+".apf.offline.gears";this.$db=this.factory.create("beta.database","1.0");
this.$db.open(this.database_name);try{this.$sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(  namespace TEXT,  key TEXT,  value TEXT )");
this.$sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");
this.initialized=true;}catch(e){apf.console.warn(e.message);return false;}},$sql:function(query,params){var rs=this.$db.execute(query,params);
return this.$normalizeResults(rs);},destroy:function(){this.$db.close();},$normalizeResults:function(rs){var results=[];
if(!rs){return[];}while(rs.isValidRow()){var row={};for(var i=0;i<rs.fieldCount();
i++){var fieldName=rs.fieldName(i);var fieldValue=rs.field(i);row[fieldName]=fieldValue;
}results.push(row);rs.next();}rs.close();return results;},isAvailable:function(){return apf.isGears;
},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}value=apf.serialize(value);try{this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[namespace,key]);
this.$sql("INSERT INTO "+this.table_name+" VALUES (?, ?, ?)",[namespace,key,value]);
}catch(e){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error setting name/value pair: "+e.message));
return false;}return true;},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}var results=this.$sql("SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?",[namespace,key]);
if(!results.length){return null;}return apf.unserialize(results[0].value);},getNamespaces:function(){var results=[this.namespace];
var rs=this.$sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");
for(var i=0;i<rs.length;i++){if(rs[i].namespace!=this.namespace){results.push(rs[i].namespace);
}}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Retrieving keys","Invalid namespace given: "+namespace));
}var rs=this.$sql("SELECT key FROM "+this.table_name+" WHERE namespace = ?",[namespace]);
var results=[];for(var i=0;i<rs.length;i++){results.push(rs[i].key);}return results;
},clear:function(namespace){if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ?",[namespace]);},remove:function(key,namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[namespace,key]);
},putMultiple:function(keys,values,namespace){if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"],                                     values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}try{this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var stmt="REPLACE INTO "+this.table_name+" VALUES (?, ?, ?)";
for(var i=0;i<keys.length;i++){var value=apf.serialize(values[i]);this.$sql.db.execute(stmt,[namespace,keys[i],value]);
}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();}catch(e){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+e.message));
return false;}return true;},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}var stmt="SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?";
var results=[];for(var i=0;i<keys.length;i++){var result=this.$sql(stmt,[namespace,keys[i]]);
results[i]=result.length?apf.unserialize(result[0].value):null;}return results;
},removeMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+namespace));
}this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var stmt="DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?";
for(var i=0;i<keys.length;i++){this.$sql.db.execute(stmt,[namespace,keys[i]]);}this.$sql.db.execute("COMMIT TRANSACTION");
this.$sql.close();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;
},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
}};apf.storage.modules.html5={domain:(location.hostname=="localhost")?"localhost.localdomain":location.hostname,initialized:true,storage:apf.isIE?self.localStorage:self.globalStorage,isAvailable:function(){try{var myStorage=this.storage[location.href];
}catch(e){return false;}return true;},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}key=this.getFullKey(key,namespace);value=apf.serialize(value);try{var myStorage=this.storage[this.domain];
myStorage.setItem(key,value);}catch(e){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Could not set name/value pair"));
}},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}key=this.getFullKey(key,namespace);var myStorage=this.storage[this.domain];var results=myStorage.getItem(key);
if(results==null||results==""){return null;}return apf.unserialize(results);},getNamespaces:function(){var results=[this.namespace];
var found={};var myStorage=this.storage[this.domain];var tester=/^__([^_]*)_/;for(var i=0;
i<myStorage.length;i++){var currentKey=myStorage.key(i);if(tester.test(currentKey)==true){var currentNS=currentKey.match(tester)[1];
if(typeof found[currentNS]=="undefined"){found[currentNS]=true;results.push(currentNS);
}}}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+namespace));
}var namespaceTester=new RegExp(namespace==this.namespace?"^([^_]{2}.*)$":"^__"+namespace+"_(.*)$");
var myStorage=this.storage[this.domain];var keysArray=[];for(var i=0;i<myStorage.length;
i++){var currentKey=myStorage.key(i);if(namespaceTester.test(currentKey)==true){currentKey=currentKey.match(namespaceTester)[1];
keysArray.push(currentKey);}}return keysArray;},clear:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var namespaceTester=new RegExp(namespace==this.namespace?"^[^_]{2}":"^__"+namespace+"_");
var myStorage=this.storage[this.domain];for(var i=myStorage.length-1;i>=0;i--){if(namespaceTester.test(myStorage.key(i))==true){myStorage.removeItem(myStorage.key(i));
}}},remove:function(key,namespace){key=this.getFullKey(key,namespace);var myStorage=this.storage[this.domain];
myStorage.removeItem(key);},isPermanent:function(){return true;},getMaximumSize:function(){return 0;
},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));
},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));
},getFullKey:function(key,namespace){if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}return namespace==this.namespace?key:"__"+namespace+"_"+key;}};apf.storage.modules.memory={initialized:true,store:{},isAvailable:function(){return true;
},put:function(key,value,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+namespace));
}value=apf.serialize(value);if(!this.store[namespace]){this.store[namespace]={};
}this.store[namespace][key]=value;},get:function(key,namespace){if(this.isValidKey(key)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+key));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+namespace));
}if(!this.store[namespace]||!this.store[namespace][key]){return null;}return apf.unserialize(this.store[namespace][key]);
},getNamespaces:function(){var results=[this.namespace];for(var ns in this.store){results.push(ns);
}return results;},getKeys:function(namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}var results=[];for(var prop in this.store[namespace]){results.push(prop);}return results;
},clear:function(namespace){if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+namespace));
}delete this.store[namespace];},remove:function(key,namespace){if(!namespace){namespace=this.namespace;
}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+namespace));
}if(this.store[namespace]){delete this.store[namespace][key];}},putMultiple:function(keys,values,namespace){if(this.isValidKeyArray(keys)===false||!values instanceof Array||keys.length!=values.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+keys+"],                                     values = ["+values+"]"));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+namespace));
}if(!this.store[namespace]){this.store[namespace]={};}for(var i=0;i<keys.length;
i++){this.store[namespace][keys[i]]=apf.serialize(values[i]);}return true;},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));
}if(!this.store[namespace]){return[];}var results=[];for(var i=0;i<keys.length;
i++){if(this.store[namespace][keys[i]]){results.push(apf.unserialize(this.store[namespace][keys[i]]));
}}return results;},removeMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+keys));
}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+namespace));
}if(!this.store[namespace]){return;}for(var i=0;i<keys.length;i++){delete this.store[namespace][keys[i]];
}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;
},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");
}};apf.http=function(){this.queue=[null];this.callbacks={};this.cache={};this.timeout=this.timeout||10000;
this.autoroute=this.autoroute||false;this["route-server"]=this["route-server"]||null;
if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (HTTP)]";
};var namespace=apf.config.name+".apf.http";this.saveCache=function(){if(!apf.serialize){throw new Error(apf.formatErrorString(1079,this,"HTTP save cache","Could not find JSON library."));
}apf.console.info("[HTTP] Loading HTTP Cache","teleport");var strResult=apf.serialize(comm.cache);
apf.storage.put("cache_"+this.name,strResult,apf.config.name+".apf.http");};this.loadCache=function(){var strResult=apf.storage.get("cache_"+this.name,apf.config.name+".apf.http");
apf.console.info("[HTTP] Loading HTTP Cache","steleport");if(!strResult){return false;
}this.cache=apf.unserialize(strResult);return true;};this.clearCache=function(){apf.storage.remove("cache_"+this.name,apf.config.name+".apf.http");
};this.getXml=function(url,callback,options){if(!options){options={};}options.useXML=true;
options.callback=callback;return this.get(url,options);};this.getJSON=function(url,callback,options){if(!options){options={};
}options.callback=callback;options.useJSON=true;return this.get(url,options);};
this.get=this.$get=function(url,options){if(!options){options={};}var _self=this;
var id=options.id;var bHasOffline=(typeof apf.offline!="undefined");if(bHasOffline&&!apf.offline.onLine&&options.notWhenOffline){return false;
}if(bHasOffline&&!apf.offline.onLine&&!options.ignoreOffline){if(apf.offline.queue.enabled){var info=apf.extend({url:url,callback:options.callback,retry:function(){_self.get(this.url,this.options);
},$object:[this.name,"apf.oHttp","new apf.http()"],$retry:"this.object.get(this.url, this.options)"},options);
apf.offline.queue.add(info);return;}apf.console.warn("Executing HTTP request even though application is offline");
}var binary=apf.hasXhrBinary&&options.binary;var async=options.async=(options.async||binary||typeof options.async=="undefined"||apf.isOpera||false);
if(apf.isWebkit){url=apf.html_entity_decode(url);}var data=options.data||"";if(apf.isNot(id)){if(this.cache[url]&&this.cache[url][data]){var http={responseText:this.cache[url][data],responseXML:{},status:200,isCaching:true};
}else{var http=apf.getHttpReq();}id=this.queue.push({http:http,url:url,callback:options.callback,retries:0,options:options})-1;
if(http.isCaching){if(async){return $setTimeout("apf.lookup("+this.$uniqueId+").receive("+id+");",50);
}else{return this.receive(id);}}}else{var http=this.queue[id].http;if(http.isCaching){http=apf.getHttpReq();
}else{http.abort();}}if(async){if(apf.hasReadyStateBug){this.queue[id].starttime=new Date().getTime();
this.queue[id].timer=setInterval(function(){var diff=new Date().getTime()-_self.queue[id].starttime;
if(diff>_self.timeout){_self.$timeout(id);return;}if(_self.queue[id].http.readyState==4){clearInterval(_self.queue[id].timer);
_self.receive(id);}},20);}else{http.onreadystatechange=function(){if(!_self.queue[id]||http.readyState!=4){return;
}if(async&&arguments.callee.caller){setTimeout(function(){_self.receive(id);});
}else{_self.receive(id);}};}}var autoroute=this.autoroute&&apf.isOpera?true:(options.autoroute||this.shouldAutoroute),httpUrl=autoroute?this["route-server"]:url;
if(!options.hideLogMessage){apf.console.teleport(this.queue[id].log=new apf.teleportLog({id:id,tp:this,type:options.type,method:this.method||options.method||"GET",url:url,route:autoroute?httpUrl:"",data:new String(data&&data.xml?data.xml:data),start:new Date()}));
}var headers=[];function setRequestHeader(name,value){headers.push(name+": "+value);
http.setRequestHeader(name,value);}var errorFound=false;try{if(options.nocache){httpUrl=apf.getNoCacheUrl(httpUrl);
}if(apf.config.queryAppend){httpUrl+=(httpUrl.indexOf("?")==-1?"?":"&")+apf.config.queryAppend;
}try{if(apf.isGecko){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
}}catch(e){if(apf.hasHtml5XDomain&&httpUrl.match(/^http:\/\//)&&!new apf.url(httpUrl).isSameLocation()){throw new Error(apf.formatErrorString(0,this,"Communication error","Url: "+httpUrl+"\nReason: Same origin policy in effect"));
}}http.open(this.method||options.method||"GET",httpUrl,async);if(options.username){setRequestHeader("Authorization","Basic "+apf.crypto.Base64.encode(options.username+":"+options.password));
}setRequestHeader("X-Requested-With","XMLHttpRequest");if(!options.headers||!options.headers["Content-type"]){setRequestHeader("Content-type",options.contentType||this.contentType||(this.useXML||options.useXML?"text/xml":"text/plain"));
}if(autoroute){setRequestHeader("X-Route-Request",url);setRequestHeader("X-Proxy-Request",url);
setRequestHeader("X-Compress-Response","gzip");}if(binary){setRequestHeader("Cache-Control","no-cache");
setRequestHeader("X-File-Name",binary.filename);setRequestHeader("X-File-Size",binary.filesize);
setRequestHeader("Content-Type","application/octet-stream");}}catch(e){errorFound=e.message;
}if(errorFound){var useOtherXH=false;if(!useOtherXH&&this.autoroute&&!autoroute){if(!apf.isNot(id)){clearInterval(this.queue[id].timer);
}this.shouldAutoroute=true;options.autoroute=true;return this.get(url,options);
}if(!useOtherXH){var noClear=options.callback?options.callback(null,apf.ERROR,{userdata:options.userdata,http:http,url:url,tpModule:this,id:id,message:"Permission denied accessing remote resource: "+url+"\nMessage: "+errorFound}):false;
if(!noClear){this.clearQueueItem(id);}return;}}if(this.$headerHook){this.$headerHook(http);
}if(options.headers){for(var name in options.headers){setRequestHeader(name,options.headers[name]);
}}if(!options.hideLogMessage){this.queue[id].log.request(headers);}function handleError(){var msg=self.navigator&&self.navigator.onLine?"File or Resource not available "+url:"Browser is currently working offline";
apf.console.warn(msg,"teleport");if(!options.hideLogMessage){_self.queue[id].log.response({end:new Date(),message:msg,http:http});
}var state=self.navigator&&navigator.onLine?apf.ERROR:apf.TIMEOUT;var noClear=options.callback?options.callback(null,state,{userdata:options.userdata,http:http,url:url,tpModule:_self,id:id,message:msg}):false;
if(!noClear){_self.clearQueueItem(id);}}function send(isLocal){var hasError;if(apf.isIE&&isLocal){var oldWinOnerror=window.onerror;
window.onerror=function(){if(arguments.caller&&arguments.caller.callee==send){window.onerror=oldWinOnerror;
return true;}else{window.onerror=oldWinOnerror;if(oldWinOnerror){return oldWinOnerror.apply(window,arguments);
}}};http.send(data);window.onerror=oldWinOnerror;}else{try{if(binary&&http.sendAsBinary){binary.blob=getBinaryBlob(data,http,binary);
http.sendAsBinary(binary.blob.data);}else{http.send(data);}}catch(e){hasError=true;
}}if(hasError){handleError();return;}else{if(binary&&http.upload){http.upload.onprogress=function(e){apf.dispatchEvent("http.uploadprogress",{loaded:e.loaded-binary.blob.size,extra:e,bubbles:true});
};}}}if(!async){send.call(this);return this.receive(id);}else{if(apf.loadsLocalFilesSync&&location.protocol=="file:"&&url.indexOf("http://")==-1){$setTimeout(function(){send.call(_self,true);
});}else{send.call(_self);}return id;}};if(!this.exec){this.exec=function(method,args,callback,options){if(!options){options={};
}var url=args[0],query="";if(!options.method){options.method=method.toUpperCase();
}if(!options.callback){options.callback=callback;}this.contentType="application/x-www-form-urlencoded";
this.$get(apf.getAbsolutePath(apf.config.baseurl,url),options.method=="GET"?options:apf.extend({data:query},options));
};}function getBinaryBlob(data,http,binary){var boundary="----apfbound".appendRandomNumber(5),dashdash="--",crlf="\r\n",multipartBlob="",multipartSize=0;
if(binary.multipart){http.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary);
multipartBlob+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+(binary.filedataname||binary.filename)+'"; filename="'+binary.filename+'"'+crlf+"Content-Type: application/octet-stream"+crlf+crlf+data+crlf+dashdash+boundary+dashdash+crlf;
multipartSize=multipartBlob.length-data.length;data=multipartBlob;}return{size:multipartSize,data:data};
}this.receive=function(id){if(!this.queue[id]){return false;}var qItem=this.queue[id],http=qItem.http,callback=qItem.callback;
clearInterval(qItem.timer);if(self.navigator&&navigator.onLine===false&&(location.protocol!="file:"||qItem.url.indexOf("http://")>-1)){return false;
}if(qItem.async){try{if(http.status){}}catch(e){var _self=this;return $setTimeout(function(){_self.receive(id);
},10);}}if(!qItem.options.hideLogMessage){apf.console.info("[HTTP] Receiving ["+id+"]"+(http.isCaching?"[<span style='color:orange'>cached</span>]":"")+" from "+qItem.url,"teleport",http.responseText);
}var errorMessage=[],extra={end:new Date(),tpModule:this,http:http,status:http.status,url:qItem.url,callback:callback,id:id,retries:qItem.retries||0,userdata:qItem.options.userdata};
if(http.status>600){return this.$timeout(id);}extra.data=qItem.options.useJSON?eval("("+http.responseText+")"):http.responseText;
if(http.status>=400&&http.status<600||http.status<10&&(http.status!=0||!apf.isIE&&!http.responseText)){if(http.status==401){var auth=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(auth){var wasDelayed=qItem.isAuthDelayed;qItem.isAuthDelayed=true;if(auth.authRequired(extra,wasDelayed)===true){return;
}}}errorMessage.push("HTTP error ["+id+"]:"+http.status+"\n"+http.responseText);
}if(qItem.options.useXML||this.useXML){if((http.responseText||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){errorMessage.push("Received an empty XML document (0 bytes)");
}else{try{var xmlDoc=(http.responseXML&&http.responseXML.documentElement)?apf.xmlParseError(http.responseXML):apf.getXmlDom(http.responseText);
if(!apf.supportNamespaces){xmlDoc.setProperty("SelectionLanguage","XPath");}extra.data=xmlDoc.documentElement;
}catch(e){errorMessage.push("Received invalid XML\n\n"+e.message);}}}if(errorMessage.length){extra.message=errorMessage.join("\n");
if(qItem.log){qItem.log.response(extra);}if(!callback||!callback(extra.data,apf.ERROR,extra)){this.clearQueueItem(id);
}return;}if(qItem.options.caching){if(!this.cache[qItem.url]){this.cache[qItem.url]={};
}this.cache[qItem.url][qItem.options.data]=http.responseText;}if(qItem.log){qItem.log.response(extra);
}if(!callback||!callback(extra.data,apf.SUCCESS,extra)){this.clearQueueItem(id);
}return extra.data;};this.$timeout=function(id){if(!this.queue[id]){return false;
}var qItem=this.queue[id],http=qItem.http;clearInterval(qItem.timer);try{if(http.status){}}catch(e){var _self=this;
return $setTimeout(function(){_self.$timeout(id);},10);}var callback=qItem.callback;
http.abort();apf.console.info("HTTP Timeout ["+id+"]","teleport");var extra;var noClear=callback?callback(null,apf.TIMEOUT,extra={end:new Date(),userdata:qItem.options.userdata,http:http,url:qItem.url,tpModule:this,id:id,message:"HTTP Call timed out",retries:qItem.retries||0}):false;
if(qItem.log){qItem.log.response(extra);}if(!noClear){this.clearQueueItem(id);}};
this.retryTimeout=function(extra,state,amlNode,oError,maxRetries){if(state==apf.TIMEOUT&&extra.retries<(maxRetries||apf.maxHttpRetries)){return extra.tpModule.retry(extra.id);
}oError=oError||new Error(apf.formatErrorString(0,this,"Communication "+(state==apf.TIMEOUT?"timeout":"error"),"Url: "+extra.url+"\nInfo: "+extra.message));
if((amlNode||apf).dispatchEvent("error",apf.extend({error:oError,state:state,extra:extra,bubbles:true},extra))===false){return 2;
}};this.clearQueueItem=function(id){if(!this.queue[id]){return false;}clearInterval(this.queue[id].timer);
if(apf.releaseHTTP&&!apf.isGecko){apf.releaseHTTP(this.queue[id].http);}this.queue[id]=null;
delete this.queue[id];return true;};this.retry=function(id){if(!this.queue[id]){return false;
}var qItem=this.queue[id];clearInterval(qItem.timer);apf.console.info("[HTTP] Retrying request ["+id+"]","teleport");
qItem.retries++;qItem.options.id=id;this.get(qItem.url,qItem.options);return true;
};this.cancel=function(id){if(id===null){id=this.queue.length-1;}if(!this.queue[id]){return false;
}if(apf.isGecko){this.queue[id].http.abort();}this.clearQueueItem(id);};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(x){var receive=this["receive"];
for(var i=0,l=this.childNodes.length;i<l;i++){if(this.childNodes[i].nodeType!=1){continue;
}var url=this.childNodes[i].getAttribute("url"),callback=self[this.childNodes[i].getAttribute("receive")||receive],options={useXML:this.childNodes[i].getAttribute("type")=="XML",async:!apf.isFalse(this.childNodes[i].getAttribute("async"))};
this[this.childNodes[i].getAttribute("name")]=function(data,userdata){options.userdata=userdata;
options.data=data;return this.get(url,options);};}};this.instantiate=function(x){var url=x.getAttribute("src"),options={async:x.getAttribute("async")!="false",nocache:true};
this.getURL=function(data,userdata){options.data=data;options.userdata=userdata;
options.callback=this.callbacks.getURL;return this.get(url,options);};var name="http"+Math.round(Math.random()*100000);
apf.setReference(name,this);return name+".getURL()";};this.call=function(method,args){this[method].call(this,args);
};}};apf.Init.run("http");apf.USEIFRAME=false;function runTpIframe(){function XMLHttpRequest(){this.$uniqueId=apf.all.push(this);
var _self=this;if(apf.USEIFRAME){this.iframe=document.body.appendChild(document.createElement("iframe"));
this.iframe.style.width="400px";this.iframe.style.height="300px";this.iframe.style.position="absolute";
this.iframe.style.left="0";this.iframe.style.top="0";this.iframe.style.zIndex=1000000000;
document.body.style.display="block";}else{var xml=document.body.appendChild(document.createElement("xml"));
this.xmlDocument=xml.XMLDocument;this.xmlDocument.setProperty("SelectionLanguage","XPath");
document.body.removeChild(xml);}this.readyState=0;this.status=null;this.responseText=null;
this.responseXML=null;this.setRequestHeader=function(){};this.send=function(){this.done=false;
if(apf.USEIFRAME){this.iframe.src=this.url;}else{this.xmlDocument.load(this.url);
}};this.open=function(protocol,url,async){this.method=protocol;this.url=url;this.async=async;
if(apf.USEIFRAME){if(!async){throw new Error(apf.formatErrorString(1081,null,"Iframe callback","Compatibility mode prevents possibility of non-async calls"));
}this.iframe.onload=stateChangeHandlerIframe;}else{this.xmlDocument.async=async;
this.xmlDocument.onreadystatechange=stateChangeHandler;}};this.abort=function(){if(apf.USEIFRAME){this.iframe.onreadystatechange=null;
this.iframe.src="about:blank";_self.done=false;_self.readyState="";}else{this.xmlDocument.abort();
}};var me=this;function stateChangeHandler(){me.receive();}this.receive=function(){this.readyState=this.xmlDocument.readyState;
if(this.readyState==4){this.status=200;this.responseText=this.xmlDocument.responseText||this.xmlDocument.xml;
this.responseXML=this.xmlDocument;}if(this.onreadystatechange){this.onreadystatechange();
}};function stateChangeHandlerIframe(){if(_self.done){return;}_self.done=true;_self.receiveIframe();
}this.receiveIframe=function(){var strXml=this.iframe.contentWindow.document.body.innerText;
strXml=strXml.replace(/^- /gm,"");try{this.responseXML=apf.getXmlDom(strXml);this.responseXML.setProperty("SelectionLanguage","XPath");
this.responseXML.loadXML(strXml);}catch(e){this.responseXML=null;}this.responseText=this.responseXML?this.responseXML.xml:strXml;
this.status=200;this.readyState=4;if(this.onreadystatechange){this.onreadystatechange();
}};}function getDOMParser(message,no_error){var xml=document.body.appendChild(document.createElement("xml"));
var xmlParser=xml.XMLDocument;document.body.removeChild(xml);xmlParser.setProperty("SelectionLanguage","XPath");
if(message){xmlParser.loadXML(message);}if(!no_error){apf.xmlParseError(xmlParser);
}return xmlParser;}}apf.socket=function(){this.pool={};this.callbacks={};this.cache={};
this.timeout=this.timeout||10000;if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;
}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (Socket)]";
};this.saveCache=apf.K;this.loadCache=function(){return true;};this.clearCache=apf.K;
this.getXml=function(url,callback,options){if(!options){options={};}options.useXML=true;
options.callback=callback;return this.get(url,options);};this.get=this.$get=function(url,options){if(!options){options={};
}var socket,_self=this,id=options.id||url,data=options.data||"";function handleError(){var msg="File or Resource not available "+url;
apf.console.warn(msg,"teleport");var state=apf.ERROR;if(options.callback){options.callback(null,state,{userdata:options.userdata,socket:socket,url:url,tpModule:_self,id:id,message:msg});
}}function send(isLocal){var hasError;try{socket.write(data);}catch(e){hasError=true;
}if(hasError){handleError();return;}}if(!(socket=this.pool[id]?this.pool[id].socket:null)){var oUrl=new apf.url(url);
if(!oUrl.host||!oUrl.port){throw new Error("no valid connection string for a socket connection: "+url);
}var net=require("net");socket=net.createConnection(oUrl.port,oUrl.host);socket.setEncoding("utf8");
socket.addListener("connect",function(){send.call(_self);});socket.addListener("data",function(data){if(arguments.callee.caller){setTimeout(function(){_self.receive(id,data);
});}else{_self.receive(id,data);}});socket.addListener("close",function(){apf.console.log("[socket] connection closed");
});socket.addListener("error",function(e){apf.console.log("[socket] connection error: "+e);
});socket.addListener("end",function(){apf.console.log("[socket] connection ended");
_self.pool[id]=null;delete _self.pool[id];});this.pool[id]={socket:socket,url:url,callbacks:[options.callback],retries:0,options:options,received:""};
}else{this.pool[id].callbacks.push(options.callback);send.call(this);}return id;
};if(!this.exec){this.exec=function(method,args,callback,options){if(!options){options={};
}var url=args[0],query="";if(!options.method){options.method=method.toUpperCase();
}if(!options.callback){options.callback=callback;}this.$get(apf.getAbsolutePath(apf.config.baseurl,url),options);
};}this.receive=function(id,data){if(!this.pool[id]){return false;}var qItem=this.pool[id],socket=qItem.socket,callback=qItem.callbacks.shift();
var errorMessage=[],extra={end:new Date(),tpModule:this,socket:socket,url:qItem.url,callback:callback,id:id,retries:qItem.retries||0,userdata:qItem.options.userdata};
extra.data=data;qItem.received+=data;var t=qItem.received.split(/(<\/(?:message|stream:features|challenge)>)/);
if(t.length<=1){return;}data=t[0]+t[1];qItem.received=t[2];if(qItem.options.useXML||this.useXML){if((data||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){errorMessage.push("Received an empty XML document (0 bytes)");
}else{try{var xmlDoc=apf.getXmlDom(data);if(!apf.supportNamespaces){xmlDoc.setProperty("SelectionLanguage","XPath");
}extra.data=xmlDoc.documentElement;}catch(e){errorMessage.push("Received invalid XML\n\n"+e.message);
}}}if(errorMessage.length){extra.message=errorMessage.join("\n");if(callback){callback(extra.data,apf.ERROR,extra);
}return;}if(callback){callback(extra.data,apf.SUCCESS,extra);}return extra.data;
};this.$timeout=function(id){if(!this.pool[id]){return false;}var qItem=this.pool[id],socket=qItem.socket;
try{if(socket.status){}}catch(e){var _self=this;return $setTimeout(function(){_self.$timeout(id);
},10);}var callback=qItem.callback;socket.abort();apf.console.info("Socket Timeout ["+id+"]","teleport");
var extra;var noClear=callback?callback(null,apf.TIMEOUT,extra={end:new Date(),userdata:qItem.options.userdata,socket:socket,url:qItem.url,tpModule:this,id:id,message:"HTTP Call timed out",retries:qItem.retries||0}):false;
};this.retryTimeout=function(extra,state,amlNode,oError,maxRetries){if(state==apf.TIMEOUT&&extra.retries<(maxRetries||apf.maxHttpRetries)){return extra.tpModule.retry(extra.id);
}oError=oError||new Error(apf.formatErrorString(0,this,"Communication "+(state==apf.TIMEOUT?"timeout":"error"),"Url: "+extra.url+"\nInfo: "+extra.message));
if((amlNode||apf).dispatchEvent("error",apf.extend({error:oError,state:state,bubbles:true},extra))===false){return true;
}};this.clearQueueItem=function(id){return;};this.retry=function(id){if(!this.pool[id]){return false;
}var qItem=this.pool[id];apf.console.info("[Socket] Retrying request ["+id+"]","teleport");
qItem.retries++;qItem.options.id=id;this.get(qItem.url,qItem.options);return true;
};this.cancel=function(id){if(id===null){id=this.pool.length-1;}if(!this.pool[id]){return false;
}};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(x){var receive=this["receive"];
for(var i=0,l=this.childNodes.length;i<l;i++){if(this.childNodes[i].nodeType!=1){continue;
}var url=this.childNodes[i].getAttribute("url"),callback=self[this.childNodes[i].getAttribute("receive")||receive],options={useXML:this.childNodes[i].getAttribute("type")=="XML"};
this[this.childNodes[i].getAttribute("name")]=function(data,userdata){options.userdata=userdata;
options.data=data;return this.get(url,options);};}};this.instantiate=function(x){var url=x.getAttribute("src"),options={async:x.getAttribute("async")!="false",nocache:true};
this.getURL=function(data,userdata){options.data=data;options.userdata=userdata;
options.callback=this.callbacks.getURL;return this.get(url,options);};var name="socket"+Math.round(Math.random()*100000);
apf.setReference(name,this);return name+".getURL()";};this.call=function(method,args){this[method].call(this,args);
};}};apf.teleportLog=function(extra){this.setXml=function(pNode){return;};this.request=function(headers){return;
};this.response=function(extra){return;};};apf.DOMParser=function(){};apf.DOMParser.prototype=new (function(){this.caseInsensitive=true;
this.preserveWhiteSpace=false;this.$shouldWait=0;var RE=[/\<\!(DOCTYPE|doctype)[^>]*>/,/&nbsp;/g,/<\s*\/?\s*(?:\w+:\s*)[\w-]*[\s>\/]/g],XPATH="//@*[not(contains(local-name(), '.')) and not(translate(local-name(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz') = local-name())]";
this.parseFromString=function(xmlStr,mimeType,options){var xmlNode;if(this.caseInsensitive){var str=xmlStr.replace(RE[0],"").replace(RE[2],function(m){return m.toLowerCase();
});if(!this.supportNamespaces){str=str.replace(/xmlns\=\"[^"]*\"/g,"");}xmlNode=apf.getXmlDom(str,null,this.preserveWhiteSpace||apf.debug).documentElement;
var i,l,nodes=xmlNode.selectNodes(XPATH);for(i=0,l=nodes.length;i<l;i++){(nodes[i].ownerElement||nodes[i].selectSingleNode("..")).setAttribute(nodes[i].nodeName.toLowerCase(),nodes[i].nodeValue);
}}else{xmlNode=apf.getXmlDom(xmlStr,null,this.preserveWhiteSpace||apf.debug).documentElement;
}return this.parseFromXml(xmlNode,options);};this.parseFromXml=function(xmlNode,options){var doc,docFrag,amlNode,beforeNode;
if(!options){options={};}if(!options.delayedRender&&!options.include){if(options.doc){doc=options.doc;
docFrag=options.docFrag||doc.createDocumentFragment();}else{doc=new apf.AmlDocument();
doc.$aml=xmlNode;doc.$domParser=this;}if(options.host){doc.$parentNode=options.host;
}amlNode=this.$createNode(doc,xmlNode.nodeType,xmlNode);(docFrag||doc).appendChild(amlNode);
if(options.htmlNode){amlNode.$int=options.htmlNode;}}else{amlNode=options.amlNode;
doc=options.doc;if(options.include){var n=amlNode.childNodes;var p=n.indexOf(options.beforeNode);
var rest=p?n.splice(p,n.length-p):[];}}this.$parseContext=[amlNode,options];var nodes,nodelist={},prios=[],_self=this;
(function recur(amlNode,nodes){var cL,newNode,node,nNodes,cNodes=amlNode.childNodes,i=0,l=nodes.length;
for(;i<l;i++){newNode=_self.$createNode(doc,(node=nodes[i]).nodeType,node);if(!newNode){continue;
}cNodes[cL=cNodes.length]=newNode;newNode.parentNode=amlNode;if(cL>0){(newNode.previousSibling=cNodes[cL-1]).nextSibling=newNode;
}if(!newNode.render&&newNode.canHaveChildren&&(nNodes=node.childNodes).length){recur(newNode,nNodes);
}if(newNode.$parsePrio){if(newNode.$parsePrio=="001"){newNode.dispatchEvent("DOMNodeInsertedIntoDocument");
continue;}(nodelist[newNode.$parsePrio]||(prios.push(newNode.$parsePrio)&&(nodelist[newNode.$parsePrio]=[]))).push(newNode);
}}amlNode.firstChild=cNodes[0];amlNode.lastChild=cNodes[cL];})(amlNode,xmlNode.childNodes);
if(options.include&&rest.length){var index=n.length-1;n.push.apply(n,rest);var last=n[index];
var next=n[index+1];(next.previousSibling=last).nextSibling=next;amlNode.lastChild=n[n.length-1];
}if(options.delay){amlNode.$parseOptions={prios:prios,nodelist:nodelist};return(docFrag||doc);
}prios.sort();var i,j,l,l2;for(i=0,l=prios.length;i<l;i++){nodes=nodelist[prios[i]];
for(j=0,l2=nodes.length;j<l2;j++){nodes[j].dispatchEvent("DOMNodeInsertedIntoDocument");
}}if(this.$shouldWait){return(docFrag||doc);}if(options.timeout){$setTimeout(function(){_self.$continueParsing(amlNode,options);
});}else{this.$continueParsing(amlNode,options);}return(docFrag||doc);};this.$callCount=0;
this.$continueParsing=function(amlNode,options){if(this.$shouldWait&&--this.$shouldWait!=0){return false;
}if(!options){options={};}this.$callCount++;if(amlNode.$parseOptions){var prios=amlNode.$parseOptions.prios,nodelist=amlNode.$parseOptions.nodelist,i,j,l,l2,node;
delete amlNode.$parseOptions;prios.sort();for(i=0,l=prios.length;i<l;i++){nodes=nodelist[prios[i]];
for(j=0,l2=nodes.length;j<l2;j++){if(!(node=nodes[j]).parentNode||node.$amlLoaded){continue;
}nodes[j].dispatchEvent("DOMNodeInsertedIntoDocument");}}}if(!options.ignoreSelf&&!amlNode.$amlLoaded){amlNode.dispatchEvent("DOMNodeInsertedIntoDocument");
}(function _recur(nodes){var node,nNodes;for(var i=0,l=nodes.length;i<l;i++){if(!(node=nodes[i]).$parsePrio&&!node.$amlLoaded){node.dispatchEvent("DOMNodeInsertedIntoDocument");
}if(!node.render&&(nNodes=node.childNodes).length){_recur(nNodes);}}})(amlNode.childNodes);
if(!--this.$callCount&&!options.delay){apf.queue.empty();}if(options.callback){options.callback.call(amlNode.ownerDocument);
}delete this.$parseContext;};this.$createNode=function(doc,nodeType,xmlNode,namespaceURI,nodeName,nodeValue){var o;
switch(nodeType){case 1:var id,prefix;if(xmlNode){if((namespaceURI=xmlNode.namespaceURI||apf.ns.xhtml)&&!(prefix=doc.$prefixes[namespaceURI])){doc.$prefixes[prefix=xmlNode.prefix||xmlNode.scopeName||""]=namespaceURI;
doc.$namespaceURIs[namespaceURI]=prefix;if(!doc.namespaceURI&&!prefix){doc.namespaceURI=namespaceURI;
doc.prefix=prefix;}}nodeName=xmlNode.baseName||xmlNode.localName||xmlNode.tagName.split(":").pop();
}else{prefix=doc.$prefixes[namespaceURI]||"";}if(!namespaceURI){throw new Error("Missing namespace definition.");
}if(!apf.namespaces[namespaceURI]){if(this.allowAnyElement){namespaceURI=apf.ns.xhtml;
}else{throw new Error("Missing namespace handler for '"+namespaceURI+"'");}}var els=apf.namespaces[namespaceURI].elements;
if(!(els[nodeName]||els["@default"])){throw new Error("Missing element constructor: "+nodeName);
}o=new (els[nodeName]||els["@default"])(null,nodeName);o.prefix=prefix||"";o.namespaceURI=namespaceURI;
o.tagName=prefix?prefix+":"+nodeName:nodeName;if(xmlNode){if(id=xmlNode.getAttribute("id")){o.$propHandlers.id.call(o,o.id=id);
}var attr=xmlNode.attributes,n;for(var a,i=0,l=attr.length;i<l;i++){o.attributes.push(new apf.AmlAttr(o,(n=(a=attr[i]).nodeName),a.nodeValue));
if(n=="render"){o.render=true;}}}break;case 2:o=new apf.AmlAttr();o.name=o.nodeName=nodeName;
if(nodeValue||(nodeValue=xmlNode&&xmlNode.nodeValue)){o.value=o.nodeValue=nodeValue;
}if(xmlNode){if(xmlNode.namespaceURI&&!(o.prefix=doc.$namespaceURIs[o.namespaceURI=xmlNode.namespaceURI])){doc.$prefixes[o.prefix=xmlNode.prefix||xmlNode.scopeName]=o.namespaceURI;
}}else{o.prefix=doc.$prefixes[namespaceURI];}break;case 3:if(xmlNode){nodeValue=xmlNode&&xmlNode.nodeValue;
}if(!this.preserveWhiteSpace&&!(nodeValue||"").trim()){return;}o=new apf.AmlText();
o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;break;case 7:var target=nodeName||xmlNode&&xmlNode.nodeName;
if(!apf.aml.processingInstructions[target]){throw new Error(apf.formatErrorString(0,null,"The processing instruction does not exist","Could not find the processing instruction with target: "+target));
}o=new apf.aml.processingInstructions[target]();o.target=o.nodeName=target;o.data=o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;
break;case 4:o=new apf.AmlCDATASection();o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;
break;case 5:o=new apf.AmlNode();o.nodeType=nodeType;break;case 6:o=new apf.AmlNode();
o.nodeType=nodeType;break;case 8:o=new apf.AmlComment();o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;
break;case 9:o=new apf.AmlDocument();o.$domParser=this;break;case 10:o=new apf.AmlNode();
o.nodeType=nodeType;break;case 11:o=new apf.AmlDocumentFragment();break;}o.ownerDocument=doc;
o.$aml=xmlNode;return o;};})();apf.AmlNamespace=function(){this.elements={};this.processingInstructions={};
};apf.AmlNamespace.prototype={setElement:function(tagName,fConstr){return this.elements[tagName]=fConstr;
},setProcessingInstruction:function(target,fConstr){this.processingInstructions[target]=fConstr;
}};apf.aml=new apf.AmlNamespace();apf.setNamespace("http://ajax.org/2005/aml",apf.aml);
apf.__AMLNODE__=1<<14;apf.AmlNode=function(){this.$init(function(){this.childNodes=[];
});};(function(){this.toString=function(){if(this.nodeName){return"["+this.nodeName.uCaseFirst()+" Node]";
}return"["+this.localName.uCaseFirst()+" Element Node, <"+(this.prefix?this.prefix+":":"")+this.localName+" "+this.attributes.join(" ")+" /> : "+(this.name||this.$uniqueId||"")+"]";
};this.$regbase=this.$regbase|apf.__AMLNODE__;this.NODE_ELEMENT=1;this.NODE_ATTRIBUTE=2;
this.NODE_TEXT=3;this.NODE_CDATA_SECTION=4;this.NODE_ENTITY_REFERENCE=5;this.NODE_ENTITY=6;
this.NODE_PROCESSING_INSTRUCTION=7;this.NODE_COMMENT=8;this.NODE_DOCUMENT=9;this.NODE_DOCUMENT_TYPE=10;
this.NODE_DOCUMENT_FRAGMENT=11;this.NODE_NOTATION=12;this.ownerDocument=null;this.nodeValue="";
this.namespaceURI="";this.appendChild=this.insertBefore=function(amlNode,beforeNode,noHtmlDomEdit){if(!amlNode||!amlNode.hasFeature||!amlNode.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Invalid argument passed. Expecting an AmlElement."));
}if(this.nodeType==this.NODE_DOCUMENT){if(this.childNodes.length){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Only one top level element is allowed in an AML document."));
}else{this.documentElement=amlNode;}}if(this==amlNode){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Cannot append node as a child of itself."));
}if(amlNode.nodeType==this.NODE_DOCUMENT_FRAGMENT){var nodes=amlNode.childNodes.slice(0);
for(var i=0,l=nodes.length;i<l;i++){this.insertBefore(nodes[i],beforeNode);}return amlNode;
}var isMoveWithinParent=amlNode.parentNode==this,oldParentHtmlNode=amlNode.$pHtmlNode,oldParent=amlNode.parentNode,index=-1,_self=this;
if(beforeNode){index=this.childNodes.indexOf(beforeNode);if(index<0){if(beforeNode==this){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is the same node as inserted node"));
}else{throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is not a child of the parent node specified"));
}return false;}}if(!amlNode.ownerDocument){amlNode.ownerDocument=this.ownerDocument||apf.ownerDocument;
}if(amlNode.parentNode){amlNode.removeNode(isMoveWithinParent,noHtmlDomEdit);}amlNode.parentNode=this;
if(beforeNode){index=this.childNodes.indexOf(beforeNode);}if(beforeNode){amlNode.nextSibling=beforeNode;
amlNode.previousSibling=beforeNode.previousSibling;beforeNode.previousSibling=amlNode;
if(amlNode.previousSibling){amlNode.previousSibling.nextSibling=amlNode;}}if(index>=0){this.childNodes=this.childNodes.slice(0,index).concat(amlNode,this.childNodes.slice(index));
}else{index=this.childNodes.push(amlNode)-1;amlNode.nextSibling=null;if(index>0){amlNode.previousSibling=this.childNodes[index-1];
amlNode.previousSibling.nextSibling=amlNode;}else{amlNode.previousSibling=null;
}}this.firstChild=this.childNodes[0];this.lastChild=this.childNodes[this.childNodes.length-1];
var initialAppend=!amlNode.$amlLoaded;function triggerUpdate(){amlNode.$pHtmlNode=_self.canHaveChildren?_self.$int:document.body;
var nextNode=beforeNode;if(!initialAppend&&!noHtmlDomEdit&&amlNode.$ext&&!amlNode.$coreHtml){nextNode=beforeNode;
while(nextNode&&!(nextNode.$altExt||nextNode.$ext)){nextNode=nextNode.nextSibling;
}amlNode.$pHtmlNode.insertBefore(amlNode.$altExt||amlNode.$ext,nextNode&&(nextNode.$altExt||nextNode.$ext)||null);
}amlNode.dispatchEvent("DOMNodeInserted",{$beforeNode:beforeNode,relatedNode:_self,$isMoveWithinParent:isMoveWithinParent,$oldParentHtmlNode:oldParentHtmlNode,$oldParent:oldParent,bubbles:true});
if(initialAppend&&!noHtmlDomEdit&&beforeNode&&amlNode.$ext&&!amlNode.$coreHtml){nextNode=beforeNode;
while(nextNode&&!(nextNode.$altExt||nextNode.$ext)){nextNode=nextNode.nextSibling;
}amlNode.$pHtmlNode.insertBefore(amlNode.$altExt||amlNode.$ext,nextNode&&(nextNode.$altExt||nextNode.$ext)||null);
}}var doc=this.nodeType==this.NODE_DOCUMENT?this:this.ownerDocument;if(!doc||doc.$domParser.$shouldWait){return amlNode;
}if(this.nodeType==this.NODE_DOCUMENT_FRAGMENT){return;}if(initialAppend){(this.ownerDocument||this).$domParser.$continueParsing(amlNode,{delay:true});
}triggerUpdate();return amlNode;};this.removeNode=function(doOnlyAdmin,noHtmlDomEdit){if(doOnlyAdmin&&typeof doOnlyAdmin!="boolean"){throw new Error(apf.formatErrorString(0,this,"Removing node from parent","Invalid DOM Call. removeNode() does not take any arguments."));
}if(!this.parentNode||!this.parentNode.childNodes){return this;}if(!this.parentNode.childNodes.contains(this)){return false;
}this.parentNode.childNodes.remove(this);if(this.$amlLoaded&&!apf.isDestroying){this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:true,$doOnlyAdmin:doOnlyAdmin});
if(!noHtmlDomEdit&&!doOnlyAdmin&&this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);
}}if(this.parentNode.firstChild==this){this.parentNode.firstChild=this.nextSibling;
}if(this.parentNode.lastChild==this){this.parentNode.lastChild=this.previousSibling;
}if(this.nextSibling){this.nextSibling.previousSibling=this.previousSibling;}if(this.previousSibling){this.previousSibling.nextSibling=this.nextSibling;
}this.$pHtmlNode=this.parentNode=this.previousSibling=this.nextSibling=null;return this;
};this.removeChild=function(childNode){if(!childNode||!childNode.hasFeature||!childNode.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(0,this,"Removing a child node","Invalid Argument. removeChild() requires one argument of type AMLElement."));
}childNode.removeNode();return this;};this.replaceChild=function(){};this.cloneNode=function(deep){if(deep&&this.nodeType==1){return this.ownerDocument.$domParser.parseFromXml(this,{doc:this.ownerDocument,delay:true}).childNodes[0];
}else{return this.ownerDocument.$domParser.$createNode(this.ownerDocument,this.nodeType,this);
}};this.canDispatch=function(namespaceURI,type){};this.compareDocumentPosition=function(otherNode){};
this.hasAttributes=function(){return this.attributes&&this.attributes.length;};
this.hasChildNodes=function(){return this.childNodes&&this.childNodes.length;};
this.isDefaultNamespace=function(namespaceURI){if(node.nodeType==1){if(!this.prefix){return this.namespaceURI==namespaceURI;
}}var node=this.parentNode||this.ownerElement;return node&&node.isDefaultNamespace(namespaceURI);
};this.lookupNamespaceURI=function(prefix){if(node.nodeType==1){if(this.namespaceURI&&prefix==this.prefix){return this.namespaceURI;
}}var node=this.parentNode||this.ownerElement;return node&&node.lookupNamespaceURI(prefix);
};this.lookupPrefix=function(namespaceURI){if(this.nodeType==1){if(namespaceURI==this.namespaceURI&&this.prefix){return this.prefix;
}}var node=this.parentNode||this.ownerElement;return node&&node.lookupPrefix(namespaceURI);
};this.normalize=function(){};this.selectNodes=function(sExpr,contextNode){if(!apf){return;
}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(sExpr,contextNode||(this.nodeType==9?this.documentElement:this));
};this.selectSingleNode=function(sExpr,contextNode){if(!apf){return;}if(!apf.XPath){apf.runXpath();
}return apf.XPath.selectNodes(sExpr,contextNode||(this.nodeType==9?this.documentElement:this))[0];
};}).call(apf.AmlNode.prototype=new apf.Class());apf.AmlElement=function(struct,tagName){var $init=this.$init;
this.$init=function(tagName,nodeFunc,struct){this.$supportedProperties=this.$supportedProperties.slice();
var prop,p,q;p=this.$propHandlers;q=this.$propHandlers={};for(prop in p){q[prop]=p[prop];
}p=this.$booleanProperties;q=this.$booleanProperties={};for(prop in p){q[prop]=p[prop];
}$init.call(this,tagName,nodeFunc,struct);};this.$init(function(tagName,nodeFunc,struct){this.$events={};
this.$inheritProperties={};this.attributes=new apf.AmlNamedNodeMap(this);this.nodeFunc=nodeFunc;
this.localName=tagName;if(struct){var nodes,prop,i,l;if(struct.childNodes){nodes=struct.childNodes;
delete struct.childNodes;}for(prop in struct){if(prop=="htmlNode"){continue;}this.attributes.push(new apf.AmlAttr(this,prop,struct[prop]));
}if(!this.ownerDocument){this.ownerDocument=apf.document;this.prefix="a";this.namespaceURI=apf.ns.aml;
this.tagName=tagName;}if(nodes){this.childNodes=nodes;for(i=0,l=nodes.length;i<l;
i++){nodes[i].nextSibling=nodes[i+1]||null;nodes[i].previousSibling=nodes[i-1]||null;
nodes[i].parentNode=this;}this.firstChild=nodes[0]||null;this.lastChild=nodes[nodes.length-1]||null;
}this.$aml=apf.$emptyNode||(apf.$emptyNode=apf.getXml("<empty />"));}});if(tagName){$init.call(this,tagName,apf.NODE_HIDDEN,struct);
}};(function(){this.nodeType=this.NODE_ELEMENT;this.canHaveChildren=true;this.$propHandlers={id:function(value){if(value=="apf"){throw new Error(apf.formatErrorString(0,this,"Setting Name of Element","Cannot set name of element to 'apf'"));
}if(this.name==value){return;}if(self[this.name]==this){self[this.name]=null;}if(!self[value]||!self[value].hasFeature){try{self[value]=this;
}catch(ex){var error=true;}}if(error&&value in self){apf.console.warn("trying to set a value in the global scope with a reserved name '"+value+"'.\nNothing wrong with that, except that you will not be able to reference\nthe object from the global scope in JS.");
}apf.nameserver.register(this.localName,value,this);this.name=value;}};this.$booleanProperties={};
this.$inheritProperties={};this.$supportedProperties=[];this.getElementsByTagName=function(tagName,norecur){tagName=tagName.toLowerCase();
var node,i,l,nodes=this.childNodes,result=[];for(i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeType!=1){continue;
}if(node.tagName==tagName||tagName=="*"){result.push(node);}if(!norecur&&node.nodeType==1){result=result.concat(node.getElementsByTagName(tagName));
}}return result;};this.getElementsByTagNameNS=function(namespaceURI,localName,norecur){localName=localName.toLowerCase();
var node,i,l,nodes=this.childNodes,result=[];for(i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeType!=1){continue;
}if(node.namespaceURI==namespaceURI&&(node.localName==localName||localName=="*")){result.push(node);
}if(!norecur&&node.nodeType==1){result=result.concat(node.getElementsByTagNameNS(namespaceURI,localName));
}}return result;};this.setAttribute=function(name,value,noTrigger){name=name.toLowerCase();
var a=this.attributes.getNamedItem(name);if(!a){this.attributes.push(a=new apf.AmlAttr(this,name,value));
if(!this.$amlLoaded){return;}if(noTrigger){a.$setValue(value);}else{a.dispatchEvent("DOMNodeInsertedIntoDocument",{relatedNode:this});
a.dispatchEvent("DOMNodeInserted",{relatedNode:this,bubbles:true});}return;}var oldValue=a.nodeValue;
a.$setValue(value);if(noTrigger||!this.$amlLoaded){return;}a.$triggerUpdate(null,oldValue);
};this.setAttributeNode=function(attrNode){this.attributes.setNamedItem(attrNode);
};this.setAttributeNS=function(namespaceURI,name,value){return this.setAttribute(name,value);
};this.hasAttribute=function(name){return this.getAttributeNode(name)?true:false;
};this.hasAttributeNS=function(namespaceURI,name){return this.hasAttribute(name);
};this.removeAttribute=function(name){this.attributes.removeNamedItem(name);return this;
};this.removeAttributeNS=function(namespaceURI,name){return this.removeAttribute(name);
};this.removeAttributeNode=function(attrNode){this.attributes.removeNamedItem(attrNode.name);
};this.getAttribute=function(name,inherited){var item=this.attributes.getNamedItem(name);
return item?(inherited?item.inheritedValue||item.nodeValue:item.nodeValue):null;
};this.getAttributeNode=function(name){return this.attributes.getNamedItem(name);
};this.getBoundingClientRect=function(){return new apf.AmlTextRectangle(this);};
this.querySelector=function(){};this.querySelectorAll=function(){};this.scrollIntoView=function(){};
this.replaceMarkup=function(amlDefNode,options){apf.console.info("Remove all children from element");
if(!options){options={};}if(!options.$intAML){options.$intAML=this.$aml;}if(!options.$int){options.$int=this.$int;
}options.clear=true;for(var i=this.childNodes.length-1;i>=0;i--){var oItem=this.childNodes[i];
if(oItem.destroy){oItem.destroy(true);}if(oItem.$ext!=this.$int){apf.destroyHtmlNode(oItem.$ext);
}}this.childNodes.length=0;this.$int.innerHTML="<div class='loading'>loading...</div>";
this.insertMarkup(amlDefNode,options);};this.insertMarkup=function(amlDefNode,options){apf.console.info("Loading sub markup from external source");
if(typeof apf.offline!="undefined"&&!apf.offline.onLine){return false;}var _self=this;
var include=new apf.XiInclude();if(amlDefNode.trim().charAt(0)=="<"){amlDefNode=apf.getXml(amlDefNode);
}include.setAttribute("href",amlDefNode);if(options&&options.clear){include.setAttribute("clear",true);
}include.options=options;include.callback=options&&options.callback||function(){_self.dispatchEvent("afteramlinserted",{src:amlDefNode});
};this.appendChild(include);};this.serialize=function(shallow){if(shallow||!this.firstChild){return"<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes&&this.attributes.length?" ":"")+(this.attributes&&this.attributes.join(" ")||"")+"/>";
}else{var str=["<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes&&this.attributes.length?" ":"")+(this.attributes&&this.attributes.join(" ")||"")+">"];
for(var i=this.firstChild;i;i=i.nextSibling){str.push(i.serialize());}return str.join("")+"</"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">";
}};this.$setInheritedAttribute=function(prop){var value,node=this,isInherit=false;
value=node.getAttribute(prop);if(!value){node=node.parentNode;while(node&&node.nodeType==1&&!(value=node.getAttribute(prop,true))){node=node.parentNode;
}isInherit=true;}if(!value&&apf.config&&prop){value=apf.config[prop];}if(value){this.$clearDynamicProperty(prop);
if(isInherit){this.$inheritProperties[prop]=2;}if(typeof value=="string"&&(value.indexOf("{")>-1||value.indexOf("[")>-1)){this.$setDynamicProperty(prop,value);
}else{this.setProperty(prop,value,false,false,2);}}return value;};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget!=this||e.$isMoveWithinParent||!e.$oldParent){return;
}var vOld,vNew;var aci=apf.config.$inheritProperties;for(var prop in aci){vOld=apf.getInheritedAttribute(e.$oldParent,prop);
vNew=apf.getInheritedAttribute(this.parentNode,prop);if(vOld!=vNew){(function recur(nodes){var i,l,node,n;
for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType!=1&&node.nodeType!=7){continue;
}n=node.$inheritProperties[prop];if(aci[prop]==1&&!n){recur(node.childNodes);}else{if(!(n<0)){if(n==3){var sameValue=node[prop];
node[prop]=null;}node.setProperty(prop,n!=3?vNew:sameValue,false,false,n);}}}})([this]);
}}});this.$handlePropSet=function(prop,value,force){if(value&&this.$booleanProperties[prop]){value=apf.isTrue(value);
}if(typeof this[prop]=="function"){throw new Error("Could not set property/attribute '"+prop+"' which has the same name as a method on this object: '"+this.toString()+"'");
}this[prop]=value;var handler;return(handler=this.$propHandlers&&this.$propHandlers[prop]||this.nodeFunc==apf.NODE_VISIBLE&&apf.GuiElement&&apf.GuiElement.propHandlers[prop]||null)&&handler.call(this,value,prop,force);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var a,i,l,attr=this.attributes;
if(typeof apf.offline!="undefined"&&apf.offline.state.enabled){var offlineLookup=apf.offline.state.getAll(this);
for(i in offlineLookup){a=attr.getNamedItem(i);if(a){a.$setValue(offlineLookup[i]);
}else{this.attributes.push(new apf.AmlAttr(this,i,offlineLookup[i]));}}}var defs=apf.nameserver.getAll("defaults_"+this.localName);
if(defs.length){for(var j=0,jl=defs.length;j<jl;j++){var d=defs[j].attributes,di;
for(i=0,l=d.length;i<l;i++){a=attr.getNamedItem((di=d[i]).nodeName);if(a){if(a.value){continue;
}a.$setValue(di.nodeValue);this.$inheritProperties[di.nodeName]=2;}else{this.attributes.push(new apf.AmlAttr(this,di.nodeName,di.nodeValue));
this.$inheritProperties[di.nodeName]=2;}}}}for(i=0,l=attr.length;i<l;i++){attr[i].dispatchEvent("DOMNodeInsertedIntoDocument");
}this.$amlLoaded=true;},true);}).call(apf.AmlElement.prototype=new apf.AmlNode());
apf.AmlCharacterData=function(){this.data="";this.length=0;this.$init(true);this.appendData=function(sValue){this.dispatchEvent("DOMCharacterDataModified",{value:sValue});
};this.deleteData=function(nOffset,nCount){this.dispatchEvent("DOMCharacterDataModified",{offset:nOffset,count:nCount});
};this.insertData=function(nOffset,nCount){this.dispatchEvent("DOMCharacterDataModified",{offset:nOffset,count:nCount});
};this.replaceData=function(nOffset,nCount,sValue){this.dispatchEvent("DOMCharacterDataModified",{offset:nOffset,count:nCount,value:sValue});
};this.substringData=function(nOffset,nCount){};};apf.AmlCharacterData.prototype=new apf.AmlNode();
apf.AmlText=function(isPrototype){this.$init(isPrototype);};(function(){this.nodeType=this.NODE_TEXT;
this.nodeName="#text";this.serialize=function(){return apf.xmlentities(this.nodeValue).replace(/</g,"&lt;").replace(/>/g,"&gt;");
};this.$setValue=function(value){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,prevValue:this.nodeValue,newValue:this.nodeValue=value});
if(this.$amlLoaded&&this.$ext){this.$ext.nodeValue=value;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)||this.parentNode.hasFeature(apf.__CHILDVALUE__)){return;
}this.$amlLoaded=true;var nodeValue=this.nodeValue;if(apf.config.liveText&&!this.parentNode.hasFeature(apf.__CHILDVALUE__)&&(nodeValue.indexOf("{")>-1||nodeValue.indexOf("[")>-1)){this.$supportedProperties=[];
this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};this.$propHandlers.calcdata=apf.LiveMarkupPi.prototype.$propHandlers.calcdata;
this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.implement(apf.StandardBinding);
pHtmlNode.appendChild(this.$ext=document.createElement("span"));this.$setDynamicProperty("calcdata",this.nodeValue);
return;}if(apf.hasTextNodeWhiteSpaceBug){var nodeValue=nodeValue.replace(/[\t\n\r ]+/g," ");
if(nodeValue&&nodeValue!=" "){this.$ext=pHtmlNode.appendChild(pHtmlNode.ownerDocument.createTextNode(nodeValue));
}}else{this.$ext=pHtmlNode.appendChild(pHtmlNode.ownerDocument.createTextNode(nodeValue));
}},true);}).call(apf.AmlText.prototype=new apf.AmlCharacterData());apf.AmlAttr=function(ownerElement,name,value){this.$init();
if(ownerElement){this.ownerElement=ownerElement;this.ownerDocument=ownerElement.ownerDocument;
}this.nodeName=this.name=name;this.nodeValue=this.value=value;};(function(){this.nodeType=this.NODE_ATTRIBUTE;
this.MODIFICATION=1;this.ADDITION=2;this.REMOVAL=3;this.serialize=this.toString=function(){return this.name+'="'+apf.xmlentities(String(this.value)).replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"';
};this.$setValue=function(value){this.nodeValue=this.value=value;this.specified=true;
this.ownerElement.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:this.name,newValue:value,prevValue:this.$lastValue||"",bubbles:true});
this.$lastValue=value;};this.$triggerUpdate=function(e,oldValue){var name=this.name,value=this.value||this.nodeValue,host=this.ownerElement;
if(name=="id"&&!this.specified&&host.id){this.specified=true;return;}if(name.substr(0,2)=="on"){if(host.$events[name]){host.removeEventListener(name.replace(/^on/,""),host.$events[name]);
}if(value){host.addEventListener(name,(host.$events[name]=(typeof value=="string"?apf.lm.compile(value,{event:true,parsecode:true}):value)));
}return;}if(this.specified){host.$clearDynamicProperty(name);}if(typeof value=="string"&&(host.$attrExcludePropBind[name]||(value.indexOf("{")>-1||value.indexOf("[")>-1))){host.$setDynamicProperty(name,value);
}else{host.setProperty(name,value);}if(this.specified){host.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:name,newValue:value,prevValue:this.$lastValue||"",bubbles:true});
}else{this.specified=true;}this.$lastValue=value;};this.addEventListener("DOMNodeInsertedIntoDocument",this.$triggerUpdate);
}).call(apf.AmlAttr.prototype=new apf.AmlNode());apf.AmlCDATASection=function(isPrototype){this.nodeType=this.NODE_CDATA_SECTION;
this.nodeName="#cdata-section";this.$init(isPrototype);};apf.AmlCDATASection.prototype=new apf.AmlText(true);
apf.AmlCDATASection.prototype.serialize=function(){return"<![CDATA["+this.nodeValue+"]]>";
};apf.AmlComment=function(isPrototype){this.nodeType=this.NODE_COMMENT;this.nodeName="#comment";
this.$init(isPrototype);};(function(){this.serialize=function(){return"<!--"+this.nodeValue+"-->";
};this.$setValue=function(value){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,newValue:value,prevValue:this.nodeValue});
};}).call(apf.AmlComment.prototype=new apf.AmlCharacterData());apf.AmlConfiguration=function(isPrototype){this.parameterNames=[];
this.$init(isPrototype);};(function(){this.setParameter=this.setProperty;this.getParameter=this.getProperty;
this.canSetParameter=function(name,value){return this.parameterNames.indexOf(name)>-1;
};}).call(apf.AmlConfiguration.prototype=new apf.Class());apf.AmlDocument=function(){this.$prefixes={};
this.$namespaceURIs={};this.domConfig=new apf.AmlConfiguration();this.$init();};
(function(){this.nodeType=this.NODE_DOCUMENT;this.nodeFunc=apf.NODE_HIDDEN;this.nodeName="#document";
this.$amlLoaded=true;this.activeElement=null;this.doctype=null;this.domConfig=null;
this.implementation=null;this.characterSet=apf.characterSet;this.documentElement=null;
this.getElementById=function(id){return self[id];};this.getElementsByTagName=function(tagName){var docEl,res=(docEl=this.documentElement).getElementsByTagName(tagName);
if(tagName=="*"||docEl.tagName==tagName){res.unshift(docEl);}return res;};this.getElementsByTagNameNS=function(nameSpaceURI,tagName){var docEl,res=(docEl=this.documentElement).getElementsByTagNameNS(nameSpaceURI,tagName);
if(tagName=="*"||docEl.tagName==tagName&&docEl.namespaceURI==nameSpaceURI){res.unshift(docEl);
}return res;};this.createElement=function(qualifiedName){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,this.namespaceURI,qualifiedName);
};this.createElementNS=function(namespaceURI,qualifiedName){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,namespaceURI,qualifiedName);
};this.importNode=function(node,deep){if(deep&&node.nodeType==1){return this.$domParser.parseFromXml(node,{doc:this,delay:true}).childNodes[0];
}else{return this.$domParser.$createNode(this,node.nodeType,node);}};this.createAttribute=function(nodeName){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,this.nameSpaceURI,nodeName);
};this.createAttributeNS=function(nameSpaceURI,nodeName){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,nameSpaceURI,nodeName);
};this.createEvent=function(){return new apf.AmlEvent();};this.createComment=function(nodeValue){return this.$domParser.$createNode(this,this.NODE_COMMENT,null,null,null,nodeValue);
};this.createProcessingInstruction=function(target,data){return this.$domParser.$createNode(this,this.NODE_PROCESSING_INSTRUCTION,null,null,target,data);
};this.createCDATASection=function(nodeValue){return this.$domParser.$createNode(this,this.NODE_CDATA_SECTION,null,null,null,nodeValue);
};this.createTextNode=function(nodeValue){return this.$domParser.$createNode(this,this.NODE_TEXT,null,null,null,nodeValue);
};this.createDocumentFragment=function(){return this.$domParser.$createNode(this,this.NODE_DOCUMENT_FRAGMENT);
};this.querySelector=function(){};this.querySelectorAll=function(){};this.evaluate=function(sExpr,contextNode,nsResolver,type,x){var result=apf.XPath.selectNodes(sExpr,contextNode||this.documentElement);
return{snapshotLength:result.length,snapshotItem:function(i){return result[i];}};
};this.createNSResolver=function(contextNode){return{};};this.hasFocus=function(){};
var selection;this.getSelection=function(){if(!selection){selection=new apf.AmlSelection(this);
}return selection;};var selectrect;this.$getSelectRect=function(){if(!selectrect){selectrect=new apf.selectrect();
}return selectrect;};var visualselect;this.$getVisualSelect=function(){if(!visualselect){visualselect=new apf.visualSelect(this.getSelection());
}return visualselect;};var visualconnect;this.$getVisualConnect=function(){if(!visualconnect){visualconnect=new apf.visualConnect(this.getSelection());
}return visualconnect;};this.createRange=function(){return new apf.AmlRange(this);
};this.queryCommandState=function(commandId){return(this.$commands[commandId.toLowerCase()]||apf.K).call(this,null,null,null,1)||false;
};this.queryCommandValue=function(commandId){return(this.$commands[commandId.toLowerCase()]||apf.K).call(this,null,null,null,2)||false;
};this.queryCommandEnabled=function(commandId){return(this.$commands[commandId.toLowerCase()]||apf.K).call(this,this.getSelection().$getNodeList(),false,arguments[2],3)||false;
};this.queryCommandIndeterm=function(commandId){return(this.$commands[commandId.toLowerCase()]||apf.K).call(this,null,null,null,4)||false;
};this.queryCommandSupported=function(commandId){return this.$commands[commandId.toLowerCase()]?true:false;
};var special={commit:1,rollback:1,begin:1,undo:1,redo:1,contextmenu:2,mode:2,pause:1};
this.execCommand=function(commandId,showUI,value,query){var f;if(!(f=this.$commands[commandId.toLowerCase()])){return false;
}if(special[commandId]==1){return f.call(this,null,null,value);}var nodes=this.$getVisualSelect().getLastSelection()||this.getSelection().$getNodeList();
if(special[commandId]==2){f.call(this,nodes,showUI,value,query);}else{this.$commands.begin.call(this);
if(f.call(this,nodes,showUI,value,query)===false){this.$commands.rollback.call(this);
}else{this.$commands.commit.call(this);}}};this.$commands={};}).call(apf.AmlDocument.prototype=new apf.AmlNode());
apf.AmlDocumentFragment=function(isPrototype){this.$init(isPrototype);};apf.AmlDocumentFragment.prototype=new apf.AmlNode();
apf.AmlDocumentFragment.prototype.nodeName="#document-fragment";apf.AmlDocumentFragment.prototype.nodeType=apf.AmlDocumentFragment.prototype.NODE_DOCUMENT_FRAGMENT;
apf.AmlEvent=function(name,data){this.name=name;var prop;for(prop in data){this[prop]=data[prop];
}};apf.AmlEvent.prototype={bubbles:false,cancelBubble:false,preventDefault:function(){this.returnValue=false;
},stopPropagation:function(){this.cancelBubble=true;},stop:function(){this.returnValue=false;
this.cancelBubble=true;}};apf.AmlNamedNodeMap=function(host){this.$host=host;};
(function(){this.getNamedItem=function(name){for(var i=0;i<this.length;i++){if(this[i].name==name){return this[i];
}}return false;};this.setNamedItem=function(node){var name=node.name;for(var item,i=this.length-1;
i>=0;i--){if(this[i].name==name){this[i].ownerElement=null;this.splice(i,1);break;
}}this.push(node);node.ownerElement=this.$host;node.ownerDocument=this.$host.ownerDocument;
node.$triggerUpdate();};this.removeNamedItem=function(name){for(var item,i=this.length-1;
i>=0;i--){if(this[i].name==name){item=this[i];this.splice(i,1);break;}}if(!item){return false;
}var oldValue=item.nodeValue;item.nodeValue=item.value="";item.$triggerUpdate(null,oldValue);
item.ownerElement=null;item.nodeValue=item.value=oldValue;return item;};this.item=function(i){return this[i];
};this.length=0;this.splice=function(pos,length){for(var i=pos,l=this.length-length;
i<l;i++){this[i]=this[i+1];}delete this[i];this.length-=length;};this.push=function(o){this[this.length++]=o;
return this.length;};this.join=function(glue){var x=[];for(var e,a,i=0,l=this.length;
i<l;i++){if((e=(a=this[i]).ownerElement)&&e.$inheritProperties[a.nodeName]!=2){x.push(this[i]);
}}return x.join(glue);};}).call(apf.AmlNamedNodeMap.prototype={});apf.AmlProcessingInstruction=function(isPrototype){this.$init(isPrototype);
};(function(){this.nodeType=this.NODE_PROCESSING_INSTRUCTION;this.data=null;this.target=null;
this.serialize=function(){return"<?"+this.target+"\n"+apf.xmlentities(this.nodeValue)+"\n?>";
};this.reload=function(){this.$handlePropSet("data",this.data);};this.$attrExcludePropBind=apf.extend({calcdata:0},this.$attrExcludePropBind);
this.getAttribute=function(){};this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;
this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};
apf.LiveEdit&&this.implement(apf.LiveEdit);this.$setValue=function(value){this.setProperty("data",value);
};this.$handlePropSet=function(prop,value,force){this[prop]=value;if(prop=="data"){this.$clearDynamicProperty("calcdata");
this.$setDynamicProperty("calcdata",value);}else{if(prop=="liveedit"){this.$propHandlers.liveedit.call(this,value);
this.$clearDynamicProperty("calcdata");this.$setDynamicProperty("calcdata",this.data);
}else{if(prop=="target"){}else{if(this.$propHandlers[prop]){this.$propHandlers[prop].call(this,value,prop);
}}}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode=e.pHtmlNode;
if(!pHtmlNode&&(this.parentNode.$bindingRule||!(pHtmlNode=this.parentNode.$int))){return;
}pHtmlNode.appendChild(this.$ext=document.createElement("span"));this.$ext.host=this;
if(!this.hasFeature(apf.__LIVEEDIT__)){this.implement(apf.LiveEdit);}this.liveedit=apf.isTrue(apf.getInheritedAttribute(this,"liveedit"));
if(this.liveedit){this.$inheritProperties.liveedit=2;this.$propHandlers.liveedit.call(this,this.liveedit);
}this.$setDynamicProperty("calcdata",this.data);if(this.target.match(/\-debug$/)){apf.console.info(this.$lastFParsed.toString());
}},true);this.$destroy=function(){this.$clearDynamicProperty("calcdata");this.$propHandlers.calcdata.call(this,"");
};}).call(apf.AmlProcessingInstruction.prototype=new apf.AmlNode());apf.AmlRange=function(doc){this.$init();
this.$ownerDocument=this.startContainer=this.endContainer=doc||apf.document;this.startOffset=this.endOffset=0;
var _self=this;this.$domCharModS=function(e){};this.$domCharModE=function(e){};
this.$domNodeInsS=function(e){if(e.relatedNode==this&&e.currentTarget.nodeType!=2){var nr=apf.getChildNumber(e.currentTarget);
if(nr<_self.startOffset){_self.startOffset++;}}};this.$domNodeInsE=function(e){if(e.relatedNode==this&&e.currentTarget.nodeType!=2){var nr=apf.getChildNumber(e.currentTarget);
if(nr<_self.endOffset){_self.endOffset++;}}};this.$domNodeRemS=function(e){if(e.relatedNode==this&&e.currentTarget.nodeType!=2){var nr=apf.getChildNumber(e.currentTarget);
if(nr<_self.startOffset){_self.startOffset--;}}};this.$domNodeRemE=function(e){if(e.relatedNode==this&&e.currentTarget.nodeType!=2){var nr=apf.getChildNumber(e.currentTarget);
if(nr<_self.endOffset){_self.endOffset--;}}};this.$domNodeRemDoc=function(e){if(apf.isChildOf(e.currentTarget,_self.startContainer,true)){_self.setStart(e.currentTarget.parentNode,apf.getChildNumber(e.currentTarget));
}if(apf.isChildOf(e.currentTarget,_self.endContainer,true)){_self.setEnd(e.currentTarget.parentNode,apf.getChildNumber(e.currentTarget));
}};this.$ownerDocument.addEventListener("DOMNodeRemoved",this.$domNodeRemDoc);};
(function(){this.START_TO_START=0;this.START_TO_END=1;this.END_TO_END=2;this.END_TO_START=3;
this.collapsed=true;this.commonAncestorContainer=null;this.$detached=false;this.toString=function(){return"[apf.AmlRange]";
};var charNode={2:1,3:1,4:1,7:1};this.setStart=function(refNode,offset,noEvent){if(!refNode){return;
}if(offset<0||offset>(charNode[refNode.nodeType]?refNode.nodeValue.length:refNode.childNodes.length)){return;
}if(charNode[this.startContainer.nodeType]){this.startContainer.removeEventListener("DOMCharacterDataModified",this.$domCharModS);
}else{this.startContainer.removeEventListener("DOMNodeInserted",this.$domNodeInsS);
this.startContainer.removeEventListener("DOMNodeRemoved",this.$domNodeRemS);}this.startContainer=refNode;
this.startOffset=offset;this.collapsed=this.startContainer==this.endContainer&&this.startOffset==this.endOffset;
if(charNode[refNode.nodeType]){refNode.addEventListener("DOMCharacterDataModified",this.$domCharModS);
}else{refNode.addEventListener("DOMNodeInserted",this.$domNodeInsS);refNode.addEventListener("DOMNodeRemoved",this.$domNodeRemS);
}if(!noEvent){this.dispatchEvent("update");}};this.setStartBefore=function(refNode){this.setStart(this.endContainer.parentNode,apf.getChildNumber(refNode));
};this.setStartAfter=function(refNode){this.setStart(this.endContainer.parentNode,apf.getChildNumber(refNode)+1);
};this.setEnd=function(refNode,offset,noEvent){if(!refNode){return;}if(offset<0||offset>(charNode[refNode.nodeType]?refNode.nodeValue.length:refNode.childNodes.length)){return;
}if(charNode[this.endContainer.nodeType]){this.endContainer.removeEventListener("DOMCharacterDataModified",this.$domCharModE);
}else{this.endContainer.removeEventListener("DOMNodeInserted",this.$domNodeInsE);
this.endContainer.removeEventListener("DOMNodeRemoved",this.$domNodeRemE);}this.endContainer=refNode;
this.endOffset=offset;this.collapsed=this.startContainer==this.endContainer&&this.startOffset==this.endOffset;
if(charNode[refNode.nodeType]){refNode.addEventListener("DOMCharacterDataModified",this.$domCharModE);
}else{refNode.addEventListener("DOMNodeInserted",this.$domNodeInsE);refNode.addEventListener("DOMNodeRemoved",this.$domNodeRemE);
}if(!noEvent){this.dispatchEvent("update");}};this.setEndBefore=function(refNode){this.setEnd(this.endContainer.parentNode,apf.getChildNumber(refNode));
};this.setEndAfter=function(refNode){this.setEnd(this.endContainer.parentNode,apf.getChildNumber(refNode)+1);
};this.collapse=function(toStart){if(toStart){this.setEnd(this.startContainer,this.startOffset,true);
}else{this.setStart(this.endContainer,this.endOffset,true);}this.dispatchEvent("update");
};this.selectNode=function(refNode){this.setStart(refNode.parentNode,apf.getChildNumber(refNode),true);
this.setEnd(refNode.parentNode,this.startOffset+1);};this.selectNodeContents=function(refNode){this.setStart(refNode,0,true);
this.setEnd(refNode,refNode.childNodes.length);};this.$contents=function(clone){var s=this.startContainer,e=this.endContainer,cA=e.childNodes[this.endOffset],last,simple=s==e;
while(cA&&!apf.isChildOf(cA,s,true)){cA=(last=cA).parentNode;}if(!cA){return;}var collection=[];
var node=s.childNodes[this.startOffset];var doc=this.startContainer.ownerDocument;
var frag=doc.createDocumentFragment();if(s!=e&&s!=cA){var pNode=s.cloneNode(false);
while(node.parentNode!=cA){pNode.appendChild(clone?node.cloneNode(true):node);if(!node.nextSibling){do{node=node.parentNode;
pNode=node.cloneNode(false).appendChild(pNode).parentNode;}while(!node.nextSibling);
if(node.parentNode==cA){break;}}node=node.nextSibling;}frag.appendChild(pNode);
}while(node!=last){node=node.nextSibling;frag.appendChild(clone?node.cloneNode(true):node);
}if(s!=e&&e!=cA){var pNode=e.cloneNode(false);var node=last.previousSibling||last.parentNode;
while(node.parentNode!=cA){pNode.appendChild(clone?node.cloneNode(true):node);if(!node.previousSibling){do{node=node.parentNode;
pNode=node.cloneNode(false).appendChild(pNode).parentNode;}while(!node.previousSibling);
if(node.parentNode==cA){break;}}node=node.previousSibling;}frag.appendChild(pNode);
}return frag;};this.compareBoundaryPoints=function(how,sourceRange){var d;switch(how){case this.START_TO_START:d=this.startOffset-sourceRange.startOffset;
break;case this.START_TO_END:d=this.startOffset-sourceRange.endOffset;break;case this.END_TO_START:d=this.endOffset-sourceRange.startOffset;
break;case this.END_TO_END:d=this.endOffset-sourceRange.endOffset;break;}return d<0?-1:(d>0?1:0);
};this.deleteContents=function(){this.$contents().destroy();this.collapse();};this.extractContents=function(){var frag=this.$contents();
this.collapse();return frag;};this.cloneContents=function(){return this.$contents(true);
};this.insertNode=function(newNode){this.collapsed=false;};this.surroundContents=function(newParent){this.setStart(newParent,newParent.childNodes.length,true);
newParent.appendChild(this.$contents());this.setEnd(newParent,newParent.childNodes.length);
};this.cloneRange=function(){var range=new apf.AmlRange();range.setStart(this.startContainer,this.startOffset,true);
range.setEnd(this.endContainer,this.endOffset);return range;};this.detach=function(){this.startContainer=this.endContainer=null;
function detachError(){}for(var prop in this){if(typeof this[prop]=="function"&&this[prop]!=apf.Class.prototype[prop]){this[prop]=detachError;
}}this.$ownerDocument.removeEventListener("DOMNodeRemoved",this.$domNodeRemDoc);
if(this.startContainer){if(charNode[this.startContainer.nodeType]){this.startContainer.removeEventListener("DOMCharacterDataModified",this.$domCharModS);
}else{this.startContainer.removeEventListener("DOMNodeInserted",this.$domNodeInsS);
this.startContainer.removeEventListener("DOMNodeRemoved",this.$domNodeRemS);}if(charNode[this.endContainer.nodeType]){this.endContainer.removeEventListener("DOMCharacterDataModified",this.$domCharModE);
}else{this.endContainer.removeEventListener("DOMNodeInserted",this.$domNodeInsE);
this.endContainer.removeEventListener("DOMNodeRemoved",this.$domNodeRemE);}}};}).call(apf.AmlRange.prototype=new apf.Class());
apf.AmlSelection=function(doc){this.$init();this.$ownerDocument=doc;var _self=this;
var monitor=false;this.$monitorRange=function(){apf.queue.add("selrange"+this.$uniqueId,function(){var range=_self.$ranges[0];
_self.anchorNode=range.startContainer;_self.anchorOffset=range.startOffset;range=_self.$ranges[_self.rangeCount-1];
_self.focusNode=range.endContainer;_self.focusOffset=range.endOffset;monitor=false;
});monitor=true;};var update=false;this.$update=function(){if(!update){apf.queue.add("selupdate"+this.$uniqueId,function(){_self.dispatchEvent("update");
update=false;});update=true;}};};(function(){this.anchorNode=null;this.anchorOffset=0;
this.focusNode=null;this.focusOffset=null;this.rangeCount=0;this.$ranges=[];this.toString=function(){return"[apf.AmlSelection]";
};this.isCollapsed=function(){return !this.rangeCount||this.rangeCount==1&&this.$ranges[0].collapsed;
};this.collapse=function(parentNode,offset,noEvent){for(var i=0,l=this.$ranges.length;
i<l;i++){(range=this.$ranges[i]).removeEventListener("update",this.$monitorRange);
range.detach();}var range;this.$ranges=[range=new apf.AmlRange(this.ownerDocument)];
range.addEventListener("update",this.$monitorRange);range.setStart(parentNode,offset);
range.setEnd(parentNode,offset);this.rangeCount=1;this.focusNode=this.anchorNode=parentNode;
this.anchorOffset=this.focusOffset=offset;if(!noEvent){this.dispatchEvent("update");
}};this.collapseToStart=function(){if(!this.rangeCount){return;}var range=this.$ranges[0];
this.collapse(range.startContainer,range.startOffset);};this.collapseToEnd=function(){if(!this.rangeCount){return;
}var range=this.$ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset);
};this.selectAllChildren=function(parentNode){this.collapse(parentNode,0,true);
var range=this.$ranges[0];range.selectNodeContents(parseNode);this.focusNode=this.anchorNode=parentNode;
this.anchorOffset=0;this.focusOffset=range.endOffset;this.$update();};this.deleteFromDocument=function(){for(var i=0,l=this.$ranges.length;
i<l;i++){this.$ranges[i].deleteContents();}var range=this.$ranges[0];this.anchorNode=range.startContainer;
this.anchorOffset=range.startOffset;range=this.$ranges[this.rangeCount-1];this.focusNode=range.endContainer;
this.focusOffset=range.endOffset;this.$update();};this.getRangeAt=function(index){return this.$ranges[index];
};this.addRange=function(range){this.rangeCount=this.$ranges.push(range);this.focusNode=range.endContainer;
this.focusOffset=range.endOffset;range.addEventListener("update",this.$monitorRange);
this.$update();return range;};this.removeRange=function(range){this.$ranges.remove(range);
this.rangeCount=this.$ranges.length;range.removeEventListener("update",this.$monitorRange);
var range=this.$ranges[0];this.anchorNode=range.startContainer;this.anchorOffset=range.startOffset;
range=this.$ranges[this.rangeCount-1];this.focusNode=range.endContainer;this.focusOffset=range.endOffset;
this.$update();};this.removeAllRanges=function(){for(var range,i=0,l=this.$ranges.length;
i<l;i++){(range=this.$ranges[i]).removeEventListener("update",this.$monitorRange);
range.detach();}this.$ranges=[];this.rangeCount=0;this.anchorNode=null;this.anchorOffset=0;
this.focusNode=null;this.focusOffset=0;this.$update();};this.$getNodeList=function(){var nodes=[];
for(var r,i=0;i<this.rangeCount;i++){nodes.push((r=this.$ranges[i]).startContainer.childNodes[r.startOffset]);
}return nodes;};this.$selectList=function(list){this.removeAllRanges();for(var i=0;
i<list.length;i++){this.addRange(new apf.AmlRange(this)).selectNode(list[i]);}};
this.$getFirstNode=function(){var r;return(r=this.$ranges[0]).startContainer.childNodes[r.startOffset];
};}).call(apf.AmlSelection.prototype=new apf.Class());apf.AmlTextRectangle=function(host){var _self=this;
function handler(){var pos=_self.getAbsolutePosition(_self.$ext);_self.setProperty("left",pos[0]);
_self.setProperty("top",pos[1]);_self.setProperty("right",document.documentElement.offsetWidth-pos[0]);
_self.setProperty("bottom",document.documentElement.offsetWidth-pos[1]);}host.addEventListener("prop.width",handler);
host.addEventListener("prop.height",handler);host.addEventListener("prop.left",handler);
host.addEventListener("prop.top",handler);handler.call(host);};apf.AmlTextRectangle.prototype=new apf.Class();
apf.xhtml=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/1999/xhtml",apf.xhtml);
apf.XhtmlElement=function(struct,tagName){this.$init(tagName||true,apf.NODE_VISIBLE,struct);
this.$xoe=this.addEventListener;this.addEventListener=this.$xae;this.removeEventListener=this.$xre;
var _self=this;this.$de=function(e){_self.dispatchEvent(e.type,null,e);};};(function(){var excludedEvents={contextmenu:1,keydown:1,keypress:1,keyup:1,DOMNodeInserted:2,DOMNodeInsertedIntoDocument:2,DOMNodeRemoved:2,DOMNodeRemovedFromDocument:2};
this.$xae=function(type,fn){this.$xoe.apply(this,arguments);if(excludedEvents[type]>(this.editable?0:1)||type.substr(0,5)=="prop."){return;
}if(this.$ext){if(type.substr(0,2)=="on"){type=type.substr(2);}apf.addListener(this.$ext,type,this.$de);
}};this.$xre=function(type,fn){apf.AmlElement.prototype.removeEventListener.apply(this,arguments);
if(this.editable&&"contextmenu|keydown|keypress|keyup".indexOf(type)>-1){return;
}if(this.$ext){apf.removeListener(this.$ext,type,this.$de);}};this.$handlePropSet=function(name,value,force,inherit){if(this.$booleanProperties[name]){value=apf.isTrue(value);
}this[name]=value;var handler=this.$propHandlers&&this.$propHandlers[name]||apf.GuiElement.propHandlers[name];
if(handler){handler.call(this,value,null,name);}else{if(this.$int&&(force||this.$amlLoaded)){this.$int.setAttribute(apf.isIE&&apf.isIE<8&&name=="class"?"className":name,value);
}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.$pHtmlNode=this.parentNode.$int)){return;}var str,aml=this.$aml;
if(aml){if(aml.serialize){str=aml.serialize();}else{aml=aml.cloneNode(false);str=aml.xml||aml.nodeValue;
}str=str.replace(/ on\w+="[^"]*"| on\w+='[^']*'/g,"");this.$ext=this.$int=apf.insertHtmlNode(null,pHtmlNode,null,apf.html_entity_decode(str));
}else{this.$ext=this.$int=pHtmlNode.appendChild(document.createElement(this.localName));
}if(this.localName!="a"){this.$ext.host=this;}this.style=this.$ext.style;},true);
this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$amlLoaded=true;
if(this.$setLayout){this.$setLayout();}});}).call(apf.XhtmlElement.prototype=new apf.AmlElement());
apf.Init.addConditional(function(){if(apf.isO3){return;}var prot=apf.XhtmlElement.prototype;
prot.implement(apf.Anchoring);prot.$drawn=true;prot.$setLayout=apf.GuiElement.prototype.$setLayout;
prot.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();
}});},null,["interactive"]);apf.xhtml.setElement("@default",apf.XhtmlElement);apf.XhtmlBodyElement=function(struct,tagName){this.$init(tagName||"body",apf.NODE_VISIBLE,struct);
};(function(){this.$coreHtml=true;this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.ownerDocument.body){this.ownerDocument.body=this;
}this.$ext=this.$int=document.body;},true);}).call(apf.XhtmlBodyElement.prototype=new apf.AmlElement());
apf.Init.addConditional(function(){if(apf.isO3){return;}var prot=apf.XhtmlBodyElement.prototype;
prot.implement(apf.ContentEditable);},null,["interactive"]);apf.xhtml.setElement("body",apf.XhtmlBodyElement);
apf.XhtmlHtmlElement=function(struct,tagName){this.$init(tagName||"html",apf.NODE_VISIBLE,struct);
this.$coreHtml=true;this.$ext=document.documentElement;this.$ext.host=this;this.$int=document.body;
this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;
this.$isWindowContainer=true;this.implement(apf.Focussable);apf.window.$addFocus(this);
this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var i,l,n,a,c,attr=this.attributes,doc=this.ownerDocument;
for(i=0,l=attr.length;i<l;i++){n=(a=attr[i]).nodeName.split(":");if(n[0]=="xmlns"){if(c=n[1]){doc.$prefixes[c]=a.nodeValue;
doc.$namespaceURIs[a.nodeValue]=c;}else{doc.namespaceURI=a.nodeValue;}}}if(!doc.namespaceURI){doc.namespaceURI=apf.ns.xhtml;
}});};apf.XhtmlHtmlElement.prototype=new apf.XhtmlElement();apf.xhtml.setElement("html",apf.XhtmlHtmlElement);
apf.XhtmlIgnoreElement=function(struct,tagName){this.$init(tagName,apf.NODE_VISIBLE,struct);
};apf.XhtmlIgnoreElement.prototype=new apf.AmlElement();apf.xhtml.setElement("script",apf.XhtmlIgnoreElement);
apf.xhtml.setElement("noscript",apf.XhtmlIgnoreElement);apf.xhtml.setElement("head",apf.XhtmlIgnoreElement);
apf.xhtml.setElement("meta",apf.XhtmlIgnoreElement);apf.XhtmlInputElement=function(struct,tagName){this.$init(tagName||"input",apf.NODE_VISIBLE,struct);
};(function(){this.$xae=apf.XhtmlElement.prototype.$xae;this.$xre=apf.XhtmlElement.prototype.$xre;
this.$handlePropSet=function(name,value,force){if(name=="type"){return;}return apf.XhtmlElement.prototype.$handlePropSet.call(this,name,value,force);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),pHtmlNode);
}else{this.$ext=this.$int=document.createElement(this.localName);if(this.getAttribute("type")){this.$int.setAttribute("type",this.getAttribute("type"));
}pHtmlNode.appendChild(this.$int);}},true);}).call(apf.XhtmlInputElement.prototype=new apf.AmlElement());
apf.xhtml.setElement("input",apf.XhtmlInputElement);apf.XhtmlOptionElement=function(struct,tagName){this.$init(tagName||"option",apf.NODE_VISIBLE,struct);
};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$ext=this.$int=this.parentNode.$int.appendChild(this.parentNode.$int.ownerDocument.createElement("option"));
if(this.value){this.$int.setAttribute("value",this.value);}},true);}).call(apf.XhtmlOptionElement.prototype=new apf.AmlElement());
apf.xhtml.setElement("option",apf.XhtmlOptionElement);apf.XhtmlSkipChildrenElement=function(struct,tagName){this.$init(tagName,apf.NODE_VISIBLE,struct);
};(function(){this.canHaveChildren=false;this.$redraw=function(){var _self=this;
apf.queue.add("redraw"+this.$uniqueId,function(){var pHtmlNode=_self.$ext.parentNode;
var beforeNode=_self.$ext.nextSibling;pHtmlNode.removeChild(_self.$ext);_self.$ext=apf.insertHtmlNode(null,pHtmlNode,beforeNode,_self.$aml?(_self.$aml.serialize?_self.$aml.serialize():_self.$aml.xml):_self.serialize());
});};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,pHtmlNode,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());
},true);}).call(apf.XhtmlSkipChildrenElement.prototype=new apf.AmlElement());apf.xhtml.setElement("object",apf.XhtmlSkipChildrenElement);
apf.xhtml.setElement("embed",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("table",apf.XhtmlSkipChildrenElement);
apf.xhtml.setElement("pre",apf.XhtmlSkipChildrenElement);apf.xsd=new apf.AmlNamespace();
apf.setNamespace("http://www.w3.org/2001/XMLSchema",apf.xsd);apf.xsd.typeHandlers={"http://www.w3.org/2001/XMLSchema":{dateTime:function(value){value=value.replace(/-/g,"/");
value.match(/^(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})$/);if(!RegExp.$3||RegExp.$3.length<4){return false;
}var dt=new Date(value);if(dt.getFullYear()!=parseFloat(RegExp.$3)){return false;
}if(dt.getMonth()!=parseFloat(RegExp.$2)-1){return false;}if(dt.getDate()!=parseFloat(RegExp.$1)){return false;
}if(dt.getHours()!=parseFloat(RegExp.$4)){return false;}if(dt.getMinutes()!=parseFloat(RegExp.$5)){return false;
}if(dt.getSeconds()!=parseFloat(RegExp.$5)){return false;}return true;},time:function(value){value.match(/^(\d{2}):(\d{2}):(\d{2})$/);
var dt=new Date("21/06/1980 "+value);if(dt.getHours()!=parseFloat(RegExp.$1)){return false;
}if(dt.getMinutes()!=parseFloat(RegExp.$2)){return false;}if(dt.getSeconds()!=parseFloat(RegExp.$3)){return false;
}return true;},date:function(value){value=value.replace(/-/g,"/");value.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
if(!RegExp.$3||RegExp.$3.length<4){return false;}var dt=new Date(RegExp.$2+"/"+RegExp.$1+"/"+RegExp.$3);
if(dt.getFullYear()!=parseFloat(RegExp.$3)){return false;}if(dt.getMonth()!=parseFloat(RegExp.$2)-1){return false;
}if(dt.getDate()!=parseFloat(RegExp.$1)){return false;}return true;},gYearMonth:function(value){value=value.replace(/-/g,"/");
value.match(/^\/?(\d{4})(?:\d\d)?\/(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);if(!RegExp.$1||RegExp.$1.length<4){return false;
}var dt=new Date(value);if(dt.getFullYear()!=parseFloat(RegExp.$)){return false;
}if(dt.getMonth()!=parseFloat(RegExp.$2)-1){return false;}return true;},gYear:function(value){value.match(/^\/?(\d{4})(?:\d\d)?(?:\w|[\+\-]\d{2}:\d{2})?$/);
if(!RegExp.$1||RegExp.$1.length<4){return false;}var dt=new Date(value);if(dt.getFullYear()!=parseFloat(RegExp.$1)){return false;
}return true;},gMonthDay:function(value){value=value.replace(/-/g,"/");value.match(/^\/\/(\d{2})\/(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);
var dt=new Date(value);if(dt.getMonth()!=parseFloat(RegExp.$1)-1){return false;
}if(dt.getDate()!=parseFloat(RegExp.$2)){return false;}return true;},gDay:function(value){value=value.replace(/-/g,"/");
value.match(/^\/{3}(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);var dt=new Date(value);if(dt.getDate()!=parseFloat(RegExp.$1)){return false;
}return true;},gMonth:function(value){value=value.replace(/-/g,"/");value.match(/^\/{2}(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);
var dt=new Date(value);if(dt.getMonth()!=parseFloat(RegExp.$1)-1){return false;
}return true;},string:function(value){return typeof value=="string";},"boolean":function(value){return/^(true|false)$/i.test(value);
},base64Binary:function(value){return true;},hexBinary:function(value){return/^(?:0x|x|#)?[A-F0-9]{0,8}$/i.test(value);
},"float":function(value){return parseFloat(value)==value;},decimal:function(value){return/^[0-9\.\-,]+$/.test(value);
},"double":function(value){return parseFloat(value)==value;},anyURI:function(value){return/^(?:\w+:\/\/)?(?:(?:[\w\-]+\.)+(?:[a-z]+)|(?:(?:1?\d?\d?|2[0-4]9|25[0-5])\.){3}(?:1?\d\d|2[0-4]9|25[0-5]))(?:\:\d+)?(?:\/([^\s\\\%]+|%[\da-f]{2})*)?$/i.test(value);
},QName:function(value){return true;},normalizedString:function(value){return true;
},token:function(value){return true;},language:function(value){return true;},Name:function(value){return true;
},NCName:function(value){return true;},ID:function(value){return true;},IDREF:function(value){return true;
},IDREFS:function(value){return true;},NMTOKEN:function(value){return true;},NMTOKENS:function(value){return true;
},integer:function(value){return parseInt(value)==value;},nonPositiveInteger:function(value){return parseInt(value)==value&&value<=0;
},negativeInteger:function(value){return parseInt(value)==value&&value<0;},"long":function(value){return parseInt(value)==value&&value>=-2147483648&&value<=2147483647;
},"int":function(value){return parseInt(value)==value;},"short":function(value){return parseInt(value)==value&&value>=-32768&&value<=32767;
},"byte":function(value){return parseInt(value)==value&&value>=-128&&value<=127;
},nonNegativeInteger:function(value){return parseInt(value)==value&&value>=0;},unsignedLong:function(value){return parseInt(value)==value&&value>=0&&value<=4294967295;
},unsignedInt:function(value){return parseInt(value)==value&&value>=0;},unsignedShort:function(value){return parseInt(value)==value&&value>=0&&value<=65535;
},unsignedByte:function(value){return parseInt(value)==value&&value>=0&&value<=255;
},positiveInteger:function(value){return parseInt(value)==value&&value>0;}},"http://ajax.org/2005/aml":{url:function(value){return/\b(https?|ftp):\/\/([\-A-Z0-9.]+)(\/[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?(\?[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?/i.test(value.trim());
},website:function(value){return/^(?:http:\/\/)?([\w-]+\.)+\w{2,4}$/.test(value.trim());
},email:function(value){return/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i.test(value.trim());
},creditcard:function(value){value=value.replace(/ /g,"");value=value.pad(21,"0",apf.PAD_LEFT);
for(var total=0,r,i=value.length;i>=0;i--){r=value.substr(i,1)*(i%2+1);total+=r>9?r-9:r;
}return total%10===0;},expdate:function(value){value=value.replace(/-/g,"/");value=value.split("/");
var dt=new Date(value[0]+"/01/"+value[1]);if(dt.getYear()!=parseFloat(value[1])){return false;
}if(dt.getMonth()!=parseFloat(value[0])-1){return false;}return true;},wechars:function(value){return/^[0-9A-Za-z\xC0-\xCF\xD1-\xD6\xD8-\xDD\xDF-\xF6\xF8-\xFF -\.',]+$/.test(value);
},phonenumber:function(value){return/^[\d\+\- \(\)]+$/.test(value);},faxnumber:function(value){return/^[\d\+\- \(\)]+$/.test(value);
},mobile:function(value){return/^[\d\+\- \(\)]+$/.test(value);}}};apf.xsd.custumTypeHandlers={};
apf.xsd.matchType=function(value,type){var split=type.split(":"),prefix=split[0],doc=apf.document,ns=doc.$prefixes[prefix];
type=split[1];if(prefix=="xsd"){ns="http://www.w3.org/2001/XMLSchema";}if(!ns){ns=doc.namespaceURI||apf.ns.xhtml;
}var c=this.typeHandlers[ns];if(c&&c[type]){return c[type](value);}throw new Error(apf.formatErrorString(0,null,"Validating XSD Type","Could not find type: "+type));
return true;};apf.xsd.checkType=function(type,xmlNode){var value=typeof xmlNode=="object"?apf.queryValue(xmlNode):xmlNode;
if(type.indexOf(":")>-1){var split=type.split(":"),prefix=split[0],name=split[1],doc=apf.document,ns=doc.$prefixes[prefix];
if(prefix=="xsd"){ns="http://www.w3.org/2001/XMLSchema";}if(!ns){ns=doc.namespaceURI||apf.ns.xhtml;
}var c=this.typeHandlers[ns];if(c&&c[name]){return c[name](value);}}if(this.custumTypeHandlers[type]){return this.custumTypeHandlers[type](value);
}else{}};apf.XsdElement=function(struct,tagName){this.$init(true);this.addEventListener("DOMNodeInserted",function(){if(!this.parentNode.$compile){this.$compile();
}});this.addEventListener("DOMNodeRemoved",function(){if(!this.parentNode.$compile){this.$compile();
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.$compile){return;
}var _self=this;apf.queue.add("compile"+this.$uniqueId,function(){_self.$compile();
});});};apf.XsdElement.prototype=new apf.AmlElement();apf.XsdElement.prototype.$recompile=function(stack){if(!this.$amlLoaded){return;
}if(this.parentNode.$recompile){this.parentNode.$recompile();}else{this.$compile();
}};apf.XsdEnumeration=function(struct,tagName){this.$init(tagName||"enumeration",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){if(stack.enumDone){return;}stack.enumDone=true;
var k,l,re=[],nodes=this.parentNode.getElementsByTagNameNS(this.namespaceURI,"enumeration");
for(k=0,l=nodes.length;k<l;k++){re.push(nodes[k].value);}stack.push("if (!/^(?:"+re.join("|")+")$/.test(value)) return false;");
};}).call(apf.XsdEnumeration.prototype=new apf.XsdElement());apf.xsd.setElement("enumeration",apf.XsdEnumeration);
apf.XsdFractionDigits=function(struct,tagName){this.$init(tagName||"maxinclusive",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (parseFloat(value) == value && value.split('.')[1].length != "+this.value+") return false;");
};}).call(apf.XsdFractionDigits.prototype=new apf.XsdElement());apf.xsd.setElement("maxinclusive",apf.XsdFractionDigits);
apf.XsdLength=function(struct,tagName){this.$init(tagName||"length",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (value.length != "+this.value+") return false;");
};}).call(apf.XsdLength.prototype=new apf.XsdElement());apf.xsd.setElement("length",apf.XsdLength);
apf.XsdList=function(struct,tagName){this.$init(tagName||"list",apf.NODE_HIDDEN,struct);
};(function(){this.$compile=function(stack){};}).call(apf.XsdList.prototype=new apf.XsdElement());
apf.xsd.setElement("list",apf.XsdList);apf.XsdMaxExclusive=function(struct,tagName){this.$init(tagName||"maxexclusive",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (parseFloat(value) =< "+this.value+") return false;");
};}).call(apf.XsdMaxExclusive.prototype=new apf.XsdElement());apf.xsd.setElement("maxexclusive",apf.XsdMaxExclusive);
apf.XsdMaxInclusive=function(struct,tagName){this.$init(tagName||"maxinclusive",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (parseFloat(value) > "+this.value+") return false;");
};}).call(apf.XsdMaxInclusive.prototype=new apf.XsdElement());apf.xsd.setElement("maxinclusive",apf.XsdMaxInclusive);
apf.XsdMaxLength=function(struct,tagName){this.$init(tagName||"maxlength",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (value.length > "+this.value+") return false;");
};}).call(apf.XsdMaxLength.prototype=new apf.XsdElement());apf.xsd.setElement("maxlength",apf.XsdMaxLength);
apf.XsdMaxScale=function(struct,tagName){this.$init(tagName||"maxscale",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){};}).call(apf.XsdMaxScale.prototype=new apf.XsdElement());
apf.xsd.setElement("maxscale",apf.XsdMaxScale);apf.XsdMinExclusive=function(struct,tagName){this.$init(tagName||"minexclusive",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (parseFloat(value) => "+this.value+") return false;");
};}).call(apf.XsdMinExclusive.prototype=new apf.XsdElement());apf.xsd.setElement("minexclusive",apf.XsdMinExclusive);
apf.XsdMinInclusive=function(struct,tagName){this.$init(tagName||"mininclusive",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (parseFloat(value) < "+this.value+") return false;");
};}).call(apf.XsdMinInclusive.prototype=new apf.XsdElement());apf.xsd.setElement("mininclusive",apf.XsdMinInclusive);
apf.XsdMinLength=function(struct,tagName){this.$init(tagName||"minlength",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (value.length < "+this.value+") return false;");
};}).call(apf.XsdMinLength.prototype=new apf.XsdElement());apf.xsd.setElement("minlength",apf.XsdMinLength);
apf.XsdMinScale=function(struct,tagName){this.$init(tagName||"minscale",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){};}).call(apf.XsdMinScale.prototype=new apf.XsdElement());
apf.xsd.setElement("minscale",apf.XsdMinScale);apf.XsdPattern=function(struct,tagName){this.$init(tagName||"pattern",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (!/^"+this.value.replace(/(\/|\^|\$)/g,"\\$1")+"$/.test(value)) return false;");
};}).call(apf.XsdPattern.prototype=new apf.XsdElement());apf.xsd.setElement("pattern",apf.XsdPattern);
apf.XsdRestriction=function(struct,tagName){this.$init(tagName||"restriction",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.base=function(){this.parentNode.$recompile();};
this.$compile=function(stack){stack.push("if (!apf.xsd.matchType(value, '"+this.base+"')) return false;");
var i,l,node,nodes=this.childNodes;for(i=0,l=nodes.length;i<l;i++){(node=nodes[i]).$compile&&node.$compile(stack);
}};}).call(apf.XsdRestriction.prototype=new apf.XsdElement());apf.xsd.setElement("restriction",apf.XsdRestriction);
apf.XsdSchema=function(struct,tagName){this.$init(true);};apf.XsdSchema.prototype=new apf.XsdElement();
apf.xsd.setElement("schema",apf.XsdSchema);apf.XsdSimpleType=function(struct,tagName){this.$init(tagName||"simpletype",apf.NODE_HIDDEN,struct);
var lastName;this.$propHandlers.name=function(value){if(lastName){apf.xsd.custumTypeHandlers[value]=apf.xsd.custumTypeHandlers[lastName];
apf.xsd.custumTypeHandlers[lastName]=null;}lastName=value;};};(function(){this.$compile=function(stack){var i,l,nodes,node;
if(!this.parentNode.$compile){stack=[];nodes=this.childNodes;for(i=0,l=nodes.length;
i<l;i++){(node=nodes[i]).$compile&&node.$compile(stack);}stack.push("return true;");
apf.xsd.custumTypeHandlers[this.name]=new Function("value",stack.join("\n"));}else{nodes=this.childNodes;
for(i=0,l=nodes.length;i<l;i++){(node=nodes[i]).$compile&&node.$compile(stack);
}}};}).call(apf.XsdSimpleType.prototype=new apf.XsdElement());apf.xsd.setElement("simpletype",apf.XsdSimpleType);
apf.XsdTotalDigits=function(struct,tagName){this.$init(tagName||"totaldigits",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.value=function(){this.parentNode.$recompile();
};this.$compile=function(stack){stack.push("if (new String(parseFloat(value)).length == "+this.value+") return false;");
};}).call(apf.XsdTotalDigits.prototype=new apf.XsdElement());apf.xsd.setElement("totaldigits",apf.XsdTotalDigits);
apf.XsdUnion=function(struct,tagName){this.$init(tagName||"union",apf.NODE_HIDDEN,struct);
};(function(){this.$propHandlers.memberTypes=function(value){this.$memberTypes=value.splitSafe(" ");
this.parentNode.$recompile();};this.$compile=function(stack){var i,l,node,nodes=this.childNodes;
for(i=0,l=this.$memberTypes.length;i<l;i++){stack.push("if (apf.xsd.checkType('"+this.$memberTypes[i]+"', value)) return true;");
}for(i=0,l=nodes.length;i<l;i++){(node=nodes[i]).$compile&&node.$compile(stack);
}};}).call(apf.XsdUnion.prototype=new apf.XsdElement());apf.xsd.setElement("union",apf.XsdUnion);
apf.html5=new apf.AmlNamespace();apf.setNamespace("",apf.html5);apf.HTML5INPUT={email:"textbox",url:"textbox",password:"textbox",datetime:"spinner",date:"calendar",month:"spinner",week:"spinner",time:"spinner",number:"spinner",range:"slider",checkbox:"checkbox",radio:"radiobutton",file:"upload",submit:"submit",image:"submit",reset:"button"};
apf.xinclude=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XInclude",apf.xinclude);
apf.XiFallback=function(struct,tagName){this.$init(tagName||"fallback",apf.NODE_HIDDEN,struct);
};apf.XiFallback.prototype=new apf.AmlElement();apf.XiFallback.prototype.$parsePrio="002";
apf.xinclude.setElement("fallback",apf.XiFallback);apf.aml.setElement("fallback",apf.XiFallback);
apf.XiInclude=function(struct,tagName){this.$init(tagName||"include",apf.NODE_HIDDEN,struct);
};apf.xinclude.setElement("include",apf.XiInclude);apf.aml.setElement("include",apf.XiInclude);
(function(){this.$parsePrio="002";this.$propHandlers.href=this.$propHandlers.src=function(value){if(typeof value!="string"){return finish.call(this,value);
}if(value.trim().charAt(0)=="<"){loadIncludeFile.call(this,value.trim());return;
}this.$path=value.charAt(0)=="{"?value:apf.getAbsolutePath(apf.hostPath,value);
var domParser=this.ownerDocument.$domParser;if(!this.defer){domParser.$shouldWait++;
this.$parseContext=domParser.$parseContext||[this.parentNode];}loadIncludeFile.call(this,this.$path);
};function done(xmlNode){if(this.callback){this.callback({xmlNode:xmlNode,amlNode:this.parentNode,addedNode:this.previousSibling||this.nextSibling});
}if(this.parentNode){this.parentNode.removeChild(this);}}function finish(xmlNode){var domParser=this.ownerDocument.$domParser;
if(this.clear){this.parentNode.$int.innerHTML="";}if(xmlNode){domParser.parseFromXml(xmlNode,{doc:this.ownerDocument,amlNode:this.parentNode,beforeNode:this,include:true});
if(!this.defer&&this.$parseContext){var o=(this.$parseContext[1]||(this.$parseContext[1]={})),cb=o.callback,_self=this;
o.callback=function(){done.call(_self,xmlNode);if(cb){cb.call(_self.ownerDocument);
}};if(domParser.$continueParsing.apply(domParser,this.$parseContext)===false){var o2=(domParser.$parseContext[1]||(domParser.$parseContext[1]={})),cb2=o.callback;
o2.callback=function(){if(cb){cb.call(_self.ownerDocument);}domParser.$continueParsing.apply(domParser,_self.$parseContext);
};}}else{done.call(this,xmlNode);}}else{if(!this.defer){domParser.$continueParsing.apply(domParser,this.$parseContext);
}done.call(this,xmlNode);}}function loadIncludeFile(path){apf.console.info("Loading include file: "+path);
var _self=this;apf.getData(path,apf.extend(this.options||{},{type:"markup",callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){var oError=new Error(apf.formatErrorString(1007,_self,"Loading Includes","Could not load Include file '"+(path||_self.src)+"'\nReason: "+extra.message));
if(extra.tpModule.retryTimeout(extra,state,null,oError)===true){return true;}apf.console.error(oError.message);
finish.call(_self,null);return;}xmlString=xmlString.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");
if(!apf.supportNamespaces){xmlString=xmlString.replace(/xmlns\=\"[^"]*\"/g,"");
}if(xmlString.indexOf("<a:application")==-1){xmlString="<a:application xmlns:a='"+apf.ns.aml+"'>"+xmlString+"</a:application>";
}var xmlNode=apf.getXml(xmlString,null,true);if(!xmlNode){throw new Error(apf.formatErrorString(0,null,"Loading include","Could not parse include file. Maybe the file does not exist?",xmlNode));
}xmlNode.setAttribute("filename",extra.url);apf.console.info("Loading of "+xmlNode[apf.TAGNAME].toLowerCase()+" include done from file: "+extra.url);
finish.call(_self,xmlNode);},async:true,ignoreOffline:true}));}}).call(apf.XiInclude.prototype=new apf.AmlElement());
apf.runXslt=function(){apf.XSLTProcessor=function(){this.templates={};this.p={"value-of":function(context,xslNode,childStack,result){var value,xmlNode=apf.XPath.selectNodes(xslNode.getAttribute("select"),context)[0];
if(!xmlNode){value="";}else{if(xmlNode.nodeType==1){value=xmlNode.firstChild?xmlNode.firstChild.nodeValue:"";
}else{value=typeof xmlNode=="object"?xmlNode.nodeValue:xmlNode;}}result.appendChild(this.xmlDoc.createTextNode(value));
},"copy-of":function(context,xslNode,childStack,result){var xmlNode=apf.XPath.selectNodes(xslNode.getAttribute("select"),context)[0];
if(xmlNode){result.appendChild(apf.canImportNode?result.ownerDocument.importNode(xmlNode,true):xmlNode.cloneNode(true));
}},"if":function(context,xslNode,childStack,result){if(apf.XPath.selectNodes(xslNode.getAttribute("test"),context)[0]){this.parseChildren(context,xslNode,childStack,result);
}},"for-each":function(context,xslNode,childStack,result){var i,l,nodes=apf.XPath.selectNodes(xslNode.getAttribute("select"),context);
for(i=0,l=nodes.length;i<l;i++){this.parseChildren(nodes[i],xslNode,childStack,result);
}},choose:function(context,xslNode,childStack,result){var i,l,nodes=xslNode.childNodes;
for(i=0,l=nodes.length;i<l;i++){if(!nodes[i].tagName){continue;}if(nodes[i][apf.TAGNAME]=="otherwise"||nodes[i][apf.TAGNAME]=="when"&&apf.XPath.selectNodes(nodes[i].getAttribute("test"),context)[0]){return this.parseChildren(context,nodes[i],childStack[i][2],result);
}}},output:function(context,xslNode,childStack,result){},param:function(context,xslNode,childStack,result){},attribute:function(context,xslNode,childStack,result){var nres=this.xmlDoc.createDocumentFragment();
this.parseChildren(context,xslNode,childStack,nres);result.setAttribute(xslNode.getAttribute("name"),nres.xml);
},"apply-templates":function(context,xslNode,childStack,result){var t,i,l,nodes;
if(!xslNode){t=this.templates["/"]||this.templates[context.tagName];if(t){this.parseChildren(t==this.templates["/"]?context.ownerDocument:context,t[0],t[1],result);
}}else{if(xslNode.getAttribute("select")){t=this.templates[xslNode.getAttribute("select")];
if(t){if(xslNode.getAttribute("select")=="/"){return alert("Something went wrong. The / template was executed as a normal template");
}nodes=context.selectNodes(xslNode.getAttribute("select"));for(i=0,l=nodes.length;
i<l;i++){this.parseChildren(nodes[i],t[0],t[1],result);}}}else{if(xslNode.getAttribute("name")){t=this.templates[xslNode.getAttribute("name")];
if(t){this.parseChildren(context,t[0],t[1],result);}}else{var ncontext=context.cloneNode(true),nres=this.xmlDoc.createDocumentFragment(),tName,p,k;
nodes=ncontext.childNodes;for(i=nodes.length-1;i>=0;i--){if(nodes[i].nodeType==3||nodes[i].nodeType==4){continue;
}if(!nodes[i].nodeType==1){continue;}var n=nodes[i];for(tName in this.templates){if(tName=="/"){continue;
}t=this.templates[tName];var snodes=n.selectNodes("self::"+tName);for(var j=snodes.length-1;
j>=0;j--){var s=snodes[j];p=s.parentNode;this.parseChildren(s,t[0],t[1],nres);if(nres.childNodes){for(k=nres.childNodes.length-1;
k>=0;k--){p.insertBefore(nres.childNodes[k],s);}}p.removeChild(s);}}if(n.parentNode){p=n.parentNode;
this.p["apply-templates"].call(this,n,xslNode,childStack,nres);if(nres.childNodes){for(k=nres.childNodes.length-1;
k>=0;k--){p.insertBefore(nres.childNodes[k],n);}}p.removeChild(n);}}for(i=ncontext.childNodes.length-1;
i>=0;i--){result.insertBefore(ncontext.childNodes[i],result.firstChild);}}}}},cache:{},"import":function(context,xslNode,childStack,result){var file=xslNode.getAttribute("href");
if(!this.cache[file]){var data=apf.oHttp.get(file);this.cache[file]=data;}},include:function(context,xslNode,childStack,result){},when:function(){},otherwise:function(){},"copy-clone":function(context,xslNode,childStack,result){result=result.appendChild(apf.canImportNode?result.ownerDocument.importNode(xslNode,false):xslNode.cloneNode(false));
if(result.nodeType==1){for(var value,i=0,l=result.attributes.length;i<l;i++){var blah=result.attributes[i].nodeValue;
if(!apf.isSafariOld&&result.attributes[i].nodeName.match(/^xmlns/)){continue;}result.attributes[i].nodeValue=result.attributes[i].nodeValue.replace(/\{([^\}]+)\}/g,function(m,xpath){var xmlNode=apf.XPath.selectNodes(xpath,context)[0];
if(!xmlNode){value="";}else{if(xmlNode.nodeType==1){value=xmlNode.firstChild?xmlNode.firstChild.nodeValue:"";
}else{value=typeof xmlNode=="object"?xmlNode.nodeValue:xmlNode;}}return value;});
result.attributes[i].nodeValue;}}this.parseChildren(context,xslNode,childStack,result);
}};this.parseChildren=function(context,xslNode,childStack,result){if(!childStack){return;
}for(var i=0,l=childStack.length;i<l;i++){childStack[i][0].call(this,context,childStack[i][1],childStack[i][2],result);
}};this.compile=function(xslNode){var nodes=xslNode.childNodes;for(var stack=[],i=0,l=nodes.length;
i<l;i++){if(nodes[i].nodeType!=1&&nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;
}if(nodes[i][apf.TAGNAME]=="template"){this.templates[nodes[i].getAttribute("match")||nodes[i].getAttribute("name")]=[nodes[i],this.compile(nodes[i])];
}else{if(nodes[i][apf.TAGNAME]=="stylesheet"){this.compile(nodes[i]);}else{if(nodes[i].prefix=="xsl"){var func=this.p[nodes[i][apf.TAGNAME]];
if(!func){alert("xsl:"+nodes[i][apf.TAGNAME]+" is not supported at this time on this platform");
}else{stack.push([func,nodes[i],this.compile(nodes[i])]);}}else{stack.push([this.p["copy-clone"],nodes[i],this.compile(nodes[i])]);
}}}}return stack;};this.importStylesheet=function(xslDoc){this.xslDoc=xslDoc.nodeType==9?xslDoc.documentElement:xslDoc;
var xslStack=this.compile(xslDoc);this.xslStack=[[this.p["apply-templates"],null]];
};this.transformToFragment=function(doc,newDoc){this.xmlDoc=newDoc.nodeType!=9?newDoc.ownerDocument:newDoc;
var docfrag=this.xmlDoc.createDocumentFragment();if(!apf.isSafariOld&&doc.nodeType==9){doc=doc.documentElement;
}var result=this.parseChildren(doc,this.xslDoc,this.xslStack,docfrag);return docfrag;
};};self.XSLTProcessor=apf.XSLTProcessor;};apf.__LIVEEDIT__=1<<23;apf.LiveEdit=function(){this.$regbase=this.$regbase|apf.__LIVEEDIT__;
this.implement(apf.DataAction||apf.K);this.implement(apf.Validation||apf.K);this.$activeDocument=document;
this.$selection=null;this.$activeNode=null;this.$lastActiveNode=null;this.$activeIndex=0;
this.$supportedProperties.push("liveedit","realtime");this.$booleanProperties.liveedit=true;
this.$booleanProperties.realtime=true;this.$propHandlers.liveedit=function(value){if(this.childNodes.length&&!this.hasFeature(apf.__CHILDVALUE__)){return;
}if(this.realtime==undefined){this.$setInheritedAttribute("realtime");}if(value){if(!this.$focussable||!this.focussable){this.$focussable=true;
this.$unFocussable=[this.$focussable,typeof this.focussable=="undefined"?true:this.focussable];
apf.GuiElement.propHandlers.focussable.call(this,true);}if(!this.$leMouseOver){this.$setMouseEvents();
}apf.addListener(this.$ext,"mouseup",this.$leMouseUp);apf.addListener(this.$ext,"mousedown",this.$leMouseDown);
apf.addListener(this.$ext,"mouseout",this.$leMouseOut);apf.addListener(this.$ext,"mouseover",this.$leMouseOver);
this.addEventListener("keydown",keydownHandler,true);this.addEventListener("blur",blurHandler);
this.addEventListener("focus",focusHandler);this.addEventListener("load",loadHandler);
if(this.nodeType==7){this.addEventListener("prop.calcdata",xmlupdateHandler);}else{if(this.hasFeature(apf.__CHILDVALUE__)){this.addEventListener("prop."+this.$childProperty,xmlupdateHandler);
}else{this.addEventListener("xmlupdate",xmlupdateHandler);}}}else{if(this.$leMouseOver){if(this.$unFocussable){this.$focussable=this.$unFocussable[0];
apf.GuiElement.propHandlers.focussable.call(this,this.$unFocussable[1]);delete this.$unFocussable;
}apf.removeListener(this.$ext,"mouseover",this.$leMouseOver);apf.removeListener(this.$ext,"mouseout",this.$leMouseOut);
apf.removeListener(this.$ext,"mousedown",this.$leMouseDown);apf.removeListener(this.$ext,"mouseup",this.$leMouseUp);
this.$activeNode=null;this.$lastActiveNode=null;this.removeEventListener("keydown",keydownHandler,true);
this.removeEventListener("blur",blurHandler);this.removeEventListener("focus",focusHandler);
this.removeEventListener("load",loadHandler);if(this.nodeType==7){this.removeEventListener("prop.calcdata",xmlupdateHandler);
}else{if(this.hasFeature(apf.__CHILDVALUE__)){this.removeEventListener("prop."+this.$childProperty,xmlupdateHandler);
}else{this.removeEventListener("xmlupdate",xmlupdateHandler);}}}}this.$tabStack=null;
};this.$setMouseEvents=function(){var _self=this,moEditor;function focusHandler(){moEditor.removeEventListener("focus",focusHandler);
apf.removeListener(moEditor.$ext,"mouseout",extOutHandler);moEditor=null;}function removeHandler(){apf.removeListener(moEditor.$ext,"mouseout",extOutHandler);
if(_self.$lastEditor&&_self.$lastEditor[0]==moEditor){removeEditor.call(_self,_self.$activeNode,true);
}moEditor.removeEventListener("focus",focusHandler);moEditor=null;}function extOutHandler(){if(!_self.$lastEditor){apf.removeListener(moEditor.$ext,"mouseout",extOutHandler);
return;}if(moEditor&&!moEditor.hasFocus()){removeHandler.call(moEditor);}}this.$leMouseOver=function(e){var el=e.srcElement||e.target;
if(!el){return;}while(el&&(!el.className||el.className.indexOf("liveEdit")==-1)&&el!=_self.$ext){el=el.parentNode;
}if(!el||el==_self.$ext||el==_self.$activeNode){return;}if(moEditor){removeHandler.call(moEditor);
}var editor=el.getAttribute("editor");if(editor&&"richtext|default".indexOf(editor)==-1&&!_self.$activeNode){createEditor.call(_self,el);
moEditor=_self.$lastEditor[0];moEditor.addEventListener("focus",focusHandler);apf.addListener(moEditor.$ext,"mouseout",extOutHandler);
}else{apf.setStyleClass(el,"liveEditOver");}};this.$leMouseOut=function(e){var el=e.srcElement||e.target;
if(!el){return;}while(el&&(!el.className||el.className.indexOf("liveEdit")==-1)&&el!=_self.$ext){el=el.parentNode;
}if(!el||el==_self.$ext||el==_self.$activeNode){return;}apf.setStyleClass(el,null,["liveEditOver"]);
};this.$leMouseDown=function(e,preventPropagation){if(!preventPropagation){apf.cancelBubble(e);
}var el=e.srcElement||e.target;if(!el){return;}if(_self.$activeNode&&_self.$selection&&apf.isChildOf(_self.$activeNode,el,true)){$setTimeout(function(){_self.$selection.cache();
});}while(el&&(!el.className||el.className.indexOf("liveEdit")==-1)&&el!=_self.$ext){el=el.parentNode;
}if(!el||el==_self.$ext){if(_self.$activeNode){removeEditor.call(_self,_self.$activeNode,true);
}return;}createEditor.call(_self,el);if(!_self.$lastEditor&&!preventPropagation){e.cancelBubble=true;
apf.window.$mousedown({srcElement:_self.$activeNode});$setTimeout(function(){if(_self.$activeNode){_self.$activeNode.focus();
}},10);}else{}return false;};this.$leMouseUp=function(e){var el=e.srcElement||e.target;
if(_self.$activeNode&&_self.$selection&&apf.isChildOf(_self.$activeNode,el,true)){_self.$selection.cache();
}};};function focusHandler(e){if(this.$skipFocusOnce&&!(this.$skipFocusOnce=false)){this.$lastActiveNode=null;
return;}this.setProperty("state",(this.$pluginsActive=="code")?apf.DISABLED:apf.OFF);
if(this.$lastActiveNode&&this.$lastActiveNode.parentNode||typeof e.shiftKey=="boolean"){createEditor.call(this,this.$lastActiveNode||(this.$tabStack||initTabStack.call(this))[e.shiftKey?this.$tabStack.length-1:0]);
if(this.$lastActiveNode&&!this.$lastEditor){this.$lastActiveNode.focus();}}this.$lastActiveNode=null;
if(this.$lastEditor){}else{if(this.$activeNode){var _self=this,node=this.$activeNode;
$setTimeout(function(){_self.$selection.set();if(node.parentNode){node.focus();
}},10);}}}function blurHandler(e){this.$lastActiveNode=this.$activeNode||this.$lastActiveNode;
if(e.toElement&&(e.toElement==this.$docklet||e.toElement.parentNode==this.$lastEditor)){return;
}var pParent=apf.popup.last&&apf.lookup(apf.popup.last);if(pParent&&pParent.editor==this){apf.popup.forceHide();
}if(this.$selection){this.$selection.cache();}removeEditor.call(this,this.$activeNode,true);
this.setProperty("state",apf.DISABLED);}function loadHandler(){createEditor.call(this,initTabStack.call(this)[0]);
}function xmlupdateHandler(){if(!this.$skipChange){initTabStack.call(this);}}var commandKeys={66:1,98:1,105:1,73:1,117:1,85:1};
function keydownHandler(e){var oNode,isDone,found,code=e.which||e.keyCode;if(!this.$activeNode){if(code==113){if(this.$selected){var nodes=this.$selected.getElementsByTagName("*");
for(var i=nodes.length-1;i>=0;i--){if((nodes[i].className||"").indexOf("liveEdit")>-1){oNode=nodes[i];
break;}}}createEditor.call(this,oNode||(this.$tabStack||initTabStack.call(this))[0]);
if(this.$activeNode){this.$activeNode.focus();this.$selection.selectNode(this.$activeNode);
this.$selection.collapse();try{this.$activeDocument.execCommand("SelectAll",false,true);
}catch(e){}}}return;}if(code==13){isDone=e.ctrlKey||(apf.isMac&&e.metaKey);if(!isDone){isDone=!apf.isTrue(this.$activeNode.getAttribute("multiline"));
}e.returnValue=true;}this.$visualFocus();if(code==9||isDone){if(!this.$tabStack){initTabStack.call(this);
}var idx,bShift=e.shiftKey;oNode=this.$activeNode;removeEditor.call(this,this.$activeNode,true)||initTabStack.call(this)[this.$activeIndex];
oNode=this.$tabStack[this.$activeIndex+(bShift?-1:1)];if(oNode){createEditor.call(this,oNode);
if(this.$lastEditor){this.$lastEditor[0].focus();}else{if(oNode.parentNode){oNode.focus();
try{this.$activeDocument.execCommand("SelectAll",false,true);}catch(e){}}}found=true;
}}else{if(code==27){removeEditor.call(this);found=true;}else{if(apf.isIE&&e.ctrlKey&&commandKeys[code]){found=true;
}}}if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&(code<112||code>122)&&(code<33&&code>31||code>42||code==8||code==13)){if(this.realtime&&this.$changeTimer===null&&this.$bStandalone){var _self=this;
this.$changeTimer=$setTimeout(function(){clearTimeout(_self.$changeTimer);_self.change(_self.getValue());
_self.$changeTimer=null;},200);}if(apf.w3cRange&&!this.$selection.isCollapsed()&&apf.isCharacter(code)){if(this.$activeNode.innerHTML.trim()!=""){this.$selection.remove();
}}}if(found){return apf.stopEvent(e);}else{if(this.$activeNode){e.returnValue=-1;
}}}function createEditor(oHtml){if(!oHtml||oHtml.nodeType!=1||this.$activeNode==oHtml||!this.xmlRoot){return;
}var _self=this;var hasRule=getOptions(oHtml);var rule=hasRule&&apf.unserialize(hasRule.replace(/&quot;/g,'"').unescapeHTML())||{};
oHtml.setAttribute("multiline",rule.multiline||"false");if(!this.$selection){this.$selection=new apf.selection();
}if(this.$activeNode){var lastPos=initTabStack.call(this).indexOf(oHtml);removeEditor.call(this,this.$activeNode,true);
oHtml=initTabStack.call(this)[lastPos];$setTimeout(function(){oHtml.focus();},10);
}if(this.hasFocus&&!this.hasFocus()){this.$skipFocusOnce=true;}this.$activeNode=oHtml;
this.$activeIndex=(this.$tabStack||initTabStack.call(this)).indexOf(oHtml);apf.setStyleClass(oHtml,"liveEditActive",["liveEditOver","liveEditInitial"]);
if(oHtml.innerHTML==rule.initial){oHtml.innerHTML="";}this.$lastValue=oHtml.innerHTML;
var handler=this.$editors[rule.editor||"default"]||this.$editors.custom;handler.create.call(this,oHtml,rule,getXpath(oHtml));
if(apf.hasFocusBug){apf.sanitizeTextbox(oHtml);}this.dispatchEvent("$createEditor",rule);
}function getXpath(node){return node.getAttribute("xpath").replace(/\\([\[\{\]\}])/g,"$1");
}function getOptions(node){return(node.getAttribute("options")||"").replace(/\\([\[\{\]\}])/g,"$1");
}function removeEditor(oHtml,bProcess,callback){if(!oHtml){oHtml=this.$activeNode;
}if(!oHtml||oHtml.nodeType!=1){return false;}var xpath=getXpath(oHtml),xmlNode=this.xmlRoot.ownerDocument.selectSingleNode(xpath),hasRule=getOptions(oHtml),rule=hasRule&&apf.unserialize(hasRule.replace(/&quot;/g,'"').unescapeHTML())||{};
this.$activeNode=null;apf.setStyleClass(oHtml,null,["liveEditOver","liveEditActive"]);
this.$selection.collapse(true);var handler=this.$editors[rule.editor||"default"]||this.$editors.custom;
var execChange=handler.remove.call(this,oHtml,rule,xpath);if(execChange!==false){if(!bProcess||this.$lastValue&&oHtml.innerHTML.toLowerCase().replace(/[\r\n]/g,"")==(this.$lastValue.dataType==apf.ARRAY?this.$lastValue[0]:this.$lastValue).toLowerCase().replace(/[\r\n]/g,"")){oHtml.innerHTML=this.$lastValue.dataType==apf.ARRAY?this.$lastValue[1]:this.$lastValue;
}else{if(apf.queryValue(this.xmlRoot.ownerDocument,xpath)!=oHtml.innerHTML){rule.htmlNode=oHtml;
var res=this.getValue(oHtml);var valid;if(this.validityState){this.validityState.$reset();
}if(hasRule){apf.validator.compile(rule).call(this,res,false,this.validityState||(this.validityState=new apf.validator.validityState()));
this.invalidmsg=valid?"":rule.invalidmsg||"";valid=this.validityState.valid;if(!valid){this.validityState.$errorHtml=oHtml;
this.dispatchEvent("invalid",this.validityState);this.setError();}else{this.clearError();
}}if(valid!==false){this.$executeAction("setValueByXpath",[this.xmlRoot,res,xpath],"setValueByXpath",xmlNode);
}}}if(!oHtml.innerHTML&&rule.initial){oHtml.innerHTML=rule.initial;apf.setStyleClass(oHtml,"liveEditInitial");
}}if(callback){$setTimeout(callback);}this.dispatchEvent("$removeEditor",rule);
}this.$editors={"default":{create:function(oHtml,rule){this.getValue=function(){var html=oHtml.innerHTML.replace(/<br\s*\/?>/g,"\n");
if(apf.isIE){html=html.replace(/<p[^>]*>/gi,"").replace(/<\/P>/g,"").replace(/<\/p>/g,"\n");
}return apf.html_entity_decode(html);};if(apf.hasContentEditable){oHtml.contentEditable=true;
}else{document.body.setAttribute("spellcheck","false");document.designMode="on";
}if(apf.isGecko){try{document.execCommand("insertBrOnReturn",false,true);}catch(e){}}},remove:function(oHtml,rule){oHtml.blur();
if(apf.hasContentEditable){oHtml.contentEditable=false;}else{document.designMode="off";
}}},custom:{create:function(oHtml,rule,xpath){if(this.$isWindowContainer!=-1){this.$isWindowContainer=-1;
apf.window.$removeFocus(this);apf.window.$addFocus(this,this.tabindex);}delete this.getValue;
oHtml.innerHTML="";var editParent=oHtml;var oEditor,editor=rule.editor;if(editor.charAt(0)=="<"){}else{if(self[editor]){oEditor=self[editor];
oHtml.appendChild(oEditor.$ext);}else{if(apf.namespaces[apf.ns.aml].elements[editor]){var cacheId=apf.serialize(rule);
if(!this.$editorCache){this.$editorCache={};}if(!this.$editorCache[cacheId]){if(!this.id){apf.setReference(this.id=(this.localName||"liveedit")+String(this.$uniqueId),this);
}var _self=this;var constr=apf.namespaces[apf.ns.aml].elements[editor];var isTextbox="textarea|textbox|secret".indexOf(editor)>-1;
var info=apf.extend({htmlNode:editParent,style:"position:relative;",value:"[{"+this.id+".root}::"+xpath+"]",focussable:false,realtime:"{"+this.id+".realtime}",onbeforeselect:function(){_self.$skipChange=true;
},onafterselect:function(){delete _self.$skipChange;},onkeydown:function(e){keydownHandler.call(_self,e);
}},rule);if(info.initial){info["initial-message"]=info.initial;delete info.initial;
}if(isTextbox){info.focusselect=true;info.onkeydown=function(e){if(e.keyCode==13){this.change(this.getValue());
}};}else{if(editor=="checkbox"&&!info.values){info.values="true|false";}}oEditor=this.$editorCache[cacheId]=new constr(info);
oEditor.parentNode=this;oEditor.$focusParent=this;oEditor.setAttribute("focussable","true");
oEditor.$parentId=editParent.getAttribute("id");oEditor.$parentRsz=editParent.onresize;
oEditor.$executeAction=function(atAction,args,action,xmlNode,noevent,contextNode,multiple){if(atAction=="setAttribute"&&!args[2]){atAction="removeAttribute";
}this.parentNode.$executeAction.call(this.parentNode,atAction,args,action,xmlNode,noevent,contextNode,multiple);
};}else{oEditor=this.$editorCache[cacheId];oEditor.setAttribute("value","[{"+this.id+".root}::"+xpath+"]");
oEditor.setProperty("visible",true);if(oEditor.$ext.parentNode&&oEditor.$ext.parentNode.nodeType==1&&!apf.hasSingleResizeEvent){if(!oEditor.$parentRsz){oEditor.$parentRsz=oEditor.$ext.parentNode.onresize;
}oEditor.$ext.parentNode.removeAttribute("id");delete oEditor.$ext.parentNode.onresize;
}editParent.appendChild(oEditor.$ext);if(editParent.$parentId){editParent.setAttribute("id",editParent.$parentId);
}if(oEditor.$parentRsz&&!apf.hasSingleResizeEvent){editParent.onresize=oEditor.$parentRsz;
editParent.onresize();}}}else{throw new Error("Unkown editor: "+editor);}}}this.$lastEditor=[oEditor];
},remove:function(oHtml,rule,xpath){var el=this.$lastEditor[0].$ext;if(el.parentNode){el.parentNode.removeChild(el);
}delete this.$lastEditor;oHtml.innerHTML=apf.queryValue(this.xmlRoot.ownerDocument,xpath);
this.focus();return false;}}};this.isValid=function(checkRequired){return true;
};function initTabStack(){this.$tabStack=[];var aNodes=this.$ext.getElementsByTagName("*");
for(var i=0,l=aNodes.length;i<l&&aNodes[i].nodeType==1;i++){if(aNodes[i].className&&aNodes[i].className.indexOf("liveEdit")!=-1){this.$tabStack.push(aNodes[i]);
}}return this.$tabStack;}this.$visualFocus=function(bNotify){var bCode=(this.$pluginsActive=="code");
if(this.$bStandalone&&apf.document.activeElement==this&&!bCode){try{this.$oWin.focus();
}catch(e){}}else{if(!this.$bStandalone&&this.$activeNode){this.$activeNode.focus();
}}if(bCode){this.$notifyAllButtons(apf.DISABLED);this.$notifyButton("code",apf.SELECTED);
}else{if(bNotify){this.$notifyAllButtons();}}};apf.LiveEdit.richtext.call(this);
};apf.config.$inheritProperties.liveedit=2;apf.LiveEdit.mousedown=function(oHtml,event){if(oHtml.$ext){var amlNode=apf.findHost(oHtml.$ext);
var lm=amlNode.ownerDocument.$parentNode;if(!lm.hasFocus()){lm.focus();}lm.$leMouseDown(event,true);
apf.stopPropagation(event);}};apf.LiveEdit.richtext=function(){this.$state=apf.ON;
this.$buttons={};this.$classToolbar="editor_Toolbar";this.$plugins={};this.$pluginsHooks={};
this.$pluginsTypes={};this.$pluginsKeys=[];this.$pluginsActive=null;this.$pluginsOn=["pasteword","tablewizard"];
this.$nativeCommands=["bold","italic","underline","strikethrough","justifyleft","justifycenter","justifyright","justifyfull","removeformat","cut","copy","paste","outdent","indent","undo","redo"];
this.$changeTimer=null;this.$toolbar=null;var rePunctuation=/[\n\t!`#%&'"\(\)\*\.+-\.\/\:;<=>\?@\[\\\]\^_\{\|\}\~]+/g;
this.$supportedProperties.push("state","plugins","language");this.$propHandlers.state=function(value){this.state=parseInt(value);
var _self=this;$setTimeout(function(){_self.$notifyAllButtons(value);if(_self.$pluginsActive=="code"){_self.$notifyButton("code",apf.SELECTED);
}});};this.$propHandlers.plugins=function(value){this.$pluginsOn=value&&value.splitSafe(",")||null;
if(this.$pluginsOn&&this.$pluginsOn.length){for(var i=0,l=this.$pluginsOn.length;
i<l;i++){this.$addPlugin(this.$pluginsOn[i]);}}};this.$propHandlers.language=function(value){};
this.addEventListener("prop.liveedit",function(e){if(e.value){if(this.plugins==undefined&&this.$propHandlers.plugins){this.$propHandlers.plugins.call(this,this.$pluginsOn.join(","));
}}else{if(this.$docklet){this.$docklet.hide();}}});function keyupHandler(e){var _self=this;
if(this.$selection){this.$selection.cache();}if(this.$keyupTimer){return;}function keyupHandler(){clearTimeout(_self.$keyupTimer);
_self.$keyupTimer=null;if(_self.state==apf.DISABLED){return;}_self.$notifyAllButtons();
_self.dispatchEvent("typing",{editor:_self,event:e});_self.$notifyAllPlugins("typing",e.keyCode);
}this.$keyupTimer=window.setTimeout(keyupHandler,100);}function keydownHandler(e){var found,code=e.which||e.keyCode;
if(apf.isIE){switch(code){case 66:case 98:case 105:case 73:case 117:case 85:if((e.ctrlKey||(apf.isMac&&e.metaKey))&&!e.shiftKey&&!e.altKey&&this.realtime){this.change(this.getValue());
}break;case 8:found=false;if(this.$selection.getType()=="Control"){this.$selection.remove();
found=true;}listBehavior.call(this,e,true);if(found){return false;}break;case 46:listBehavior.call(this,e,true);
break;case 9:if(listBehavior.call(this,e)){return false;}break;}}else{this.$visualFocus();
if((e.ctrlKey||(apf.isMac&&e.metaKey))&&!e.shiftKey&&!e.altKey){found=false;switch(code){case 66:case 98:this.$execCommand("Bold");
found=true;break;case 105:case 73:this.$execCommand("Italic");found=true;break;
case 117:case 85:this.$execCommand("Underline");found=true;break;case 86:case 118:if(!apf.isGecko){this.$paste();
}break;}if(found){apf.stopEvent(e.htmlEvent||e);if(this.realtime&&this.$bStandalone){this.change(this.getValue());
}}}var sel,r,r2,m;if(apf.isGecko&&(code==37||code==39)&&!e.shiftKey&&!e.metaKey&&!e.ctrlKey&&!this.$selection.isCollapsed()){sel=this.$selection.get();
r=this.$selection.getRange();r2=r.cloneRange();var _self=this;setTimeout(function(){sel.removeAllRanges();
sel.addRange(r2);_self.$selection.collapse((code==37));},20);}else{if(apf.isWebkit&&code==37&&(e.ctrlKey||(apf.isMac&&e.altKey))&&!e.shiftKey){sel=this.$selection.get();
r=this.$selection.getRange();r2=r.cloneRange();r2.setStart(r2.commonAncestorContainer,0);
m=r2.toString().match(/[\w]*(:?\W)?/g);if(m&&m.length==2&&!m[1]){r2.setEnd(r2.commonAncestorContainer,0);
sel.removeAllRanges();sel.addRange(r2);}}else{if(apf.isGecko&&code==39&&!apf.isMac&&e.ctrlKey&&!e.altKey){sel=this.$selection.get();
r=this.$selection.getRange();r2=r.cloneRange();if(r2.commonAncestorContainer.nodeType==3){var s=r2.commonAncestorContainer.textContent.replace(rePunctuation,""),l=s.length;
r2.setEnd(r2.commonAncestorContainer,l);m=r2.toString().match(/[\w]*(:?\W)?/g);
if(m&&m.length==2&&!m[1]){r2.setEnd(r2.commonAncestorContainer,l);r2.setStart(r2.commonAncestorContainer,l);
sel.removeAllRanges();sel.addRange(r2);}}}}}}this.$visualFocus();if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey){found=this.$notifyKeyBindings({code:code,control:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey});
}if(code==9){if(listBehavior.call(this,e.htmlEvent||e)){return apf.stopEvent(e.htmlEvent||e);
}}else{if(code==8||code==46){listBehavior.call(this,e.htmlEvent||e,true);}}if(found){return apf.stopEvent(e);
}}function createKeyHash(keyMap){return(keyMap.meta?2048:0)|(keyMap.control?1024:0)|(keyMap.alt?512:0)|(keyMap.shift?256:0)|(keyMap.key||"").charCodeAt(0);
}function buttonEnable(){apf.setStyleClass(this,"editor_enabled",["editor_selected","editor_disabled"]);
this.disabled=false;}function buttonDisable(){apf.setStyleClass(this,"editor_disabled",["editor_selected","editor_enabled"]);
this.disabled=true;}function getState(id,isPlugin){if(isPlugin){var plugin=this.$plugins[id];
if(this.state==apf.DISABLED&&!plugin.noDisable){return apf.DISABLED;}return plugin.queryState?plugin.queryState(this):this.state;
}if(this.state==apf.DISABLED){return apf.DISABLED;}return this.$queryCommandState(id);
}function listBehavior(e,bFix){if(!this.$plugins.bullist||!this.$plugins.numlist){return false;
}if(typeof e.shift!="undefined"){e.shiftKey=e.shift;}var pList=this.$plugins.bullist.queryState(this)==apf.ON?this.$plugins.bullist:this.$plugins.numlist.queryState(this)==apf.ON?this.$plugins.numlist:null;
if(!pList){return false;}if(bFix===true){pList.correctLists(this);}else{pList.correctIndentation(this,e.shiftKey?"outdent":"indent");
}return true;}this.$queryCommandState=function(name){if(apf.isGecko&&(name=="paste"||name=="copy"||name=="cut")){return apf.DISABLED;
}try{if(!this.$activeDocument.queryCommandEnabled(name)){return apf.DISABLED;}else{return this.$activeDocument.queryCommandState(name)?apf.ON:apf.OFF;
}}catch(e){return apf.OFF;}};this.$queryCommandValue=function(name){var val;if(typeof this.$activeDocument.queryCommand!="function"){return null;
}try{val=this.$activeDocument.queryCommand(name);}catch(e){}return val||null;};
this.$execCommand=function(name,param){if(this.$plugins[name]||this.state==apf.DISABLED){return;
}this.$selection.set();this.$visualFocus();if(name.toLowerCase()=="removeformat"){var c=this.$selection.getContent(),disallowed={FONT:1,SPAN:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,PRE:1,ADDRESS:1,BLOCKQUOTE:1,STRONG:1,B:1,U:1,I:1,EM:1,LI:1,OL:1,UL:1,DD:1,DL:1,DT:1};
c=c.replace(/<\/?(\w+)(?:\s.*?|)>/g,function(m,tag){return !disallowed[tag]?m:"";
});if(apf.isIE){var htmlNode=this.$selection.setContent("<div>"+c+"</div>");this.$selection.selectNode(htmlNode);
htmlNode.removeNode(false);return;}else{this.$selection.setContent(c);}}this.$activeDocument.execCommand(name,false,param);
name=name.toLowerCase();var bNoSel=(name=="selectall");if(apf.isIE){if((name=="insertunorderedlist"||name=="insertorderedlist")&&this.$queryCommandState(name)==apf.OFF){bNoSel=true;
}else{if(name=="outdent"){bNoSel=true;if(this.$plugins.bullist&&this.$plugins.numlist){if(this.$plugins.bullist.queryState(this)!=apf.OFF&&this.$plugins.numlist.queryState(this)!=apf.OFF){bNoSel=false;
}}var oNode=this.$selection.getSelectedNode();if(bNoSel&&oNode&&oNode.tagName=="BLOCKQUOTE"){bNoSel=false;
}}}if(bNoSel){var el=this.$bStandalone?this.$activeDocument.body:this.$activeNode;
el.innerHTML=apf.htmlCleaner.prepare(el.innerHTML);this.$controlAgentBehavior(el);
}var r=this.$selection.getRange();if(r){r.scrollIntoView();}}this.$notifyAllButtons();
if(this.$bStandalone){this.change(this.getValue());}var _self=this;$setTimeout(function(){if(!bNoSel){_self.$selection.set();
}if(apf.isIE){_self.focus();$setTimeout(function(){_self.$visualFocus();});}else{_self.$visualFocus();
}_self.dispatchEvent("execcommand",{name:name,param:param});});};this.$addPlugin=function(sPlugin){if(this.$plugins[sPlugin]){return this.$plugins[sPlugin];
}if(!apf.LiveEdit.plugin[sPlugin]){return null;}var plugin=new apf.LiveEdit.plugin[sPlugin](sPlugin);
this.$plugins[plugin.name]=plugin;if(plugin.type){if(!this.$pluginsTypes[plugin.type]){this.$pluginsTypes[plugin.type]=[];
}this.$pluginsTypes[plugin.type].push(plugin);}if(plugin.subType){if(!this.$pluginsTypes[plugin.subType]){this.$pluginsTypes[plugin.subType]=[];
}this.$pluginsTypes[plugin.subType].push(plugin);}if(plugin.hook){plugin.hook=plugin.hook.toLowerCase();
if(!this.$pluginsHooks[plugin.hook]){this.$pluginsHooks[plugin.hook]=[];}this.$pluginsHooks[plugin.hook].push(plugin);
}if(typeof plugin.keyBinding=="string"){plugin.keyBinding={meta:(plugin.keyBinding.indexOf("meta")>-1),control:(plugin.keyBinding.indexOf("ctrl")>-1),alt:(plugin.keyBinding.indexOf("alt")>-1),shift:(plugin.keyBinding.indexOf("shift")>-1),key:plugin.keyBinding.charAt(plugin.keyBinding.length-1).toLowerCase()};
plugin.keyHash=createKeyHash(plugin.keyBinding);if(!this.$pluginsKeys[plugin.keyHash]){this.$pluginsKeys[plugin.keyHash]=[];
}this.$pluginsKeys[plugin.keyHash].push(plugin);}return plugin;};this.$notifyPlugin=function(name,hook){var item=this.$plugins[name];
if(item&&item.hook==hook&&!item.busy){return item.execute(this,arguments);}return null;
};this.$notifyAllPlugins=function(hook,e){var res=[];if(!this.$pluginsHooks){return res;
}var coll=this.$pluginsHooks[hook];for(var i in coll){if(!coll[i].busy&&coll[i].execute){res.push(coll[i].execute(this,e));
}}return res;};this.$notifyKeyBindings=function(keyMap){var hash=createKeyHash(keyMap);
if(!this.$pluginsKeys[hash]||!this.$pluginsKeys[hash].length){return false;}var coll=this.$pluginsKeys[hash];
for(var i=0,j=coll.length;i<j;i++){coll[i].execute(this,arguments);}return true;
};this.$notifyButton=function(item,state){if(!this.$plugins){return;}var oButton=this.$buttons[item];
if(!oButton){return;}var oPlugin=this.$plugins[item];if(typeof state=="undefined"||state===null){if(oPlugin&&oPlugin.queryState){state=oPlugin.queryState(this);
}else{state=this.$queryCommandState(item);}}if(oButton.state===state){return;}oButton.state=state;
if(state==apf.DISABLED){buttonDisable.call(oButton);}else{if(state==apf.HIDDEN){oButton.style.display="none";
}else{if(state==apf.VISIBLE){oButton.style.display="";}else{if(oButton.style.display=="none"){oButton.style.display="";
}if(oButton.disabled){buttonEnable.call(oButton);}var btnState=(oButton.selected)?apf.ON:apf.OFF;
if(state!=btnState){this.$buttonClick({state:state,isPlugin:oPlugin?true:false,_bogus:true},oButton);
}}}}};this.$notifyAllButtons=function(state){var item,o=this.$buttons;for(item in o){this.$notifyButton(item,state);
}};this.$restoreFocus=function(bWithSel){if(apf.isIE){var _self=this;$setTimeout(function(){if(bWithSel){_self.$selection.set();
}_self.focus();$setTimeout(function(){_self.$visualFocus();});});}};this.$buttonClick=function(e,oButton,userAction){if(userAction&&this.disabled){return;
}if(this.$selection){this.$selection.cache();}apf.setStyleClass(oButton,"active");
var item=oButton.getAttribute("type");if(!e._bogus){e.isPlugin=this.$plugins[item]?true:false;
e.state=getState.call(this,item,e.isPlugin);}if(e.state==apf.DISABLED){buttonDisable.call(oButton);
}else{if(this.disabled){buttonEnable.call(oButton);}if(e.state==apf.ON){apf.setStyleClass(oButton,"editor_selected");
oButton.selected=true;}else{apf.setStyleClass(oButton,"",["editor_selected"]);oButton.selected=false;
}if(!e._bogus){if(e.isPlugin){this.$plugins[(this.$pluginsActive=item)].execute(this);
}else{this.$execCommand(item);}e.state=getState.call(this,item,e.isPlugin);}}apf.setStyleClass(oButton,"",["active"]);
};this.$drawToolbars=function(oParent,sSkinTag,sBtnClick,bAfterRender){var tb,l,k,i,j,z,x,node,buttons,bIsPlugin,item,bNode,plugin,oButton,sButton=this.$bStandalone?"button":"toolbarbutton",oNode=this.$docklet.$getOption("toolbars"),plugins=this.$plugins;
if(!sSkinTag){sSkinTag="toolbar";}for(i=0,l=oNode.childNodes.length;i<l;i++){node=oNode.childNodes[i];
if(node.nodeType!=1||node[apf.TAGNAME]!=sSkinTag){continue;}for(j=0,k=node.childNodes.length;
j<k;j++){bNode=node.childNodes[j];if(bNode.nodeType!=3&&bNode.nodeType!=4){throw new Error(apf.formatErrorString(0,this,"Creating toolbars","Invalid element found in toolbar definition",bNode));
}buttons=bNode.nodeValue.splitSafe(",",-1,true);}if(!buttons||!buttons.length){continue;
}this.$docklet.$getNewContext("toolbar");tb=bAfterRender?apf.insertHtmlNode(this.$docklet.$getLayoutNode("toolbar"),oParent,oParent.firstChild):oParent.insertBefore(this.$docklet.$getLayoutNode("toolbar"),oParent.firstChild);
for(z=0,x=buttons.length;z<x;z++){item=buttons[z];if(item=="|"){this.$docklet.$getNewContext("divider");
if(bAfterRender){apf.insertHtmlNode(this.$docklet.$getLayoutNode("divider"),tb);
}else{tb.appendChild(this.$docklet.$getLayoutNode("divider"));}}else{this.$docklet.$getNewContext(sButton);
oButton=bAfterRender?oButton=apf.insertHtmlNode(this.$docklet.$getLayoutNode(sButton),tb):oButton=tb.appendChild(this.$docklet.$getLayoutNode(sButton));
bIsPlugin=false;if(sSkinTag=="toolbar"&&!this.$nativeCommands.contains(item)){plugin=this.$addPlugin(item);
if(!plugin){apf.console.error("Plugin '"+item+"' can not be found and/ or instantiated.","editor");
}bIsPlugin=true;}if(bIsPlugin){plugin=plugin||plugins[item];if(!plugin){continue;
}if(!(plugin.type&apf.TOOLBARITEM)){continue;}this.$docklet.$getLayoutNode(sButton,"label",oButton).setAttribute("class","editor_icon editor_"+plugin.icon);
oButton.setAttribute("title",this.$translate(plugin.name));}else{this.$docklet.$getLayoutNode(sButton,"label",oButton).setAttribute("class","editor_icon editor_"+item);
oButton.setAttribute("title",this.$translate(item));}oButton.setAttribute("onmousedown",sBtnClick||"apf.all["+this.$uniqueId+"].$buttonClick(event, this, true);");
oButton.setAttribute("onmouseover","apf.setStyleClass(this, 'hover', null, true);");
oButton.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover'], true);");
oButton.setAttribute("type",item);}}buttons=null;}if(apf.isIE){var nodes=oParent.getElementsByTagName("*");
for(i=nodes.length-1;i>=0;i--){nodes[i].setAttribute("unselectable","On");}}};var wasVisible;
this.$editors.richtext={create:function(oHtml,rule){this.getValue=function(){return apf.htmlCleaner.parse(oHtml.innerHTML);
};oHtml.setAttribute("richtext","true");if(apf.isGecko){try{document.execCommand("insertBrOnReturn",false,true);
document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false);
}catch(ex){}}if(!this.$docklet){this.$editable();}if(this.$docklet){this.$docklet.show();
var pos=apf.getAbsolutePosition(oHtml);var w=this.$docklet.$ext.offsetWidth;var h=this.$docklet.$ext.offsetHeight;
if(pos[0]+oHtml.offsetWidth+w+5>apf.getWindowWidth()){pos[0]=apf.getWindowWidth()-w-5;
}else{pos[0]+=oHtml.offsetWidth+5;}if(pos[1]-h-5<0){if(pos[1]+oHtml.offsetHeight+5+h<apf.getWindowHeight()){pos[1]=pos[1]+oHtml.offsetHeight+5;
}else{pos[1]=0;}}else{pos[1]-=h+5;}var dPos=apf.getAbsolutePosition(this.$docklet.$ext);
if(this.$control){this.$control.stop();}this.$control={};var tweens=[{from:dPos[0],to:pos[0],type:"left"},{from:dPos[1],to:pos[1],type:"top"}];
if(!wasVisible){tweens.push({from:0,to:1,type:"fade"});}else{apf.setOpacity(this.$docklet.$ext,1);
}apf.tween.multi(this.$docklet,{steps:30,interval:10,control:this.$control,anim:apf.tween.easeInOutCubic,tweens:tweens});
setTimeout(function(){wasVisible=true;});}this.setProperty("state",apf.OFF);if(apf.hasContentEditable){oHtml.contentEditable=true;
}else{document.body.setAttribute("spellcheck","false");document.designMode="on";
}this.$lastValue=[];this.$lastValue[0]=apf.htmlCleaner.prepare((this.$lastValue[1]=oHtml.innerHTML).replace(/<p[^>]*>/gi,"").replace(/<\/P>/g,"").replace(/<\/p>/g,"<br _apf_marker='1' /><br _apf_marker='1' />"));
if(this.$lastValue[1]!=this.$lastValue[0]){var obm=this.$selection.getBookmark();
oHtml.innerHTML=this.$lastValue[0];this.$controlAgentBehavior(oHtml);this.$selection.moveToBookmark(obm);
}this.addEventListener("keydown",keydownHandler,true);this.addEventListener("keyup",keyupHandler,true);
},remove:function(oHtml,rule){oHtml.blur();if(apf.hasContentEditable){oHtml.contentEditable=false;
}else{document.designMode="off";}oHtml.setAttribute("richtext","false");this.removeEventListener("keydown",keydownHandler,true);
this.removeEventListener("keyup",keyupHandler,true);}};this.addEventListener("$createEditor",function(e){if(e.editor!="richtext"&&this.$docklet){setTimeout(function(){wasVisible=false;
});this.$docklet.hide();}});this.addEventListener("$removeEditor",function(e){if(e.editor=="richtext"&&this.$docklet){setTimeout(function(){wasVisible=false;
});this.$docklet.hide();}});this.$editable=function(callback){if(this.getAttribute("plugins")){this.$propHandlers.plugins.call(this,this.getAttribute("plugins"));
}if(this.getAttribute("language")){this.$propHandlers.language.call(this,this.getAttribute("language"));
}if(!this.$ext){this.$docklet=this;this.$bStandalone=true;this.$ext=this.$getExternal("main",null,function(oExt){var o=this.$getLayoutNode("main","toolbar");
this.$drawToolbars(o);});this.$toolbar=this.$getLayoutNode("main","toolbar",this.$ext);
this.addEventListener("keydown",keydownHandler,true);this.addEventListener("keyup",keyupHandler,true);
}else{if(!this.$docklet&&!(apf.LiveEdit.toolwin=this.$docklet)){var _self=this;
this.$docklet=apf.LiveEdit.toolwin=new apf.modalwindow({htmlNode:document.body,skinset:apf.getInheritedAttribute(this.parentNode,"skinset"),buttons:"",title:"Format",icon:"application.png",resizable:false,draggable:true,focussable:true,modal:false,left:500,top:100,width:275,zindex:100000,onfocus:function(){_self.focus();
}},"toolwindow");var aNodes=this.$docklet.$ext.getElementsByTagName("div");for(var j=0,l=aNodes.length;
j<l;j++){if(aNodes[j].className.indexOf("content")!=-1){this.$toolbar=aNodes[j];
break;}}this.$drawToolbars(this.$toolbar,"toolbar",null,true);}}if(callback){callback.call(this);
}if(this.$toolbar){var item,plugin,btns=this.$toolbar.getElementsByTagName("div"),i=btns.length-1;
for(;i>=0;i--){item=btns[i].getAttribute("type");if(!item){continue;}this.$buttons[item]=btns[i];
plugin=this.$plugins[item];if(!plugin){continue;}plugin.buttonNode=btns[i];if(plugin.init){plugin.init(this);
}}}};this.$getPluginOption=function(node){return this.$docklet.$getOption(node);
};this.$showPopup=function(oPlugin,sCacheId,oRef,iWidth,iHeight){if(apf.popup.last&&apf.popup.last!=sCacheId){var o=apf.lookup(apf.popup.last);
if(o){o.state=apf.OFF;this.$notifyPlugin(o.name,o.state);}}this.$selection.set();
if(this.$visualFocus){this.$visualFocus();}oPlugin.state=apf.ON;this.$notifyPlugin(oPlugin.name,apf.ON);
if(apf.popup.isShowing(sCacheId)){return;}$setTimeout(function(){apf.popup.show(sCacheId,{x:0,y:22,animate:false,ref:oRef,width:iWidth,height:iHeight,callback:function(oPopup){if(oPopup.onkeydown){return;
}oPopup.onkeydown=function(e){e=e||window.event;var key=e.which||e.keyCode;if(key==13&&typeof oPlugin.submit=="function"){return oPlugin.submit(new apf.AbstractEvent(e));
}};}});});};this.$translate=function(key,bIsPlugin){if((!bIsPlugin&&!apf.LiveEdit.i18n[this.language][key])||(bIsPlugin&&!apf.LiveEdit.i18n[this.language]["plugins"][key])){apf.console.error("Translation does not exist"+(bIsPlugin?" for plugin":"")+": "+key);
}return bIsPlugin?apf.LiveEdit.i18n[this.language]["plugins"][key]:apf.LiveEdit.i18n[this.language][key];
};this.$insertHtml=function(html,bNoParse,bNoFocus){if(!bNoFocus){this.$selection.set();
}this.$visualFocus(true);html=bNoParse?html:apf.htmlCleaner.prepare(html);this.$selection.setContent(html,true);
if(this.$bStandalone){this.change(this.getValue());}if(!bNoFocus){this.$restoreFocus();
}};this.$paste=function(e){var _self=this;$setTimeout(function(){var s=_self.$activeDocument.body.innerHTML;
if(s.match(/mso[a-zA-Z]+/i)){var o=_self.$plugins.pasteword;if(o){_self.$propHandlers.value.call(_self,o.parse(s));
}}if(_self.realtime){_self.change(_self.getValue());}});};this.$controlAgentBehavior=function(oParent){if(apf.isGecko){var oNode;
while(oParent.childNodes.length){oNode=oParent.firstChild;if(oNode.nodeType==1){if(oNode.nodeName=="BR"&&oNode.getAttribute("_moz_editor_bogus_node")=="TRUE"){this.$selection.selectNode(oNode);
this.$selection.remove();this.$selection.collapse(false);break;}}oParent=oNode;
}}else{if(apf.isWebkit){this.$activeDocument.designMode="on";}else{if(apf.isIE){var s,aLinks=oParent.getElementsByTagName("a");
for(var i=0,j=aLinks.length;i<j;i++){s=aLinks[i].getAttribute("_apf_href");if(s){aLinks[i].href=(!s.match(/^[a-zA-Z]+\:/)?"http://":"")+s;
}}}}}};this.language="en_GB";this.state=apf.OFF;};apf.ON=1;apf.OFF=0;apf.DISABLED=-1;
apf.VISIBLE=2;apf.HIDDEN=3;apf.SELECTED=4;apf.LiveEdit.i18n={en_GB:{cancel:"Cancel",insert:"Insert",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",justifyleft:"Align text left",justifycenter:"Center",justifyright:"Align text right",justifyfull:"Justify",removeformat:"Clear formatting",cut:"Cut",copy:"Copy",paste:"Paste",outdent:"Decrease indent",indent:"Increase indent",undo:"Undo",redo:"Redo",anchor:"Insert anchor",blockquote:"Blockquote",charmap:"Character map",code:"HTML source view",listitem:"List item",nbsp:"Non-breaking space","break":"Linebreak",paragraph:"Paragraph",forecolor:"Font color",backcolor:"Highlight color",insertdate:"Insert current date",inserttime:"Insert current time",rtl:"Change text direction to right-to-left",ltr:"Change text direction to left-to-right",emotions:"Insert emotion",fonts:"Font",fontsize:"Font size",fontstyle:"Font style",blockformat:"Paragraph style",help:"Help",hr:"Insert horizontal rule",image:"Insert image",imagespecial:"Choose an image to insert",link:"Insert hyperlink",unlink:"Remove hyperlink",bullist:"Bullets",numlist:"Numbering",media:"Insert medium",pasteworddialog:"Paste from Word",pastetext:"Paste plaintext",paste_keyboardmsg:"Use %s on your keyboard to paste the text into the window.",print:"Print document",preview:"Preview document",spell:"Turn spellcheck on/ off",search:"Search",replace:"Search and Replace",findnext:"Find next",doreplace:"Replace",replaceall:"Replace all",sub:"Subscript",sup:"Superscript",table:"Insert table",table_noun:"Table",visualaid:"Toggle visual aid on/ off"},nl_NL:{cancel:"Annuleren",insert:"Invoegen",bold:"Vet",italic:"Schuingedrukt",underline:"Onderstreept",strikethrough:"Doorgestreept",justifyleft:"Recht uitlijnen",justifycenter:"Centreren",justifyright:"Rechts uitlijnen",justifyfull:"Justify",removeformat:"Stijlen verwijderen",cut:"Knippen",copy:"Kopieren",paste:"Plakken",outdent:"Inspringen verkleinen",indent:"Inspringen vergroten",undo:"Ongedaan maken",redo:"Opnieuw",anchor:"Anchor invoegen",blockquote:"Blockquote",charmap:"Speciale tekens",code:"HTML broncode",listitem:"Lijst item",nbsp:"Niet-brekende spatie","break":"Regelafbreuk",paragraph:"Paragraaf",forecolor:"Tekstkleur",backcolor:"Markeerkleur",insertdate:"Huidige datum invoegen",inserttime:"Huidige tijd invoegen",rtl:"Verander tekstrichting naar rechts-naar-links",ltr:"Verander tekstrichting naar links-naar-rechts",emotions:"Emoticon invoegen",fonts:"Lettertype",fontsize:"Letter grootte",fontstyle:"Tekststijl",blockformat:"Paragraafstijl",help:"Hulp",hr:"Horizontale lijn invoegen",image:"Afbeelding invoegen",imagespecial:"Afbeelding kiezen",link:"Link invoegen",unlink:"Link verwijderen",bullist:"Ongenummerd",numlist:"Genummerd",media:"Medium invoegen",pasteworddialog:"Word Tekst Plakken",pastetext:"Tekst Plakken",paste_keyboardmsg:"Gebruik %s op uw toetsenbord om tekst in dit scherm te plakken.",print:"Printen",preview:"Voorbeeldvertoning",spell:"Spellingscontrole aan/ uit",search:"Zoeken",replace:"Zoeken en vervangen",findnext:"Volgende",doreplace:"Vervangen",replaceall:"Vervang alle",sub:"Subscript",sup:"Superscript",table:"Tabel invoegen",table_noun:"Tabel",visualaid:"Visuele hulp aan/ uit"}};
apf.TOOLBARITEM=1;apf.TOOLBARBUTTON=2;apf.TOOLBARPANEL=4;apf.TEXTMACRO=8;apf.CMDMACRO=16;
apf.LiveEdit.plugin=function(sName,fExec){apf.LiveEdit.plugin[sName]=function(){this.$uniqueId=apf.all.push(this)-1;
this.appendAmlNode=function(sNode,oParent){if(!sNode){return null;}var domParser=new apf.DOMParser(),oFrag=this.editor.ownerDocument.createDocumentFragment();
oFrag.$int=oParent;var oNode=domParser.parseFromString(sNode,"text/xml",{doc:this.editor.ownerDocument,docFrag:oFrag});
return oNode.firstChild;};this.dispatchEvent=function(){var _self=this;window.setTimeout(function(){if(_self.type==apf.editor.CONTEXTPANEL&&_self.queryState(_self.editor)==apf.editor.ON){return;
}_self.state=apf.editor.OFF;if(_self.editor){_self.editor.$notifyButton(_self.name,_self.state);
}apf.popup.hide();apf.popup.last=null;});return false;};this.$destroy=function(){apf.popup.forceHide();
this.buttonNode=this.editor=null;delete this.buttonNode;delete this.editor;if(this.destroy){this.destroy();
}};fExec.apply(this,arguments);};};apf.LiveEdit.plugin("anchor",function(){this.name="anchor";
this.icon="anchor";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.keyBinding="ctrl+shift+a";this.state=apf.OFF;this.editor=null;var panelBody;
this.init=function(editor,btn){this.editor=editor;this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody());}this.editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,47);if(panelBody.style.visibility=="hidden"){panelBody.style.visibility="visible";
}var _self=this;$setTimeout(function(){_self.oName.focus();});return{id:this.name,action:null};
};this.queryState=function(){var oNode=this.editor.$selection.getSelectedNode();
if(oNode.tagName=="A"&&oNode.getAttribute("name")){return apf.ON;}return this.state;
};this.submit=function(e){apf.popup.forceHide();if(!this.oName.value){return;}this.editor.$insertHtml('<a name="'+this.oName.value+'" class="itemAnchor" />');
this.editor.$selection.collapse(false);};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var idName="editor_"+this.$uniqueId+"_anchor_url",idButton="editor_"+this.$uniqueId+"_anchor_button";
panelBody.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+idName+'">Anchor name</label>                <input type="text" id="'+idName+'" name="'+idName+'" class="editor_input" value="" />            </div>            <div id="'+idButton+'" class="editor_panelrow editor_panelrowbtns"></div>';
new apf.toolbar({htmlNode:document.getElementById(idButton),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:[new apf.button({caption:this.editor.$translate("insert"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]})]});
this.oName=document.getElementById(idName);apf.sanitizeTextbox(this.oName);return panelBody;
};this.destroy=function(){panelBody=this.editor=this.oName=null;delete panelBody;
delete this.editor;delete this.oName;};});apf.LiveEdit.plugin("blockquote",function(){this.name="blockquote";
this.icon="blockquote";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;
this.hook="ontoolbar";this.keyBinding="ctrl+shift+b";this.buttonBuilt=false;this.state=apf.OFF;
this.execute=function(editor){editor.$execCommand("FormatBlock","BLOCKQUOTE");editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(editor){return editor.$queryCommandState("FormatBlock");
};});apf.LiveEdit.plugin("charmap",function(){this.name="charmap";this.icon="charmap";
this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;
this.state=apf.OFF;this.colspan=20;var panelBody;this.init=function(editor,btn){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody());}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,apf.isIE6?469:466,318);
return{id:this.name,action:null};};this.queryState=function(){return this.state;
};var chars=["!","&#34;","#","$","%","&#38;","\\'","(",")","*","+","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","&#60;","=","&#62;","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","&#161;","&#162;","&#163;","&#164;","&#165;","&#166;","&#167;","&#168;","&#169;","&#170;","&#171;","&#172;","&#174;","&#175;","&#176;","&#177;","&#178;","&#179;","&#180;","&#181;","&#182;","&#183;","&#184;","&#185;","&#186;","&#187;","&#188;","&#189;","&#190;","&#191;","&#192;","&#193;","&#194;","&#195;","&#196;","&#197;","&#198;","&#199;","&#200;","&#201;","&#202;","&#203;","&#204;","&#205;","&#206;","&#207;","&#208;","&#209;","&#210;","&#211;","&#212;","&#213;","&#214;","&#215;","&#216;","&#217;","&#218;","&#219;","&#220;","&#221;","&#222;","&#223;","&#224;","&#225;","&#226;","&#227;","&#228;","&#229;","&#230;","&#231;","&#232;","&#233;","&#234;","&#235;","&#236;","&#237;","&#238;","&#239;","&#241;","&#242;","&#243;","&#244;","&#245;","&#246;","&#247;","&#248;","&#249;","&#250;","&#251;","&#252;","&#253;","&#254;","&#255;","&#338;","&#339;","&#352;","&#353;","&#376;","&#402;","&#710;","&#732;","&#913;","&#914;","&#915;","&#916;","&#917;","&#918;","&#919;","&#920;","&#921;","&#922;","&#923;","&#924;","&#925;","&#926;","&#927;","&#928;","&#929;","&#931;","&#932;","&#933;","&#934;","&#935;","&#936;","&#937;","&#945;","&#946;","&#947;","&#948;","&#949;","&#950;","&#951;","&#952;","&#953;","&#954;","&#955;","&#956;","&#957;","&#958;","&#959;","&#960;","&#961;","&#962;","&#963;","&#964;","&#965;","&#966;","&#967;","&#968;","&#969;","&#977;","&#978;","&#982;","&#8201;","&#8211;","&#8212;","&#8216;","&#8217;","&#8218;","&#8220;","&#8221;","&#8222;","&#8224;","&#8225;","&#8226;","&#8230;","&#8240;","&#8242;","&#8243;","&#8249;","&#8250;","&#8254;","&#8260;","&#8364;","&#8465;","&#8472;","&#8476;","&#8482;","&#8501;","&#8592;","&#8593;","&#8594;","&#8595;","&#8596;","&#8629;","&#8656;","&#8657;","&#8658;","&#8659;","&#8660;","&#8704;","&#8706;","&#8707;","&#8709;","&#8711;","&#8712;","&#8713;","&#8715;","&#8719;","&#8721;","&#8722;","&#8727;","&#8730;","&#8733;","&#8734;","&#8736;","&#8743;","&#8744;","&#8745;","&#8746;","&#8747;","&#8756;","&#8764;","&#8773;","&#8776;","&#8800;","&#8801;","&#8804;","&#8805;","&#8834;","&#8835;","&#8836;","&#8838;","&#8839;","&#8853;","&#8855;","&#8869;","&#8901;","&#8968;","&#8969;","&#8970;","&#8971;","&#9001;","&#9002;","&#9674;","&#9824;","&#9827;","&#9829;","&#9830;"];
this.submit=function(e){var el=e.target||e.srcElement;while(el.tagName.toLowerCase()!="a"&&el.className!="editor_popup"){el=el.parentNode;
}var sCode=el.getAttribute("rel");if(sCode){apf.popup.forceHide();this.editor.$insertHtml(sCode,true);
var _self=this;$setTimeout(function(){_self.editor.change(_self.editor.getValue());
});}};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var aHtml=[];
var rowLen=this.colspan-1;for(var i=0;i<chars.length;i++){if(i%this.colspan==0){aHtml.push('<div class="editor_panelrow">');
}aHtml.push('<a class="editor_panelcell editor_largecell" style="background-color:#',chars[i],';" rel="',chars[i],'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">                <span>',chars[i],"</span>                </a>");
if(i%this.colspan==rowLen){aHtml.push("</div>");}}panelBody.innerHTML=aHtml.join("");
return panelBody;};this.destroy=function(){panelBody=null;delete panelBody;};});
apf.LiveEdit.pasteDialog=function(sName){this.name=sName;this.icon=sName=="pasteworddialog"?"pasteword":sName;
this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding=sName=="pastetext"?"ctrl+shift+v":"ctrl+shift+w";
this.state=apf.OFF;var panelBody;this.init=function(){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]).className="selectarrow";
};this.execute=function(editor){if(!panelBody){this.editor=editor;apf.popup.setContent(this.$uniqueId,this.createPanelBody());
}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,300,270);
if(panelBody.style.visibility=="hidden"){panelBody.style.visibility="visible";}var _self=this;
$setTimeout(function(){try{_self.oArea.focus();}catch(ex){}},100);return{id:this.name,action:null};
};this.queryState=function(editor){return this.state;};this.submit=function(e){apf.popup.forceHide();
var sContent=this.oArea.value;if(!sContent||sContent.length==0){return;}if(this.name=="pastetext"){var rl=["\u2122","<sup>TM</sup>","\u2026","...","\u201c|\u201d",'"',"\u2019,'","\u2013|\u2014|\u2015|\u2212","-"];
sContent=sContent.replace(/\u2122/gi,"<sup>TM</sup>").replace(/\u2026/gi,"...").replace(/\u201c|\u201d/gi,'"').replace(/\u2019,'/gi,"'").replace(/\u2013|\u2014|\u2015|\u2212/gi,"-").replace(/\r\n/g,"<br />").replace(/\r/g,"<br />").replace(/\n/g,"<br />");
}else{sContent=this.editor.$plugins.pasteword.parse(sContent);}this.editor.$insertHtml(sContent);
apf.stopEvent(e);return false;};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var idArea="editor_"+this.$uniqueId+"_input",idBtns="editor_"+this.$uniqueId+"_btns";
panelBody.innerHTML='<label for="'+idArea+'">'+this.editor.$translate("paste_keyboardmsg").sprintf(apf.isMac?"CMD+V":"CTRL+V")+'</label>            <textarea id="'+idArea+'" name="'+idArea+'"  wrap="soft" dir="ltr"               cols="60" rows="10" class="editor_textarea"></textarea>            <div class="editor_panelrow" style="position:absolute;bottom:0;width:100%" id="'+idBtns+'"></div>';
this.oArea=document.getElementById(idArea);apf.sanitizeTextbox(this.oArea);if(apf.isIE){this.oArea.onselectstart=this.oArea.onpaste=function(e){e=e||window.event;
e.cancelBubble=true;};}new apf.toolbar({htmlNode:document.getElementById(idBtns),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:[new apf.button({caption:this.editor.$translate("insert"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]})]});
return panelBody;};this.destroy=function(){panelBody=this.oArea=null;delete panelBody;
delete this.oArea;};};apf.LiveEdit.plugin("pasteworddialog",apf.LiveEdit.pasteDialog);
apf.LiveEdit.plugin("pastetext",apf.LiveEdit.pasteDialog);apf.LiveEdit.plugin("pasteword",function(){this.name="pasteword";
this.icon="pasteword";this.type=apf.CMDMACRO;this.hook="onpaste";this.keyBinding="ctrl+shift+v";
this.state=apf.OFF;this.parse=function(sContent){var bull=String.fromCharCode(8226),middot=String.fromCharCode(183);
sContent=sContent.replace(new RegExp("<p class=MsoHeading.*?>(.*?)</p>","gi"),"<p><b>$1</b></p>").replace(new RegExp('tab-stops: list [0-9]+.0pt">',"gi"),'">--list--').replace(new RegExp(bull+"(.*?)<BR>","gi"),"<p>"+middot+"$1</p>").replace(new RegExp('<SPAN style="mso-list: Ignore">',"gi"),"<span>"+bull).replace(new RegExp('<br style="page-break-before: always;.*>',"gi"),"-- page break --").replace(/<o:p>\s*<\/o:p>/g,"").replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;").replace(/\s*mso-[^:]+:[^;"]+;?/gi,"").replace(/\s*MARGIN: 0(?:cm|in) 0(?:cm|in) 0pt\s*;/gi,"").replace(/\s*MARGIN: 0(?:cm|in) 0(?:cm|in) 0pt\s*"/gi,'"').replace(/\s*TEXT-INDENT: 0cm\s*;/gi,"").replace(/\s*TEXT-INDENT: 0cm\s*"/gi,'"').replace(/\s*TEXT-ALIGN: [^\s;]+;?"/gi,'"').replace(/\s*PAGE-BREAK-BEFORE: [^\s;]+;?"/gi,'"').replace(/\s*FONT-VARIANT: [^\s;]+;?"/gi,'"').replace(/\s*tab-stops:[^;"]*;?/gi,"").replace(/\s*tab-stops:[^"]*/gi,"").replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3").replace(/-- page break --\s*<p>&nbsp;<\/p>/gi,"").replace(/-- page break --/gi,"").replace(/<\/p>/gi,"<br /><br />").replace(/<TABLE[^>]*cellPadding=[^>]*>/gi,'<table border="0">').replace(/<td[^>]*vAlign=[^>]*>/gi,"<td>");
if(true){sContent=sContent.replace(/\s*face="[^"]*"/gi,"").replace(/\s*face=[^ >]*/gi,"").replace(/\s*FONT-FAMILY:[^;"]*;?/gi,"");
}if(true){sContent=sContent.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gi,"<$1$3");
}sContent=sContent.replace(/<STYLE[^>]*>[\s\S]*?<\/STYLE[^>]*>/gi,"").replace(/<(?:META|LINK)[^>]*>\s*/gi,"").replace(/\s*style="\s*"/gi,"").replace(/<SPAN\s*[^>]*>\s*&nbsp;\s*<\/SPAN>/gi,"&nbsp;").replace(/<SPAN\s*[^>]*><\/SPAN>/gi,"").replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3").replace(/<SPAN\s*>([\s\S]*?)<\/SPAN>/gi,"$1").replace(/<FONT\s*>([\s\S]*?)<\/FONT>/gi,"$1").replace(/<\\?\?xml[^>]*>/gi,"").replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"").replace(/<\/?\w+:[^>]*>/gi,"").replace(/<(U|I|STRIKE)>&nbsp;<\/\1>/g,"&nbsp;").replace(/<H\d>\s*<\/H\d>/gi,"").replace(/<(\w+)[^>]*\sstyle="[^"]*DISPLAY\s?:\s?none[\s\S]*?<\/\1>/ig,"").replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3").replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3").replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3").replace(/<H(\d)([^>]*)>/gi,"<h$1>").replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>").replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");
var div=document.createElement("div");div.innerHTML=sContent;while(this._convertMiddots(div,"--list--")){}while(this._convertMiddots(div,middot,"unIndentedList")){}while(this._convertMiddots(div,bull)){}sContent=div.innerHTML;
return sContent.replace(/--list--/gi,"");};this._convertMiddots=function(div,search,class_name){var mdot=String.fromCharCode(183),bull=String.fromCharCode(8226),nodes,prevul,i,p,ul,li,np,cp;
nodes=div.getElementsByTagName("p");for(i=0;i<nodes.length;i++){p=nodes[i];if(p.innerHTML.indexOf(search)!=0){continue;
}ul=document.createElement("ul");if(class_name){ul.className=class_name;}li=document.createElement("li");
li.innerHTML=p.innerHTML.replace(new RegExp(""+mdot+"|"+bull+"|--list--|&nbsp;","gi"),"");
ul.appendChild(li);np=p.nextSibling;while(np){if(np.nodeType==3&&new RegExp("^\\s$","m").test(np.nodeValue)){np=np.nextSibling;
continue;}if(search==mdot){if(np.nodeType==1&&new RegExp("^o(\\s+|&nbsp;)").test(np.innerHTML)){if(!prevul){prevul=ul;
ul=document.createElement("ul");prevul.appendChild(ul);}np.innerHTML=np.innerHTML.replace(/^o/,"");
}else{if(prevul){ul=prevul;prevul=null;}if(np.nodeType!=1||np.innerHTML.indexOf(search)!=0){break;
}}}else{if(np.nodeType!=1||np.innerHTML.indexOf(search)!=0){break;}}cp=np.nextSibling;
li=document.createElement("li");li.innerHTML=np.innerHTML.replace(new RegExp(""+mdot+"|"+bull+"|--list--|&nbsp;","gi"),"");
np.parentNode.removeChild(np);ul.appendChild(li);np=cp;}p.parentNode.replaceChild(ul,p);
return true;}return false;};});apf.LiveEdit.plugin("code",function(){this.name="code";
this.icon="code";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+shift+h";this.state=apf.OFF;this.noDisable=true;this.regex=null;
var oCont,oToolbar,oButtons={},oPreview,protectedData,lastLoaded,_self=this;this.execute=function(editor){if(!oPreview){this.drawPreview(editor);
}if(oCont.style.display=="none"){editor.$selection.cache();this.update(editor);
editor.$pluginsActive=this.name;editor.setProperty("state",apf.DISABLED);this.setSize(editor);
oCont.style.display="";oPreview.focus();}else{editor.$pluginsActive=null;oCont.style.display="none";
editor.setProperty("state",apf.OFF);propagateChange();$setTimeout(function(){editor.$selection.set();
editor.$visualFocus();});}editor.$notifyButton("code",this.queryState(editor));
editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.update=function(editor,sHtml){if(changeTimer){lastLoaded=sHtml;
return;}oPreview.value=format.call(this,sHtml?apf.htmlCleaner.parse(sHtml):(lastLoaded=editor.getValue()));
};this.getValue=function(){return oPreview.value;};function propagateChange(){var html=apf.htmlCleaner.parse(oPreview.value.replace(/<\/p>/gi,"</p><p></p>").replace(/\n/g,""));
try{apf.getXml("<source>"+html.replace(/&.{3,5};/g,"")+"</source>");}catch(e){if(confirm("Er zit een fout in de html. Klik op OK om deze                          te corrigeren, of op Cancel om door te gaan")){return false;
}}if(lastLoaded==oPreview.value||_self.editor.$value.replace(/[\r\n]/g,"")==html.replace(/[\r\n]/g,"")){_self.editor.$value="";
_self.editor.$propHandlers.value.call(_self.editor,html);}else{_self.editor.change(html);
}return true;}var changeTimer=null;function resumeChangeTimer(){if(!_self.editor.realtime||changeTimer!==null){return;
}changeTimer=$setTimeout(function(){clearTimeout(changeTimer);_self.editor.change(oPreview.value);
changeTimer=null;},200);}function onKeydown(e){e=e||window.event;var code=e.which||e.keyCode;
if(!e.ctrlKey&&!e.altKey&&(code<112||code>122)&&(code==32||code>42||code==8||code==13)){resumeChangeTimer();
}}this.drawPreview=function(editor){this.editor=editor;oCont=editor.$getExternal("code",editor.$ext);
oToolbar=oCont.getElementsByTagName("div")[0];this.editor.$drawToolbars(oToolbar,"codetoolbar","apf.all["+this.$uniqueId+"].$buttonClick(event, this);",true);
oToolbar.innerHTML=oToolbar.innerHTML;var btns=oToolbar.getElementsByTagName("div");
for(var item,i=btns.length-1;i>=0;i--){item=btns[i].getAttribute("type");if(!item){continue;
}oButtons[item]=btns[i];apf.setStyleClass(btns[i],"editor_enabled",["editor_selected","editor_disabled"]);
btns[i].disabled=false;}oPreview=oCont.getElementsByTagName("textarea")[0];if(apf.isIE){oPreview.onselectstart=function(e){e=e||window.event;
e.cancelBubble=true;};}oPreview.onkeydown=onKeydown;this.setSize(editor);oCont.style.display="none";
apf.sanitizeTextbox(oPreview);};this.setSize=function(editor){if(!oPreview||!editor){return;
}var w=editor.$ext.offsetWidth-2;var h=editor.$ext.offsetHeight-editor.$toolbar.offsetHeight-4;
oCont.style.top=editor.$toolbar.offsetHeight+"px";oCont.style.width=oToolbar.style.width=w+"px";
oPreview.style.width=w-(apf.isIE?2:0)+"px";oCont.style.height=h+(apf.isIE?2:3)+"px";
oPreview.style.height=h-(apf.isIE?26:24)+"px";};var elements={bullist:["<ul>","</ul>"],numlist:["<ol>","</ol>"],listitem:["<li>","</li>"],nbsp:["&nbsp;",null],"break":["<br />",null],paragraph:["<p>","</p>"]};
this.$buttonClick=function(e,oButton){apf.setStyleClass(oButton,"active");var item=oButton.getAttribute("type");
if(elements[item]){insertElement.apply(this,elements[item]);}this.editor.$visualFocus();
oPreview.focus();apf.setStyleClass(oButton,"",["active"]);};function insertElement(sStart,sEnd){if(!sStart){return;
}var range,val,end;if(!sEnd){if(apf.hasMsRangeObject){range=document.selection.createRange();
range.collapse();range.text=sStart;range.moveEnd("character",sStart.length);range.collapse();
if(apf.document.activeElement==this.editor){range.select();}}else{val=oPreview.value;
end=oPreview.selectionEnd;oPreview.selectionStart=end;oPreview.value=val.substr(0,end)+sStart+val.substr(end);
oPreview.selectionStart=oPreview.selectionEnd=end+sStart.length;}}else{if(apf.hasMsRangeObject){range=document.selection.createRange();
val=range.text;range.text=sStart+val+sEnd;range.moveStart("character",-(val.length+sEnd.length));
range.moveEnd("character",-sEnd.length);if(apf.document.activeElement==this.editor){range.select();
}}else{var start=oPreview.selectionStart;val=oPreview.value;end=oPreview.selectionEnd;
oPreview.value=val.substr(0,start)+sStart+val.substr(start,end-start)+sEnd+val.substr(end);
oPreview.selectionStart=start+sStart.length;oPreview.selectionEnd=end+sEnd.length-1;
}}}function protect(outer,opener,data,closer){return opener+"apf.___APFpd___"+protectedData.push(data)+closer;
}function format(sHtml){if(!this.regex){setupRegex.call(this);}protectedData=[];
var sFmt=sHtml.replace(this.regex.protectedTags,protect);sFmt=sFmt.replace(this.regex.blocksOpener,"\n$&").replace(this.regex.blocksCloser,"$&\n").replace(this.regex.newLineTags,"$&\n").replace(this.regex.mainTags,"\n$&\n");
var i,j,sIdt="",asLines=sFmt.split(this.regex.lineSplitter);sFmt="";for(i=0,j=asLines.length;
i<j;i++){var sLn=asLines[i];if(sLn.length==0){continue;}if(this.regex.decreaseIndent.test(sLn)){sIdt=sIdt.replace(this.regex.formatIndentatorRemove,"");
}sFmt+=sIdt+sLn+"\n";if(this.regex.increaseIndent.test(sLn)){sIdt+="    ";}}for(i=0,j=protectedData.length;
i<j;i++){var oRegex=new RegExp("apf.___JPFpd___"+i);sFmt=sFmt.replace(oRegex,protectedData[i].replace(/\$/g,"$$$$"));
}return sFmt.trim();}function setupRegex(){this.regex={blocksOpener:/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi,blocksCloser:/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi,newLineTags:/\<(BR|HR)[^\>]*\>/gi,mainTags:/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi,lineSplitter:/\s*\n+\s*/g,increaseIndent:/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \/\>]/i,decreaseIndent:/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL)[ \>]/i,protectedTags:/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi,formatIndentatorRemove:/^    /};
}this.queryState=function(editor){if(editor.$pluginsActive==this.name){return apf.SELECTED;
}return apf.OFF;};this.destroy=function(){oPreview=this.regex=null;delete oPreview;
delete this.regex;};});apf.LiveEdit.colorPlugin=function(sName){this.name=sName;
this.icon=sName;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.buttonNode=null;this.state=apf.OFF;this.colspan=18;var panelBody;var colorAtoms=["00","33","66","99","CC","FF"];
function generatePalette(){apf.LiveEdit.colorPlugin.palette=[];var r,g,b,iCol;for(r=0;
r<colorAtoms.length;r++){for(g=0;g<colorAtoms.length;g++){iCol=(r%3)*6+g;for(b=0;
b<colorAtoms.length;b++){if(!apf.LiveEdit.colorPlugin.palette[iCol]){apf.LiveEdit.colorPlugin.palette[iCol]=[];
}apf.LiveEdit.colorPlugin.palette[iCol][(r<3?0:6)+b]={red:colorAtoms[r],green:colorAtoms[g],blue:colorAtoms[b]};
}}}}function RGBToBGRToRGB(c){if(typeof c=="string"&&c.length>0){var tmp=[];var ch1=c.charAt(0);
var ch2=c.charAt(4);tmp[0]=ch2;tmp[4]=ch1;ch1=c.charAt(1);ch2=c.charAt(5);tmp[1]=ch2;
tmp[5]=ch1;return tmp[0]+tmp[1]+c.charAt(2)+c.charAt(3)+tmp[4]+tmp[5];}return c;
}function int2Color(intVal){var colorVal=(intVal&16777215).toString(16);return("000000").substring(0,6-colorVal.length)+colorVal;
}this.init=function(editor,btn){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.getElementsByTagName("div")[0];this.colorPreview=this.buttonNode.insertBefore(document.createElement("div"),oArrow);
this.colorPreview.className="colorpreview";var colorArrow=this.buttonNode.insertBefore(document.createElement("span"),oArrow);
colorArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody());}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,apf.isIE6?296:292,167);
return{id:this.name,action:null};};this.setStyleMethod=function(useSpan){if(typeof useSpan=="undefined"){useSpan=true;
}try{this.editor.$activeDocument.execCommand("styleWithCSS",false,useSpan);}catch(ex){this.editor.$activeDocument.execCommand("useCSS",false,!useSpan);
}};this.queryState=function(editor){var cmdName=this.name=="forecolor"?"ForeColor":apf.isIE?"BackColor":"HiliteColor";
this.state=editor.$queryCommandState(cmdName);var currValue="";try{currValue=editor.$queryCommandValue(cmdName);
}catch(ex){}if(apf.isIE){currValue="#"+RGBToBGRToRGB(int2Color(currValue));}if(currValue!=this.colorPreview.style.backgroundColor){this.colorPreview.style.backgroundColor=currValue;
}};this.submit=function(e){var el=e.target||e.srcElement;while(el.tagName.toLowerCase()!="a"&&el.className!="editor_popup"){el=el.parentNode;
}var sColor=el.getAttribute("rel");if(sColor){apf.popup.forceHide();this.editor.$execCommand(this.name=="forecolor"?"ForeColor":apf.isIE?"BackColor":"HiliteColor","#"+sColor);
}};this.createPanelBody=function(){if(!apf.LiveEdit.colorPlugin.palette){generatePalette();
}panelBody=document.body.appendChild(document.createElement("div"));panelBody.className="editor_popup";
panelBody.style.display="none";var aHtml=[];var row,col,colorCode,palette=apf.LiveEdit.colorPlugin.palette;
for(row=0;row<palette[0].length;row++){aHtml.push('<div class="editor_panelrow">');
for(col=0;col<palette.length;col++){colorCode=palette[col][row].red+palette[col][row].green+palette[col][row].blue;
aHtml.push('<a class="editor_smallcell editor_panelcell" style="background-color:#',colorCode,';" rel="',colorCode,'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">                    &nbsp;</a>');
}aHtml.push("</div>");}panelBody.innerHTML=aHtml.join("");return panelBody;};this.destroy=function(){panelBody=this.colorPreview=null;
delete panelBody;delete this.colorPreview;};};apf.LiveEdit.colorPlugin.palette=null;
apf.LiveEdit.plugin("forecolor",apf.LiveEdit.colorPlugin);apf.LiveEdit.plugin("backcolor",apf.LiveEdit.colorPlugin);
apf.LiveEdit.dateTimePlugin=function(sName){this.name=sName;this.icon=sName;this.type=apf.TOOLBARITEM;
this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding=sName=="insertdate"?"ctrl+shift+d":"ctrl+shift+t";
this.state=apf.OFF;this.i18n={date_format:"%Y-%m-%d",time_format:"%H:%M:%S",months_long:"January,February,March,April,May,June,July,August,September,October,November,December",months_short:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days_long:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",days_short:"Sun,Mon,Tue,Wed,Thu,Fri,Sat,Sun"};
this.execute=function(editor){if(typeof this.i18n.months_long=="string"){this.i18n.months_long=this.i18n.months_long.split(",");
this.i18n.months_short=this.i18n.months_short.split(",");this.i18n.days_long=this.i18n.days_long.split(",");
this.i18n.days_short=this.i18n.days_short.split(",");}var d=new Date();var fmt=(this.name=="insertdate")?this.i18n.date_format:this.i18n.time_format;
fmt=fmt.replace("%D","%m/%d/%y").replace("%r","%I:%M:%S %p").replace("%Y",""+d.getFullYear()).replace("%y",""+d.getYear()).replace("%m",(""+d.getMonth()+1).pad(2,"0")).replace("%d",(""+d.getDate()).pad(2,"0")).replace("%H",(""+d.getHours()).pad(2,"0")).replace("%M",(""+d.getMinutes()).pad(2,"0")).replace("%S",(""+d.getSeconds()).pad(2,"0")).replace("%I",""+(d.getHours()+11)%12+1).replace("%p",""+(d.getHours()<12?"AM":"PM")).replace("%B",""+this.i18n.months_long[d.getMonth()]).replace("%b",""+this.i18n.months_short[d.getMonth()]).replace("%A",""+this.i18n.days_long[d.getDay()]).replace("%a",""+this.i18n.days_short[d.getDay()]).replace("%%","%");
editor.$insertHtml(fmt,true);editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(){return this.state;};};apf.LiveEdit.plugin("insertdate",apf.LiveEdit.dateTimePlugin);
apf.LiveEdit.plugin("inserttime",apf.LiveEdit.dateTimePlugin);apf.LiveEdit.directionPlugin=function(sName){this.name=sName;
this.icon=sName;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.state=apf.OFF;this.execute=function(editor){editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(editor){return this.state;};};apf.LiveEdit.plugin("ltr",apf.LiveEdit.directionPlugin);
apf.LiveEdit.plugin("rtl",apf.LiveEdit.directionPlugin);apf.LiveEdit.plugin("emotions",function(){this.name="emotions";
this.icon="emotions";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.buttonNode=null;this.state=apf.OFF;this.colspan=4;this.emotions=[];var panelBody;
this.init=function(editor,btn){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
var node,oNode=editor.$getPluginOption("emotions"),i=0,l=oNode.childNodes.length;
for(;i<l;i++){node=oNode.childNodes[i];if(node.nodeType==3||node.nodeType==4){this.emotions=node.nodeValue.splitSafe(",");
}}this.emotionsPath=oNode.getAttribute("path")||"";apf.popup.setContent(this.$uniqueId,this.createPanelBody());
}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,123,110);
return{id:this.name,action:null};};this.queryState=function(){return this.state;
};this.submit=function(e){var el=e.target||e.srcElement;this.editor.$visualFocus();
var icon=el.getAttribute("rel");if(!icon||icon==null){icon=el.parentNode.getAttribute("rel");
}if(!icon){return;}apf.popup.forceHide();this.editor.$insertHtml('<img src="'+this.emotionsPath+"/smiley-"+icon+'.gif" alt="" border="0" />',true);
};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var aHtml=[],emotions=this.emotions,path=this.emotionsPath,rowLen=this.colspan-1,i=0,l=emotions.length;
for(;i<l;i++){if(i%this.colspan==0){aHtml.push('<div class="editor_panelrow">');
}aHtml.push('<a class="editor_panelcell editor_largestcell" rel="',emotions[i],'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);"><img border="0" src="',path,"/smiley-",emotions[i],'.gif" /></a>');
if(i%this.colspan==rowLen){aHtml.push("</div>");}}panelBody.innerHTML=aHtml.join("");
return panelBody;};this.destroy=function(){panelBody=null;delete panelBody;};});
apf.LiveEdit.plugin("fonts",function(){this.name="fonts";this.icon="fonts";this.type=apf.TOOLBARITEM;
this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;
this.colspan=1;this.fontNames={};var panelBody;this.init=function(editor){this.buttonNode.className=this.buttonNode.className+" fontpicker";
this.fontPreview=this.buttonNode.getElementsByTagName("span")[0];this.fontPreview.className+=" fontpreview";
var fontArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
fontArrow.className="selectarrow";this.editor=editor;var l,j,font,fonts,node;var oNode=editor.$getPluginOption("fonts").childNodes[0];
while(oNode){fonts=oNode.nodeValue.splitSafe("(?:;|=)");if(fonts[0]){for(j=0,l=fonts.length;
j<l;j++){this.fontNames[fonts[j]]=fonts[++j];}break;}oNode=oNode.nextSibling;}this.queryState(editor);
};this.execute=function(){if(!panelBody){apf.popup.setContent(this.$uniqueId,this.createPanelBody());
}this.editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,120);
return{id:this.name,action:null};};this.queryState=function(editor){this.state=editor.$queryCommandState("FontName");
var currValue=editor.$queryCommandValue("FontName");if(!currValue||(this.fontNames[currValue]&&this.fontPreview.innerHTML!=currValue)){this.fontPreview.innerHTML=currValue?currValue:"Font";
}};this.submit=function(e){var el=e.target||e.srcElement;while(el.tagName.toLowerCase()!="a"&&el.className!="editor_popup"){el=el.parentNode;
}var sFont=el.getAttribute("rel");if(sFont){apf.popup.forceHide();if(apf.isIE){this.editor.$selection.set();
if(this.editor.$selection.isCollapsed()){this.editor.$visualFocus();var r=this.editor.$selection.getRange();
r.moveStart("character",-1);r.select();}}this.editor.$execCommand("FontName",sFont);
if(apf.isIE){this.editor.$selection.collapse(false);}}};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var aHtml=[];
for(var i in this.fontNames){aHtml.push('<a class="editor_panelcell editor_font" style="font-family:',this.fontNames[i],';" rel="',i,'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">',i,"</a>");
}panelBody.innerHTML=aHtml.join("");return panelBody;};this.destroy=function(){panelBody=this.fontPreview=null;
delete panelBody;delete this.fontPreview;};});apf.LiveEdit.plugin("fontsize",function(){this.name="fontsize";
this.icon="fontsize";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.buttonNode=null;this.state=apf.OFF;var panelBody;var sizeMap={"1":"8","2":"10","3":"12","4":"14","5":"18","6":"24","7":"36"};
this.init=function(editor){this.buttonNode.className=this.buttonNode.className+" fontsizepicker";
this.sizePreview=this.buttonNode.getElementsByTagName("span")[0];this.sizePreview.className+=" fontsizepreview";
var sizeArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
sizeArrow.className="selectarrow";this.queryState(editor);};this.execute=function(editor){if(!panelBody){this.editor=editor;
var i,node,oNode=editor.$getPluginOption("fontsizes");for(i=0;i<oNode.childNodes.length;
i++){node=oNode.childNodes[i];if(node.nodeType==3||node.nodeType==4){this.fontSizes=node.nodeValue.splitSafe(",");
}}apf.popup.setContent(this.$uniqueId,this.createPanelBody());}this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,203);
return{id:this.name,action:null};};this.queryState=function(editor){this.state=editor.$queryCommandState("FontSize");
var currValue=editor.$queryCommandValue("FontSize");if(!currValue||this.sizePreview.innerHTML!=currValue){this.sizePreview.innerHTML=currValue?currValue:"Size";
}};this.submit=function(e){var el=e.target||e.srcElement;while(el.tagName.toLowerCase()!="a"&&el.className!="editor_popup"){el=el.parentNode;
}var sSize=el.getAttribute("rel");if(sSize){apf.popup.forceHide();if(apf.isIE){this.editor.$selection.set();
if(this.editor.$selection.isCollapsed()){this.editor.$visualFocus();var r=this.editor.$selection.getRange();
r.moveStart("character",-1);r.select();}}this.editor.$execCommand("FontSize",sSize);
if(apf.isIE){this.editor.$selection.collapse(false);}}apf.stopEvent(e);return false;
};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var aHtml=[],aSizes=this.fontSizes,i=0,l=aSizes.length;
for(;i<l;i++){aHtml.push('<a class="editor_panelcell editor_fontsize" style="font-size:',sizeMap[aSizes[i]],"pt;height:",sizeMap[aSizes[i]],"pt;line-height:",sizeMap[aSizes[i]],'pt;" rel="',aSizes[i],'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);">',aSizes[i]," (",sizeMap[aSizes[i]],"pt)</a>");
}panelBody.innerHTML=aHtml.join("");return panelBody;};this.destroy=function(){panelBody=this.sizePreview=null;
delete panelBody;delete this.sizePreview;};});apf.LiveEdit.plugin("fontstyle",function(){this.name="fontstyle";
this.icon="fontstyle";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.buttonNode=null;this.state=apf.OFF;var panelBody,oStyles=null,oEditor=null;
function getStyles(editor){if(!oStyles){var node,aCss,bCss,oNode=editor.$getPluginOption("fontstyles");
if(!oNode||!oNode.childNodes){throw new Error(apf.formatErrorString(0,editor,"Initializing plugin: fontstyle","No fontstyle block found in skin definition"));
}for(var i=0,j=oNode.childNodes.length;i<j&&!oStyles;i++){node=oNode.childNodes[i];
if(node.nodeType==3||node.nodeType==4){oStyles={};aCss=[];bCss=[];node.nodeValue.replace(/([\w ]+)\s*=\s*(([^\{]+?)\s*\{[\s\S]*?\})\s*/g,function(m,caption,css,className){if(!css||css.charAt(css.length-1)!="}"){throw new Error(apf.formatErrorString(0,editor,"Initializing plugin: fontstyle","Invalid fontstyle block, please check if formatting rules have been applied"));
}if(css.charAt(0)!="."){css="."+css;}css=css.trim().replace(/[\s]+/g,"");className=className.trim().replace(/\./,"");
oStyles[className]={caption:caption.trim(),cname:className,css:css,node:null};aCss.push(css);
bCss.push(".editor_fontstyle "+css);});}}if(aCss.length){apf.importCssString(bCss.join(""));
apf.importCssString(aCss.join(""),editor.$activeDocument);if(apf.isIE){var nodes=editor.$activeDocument.getElementsByTagName("head")[0].childNodes,cnt=nodes.length-1;
while(cnt){if(nodes[cnt].nodeType==3){nodes[cnt].parentNode.removeChild(nodes[cnt]);
}cnt--;}}}}return oStyles;}this.init=function(editor){oEditor=editor;this.buttonNode.className=this.buttonNode.className+" fontstylepicker";
this.stylePreview=this.buttonNode.getElementsByTagName("span")[0];this.stylePreview.className+=" fontstylepreview";
var styleArrow=this.buttonNode.appendChild(document.createElement("span"));styleArrow.className="selectarrow";
this.queryState(editor);};this.execute=function(editor){if(!panelBody){oEditor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody(editor));}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
oEditor.$showPopup(this,this.$uniqueId,this.buttonNode,203);return{id:this.name,action:null};
};function getCurrentStyle(){getStyles(oEditor);var oNode=oEditor.$selection.getSelectedNode();
while(oNode&&oNode.nodeType!=1){oNode=oNode.parentNode;}var oCurrent;while(!oCurrent&&oNode&&oNode.tagName!="BODY"){var cs=oNode.className;
for(var i in oStyles){if(cs.indexOf(i)>-1){oCurrent=oStyles[i];oCurrent.node=oNode;
}}oNode=oNode.parentNode;}return oCurrent;}this.submit=function(e,sStyle){if(!sStyle){el=e.target||e.srcElement;
while(el.tagName.toLowerCase()!="a"&&el.className!="editor_popup"){el=el.parentNode;
}sStyle=el.getAttribute("rel");}if(sStyle){apf.popup.forceHide();var sel=oEditor.$selection;
sel.set();oEditor.$visualFocus();var o=getCurrentStyle(oEditor);if(o&&sStyle=="normal"){var n=o.node.childNodes,p=o.node.parentNode;
while(n.length){p.insertBefore(n[0],o.node);}p.removeChild(o.node);this.queryState(oEditor);
}else{if(o&&(sel.isCollapsed()||sel.getContent("text")==o.node.innerHTML)&&apf.isChildOf(o.node,sel.getSelectedNode(),true)){if(o.cname==sStyle){return;
}apf.setStyleClass(o.node,sStyle,[o.cname]);}else{if(sel.isCollapsed()){if(apf.isIE){var oNode=sel.getRange().parentElement();
var p=oEditor.$activeDocument.createElement("span");p.className=sStyle;p.innerHTML=oNode.innerHTML;
if(oNode.tagName=="BODY"){oNode.innerHTML="";oNode.appendChild(p);}else{oNode.parentNode.insertBefore(p,oNode);
oNode.parentNode.removeChild(oNode);}sel.selectNode(p);}else{var range=sel.getRange();
var oCaret=range.commonAncestorContainer;range.setStartBefore(oCaret);range.setEndAfter(oCaret);
sel.setRange(range);var htmlNode=sel.setContent('<span class="'+sStyle+'">'+sel.getContent()+"</span>");
sel.selectNode(htmlNode);}}else{var s=sel.getContent().trim();var shouldPrefixSpan=s.substr(0,5)=="<SPAN";
s=s.replace(/<SPAN class=.*?>|<\/SPAN>/gi,"");if(s.charAt(0)=="<"){s=s.replace(/<(normal|pre|p|address|h1|h2|h3|h4|h5|h6)(?:\s.*?|)>(.+?)<\/(normal|pre|p|address|h1|h2|h3|h4|h5|h6)>/gi,'<$1><span class="'+sStyle+'">$2</span></$3>').replace(/^([\s\S]*?)(<(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)[\s\S]*<\/(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)>)([\s\S]*?)$/gi,function(m,m1,m2,m3){return(m1?'<span class="'+sStyle+'">'+m1+"</span>":"")+m2+(m3?'<span class="'+sStyle+'">'+m3+"</span>":"");
}).replace(/^\s*<(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)(?:\s.*?|)>|<\/(?:normal|pre|p|address|h1|h2|h3|h4|h5|h6)>\s*$/gi,"");
if(apf.isIE){s=s.replace(/<\/P>/,"");}}else{s='<span class="'+sStyle+'">'+s+"</span>";
}if(shouldPrefixSpan){s="</SPAN>"+s.replace(/<\/SPAN>$/i,"");}var htmlNode=sel.setContent(s,true);
sel.selectNode(htmlNode);}}}oEditor.$restoreFocus();oEditor.change(oEditor.getValue());
}};this.queryState=function(){var o=getCurrentStyle();if(o){if(this.stylePreview.innerHTML!=o.caption){this.stylePreview.innerHTML=o.caption;
}this.state=apf.ON;}else{this.stylePreview.innerHTML="Style";this.state=apf.OFF;
}return this.state;};this.createPanelBody=function(editor){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";getStyles(editor);
var aHtml=['<a class="editor_panelcell editor_fontstyle" rel="normal"             href="javascript:;" onmouseup="apf.lookup(',this.$uniqueId,').submit(event);"><span>Normal</span></a>'];
for(var i in oStyles){aHtml.push('<a class="editor_panelcell editor_fontstyle" rel="',i,'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);"><span class="',i,'">',oStyles[i].caption,"</span></a>");
}panelBody.innerHTML=aHtml.join("");return panelBody;};this.destroy=function(){panelBody=this.stylePreview=oEditor=null;
delete panelBody;delete this.stylePreview;delete oEditor;};});apf.LiveEdit.plugin("blockformat",function(){this.name="blockformat";
this.icon="blockformat";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;
this.hook="ontoolbar";this.buttonNode=null;this.state=apf.OFF;this.node=null;var panelBody,oEditor,blocksMap={normal:"Normal",p:"Paragraph",pre:"Preformatted",address:"Address",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},blocksRE,blocksRE2,blocksRE3,blocksRE4,blockFormats;
function getFormats(editor){if(!blockFormats){var i,j,node,oNode=editor.$getPluginOption("blockformats");
if(!oNode||!oNode.childNodes){throw new Error(apf.formatErrorString(0,editor,"Initializing plugin: Blockformat","No block formats found in skin definition"));
}for(i=0,j=oNode.childNodes.length;i<j;i++){node=oNode.childNodes[i];if(node.nodeType==3||node.nodeType==4){blockFormats=node.nodeValue.splitSafe(",");
}}var sJoin="("+blockFormats.join("|")+")";blocksRE=new RegExp("^"+sJoin+"$","gi");
blocksRE2=new RegExp("<\\/?"+sJoin+">","gi");blocksRE3=new RegExp("<\\/?("+blockFormats.join("|")+"|p)>","gi");
blocksRE4=new RegExp("^("+blockFormats.join("|")+"|p)$","gi");}return blockFormats;
}this.init=function(editor){oEditor=editor;this.buttonNode.className=this.buttonNode.className+" blockformatpicker";
this.blockPreview=this.buttonNode.getElementsByTagName("span")[0];this.blockPreview.className+=" blockformatpreview";
var blockArrow=this.buttonNode.appendChild(document.createElement("span"));blockArrow.className="selectarrow";
this.queryState(editor);};this.execute=function(editor){if(!panelBody){oEditor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody(editor));}oEditor.$showPopup(this,this.$uniqueId,this.buttonNode,203);
return{id:this.name,action:null};};this.queryState=function(){var oNode=oEditor.$selection.getSelectedNode(),aFormats=getFormats(oEditor),tagName=oNode.nodeType==1?oNode.tagName.toLowerCase():"";
while(tagName&&!tagName.match(blocksRE)&&tagName!="body"){oNode=oNode.parentNode;
tagName=(oNode.tagName||"").toLowerCase();}if(tagName.match(blocksRE)){var sBlock=blocksMap[tagName];
if(this.blockPreview.innerHTML!=sBlock){this.blockPreview.innerHTML=sBlock;}this.state=apf.ON;
this.node=oNode;}else{this.blockPreview.innerHTML="Normal";this.state=apf.OFF;this.node=null;
}return this.state;};this.submit=function(e,sBlock){if(!sBlock){var el=e.target||e.srcElement;
while(el.tagName.toLowerCase()!="a"&&el.className!="editor_popup"){el=el.parentNode;
}sBlock=el.getAttribute("rel");}if(sBlock){apf.popup.forceHide();var oNode,sel=oEditor.$selection;
sel.set();oEditor.$visualFocus();var s=sel.getContent();if(sBlock=="normal"&&this.queryState(oEditor)==apf.ON){var n=this.node.childNodes,p=this.node.parentNode;
if(apf.isIE){var l=p.insertBefore(p.ownerDocument.createElement("p"),this.node);
while(n.length){l.insertBefore(n[0],l.firstChild);}p.removeChild(this.node);sel.selectNode(l);
if(l.previousSibling&&l.previousSibling.tagName=="P"){if(l.previousSibling.innerHTML==""){l.parentNode.removeChild(l.previousSibling);
}}}else{while(n.length){p.insertBefore(n[0],this.node);}p.removeChild(this.node);
}this.state=apf.OFF;this.node=null;this.blockPreview.innerHTML="Normal";}else{if(sel.isCollapsed()||s.trim()==""){if(apf.isIE){var startNode,oNode;
oNode=startNode=sel.getRange().parentElement();while(!oNode.tagName.match(blocksRE4)&&oNode.tagName!="BODY"){oNode=oNode.parentNode;
}if(oNode&&oNode.tagName=="BODY"){if(startNode!=oNode){oNode=startNode;}else{}}var p=oEditor.$activeDocument.createElement(sBlock);
p.innerHTML=oNode.innerHTML;if(oNode.tagName=="BODY"){oNode.innerHTML="";oNode.appendChild(p);
}else{oNode.parentNode.insertBefore(p,oNode);oNode.parentNode.removeChild(oNode);
}sel.selectNode(p);}else{oEditor.$execCommand("FormatBlock",sBlock);}this.blockPreview.innerHTML=blocksMap[sBlock];
}else{oNode=sel.getSelectedNode();while(oNode.nodeType!=1){oNode=oNode.parentNode;
}if(oNode.tagName.match(blocksRE4)&&s.length==oNode[apf.hasInnerText?"innerText":"textContent"].length){var p=oEditor.$activeDocument.createElement(sBlock);
p.innerHTML=oNode.innerHTML;oNode.parentNode.insertBefore(p,oNode);oNode.parentNode.removeChild(oNode);
sel.selectNode(p);}else{while(!oNode.tagName.match(blocksRE4)&&oNode.tagName!="BODY"){oNode=oNode.parentNode;
}if(oNode&&oNode.tagName!="BODY"){var s2;if(oNode.tagName=="P"&&apf.isIE){s2="<"+sBlock+">"+s.trim().replace(blocksRE3,"")+"</"+sBlock+">";
addedNode=sel.setContent(s2);}else{s2='<P __apf_placeholder="true">'+s+"</P>";sel.setContent(s2);
var sBlock2=oNode.tagName;var html=[],first,last;var strHtml=oNode.innerHTML.replace(s2,function(m,pos){return(pos!=0?(first=true)&&"</"+sBlock2+">":"")+"<"+sBlock+' __apf_placeholder="true">'+s.replace(blocksRE3,"")+"</"+sBlock+">"+(pos<oNode.innerHTML.length-s.length?(last=true)&&"<"+sBlock2+">":"");
});if(first){html.push("<"+sBlock2+">");}html.push(strHtml);if(last){html.push("</"+sBlock2+">");
}oNode.innerHTML=html.join("");var addedNode,n=oNode.getElementsByTagName(sBlock);
for(var i=0;i<n.length;i++){if(n[i].getAttribute("__apf_placeholder")){n[i].removeAttribute("__apf_placeholder");
addedNode=n[i];break;}}n=oNode.childNodes,p=oNode.parentNode;while(n.length){p.insertBefore(n[0],oNode);
}p.removeChild(oNode);}if(addedNode){if(apf.isIE){var prev=addedNode.previousSibling;
if(prev&&prev.tagName=="P"&&prev.innerHTML=="&nbsp;"){prev.parentNode.removeChild(prev);
}}sel.selectNode(addedNode);}}else{var addedNode=sel.setContent("<"+sBlock+">"+s.replace(/<p>(.*?)<\/p>(.)/gi,"$1<br />$2").replace(blocksRE3,"")+"</"+sBlock+">");
if(apf.isIE){var prev=addedNode.previousSibling;if(prev&&prev.tagName=="P"&&prev.innerHTML=="&nbsp;"){prev.parentNode.removeChild(prev);
}}sel.selectNode(addedNode);}}this.blockPreview.innerHTML=blocksMap[sBlock];}}oEditor.$restoreFocus();
oEditor.change(oEditor.getValue());}};this.createPanelBody=function(editor){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var aHtml=[],aFormats=getFormats(editor);
for(var i=0,j=aFormats.length;i<j;i++){aHtml.push('<a class="editor_panelcell editor_blockformat" rel="',aFormats[i],'" href="javascript:;" onmousedown="apf.lookup(',this.$uniqueId,').submit(event);"><',aFormats[i],">",blocksMap[aFormats[i]],"</",aFormats[i],"></a>");
}panelBody.innerHTML=aHtml.join("");return panelBody;};this.destroy=function(){panelBody=oEditor=this.blockPreview=this.node=null;
delete panelBody;delete oEditor;delete this.blockPreview;delete this.node;};});
apf.LiveEdit.plugin("help",function(){this.name="help";this.icon="help";this.type=apf.TOOLBARITEM;
this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";this.keyBinding="ctrl+h";this.state=apf.OFF;
this.execute=function(editor){editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(editor){return this.state;};});apf.LiveEdit.plugin("hr",function(){this.name="hr";
this.icon="hr";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+h";this.state=apf.OFF;this.execute=function(editor){if(apf.isGecko||apf.isIE){editor.$insertHtml("<hr />",true);
}else{editor.$execCommand("InsertHorizontalRule");}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(editor){return this.state;};});apf.LiveEdit.plugin("image",function(){this.name="image";
this.icon="image";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.keyBinding="ctrl+alt+i";this.state=apf.OFF;var panelBody;this.init=function(editor){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody());}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,47);var _self=this;
$setTimeout(function(){_self.oUrl.focus();});return{id:this.name,action:null};};
this.queryState=function(editor){return this.state;};this.submit=function(e){var sUrl=this.oUrl.value;
if(sUrl){apf.popup.forceHide();var oUrl=new apf.url(sUrl);if(!oUrl.protocol||!oUrl.host||!oUrl.file){alert("Please enter a valid URL");
}else{this.editor.$insertHtml('<img src="'+sUrl+'" border="0" />',true);}}};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var idUrl="editor_"+this.$uniqueId+"_input";
var idBtns="editor_"+this.$uniqueId+"_btns";panelBody.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+idUrl+'">Image URL</label>                <input type="text" id="'+idUrl+'" class="editor_input" name="'+idUrl+'" value="" />            </div>            <div id="'+idBtns+'" class="editor_panelrow editor_panelrowbtns"></div>';
this.oUrl=document.getElementById(idUrl);this.appendAmlNode('<a:toolbar xmlns:a="'+apf.ns.aml+'"><a:bar>             <a:button caption="Insert"               onclick="apf.lookup('+this.$uniqueId+').submit(event)" />             </a:bar></a:toolbar>',document.getElementById(idBtns));
if(apf.hasFocusBug){apf.sanitizeTextbox(this.oUrl);this.oUrl.onselectstart=function(e){e=e||window.event;
e.cancelBubble=true;};}return panelBody;};this.destroy=function(){panelBody=this.oUrl=null;
delete panelBody;delete this.oUrl;};});apf.LiveEdit.plugin("imagespecial",function(){this.name="imagespecial";
this.icon="image";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+alt+j";this.state=apf.OFF;var winHandle;this.execute=function(editor){if(!winHandle){var s=(editor.getAttribute("imagewindow")||"").trim();
if(s){winHandle=self[s];}}if(winHandle&&winHandle.show){winHandle.show();}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(editor){return this.state;};});apf.LiveEdit.plugin("link",function(){this.name="link";
this.icon="link";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";
this.keyBinding="ctrl+shift+l";this.state=apf.OFF;var panelBody;this.init=function(editor,btn){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody());}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.oUrl.value="http://";this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,95);
if(panelBody.style.visibility=="hidden"){panelBody.style.visibility="visible";}var _self=this;
$setTimeout(function(){_self.oUrl.focus();});return{id:this.name,action:null};};
this.queryState=function(editor){if(editor.$selection.isCollapsed()||editor.$selection.getSelectedNode().tagName=="A"){return apf.DISABLED;
}return this.state;};this.submit=function(e){apf.popup.forceHide();if(!this.oUrl.value.replace("http://","")){return;
}this.editor.$execCommand("CreateLink","javascript:apftmp(0);");var oLink,oEditor=this.editor,aLinks=oEditor.$activeDocument.getElementsByTagName("a"),i=0,l=aLinks.length;
for(;i<l&&!oLink;i++){if(aLinks[i].href=="javascript:apftmp(0);"){oLink=aLinks[i];
}}if(oLink){var val=this.oUrl.value;oLink.href=(!val.match(/^[a-zA-Z]+\:/)?"http://":"")+val;
oLink.target=this.oTarget.value;oLink.title=this.oTitle.value;}oEditor.$selection.collapse(false);
oEditor.$restoreFocus();oEditor.change(oEditor.getValue());apf.stopEvent(e);return false;
};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var idUrl="editor_"+this.$uniqueId+"_link_url";
var idTarget="editor_"+this.$uniqueId+"_link_target";var idTitle="editor_"+this.$uniqueId+"_link_title";
var idBtns="editor_"+this.$uniqueId+"_link_btns";panelBody.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+idUrl+'">Link URL</label>                <input type="text" id="'+idUrl+'" name="'+idUrl+'" class="editor_input" value="" />            </div>            <div class="editor_panelrow editor_panelrowinput">                <label for="'+idTarget+'">Target</label>                <select id="'+idTarget+'" name="'+idTarget+'">                    <option value="_self">Open in this window/ frame</option>                    <option value="_blank">Open in new window (_blank)</option>                    <option value="_parent">Open in parent window/ frame (_parent)</option>                    <option value="_top">Open in top frame (replaces all frames) (_top)</option>                </select>            </div>            <div class="editor_panelrow editor_panelrowinput">                <label for="'+idTitle+'">Title</label>                <input type="text" id="'+idTitle+'" name="'+idTitle+'" class="editor_input" value="" />            </div>            <div id="'+idBtns+'" class="editor_panelrow editor_panelrowbtns"></div>';
this.oUrl=document.getElementById(idUrl);this.oTarget=document.getElementById(idTarget);
this.oTitle=document.getElementById(idTitle);if(apf.hasFocusBug){apf.sanitizeTextbox(this.oUrl);
apf.sanitizeTextbox(this.oTarget);apf.sanitizeTextbox(this.oTitle);this.oUrl.onselectstart=this.oTarget.onselectstart=this.oTitle.onselectstart=function(e){e=e||window.event;
e.cancelBubble=true;};}new apf.toolbar({htmlNode:document.getElementById(idBtns),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:[new apf.button({caption:this.editor.$translate("insert"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]})]});
return panelBody;};this.destroy=function(){panelBody=this.oUrl=this.oTarget=this.oTitle=null;
delete panelBody;delete this.oUrl;delete this.oTarget;delete this.oTitle;};});apf.LiveEdit.plugin("unlink",function(){this.name="unlink";
this.icon="unlink";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+shift+l";this.state=apf.OFF;this.execute=function(editor){if(this.queryState(editor)==apf.DISABLED){return;
}if(apf.isIE){editor.$execCommand("Unlink");}else{var sel=editor.$selection;sel.set();
var oNode=sel.getSelectedNode();if(oNode.tagName=="A"){var txt=oNode.innerHTML;
sel.selectNode(oNode);sel.remove();sel.collapse();editor.$insertHtml(txt);}}};this.queryState=function(editor){if(editor.$selection.getSelectedNode().tagName=="A"){return apf.OFF;
}return apf.DISABLED;};});apf.LiveEdit.listPlugin=function(sName){this.name=sName;
this.icon=sName;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding=sName=="bullist"?"ctrl+shift+u":"ctrl+shift+o";this.state=apf.OFF;
var emptyRegex=apf.isIE?/^(&nbsp;)?<DIV[^>]*_apf_placeholder(="1">&nbsp;)?<\/DIV>$/gi:/^(&nbsp;)?<BR\/?>$/gi;
this.execute=function(editor){editor.$execCommand(this.name=="bullist"?"InsertUnorderedList":"InsertOrderedList");
this.correctLists(editor);editor.$visualFocus();editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};function moveListItems(from,to){var i,oNode,oLastNode,listNode=(this.name=="bullist")?"OL":"UL";
for(i=from.childNodes.length;i>=0;i--){oNode=from.childNodes[i];if(!oNode){continue;
}if(oNode.tagName==listNode){break;}if(!oLastNode){to.appendChild(oNode);}else{to.insertBefore(oNode,oLastNode);
}oLastNode=oNode;}from.parentNode.removeChild(from);}function getEmptyLi(oParent){if(!oParent||oParent.nodeType!=1){return;
}var sHtml,aNodes=oParent.getElementsByTagName("li");for(var i=0,j=aNodes.length;
i<j;i++){sHtml=aNodes[i].innerHTML.trim();if(sHtml==""||sHtml=="&nbsp;"||sHtml.match(emptyRegex)){return aNodes[i];
}}return null;}this.correctLists=function(editor){editor.$selection.set();var oNode=editor.$selection.getSelectedNode();
if(oNode.tagName!="LI"){oNode=getEmptyLi(oNode);if(!oNode||oNode.tagName!="LI"){return false;
}}var oParent=oNode.parentNode,oSiblingP=oNode.parentNode.previousSibling,oHasBr=null;
if(!oSiblingP){return false;}if(oSiblingP&&oSiblingP.tagName=="BR"){oHasBr=oSiblingP;
oSiblingP=oSiblingP.previousSibling;}var oSibling=(oSiblingP&&oSiblingP.tagName==oParent.tagName)?oSiblingP:null;
if(!oSibling){return;}if(oHasBr){oParent.removeChild(oHasBr);}moveListItems(oParent,oSibling);
editor.$selection.selectNode(oNode);if(!apf.isIE){editor.$selection.getRange().setStart(oNode,0);
}editor.$selection.collapse(!apf.isIE);editor.$visualFocus();return true;};this.correctIndentation=function(editor,dir){editor.$execCommand(dir);
this.correctLists(editor);};this.queryState=function(editor){var state=editor.$queryCommandState(this.name=="bullist"?"InsertUnorderedList":"InsertOrderedList");
if(state==apf.DISABLED){return apf.OFF;}return state;};};apf.LiveEdit.plugin("bullist",apf.LiveEdit.listPlugin);
apf.LiveEdit.plugin("numlist",apf.LiveEdit.listPlugin);apf.LiveEdit.plugin("media",function(){this.name="media";
this.icon="media";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+m";this.state=apf.OFF;this.execute=function(editor){editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.queryState=function(editor){return this.state;};});apf.LiveEdit.plugin("print",function(){this.name="print";
this.icon="print";this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+p";this.state=apf.OFF;this.execute=function(editor){if(apf.print){apf.print(editor.getValue());
}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(){return this.state;
};});apf.LiveEdit.plugin("preview",function(){this.name="preview";this.icon="preview";
this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+shift+p";this.state=apf.OFF;this.execute=function(editor){if(apf.printer){apf.printer.preview(editor.getValue()).show();
}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(){return this.state;
};});apf.LiveEdit.searchPlugin=function(sName){this.name=sName;this.icon=sName;
this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARPANEL;this.hook="ontoolbar";this.keyBinding=this.name=="search"?"ctrl+f":"ctrl+shift+f";
this.state=apf.OFF;var panelBody;this.init=function(editor,btn){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
apf.popup.setContent(this.$uniqueId,this.createPanelBody());}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.editor.$showPopup(this,this.$uniqueId,this.buttonNode,218,this.name=="search"?71:95);
this.oSearch.value=this.editor.$selection.getContent();var _self=this;$setTimeout(function(){_self.oSearch.focus();
});return{id:this.name,action:null};};this.queryState=function(editor){return this.state;
};this.submit=function(e){var val=this.oSearch.value,bMatchCase=this.oCase.checked,flag=0;
if(!val){return;}if(apf.isIE){this.editor.$selection.set();}this.editor.$selection.collapse(false);
this.editor.$visualFocus();if(bMatchCase){flag=flag|4;}var found=false;if(apf.isIE){var sel=this.editor.$selection;
var range=sel.getRange();if(!(found=range.findText(val,1,flag))){this.editor.$activeDocument.execCommand("SelectAll");
sel.collapse(true);range=sel.getRange();found=range.findText(val,1,flag);}if(found){range.scrollIntoView();
range.select();}sel.cache();}else{if(this.editor.oWin.find(val,bMatchCase,false,true,false,false,false)){found=true;
}}if(this.oReplBtn){this.oReplBtn[!found?"disable":"enable"]();}if(!found){if(this.oReplBtn){this.oReplBtn.disable();
}alert("No occurences found for '"+val+"'");}else{if(this.oReplBtn){this.oReplBtn.enable();
}}if(e.stop){e.stop();}else{e.cancelBubble=true;}if(!apf.isIE){var _self=this;$setTimeout(function(){_self.oSearch.focus();
});}return false;};this.onDoReplClick=function(e){this.replace();};this.onReplAllClick=function(e){var val=this.oSearch.value,bMatchCase=this.oCase.checked,flag=0,ed=this.editor;
if(!val){return;}this.editor.$execCommand("SelectAll");this.editor.$selection.collapse(true);
this.editor.$visualFocus();var range=this.editor.$selection.getRange(),found=0;
if(bMatchCase){flag=flag|4;}if(apf.isIE){while(range.findText(val,1,flag)){range.scrollIntoView();
range.select();this.replace();found++;}this.editor.$selection.cache();}else{while(this.editor.oWin.find(val,bMatchCase,false,false,false,false,false)){this.replace();
found++;}}if(found>0){alert(found+" occurences found and replaced with '"+this.oReplace.value+"'");
}else{alert("No occurences found for '"+val+"'");}};this.replace=function(){var sRepl=this.oReplace.value;
if(apf.isIE){this.editor.$selection.getRange().duplicate().pasteHTML(sRepl);}else{this.editor.$activeDocument.execCommand("InsertHTML",false,sRepl);
}};this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup";panelBody.style.display="none";var idSearch="editor_"+this.$uniqueId+"_input",idReplace="editor_"+this.$uniqueId+"_replace",idCase="editor_"+this.$uniqueId+"_case",idBtns="editor_"+this.$uniqueId+"_btns";
panelBody.innerHTML='<div class="editor_panelrow editor_panelrowinput">                <label for="'+idSearch+'">Find what</label>                <textarea type="text" id="'+idSearch+'" class="editor_input" name="'+idSearch+'" value="">                </textarea>            </div>'+(this.name=="replace"?'<div class="editor_panelrow editor_panelrowinput">                <label for="'+idReplace+'">Replace with</label>                <input type="text" id="'+idReplace+'" class="editor_input" name="'+idReplace+'" value="" />            </div>':"")+'<div class="editor_panelrow editor_panelrowinput">                <label for="'+idCase+'">Match case</label>                <input type="checkbox" id="'+idCase+'" name="'+idCase+'" class="editor_checkbox" value="" />            </div>            <div id="'+idBtns+'" class="editor_panelrow editor_panelrowbtns"></div>';
this.oSearch=document.getElementById(idSearch);this.oCase=document.getElementById(idCase);
new apf.toolbar({htmlNode:document.getElementById(idBtns),skinset:apf.getInheritedAttribute(this.editor.parentNode,"skinset"),childNodes:[new apf.bar({childNodes:this.name=="search"?[new apf.button({caption:this.editor.$translate("findnext"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"})]:[new apf.button({caption:this.editor.$translate("findnext"),onclick:"apf.lookup("+this.$uniqueId+").submit(event)"}),(this.oReplBtn=new apf.button({caption:this.editor.$translate("doreplace"),onclick:"apf.lookup("+this.$uniqueId+").onDoReplClick(event)"})),(this.oReplAllBtn=new apf.button({caption:this.editor.$translate("replaceall"),onclick:"apf.lookup("+this.$uniqueId+").onReplAllClick(event)"}))]})]});
if(this.name=="replace"){this.oReplace=document.getElementById(idReplace);this.oReplBtn.disable();
}if(apf.hasFocusBug){var fSel=function(e){e=e||window.event;e.cancelBubble=true;
};apf.sanitizeTextbox(this.oSearch);this.oSearch.onselectstart=fSel;if(this.oReplace){apf.sanitizeTextbox(this.oReplace);
this.oReplace.onselectstart=fSel;}apf.sanitizeTextbox(this.oCase);}return panelBody;
};this.destroy=function(){panelBody=this.oSearch=this.oCase=null;delete panelBody;
delete this.oSearch;delete this.oCase;if(this.oReplace){this.oReplace=this.oReplBtn=this.oReplAllBtn=null;
delete this.oReplace;delete this.oReplBtn;delete this.oReplAllBtn;}};};apf.LiveEdit.plugin("search",apf.LiveEdit.searchPlugin);
apf.LiveEdit.plugin("replace",apf.LiveEdit.searchPlugin);apf.LiveEdit.plugin("spell",function(){this.name="spell";
this.icon="spell";this.type=apf.TEXTMACRO;this.hook="typing";this.state=apf.OFF;
var engine,lastVal,crtLang=null,basepath=null,canCheck=false;this.execute=function(editor){apf.console.log("spell active..."+typeof editor);
var _self=this;if(basepath===null){basepath=(apf.config.resourcePath||apf.basePath)+"resources/";
}if(crtLang===null||editor.language!=crtLang){crtLang=editor.language;canCheck=false;
engine=BJSpell(basepath+crtLang+".js",function(){canCheck=true;});}if(canCheck){lastVal=editor.getValue().replace(/<span[^>]+underline[^>]+>(.*)<\/span>/gi,"$1");
var html=engine.replace(lastVal,function(word){return"<span class='underline' onmouseover='return apf.all["+_self.$uniqueId+"].suggest(this);'>"+word+"</span>";
});if(lastVal.replace(/[\r\n]/g,"")!=html.replace(/[\r\n]/g,"")){editor.$value="";
var oBm=editor.$selection.getBookmark();editor.$propHandlers.value.call(editor,html);
setTimeout(function(){editor.$selection.moveToBookmark(oBm);});}}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
};this.suggest=function(){apf.console.log("suggestions to be delivered here...");
};this.queryState=function(editor){return this.state;};
/*
     * BJSpell JavaScript Library v0.0.1
     * http://code.google.com/p/bjspell/
     *
     * Copyright (c) 2009 Andrea Giammarchi
     * Licensed under the Lesser GPL licenses.
     *
     * Date: 2009-02-05 23:50:01 +0000 (Wed, 05 Feb 2009)
     * Revision: 1
     * ToDo: better suggestion (at least one that make more sense)
     */
BJSpell=apf.LiveEdit.spell=function(){function BJSpell(dic,callback){if(this instanceof BJSpell){var lang=/^.*?([a-zA-Z]{2}_[a-zA-Z]{2}).*$/.exec(dic)[1],self=this;
if(!callback){callback=empty;}if(BJSpell[lang]){if(BJSpell[lang] instanceof BJSpell){self=BJSpell[lang];
}else{BJSpell[lang]=sync(self,BJSpell[lang]);}self.checked={};var keys=self.keys=[],words=self.words,i=0,key;
for(key in words){keys[i++]=key;}keys.indexOf=indexOf;setTimeout(function(){callback.call(self);
},1);}else{apf.console.log("loading dic script: "+dic);var script=document.createElement("script");
BJSpell[lang]=self;script.src=dic;script.type="text/javascript";script.onload=function(){apf.console.log("incoming script...");
script.onload=script.onreadystatechange=empty;script.parentNode.removeChild(script);
BJSpell.call(self,dic,callback);};script.onreadystatechange=function(){apf.console.log("script readyState change...");
if(/loaded|completed/i.test(script.readyState)){script.onload();}};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(script);
}return self;}else{return new BJSpell(dic,callback);}}BJSpell.prototype.check=function(word){var checked=this.checked[word=word.toLowerCase()];
return typeof checked==="boolean"?checked:this.parse(word);};BJSpell.prototype.parse=function(word){if(/^[0-9]+$/.test(word)){return this.checked[word]=true;
}var result=!!this.words[word],parsed,rules,len,length,i,rule,str,seek,re,add;if(!result){for(parsed=word,rules=this.rules.PFX,length=rules.length,i=0;
i<length;i++){rule=rules[i];add=rule[0];seek=rule[1];re=rule[2];str=word.substr(0,seek.length);
if(str===seek){parsed=word.substring(str.length);if(add!=="0"){parsed=add+parsed;
}result=!!this.words[parsed];break;}}if(!result&&parsed.length){for(rules=this.rules.SFX,len=parsed.length,length=rules.length,i=0;
i<length;i++){rule=rules[i];add=rule[0];seek=rule[1];re=rule[2];str=parsed.substring(len-seek.length);
if(str===seek){seek=parsed.substring(0,len-str.length);if(add!=="0"){seek+=add;
}if((re==="."||new RegExp(re+"$").test(seek))&&this.words[seek]){result=true;break;
}}}}}return this.checked[word]=result;};BJSpell.prototype.replace=function(String,callback){var self=this;
return String.replace(self.alphabet,function(word){return self.check(word)?word:callback(word);
});};BJSpell.prototype.suggest=function(word,many){if(typeof this.words[word]==="string"){var words=[word];
}else{var keys=this.keys,length=keys.length,i=Math.abs(many)||1,ceil,indexOf,words;
word=word.toLowerCase();if(-1===keys.indexOf(word)){keys[length]=word;}keys.sort();
indexOf=keys.indexOf(word);many=indexOf-((i/2)>>0);ceil=indexOf+1+Math.ceil(i/2);
words=keys.slice(many,indexOf).concat(keys.slice(indexOf+1,ceil));while(words.length<i&&++ceil<keys.length){words[words.length]=keys[ceil];
}if(length!==keys.length){keys.splice(indexOf,1);}}return words;};var empty=function(){},indexOf=Array.prototype.indexOf||function(word){for(var i=0,length=this.length;
i<length&&this[i]!==word;i++){}return i==length?-1:i;},sync=function(a,b){for(var k in b){a[k]=b[k];
}return a;};return BJSpell;}();});apf.LiveEdit.subSupCommand=function(sName){this.name=sName;
this.icon=sName;this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding=sName=="sub"?"ctrl+alt+s":"ctrl+shift+s";this.state=apf.OFF;this.execute=function(editor){var other=this.name=="sub"?"Superscript":"Subscript";
if(editor.$queryCommandState(other)==apf.ON){editor.$execCommand(other);}editor.$execCommand(this.name=="sub"?"Subscript":"Superscript");
editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(editor){return editor.$queryCommandState(this.name=="sub"?"Subscript":"Superscript");
};};apf.LiveEdit.plugin("sub",apf.LiveEdit.subSupCommand);apf.LiveEdit.plugin("sup",apf.LiveEdit.subSupCommand);
apf.LiveEdit.plugin("table",function(){this.name="table",this.icon="table",this.type=apf.TOOLBARITEM,this.subType=apf.TOOLBARPANEL,this.hook="ontoolbar",this.keyBinding="ctrl+alt+shift+t",this.state=apf.OFF;
var panelBody,oTableCont,oTableSel,oTable,oStatus,oTablePos,iCurrentX=0,iCurrentY=0,_self=this,TABLE_SIZE=164,CELL_SIZE=23,GUTTER_SIZE=4,BUTTON_SIZE=20;
this.init=function(editor,btn){this.buttonNode.className=this.buttonNode.className+" dropdown_small";
var oArrow=this.buttonNode.insertBefore(document.createElement("span"),this.buttonNode.getElementsByTagName("div")[0]);
oArrow.className="selectarrow";};this.execute=function(editor){if(!panelBody){this.editor=editor;
oDoc=editor.useIframe?document:editor.$activeDocument;apf.popup.setContent(this.$uniqueId,this.createPanelBody());
}else{resetTableMorph();}editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
this.editor.$showPopup(this,this.$uniqueId,this.buttonNode);window.setTimeout(function(){panelBody.style.width=(oTableCont.offsetWidth+(GUTTER_SIZE*2))+"px",panelBody.style.height=(oTableCont.offsetWidth+BUTTON_SIZE)+"px",oTablePos=apf.getAbsolutePosition(oTable);
});};this.queryState=function(editor){return this.state;};this.submit=function(oSize){apf.popup.forceHide();
if(oSize[0]<0||oSize[1]<0){return;}var k,l,i=0,j=oSize[0],oEditor=this.editor,aOut=['<table border="0" width="50%">'];
for(;i<j;i++){aOut.push("<tr>");for(k=0,l=oSize[1];k<l;k++){aOut.push("<td>",(apf.isIE?"":'&nbsp;<br _apf_placeholder="1" />'),"</td>");
}aOut.push("</tr>");}aOut.push("</table>");oEditor.$insertHtml(aOut.join(""),true);
oEditor.$selection.collapse(false);};var bMorphing=false,oMorphCurrent,iMorphXCount,iMorphYCount;
function mouseDown(e){bMorphing=true;oMorphCurrent=e.client;iMorphXCount=iMorphYCount=0;
document.onmousemove=function(e){if(!bMorphing){return;}e=new apf.AbstractEvent(e||window.event);
if(e.client.x>oTablePos[0]+oTable.offsetWidth||e.client.y>oTablePos[1]+oTable.offsetHeight){morphTable(e);
}e.stop();return false;};document.onmouseup=function(e){e=new apf.AbstractEvent(e||window.event);
mouseUp.call(_self,e);e.stop();return false;};return false;}function mouseUp(e){if(bMorphing){bMorphing=false,oMorphCurrent=document.onmousemove=document.onmouseup=null,iMorphXCount=iMorphYCount=0;
}mouseOver.call(this,e);if(iCurrentX>0&&iCurrentY>0){this.submit([iCurrentY,iCurrentX]);
}e.stop();return false;}function morphTable(e){oMorphCurrent=e.client;iMorphXCount=(Math.floor((oMorphCurrent.x-oTablePos[0])/CELL_SIZE)*CELL_SIZE)+CELL_SIZE;
if(iMorphXCount>oTable.offsetWidth){panelBody.style.width=(iMorphXCount+(BUTTON_SIZE/2))+"px",oTableCont.style.width=(iMorphXCount+GUTTER_SIZE)+"px",oTable.style.width=(iMorphXCount)+"px",oTableSel.style.width=(iMorphXCount)+"px";
}iMorphYCount=(Math.floor((oMorphCurrent.y-oTablePos[1])/CELL_SIZE)*CELL_SIZE)+CELL_SIZE;
if(iMorphYCount>oTable.offsetHeight){panelBody.style.height=(iMorphYCount+BUTTON_SIZE)+"px",oTableCont.style.height=(iMorphYCount+GUTTER_SIZE)+"px",oTable.style.height=(iMorphYCount)+"px",oTableSel.style.height=(iMorphYCount)+"px";
}}function resetTableMorph(){oTableCont.style.width=oTableCont.style.height=TABLE_SIZE+"px",oTableSel.style.width=oTableSel.style.height="0px",oTable.style.width=oTable.style.height=TABLE_SIZE-GUTTER_SIZE+"px";
}var sCurrentCaption="";function mouseOver(e){if(typeof oTablePos=="undefined"){return;
}iCurrentX=Math.ceil((e.page.x-oTablePos[0])/CELL_SIZE);iCurrentY=Math.ceil((e.page.y-oTablePos[1])/CELL_SIZE);
if(iCurrentX>0&&iCurrentY>0){oTableSel.style.width=Math.min((iCurrentX*CELL_SIZE),oTable.offsetWidth)+"px";
oTableSel.style.height=Math.min((iCurrentY*CELL_SIZE),oTable.offsetHeight)+"px";
var sCaption=iCurrentY+" x "+iCurrentX+" "+_self.editor.$translate("table_noun");
if(sCurrentCaption!=sCaption){oStatus.innerHTML=sCurrentCaption=sCaption;}}else{iCurrentX=iCurrentY=0;
}}function mouseOut(e){if(bMorphing){return;}oTableSel.style.width=oTableSel.style.height="0px";
iCurrentX=iCurrentY=0;oStatus.innerHTML=sCurrentCaption=_self.editor.$translate("cancel");
}function statusClick(e){mouseOut.call(this,e);apf.popup.forceHide();}this.createPanelBody=function(){panelBody=document.body.appendChild(document.createElement("div"));
panelBody.className="editor_popup editor_tablepopup";panelBody.style.display="none";
var idTableCont="editor_"+this.$uniqueId+"_tablecont",idTableSel="editor_"+this.$uniqueId+"_tablesel",idTable="editor_"+this.$uniqueId+"_table",idStatus="editor_"+this.$uniqueId+"_table_status";
panelBody.innerHTML='<div id="'+idTableCont+'" class="editor_paneltable_cont">                <div id="'+idTableSel+'" class="editor_paneltable_sel"></div>                <div id="'+idTable+'" class="editor_paneltable"></div>            </div>            <div id="'+idStatus+'" class="editor_paneltablecancel">'+this.editor.$translate("cancel")+"</div>";
oTableCont=document.getElementById(idTableCont),oTableSel=document.getElementById(idTableSel),oTable=document.getElementById(idTable),oTable.onmousedown=mouseDown.bindWithEvent(this,true),oTable.onmouseup=mouseUp.bindWithEvent(this,true),oTable.onmousemove=mouseOver.bindWithEvent(this,true),oTable.onmouseout=mouseOut.bindWithEvent(this,true),oStatus=document.getElementById(idStatus),oStatus.onmousedown=statusClick.bindWithEvent(this,true),panelBody.onselectstart=function(){return false;
},resetTableMorph();return panelBody;};this.destroy=function(){panelBody=oTableCont=oTableSel=oTable=oStatus=oTablePos=oDoc=null;
delete panelBody,delete oTableCont,delete oTableSel,delete oTable,delete oStatus,delete oTablePos,delete oDoc;
};});apf.LiveEdit.plugin("tablewizard",function(){this.name="tablewizard";this.icon="tablewizard";
this.type=apf.CONTEXTPANEL;this.hook="context";this.state=apf.OFF;this.oTable=null;
this.oRow=null;this.oCell=null;var activeNode,oDoc,_self=this;this.execute=function(editor,e){if(this.queryState(editor)!=apf.ON){return;
}this.oTable=this.oRow=this.oCell=null;while(activeNode.tagName!="TABLE"){if(activeNode.tagName=="TD"){this.oCell=activeNode;
}else{if(activeNode.tagName=="TR"){this.oRow=activeNode;}}activeNode=activeNode.parentNode;
}this.oTable=activeNode;if(!this.editor){this.editor=editor;}if(!apf.editor.oMenu){this.createContextMenu();
}if(!oDoc){oDoc=editor.useIframe?document:editor.$activeDocument;}apf.editor.oMenu.tablePlugin=this;
var pos=apf.getAbsolutePosition(editor.iframe);if(!e.client){e=new apf.AbstractEvent(e);
}apf.editor.oMenu.display(e.client.x+pos[0],e.client.y+pos[1],true);e.stop();editor.dispatchEvent("pluginexecute",{name:this.name,plugin:this});
return false;};this.queryState=function(editor){var oNode=editor.$selection.getSelectedNode();
while(oNode.nodeType!=1||oNode.tagName!="BODY"){if(oNode.tagName=="TABLE"||oNode.tagName=="TBODY"||oNode.tagName=="TR"||oNode.tagName=="TD"){activeNode=oNode;
return apf.ON;}oNode=oNode.parentNode;}return apf.OFF;};function addRows(td_elm,tr_elm,rowspan){td_elm.rowSpan=1;
var trNext=nextElm(tr_elm,["TR"]);for(var i=1;i<rowspan&&trNext;i++){var newTD=oDoc.createElement("td");
if(!apf.isIE){newTD.innerHTML='<br mce_bogus="1"/>';}if(apf.isIE){trNext.insertBefore(newTD,trNext.cells(td_elm.cellIndex));
}else{trNext.insertBefore(newTD,trNext.cells[td_elm.cellIndex]);}trNext=nextElm(trNext,["TR"]);
}}function getColRowSpan(td){var colspan=td.getAttribute("colspan")||"";var rowspan=td.getAttribute("rowspan")||"";
return{colspan:colspan==""?1:parseInt(colspan),rowspan:rowspan==""?1:parseInt(rowspan)};
}function getTableGrid(table){var grid=[],rows=table.rows,x,y,td,sd,xstart,x2,y2;
for(y=0;y<rows.length;y++){for(x=0;x<rows[y].cells.length;x++){td=rows[y].cells[x];
sd=getColRowSpan(td);for(xstart=x;grid[y]&&grid[y][xstart];xstart++){}for(y2=y;
y2<y+sd.rowspan;y2++){if(!grid[y2]){grid[y2]=[];}for(x2=xstart;x2<xstart+sd.colspan;
x2++){grid[y2][x2]=td;}}}}return grid;}function getCellPos(grid,td){for(var i=0;
i<grid.length;i++){for(var j=0;j<grid[i].length;j++){if(grid[i][j]==td){return{cellindex:j,rowindex:i};
}}}return null;}function getCell(grid,row,col){if(grid[row]&&grid[row][col]){return grid[row][col];
}return null;}function nextElm(node,names){while((node=node.nextSibling)!=null){for(var i=0;
i<names.length;i++){if(node.nodeName.toLowerCase()==names[i].toLowerCase()){return node;
}}}return null;}this.createContextMenu=function(){var idMenu="editor_"+this.$uniqueId+"_menu";
this.appendAmlNode('            <a:menu xmlns:a="'+apf.ns.aml+'" id="'+idMenu+'">                <a:item value="rowbefore">Insert row before</a:item>                <a:item value="rowbefore">Insert row after</a:item>                <a:item value="deleterow">Delete row</a:item>                <a:divider />                <a:item value="colbefore">Insert column before</a:item>                <a:item value="colafter">Insert column after</a:item>                <a:item value="deletecol">Delete column</a:item>                <a:divider />                <a:item value="splitcells">Split merged table cells</a:item>                <a:item value="mergecells">Merge table cells</a:item>            </a:menu>',document.body);
var oMenu=apf.editor.oMenu=self[idMenu];oMenu.addEventListener("onitemclick",function(e){if(this.tablePlugin!=_self){return;
}var oRow,i,j,idx=0,oEditor=_self.editor;if(_self.oCell){for(i=0,j=_self.oRow.cells.length;
i<j;i++){if(_self.oRow.cells[i]==_self.oCell){idx=i;}}}oEditor.$selection.set();
switch(e.value){case"rowbefore":oRow=oDoc.createElement("tr");_self.oRow.parentNode.insertBefore(oRow,_self.oRow);
for(i=0,j=_self.oRow.cells.length;i<j;i++){oRow.insertCell(0);}break;case"rowafter":oRow=oDoc.createElement("tr");
_self.oRow.parentNode.insertBefore(oRow,_self.oRow.nextSibling);for(i=0,j=_self.oRow.cells.length;
i<j;i++){oRow.insertCell(0);}break;case"deleterow":if(!_self.oRow||!_self.oRow.parentNode){return;
}_self.oRow.parentNode.removeChild(_self.oRow);break;case"colbefore":if(!_self.oCell){return;
}for(i=0,j=_self.oTable.rows.length;i<j;i++){_self.oTable.rows[i].insertCell(idx);
}break;case"colafter":if(!_self.oCell){return;}idx+=1;for(i=0,j=_self.oTable.rows.length;
i<j;i++){_self.oTable.rows[i].insertCell(idx);}break;case"deletecol":if(!_self.oCell||_self.oTable.rows[0].cells.length==1){return;
}for(i=0,j=_self.oTable.rows.length;i<j;i++){if(_self.oTable.rows[i].cells[idx]){_self.oTable.rows[i].deleteCell(idx);
}}break;case"splitcells":if(!_self.oRow||!_self.oCell){return true;}var spandata=getColRowSpan(_self.oCell);
var colspan=spandata.colspan;var rowspan=spandata.rowspan;if(colspan>1||rowspan>1){_self.oCol.colSpan=1;
for(i=1;i<colspan;i++){var newTD=oDoc.createElement("td");if(!apf.isIE){newTD.innerHTML='<br _apf_placeholder="1"/>';
}_self.oRow.insertBefore(newTD,nextElm(_self.oCell,["TD","TH"]));if(rowspan>1){addRows(newTD,_self.oRow,rowspan);
}}addRows(_self.oCell,_self.oRow,rowspan);}break;case"mergecells":var rows=[],cells=[],oSel=oEditor.$selection.get(),grid=getTableGrid(_self.oTable),oCellPos,aRows,aRowCells,aBrs,oTd,k;
if(apf.isIE||oSel.rangeCount==1){var numRows=1;var numCols=1;oCellPos=getCellPos(grid,_self.oCell);
aRows=_self.oTable.rows;for(i=oCellPos.rowindex;i<grid.length;i++){aRowCells=[];
for(j=oCellPos.cellindex;j<grid[i].length;j++){oTd=getCell(grid,i,j);if(oTd&&!rows.contains(oTd)&&!aRowCells.contains(oTd)){var cp=getCellPos(grid,oTd);
if(cp.cellindex<oCellPos.cellindex+numCols&&cp.rowindex<oCellPos.rowindex+numRows){aRowCells[aRowCells.length]=oTd;
}}}if(aRowCells.length>0){rows[rows.length]=aRowCells;}oTd=getCell(grid,oCellPos.rowindex,oCellPos.cellindex);
aBrs=oTd.getElementsByTagName("br");if(aBrs.length>1){for(j=aBrs.length;j>=1;j--){if(aBrs[j].getAttribute("_apf_placeholder")){aBrs[j].parentNode.removeChild(aBrs[j]);
}}}}}else{var x1=-1,y1=-1,x2,y2;if(oSel.rangeCount<2){return true;}for(i=0;i<oSel.rangeCount;
i++){var rng=oSel.getRangeAt(i);_self.oCell=rng.startContainer.childNodes[rng.startOffset];
if(!_self.oCell){break;}if(_self.oCell.nodeName=="TD"||_self.oCell.nodeName=="TH"){cells.push(_self.oCell);
}}aRows=_self.oTable.rows;for(i=0;i<aRows.length;i++){aRowCells=[];for(j=0;j<aRows[i].cells.length;
j++){oTd=aRows[i].cells[j];for(k=0;k<cells.length;k++){if(oTd!=cells[k]){continue;
}aRowCells.push(oTd);}}if(aRowCells.length>0){rows.push(aRowCells);}}for(i=0;i<grid.length;
i++){for(j=0;j<grid[i].length;j++){grid[i][j]._selected=false;for(k=0;k<cells.length;
k++){if(grid[i][j]!=cells[k]){continue;}if(x1==-1){x1=j;y1=i;}x2=j;y2=i;grid[i][j]._selected=true;
}}}for(i=y1;i<=y2;i++){for(j=x1;j<=x2;j++){if(!grid[i][j]._selected){alert("Invalid selection for merge.");
return true;}}}}var rowSpan=1,colSpan=1;var sd,lastRowSpan=-1;for(i=0;i<rows.length;
i++){var rowColSpan=0;for(j=0,k=rows[i].length;j<k;j++){sd=getColRowSpan(rows[i][j]);
rowColSpan+=sd.colspan;if(lastRowSpan!=-1&&sd.rowspan!=lastRowSpan){alert("Invalid selection for merge.");
return true;}lastRowSpan=sd.rowspan;}if(rowColSpan>colSpan){colSpan=rowColSpan;
}lastRowSpan=-1;}var lastColSpan=-1;for(j=0;j<rows[0].length;j++){var colRowSpan=0;
for(i=0;i<rows.length;i++){sd=getColRowSpan(rows[i][j]);colRowSpan+=sd.rowspan;
if(lastColSpan!=-1&&sd.colspan!=lastColSpan){alert("Invalid selection for merge.");
return true;}lastColSpan=sd.colspan;}if(colRowSpan>rowSpan){rowSpan=colRowSpan;
}lastColSpan=-1;}_self.oCell=rows[0][0];_self.oCell.rowSpan=rowSpan;_self.oCell.colSpan=colSpan;
for(i=0;i<rows.length;i++){for(j=0;j<rows[i].length;j++){var html=rows[i][j].innerHTML;
var chk=html.replace(/[ \t\r\n]/g,"");if(chk!="<br/>"&&chk!='<br _apf_placeholder="1"/>'&&(j+i>0)){_self.oCell.innerHTML+=html;
}if(rows[i][j]==_self.oCell&&rows[i][j]._deleted){continue;}oCellPos=getCellPos(grid,rows[i][j]);
var tr=rows[i][j].parentNode;tr.removeChild(rows[i][j]);rows[i][j]._deleted=true;
if(tr.hasChildNodes()){continue;}tr.parentNode.removeChild(tr);var cellElm,lastCell=null;
for(k=0;cellElm=getCell(grid,oCellPos.rowindex,k);k++){if(cellElm!=lastCell&&cellElm.rowSpan>1){cellElm.rowSpan--;
}lastCell=cellElm;}if(_self.oCell.rowSpan>1){_self.oCell.rowSpan--;}}}aBrs=_self.oCell.getElementsByTagName("br");
if(aBrs.length>1){for(i=aBrs.length;i>=1;i--){if(aBrs[i]&&aBrs[i].getAttribute("_apf_placeholder")){aBrs[i].parentNode.removeChild(aBrs[i]);
}}}break;}oEditor.$restoreFocus();oEditor.change(_self.editor.getValue());});};
});apf.LiveEdit.plugin("visualaid",function(){this.name="visualaid";this.icon="visualaid";
this.type=apf.TOOLBARITEM;this.subType=apf.TOOLBARBUTTON;this.hook="ontoolbar";
this.keyBinding="ctrl+shift+v";this.state=apf.OFF;this.execute=function(editor){var state=this.queryState(editor);
editor.$activeDocument.body.className=(state==apf.ON)?"":"visualAid";editor.$notifyButton(this.name);
apf.dispatchEvent("pluginexecute",{name:this.name,plugin:this});};this.queryState=function(editor){this.state=apf[editor.$activeDocument.body.className=="visualAid"?"ON":"OFF"];
return this.state;};});apf.__ANCHORING__=1<<13;apf.Anchoring=function(){this.$regbase=this.$regbase|apf.__ANCHORING__;
this.$anchors=[];var VERTICAL=1;var HORIZONTAL=2;this.$updateQueue=0;this.$inited=this.$parsed=this.$anchoringEnabled=false;
this.$hordiff=this.$verdiff=0;this.$rule_v=this.$rule_h=this.$rule_header="";var l=apf.layout;
this.$supportedProperties.push("anchors");var propHandlers={right:function(value,prop){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;
}if(!value&&value!==0){this.$ext.style[prop]="";}if(!this.$updateQueue){l.queue(this.$pHtmlNode,this);
}this.$updateQueue=this.$updateQueue|HORIZONTAL;},bottom:function(value,prop){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;
}if(!value&&value!==0){this.$ext.style[prop]="";}if(!this.$updateQueue){l.queue(this.$pHtmlNode,this);
}this.$updateQueue=this.$updateQueue|VERTICAL;}};propHandlers.left=propHandlers.width=propHandlers.right;
propHandlers.top=propHandlers.height=propHandlers.bottom;this.$propHandlers.anchors=function(value){this.$anchors=value?value.splitSafe("(?:, *| )"):[];
if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!this.$updateQueue&&apf.loaded){l.queue(this.$pHtmlNode,this);
}this.$updateQueue=this.$updateQueue|HORIZONTAL|VERTICAL;};this.$disableAnchoring=function(activate){if(!this.$inited||!this.$anchoringEnabled||!this.$pHtmlNode){return;
}l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");if(l.queue){l.queue(this.$pHtmlNode);
}for(var prop in propHandlers){delete this.$propHandlers[prop];}this.removeEventListener("DOMNodeRemoved",remove);
this.removeEventListener("DOMNodeInserted",reparent);if(this.$ext){this.$ext.style.left=this.$ext.style.right=this.$ext.style.top=this.$ext.style.bottom=this.$ext.style.width=this.$ext.style.height=this.$ext.style.position="";
}this.removeEventListener("prop.visible",visibleHandler);this.$inited=false;this.$anchoringEnabled=false;
};this.$enableAnchoring=function(){if(this.$inited){return;}apf.extend(this.$propHandlers,propHandlers);
this.addEventListener("DOMNodeRemoved",remove);this.addEventListener("DOMNodeInserted",reparent);
this.addEventListener("prop.visible",visibleHandler);this.$updateQueue=0|((this.left||this.width||this.right||this.anchors)&&HORIZONTAL)|((this.top||this.height||this.bottom||this.anchors)&&VERTICAL);
if(this.$updateQueue){l.queue(this.$pHtmlNode,this);}this.$inited=true;this.$anchoringEnabled=true;
};function visibleHandler(e){if(!(this.$rule_header||this.$rule_v||this.$rule_h)){return;
}if(e.value){if(this.$rule_v||this.$rule_h){var rules=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;
l.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",rules);l.queue(this.$pHtmlNode,this);
}l.processQueue();}else{l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");
l.queue(this.$pHtmlNode);}}function remove(e){if(e&&(e.$doOnlyAdmin||e.currentTarget!=this)){return;
}if(l.queue&&this.$pHtmlNode){l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");
l.queue(this.$pHtmlNode);}}function reparent(e){if(!this.$amlLoaded||e.currentTarget!=this){return;
}if(!e.$isMoveWithinParent&&this.$parsed){this.$moveAnchoringRules(e.$oldParentHtmlNode);
}}this.$moveAnchoringRules=function(oldParent,updateNow){var rules=oldParent&&l.removeRule(oldParent,this.$uniqueId+"_anchors");
if(rules){l.queue(oldParent);}if(!this.$rule_v&&!this.$rule_h&&!this.$rule_header){return;
}this.$rule_header=getRuleHeader.call(this);rules=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;
l.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",rules);l.queue(this.$pHtmlNode,this);
};this.$hasAnchorRules=function(){return this.$rule_v||this.$rule_h?true:false;
};function getRuleHeader(){if(!this.$pHtmlDoc){return"";}return"try{            var oHtml = "+(apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')")+";                        var pWidth = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowWidth()":"apf.getHtmlInnerWidth(oHtml.parentNode)")+";                        var pHeight = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowHeight()":"apf.getHtmlInnerHeight(oHtml.parentNode)")+";            }catch(e){            }";
}function setPercentage(expr,value){return String(expr).replace(apf.percentageMatch,"(("+value+" * $1)/100)");
}this.$recalcAnchoring=function(queueDelay){this.$updateQueue=this.$updateQueue|HORIZONTAL|VERTICAL;
this.$updateLayout();l.queue(this.$pHtmlNode,this);if(!queueDelay){l.processQueue();
}};function visCheck(){if(this.$updateQueue){this.$updateLayout();apf.layout.activateRules(this.$ext.parentNode);
}}this.$updateLayout=function(){if(!this.$anchoringEnabled){return;}if(!apf.window.vManager.check(this,"anchoring",visCheck)){return;
}if(!this.$parsed){if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);
}this.$rule_header=getRuleHeader.call(this);this.$parsed=true;}if(!this.$updateQueue){if(this.visible&&this.$ext.style.display=="none"){this.$ext.style.display="";
}return;}if(this.draggable=="relative"){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";
}}else{if(this.left||this.left===0||this.top||this.top===0||this.right||this.right===0||this.bottom||this.bottom===0||this.$anchors.length){if("absolute|fixed".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";
}}else{if(!this.center){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="relative";
}if(!this.width){this.$ext.style.width="";}if(!this.height){this.$ext.style.height="";
}}}}var rules;if(this.$updateQueue&HORIZONTAL){rules=[];this.$hordiff=apf.getWidthDiff(this.$ext);
var left=this.$anchors[3]||this.left,right=this.$anchors[1]||this.right,width=this.width,hasLeft=left||left===0,hasRight=right||right===0,hasWidth=width||width===0;
if(right&&typeof right=="string"){right=setPercentage(right,"pWidth");}if(hasLeft){if(parseInt(left)!=left){left=setPercentage(left,"pWidth");
rules.push("oHtml.style.left = ("+left+") + 'px'");}else{this.$ext.style.left=left+"px";
}}if((apf.hasStyleAnchors||!hasLeft)&&hasRight){if(parseInt(right)!=right){right=setPercentage(right,"pWidth");
rules.push("oHtml.style.right = ("+right+") + 'px'");}else{this.$ext.style.right=right+"px";
}}if(hasLeft&&hasRight){if(!apf.hasStyleAnchors){rules.push("oHtml.style.width = (pWidth - ("+right+") - ("+left+") - "+this.$hordiff+") + 'px'");
}else{this.$ext.style.width="";}}else{if(hasWidth&&typeof this.maxwidth=="number"&&typeof this.minwidth=="number"){if(parseInt(width)!=width){width=setPercentage(width,"pWidth");
rules.push("oHtml.style.width = Math.max("+(this.minwidth-this.$hordiff)+", Math.min("+(this.maxwidth-this.$hordiff)+", "+width+" - "+this.$hordiff+")) + 'px'");
}else{this.$ext.style.width=((width>this.minwidth?(width<this.maxwidth?width:this.maxwidth):this.minwidth)-this.$hordiff)+"px";
}}}this.$rule_h=(rules.length?"try{"+rules.join(";}catch(e){};try{")+";}catch(e){};":"");
}if(this.$updateQueue&VERTICAL){rules=[];this.$verdiff=apf.getHeightDiff(this.$ext);
var top=this.$anchors[0]||this.top,bottom=this.$anchors[2]||this.bottom,height=this.height,hasTop=top||top===0,hasBottom=bottom||bottom===0,hasHeight=height||height===0;
if(bottom&&typeof bottom=="string"){bottom=setPercentage(bottom,"pHeight");}if(hasTop){if(parseInt(top)!=top){top=setPercentage(top,"pHeight");
rules.push("oHtml.style.top = ("+top+") + 'px'");}else{this.$ext.style.top=top+"px";
}}if((apf.hasStyleAnchors||!hasTop)&&hasBottom){if(parseInt(bottom)!=bottom){rules.push("oHtml.style.bottom = ("+bottom+") + 'px'");
}else{this.$ext.style.bottom=bottom+"px";}}if(hasTop&&hasBottom){if(!apf.hasStyleAnchors){rules.push("oHtml.style.height = (pHeight - ("+bottom+") - ("+top+") - "+this.$verdiff+") + 'px'");
}else{this.$ext.style.height="";}}else{if(hasHeight&&typeof this.minheight=="number"){if(parseInt(height)!=height){height=setPercentage(height,"pHeight");
rules.push("oHtml.style.height = Math.max("+(this.minheight-this.$verdiff)+", Math.min("+(this.maxheight-this.$verdiff)+", "+height+" - "+this.$verdiff+")) + 'px'");
}else{this.$ext.style.height=Math.max(0,(height>this.minheight?(height<this.maxheight?height:this.maxheight):this.minheight)-this.$verdiff)+"px";
}}}this.$rule_v=(rules.length?"try{"+rules.join(";}catch(e){};try{")+";}catch(e){};":"");
}if(this.$rule_v||this.$rule_h){l.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h,true);
}else{l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");}this.$updateQueue=0;
if(this.$box&&!apf.hasFlexibleBox){apf.layout.forceResize(this.$ext);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){});
this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$disableAnchoring();
});};apf.__CONTENTEDITABLE__=1<<24;apf.addEventListener("load",function(){var lastShift;
apf.window.undoManager.addEventListener("afterchange",function(){apf.layout.processQueue();
apf.document.$getVisualSelect().updateGeo();});var sel=apf.document.getSelection();
sel.addEventListener("update",function(){});apf.addEventListener("keydown",function(e){var key=e.keyCode;
if(!apf.document.activeElement||!apf.document.activeElement.editable){return;}if(apf.document.queryCommandState("rename")){if(apf.hasSingleResizeEvent){$setTimeout(function(){apf.document.$getVisualSelect().updateGeo();
});}if(key==27||key==13){apf.document.execCommand("rename",false,key==13);window.focus();
apf.stopPropagation(e);return false;}else{if(apf.hasContentEditableContainerBug&&key==8&&document.getElementById("txt_rename").innerHTML=="<br>"){e.preventDefault();
}}return;}switch(key){case 27:if(apf.dragMode){var sel=apf.document.$getVisualSelect().getLastSelection();
(apf.document.activeElement||sel[0]).$cancelInteractive();}break;case 113:apf.document.execCommand("rename",true);
return false;case 16:if(!this.dragMode&&(apf.document.documentElement.editable||self.app&&self.app.editable)){if(e.ctrlKey){apf.document.execCommand("mode",null,"select");
}else{apf.document.execCommand("mode",null,{mode:"connect",timeout:1000,event:e.htmlEvent});
}}break;case 17:if(!lastShift||new Date()-lastShift>500||e.htmlEvent.repeat){lastShift=new Date().getTime();
}else{var isShowingConnections=(apf.document.queryCommandState("mode")||"").substr(0,8)=="connect-";
apf.document.execCommand("mode",null,{mode:isShowingConnections?"arrow":"connect-element",timeout:1000,event:e.htmlEvent});
lastShift=null;}break;}});apf.addEventListener("keyup",function(e){if(e.keyCode==16&&"select|connect".indexOf(apf.document.queryCommandState("mode"))>-1){apf.document.execCommand("mode",null,"arrow");
}});var recursion,$focus,lastFocussed;apf.document.addEventListener("focus",$focus=function(e){if(recursion){return;
}recursion=true;var node=e.currentTarget,isSelected;if(node.editable){if(sel.rangeCount){isSelected=sel.$getNodeList().indexOf(node)>-1;
if(!e.ctrlKey){if(isSelected){recursion=false;return;}sel.removeAllRanges();}else{if(sel.getRangeAt(0).startContainer!=node.parentNode){delete e.currentTarget;
e.fromElement&&e.fromElement.focus(null,e);recursion=false;return;}if(isSelected){recursion=false;
return;}}}sel.addRange(this.createRange()).selectNode(node);lastFocussed=node;}recursion=false;
});if(apf.document.activeElement&&apf.document.activeElement.editable){sel.addRange(apf.document.createRange()).selectNode(apf.document.activeElement);
}var lastPos=[-1000,-1000];apf.addEventListener("mousedown",function(e){lastPos=[e.htmlEvent.clientX,e.htmlEvent.clientY];
});apf.addEventListener("mouseup",function(e){if((apf.document.queryCommandState("mode")||"").indexOf("connect-")>-1){apf.document.execCommand("mode",null,"arrow");
}if(Math.abs(lastPos[0]-e.htmlEvent.clientX)>2||Math.abs(lastPos[1]-e.htmlEvent.clientY)>2){return;
}var o=apf.document.$getVisualSelect().$getOutline();if(!o){return;}var lastTop=o.style.top;
o.style.top="-10000px";var hOutline=document.getElementById("apf_outline");if(hOutline){hOutline.style.top="-10000px";
}var node=apf.findHost(document.elementFromPoint(e.htmlEvent.clientX,e.htmlEvent.clientY));
o.style.top=lastTop;if(lastFocussed==node){lastFocussed=null;return;}if(!node.editable){return;
}if(sel.rangeCount>1){var idx,list=sel.$getNodeList();if(e.htmlEvent.ctrlKey&&(idx=list.indexOf(node))>-1){sel.removeRange(sel.getRangeAt(idx));
delete e.currentTarget;var r=sel.getRangeAt(sel.rangeCount-1);recursion=true;r.startContainer.childNodes[r.startOffset].focus();
recursion=false;return;}else{sel.removeAllRanges();sel.addRange(apf.document.createRange()).selectNode(node);
}}});});apf.ContentEditable=function(){this.$regbase=this.$regbase|apf.__CONTENTEDITABLE__;
this.editable=false;this.$canEdit=true;this.$booleanProperties.editable=true;this.$propHandlers.editable=function(value,prop){if(this.nomk){this.editable=false;
return false;}if(value){if(this.$canEdit&&this.$ext&&!this.$coreHtml){this.dragOutline=true;
(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,true);
(this.$propHandlers.resizable||apf.GuiElement.propHandlers.resizable).call(this,true);
this.$lastFocussable=[this.$focussable,this.focussable];if(!this.$focussable||!this.focussable){apf.GuiElement.propHandlers.focussable.call(this,true);
}this.$focussable=this.focussable=true;if(this.$blur){this.$blur();}if(this.$propHandlers.visible){this.$propHandlers.visible_original=this.$propHandlers.visible;
}this.$propHandlers.visible=function(value){apf.setOpacity(this.$ext,value?1:0.5);
this.$ext.onmouseover=value?null:function(){apf.setOpacity(this,1);};this.$ext.onmouseout=value?null:function(e){if(!e){e=event;
}if(!e.toElement||e.toElement.host!==false){apf.setOpacity(this,0.5);}};};if(this.visible===false){if(this.$propHandlers.visible_original){this.$propHandlers.visible_original.call(this,true);
}this.$propHandlers.visible.call(this,false);}this.$lastDisabled=this.disabled;
this.disabled=-1;if(this.$isWindowContainer){this.$isWindowContainer=-2;}var rInfo;
if(rInfo=this.ownerDocument.queryCommandEnabled("rename",false,this)){var htmlNode=!rInfo[0]?this.$ext:(rInfo[0].nodeType==1?rInfo[0]:rInfo[0].parentNode);
if(apf.isIE){htmlNode.ondblclick=apf.ContentEditable.$renameStart;}else{apf.addListener(htmlNode,"mousedown",apf.ContentEditable.$renameStart);
}this.addEventListener("$skinchange",apf.ContentEditable.$renameSkinChange);}this.addEventListener("contextmenu",apf.ContentEditable.$contextMenu);
apf.ContentEditable.addInteraction(this);}this.isContentEditable=true;if(!this.parentNode.editable){var curfoc,vsel,lsel=(vsel=this.ownerDocument.$getVisualSelect()).getLastSelection();
if(!(curfoc=apf.window.getLastActiveElement())&&lsel.length||curfoc&&lsel.indexOf(curfoc)>-1){vsel.show();
}else{if(curfoc&&curfoc.editable){this.ownerDocument.getSelection().$selectList([curfoc]);
}}}apf.setStyleClass(this.$ext,"editable");}else{if(this.$canEdit&&this.$ext&&!this.$coreHtml){var n;
if(n=this.getAttributeNode("draggable")){apf.removeListener(this.$ext,"mousedown",this.$dragStart);
n.$triggerUpdate();}else{apf.removeListener(this.$ext,"mousedown",this.$dragStart);
(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,this.localName=="window"||false);
}delete this.dragOutline;delete this.$showDrag;delete this.$showResize;delete this.realtime;
if(n=this.getAttributeNode("resizable")){n.$triggerUpdate();}else{(this.$propHandlers.resizable||apf.GuiElement.propHandlers.resizable).call(this,false);
}if(this.$lastFocussable){this.$focussable=this.$lastFocussable[0];this.focussable=this.$lastFocussable[0]&&this.$lastFocussable[1];
if(!this.focussable){apf.GuiElement.propHandlers.focussable.call(this,this.focussable);
}delete this.$lastFocussable;}if(this.hasFocus&&this.hasFocus()){this.$focus();
}this.disabled=this.$lastDisabled;delete this.$lastDisabled;if(this.visible===false){if(this.$propHandlers.visible_original){this.$propHandlers.visible_original.call(this,false);
}this.$propHandlers.visible.call(this,true);}if(this.$propHandlers.visible_original){this.$propHandlers.visible=this.$propHandlers.visible_original;
delete this.$propHandlers.visible_original;}delete this.$isWindowContainer;var rInfo;
if(rInfo=this.ownerDocument.queryCommandEnabled("rename",false,this)){var htmlNode=!rInfo[0]?this.$ext:(rInfo[0].nodeType==1?rInfo[0]:rInfo[0].parentNode);
if(apf.isIE){htmlNode.ondblclick=null;}else{apf.removeListener(htmlNode,"mousedown",apf.ContentEditable.$renameStart);
}this.removeEventListener("$skinchange",apf.ContentEditable.$renameSkinChange);
}this.removeEventListener("contextmenu",apf.ContentEditable.$contextMenu);apf.ContentEditable.removeInteraction(this);
var sel=this.ownerDocument.$getVisualSelect().getLastSelection();if(sel.indexOf(this)>-1){this.ownerDocument.$getVisualSelect().hide();
}}this.isContentEditable=false;apf.setStyleClass(this.$ext,"",["editable"]);}};
this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.editable){this.editable=apf.isTrue(apf.getInheritedAttribute(this,"editable"));
if(this.editable){this.$propHandlers.editable.call(this,true);this.dispatchEvent("prop.editable",{value:true});
this.$inheritProperties.editable=2;}}});this.addEventListener("DOMNodeRemovedFromDocument",function(e){});
};apf.ContentEditable.$contextMenu=function(e){this.ownerDocument.execCommand("contextmenu",true,{amlNode:this,htmlEvent:e});
apf.stopEvent(e);return false;};(function(){var time;apf.ContentEditable.$renameStart=apf.isIE?function(){e=event;
if(e.srcElement!=this){return;}apf.findHost(e.srcElement).ownerDocument.execCommand("rename",true);
apf.stopPropagation(e);}:function(e){if(e.target!=this){return;}if(!time||new Date()-time[0]>500||time[1]!=e.target){time=[new Date().getTime(),e.target];
}else{if(time){apf.findHost(e.target).ownerDocument.execCommand("rename",true);
apf.stopPropagation(e);time=null;}}};})();apf.ContentEditable.$renameSkinChange=function(e){var rInfo=this.ownerDocument.queryCommandEnabled("rename",false,this);
var htmlNode=!rInfo[0]?this.$ext:(rInfo[0].nodeType==1?rInfo[0]:rInfo[0].parentNode);
if(apf.isIE){htmlNode.ondblclick=apf.ContentEditable.$renameStart;}else{apf.addListener(htmlNode,"mousedown",apf.ContentEditable.$renameStart);
}};apf.XhtmlElement.prototype.implement(apf.ContentEditable);apf.config.$inheritProperties.editable=2;
apf.__GUIELEMENT__=1<<15;apf.__VALIDATION__=1<<6;apf.GuiElement=function(){this.$init(true);
};(function(){this.$regbase=this.$regbase|apf.__GUIELEMENT__;this.$focussable=apf.KEYBOARD_MOUSE;
this.visible=2;this.$booleanProperties["disable-keyboard"]=true;this.$booleanProperties.visible=true;
this.$booleanProperties.focussable=true;this.$supportedProperties.push("draggable","resizable");
this.$supportedProperties.push("focussable","zindex","disabled","tabindex","disable-keyboard","contextmenu","visible","autosize","loadaml","actiontracker","alias","width","left","top","height","tooltip");
this.$setLayout=function(type,insert){if(!this.$drawn||!this.$pHtmlNode){return false;
}if(this.parentNode){if(this.parentNode.localName=="table"){if(this.$disableCurrentLayout){this.$disableCurrentLayout();
}this.parentNode.register(this,insert);this.$disableCurrentLayout=null;return type=="table";
}else{if("vbox|hbox".indexOf(this.parentNode.localName)>-1){if(this.$disableCurrentLayout){this.$disableCurrentLayout();
}this.parentNode.register(this,insert);this.$disableCurrentLayout=null;return type==this.parentNode.localName;
}}}if(!this.$anchoringEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();
}this.$enableAnchoring();this.$disableCurrentLayout=this.$disableAnchoring;}return type=="anchoring";
};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();
}});this.implement(apf.Anchoring,apf.ContentEditable,apf.LiveEdit);this.setWidth=function(value){this.setProperty("width",value,false,true);
return this;};this.setHeight=function(value){this.setProperty("height",value,false,true);
return this;};this.setLeft=function(value){this.setProperty("left",value,false,true);
return this;};this.setTop=function(value){this.setProperty("top",value,false,true);
return this;};if(!this.show){this.show=function(){this.setProperty("visible",true,false,true);
return this;};}if(!this.hide){this.hide=function(){this.setProperty("visible",false,false,true);
return this;};}this.getWidth=function(){return(this.$ext||{}).offsetWidth;};this.getHeight=function(){return(this.$ext||{}).offsetHeight;
};this.getLeft=function(){return(this.$ext||{}).offsetLeft;};this.getTop=function(){return(this.$ext||{}).offsetTop;
};this.enable=function(){this.setProperty("disabled",false,false,true);return this;
};this.disable=function(){this.setProperty("disabled",true,false,true);return this;
};this.sendToBack=function(){this.setProperty("zindex",0,false,true);return this;
};this.bringToFront=function(){this.setProperty("zindex",apf.all.length+1,false,true);
return this;};this.sendBackwards=function(){this.setProperty("zindex",this.zindex-1,false,true);
return this;};this.bringForward=function(){this.setProperty("zindex",this.zindex+1,false,true);
return this;};this.hasFocus=function(){};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var x=this.$aml;
if(this.parentNode){if(this.localName=="item"&&this.parentNode.hasFeature(apf.__MULTISELECT__)){this.$pHtmlNode=this.parentNode.$container;
}else{this.$pHtmlNode=this.parentNode.$int;}}if(!this.$pHtmlNode){return;}this.$pHtmlDoc=this.$pHtmlNode.ownerDocument||document;
if(this.$initSkin){this.$initSkin(x);}if(this.$draw){this.$draw();}if(e.id){this.$ext.setAttribute("id",e.id);
}if(typeof this.visible=="undefined"){this.visible=true;}if(apf.debug&&this.$ext&&this.$ext.nodeType){this.$ext.setAttribute("uniqueId",this.$uniqueId);
}if(this.$focussable&&typeof this.focussable=="undefined"){apf.GuiElement.propHandlers.focussable.call(this);
}this.$drawn=true;},true);var f=function(e){if(!this.$pHtmlNode){return;}this.$setLayout();
if(this.$ext){var hasPres=(this.hasFeature(apf.__PRESENTATION__))||false;var type=this.$isLeechingSkin?this.localName:"main";
if(this.minwidth==undefined){this.minwidth=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"minwidth")),0);
}if(this.minheight==undefined){this.minheight=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"minheight")),0);
}if(this.maxwidth==undefined){this.maxwidth=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"maxwidth")),10000);
}if(this.maxheight==undefined){this.maxheight=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"maxheight")),10000);
}var diff=apf.getDiff(this.$ext);this.$ext.style.minWidth=Math.max(0,this.minwidth-diff[0])+"px";
this.$ext.style.minHeight=Math.max(0,this.minheight-diff[1])+"px";this.$ext.style.maxWidth=Math.max(0,this.maxwidth-diff[0])+"px";
this.$ext.style.maxHeight=Math.max(0,this.maxheight-diff[1])+"px";if(this.$altExt&&apf.isGecko){this.$altExt.style.minHeight=this.$ext.style.minHeight;
this.$altExt.style.maxHeight=this.$ext.style.maxHeight;this.$altExt.style.minWidth=this.$ext.style.minWidth;
this.$altExt.style.maxWidth=this.$ext.style.maxWidth;}}if(this.$loadAml){this.$loadAml(this.$aml);
}};this.addEventListener("DOMNodeInsertedIntoDocument",f);this.addEventListener("$skinchange",f);
var f;this.addEventListener("$event.resize",f=function(c){apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.dispatchEvent('resize');",true);
apf.layout.queue(this.$ext);this.removeEventListener("$event.resize",f);});this.addEventListener("contextmenu",function(e){if(this.editable){e.returnValue=false;
e.cancelBubble=true;return false;}if(!this.contextmenus){return;}if(this.hasFeature(apf.__DATABINDING__)){var contextmenu;
var xmlNode=this.hasFeature(apf.__MULTISELECT__)?this.selected:this.xmlRoot;var i,l,m,isRef,sel,menuId,cm,result;
for(i=0,l=this.contextmenus.length;i<l;i++){isRef=(typeof(cm=this.contextmenus[i])=="string");
result=null;if(!isRef&&cm.match&&xmlNode){result=(cm.cmatch||(cm.cmatch=apf.lm.compile(cm.match,{xpathmode:3,injectself:true})))(xmlNode);
}if(isRef||xmlNode&&result||!cm.match){menuId=isRef?cm:cm.menu;if(!self[menuId]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+menuId+"'"),this.$aml);
return;}self[menuId].display(e.x,e.y,null,this,xmlNode);e.returnValue=false;e.cancelBubble=true;
break;}}}else{menuId=typeof this.contextmenus[0]=="string"?this.contextmenus[0]:this.contextmenus[0].getAttribute("menu");
if(!self[menuId]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+menuId+"'",this.$aml));
return;}self[menuId].display(e.x,e.y,null,this);e.returnValue=false;e.cancelBubble=true;
}});}).call(apf.GuiElement.prototype=new apf.AmlElement());apf.GuiElement.propHandlers={focussable:function(value){this.focussable=typeof value=="undefined"||value;
if(!this.hasFeature(apf.__FOCUSSABLE__)){this.implement(apf.Focussable);}if(this.focussable){apf.window.$addFocus(this,this.tabindex);
}else{apf.window.$removeFocus(this);}},zindex:function(value){this.$ext.style.zIndex=value;
},visible:function(value){if(apf.isFalse(value)||typeof value=="undefined"){if(this.$ext){this.$ext.style.display="none";
}if(apf.document.activeElement==this||this.canHaveChildren==2&&apf.isChildOf(this,apf.document.activeElement,false)){if(apf.config.allowBlur&&this.hasFeature(apf.__FOCUSSABLE__)){this.blur();
}else{apf.window.moveNext();}}this.visible=false;}else{if(this.$ext){this.$ext.style.display="";
if(!this.$ext.offsetHeight){this.$ext.style.display=this.$display||"block";}}if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);
}this.visible=true;}},disabled:function(value){if(!this.$drawn){var _self=this;
apf.queue.add("disable"+this.$uniqueId,function(e){_self.disabled=value;apf.GuiElement.propHandlers.disabled.call(_self,value);
});return;}else{apf.queue.remove("disable"+this.$uniqueId);}if(this.canHaveChildren){if(value!=-1){value=this.disabled=apf.isTrue(value);
}var nodes=this.childNodes;for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.nodeFunc==apf.NODE_VISIBLE){if(value&&node.disabled!=-1){node.$disabled=node.disabled||false;
}node.setProperty("disabled",value?-1:false);}}if(this.$isWindowContainer){return;
}}if(value==-1||value==false){}else{if(typeof this.$disabled=="boolean"){if(value===null){value=this.$disabled;
this.$disabled=null;}else{this.$disabled=value||false;return;}}}if(apf.isTrue(value)||value==-1){this.disabled=false;
if(apf.document.activeElement==this){apf.window.moveNext(true);if(apf.document.activeElement==this){this.$blur();
}}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,this.$baseCSSname+"Disabled");
}if(this.$disable){this.$disable();}this.disabled=value;}else{if(this.hasFeature(apf.__DATABINDING__)&&apf.config.autoDisable&&!(!this.$bindings||this.xmlRoot)){return false;
}this.disabled=false;if(apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,null,[this.$baseCSSname+"Disabled"]);
}if(this.$enable){this.$enable();}}},enabled:function(value){this.setProperty("disabled",!value);
},"disable-keyboard":function(value){this.disableKeyboard=apf.isTrue(value);},tooltip:function(value){this.$ext.setAttribute("title",value+(this.hotkey?" ("+this.hotkey+")":""));
},contextmenu:function(value){this.contextmenus=[value];},actiontracker:function(value){if(!value){this.$at=null;
}else{if(value.localName=="actiontracker"){this.$at=value;}else{this.$at=typeof value=="string"&&self[value]?apf.nameserver.get("actiontracker",value)||self[value].getActionTracker():apf.setReference(value,apf.nameserver.register("actiontracker",value,new apf.actiontracker()));
if(!this.$at.name){this.$at.name=value;}}}},aml:function(value){this.replaceMarkup(value);
}};apf.__PRESENTATION__=1<<9;apf.Presentation=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__PRESENTATION__;
this.$supportedProperties.push("skin");this.$propHandlers.skinset=this.$propHandlers.skin=function(value){if(!this.$amlLoaded){return;
}if(!this.$skinTimer){var _self=this;clearTimeout(this.$skinTimer);this.$skinTimer=$setTimeout(function(){changeSkin.call(_self,_self.skin);
delete _self.$skinTimer;});}};this.$propHandlers.style=function(value){if(!this.styleAttrIsObj&&this.$amlLoaded){this.$ext.setAttribute("style",value);
}};this.$propHandlers.border=function(value){if(!value){this.$ext.style.borderWidth="";
}else{this.$ext.style.borderWidth=apf.getBox(value).join("px ")+"px";}};this.$propHandlers.margin=function(value){if(!value){this.$ext.style.margin="";
}else{this.$ext.style.margin=apf.getBox(value).join("px ")+"px";}};this.$propHandlers["class"]=function(value){this.$setStyleClass(this.$ext,value,this.$lastClassValue?[this.$lastClassValue]:null);
this.$lastClassValue=value;};this.$forceSkinChange=function(skin,skinset){changeSkin.call(this,skin,skinset);
};function changeSkin(skin,skinset){clearTimeout(this.$skinTimer);if(this.selectable){var valueList=this.getSelection();
}var oExt=this.$ext,oInt=this.$int,pNode=this.$ext.parentNode,beforeNode=oExt.nextSibling,idExt=this.$ext.getAttribute("id"),idInt=this.$int&&this.$int.getAttribute("id"),oldBase=this.$baseCSSname;
if(oExt.parentNode){oExt.parentNode.removeChild(oExt);}if(this.$destroy){this.$destroy(true);
}this.skin=skin;this.$loadSkin(skinset?skinset+":"+skin:null);if(this.$draw){this.$draw(true);
}if(idExt){this.$ext.setAttribute("id",idExt);}if(beforeNode||pNode!=this.$ext.parentNode){pNode.insertBefore(this.$ext,beforeNode);
}var i,l,newclasses=[],classes=(oExt.className||"").splitSafe("\\s+");for(i=0;i<classes.length;
i++){if(classes[i]&&classes[i].indexOf(oldBase)!=0){newclasses.push(classes[i].replace(oldBase,this.$baseCSSname));
}}apf.setStyleClass(this.$ext,newclasses.join(" "));var en,ev=apf.skins.events;
for(i=0,l=ev.length;i<l;i++){en=ev[i];if(typeof oExt[en]=="function"&&!this.$ext[en]){this.$ext[en]=oExt[en];
}}this.$ext.style.left=oExt.style.left;this.$ext.style.top=oExt.style.top;this.$ext.style.width=oExt.style.width;
this.$ext.style.height=oExt.style.height;this.$ext.style.right=oExt.style.right;
this.$ext.style.bottom=oExt.style.bottom;this.$ext.style.zIndex=oExt.style.zIndex;
this.$ext.style.position=oExt.style.position;this.$ext.style.display=oExt.style.display;
if(idInt){this.$int.setAttribute("id",idInt);}if(this.$int&&this.$int!=oInt){var node,newNode=this.$int,nodes=oInt.childNodes;
for(var i=nodes.length-1;i>=0;i--){if((node=nodes[i]).host){node.host.$pHtmlNode=newNode;
if(node.host.$isLeechingSkin){setLeechedSkin.call(node.host);}}newNode.insertBefore(node,newNode.firstChild);
}}if(this.hasFeature(apf.__DRAGDROP__)){if(document.elementFromPointAdd){document.elementFromPointRemove(oExt);
document.elementFromPointAdd(this.$ext);}}if(this.disabled){this.$disable();}if(this.$focussable&&apf.document.activeElement==this){this.$focus();
}this.dispatchEvent("$skinchange",{ext:oExt,"int":oInt});if(this.hasFeature(apf.__DATABINDING__)&&this.xmlRoot){this.reload();
}else{if(this.value){this.$propHandlers.value.call(this,this.value);}}if(this.hasFeature(apf.__MULTISELECT__)){if(this.selectable){this.selectList(valueList,true);
}}if(!apf.hasSingleRszEvent){apf.layout.activateRules(this.$ext);if(this.$int){apf.layout.activateRules(this.$int);
}}if(this.draggable&&this.$propHandlers.draggable){this.$propHandlers.draggable.call(this,this.draggable);
}if(this.resizable&&this.$propHandlers.resizable){this.$propHandlers.resizable.call(this,this.resizable);
}apf.layout.forceResize(this.$ext);}this.$setStyleClass=apf.setStyleClass;function setLeechedSkin(e){if(!this.$amlLoaded||e&&(e.$isMoveWithinParent||e.currentTarget!=this||!e.$oldParent)){return;
}this.$setInheritedAttribute(this,"skinset");if(this.attributes.getNamedItem("skin")){return;
}var skinName,pNode=this.parentNode,skinNode;if((skinName=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&pNode.$originalNodes&&(skinNode=pNode.$originalNodes[skinName])&&skinNode.getAttribute("inherit")){var link=skinNode.getAttribute("link");
this.$isLeechingSkin=true;if(link){this.$forceSkinChange(link);}else{var skin=pNode.skinName.split(":");
this.$forceSkinChange(skin[1],skin[0]);}}else{if(this.$isLeechingSkin){delete this.skin;
this.$isLeechingSkin=false;this.$forceSkinChange();}}}this.$initSkin=function(x){if(this.$canLeechSkin){this.addEventListener("DOMNodeInserted",setLeechedSkin);
}if(!this.skin){this.skin=this.getAttribute("skin");}var skinName,pNode=this.parentNode,skinNode;
if(this.$canLeechSkin&&!this.skin&&(skinName=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&pNode.$originalNodes&&(skinNode=pNode.$originalNodes[skinName])&&skinNode.getAttribute("inherit")){var link=skinNode.getAttribute("link");
this.$isLeechingSkin=true;if(link){this.skin=link;this.$loadSkin();}else{this.$loadSkin(pNode.skinName);
}}else{if(!this.skinset){this.skinset=this.getAttribute("skinset");}this.$loadSkin(null,this.$canLeechSkin);
}};this.$loadSkin=function(skinName,noError){this.baseSkin=skinName||(this.skinset||this.$setInheritedAttribute("skinset"))+":"+(this.skin||this.localName);
clearTimeout(this.$skinTimer);if(this.skinName){this.$blur();this.$baseCSSname=null;
}this.skinName=this.baseSkin;this.$pNodes={};this.$originalNodes=apf.skins.getTemplate(this.skinName,true);
if(!this.$originalNodes){var skin=this.skin;if(skin){var skinset=this.skinName.split(":")[0];
this.baseName=this.skinName="default:"+skin;this.$originalNodes=apf.skins.getTemplate(this.skinName);
if(!this.$originalNodes&&skinset!="default"){this.baseName=this.skinName=skinset+":"+this.localName;
this.$originalNodes=apf.skins.getTemplate(this.skinName,true);}}if(!this.$originalNodes){this.baseName=this.skinName="default:"+this.localName;
this.$originalNodes=apf.skins.getTemplate(this.skinName);}if(!this.$originalNodes){if(noError){return(this.baseName=this.skinName=this.originalNode=null);
}throw new Error(apf.formatErrorString(1077,this,"Presentation","Could not load skin: "+this.baseSkin));
}}if(this.$originalNodes){apf.skins.setSkinPaths(this.skinName,this);}};this.$getNewContext=function(type,amlNode){if(type!=type.toLowerCase()){throw new Error("Invalid layout node name ('"+type+"'). lowercase required");
}if(!this.$originalNodes[type]){throw new Error(apf.formatErrorString(0,this,"Getting new skin item","Missing node in skin description '"+type+"'"));
}this.$pNodes[type]=this.$originalNodes[type].cloneNode(true);};this.$hasLayoutNode=function(type){if(type!=type.toLowerCase()){throw new Error("Invalid layout node name ('"+type+"'). lowercase required");
}return this.$originalNodes[type]?true:false;};this.$getLayoutNode=function(type,section,htmlNode){if(type!=type.toLowerCase()){throw new Error("Invalid layout node name ('"+type+"'). lowercase required");
}if(!this.$pNodes){throw new Error("Skin not loaded for :"+this.serialize(true));
}var node=this.$pNodes[type]||this.$originalNodes[type];if(!node){if(!this.$dcache){this.$dcache={};
}if(!this.$dcache[type+"."+this.skinName]){this.$dcache[type+"."+this.skinName]=true;
apf.console.info("Could not find node '"+type+"' in '"+this.skinName+"'","skin");
}return false;}if(!section){return htmlNode||apf.getFirstElement(node);}var textNode=node.getAttribute(section);
if(!textNode){return null;}return(htmlNode?apf.queryNode(htmlNode,textNode):apf.getFirstElement(node).selectSingleNode(textNode));
};this.$getOption=function(type,section){type=type.toLowerCase();var node=this.$pNodes[type]||this.$originalNodes[type];
if(!section||!node){return node;}var option=node.selectSingleNode("@"+section);
return option?option.nodeValue:"";};this.$getExternal=function(tag,pNode,func,aml){if(!pNode){pNode=this.$pHtmlNode;
}if(!tag){tag="main";}tag=tag.toLowerCase();this.$getNewContext(tag);var oExt=this.$getLayoutNode(tag);
var node;if(node=(aml||this).getAttributeNode("style")){oExt.setAttribute("style",node.nodeValue);
}if(func){func.call(this,oExt);}oExt=apf.insertHtmlNode(oExt,pNode);oExt.host=this;
if(node=(aml||this).getAttributeNode("bgimage")){oExt.style.backgroundImage="url("+apf.getAbsolutePath(this.mediaPath,node.nodeValue)+")";
}if(!this.$baseCSSname){this.$baseCSSname=oExt.className.trim().split(" ")[0];}return oExt;
};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");
};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext){return;
}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$fixScrollBug=function(){if(this.$int!=this.$ext){this.oFocus=this.$int;
}else{this.oFocus=this.$int=this.$ext.appendChild(document.createElement("div"));
this.$int.style.height="100%";this.$int.className="focusbug";}};}).call(apf.Presentation.prototype=new apf.GuiElement());
apf.config.$inheritProperties.skinset=1;apf.__VALIDATION__=1<<6;apf.validator={macro:{datatype:"apf.xsd.matchType(value, '",datatype_:"')",pattern:"value.match(",pattern_:")",custom:"(",custom_:")",min:"parseInt(value) >= ",max:"parseInt(value) <= ",maxlength:"value.toString().length <= ",minlength:"value.toString().length >= ",notnull:"value.toString().length > 0",checkequal:"!(temp = ",checkequal_:").isValid() || temp.getValue() == value"},compile:function(options){var m=this.macro,s=["var temp, valid = true;             if (!validityState)                 validityState = new apf.validator.validityState(); "];
if(options.required){s.push("if (checkRequired && (!value || value.toString().trim().length == 0)) {                validityState.$reset();                validityState.valueMissing = true;                valid = false;            }");
}s.push("validityState.$reset();            if (value) {");for(prop in options){if(!m[prop]){continue;
}s.push("if (!(",m[prop],options[prop],m[prop+"_"]||"",")){                validityState.$set('",prop,"');                valid = false;            }");
}s.push("};validityState.valid = valid; return validityState;");return new Function("value","checkRequired","validityState",s.join(""));
}};apf.validator.validityState=function(){this.valueMissing=false,this.typeMismatch=false,this.patternMismatch=false,this.tooLong=false,this.rangeUnderflow=false,this.rangeOverflow=false,this.stepMismatch=false,this.customError=false,this.valid=true,this.$reset=function(){for(var prop in this){if(prop.substr(0,1)=="$"){continue;
}this[prop]=false;}this.valid=true;},this.$set=function(type){switch(type){case"min":this.rangeUnderflow=true;
break;case"max":this.rangeOverflow=true;break;case"minlength":this.tooShort=true;
break;case"maxlength":this.tooLong=true;break;case"pattern":this.patternMismatch=true;
break;case"datatype":this.typeMismatch=true;break;case"notnull":this.typeMismatch=true;
break;case"checkequal":this.typeMismatch=true;break;}};};apf.Validation=function(){this.$regbase=this.$regbase|apf.__VALIDATION__;
this.isValid=function(checkRequired){if(!this.$vOptions){return true;}(this.$vOptions.isValid||(this.$vOptions.isValid=apf.validator.compile(this.$vOptions))).call(this,typeof this.getValue=="function"?this.getValue(null,true):null,checkRequired,this.validityState||(this.validityState=new apf.validator.validityState()));
var valid=this.validityState.valid;this.dispatchEvent(!valid?"invalid":"valid",this.validityState);
return valid;};this.setCustomValidity=function(message){};this.showMe=function(){var p=this.parentNode;
while(p){if(p.show){p.show();}p=p.parentNode;}};this.checkValidity=this.validate=function(ignoreReq,nosetError,force){if(force||!this.isValid(!ignoreReq)&&!nosetError){this.setError();
return false;}else{this.clearError();return true;}};this.setError=function(value){if(!this.$validgroup){this.$propHandlers.validgroup.call(this,"vg"+this.parentNode.$uniqueId);
}var errBox=this.$validgroup.getErrorBox(this);if(!this.$validgroup.allowMultipleErrors){this.$validgroup.hideAllErrors();
}errBox.setMessage(this.invalidmsg||value);apf.setStyleClass(this.$ext,this.$baseCSSname+"Error");
this.showMe();if(this.invalidmsg||value){errBox.display(this);}if(this.hasFeature(apf.__MULTISELECT__)&&this.validityState.$errorXml){this.select(this.validityState.$errorXml);
}if(apf.document.activeElement&&apf.document.activeElement!=this){this.focus(null,{mouse:true});
}};this.clearError=function(value){if(this.$setStyleClass){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Error"]);
}if(this.$validgroup){var errBox=this.$validgroup.getErrorBox(null,true);if(!errBox||errBox.host!=this){return;
}errBox.hide();}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){if(this.$validgroup){this.$validgroup.unregister(this);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.validgroup){this.$setInheritedAttribute("validgroup");
}});this.$attrExcludePropBind=apf.extend({pattern:1,validtest:3},this.$attrExcludePropBind);
this.$booleanProperties.required=true;this.$supportedProperties.push("validgroup","required","datatype","pattern","min","max","maxlength","minlength","validtest","notnull","checkequal","invalidmsg","requiredmsg");
this.$fValidate=function(){if(this.liveedit){return;}if(!this.$validgroup){this.validate(true);
}else{var errBox=this.$validgroup.getErrorBox(this);if(!errBox.visible||errBox.host!=this){this.validate(true);
}}};this.addEventListener("blur",this.$fValidate);this.$propHandlers.validgroup=function(value){if(value){var vgroup;
if(typeof value!="string"){this.$validgroup=value.name;vgroup=value;}else{vgroup=apf.nameserver.get("validgroup",value);
}this.$validgroup=vgroup||new apf.ValidationGroup(value);this.$validgroup.register(this);
}else{this.$validgroup.unregister(this);this.$validgroup=null;}};this.$propHandlers.pattern=function(value,prop){if(value.substr(0,1)!="/"){value="/"+value+"/";
}(this.$vOptions||(this.$vOptions={}))[prop]=value;delete this.$vOptions.isValid;
};this.$propHandlers.datatype=this.$propHandlers.required=this.$propHandlers.custom=this.$propHandlers.min=this.$propHandlers.max=this.$propHandlers.maxlength=this.$propHandlers.minlength=this.$propHandlers.notnull=this.$propHandlers.checkequal=function(value,prop){(this.$vOptions||(this.$vOptions={}))[prop]=value;
delete this.$vOptions.isValid;};this.$propHandlers.validtest=function(value){var _self=this,rvCache={};
this.removeValidationCache=function(){rvCache={};};this.$checkRemoteValidation=function(){var value=this.getValue();
if(typeof rvCache[value]=="boolean"){return rvCache[value];}if(rvCache[value]==-1){return true;
}rvCache[value]=-1;apf.getData(this.validtest.toString(),{xmlNode:this.xmlRoot,value:this.getValue(),callback:function(data,state,extra){if(state!=apf.SUCCESS){if(state==apf.TIMEOUT&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}else{var commError=new Error(apf.formatErrorString(0,_self,"Validating entry at remote source","Communication error: \n\n"+extra.message));
if(_self.dispatchEvent("error",apf.extend({error:commError,state:status},extra))!==false){throw commError;
}return;}}rvCache[value]=apf.isTrue(data);if(!rvCache[value]){if(!_self.hasFocus()){_self.setError();
}}else{_self.clearError();}}});return true;};(this.$vOptions||(this.$vOptions={})).custom="apf.lookup("+this.$uniqueId+").$checkRemoteValidation()";
delete this.$vOptions.isValid;};};apf.GuiElement.propHandlers.datatype=apf.GuiElement.propHandlers.required=apf.GuiElement.propHandlers.pattern=apf.GuiElement.propHandlers.min=apf.GuiElement.propHandlers.max=apf.GuiElement.propHandlers.maxlength=apf.GuiElement.propHandlers.minlength=apf.GuiElement.propHandlers.notnull=apf.GuiElement.propHandlers.checkequal=apf.GuiElement.propHandlers.validtest=function(value,prop){this.implement(apf.Validation);
this.$propHandlers[prop].call(this,value,prop);};apf.ValidationGroup=function(name){this.$init();
this.childNodes=[];if(name){apf.setReference(name,this);}this.name=name||"validgroup"+this.$uniqueId;
apf.nameserver.register("validgroup",this.name,this);};(function(){this.validateVisibleOnly=false;
this.allowMultipleErrors=false;this.register=function(o){if(o.hasFeature(apf.__VALIDATION__)){this.childNodes.push(o);
}};this.unregister=function(o){this.childNodes.remove(o);};this.toString=function(){return"[APF Validation Group]";
};var errbox;this.getErrorBox=function(o,no_create){if(this.allowMultipleErrors||!errbox&&!no_create){errbox=new apf.errorbox();
errbox.$pHtmlNode=o.$ext.parentNode;errbox.skinset=apf.getInheritedAttribute(o.parentNode,"skinset");
errbox.dispatchEvent("DOMNodeInsertedIntoDocument");}return errbox;};this.hideAllErrors=function(){if(errbox&&errbox.host){errbox.host.clearError();
}};function checkValidChildren(oParent,ignoreReq,nosetError){var found;for(var v,i=0;
i<oParent.childNodes.length;i++){var oEl=oParent.childNodes[i];if(!oEl){continue;
}if(!oEl.disabled&&(!this.validateVisibleOnly&&oEl.visible||!oEl.$ext||oEl.$ext.offsetHeight)&&(oEl.hasFeature(apf.__VALIDATION__)&&oEl.isValid&&!oEl.isValid(!ignoreReq))){if(!nosetError){if(!found){oEl.validate(true,null,true);
found=true;if(!this.allowMultipleErrors){return true;}}else{if(oEl.errBox&&oEl.errBox.host==oEl){oEl.errBox.hide();
}}}else{if(!this.allowMultipleErrors){return true;}}}if(oEl.canHaveChildren&&oEl.childNodes.length){found=checkValidChildren.call(this,oEl,ignoreReq,nosetError)||found;
if(found&&!this.allowMultipleErrors){return true;}}}return found;}this.checkValidity=this.validate=this.isValid=function(ignoreReq,nosetError,page){var found=checkValidChildren.call(this,page||this,ignoreReq,nosetError);
if(page){try{if(page.validation&&!eval(page.validation)){alert(page.invalidmsg);
found=true;}}catch(e){throw new Error(apf.formatErrorString(0,this,"Validating Page","Error in javascript validation string of page: '"+page.validation+"'",page.$aml));
}}return !found;};}).call(apf.ValidationGroup.prototype=new apf.Class());apf.config.$inheritProperties.validgroup=1;
apf.__DATABINDING__=1<<1;apf.DataBinding=function(){this.$init(true);this.$loadqueue=this.$dbTimer=null;
this.$regbase=this.$regbase|apf.__DATABINDING__;this.$mainBind="value";this.$bindings=this.$cbindings=this.$attrBindings=false;
this.$attrExcludePropBind=apf.extend({model:1,each:1},this.$attrExcludePropBind);
this.setQueryValue=function(xpath,value,type){var node=apf.createNodeFromXpath(this[type||"xmlRoot"],xpath);
if(!node){return null;}apf.setNodeValue(node,value,true);return node;};this.queryValue=function(xpath,type){return apf.queryValue(this[type||"xmlRoot"],xpath);
};this.queryValues=function(xpath,type){return apf.queryValues(this[type||"xmlRoot"],xpath);
};this.queryNode=function(xpath,type){var n=this[type||"xmlRoot"];return n?n.selectSingleNode(xpath):null;
};this.queryNodes=function(xpath,type){var n=this[type||"xmlRoot"];return n?n.selectNodes(xpath):[];
};this.$checkLoadQueue=function(){if(this.$loadqueue){if(!this.caching){this.xmlRoot=null;
}var q=this.load(this.$loadqueue[0],{cacheId:this.$loadqueue[1]});if(!q||q.dataType!=apf.ARRAY||q!=this.$loadqueue){this.$loadqueue=null;
}}else{return false;}};this.$execProperty=function(prop,xmlNode,undoObj){var attr=this.$attrBindings[prop];
if(this.nodeType==7){if(xmlNode!=this.xmlRoot){this.xmlRoot=xmlNode;}}if(!attr){apf.console.error("Could not find attribute handler for property '"+prop+"' on "+this.localName+":"+(this.id||""));
return;}apf.$lm_has_lang=false;if(attr.cvalue.asyncs){var _self=this;return attr.cvalue.call(this,xmlNode,function(value){_self.setProperty(prop,value,true);
if(apf.$lm_has_lang){apf.language.addProperty(this,prop,attr.cvalue);}});}else{var value=attr.cvalue.call(this,xmlNode);
}this.setProperty(prop,undoObj&&undoObj.extra.range||value,true);if(apf.$lm_has_lang){apf.language.addProperty(this,prop,attr.cvalue);
}};this.$applyBindRule=function(name,xmlNode,defaultValue,callback,oHtml){var handler=this.$attrBindings[name]&&this.$attrBindings[name].cvalue||this.$cbindings[name];
return handler?handler.call(this,xmlNode,callback):defaultValue||"";};this.addEventListener("$clear",function(){var queue;
if(!this.$amlBindQueue||!(queue=this.$amlBindQueue.caption)){return;}for(var id in queue){var lm=queue[id];
if(lm.destroy){lm.parentNode=lm.$focusParent=lm.$model=lm.xmlRoot=null;lm.destroy();
}delete queue[id];}});var afterloadUpdate;this.addEventListener("afterload",afterloadUpdate=function(){var queue;
if(!this.$amlBindQueue||!(queue=this.$amlBindQueue.caption||this.$amlBindQueue.column)){return;
}var div,doc=this.ownerDocument;for(var lm,i=0,l=queue.length;i<l;i++){if(!queue[i]){continue;
}div=document.getElementById("placeholder_"+this.$uniqueId+"_"+i);lm=doc.createProcessingInstruction("lm",this.$cbindings.caption||this.$cbindings.column);
lm.$model=this.$model;lm.xmlRoot=queue[i];lm.$noInitModel=true;lm.$focusParent=this;
lm.parentNode=this;lm.dispatchEvent("DOMNodeInsertedIntoDocument",{pHtmlNode:div});
queue[lm.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)]=lm;delete queue[i];}queue.length=0;
});this.addEventListener("xmlupdate",function(e){if(e.xmlNode!=e.traverseNode){return;
}if("insert|add|synchronize|move".indexOf(e.action)>-1){afterloadUpdate.call(this,e);
}else{if("remove|move-away".indexOf(e.action)>-1){var queue;if(!this.$amlBindQueue||!(queue=this.$amlBindQueue.caption)){return;
}var lm=queue[e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)];lm.parentNode=lm.$focusParent=lm.$model=lm.xmlRoot=null;
lm.destroy();}}});this.$hasBindRule=function(name){return this.$attrBindings[name]||this.$bindings&&this.$bindings[name];
};this.$getBindRule=function(name,xmlNode){return this.$attrBindings[name]||this.$bindings&&this.$bindings.getRule(name,xmlNode);
};var ruleIsMatch={drag:1,drop:1,dragcopy:1};this.$getDataNode=function(name,xmlNode,createNode,ruleList,multiple){var node,rule=this.$attrBindings[name];
if(rule){if(rule.cvalue.type!=3){return false;}var func=rule.cvalue2||rule.compile("value",{xpathmode:multiple?4:3,parsecode:1,injectself:ruleIsMatch[name]});
if(func&&(node=func(xmlNode,createNode))){if(ruleList){ruleList.push(rule);}return node;
}return false;}return this.$bindings&&this.$bindings.getDataNode(name,xmlNode,createNode,ruleList,multiple);
};this.setModel=function(model){this.setAttribute("model",model,false,true);};this.getModel=function(doRecur){if(doRecur&&!this.$model){return this.dataParent?this.dataParent.parent.getModel(true):null;
}return this.$model;};this.reload=this.reload||function(){this.load(this.xmlRoot,{cacheId:this.cacheId,force:true});
};this.load=function(xmlNode,options){if(options){var cacheId=options.cacheId,forceNoCache=options.force,noClearMsg=options.noClearMsg;
}if(cacheId&&cacheId==this.cacheId&&!forceNoCache){return;}if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();
}if(xmlNode){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){xmlNode=apf.getXmlDom(xmlNode).documentElement;
}else{return apf.model.prototype.$loadFrom.call(this,xmlNode,options);}}else{if(xmlNode.nodeType==9){xmlNode=xmlNode.documentElement;
}else{if(xmlNode.nodeType==3||xmlNode.nodeType==4){xmlNode=xmlNode.parentNode;}else{if(xmlNode.nodeType==2){xmlNode=xmlNode.ownerElement||xmlNode.parentNode||xmlNode.selectSingleNode("..");
}}}}}if(this.$preventDataLoad||!this.$canLoadData&&((!this.$bindings&&(!this.$canLoadDataAttr||!this.each))||!this.$amlLoaded)&&(!this.hasFeature(apf.__MULTISELECT__)||!this.each)||this.$canLoadData&&!this.$canLoadData()){if(!this.caching||!this.hasFeature(apf.__CACHE__)){this.xmlRoot=xmlNode;
this.setProperty("root",this.xmlRoot);}if(this.$amlLoaded&&!this.$attrBindings){apf.console.warn("Could not load data yet in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName)+". The loaded data is queued until smartbinding rules are loaded or set manually.");
}return this.$loadqueue=[xmlNode,cacheId];}if(this.dataParent&&this.dataParent.xpath){this.dataParent.parent.signalXmlUpdate[this.$uniqueId]=!xmlNode;
}if(!xmlNode&&(!cacheId||!this.$isCached||!this.$isCached(cacheId))){apf.console.warn("No xml root node was given to load in "+this.localName+"["+(this.name||"")+"]. Clearing any loaded xml in this component");
this.clear(noClearMsg);if(apf.config.autoDisable&&this.$createModel===false){this.setProperty("disabled",true);
}return;}if(!this.caching&&!forceNoCache&&xmlNode&&!this.$loadqueue&&xmlNode==this.xmlRoot){return;
}var disabled=this.disabled;this.disabled=false;if(this.dispatchEvent("beforeload",{xmlNode:xmlNode})===false){return false;
}apf.console.info("Loading XML data in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName));
this.clear(true,true);this.cacheId=cacheId;if(this.dispatchEvent("$load",{forceNoCache:forceNoCache,xmlNode:xmlNode})===false){return;
}this.documentId=apf.xmldb.getXmlDocId(xmlNode);this.xmlRoot=xmlNode;this.setProperty("root",this.xmlRoot);
apf.$lm_has_lang=false;this.$load(xmlNode);if(apf.$lm_has_lang){apf.language.addBinding(this);
}else{apf.language.removeBinding(this);}this.$loadSubData(xmlNode);if(this.$createModel===false){this.disabled=true;
this.setProperty("disabled",false);}else{this.disabled=disabled;}this.dispatchEvent("afterload",{xmlNode:xmlNode});
};this.$loadSubData=function(xmlRootNode){if(this.$hasLoadStatus(xmlRootNode)&&!this.$hasLoadStatus(xmlRootNode,"potential")){return;
}var rule=this.$getBindRule("load",xmlRootNode);if(rule&&(!rule[1]||rule[1](xmlRootNode))){if(typeof apf.offline!="undefined"&&!apf.offline.onLine){apf.offline.transactions.actionNotAllowed();
this.$loadedWhenOffline=true;if(this.$setClearMessage&&!this.getTraverseNodes().length){this.$setClearMessage(this["offline-message"],"offline");
}return;}this.$setLoadStatus(xmlRootNode,"loading");if(this.$setClearMessage){this.$setClearMessage(this["loading-message"],"loading");
}var mdl=this.getModel(true);if(!mdl){throw new Error("Could not find model");}var amlNode=this;
if(mdl.$insertFrom(rule.getAttribute("get"),{xmlNode:xmlRootNode,insertPoint:xmlRootNode,amlNode:this,callback:function(){amlNode.setProperty(amlNode.hasFeature(apf.__MULTISELECT__)?"selected":"root",xmlRootNode);
}})===false){this.clear(true);if(apf.config.autoDisable){this.setProperty("disabled",true);
}}}};this.clear=function(nomsg,doEvent,fakeClear){if(!this.$container){return;}if(this.clearSelection){this.clearSelection(true);
}var lastHeight=this.$container.offsetHeight;if(this.dispatchEvent("$clear")!==false){this.$container.innerHTML="";
}if(typeof nomsg=="string"){var msgType=nomsg;nomsg=false;if(!this[msgType+"-message"]){this.$setInheritedAttribute(msgType+"-message");
}}this.$lastClearType=msgType||null;if(!nomsg&&this.$setClearMessage){this.$setClearMessage(msgType?this[msgType+"-message"]:this["empty-message"],msgType||"empty",lastHeight);
}else{if(this.$removeClearMessage){this.$removeClearMessage();}}if(!fakeClear){this.documentId=this.xmlRoot=this.cacheId=null;
}if(!nomsg){if(this.hasFeature(apf.__MULTISELECT__)){this.setProperty("length",0);
}}};this.clearMessage=function(msg){this.customMsg=msg;this.clear("custom");};this.$setLoadStatus=function(xmlNode,state,remove){var group=this.loadgroup||"default";
var re=new RegExp("\\|(\\w+)\\:"+group+":(\\d+)\\|");var loaded=xmlNode.getAttribute("a_loaded")||"";
var m;if(!remove&&(m=loaded.match(re))&&m[1]!="potential"&&m[2]!=this.$uniqueId){return;
}var ostatus=loaded.replace(re,"");if(!remove){ostatus+="|"+state+":"+group+":"+this.$uniqueId+"|";
}xmlNode.setAttribute("a_loaded",ostatus);};this.$removeLoadStatus=function(xmlNode){this.$setLoadStatus(xmlNode,null,true);
};this.$hasLoadStatus=function(xmlNode,state,unique){var ostatus=xmlNode.getAttribute("a_loaded");
if(!ostatus){return false;}var group=this.loadgroup||"default";var re=new RegExp("\\|"+(state||"\\w+")+":"+group+":"+(unique?this.$uniqueId:"\\d+")+"\\|");
return ostatus.match(re)?true:false;};this.insert=function(xmlNode,options){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){xmlNode=apf.getXmlDom(xmlNode).documentElement;
}else{if(!options.insertPoint){options.insertPoint=this.xmlRoot;}return apf.model.prototype.$insertFrom.call(this,xmlNode,options);
}}var insertPoint=options.insertPoint||this.xmlRoot;if(this.dispatchEvent("beforeinsert",{xmlParentNode:insertPoint})===false){return false;
}if(typeof options.copyAttributes=="undefined"){options.copyAttributes=true;}var newNode=apf.mergeXml(xmlNode,insertPoint,options);
apf.xmldb.applyChanges("insert",insertPoint);if(this.selectable&&this.autoselect){if(this.xmlNode==newNode){this.$selectDefault(this.xmlNode);
}}else{if(this.xmlNode==newNode){this.setProperty("root",this.xmlNode);}}if(this.$hasLoadStatus(insertPoint,"loading")){this.$setLoadStatus(insertPoint,"loaded");
}this.dispatchEvent("afterinsert");};this.$booleanProperties["render-root"]=true;
this.$supportedProperties.push("empty-message","loading-message","offline-message","render-root","smartbinding","bindings","actions");
this.$propHandlers["render-root"]=function(value){this.renderRoot=value;};this.$propHandlers["empty-message"]=function(value){this["empty-message"]=value;
if(this.$updateClearMessage){this.$updateClearMessage(this["empty-message"],"empty");
}};this.$propHandlers["loading-message"]=function(value){this["loading-message"]=value;
if(this.$updateClearMessage){this.$updateClearMessage(this["loading-message"],"loading");
}};this.$propHandlers["offline-message"]=function(value){this["offline-message"]=value;
if(this.$updateClearMessage){this.$updateClearMessage(this["offline-message"],"offline");
}};this.$propHandlers.smartbinding=this.$propHandlers.actions=this.$propHandlers.bindings=function(value,prop){var local="$"+prop+"Element";
if(this[local]){this[local].unregister(this);}if(!value){return;}if(!apf.nameserver.get(prop,value)){throw new Error(apf.formatErrorString(1064,this,"Setting "+prop,"Could not find "+prop+" by name '"+value+"'"));
}apf.nameserver.get(prop,value).register(this);if(prop!="actions"&&this.$checkLoadQueue()===false&&this.$amlLoaded){1+1;
}};var eachBinds={caption:1,icon:1,select:1,css:1,sort:1,drop:2,drag:2,dragcopy:2,eachvalue:1};
this.$addAttrBind=function(prop,fParsed,expression){if(fParsed.models){if(this.hasFeature(apf.__MULTISELECT__)){if(eachBinds[prop]){}}}var i,xpath,modelId,model,paths=fParsed.xpaths,list={};
for(i=0;i<paths.length;i+=2){if(!list[(modelId=paths[i])]){list[modelId]=1;}else{list[modelId]++;
}}if(!this.$propsUsingMainModel){this.$propsUsingMainModel={};}var rule=(this.$attrBindings||(this.$attrBindings={}))[prop]={cvalue:fParsed,value:expression,compile:apf.BindingRule.prototype.$compile,models:[]};
delete this.$propsUsingMainModel[prop];for(xpath,i=0;i<paths.length;i+=2){modelId=paths[i];
if(list[modelId]==-1){continue;}xpath=paths[i+1];if(modelId=="#"||xpath=="#"){var m=(rule.cvalue3||(rule.cvalue3=apf.lm.compile(rule.value,{xpathmode:5})))(this.xmlRoot);
if(typeof m!="string"){model=m.model&&m.model.$isModel&&m.model;if(model){xpath=m.xpath;
}else{if(m.model){model=typeof m.model=="string"?apf.xmldb.findModel(m.model):m.model;
xpath=apf.xmlToXpath(m.model,model.data)+(m.xpath?"/"+m.xpath:"");}else{this.addEventListener("prop."+prop,function(e){var m=(rule.cvalue3||(rule.cvalue3=apf.lm.compile(rule.value,{xpathmode:5})))(this.xmlRoot);
if(m.model){this.removeEventListener("prop."+prop,arguments.callee);var _self=this;
setTimeout(function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,expression);
},10);}});continue;}}}else{model=null;}}else{model=null;}if(!model){if(modelId){model=apf.nameserver.get("model",modelId)||apf.setReference(modelId,apf.nameserver.register("model",modelId,new apf.model()));
}else{if(!this.$model&&!this.$initingModel){initModel.call(this);}model=this.$model;
if(!this.hasFeature(apf.__MULTISELECT__)&&eachBinds[prop]!=2||!eachBinds[prop]){this.$propsUsingMainModel[prop]={xpath:xpath,optimize:list[modelId]==1};
}}}if(model&&(!this.hasFeature(apf.__MULTISELECT__)&&eachBinds[prop]!=2||!eachBinds[prop])){model.$bindXmlProperty(this,prop,xpath,list[modelId]==1);
rule.models.push(model);}list[modelId]=-1;}rule.xpath=xpath;this.$canLoadDataAttr=eachBinds[prop]==1;
this.$checkLoadQueue();};this.$removeAttrBind=function(prop){var rule=this.$attrBindings[prop];
if(!rule){return;}delete this.$attrBindings[prop];delete this.$propsUsingMainModel[prop];
var models=rule.models;if(models.length){for(var i=0;i<models.length;i++){models[i].$unbindXmlProperty(this,prop);
}}else{if(this.$model){this.$model.$unbindXmlProperty(this,prop);}}};this.$initingModel;
function initModel(){this.$initingModel=true;this.$setInheritedAttribute("model");
}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.model&&this.$setClearMessage&&!this.value){this.$setClearMessage(this["empty-message"],"empty");
}this.$amlLoaded=true;this.$checkLoadQueue();});this.addEventListener("DOMNodeRemovedFromDocument",function(e){apf.language.removeBinding(this);
});this.$propHandlers.model=function(value){if(!value&&!this.$modelParsed){if(this.$model){this.clear();
this.$model.unregister(this);this.$model=null;this.lastModelId="";}else{if(this.dataParent){this.dataParent.parent=null;
}}return;}this.$initingModel=true;var fParsed;if((fParsed=this.$modelParsed)&&fParsed.type!=2){var found,pb=fParsed.props;
if(this.dataParent){this.dataParent=null;}for(var prop in pb){if(typeof pb[prop]=="function"){continue;
}this.dataParent={parent:self[prop.split(".")[0]],xpath:null,model:this.$modelParsed.instruction};
found=true;break;}if(found){if(this.dataParent&&!this.dataParent.signalXmlUpdate){this.dataParent.signalXmlUpdate={};
}}this.$modelParsed=null;}var model;if(typeof value=="object"){if(value.dataType==apf.ARRAY){model=apf.nameserver.get("model",value[0]);
model.register(this,value[1]);return;}else{if(value.$isModel){model=value;value=this.model=model.name;
if(!value){model.setProperty("id",value=this.model="model"+model.$uniqueId);}}else{if(this.dataParent){this.model=this.dataParent.model;
}model=apf.xmldb.findModel(value);if(!model){return;}var xpath=apf.xmlToXpath(value,null,true)||".";
if(model.queryNode(xpath)!=value){throw new Error("xml data node is not attached to model ("+xpath+") : "+value+":"+(value&&value.xml));
}model.register(this,xpath);return;}}}else{if(value.indexOf("[::")>-1){var model,pNode=this;
do{pNode=pNode.parentNode;model=pNode.getAttribute("model");}while(pNode.parentNode&&pNode.parentNode.nodeType==1&&(!model||model==value));
if(model&&typeof model=="object"){model=model.id;}this.$inheritProperties.model=3;
if(model){value=value.replace(/\[\:\:/g,"["+model+"::");}else{apf.console.warn("No found model on any of the parents for this element while trying to overload model: "+value);
return;}}}clearTimeout(this.$dbTimer);if(!this.$amlLoaded&&this.nodeType==1){var _self=this;
this.$dbTimer=$setTimeout(function(){if(!_self.$amlDestroyed){apf.setModel(value,_self);
}});}else{apf.setModel(value,this);}};this.$propHandlers.viewport=function(value){if(value!="virtual"){return;
}this.implement(apf.VirtualViewport);};};apf.DataBinding.prototype=new apf[apf.Presentation?"Presentation":"AmlElement"]();
apf.config.$inheritProperties.model=1;apf.config.$inheritProperties["empty-message"]=1;
apf.config.$inheritProperties["loading-message"]=1;apf.config.$inheritProperties["offline-message"]=1;
apf.config.$inheritProperties.noloading=1;apf.Init.run("databinding");apf.MultiselectBinding=function(){if(!this.setQueryValue){this.implement(apf.DataBinding);
}this.$regbase=this.$regbase|apf.__MULTISELECT__;this.$init(function(){this.$selectTimer={};
});};(function(){this.length=0;this.$attrExcludePropBind=apf.extend({caption:2,icon:2,eachvalue:2,select:2,css:2,sort:2,drag:2,drop:2,dragcopy:2,selected:3,each:1,selection:3,"selection-unique":3,"selection-constructor":3},this.$attrExcludePropBind);
this.resort=function(options,clear,noReload){if(!this.$sort){this.$sort=new apf.Sort();
}this.$sort.set(options,clear);if(this.clearAllCache){this.clearAllCache();}if(noReload){return;
}var _self=this;(function sortNodes(xmlNode,htmlParent){if(!xmlNode){return;}var sNodes=_self.$sort.apply(apf.getArrayFromNodelist(xmlNode.selectNodes(_self.each)));
for(var i=0;i<sNodes.length;i++){if(_self.$isTreeArch||_self.$withContainer){var htmlNode=apf.xmldb.findHtmlNode(sNodes[i],_self);
if(!_self.$findContainer){throw new Error(apf.formatErrorString(_self,"Sorting Nodes","This component does not                              implement _self.$findContainer"));
}var container=_self.$findContainer(htmlNode);htmlParent.appendChild(htmlNode);
if(!apf.isChildOf(htmlNode,container,true)){htmlParent.appendChild(container);}sortNodes(sNodes[i],container);
}else{htmlParent.appendChild(apf.xmldb.findHtmlNode(sNodes[i],_self));}}})(this.xmlRoot,this.$container);
return options;};this.toggleSortOrder=function(){return this.resort({ascending:!this.$sort.get().ascending}).ascending;
};this.getSortSettings=function(){return this.$sort.get();};this.getTraverseNodes=function(xmlNode){if(!this.each){throw new Error("Could not render bound data. Missing 'each' rule for "+this.localName+(this.id&&"["+this.id+"]"||""));
}if(this.$sort){var nodes=apf.getArrayFromNodelist((xmlNode||this.xmlRoot).selectNodes(this.each));
return this.$sort.apply(nodes);}return(xmlNode||this.xmlRoot).selectNodes(this.each);
};this.getFirstTraverseNode=function(xmlNode){if(this.$sort){var nodes=(xmlNode||this.xmlRoot).selectNodes(this.each);
return this.$sort.apply(nodes)[0];}return(xmlNode||this.xmlRoot).selectSingleNode(this.each);
};this.getLastTraverseNode=function(xmlNode){var nodes=this.getTraverseNodes(xmlNode||this.xmlRoot);
return nodes[nodes.length-1];};this.isTraverseNode=function(xmlNode){var nodes=this.getTraverseNodes(this.getTraverseParent(xmlNode)||this.xmlRoot);
for(var i=0;i<nodes.length;i++){if(nodes[i]==xmlNode){return true;}}return false;
};this.getNextTraverseSelected=function(xmlNode,up,count){if(!xmlNode){xmlNode=this.selected;
}if(!count){count=1;}var i=0;var nodes=this.getTraverseNodes(this.getTraverseParent(xmlNode)||this.xmlRoot);
while(nodes[i]&&nodes[i]!=xmlNode){i++;}var node=(up==null)?nodes[i+count]||nodes[i-count]:(up?nodes[i+count]:nodes[i-count]);
return node||count&&(i<count||(i+1)>Math.floor(nodes.length/count)*count)?node:(up?nodes[nodes.length-1]:nodes[0]);
};this.getNextTraverse=function(xmlNode,up,count){if(!count){count=1;}if(!xmlNode){xmlNode=this.selected;
}var i=0;var nodes=this.getTraverseNodes(this.getTraverseParent(xmlNode)||this.xmlRoot);
while(nodes[i]&&nodes[i]!=xmlNode){i++;}return nodes[i+(up?-1*count:count)];};this.getTraverseParent=function(xmlNode){if(!xmlNode.parentNode||xmlNode==this.xmlRoot){return false;
}if(xmlNode.$regbase){return xmlNode.parentNode;}var x,id=xmlNode.getAttribute(apf.xmldb.xmlIdTag);
if(!id){xmlNode.setAttribute(apf.xmldb.xmlIdTag,"temp");id="temp";}x=xmlNode.selectSingleNode("ancestor::node()[(("+this.each+")/@"+apf.xmldb.xmlIdTag+")='"+id+"']");
if(id=="temp"){xmlNode.removeAttribute(apf.xmldb.xmlIdTag);}return x;};if(!this.$findHtmlNode){this.$findHtmlNode=function(id){return this.$pHtmlDoc.getElementById(id);
};}this.$setClearMessage=function(msg,className,lastHeight){if(this.more&&this.$addMoreItem){this.$addMoreItem();
}if(!this.$empty){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");
var xmlEmpty=this.$getLayoutNode("empty");if(!xmlEmpty){return;}this.$empty=apf.insertHtmlNode(xmlEmpty,this.$container);
}else{this.$container.appendChild(this.$empty);}var empty=this.$getLayoutNode("empty","caption",this.$empty);
if(empty){apf.setNodeValue(empty,msg||"");}this.$empty.setAttribute("id","empty"+this.$uniqueId);
apf.setStyleClass(this.$empty,className,["loading","empty","offline"]);var extH=apf.getStyle(this.$ext,"height");
this.$empty.style.height=(lastHeight&&(!extH||extH=="auto")&&className!="empty")?(Math.max(10,(lastHeight-apf.getHeightDiff(this.$empty)-apf.getHeightDiff(this.$ext)))+"px"):"";
};this.$updateClearMessage=function(msg,className){if(!this.$empty||this.$empty.parentNode!=this.$container||this.$empty.className.indexOf(className)==-1){return;
}var empty=this.$getLayoutNode("empty","caption",this.$empty);if(empty){apf.setNodeValue(empty,msg||"");
}};this.$removeClearMessage=function(){if(!this.$empty){this.$empty=document.getElementById("empty"+this.$uniqueId);
}if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);
}};this.$load=function(XMLRoot){apf.xmldb.addNodeListener(XMLRoot,this);var length=this.getTraverseNodes(XMLRoot).length;
if(!this.renderRoot&&!length){return this.clear(null,null,true);}var nodes=this.$addNodes(XMLRoot,null,null,this.renderRoot);
this.$fill(nodes);if(this.selectable){var sel,bHasOffline=(typeof apf.offline!="undefined");
if(!this.firstLoad&&bHasOffline&&apf.offline.state.enabled&&apf.offline.state.realtime){sel=apf.offline.state.get(this,"selection");
this.firstLoad=true;}if(sel){var selstate=apf.offline.state.get(this,"selstate");
if(sel.length==0){this.clearSelection();}else{for(var i=0;i<sel.length;i++){sel[i]=apf.xpathToXml(sel[i],this.xmlRoot);
}if(selstate[1]){var selected=apf.remote.xpathToXml(selstate[1],this.xmlRoot);}this.selectList(sel,null,selected);
}if(selstate[0]){this.setCaret(apf.remote.xpathToXml(selstate[0],this.xmlRoot));
}}else{if(this.autoselect){if(!this.selected){if(this.renderRoot){this.select(XMLRoot,null,null,null,true);
}else{if(nodes.length){this.$selectDefault(XMLRoot);}}}}else{this.clearSelection(true);
var xmlNode=this.renderRoot?this.xmlRoot:this.getFirstTraverseNode();if(xmlNode){this.setCaret(xmlNode);
}if(this.selected){this.setProperty("selected",null);}if(this.choosen){this.setProperty("choosen",null);
}}}}if(this.focussable){apf.document.activeElement==this?this.$focus():this.$blur();
}if(length!=this.length){this.setProperty("length",length);}};var actionFeature={insert:127,replacenode:127,attribute:255,add:251,remove:46,"redo-remove":79,synchronize:127,"move-away":233,move:77};
this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj,lastParent){if(!this.xmlRoot){return;
}var result,length,pNode,htmlNode,startNode=xmlNode;if(!listenNode){listenNode=this.xmlRoot;
}if(action=="redo-remove"){lastParent.appendChild(xmlNode);var eachNode=this.isTraverseNode(xmlNode);
lastParent.removeChild(xmlNode);if(!eachNode){xmlNode=lastParent;}}do{if(action=="add"&&this.isTraverseNode(xmlNode)&&startNode==xmlNode){break;
}if(xmlNode.getAttribute(apf.xmldb.xmlIdTag)){htmlNode=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(xmlNode==listenNode&&!this.renderRoot){if(xmlNode==this.xmlRoot&&action!="insert"&&action!="replacenode"){this.dispatchEvent("xmlupdate",{action:action,xmlNode:xmlNode,UndoObj:UndoObj});
return;}break;}if(htmlNode&&actionFeature[action]&2&&!this.isTraverseNode(xmlNode)){action="remove";
}else{if(!htmlNode&&actionFeature[action]&4&&this.isTraverseNode(xmlNode)){action="add";
break;}else{if(htmlNode&&(startNode!=xmlNode||xmlNode==this.xmlRoot)){if(actionFeature[action]&1){action="update";
}else{if(action=="remove"){return;}}}}}if(htmlNode||action=="move"){break;}}else{if(actionFeature[action]&8&&this.isTraverseNode(xmlNode)){action="add";
break;}}if(xmlNode==listenNode){if(actionFeature[action]&128){return;}break;}xmlNode=xmlNode.parentNode;
}while(xmlNode&&xmlNode.nodeType!=9);apf.$lm_has_lang=false;if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){if(!this.$isInViewport(xmlNode)){return;
}}var foundNode=xmlNode;if(xmlNode&&xmlNode.nodeType==9){xmlNode=startNode;}if(action=="replacenode"){if(UndoObj?UndoObj.args[1]==this.xmlRoot:!this.xmlRoot.parentNode){return this.load(UndoObj?UndoObj.xmlNode:listenNode,{force:true});
}var nodes=this.getTraverseNodes();for(var i=0,l=nodes.length;i<l;i++){if(apf.isChildOf(startNode,nodes[i])){return this.load(this.xmlRoot,{force:true});
}}}if(UndoObj&&xmlNode&&!UndoObj.xmlNode){UndoObj.xmlNode=xmlNode;}if(action=="move"&&foundNode==startNode){var isInThis=apf.isChildOf(this.xmlRoot,xmlNode.parentNode,true);
var wasInThis=apf.isChildOf(this.xmlRoot,UndoObj.extra.parent,true);if(isInThis&&wasInThis){this.$moveNode(xmlNode,htmlNode,UndoObj.extra.oldParent);
}else{if(isInThis){action="add";}else{if(wasInThis){action="remove";}}}}else{if(action=="move-away"){var goesToThis=apf.isChildOf(this.xmlRoot,UndoObj.extra.parent,true);
if(!goesToThis){action="remove";}}}if(this.$removeClearMessage&&this.$setClearMessage){if(this.getFirstTraverseNode()){this.$removeClearMessage();
}else{this.$setClearMessage(this["empty-message"],"empty");}}if(action=="insert"&&(this.$isTreeArch||xmlNode==this.xmlRoot)){if(!xmlNode){return;
}if(this.$hasLoadStatus(xmlNode)&&this.$removeLoading){this.$removeLoading(htmlNode);
}if(this.$container.firstChild&&!apf.xmldb.getNode(this.$container.firstChild)){this.$container.innerHTML="";
if(!this.renderRoot){length=this.getTraverseNodes().length;if(!length){this.clear();
}}}result=this.$addNodes(xmlNode,null,true,false,null,null,"insert");this.$fillParentHtml=(this.$getParentNode?this.$getParentNode(htmlNode):htmlNode);
this.$fillParent=xmlNode;this.$fill(result);if(this.selectable&&!this.xmlRoot.selectSingleNode(this.each)){apf.console.warn("No traversable nodes were found for "+this.name+" ["+this.localName+"]\n                                  Traverse Rule : "+this.$getBindRule("each")[4].getAttribute("match"));
}if(this.selectable&&(length===0||!this.xmlRoot.selectSingleNode(this.each))){return;
}}else{if(action=="add"){var parentHTMLNode;pNode=this.getTraverseParent(xmlNode);
if(pNode==this.xmlRoot){parentHTMLNode=this.$container;}if(!parentHTMLNode&&this.$isTreeArch){parentHTMLNode=this.$findHtmlNode(pNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}if(!parentHTMLNode&&this.getCacheItem){parentHTMLNode=this.getCacheItem(pNode.getAttribute(apf.xmldb.xmlIdTag)||(pNode.getAttribute(apf.xmldb.xmlDocTag)?"doc"+pNode.getAttribute(apf.xmldb.xmlDocTag):false));
}if(parentHTMLNode||this.$isTreeArch&&pNode==this.xmlRoot){parentHTMLNode=(this.$findContainer&&parentHTMLNode?this.$findContainer(parentHTMLNode):parentHTMLNode)||this.$container;
result=this.$addNodes(xmlNode,parentHTMLNode,true,true,apf.xmldb.getHtmlNode(this.getNextTraverse(xmlNode),this));
if(parentHTMLNode){this.$fill(result);}}}else{if(action=="remove"){if(htmlNode){this.$deInitNode(xmlNode,htmlNode);
}else{if(startNode==this.xmlRoot){return this.load(null,{noClearMsg:!this.dataParent||!this.dataParent.autoselect});
}}}else{if(htmlNode){if(this.$sort){this.$moveNode(xmlNode,htmlNode);}this.$updateNode(xmlNode,htmlNode);
if(action=="replacenode"&&this.hasFeature(apf.__MULTISELECT__)&&this.selected&&xmlNode.getAttribute(apf.xmldb.xmlIdTag)==this.selected.getAttribute(apf.xmldb.xmlIdTag)){this.selected=xmlNode;
}}else{if(action=="redo-remove"){var testNode=this.xmlRoot;while(testNode&&testNode.nodeType!=9){testNode=testNode.parentNode;
}if(!testNode){var model=this.getModel(true);if(!model){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));
}return model.$waitForXml(this);}}}}}}if(apf.$lm_has_lang){apf.language.addBinding(this);
}pNode=xmlNode?xmlNode.parentNode:lastParent;if(this.$isTreeArch&&!this.$preventRecursiveUpdate&&pNode&&pNode.nodeType==1){do{htmlNode=this.$findHtmlNode(pNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(htmlNode){this.$updateNode(pNode,htmlNode);}}while((pNode=this.getTraverseParent(pNode))&&pNode.nodeType==1);
}if(actionFeature[action]&32&&this.selectable&&startNode==xmlNode&&(action!="insert"||xmlNode==this.xmlRoot)){clearTimeout(this.$selectTimer.timer);
if(action=="remove"&&apf.isChildOf(xmlNode,this.selected,true)||xmlNode==this.$selectTimer.nextNode){this.$selectTimer.nextNode=this.getDefaultNext(xmlNode,this.$isTreeArch);
}var _self=this;this.$selectTimer.timer=$setTimeout(function(){_self.$checkSelection(_self.$selectTimer.nextNode);
_self.$selectTimer.nextNode=null;});}if(actionFeature[action]&64){if(!length){length=this.xmlRoot.selectNodes(this.each).length;
}if(length!=this.length){this.setProperty("length",length);}}if(this.signalXmlUpdate&&actionFeature[action]&16){var uniqueId;
for(uniqueId in this.signalXmlUpdate){if(parseInt(uniqueId)!=uniqueId){continue;
}var o=apf.lookup(uniqueId);if(!this.selected){continue;}xmlNode=this.selected.selectSingleNode(o.dataParent.xpath);
if(!xmlNode){continue;}o.load(xmlNode);}}this.dispatchEvent("xmlupdate",{action:action,xmlNode:startNode,traverseNode:xmlNode,result:result,UndoObj:UndoObj});
};this.$addNodes=function(xmlNode,parent,checkChildren,isChild,insertBefore,depth,action){if(!this.each){throw new Error(apf.formatErrorString(1060,this,"adding Nodes for load","No each SmartBinding rule was specified. This rule is                  required for a "+this.localName+" component.",this.$aml));
}var htmlNode,lastNode;isChild=(isChild&&(this.renderRoot&&xmlNode==this.xmlRoot||this.isTraverseNode(xmlNode)));
var nodes=isChild?[xmlNode]:this.getTraverseNodes(xmlNode);var cId,cItem;if(this.$isTreeArch&&this.caching&&(cItem=this.cache[(cId=xmlNode.getAttribute(apf.xmldb.xmlIdTag))])){if(this.$subTreeCacheContext||this.$needsDepth){this.clearCacheItem(cId);
}else{this.$subTreeCacheContext={oHtml:cItem,container:parent,parentNode:null,beforeNode:null};
var htmlNode;while(cItem.childNodes.length){(parent||this.$container).appendChild(htmlNode=cItem.childNodes[0]);
}return nodes;}}if(this.$isTreeArch&&depth===null&&action=="insert"){depth=0,loopNode=xmlNode;
while(loopNode&&loopNode!=this.xmlRoot){depth++;loopNode=this.getTraverseParent(loopNode);
}}for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1){if(this.$addNonElement){this.$addNonElement(nodes[i],parent||this.$container,checkChildren,insertBefore,depth);
}continue;}if(checkChildren){htmlNode=this.$findHtmlNode(nodes[i].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}if(!htmlNode){var Lid=apf.xmldb.nodeConnect(this.documentId,nodes[i],null,this);
var beforeNode=isChild?insertBefore:(lastNode?lastNode.nextSibling:null),parentNode=this.$add(nodes[i],Lid,isChild?xmlNode.parentNode:xmlNode,beforeNode?parent||this.$container:parent,beforeNode,(!beforeNode&&i==nodes.length-1),depth,nodes[i+1],action);
if(parentNode===false){break;}}if(checkChildren){lastNode=htmlNode;}}return nodes;
};this.$handleBindingRule=function(value,prop){if(!value){this[prop]=null;}if(prop=="each"){value=value.charAt(0)=="["&&value.charAt(value.length-1)=="]"?value.replace(/^\[|\]$/g,""):value;
if(value.indexOf("::")>-1){var model=value.split("::");if(!apf.xPathAxis[model[0]]){this.setProperty("model",model[0]);
this.each=model[1];}else{this.each=value;}}else{this.each=value;}if(this.each==this.$lastEach){return;
}this.$lastEach=value;if(!this.$model&&!this.$initingModel){this.$initingModel=true;
this.$setInheritedAttribute("model");return;}if(this.$checkLoadQueue()!==false){return;
}}if(this.xmlRoot&&!this.$bindRuleTimer&&this.$amlLoaded){var _self=this;apf.queue.add("reload"+this.$uniqueId,function(){apf.console.log("Reloading multiselect based on attribute '"+prop+"' bind change to value '"+value+"'\n\n"+_self.serialize(true));
_self.reload();});}};this.$select=function(o){if(this.renaming){this.stopRename(null,true);
}if(!o||!o.style){return;}return this.$setStyleClass(o,"selected");};this.$deselect=function(o){if(this.renaming){this.stopRename(null,true);
if(this.ctrlselect){return false;}}if(!o){return;}return this.$setStyleClass(o,"",["selected","indicate"]);
};this.$indicate=function(o){if(this.renaming){this.stopRename(null,true);}if(!o){return;
}return this.$setStyleClass(o,"indicate");};this.$deindicate=function(o){if(this.renaming){this.stopRename(null,true);
}if(!o){return;}return this.$setStyleClass(o,"",["indicate"]);};this.$propHandlers.each=this.$propHandlers.caption=this.$propHandlers.eachvalue=this.$propHandlers.icon=this.$propHandlers.tooltip=this.$handleBindingRule;
this.$propHandlers.sort=function(value){if(value){this.$sort=new apf.Sort();this.$sort.set({getValue:apf.lm.compile(value)});
}else{this.$sort=null;}};}).call(apf.MultiselectBinding.prototype=new apf.DataBinding());
apf.StandardBinding=function(){this.$init(true);if(apf.Validation){this.implement(apf.Validation);
}if(!this.setQueryValue){this.implement(apf.DataBinding);}if(!this.defaultValue){this.defaultValue="";
}this.$load=function(xmlNode){apf.xmldb.addNodeListener(xmlNode,this);var b,lrule,rule,bRules,bRule,value;
if(b=this.$bindings){for(rule in b){lrule=rule.toLowerCase();if(this.$supportedProperties.indexOf(lrule)>-1){bRule=(bRules=b[lrule]).length==1?bRules[0]:this.$getBindRule(lrule,xmlNode);
value=bRule.value||bRule.match;this.$clearDynamicProperty(lrule);if(value.indexOf("{")>-1||value.indexOf("[")>-1){this.$setDynamicProperty(lrule,value);
}else{if(this.setProperty){this.setProperty(lrule,value,true);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();
}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(action=="redo-remove"){var retreatToListenMode=false,model=this.getModel(true);
if(model){var xpath=model.getXpathByAmlNode(this);if(xpath){xmlNode=model.data.selectSingleNode(xpath);
if(xmlNode!=this.xmlRoot){retreatToListenMode=true;}}}if(retreatToListenMode||this.xmlRoot==xmlNode){if(!model){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));
}return model.$waitForXml(this);}}if(UndoObj&&!UndoObj.xmlNode){UndoObj.xmlNode=this.xmlRoot;
}var b,lrule,rule,bRules,bRule,value;if(b=this.$bindings){for(rule in b){lrule=rule.toLowerCase();
if(this.$supportedProperties.indexOf(lrule)>-1){bRule=(bRules=b[lrule]).length==1?bRules[0]:this.$getBindRule(lrule,xmlNode);
value=bRule.value||bRule.match;this.$clearDynamicProperty(lrule);if(value.indexOf("{")>-1||value.indexOf("[")>-1){this.$setDynamicProperty(lrule,value);
}else{if(this.setProperty){this.setProperty(lrule,value);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();
}this.dispatchEvent("xmlupdate",{action:action,xmlNode:xmlNode,UndoObj:UndoObj});
};this.addEventListener("$clear",function(nomsg,do_event){if(this.$propHandlers&&this.$propHandlers.value){this.value=-99999;
this.$propHandlers.value.call(this,"");}});};apf.StandardBinding.prototype=new apf.DataBinding();
apf.Init.run("standardbinding");apf.__MULTISELECT__=1<<8;apf.MultiSelect=function(){this.$init(function(){this.$valueList=[];
this.$selectedList=[];});};(function(){this.$regbase=this.$regbase|apf.__MULTISELECT__;
this.sellength=0;this.selected=null;this.$selected=null;this.caret=null;this.$caret=null;
this.useindicator=true;this.remove=function(nodeList){if(!nodeList){nodeList=this.$valueList;
}if(nodeList.nodeType){nodeList=[nodeList];}if(!nodeList||!nodeList.length){return;
}if(nodeList.contains(this.xmlRoot)){throw new Error(apf.formatErrorString(0,"Removing nodes","You are trying to delete the xml root of this                  element. This is not allowed."));
}var changes=[];for(var i=0;i<nodeList.length;i++){changes.push({action:"removeNode",args:[nodeList[i]]});
}if(this.$actions.removegroup){return this.$executeAction("multicall",changes,"removegroup",nodeList[0]);
}else{return this.$executeAction("multicall",changes,"remove",nodeList[0],null,null,nodeList.length>1?nodeList:null);
}};this.add=function(xmlNode,pNode,beforeNode,userCallback){var rule;if(this.$actions){if(xmlNode&&xmlNode.nodeType){rule=this.$actions.getRule("add",xmlNode);
}else{if(typeof xmlNode=="string"){if(xmlNode.trim().charAt(0)=="<"){xmlNode=apf.getXml(xmlNode);
rule=this.$actions.getRule("add",xmlNode);}else{var rules=this.$actions.add;for(var i=0,l=rules.length;
i<l;i++){if(rules[i].getAttribute("type")==xmlNode){xmlNode=null;rule=rules[i];
break;}}}}}if(!rule){rule=(this.$actions.add||{})[0];}}else{rule=null;}var bHasOffline=(typeof apf.offline!="undefined");
if(bHasOffline&&!apf.offline.canTransact()){return false;}if(bHasOffline&&!apf.offline.onLine&&(!xmlNode||!rule.get)){return false;
}var refNode=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot,amlNode=this,callback=function(addXmlNode,state,extra){if(state!=apf.SUCCESS){var oError;
oError=new Error(apf.formatErrorString(1032,amlNode,"Loading xml data","Could not add data for control "+amlNode.name+"["+amlNode.tagName+"] \nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+xmlNode));
if(extra.tpModule.retryTimeout(extra,state,amlNode,oError)===true){return true;
}throw oError;}if(typeof addXmlNode!="object"){addXmlNode=apf.getXmlDom(addXmlNode).documentElement;
}if(addXmlNode.getAttribute(apf.xmldb.xmlIdTag)){addXmlNode.setAttribute(apf.xmldb.xmlIdTag,"");
}var actionNode=amlNode.$actions&&amlNode.$actions.getRule("add",amlNode.$isTreeArch?amlNode.selected:amlNode.xmlRoot);
if(!pNode){if(actionNode&&actionNode.parent){pNode=(actionNode.cparent||actionNode.compile("parent",{xpathmode:2,injectself:true}))(amlNode.$isTreeArch?amlNode.selected||amlNode.xmlRoot:amlNode.xmlRoot);
}else{pNode=amlNode.$isTreeArch?amlNode.selected||amlNode.xmlRoot:amlNode.xmlRoot;
}}if(!pNode){pNode=amlNode.xmlRoot;}if(apf.isWebkit&&pNode.ownerDocument!=addXmlNode.ownerDocument){addXmlNode=pNode.ownerDocument.importNode(addXmlNode,true);
}if(!pNode){throw new Error(apf.formatErrorString(0,amlNode,"Executing add action","Missing parent node. You can only add nodes to a list if it                     has data loaded. Unable to perform action."));
}if(amlNode.$executeAction("appendChild",[pNode,addXmlNode,beforeNode],"add",addXmlNode)!==false&&amlNode.autoselect){amlNode.select(addXmlNode);
}if(userCallback){userCallback.call(amlNode,addXmlNode);}return addXmlNode;};if(xmlNode){return callback(xmlNode,apf.SUCCESS);
}else{if(rule.get){return apf.getData(rule.get,{xmlNode:refNode,callback:callback});
}else{throw new Error(apf.formatErrorString(0,this,"Executing add action","Missing add action defined in action rules. Unable to                      perform action."));
}}return addXmlNode;};if(!this.setValue){this.setValue=function(value,disable_event){noEvent=disable_event;
this.setProperty("value",value,false,true);noEvent=false;};}this.findXmlNodeByValue=function(value){var nodes=this.getTraverseNodes(),bindSet=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(!bindSet){return false;}for(var i=0;i<nodes.length;i++){if(this.$applyBindRule(bindSet,nodes[i])==value){return nodes[i];
}}};if(!this.getValue){this.getValue=function(xmlNode,noError){return this.value;
};}this.reselect=function(){if(this.selected){this.select(this.selected,null,this.ctrlselect,null,true);
}};this.select=function(xmlNode,ctrlKey,shiftKey,fakeselect,force,noEvent,userAction){if(!this.selectable||userAction&&this.disabled){return;
}if(parseInt(fakeselect)==fakeselect){if(fakeselect==2){fakeselect=true;userAction=true;
}else{fakeselect=false;userAction=true;}}if(this.$skipSelect){this.$skipSelect=false;
return;}if(this.ctrlselect&&!shiftKey){ctrlKey=true;}if(!this.multiselect){ctrlKey=shiftKey=false;
}if(!this.xmlRoot){if(!this.$buffered){var f;this.addEventListener("afterload",f=function(){this.select.apply(this,this.$buffered);
this.removeEventListener("afterload",f);delete this.$buffered;});}this.$buffered=Array.prototype.slice.call(arguments);
return;}var htmlNode;if(!xmlNode){throw new Error(apf.formatErrorString(1075,this,"Making a selection","No selection was specified"));
return false;}if(typeof xmlNode!="object"){var str=xmlNode;xmlNode=null;if(typeof xmlNode=="string"){xmlNode=apf.xmldb.getNodeById(str);
}if(!xmlNode){xmlNode=this.findXmlNodeByValue(str);if(!xmlNode){this.clearSelection(noEvent);
return;}}}if(!(typeof(xmlNode.style||"")=="object")){htmlNode=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}else{var id=(htmlNode=xmlNode).getAttribute(apf.xmldb.htmlIdTag);while(!id&&htmlNode.parentNode){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}xmlNode=apf.xmldb.getNodeById(id);}if(!shiftKey&&!ctrlKey&&!force&&!this.reselectable&&this.$valueList.length<=1&&this.$valueList.indexOf(xmlNode)>-1){return;
}if(this.dispatchEvent("beforeselect",{selected:xmlNode,htmlNode:htmlNode,ctrlKey:ctrlKey,shiftKey:shiftKey,force:force,captureOnly:noEvent})===false){return false;
}var lastIndicator=this.caret;this.caret=xmlNode;if(shiftKey){var range=this.$calcSelectRange(this.$valueList[0]||lastIndicator,xmlNode);
if(this.$caret){this.$deindicate(this.$caret);}this.selectList(range);this.$selected=this.$caret=this.$indicate(htmlNode);
}else{if(ctrlKey){if(this.$valueList.contains(xmlNode)){if(this.selected==xmlNode){this.$deselect(this.$findHtmlNode(this.selected.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));
this.$deindicate(this.$caret);if(this.$valueList.length&&!fakeselect){this.selected=this.$valueList[0];
}}else{this.$deselect(htmlNode,xmlNode);}if(!fakeselect){this.$selectedList.remove(htmlNode);
this.$valueList.remove(xmlNode);}if(htmlNode!=this.$caret){this.$deindicate(this.$caret);
}this.$selected=this.$caret=this.$indicate(htmlNode);}else{if(this.$caret){this.$deindicate(this.$caret);
}this.$caret=this.$indicate(htmlNode,xmlNode);this.$selected=this.$select(htmlNode,xmlNode);
this.selected=xmlNode;if(!fakeselect){this.$selectedList.push(htmlNode);this.$valueList.push(xmlNode);
}}}else{if(fakeselect&&htmlNode&&this.$selectedList.contains(htmlNode)){return;
}else{if(this.$selected){this.$deselect(this.$selected);}if(this.$caret){this.$deindicate(this.$caret);
}if(this.selected){this.clearSelection(true);}this.$caret=this.$indicate(htmlNode,xmlNode);
this.$selected=this.$select(htmlNode,xmlNode);this.selected=xmlNode;this.$selectedList.push(htmlNode);
this.$valueList.push(xmlNode);}}}if(this.delayedselect&&(typeof ctrlKey=="boolean")){var _self=this;
$setTimeout(function(){if(_self.selected==xmlNode){_self.dispatchEvent("afterselect",{selection:_self.$valueList,selected:xmlNode,caret:_self.caret,captureOnly:noEvent});
}},10);}else{this.dispatchEvent("afterselect",{selection:this.$valueList,selected:xmlNode,caret:this.caret,captureOnly:noEvent});
}return true;};this.choose=function(xmlNode,userAction){if(!this.selectable||userAction&&this.disabled){return;
}if(this.dispatchEvent("beforechoose",{xmlNode:xmlNode})===false){return false;
}if(xmlNode&&!(typeof(xmlNode.style||"")=="object")){this.select(xmlNode);}if(this.hasFeature(apf.__DATABINDING__)&&this.dispatchEvent("afterchoose",{xmlNode:this.selected})!==false){this.setProperty("chosen",this.selected);
}};this.clearSelection=function(noEvent,userAction){if(!this.selectable||userAction&&this.disabled||!this.$valueList.length){return;
}if(!noEvent){if(this.dispatchEvent("beforeselect",{selection:[],selected:null,caret:this.caret})===false){return false;
}}var htmlNode;for(var i=this.$valueList.length-1;i>=0;i--){htmlNode=this.$findHtmlNode(this.$valueList[i].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
this.$deselect(htmlNode);}this.$selectedList.length=0;this.$valueList.length=0;
this.$selected=this.selected=null;if(this.caret){htmlNode=this.$findHtmlNode(this.caret.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
this.$caret=this.$indicate(htmlNode);}if(!noEvent){this.dispatchEvent("afterselect",{selection:this.$valueList,selected:null,caret:this.caret});
}};this.selectList=function(xmlNodeList,noEvent,selected,userAction){if(!this.selectable||userAction&&this.disabled){return;
}if(this.dispatchEvent("beforeselect",{selection:xmlNodeList,selected:selected||xmlNodeList[0],caret:this.caret,captureOnly:noEvent})===false){return false;
}this.clearSelection(true);for(var sel,i=0;i<xmlNodeList.length;i++){if(!xmlNodeList[i]||xmlNodeList[i].nodeType!=1){continue;
}var htmlNode,xmlNode=xmlNodeList[i];if(typeof xmlNode!="object"){xmlNode=apf.xmldb.getNodeById(xmlNode);
}if(!(typeof(xmlNode.style||"")=="object")){htmlNode=this.$pHtmlDoc.getElementById(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}else{htmlNode=xmlNode;xmlNode=apf.xmldb.getNodeById(htmlNode.getAttribute(apf.xmldb.htmlIdTag));
}if(!xmlNode){apf.console.warn("Component : "+this.name+" ["+this.localName+"]\nMessage : xmlNode whilst selecting a list of xmlNodes could not be found. Ignoring.");
continue;}if(htmlNode){if(!sel&&selected==htmlNode){sel=htmlNode;}this.$select(htmlNode,xmlNode);
this.$selectedList.push(htmlNode);}this.$valueList.push(xmlNode);}this.$selected=sel||this.$selectedList[0];
this.selected=selected||this.$valueList[0];this.dispatchEvent("afterselect",{selection:this.$valueList,selected:this.selected,caret:this.caret,captureOnly:noEvent});
};this.setCaret=function(xmlNode){if(!xmlNode){if(this.$caret){this.$deindicate(this.$caret);
}this.caret=this.$caret=null;return;}var htmlNode;if(typeof xmlNode!="object"){xmlNode=apf.xmldb.getNodeById(xmlNode);
}if(!(typeof(xmlNode.style||"")=="object")){htmlNode=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}else{var id=(htmlNode=xmlNode).getAttribute(apf.xmldb.htmlIdTag);while(!id&&htmlNode.parentNode&&htmlNode.parentNode.nodeType==1){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}if(!id){alert(this.$int.outerHTML);}xmlNode=apf.xmldb.getNodeById(id);}if(this.$caret){this.$deindicate(this.$caret);
}this.$caret=this.$indicate(htmlNode);this.setProperty("caret",this.caret=xmlNode);
};this.$setTempSelected=function(xmlNode,ctrlKey,shiftKey,down){clearTimeout(this.timer);
if(this.$bindings.selectable){while(xmlNode&&!this.$getDataNode("selectable",xmlNode)){xmlNode=this.getNextTraverseSelected(xmlNode,!down);
}if(!xmlNode){return;}}if(!this.multiselect){ctrlKey=shiftKey=false;}if(ctrlKey||this.ctrlselect){if(this.$tempsel){this.select(this.$tempsel);
this.$tempsel=null;}this.setCaret(xmlNode);}else{if(shiftKey){if(this.$tempsel){this.$selectTemp();
this.$deselect(this.$tempsel);this.$tempsel=null;}this.select(xmlNode,null,shiftKey);
}else{if(!this.bufferselect||this.$valueList.length>1){this.select(xmlNode);}else{var id=apf.xmldb.getID(xmlNode,this);
this.$deselect(this.$tempsel||this.$selected);this.$deindicate(this.$tempsel||this.$caret);
this.$tempsel=this.$indicate(document.getElementById(id));this.$select(this.$tempsel);
var _self=this;this.timer=$setTimeout(function(){_self.$selectTemp();},400);}}}};
this.$selectTemp=function(){if(!this.$tempsel){return;}clearTimeout(this.timer);
this.select(this.$tempsel);this.$tempsel=null;this.timer=null;};this.selectAll=function(userAction){if(!this.multiselect||!this.selectable||userAction&&this.disabled||!this.xmlRoot){return;
}var nodes=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.xmlRoot.selectNodes(this.each);
this.selectList(nodes);};this.getSelection=function(xmldoc){var i,r;if(xmldoc){r=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();
for(i=0;i<this.$valueList.length;i++){apf.xmldb.cleanNode(r.appendChild(this.$valueList[i].cloneNode(true)));
}}else{for(r=[],i=0;i<this.$valueList.length;i++){r.push(this.$valueList[i]);}}return r;
};this.$getSelection=function(htmlNodes){return htmlNodes?this.$selectedList:this.$valueList;
};this.defaultSelectNext=function(xmlNode,isTree){var next=this.getNextTraverseSelected(xmlNode);
if(next||!isTree){this.select(next?next:this.getTraverseParent(xmlNode));}else{this.clearSelection(true);
}};this.selectNext=function(){var xmlNode=this.getNextTraverse();if(xmlNode){this.select(xmlNode);
}};this.selectPrevious=function(){var xmlNode=this.getNextTraverse(null,-1);if(xmlNode){this.select(xmlNode);
}};this.getDefaultNext=function(xmlNode,isTree){var next=this.getNextTraverseSelected(xmlNode);
return(next&&next!=xmlNode)?next:(isTree?this.getTraverseParent(xmlNode):null);
};this.isSelected=function(xmlNode){if(!xmlNode){return false;}for(var i=0;i<this.$valueList.length;
i++){if(this.$valueList[i]==xmlNode){return this.$valueList.length;}}return false;
};this.$checkSelection=function(nextNode){if(this.$valueList.length>1){for(var lst=[],i=0,l=this.$valueList.length;
i<l;i++){if(apf.isChildOf(this.xmlRoot,this.$valueList[i])){lst.push(this.$valueList[i]);
}}if(lst.length>1){this.selectList(lst);if(this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(nextNode||this.selected);
}return;}else{if(lst.length){nextNode=lst[0];}}}if(!nextNode){if(this.selected&&!apf.isChildOf(this.xmlRoot,this.selected)){nextNode=this.getFirstTraverseNode();
}else{if(this.selected&&this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(this.selected);
}else{if(!this.selected){nextNode=this.xmlRoot?this.getFirstTraverseNode():null;
}else{return;}}}}if(nextNode){if(this.autoselect){this.select(nextNode);}else{if(!this.multiselect){this.clearSelection();
}this.clearSelection();this.setCaret(nextNode);}}else{this.clearSelection();}};
this.selectable=true;if(typeof this.ctrlselect=="undefined"){this.ctrlselect=false;
}if(typeof this.multiselect=="undefined"){this.multiselect=true;}if(typeof this.autoselect=="undefined"){this.autoselect=true;
}if(typeof this.delayedselect=="undefined"){this.delayedselect=true;}if(typeof this.allowdeselect=="undefined"){this.allowdeselect=true;
}this.reselectable=false;this.$booleanProperties.selectable=true;this.$booleanProperties.multiselect=true;
this.$booleanProperties.autoselect=true;this.$booleanProperties.delayedselect=true;
this.$booleanProperties.allowdeselect=true;this.$booleanProperties.reselectable=true;
this.$supportedProperties.push("selectable","ctrlselect","multiselect","autoselect","delayedselect","allowdeselect","reselectable","selection","selected","default","value","caret");
this.$propHandlers.value=function(value){if(this.$lastValue==value){delete this.$lastValue;
return;}if(!this.$attrBindings.eachvalue&&!this.$amlLoaded&&this.getAttribute("eachvalue")){var _self=this;
return apf.queue.add("value"+this.$uniqueId,function(){_self.$propHandlers.value.call(_self,value);
});}var rule=this.$getBindRule("value",this.xmlRoot);if(rule){if(rule.models[0]==this.$model&&rule.cvalue.xpaths[0]!="#"){throw new Error(apf.formatErrorString(0,this,"Setting value attribute",'Value should not point to the same model where the items                     are loaded from. Please use value="[mdlName::xpath]" to                     specify the value. Use selected="[xpath]" to just select                     a node without making a databinding to it.'));
}}if(value||value===0||this["default"]){this.select(String(value)||this["default"]);
}else{this.clearSelection();}};this.$propHandlers["default"]=function(value,prop){if(!this.value||!this.$amlLoaded&&!(this.getAttribute("value")||this.getAttribute("selected")||this.getAttribute("selection"))){this.$propHandlers.value.call(this,"");
}};this.$propHandlers.caret=function(value,prop){if(value){this.setCaret(value);
}};this.$propHandlers.selection=this.$propHandlers.selected=function(value,prop){if(!value){value=this[prop]=null;
}if(prop=="selected"&&typeof value!="string"){if(value&&value.nodeType!=1){value=value.nodeValue;
}else{return;}}if(prop=="selection"&&(this.getAttribute("selection")||"*").substr(0,1)!="*"){apf.console.warn("Selection attribute ("+this.getAttributeNode("selection")+") should select multiple nodes. Please prefix xpath query with a * (ex.: *[item]).");
}if(this.$isSelecting){this.selection=this.$valueList;return false;}var nodes,bindSet,getValue,i,j,c,d;
if(prop=="selection"){if(typeof value=="object"&&value==this.$valueList){var pNode;
if((c=this.$attrBindings[prop])&&c.cvalue.models){this.$isSelecting=true;bindSet=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(!bindSet){throw new Error("Missing bind rule set: eachvalue, value or caption");
}var selNodes=this.$getDataNode(prop,this.xmlRoot);nodes=value;getValue=(d=this.$attrBindings["selection-unique"])&&d.cvalue;
if(selNodes.length){pNode=selNodes[0].parentNode;}else{var model,path;if(c.cvalue.xpaths[0]=="#"||c.cvalue.xpaths[1]=="#"){var m=(c.cvalue3||(c.cvalue3=apf.lm.compile(c.value,{xpathmode:5})))(this.xmlRoot);
model=m.model&&m.model.$isModel&&m.model;if(model){path=m.xpath;}else{if(m.model){model=apf.xmldb.findModel(m.model);
path=apf.xmlToXpath(m.model,model.data)+(m.xpath?"/"+m.xpath:"");}else{}}}else{model=apf.nameserver.get("model",c.cvalue.xpaths[0]);
path=c.cvalue.xpaths[1];}if(!model||!model.data){this.$isSelecting=false;return false;
}pNode=model.queryNode(path.replace(/\/[^\/]+$|^[^\/]*$/,"")||".");if(!pNode){throw new Error("Missing parent node");
}}remove_loop:for(i=0;i<selNodes.length;i++){value=getValue?getValue(selNodes[i]):this.$applyBindRule(bindSet,selNodes[i]);
for(j=0;j<nodes.length;j++){if(this.$applyBindRule(bindSet,nodes[j])==value){continue remove_loop;
}}apf.xmldb.removeNode(selNodes[i]);}add_loop:for(i=0;i<nodes.length;i++){value=this.$applyBindRule(bindSet,nodes[i]);
for(j=0;j<selNodes.length;j++){if(getValue?getValue(selNodes[j]):this.$applyBindRule(bindSet,selNodes[j])==value){continue add_loop;
}}var node=this.$attrBindings["selection-constructor"]&&this.$getDataNode("selection-constructor",nodes[i])||apf.getCleanCopy(nodes[i]);
apf.xmldb.appendChild(pNode,node);}this.$isSelecting=false;}return;}this.selection=this.$valueList;
}else{this.selected=null;}if(!this.xmlRoot){if(!this.$buffered){var f;this.addEventListener("afterload",f=function(){this.removeEventListener("afterload",f);
this.$propHandlers.selected.call(this,value,prop);delete this.$buffered;});this.$buffered=true;
}this[prop]=null;return false;}if(!value||typeof value!="object"){if(this.$attrBindings[prop]){nodes=this.$getDataNode(prop,this.xmlRoot);
if(nodes&&(nodes.length||nodes.nodeType==1)){this.setProperty("selection",nodes);
return;}if(!nodes||nodes.length===0){return;}}if(!value){this.clearSelection();
}else{this.select(value);}return false;}else{if(typeof value.length=="number"){nodes=value;
if(!nodes.length){this.selected=null;if(this.$valueList.length){this.clearSelection();
return false;}else{return;}}if(this.isTraverseNode(nodes[0])&&apf.isChildOf(this.xmlRoot,nodes[0])){if(!this.multiselect){this.select(nodes[0]);
}else{this.selectList(nodes);}return false;}if(this.$attrBindings[prop]){bindSet=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(!bindSet){throw new Error("Missing bind rule set: eachvalue, value or caption");
}var tNodes=!this.each?this.getTraverseNodes():this.xmlRoot.selectNodes("//"+this.each.split("|").join("|//"));
getValue=(c=this.$attrBindings["selection-unique"])&&c.cvalue;var selList=[];for(i=0;
i<nodes.length;i++){value=getValue?getValue(nodes[i]):this.$applyBindRule(bindSet,nodes[i]);
for(j=0;j<tNodes.length;j++){if(this.$applyBindRule(bindSet,tNodes[j])==value){selList.push(tNodes[j]);
}}}this.selectList(selList,true);return false;}throw new Error("Show me which case this is");
}else{if(this.$valueList.indexOf(value)==-1){this.select(value);}}}};this.$propHandlers.allowdeselect=function(value){if(value){var _self=this;
this.$container.onmousedown=function(e){if(!e){e=event;}if(e.ctrlKey||e.shiftKey){return;
}var srcElement=e.srcElement||e.target;if(_self.allowdeselect&&(srcElement==this||srcElement.getAttribute(apf.xmldb.htmlIdTag))){_self.clearSelection();
}};}else{this.$container.onmousedown=null;}};this.$propHandlers.ctrlselect=function(value){if(value!="enter"){this.ctrlselect=apf.isTrue(value);
}};function fAutoselect(){this.selectAll();}this.$propHandlers.autoselect=function(value){if(value=="all"&&this.multiselect){this.addEventListener("afterload",fAutoselect);
}else{this.removeEventListener("afterload",fAutoselect);}};this.$propHandlers.multiselect=function(value){if(!value&&this.$valueList.length>1){this.select(this.selected);
}};this.addEventListener("beforeselect",function(e){if(this.$bindings.selectable&&!this.$getDataNode("selectable",e.selected)){return false;
}},true);this.addEventListener("afterselect",function(e){var combinedvalue=null;
this.setProperty("caret",e.caret);if(this.sellength!=e.selection.length){this.setProperty("sellength",e.selection.length);
}delete this.selection;this.setProperty("selection",e.selection);if(!e.selection.length){this.setProperty("selected",e.selected);
if(this.value){this.setProperty("value","");}}else{this.$chained=true;if(!e.force&&(!this.dataParent||!this.dataParent.parent.$chained)){var _self=this;
$setTimeout(function(){if(_self.selected==e.selected){_self.setProperty("selected",combinedvalue||e.selected);
}delete _self.$chained;},10);}else{this.setProperty("selected",combinedvalue||e.selected);
delete this.$chained;}var valueRule=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(valueRule){this.$lastValue=this.$applyBindRule(valueRule,e.selected);if(this.$lastValue!=(valueRule!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){if(valueRule=="eachvalue"||this.xmlRoot!=this){this.change(this.$lastValue);
}else{this.setProperty("value",this.$lastValue);}}delete this.$lastValue;}}if(typeof apf.offline!="undefined"&&apf.offline.state.enabled&&apf.offline.state.realtime){for(var sel=[],i=0;
i<e.selection.length;i++){sel.push(apf.xmlToXpath(e.selection[i],null,true));}apf.offline.state.set(this,"selection",sel);
fSelState.call(this);}},true);function fSelState(){if(typeof apf.offline!="undefined"&&apf.offline.state.enabled&&apf.offline.state.realtime){apf.offline.state.set(this,"selstate",[this.caret?apf.xmlToXpath(this.caret,null,true):"",this.selected?apf.xmlToXpath(this.selected,null,true):""]);
}}this.addEventListener("prop.caret",fSelState);}).call(apf.MultiSelect.prototype=new apf.MultiselectBinding());
apf.__CHILDVALUE__=1<<27;apf.ChildValue=function(){if(!this.$childProperty){this.$childProperty="value";
}this.$regbase=this.$regbase|apf.__CHILDVALUE__;var f,re=/^[\s\S]*?>(<\?lm)?([\s\S]*?)(?:\?>)?<[^>]*?>$/;
this.addEventListener("DOMCharacterDataModified",f=function(e){if(e&&(e.currentTarget==this||e.currentTarget.nodeType==2&&e.relatedNode==this)||this.$amlDestroyed){return;
}if(this.getAttribute(this.$childProperty)){return;}var m=this.serialize().match(re),v=m&&m[2]||"";
if(m&&m[1]){v="{"+v+"}";}this.$norecur=true;if(v.indexOf("{")>-1||v.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,v);
}else{if(this[this.$childProperty]!=v){this.setProperty(this.$childProperty,v);
}}this.$norecur=false;});this.addEventListener("DOMAttrModified",f);this.addEventListener("DOMNodeInserted",f);
this.addEventListener("DOMNodeRemoved",f);this.addEventListener("$skinchange",function(e){this.$propHandlers[this.$childProperty].call(this,this.caption||"");
});this.$init(function(){this.addEventListener("prop."+this.$childProperty,function(e){if(!this.$norecur&&!e.value&&!this.getAttributeNode(this.$childProperty)){f.call(this);
}});});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var hasNoProp=typeof this[this.$childProperty]=="undefined";
if(hasNoProp&&!this.getElementsByTagNameNS(this.namespaceURI,"*",true).length&&(this.childNodes.length>1||this.firstChild&&(this.firstChild.nodeType==1||this.firstChild.nodeValue.trim().length))){var m=(this.$aml&&this.$aml.xml||this.serialize()).match(re),v=m&&m[2]||"";
if(m&&m[1]){v="{"+v+"}";}if(v.indexOf("{")>-1||v.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,v);
}else{this.setProperty(this.$childProperty,apf.html_entity_decode(v));}}else{if(hasNoProp){this.$propHandlers[this.$childProperty].call(this,"");
}}});};apf.__DATAACTION__=1<<25;apf.DataAction=function(){this.$regbase=this.$regbase|apf.__DATAACTION__;
this.getActionTracker=function(ignoreMe){if(!apf.AmlNode){return apf.window.$at;
}var pNode=this,tracker=ignoreMe?null:this.$at;if(!tracker&&this.dataParent){tracker=this.dataParent.parent.$at;
}while(!tracker){if(!pNode.parentNode&&!pNode.$parentNode){var model;return(model=this.getModel&&this.getModel(true))&&model.$at||apf.window.$at;
}tracker=(pNode=pNode.parentNode||pNode.$parentNode).$at;}return tracker;};this.$lock={};
this.$actionsLog={};this.$actions=false;this.$startAction=function(name,xmlContext,fRollback){if(this.disabled||this.liveedit&&name!="edit"){return false;
}var actionRule=this.$actions&&this.$actions.getRule(name,xmlContext);if(!actionRule&&apf.config.autoDisableActions&&this.$actions){if(!xmlContext){apf.console.warn("Tried starting new action but no xml                     context was specified.");
}else{apf.console.warn("Tried starting new action but no '"+name+"' action rule was found.");
}return false;}var bHasOffline=typeof apf.offline!="undefined";if(bHasOffline&&!apf.offline.canTransact()){return false;
}if(this.dispatchEvent(name+"start",{xmlContext:xmlContext})===false){return false;
}if(this.$lock[name]&&!this.$lock[name].stopped){apf.console.warn("Starting new action whilst previous                 action wasn't terminated:"+name);
this.$stopAction();}var lockInstruction=actionRule?actionRule.lock:null;if((bHasOffline&&(!apf.offline.enabled||!apf.offline.onLine))&&lockInstruction){var curLock=this.$lock[name]={start:bHasOffline&&!apf.offline.onLine?apf.offline.offlineTime:new Date().getISOTime(),stopped:false,xmlContext:xmlContext,instr:lockInstruction,rollback:fRollback},_self=this;
apf.saveData(lockInstruction,{xmlNode:xmlContext,unlock:false,callback:function(data,state,extra){if(state==apf.TIMEOUT&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}if(state==apf.SUCCESS){_self.dispatchEvent("locksuccess",apf.extend({state:extra.status,bubbles:true},extra));
curLock.retrieved=true;if(curLock.stopped){_self.$stopAction(name,true,curLock);
}}else{if(curLock.stopped){return;}fRollback.call(_self,xmlContext);_self.dispatchEvent("lockfailed",apf.extend({state:extra.status,bubbles:true},extra));
}}});}this.$actionsLog[name]=xmlContext;return true;};this.addEventListener("xmlupdate",function(e){if(apf.xmldb.disableRDB!=2){return;
}for(var name in this.$actionsLog){if(apf.isChildOf(this.$actionsLog[name],e.xmlNode,true)){this.$actionsLog[name].rollback.call(this,this.$actionsLog[name].xmlContext);
}}});this.$stopAction=function(name,isCancelled,curLock){delete this.$actionsLog[name];
if(!curLock){curLock=this.$lock[name];}if(curLock&&!curLock.stopped){curLock.stopped=true;
if(isCancelled&&curLock.retrieved){var _self=this;apf.saveData(curLock.instr,{xmlNode:curLock.xmlContext,unlock:true,callback:function(data,state,extra){if(state==apf.TIMEOUT&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}_self.dispatchEvent((state==apf.SUCCESS?"unlocksuccess":"unlockfailed"),apf.extend({state:extra.status,bubbles:true},extra));
}});}}return curLock;};this.$executeAction=function(atAction,args,action,xmlNode,noevent,contextNode,multiple){if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;
}apf.console.info("Executing action '"+action+"' for "+(this.name||"")+" ["+(this.localName||"")+"]");
var rule=this.$actions&&this.$actions.getRule(action,xmlNode);if(!rule&&this.$actions&&apf.config.autoDisableActions&&"action|change".indexOf(action)==-1){apf.console.warn("Could not execute action '"+action+"'.               No valid action rule was found and auto-disable-actions is enabled");
return false;}var curLock=this.$stopAction(action);var newMultiple;if(multiple){newMultiple=[];
for(var k=multiple.length-1;k>=0;k--){newMultiple.unshift({xmlActionNode:rule&&rule[4],amlNode:this,selNode:multiple[k],xmlNode:multiple[k]});
}}var ev=new apf.AmlEvent("before"+action.toLowerCase(),{action:atAction,args:args,xmlActionNode:rule,amlNode:this,selNode:contextNode,multiple:newMultiple||false,timestamp:curLock?curLock.start:new Date().getUTCTime()});
if(!noevent){if(this.dispatchEvent(ev.name,null,ev)===false){return false;}delete ev.currentTarget;
}var at=this.getActionTracker();if(!at){return UndoObj;}var UndoObj=at.execute(ev);
ev.xmlNode=UndoObj.xmlNode;ev.undoObj=UndoObj;if(!noevent){ev.name="after"+action.toLowerCase();
ev.cancelBubble=false;delete ev.returnValue;delete ev.currentTarget;this.dispatchEvent(ev.name,null,ev);
}return UndoObj;};this.$executeSingleValue=function(atName,setName,xmlNode,value,getArgList){var xpath,args,rule=this.$getBindRule(setName,xmlNode);
if(!rule){if(this.$getBindRule(setName)){throw new Error("There is no rule that matches the xml node for this operation.                                 Please make sure you are matching a node and using the value to                                  specify it's value <a:"+setName+" match='person'                                  value='[@name]' /> : "+xmlNode.xml);
}else{return false;}}var compiled;["valuematch","match","value"].each(function(type){if(!rule[type]||compiled){return;
}compiled=rule["c"+type];if(!compiled){compiled=rule.compile(type);}if(compiled.type!=3){compiled=null;
}});if(!compiled){throw new Error("Cannot create from rule that isn't a single xpath");
}var atAction,model,node,sel=compiled.xpaths,shouldLoad=false;if(sel[0]=="#"||sel[1]=="#"){var m=(rule.cvalue3||(rule.cvalue3=apf.lm.compile(rule.value,{xpathmode:5})))(xmlNode);
model=m.model&&m.model.$isModel&&m.model;if(model){node=model.queryNode(m.xpath);
xmlNode=model.data;}else{model=apf.xmldb.findModel(m.model);node=m.model.selectSingleNode(m.xpath);
xmlNode=m.model;}sel[1]=m.xpath;}else{model=sel[0]&&apf.nameserver.get("model",sel[0])||this.$model,node=model?model.queryNode(sel[1]):(xmlNode||this.xmlRoot).selectSingleNode(sel[1]);
if(model&&!xmlNode){xmlNode=model.data;}}if(node){if(apf.queryValue(node)==value){return;
}atAction=(node.nodeType==1||node.nodeType==3||node.nodeType==4)?"setTextNode":"setAttribute";
args=(node.nodeType==1)?[node,value]:(node.nodeType==3||node.nodeType==4?[node.parentNode,value]:[node.ownerElement||node.selectSingleNode(".."),node.nodeName,value]);
}else{if(!this.$createModel){return false;}atAction="setValueByXpath";xpath=sel[1];
if(!xmlNode){if(!model){model=this.getModel();}if(model){if(!model.data){model.load("<data />");
}xpath=(model.getXpathByAmlNode(this)||".")+(xpath&&xpath!="."?"/"+xpath:"");xmlNode=model.data;
}else{if(!this.dataParent){return false;}xmlNode=this.dataParent.parent.selected||this.dataParent.parent.xmlRoot;
if(!xmlNode){return false;}xpath=(this.dataParent.xpath||".")+(xpath&&xpath!="."?"/"+xpath:"");
shouldLoad=true;}}args=[xmlNode,value,xpath];}if(getArgList){return{action:atAction,args:args};
}this.$executeAction(atAction,args,atName,xmlNode);if(shouldLoad){this.load(xmlNode.selectSingleNode(xpath));
}};this.change=function(value,force){if(this.errBox&&this.errBox.visible&&this.isValid&&this.isValid()){this.clearError();
}if(!this.xmlRoot&&!this.$createModel||!(this.$mainBind=="value"&&this.hasFeature(apf.__MULTISELECT__)?this.$attrBindings.value:this.$hasBindRule(this.$mainBind))){if(!force&&value===this.value||this.dispatchEvent("beforechange",{value:value})===false){return false;
}this.setProperty("value",value);return this.dispatchEvent("afterchange",{value:value});
}var valueRule=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(value===(valueRule!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){return false;
}this.$executeSingleValue("change",this.$mainBind,this.xmlRoot,value);};this.$booleanProperties["render-root"]=true;
this.$supportedProperties.push("create-model","actions");this.$propHandlers["create-model"]=function(value){this.$createModel=value;
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(typeof this["create-model"]=="undefined"&&!this.$setInheritedAttribute("create-model")){this.$createModel=true;
}});};apf.config.$inheritProperties["create-model"]=1;apf.__CACHE__=1<<2;apf.Cache=function(){this.cache={};
this.$subTreeCacheContext=null;this.caching=true;this.$regbase=this.$regbase|apf.__CACHE__;
this.addEventListener("$load",function(e){if(!this.caching||e.forceNoCache){return;
}if(!this.cacheId){this.cacheId=this.$generateCacheId&&this.$generateCacheId(e.xmlNode)||e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)||apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(e.xmlNode),e.xmlNode);
}var fromCache=getCache.call(this,this.cacheId,e.xmlNode);if(fromCache){if(fromCache==-1||!this.getTraverseNodes){return(e.returnValue=false);
}var nodes=this.getTraverseNodes();if(nodes.length&&this.autoselect){this.select(nodes[0],null,null,null,true);
}else{if(this.clearSelection){this.clearSelection();}}if(!nodes.length){this.$removeClearMessage();
this.$setClearMessage(this["empty-message"],"empty");}if(nodes.length!=this.length){this.setProperty("length",nodes.length);
}return false;}});this.addEventListener("$clear",function(){if(!this.caching){return;
}if(this.hasFeature(apf.__MULTISELECT__)&&this.$subTreeCacheContext&&this.$subTreeCacheContext.oHtml){if(this.renderRoot){this.$subTreeCacheContext.parentNode.insertBefore(this.$subTreeCacheContext.oHtml,this.$subTreeCacheContext.beforeNode);
}else{var container=this.$subTreeCacheContext.container||this.$container;while(container.childNodes.length){this.$subTreeCacheContext.oHtml.appendChild(container.childNodes[0]);
}}this.documentId=this.xmlRoot=this.cacheId=this.$subTreeCacheContext=null;}else{if(this.$loadedWhenOffline){this.$loadedWhenOffline=false;
}else{var fragment=this.$getCurrentFragment();if(!fragment){return;}fragment.documentId=this.documentId;
fragment.xmlRoot=this.xmlRoot;if(this.cacheId||this.xmlRoot){setCache.call(this,this.cacheId||this.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)||"doc"+this.xmlRoot.getAttribute(apf.xmldb.xmlDocTag),fragment);
}}}});function getCache(id,xmlNode){if(xmlNode&&this.hasFeature(apf.__MULTISELECT__)&&this.$isTreeArch){var cacheItem,htmlId=xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,node=this.$pHtmlDoc.getElementById(htmlId);
if(node){cacheItem=id?false:this.$container;}else{for(var prop in this.cache){if(this.cache[prop]&&this.cache[prop].nodeType){node=this.cache[prop].getElementById(htmlId);
if(node){cacheItem=id?prop:this.cache[prop];break;}}}}if(cacheItem&&!this.cache[id]){var oHtml=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
this.$subTreeCacheContext={oHtml:oHtml,parentNode:oHtml.parentNode,beforeNode:oHtml.nextSibling,cacheItem:cacheItem};
this.documentId=apf.xmldb.getXmlDocId(xmlNode);this.cacheId=id;this.xmlRoot=xmlNode;
if(this.renderRoot){this.$container.appendChild(oHtml);}else{while(oHtml.childNodes.length){this.$container.appendChild(oHtml.childNodes[0]);
}}return true;}}if(!this.cache[id]){return false;}var fragment=this.cache[id];this.documentId=fragment.documentId;
this.cacheId=id;this.xmlRoot=xmlNode;this.setProperty("root",this.xmlRoot);this.clearCacheItem(id);
this.$setCurrentFragment(fragment);return true;}function setCache(id,fragment){if(!this.caching){return;
}this.cache[id]=fragment;}this.$findHtmlNode=function(id){var node=this.$pHtmlDoc.getElementById(id);
if(node){return node;}for(var prop in this.cache){if(this.cache[prop]&&this.cache[prop].nodeType){node=this.cache[prop].getElementById(id);
if(node){return node;}}}return null;};this.clearCacheItem=function(id,remove){this.cache[id].documentId=this.cache[id].cacheId=this.cache[id].xmlRoot=null;
if(remove){apf.destroyHtmlNode(this.cache[id]);}this.cache[id]=null;};this.clearAllCache=function(){for(var prop in this.cache){if(this.cache[prop]){this.clearCacheItem(prop,true);
}}};this.getCacheItem=function(id){return this.cache[id];};this.$isCached=function(id){return this.cache[id]||this.cacheId==id?true:false;
};if(!this.$getCurrentFragment){this.$getCurrentFragment=function(){var fragment=this.$container.ownerDocument.createDocumentFragment();
while(this.$container.childNodes.length){fragment.appendChild(this.$container.childNodes[0]);
}return fragment;};this.$setCurrentFragment=function(fragment){this.$container.appendChild(fragment);
if(!apf.window.hasFocus(this)&&this.blur){this.blur();}};}this.$booleanProperties.caching=true;
this.$supportedProperties.push("caching");this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.clearAllCache();
});};apf.GuiElement.propHandlers.caching=function(value){if(!apf.isTrue(value)){return;
}if(!this.hasFeature(apf.__CACHE__)){this.implement(apf.Cache);}};apf.__RENAME__=1<<10;
apf.Rename=function(){this.$regbase=this.$regbase|apf.__RENAME__;this.canrename=false;
this.$renameSubject=this.renameTimer=this.lastCursor=null;this.$booleanProperties.canrename=true;
this.$booleanProperties.autorename=true;this.$supportedProperties.push("canrename","autorename");
this.$propHandlers.autorename=function(value){if(value){this.reselectable=true;
this.bufferselect=false;this.addEventListener("afterselect",$afterselect);this.addEventListener("keydown",$keydown);
}else{this.removeEventListener("afterselect",$afterselect);this.removeEventListener("keydown",$keydown);
}};function $afterselect(){var _self=this;$setTimeout(function(){if(_self.hasFocus()){_self.startRename();
}},20);}function $keydown(e){if(!this.renaming&&apf.isCharacter(e.keyCode)){this.startRename();
}}this.$isContentEditable=function(e){if(this.renaming&&this.autorename){return true;
}};this.rename=function(xmlNode,value){if(!xmlNode){xmlNode=this.caret||this.selected;
}if(!xmlNode){return;}this.$executeSingleValue("rename","caption",xmlNode,value);
};this.startDelayedRename=function(e,time,userAction){if(e&&(e.button==2||e.ctrlKey||e.shiftKey)||userAction&&this.disabled){return;
}clearTimeout(this.renameTimer);this.renameTimer=$setTimeout("apf.lookup("+this.$uniqueId+").startRename()",time||400);
};this.startRename=function(force,startEmpty,userAction){if(!force&&(this.renaming||!this.canrename||!this.$startAction("rename",this.caret||this.selected,this.stopRename))||userAction&&this.disabled){return false;
}if(!this.hasFocus()){this.focus(null,null,true);}clearTimeout(this.renameTimer);
var elCaption=this.$getCaptionElement?this.$getCaptionElement():this.$caret||this.$selected;
if(!elCaption){return this.stopRename();}this.renaming=true;this.$renameSubject=this.caret||this.selected;
var wdt=elCaption.offsetWidth;this.lastCursor=elCaption.style.cursor;elCaption.style.cursor="text";
elCaption.parentNode.replaceChild(this.$txt,elCaption);elCaption.host=this;if(apf.isTrue(this.$getOption("main","scalerename"))){var diff=apf.getWidthDiff(this.$txt);
this.$txt.style.width=(wdt-diff-3)+"px";}this.$replacedNode=elCaption;var xmlNode=this.$getCaptionXml?this.$getCaptionXml(this.$renameSubject):this.$getDataNode("caption",this.$renameSubject);
value=startEmpty||!xmlNode?"":(xmlNode.nodeType!=1?unescape(xmlNode.nodeValue):(apf.isOnlyChild(xmlNode.firstChild,[3,4])?apf.queryValue(xmlNode):this.$applyBindRule("caption",this.$renameSubject)))||"";
if(apf.hasContentEditable){if(this.$multiLineRename){this.$txt.innerHTML=apf.htmlCleaner.prepare(value.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"));
}else{this.$txt.innerHTML=value.replace(/</g,"&lt;")||apf.hasContentEditableContainerBug&&"<br>"||"";
}}else{this.$txt.value=value;}this.$txt.unselectable="Off";this.$txt.host=this;
var txt=this.$txt;var f=function(){try{txt.focus();txt.select();}catch(e){}};if(apf.isIE){f();
}else{setTimeout(f);}};this.stopRename=function(contextXml,success){clearTimeout(this.renameTimer);
if(!this.renaming||contextXml&&contextXml!=this.$renameSubject||!this.$replacedNode){return false;
}this.renaming=false;if(this.$txt.parentNode&&this.$txt.parentNode.nodeType==1){if(apf.isIE8||apf.isIE7Emulate){this.$txt.blur();
}this.$txt.parentNode.replaceChild(this.$replacedNode,this.$txt);}if(this.$replacedNode){this.$replacedNode.style.cursor=this.lastCursor||"";
this.$replacedNode.host=null;}if(this.$multiLineRename){var value=apf.html_entity_decode(apf.htmlCleaner.parse(this.$txt.innerHTML,true).replace(/<br \/>/g,"").replace(/<\/?p>/g,""));
}else{var value=this.$txt[apf.hasContentEditable?"innerText":"value"].replace(/<.*?nobr>/gi,"").replace(/\n$/,"");
}if(!success||(this.$validateRename&&!this.$validateRename(value))){this.dispatchEvent("stoprename");
this.$stopAction("rename");}else{if(this.$replacedNode){this.$replacedNode.innerHTML=value.replace(/</g,"&lt;").replace(/\r?\n/g,"<br />");
}this.rename(this.$renameSubject,value);}if(!this.renaming){this.$renameSubject=null;
this.$replacedNode=null;this.$txt.style.width="";}return true;};this.addEventListener("keydown",function(e){var key=e.keyCode;
if(this.renaming){if(key==27||this.$multiLineRename&&e.ctrlKey&&key==13||!this.$multiLineRename&&key==13){this.stopRename(null,key==13&&!this.$autocomplete);
e.cancelBubble=true;return false;}else{if(apf.hasContentEditableContainerBug&&key==8&&this.$txt.innerHTML=="<br>"){e.preventDefault();
}}return;}if(key==113){if(this.$tempsel){this.$selectTemp();}if(this.caret!=this.selected){if(this.multiselect||this.isSelected(this.caret)){this.selected=this.caret;
this.$selected=this.$caret;}else{this.select(this.caret,true);}}this.startRename();
return false;}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$txt.refCount--;
if(!this.$txt.refCount){this.$txt.host=this.$txt.onmouseover=this.$txt.onmousedown=this.$txt.select=this.$txt.onfocus=this.$txt.onblur=null;
}this.$txt=null;});this.$init(apf.Rename.initEditableArea);};apf.Rename.initEditableArea=function(){if(!(this.$txt=document.getElementById("txt_rename"))){if(apf.hasContentEditable){this.$txt=document.createElement("DIV");
this.$txt.contentEditable=true;if(apf.isIE6){this.$txt.style.width="1px";}}else{this.$txt=document.createElement("input");
this.$txt.id="txt_rename";this.$txt.autocomplete=false;}this.$txt.refCount=0;this.$txt.id="txt_rename";
apf.importCssString("#txt_rename{white-space:nowrap}");this.$txt.onselectstart=function(e){(e||event).cancelBubble=true;
};this.$txt.onmouseover=this.$txt.onmouseout=this.$txt.oncontextmenu=this.$txt.onmouseup=this.$txt.onmousedown=function(e){apf.stopPropagation(e||event);
};this.$txt.onkeyup=function(e){if(!this.host.$autocomplete){return;}this.host.$lookup(this[apf.hasContentEditable?"innerHTML":"value"]);
};var sel;this.$txt.select=function(){if(!apf.hasMsRangeObject){(sel||(sel=new apf.selection())).selectNode(this);
return;}var r=document.selection.createRange();try{r.moveToElementText(this);if(apf.isFalse(this.host.$getOption("main","selectrename"))||typeof this.host.$renameStartCollapse!="undefined"){r.collapse(this.host.$renameStartCollapse);
}}catch(e){}r.select();};if(apf.hasFocusBug){this.$txt.onfocus=function(){if(apf.window){apf.window.$focusfix2();
}};}this.$txt.onblur=function(){if(apf.hasFocusBug){apf.window.$blurfix();}if(this.host.$autocomplete){return;
}this.host.stopRename(null,true);};}this.$txt.refCount++;};apf.__ALIGNMENT__=1<<29;
apf.A11y=function(){this.setRole=function(oNode,sRole){if(!oNode){throw new Error();
}if(!apf.A11y.ROLES[sRole]){throw new Error();}oNode.setAttribute("role",sRole);
};this.setWidgetAttr=function(oNode,sAttr,mValue){var rel=apf.A11y.ATTR_WIDGETS[sAttr];
if(!rel){throw new Error("attr does not exist");}if((typeof rel=="boolean"&&typeof mValue!="boolean")||(typeof rel=="number"&&typeof mValue!="number")||((typeof rel=="string"||apf.isArray(rel))&&typeof mValue!="string")){throw new Error("invalid type");
}oNode.setAttribute("aria-"+sAttr,mValue);};this.updateLiveRegion=function(oNode,sAttr,mValue){var rel=apf.A11y.ATTR_LIVEREGION[sAttr];
if(!rel){throw new Error("attr does not exist");}if((typeof rel=="boolean"&&typeof mValue!="boolean")||(apf.isArray(rel)&&typeof mValue!="string")){throw new Error("invalid type");
}if(oNode){oNode.setAttribute("aria-"+sAttr,mValue);}else{}};this.setDragDropAttr=function(oNode,sAttr,mValue){var rel=apf.A11y.ATTR_LIVEREGION[sAttr];
if(!rel){throw new Error("attr does not exist");}if((typeof rel=="boolean"&&typeof mValue!="boolean")||(apf.isArray(rel)&&typeof mValue!="string")){throw new Error("invalid type");
}oNode.setAttribute("aria-"+sAttr,mValue);};this.setRelationAttr=function(){var args=Array.prototype.slice.call(arguments),oNode=args.shift(),sAttr=args.shift(),sVal=args.join(" ");
if(!apf.A11y.ATTR_RELATIONS[sAttr]){throw new Error();}oNode.setAttribute("aria-"+sAttr,sVal);
};};apf.A11y.ROLES={alert:1,alertdialog:1,application:1,article:1,banner:1,button:1,checkbox:1,columnheader:1,combobox:1,complementary:1,contentinfo:1,definition:1,dialog:1,directory:1,grid:1,gridcell:1,"group:":1,heading:1,img:1,link:1,list:1,listbox:1,listitem:1,log:1,main:1,marquee:1,math:1,menu:1,menubar:1,menuitem:1,menuitemcheckbox:1,menuitemradio:1,navigation:1,note:1,option:1,presentation:1,progressbar:1,radio:1,radiogroup:1,region:1,row:1,rowheader:1,search:1,seperator:1,slider:1,slinbutton:1,status:1,tab:1,tablist:1,tabpanel:1,textbox:1,timer:1,toolbar:1,tooltip:1,tree:1,treegrid:1,treeitem:1};
apf.A11y.ATTR_WIDGETS={autocomplete:true,checked:true,disabled:true,expanded:true,haspopup:true,hidden:true,invalid:["grammar","false","spelling","true"],level:1,multiline:true,multiselectable:true,pressed:["true","false","pressed"],readonly:true,required:true,selected:true,sort:["ascending","descending","none","other"],valuemax:1,valuemin:1,valuenow:1,valuetext:"string"};
apf.A11y.ATTR_LIVEREGION={atomic:true,busy:true,live:["off","polite","assertive"],relevant:["additions","removals","text","all","additions text"]};
apf.A11y.ATTR_DRAGDROP={dropeffect:["copy","move","reference","execute","popup","none"],grabbed:true};
apf.A11y.ATTR_RELATIONS={activedescendant:{},controls:{},describedby:{},flowto:{},label:"1",labelledby:{},owns:{},posinset:1,setsize:1};
apf.BaseButton=function(){this.$init(true);};(function(){this.implement(apf.ChildValue);
this.$refKeyDown=this.$refMouseDown=0;this.$mouseOver=this.$mouseLeft=false;this.$propHandlers.background=function(value){var oNode=this.$getLayoutNode("main","background",this.$ext);
if(!oNode){return apf.console.warn("No background defined in the Button skin","button");
}if(value){var b=value.split("|");this.$background=b.concat(["vertical",2,16].slice(b.length-1));
oNode.style.backgroundImage="url("+this.mediaPath+b[0]+")";oNode.style.backgroundRepeat="no-repeat";
}else{oNode.style.backgroundImage="";oNode.style.backgroundRepeat="";this.$background=null;
}};this.addEventListener("keydown",function(e){var key=e.keyCode;switch(key){case 13:if(this.localName!="checkbox"){this.$ext.onmouseup(e.htmlEvent,true);
}break;case 32:if(!e.htmlEvent.repeat){this.$refKeyDown++;this.$updateState(e.htmlEvent);
}return false;}},true);this.addEventListener("keyup",function(e){var key=e.keyCode;
switch(key){case 32:this.$refKeyDown--;if(this.$refKeyDown<0){this.$refKeyDown=0;
return false;}if(this.$refKeyDown+this.$refMouseDown==0&&!this.disabled){this.$ext.onmouseup(e,true);
}this.$updateState(e);return false;}},true);this.states={Out:1,Over:2,Down:3};this.$updateState=function(e,strEvent){if(e.reset){this.$refKeyDown=0;
this.$refMouseDown=0;this.$mouseOver=false;return false;}if(this.$refKeyDown>0||(this.$refMouseDown>0&&(this.$mouseOver||(!apf.isIE&&this.$ext===e.currentTarget)))||(this.isBoolean&&this.value)){this.$setState("Down",e,strEvent);
}else{if(this.$mouseOver){this.$setState("Over",e,strEvent);}else{this.$setState("Out",e,strEvent);
}}};this.$setupEvents=function(){if(this.editable){return;}var _self=this;this.$ext.onmousedown=function(e){e=e||window.event;
if(_self.$notfromext&&(e.srcElement||e.target)==this){return;}_self.$refMouseDown=1;
_self.$mouseLeft=false;if(_self.disabled){return;}if(!apf.isIE){if(_self.value){apf.stopEvent(e);
}else{apf.cancelBubble(e);}}_self.$updateState(e,"mousedown");};this.$ext.onmouseup=function(e,force){e=e||window.event;
if(_self.disabled||!force&&((!_self.$mouseOver&&(!apf.isIE&&this!==e.currentTarget))||!_self.$refMouseDown)){return;
}_self.$refMouseDown=0;_self.$updateState(e,"mouseup");if(_self.disabled||(e&&e.type=="click"&&_self.$mouseLeft==true)){return false;
}if(_self.$refMouseDown+_self.$refKeyDown){return false;}if(_self.$clickHandler&&_self.$clickHandler()){_self.$updateState(e||event,"click");
}else{_self.dispatchEvent("click",{htmlEvent:e});}return false;};this.$ext.onmousemove=function(e){if((!_self.$mouseOver||_self.$mouseOver==2)){e=e||window.event;
if(_self.$notfromext&&(e.srcElement||e.target)==this){return;}_self.$mouseOver=true;
if(!_self.disabled){_self.$updateState(e,"mouseover");}}};this.$ext.onmouseout=function(e){e=e||window.event;
var tEl=e.explicitOriginalTarget||e.toElement;if(apf.isChildOf(this,tEl)){return;
}_self.$mouseOver=false;_self.$refMouseDown=0;_self.$mouseLeft=true;if(!_self.disabled){_self.$updateState(e,"mouseout");
}};if(apf.isIphone){apf.iphone.linkEvents(this.$ext,true);}if(apf.hasClickFastBug){this.$ext.ondblclick=this.$ext.onmouseup;
}};this.$doBgSwitch=function(nr){if(this.background&&(this.$background[2]>=nr||nr==4)){if(nr==4){nr=this.$background[2]+1;
}var strBG=this.$background[1]=="vertical"?"0 -"+(parseInt(this.$background[3])*(nr-1))+"px":"-"+(parseInt(this.$background[3])*(nr-1))+"px 0";
this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=strBG;
}};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");
};this.$blur=function(e){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
if(e){this.$updateState({});}};this.addEventListener("prop.disabled",function(e){this.$refKeyDown=this.$refMouseDown=0;
});this.$destroy=function(skinChange){if(!skinChange&&this.$ext){this.$ext.onmousedown=this.$ext.onmouseup=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onclick=this.$ext.ondblclick=null;
}};}).call(apf.BaseButton.prototype=new apf.StandardBinding());apf.BaseList=function(){this.$init(true);
this.$dynCssClasses=[];this.listNodes=[];};(function(){this.implement(apf.Cache,apf.DataAction,apf.K);
this.$focussable=true;this.$isWindowContainer=-1;this.multiselect=true;this.$propHandlers.fill=function(value){if(value){this.loadFillData(this.getAttribute("fill"));
}else{this.clear();}};this.$mode=0;this.$propHandlers.mode=function(value){if("check|radio".indexOf(value)>-1){if(!this.hasFeature(apf.__MULTICHECK__)){this.implement(apf.MultiCheck);
}this.addEventListener("afterrename",$afterRenameMode);this.multicheck=value=="check";
this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",$afterRenameMode);
this.$mode=0;}};function $afterRenameMode(){}this.$keyHandler=function(e){var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,selHtml=this.$caret||this.$selected;
if(e.returnValue==-1||!selHtml||this.renaming){return;}var selXml=this.caret||this.selected,oExt=this.$ext,node,margin,items,lines,hasScroll,hasScrollX,hasScrollY;
switch(key){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);
}this.choose(this.selected);break;case 32:if(ctrlKey||!this.isSelected(this.caret)){this.select(this.caret,ctrlKey);
}break;case 109:case 46:if(this.disableremove){return;}if(this.$tempsel){this.$selectTemp();
}this.remove();break;case 36:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(0,null,true,true);
}this.select(this.getFirstTraverseNode(),false,shiftKey);this.$container.scrollTop=0;
break;case 35:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(this.viewport.length,null,true,true);
}this.select(this.getLastTraverseNode(),false,shiftKey);this.$container.scrollTop=this.$container.scrollHeight;
break;case 107:if(this.more){this.startMore();}break;case 37:if(!selXml&&!this.$tempsel){return;
}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;margin=apf.getBox(apf.getStyle(selHtml,"margin"));
items=selHtml.offsetWidth?Math.floor((oExt.offsetWidth-(hasScroll?15:0))/(selHtml.offsetWidth+margin[1]+margin[3])):1;
node=this.getNextTraverseSelected(node,false);if(node){this.$setTempSelected(node,ctrlKey,shiftKey,true);
}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);if(selHtml.offsetTop<oExt.scrollTop){oExt.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),node)<items?0:selHtml.offsetTop-margin[0];
}break;case 38:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScroll=oExt.scrollHeight>oExt.offsetHeight;
items=selHtml.offsetWidth?Math.floor((oExt.offsetWidth-(hasScroll?15:0))/(selHtml.offsetWidth+margin[1]+margin[3])):1;
node=this.getNextTraverseSelected(node,false,items);if(node){this.$setTempSelected(node,ctrlKey,shiftKey,true);
}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);if(selHtml.offsetTop<oExt.scrollTop){oExt.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),node)<items?0:selHtml.offsetTop-margin[0];
}break;case 39:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));node=this.getNextTraverseSelected(node,true);
if(node){this.$setTempSelected(node,ctrlKey,shiftKey);}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);
if(selHtml.offsetTop+selHtml.offsetHeight>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=selHtml.offsetTop-oExt.offsetHeight+selHtml.offsetHeight+margin[0];
}break;case 40:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScroll=oExt.scrollHeight>oExt.offsetHeight;
items=selHtml.offsetWidth?Math.floor((oExt.offsetWidth-(hasScroll?15:0))/(selHtml.offsetWidth+margin[1]+margin[3])):1;
node=this.getNextTraverseSelected(node,true,items);if(node){this.$setTempSelected(node,ctrlKey,shiftKey);
}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);if(selHtml.offsetTop+selHtml.offsetHeight>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=selHtml.offsetTop-oExt.offsetHeight+selHtml.offsetHeight+margin[0];
}break;case 33:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScrollY=oExt.scrollHeight>oExt.offsetHeight;
hasScrollX=oExt.scrollWidth>oExt.offsetWidth;items=Math.floor((oExt.offsetWidth-(hasScrollY?15:0))/(selHtml.offsetWidth+margin[1]+margin[3]));
lines=Math.floor((oExt.offsetHeight-(hasScrollX?15:0))/(selHtml.offsetHeight+margin[0]+margin[2]));
node=this.getNextTraverseSelected(node,false,items*lines);if(!node){node=this.getFirstTraverseNode();
}if(node){this.$setTempSelected(node,ctrlKey,shiftKey,true);}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);
if(selHtml.offsetTop<oExt.scrollTop){oExt.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),node)<items?0:selHtml.offsetTop-margin[0];
}break;case 34:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScrollY=oExt.scrollHeight>oExt.offsetHeight;
hasScrollX=oExt.scrollWidth>oExt.offsetWidth;items=Math.floor((oExt.offsetWidth-(hasScrollY?15:0))/(selHtml.offsetWidth+margin[1]+margin[3]));
lines=Math.floor((oExt.offsetHeight-(hasScrollX?15:0))/(selHtml.offsetHeight+margin[0]+margin[2]));
node=this.getNextTraverseSelected(selXml,true,items*lines);if(!node){node=this.getLastTraverseNode();
}if(node){this.$setTempSelected(node,ctrlKey,shiftKey);}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);
if(selHtml.offsetTop+selHtml.offsetHeight>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=selHtml.offsetTop-oExt.offsetHeight+selHtml.offsetHeight+margin[0];
}break;default:if(key==65&&ctrlKey){this.selectAll();}else{if(this.$hasBindRule("caption")){if(!this.xmlRoot||this.autorename){return;
}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};
}this.lookup.str+=String.fromCharCode(key);var nodes=this.getTraverseNodes();for(var v,i=0;
i<nodes.length;i++){v=this.$applyBindRule("caption",nodes[i]);if(v&&v.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(nodes[i])){this.select(nodes[i]);
}if(selHtml){this.$container.scrollTop=selHtml.offsetTop-(this.$container.offsetHeight-selHtml.offsetHeight)/2;
}return;}}return;}}break;}this.lookup=null;return false;};this.$deInitNode=function(xmlNode,htmlNode){if(!htmlNode){return;
}htmlNode.parentNode.removeChild(htmlNode);};this.$updateNode=function(xmlNode,htmlNode,noModifier){var elIcon=this.$getLayoutNode("item","icon",htmlNode);
if(elIcon){if(elIcon.nodeType==1){elIcon.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode))+")";
}else{elIcon.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode));
}}else{var elImage=this.$getLayoutNode("item","image",htmlNode);if(elImage){if(elImage.nodeType==1){elImage.style.backgroundImage="url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode))+")";
}else{elImage.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode));
}}}var elCaption=this.$getLayoutNode("item","caption",htmlNode);if(elCaption){if(elCaption.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){elCaption.innerHTML=this.$applyBindRule("caption",xmlNode);
}}else{elCaption.nodeValue=this.$applyBindRule("caption",xmlNode);}}htmlNode.title=this.$applyBindRule("title",xmlNode)||"";
var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}if(!noModifier&&this.$updateModifier){this.$updateModifier(xmlNode,htmlNode);
}};this.$moveNode=function(xmlNode,htmlNode){if(!htmlNode){return;}var oPHtmlNode=htmlNode.parentNode;
var nNode=this.getNextTraverse(xmlNode);var beforeNode=nNode?apf.xmldb.findHtmlNode(nNode,this):null;
oPHtmlNode.insertBefore(htmlNode,beforeNode);};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){this.$getNewContext("item");
var oItem=this.$getLayoutNode("item"),elSelect=this.$getLayoutNode("item","select"),elIcon=this.$getLayoutNode("item","icon"),elImage=this.$getLayoutNode("item","image"),elCaption=this.$getLayoutNode("item","caption");
oItem.setAttribute("id",Lid);elSelect.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+"); o.$setStyleClass(this, 'hover', null, true);");
elSelect.setAttribute("onselectstart","return false;");elSelect.setAttribute("style",(elSelect.getAttribute("style")||"")+";user-select:none;-moz-user-select:none;-webkit-user-select:none;");
if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){elSelect.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.stopRename(); o.choose()");
elSelect.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            	  o.$setStyleClass(this, '', ['hover'], true);                this.hasPassedDown = false;");
elSelect.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1)");
elSelect.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (o.hasFeature(apf.__RENAME__) && this.dorename)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1)");
}else{elSelect.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");
elSelect.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.choose(null, true)");
elSelect.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey, -1)");
}if(this.$listGrid){oItem.setAttribute("onmouseover",oItem.getAttribute("onmouseover")+"var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");
}if(this.$mode){var elCheck=this.$getLayoutNode("item","check");if(elCheck){elCheck.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.checkToggle(this, true);o.$skipSelect = true;");
if(apf.isTrue(this.$applyBindRule("checked",xmlNode))){this.$checkedList.push(xmlNode);
this.$setStyleClass(oItem,"checked");}else{if(this.isChecked(xmlNode)){this.$setStyleClass(oItem,"checked");
}}}else{throw new Error(apf.formatErrorString(0,this,"Could not find check attribute",'Maybe the attribute check is missing from your skin file:                            <a:item                              class        = "."                              caption      = "label/u/text()"                              icon         = "label"                              openclose    = "span"                              select       = "label"                              check        = "label/b"                              container    = "following-sibling::blockquote"                            >                                <div><span> </span><label><b> </b><u>-</u></label></div>                                <blockquote> </blockquote>                            </a:item>                        '));
return false;}}if(elIcon){if(elIcon.nodeType==1){elIcon.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode))+")");
}else{elIcon.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode));
}}else{if(elImage){if(elImage.nodeType==1){if((elImage.tagName||"").toLowerCase()=="img"){elImage.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode)));
}else{elImage.setAttribute("style","background-image:url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode))+")");
}}else{if(apf.isSafariOld){var p=elImage.ownerElement.parentNode,img=p.appendChild(p.ownerDocument.createElement("img"));
img.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode)));
}else{elImage.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode));
}}}}if(elCaption){if(elCaption.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var q=(this.$amlBindQueue||(this.$amlBindQueue={}));
if(elCaption==oItem){apf.setNodeValue(elCaption,"");var span=elCaption.appendChild(elCaption.ownerDocument.createElement("span"));
if(apf.isIE){span.appendChild(elCaption.ownerDocument.createTextNode(" "));}span.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.caption||(q.caption=[])).push(xmlNode)-1));
}else{elCaption.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.caption||(q.caption=[])).push(xmlNode)-1));
apf.setNodeValue(elCaption,"");}}else{apf.setNodeValue(elCaption,this.$applyBindRule("caption",xmlNode));
}}oItem.setAttribute("title",this.$applyBindRule("tooltip",xmlNode)||"");var cssClass=this.$applyBindRule("css",xmlNode);
if(cssClass){this.$setStyleClass(oItem,cssClass);if(cssClass){this.$dynCssClasses.push(cssClass);
}}if(this.$addModifier&&this.$addModifier(xmlNode,oItem,htmlParentNode,beforeNode)===false){return;
}if(htmlParentNode){apf.insertHtmlNode(oItem,htmlParentNode,beforeNode);}else{this.listNodes.push(oItem);
}};this.addEventListener("$skinchange",function(e){if(this.more){delete this.moreItem;
}});this.$fill=function(){if(this.more&&!this.moreItem){this.$getNewContext("item");
var Item=this.$getLayoutNode("item"),elCaption=this.$getLayoutNode("item","caption"),elSelect=this.$getLayoutNode("item","select");
Item.setAttribute("class",this.$baseCSSname+"More");elSelect.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+');o.clearSelection();o.$setStyleClass(this, "more_down", null, true);');
elSelect.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["more_down"], true);');
elSelect.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+").startMore(this, true)");
if(elCaption){apf.setNodeValue(elCaption,this.more.match(/caption:(.*)(;|$)/i)[1]);
}this.listNodes.push(Item);}apf.insertHtmlNodes(this.listNodes,this.$container);
this.listNodes.length=0;if(this.more&&!this.moreItem){this.moreItem=this.$container.lastChild;
}};this.startMore=function(o,userAction){if(userAction&&this.disabled){return;}this.$setStyleClass(o,"",["more_down"]);
var xmlNode;if(!this.$actions.add){if(this.each&&!this.each.match(/[\/\[]/)){xmlNode="<"+this.each+(this.each.match(/^a:/)?" xmlns:a='"+apf.ns.aml+"'":"")+" custom='1' />";
}else{apf.console.warn("No add action rule is defined for element while more='true'.");
xmlNode="<item />";}}this.add(xmlNode,null,null,function(addedNode){this.select(addedNode,null,null,null,null,true);
if(this.morePos=="begin"){this.$container.insertBefore(this.moreItem,this.$container.firstChild);
}else{this.$container.appendChild(this.moreItem);}var undoLastAction=function(){this.getActionTracker().undo(this.autoselect?2:1);
this.removeEventListener("stoprename",undoLastAction);this.removeEventListener("beforerename",removeSetRenameEvent);
this.removeEventListener("afterrename",afterRename);};var afterRename=function(){this.removeEventListener("afterrename",afterRename);
};var removeSetRenameEvent=function(e){this.removeEventListener("stoprename",undoLastAction);
this.removeEventListener("beforerename",removeSetRenameEvent);var xmlNode=this.findXmlNodeByValue(e.args[1]);
if(xmlNode||!e.args[1]){if(e.args[1]&&this.dispatchEvent("notunique",{value:e.args[1]})===false){this.startRename();
this.addEventListener("stoprename",undoLastAction);this.addEventListener("beforerename",removeSetRenameEvent);
}else{this.removeEventListener("afterrename",afterRename);this.getActionTracker().undo();
if(!this.isSelected(xmlNode)){this.select(xmlNode);}}return false;}};this.addEventListener("stoprename",undoLastAction);
this.addEventListener("beforerename",removeSetRenameEvent);this.addEventListener("afterrename",afterRename);
this.startDelayedRename({},1);});};this.$calcSelectRange=function(xmlStartNode,xmlEndNode){var r=[],nodes=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),f,i;
for(f=false,i=0;i<nodes.length;i++){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);
}if(nodes[i]==xmlEndNode){f=false;}}if(!r.length||f){r=[];for(f=false,i=nodes.length-1;
i>=0;i--){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);}if(nodes[i]==xmlEndNode){f=false;
}}}return r;};this.$selectDefault=function(XMLRoot){this.select(this.getTraverseNodes()[0],null,null,null,true);
};this.loadFillData=function(str){var len,start,end,parts=str.splitSafe(","),data=[];
for(var p,part,i=0;i<parts.length;i++){if((part=parts[i]).match(/^\d+-\d+$/)){p=part.split("-");
start=parseInt(p[0]);end=parseInt(p[1]);if(p[0].length==p[1].length){len=Math.max(p[0].length,p[1].length);
for(var j=start;j<end+1;j++){data.push("<item>"+(j+"").pad(len,"0")+"</item>");
}}else{for(var j=start;j<end+1;j++){data.push("<item>"+j+"</item>");}}}else{data.push("<item>"+part+"</item>");
}}this.$initingModel=true;this.each="item";this.$setDynamicProperty("caption","[label/text()|@caption|text()]");
this.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");this.$canLoadDataAttr=false;
this.load("<data>"+data.join("")+"</data>");};}).call(apf.BaseList.prototype=new apf.MultiSelect());
apf.BaseSimple=function(){this.$init(true);};(function(){this.implement(apf.DataAction);
this.getValue=function(){return this.value;};}).call(apf.BaseSimple.prototype=new apf.StandardBinding());
apf.BaseStateButtons=function(){this.state="normal";this.edit=false;var actions={min:["minimized","minimize","restore"],max:["maximized","maximize","restore"],edit:["edit","edit","closeedit"],close:["closed","close","show"]};
this.$lastheight=null;this.$lastpos=null;this.$lastState={normal:true};this.$booleanProperties.animate=true;
this.$supportedProperties.push("buttons","animate","state");this.close=function(){this.setProperty("state",this.state.split("|").pushUnique("closed").join("|"),false,true);
return this;};this.minimize=function(){this.setProperty("state",this.state.split("|").remove("maximized").remove("normal").pushUnique("minimized").join("|"),false,true);
return this;};this.maximize=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("normal").pushUnique("maximized").join("|"),false,true);
return this;};this.restore=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("maximized").pushUnique("normal").join("|"),false,true);
return this;};this.edit=function(value){this.setProperty("state",this.state.split("|").pushUnique("edit").join("|"),false,true);
return this;};this.closeedit=function(value){this.setProperty("state",this.state.split("|").remove("edit").join("|"),false,true);
return this;};this.$toggle=function(type){var c=actions[type][0];this[actions[type][this.state.indexOf(c)>-1?2:1]]();
};this.$propHandlers.refparent=function(value){if(typeof value=="string"){this.$refParent=self[value]&&self[value].$ext||document.getElementById(value);
}else{this.$refParent=value;}};this.$propHandlers.maxconf=function(value){this.$maxconf=value.splitSafe(",");
};this.$propHandlers.state=function(value,prop,force,reenter,noanim){var _self=this;
if(!this.$amlLoaded){apf.queue.add("state"+this.$uniqueId,function(){_self.$propHandlers.state.call(_self,value,prop,force,reenter,noanim);
});return;}if(value==0){value="normal";}var i,pNode,position,l,t,o={},s=value.split("|"),lastState=this.$lastState,styleClass=[];
for(i=0;i<s.length;i++){o[s[i]]=true;}o.value=value;if(!o.maximized&&!o.minimized){o.normal=true;
}if(!reenter&&this.dispatchEvent("beforestatechange",{from:lastState,to:o})===false){this.state=lastState.value;
return false;}if(o.closed==this.visible){this.setProperty("visible",!o.closed,false,true);
}if(o.normal!=lastState.normal||!o.normal&&(o.minimized!=lastState.minimized||o.maximized!=lastState.maximized)){if(this.$lastheight){this.$ext.style.height=this.$lastheight;
}if(this.$lastpos){apf.plane.hide(this.$uniqueId);if(this.animate&&!noanim){var htmlNode=this.$ext;
position=apf.getStyle(htmlNode,"position");if(position!="absolute"){l=parseInt(apf.getStyle(htmlNode,"left"))||0;
t=parseInt(apf.getStyle(htmlNode,"top"))||0;}else{l=htmlNode.offsetLeft;t=htmlNode.offsetTop;
}this.animstate=1;apf.tween.multi(htmlNode,{steps:15,anim:apf.tween.easeInOutCubic,interval:10,tweens:[{type:"left",from:l,to:this.$lastpos.px[0]},{type:"top",from:t,to:this.$lastpos.px[1]},{type:"width",from:this.$ext.offsetWidth,to:this.$lastpos.px[2]},{type:"height",from:this.$ext.offsetHeight,to:this.$lastpos.px[3]}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);
}},onfinish:function(){_self.$lastpos.parentNode.insertBefore(_self.$ext,_self.$lastpos.beforeNode);
if(_self.$placeHolder){_self.$placeHolder.parentNode.removeChild(_self.$placeHolder);
}_self.$propHandlers.state.call(_self,value,null,null,true,true);}});return;}else{if(!this.animate){apf.plane.hide(this.$uniqueId,true);
_self.$lastpos.parentNode.insertBefore(_self.$ext,_self.$lastpos.beforeNode);if(_self.$placeHolder){_self.$placeHolder.parentNode.removeChild(_self.$placeHolder);
}}}this.$ext.style.position=this.$lastpos.pos;this.$ext.style.left=this.$lastpos.css[0];
this.$ext.style.top=this.$lastpos.css[1];this.$ext.style.width=this.$lastpos.css[2];
this.$ext.style.height=this.$lastpos.css[3];pNode=this.$lastpos.parentNode;pNode.style.width=this.$lastpos.parent[0];
pNode.style.height=this.$lastpos.parent[1];pNode.style.overflow=this.$lastpos.parent[2];
}if(this.aData&&this.aData.restore){this.aData.restore();}if(apf.layout){apf.layout.play(this.$pHtmlNode);
}this.$lastheight=this.$lastpos=null;if(o.normal){styleClass.push("",this.$baseCSSname+"Max",this.$baseCSSname+"Min");
}}if(o.minimized!=lastState.minimized){if(o.minimized){styleClass.unshift(this.$baseCSSname+"Min",this.$baseCSSname+"Max",this.$baseCSSname+"Edit");
if(this.aData&&this.aData.minimize){this.aData.minimize(this.collapsedHeight);}if(!this.aData||!this.aData.minimize){this.$lastheight=apf.getStyle(this.$ext,"height");
this.$ext.style.height=Math.max(0,this.collapsedHeight-apf.getHeightDiff(this.$ext))+"px";
}if(this.hasFocus()){apf.window.moveNext(null,this,true);}}else{styleClass.push(this.$baseCSSname+"Min");
$setTimeout(function(){apf.window.$focusLast(_self);});}}if(o.maximized!=lastState.maximized){if(o.maximized){styleClass.unshift(this.$baseCSSname+"Max",this.$baseCSSname+"Min",this.$baseCSSname+"Edit");
pNode=this.$refParent;if(!pNode){pNode=(this.$ext.offsetParent==document.body?document.documentElement:this.$ext.parentNode);
}this.animstate=0;var hasAnimated=false,htmlNode=this.$ext;var position=apf.getStyle(htmlNode,"position");
if(position=="absolute"){pNode.style.overflow="hidden";l=htmlNode.offsetLeft;t=htmlNode.offsetTop;
}else{var pos=apf.getAbsolutePosition(htmlNode);l=pos[0];t=pos[1];}this.$lastpos={css:[this.$ext.style.left,this.$ext.style.top,this.$ext.style.width,this.$ext.style.height,this.$ext.style.margin,this.$ext.style.zIndex],px:[l,t,this.$ext.offsetWidth,this.$ext.offsetHeight],parent:[pNode.style.width,pNode.style.height,pNode.style.overflow],pos:htmlNode.style.position,parentNode:pNode,beforeNode:this.$ext.nextSibling};
if(this.parentNode.$layout){if(!this.$placeHolder){this.$placeHolder=document.createElement("div");
}this.$placeHolder.style.position=this.$lastpos.pos;this.$placeHolder.style.left=this.$lastpos.css[0];
this.$placeHolder.style.top=this.$lastpos.css[1];this.$placeHolder.style.width=this.$lastpos.px[2]+"px";
this.$placeHolder.style.height=this.$lastpos.px[3]+"px";this.$placeHolder.style.margin=this.$lastpos.css[4];
this.$placeHolder.style.zIndex=this.$lastpos.css[5];this.$pHtmlNode.insertBefore(this.$placeHolder,this.$ext);
htmlNode.style.position="absolute";}document.body.appendChild(htmlNode);htmlNode.style.left=l+"px";
htmlNode.style.top=t+"px";function setMax(){if(_self.animstate){return;}var w,h,pos,box,pDiff;
if(_self.maxconf){w=_self.$maxconf[0];h=_self.$maxconf[1];pos=[_self.$maxconf[2]=="center"?(apf.getWindowWidth()-w)/2:_self.$maxconf[2],_self.$maxconf[3]=="center"?(apf.getWindowHeight()-h)/3:_self.$maxconf[3]];
}else{w=!apf.isIE&&pNode==document.documentElement?window.innerWidth:pNode.offsetWidth,h=!apf.isIE&&pNode==document.documentElement?window.innerHeight:pNode.offsetHeight;
}if(!pos){pos=pNode!=htmlNode.offsetParent?apf.getAbsolutePosition(pNode,htmlNode.offsetParent):[0,0];
}if(position!="absolute"){var diff=apf.getDiff(pNode);w-=diff[0]+(!_self.$refParent&&apf.isIE8?4:0);
h-=diff[0]+(!_self.$refParent&&apf.isIE8?4:0);}else{if(!_self.$refParent&&apf.isIE8){w-=4;
h-=4;}}box=_self.$refParent?[0,0,0,0]:marginBox;pDiff=apf.getDiff(pNode);pNode.style.width=(pNode.offsetWidth-pDiff[0])+"px";
pNode.style.height=(pNode.offsetHeight-pDiff[1])+"px";if(!hasAnimated&&_self.$maxconf&&_self.$maxconf[4]){apf.plane.show(htmlNode,false,null,null,{color:_self.$maxconf[4],opacity:_self.$maxconf[5],animate:_self.animate,protect:_self.$uniqueId});
}if(_self.animate&&!hasAnimated){_self.animstate=1;hasAnimated=true;apf.tween.multi(htmlNode,{steps:15,anim:apf.tween.easeInOutCubic,interval:10,tweens:[{type:"left",from:l,to:pos[0]-box[3]},{type:"top",from:t,to:pos[1]-box[0]},{type:"width",from:_self.$lastpos.px[2],to:(w+box[1]+box[3]-apf.getWidthDiff(_self.$ext))},{type:"height",from:_self.$lastpos.px[3],to:(h+box[0]+box[2]-apf.getHeightDiff(_self.$ext))}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);
}},onfinish:function(){_self.animstate=0;_self.dispatchEvent("afterstatechange",{from:lastState,to:o});
if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);}}});}else{if(!_self.animstate){htmlNode.style.left=(pos[0]-box[3])+"px";
htmlNode.style.top=(pos[1]-box[0])+"px";var diff=apf.getDiff(_self.$ext);htmlNode.style.width=(w-diff[0]+box[1]+box[3])+"px";
htmlNode.style.height=(h-diff[1]+box[0]+box[2])+"px";}}}if(apf.layout){apf.layout.pause(this.$pHtmlNode,setMax);
}}else{styleClass.push(this.$baseCSSname+"Max");}}if(o.edit!=lastState.edit){if(o.edit){styleClass.unshift(this.$baseCSSname+"Edit",this.$baseCSSname+"Max",this.$baseCSSname+"Min");
if(this.btnedit){oButtons.edit.innerHTML="close";}this.dispatchEvent("editstart");
}else{if(this.dispatchEvent("editstop")===false){return false;}styleClass.push(this.$baseCSSname+"Edit");
if(styleClass.length==1){styleClass.unshift("");}if(this.btnedit){oButtons.edit.innerHTML="edit";
}}}if(styleClass.length||o.closed!=lastState.closed){if(styleClass.length){this.$setStyleClass(this.$ext,styleClass.shift(),styleClass);
}if(o.edit){this.dispatchEvent("prop.visible",{value:true});if(_self.oSettings){apf.layout.forceResize(_self.oSettings);
}}if(!o.maximized||!this.animate||lastState.maximized&&_self.animate){_self.dispatchEvent("afterstatechange",{from:lastState,to:o});
}this.$lastState=o;if(this.aData&&!o.maximized){this.$purgeAlignment();}if(!this.animate&&apf.hasSingleRszEvent&&apf.layout){apf.layout.forceResize(_self.$int);
}}};var marginBox,hordiff,verdiff,oButtons={};this.$propHandlers.buttons=function(value){if(apf.isIphone){return;
}if(!this.$hasLayoutNode("button")){return;}var buttons=value&&(value=value.replace(/(\|)\||\|$/,"$1")).split("|")||[],nodes=this.$buttons.childNodes,re=value&&new RegExp("("+value+")"),found={},idleNodes=[];
for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1||nodes[i].tagName!="DIV"){continue;
}if(nodes[i].getAttribute("button")&&(!value||!nodes[i].className||!nodes[i].className.match(re))){nodes[i].style.display="none";
this.$setStyleClass(nodes[i],"",["min","max","close","edit"]);idleNodes.push(nodes[i]);
}else{found[RegExp.$1]=nodes[i];}}for(i=0;i<buttons.length;i++){if(!buttons[i]){continue;
}if(found[buttons[i]]){this.$buttons.insertBefore(found[buttons[i]],this.$buttons.firstChild);
continue;}var btn=idleNodes.pop();if(!btn){this.$getNewContext("button");btn=this.$getLayoutNode("button");
btn.setAttribute("button","button");setButtonEvents.call(this,btn);btn=apf.insertHtmlNode(btn,this.$buttons);
}this.$setStyleClass(btn,buttons[i],["min","max","close","edit"]);btn.onclick=new Function("apf.lookup("+this.$uniqueId+").$toggle('"+buttons[i]+"')");
btn.style.display="block";oButtons[buttons[i]]=btn;this.$buttons.insertBefore(btn,this.$buttons.firstChild);
}marginBox=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};function setButtonEvents(btn){btn.setAttribute("onmousedown","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, 'down', null, true);             apf.cancelBubble(event, o);              var o = apf.findHost(this).$ext;             if (o.onmousedown) o.onmousedown(event);             apf.cancelBubble(event, o);             apf.window.$mousedown(event);");
btn.setAttribute("onmouseup","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, '', ['down'], true);");
btn.setAttribute("onmouseover","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, 'hover', null, true);");
btn.setAttribute("onmouseout","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, '', ['hover', 'down'], true);");
btn.setAttribute("ondblclick","apf.stopPropagation(event);");}this.$initButtons=function(oExt){this.animate=apf.enableAnim;
this.collapsedHeight=this.$getOption("Main","collapsed-height");var oButtons=this.$getLayoutNode("main","buttons",oExt);
if(!oButtons||apf.isIphone||!this.getAttribute("buttons")||!this.$hasLayoutNode("button")){return;
}var len=(this.getAttribute("buttons")||"").split("|").length;for(var btn,i=0;i<len;
i++){this.$getNewContext("button");btn=oButtons.appendChild(this.$getLayoutNode("button"));
btn.setAttribute("button","button");setButtonEvents.call(this,btn);}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){for(var name in oButtons){oButtons[name].onclick=null;
}});};apf.BaseTab=function(){this.$init(true);};(function(){this.isPaged=true;this.$focussable=apf.KEYBOARD;
this.length=0;this.isLoading={};this.inited=this.ready=false;this.$scroll=true;
this.set=function(page,callback,noEvent){if(noEvent||this.src&&!this.$findPage(page,{})){return this.$propHandlers.activepage.call(this,page,null,null,callback,noEvent);
}if(callback&&this.activepage==page){return callback(this.getPage(page));}this.$lastCallback=callback;
this.setProperty("activepage",page);};this.$supportedProperties.push("activepage","activepagenr","length","src","loading","trans-in","trans-out");
this.$propHandlers.activepagenr=this.$propHandlers.activepage=function(next,prop,force,callback,noEvent){if(!this.inited||apf.isNot(next)){return;
}if(!callback){callback=this.$lastCallback;delete this.$lastCallback;}var page,info={};
page=this.$findPage(next,info);if(!page){if(this.src){if(this.isLoading[next]){return;
}if(this.$findPage("loading",{})){this.$propHandlers.activepage.call(this,"loading");
}this.setProperty("loading",true);this.isLoading[next]=true;page=this.ownerDocument.createElementNS(apf.ns.apf,"page");
page.setAttribute("id",next);this.appendChild(page);var _self=this;page.insertMarkup(this.src,{page:next,callback:function(options){delete _self.isLoading[next];
if(!options.xmlNode){var oError=new Error(apf.formatErrorString(0,null,"Loading new page","Could not load new page: "+_self.src));
_self.setProperty("loading",false);if(this.dispatchEvent("error",apf.extend({error:oError,bubbles:true},options))===false){return true;
}throw oError;}else{_self.setProperty("activepage",next);if(callback){callback(options.amlNode);
}_self.setProperty("loading",false);}}});return;}apf.console.warn("Setting tab page which doesn't exist,                               referenced by name: '"+next+"'");
return false;}if(page.parentNode!=this){apf.console.warn("Setting active page on page component which                               isn't a child of this tab component. Cancelling.");
return false;}if(!page.visible||page.disabled){apf.console.warn("Setting active page on page component which                               is not visible or disabled. Cancelling.");
return false;}if(next.tagName){next=info.position;this.activepage=page.name||next;
}if(!noEvent){var oEvent={previous:this.activepage,previousId:this.activepagenr,previousPage:this.$activepage,next:next,nextId:info.position,nextPage:page};
if(this.dispatchEvent("beforeswitch",oEvent)===false){if(this.hideLoader){this.hideLoader();
}return false;}}this.activepagenr=info.position;this.setProperty("activepagenr",info.position);
if(this.$activepage){this.$activepage.$deactivate();}page.$activate();if(page["trans-in"]||this.$activepage&&this.$activepage["trans-out"]){this.transition(page,page["trans-in"]||"normal",this.$activepage,this.$activepage&&this.$activepage["trans-out"]||"normal");
}this.$activepage=page;if(this.hideLoader){if(page.$rendered!==false){this.hideLoader();
}else{page.addEventListener("afterrender",function(){this.parentNode.hideLoader();
});}}if(!noEvent){if(page.$rendered!==false){this.dispatchEvent("afterswitch",oEvent);
}else{page.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterswitch",oEvent);
});}}if(typeof callback=="function"){callback(page);}return true;};this.$propHandlers.buttons=function(value){this.$scale=value.indexOf("scale")>-1;
this.$scroll=!this.$scale;if(this.$scale){this.$maxBtnWidth=parseInt(this.$getOption("button","maxwidth"))||150;
this.$minBtnWidth=parseInt(this.$getOption("button","minwidth"))||10;this.$setStyleClass(this.$buttons,"scale");
this.addEventListener("resize",scalersz);this.minwidth=this.$minBtnWidth*this.getPages().length+10;
this.$ext.style.minWidth=Math.max(0,this.minwidth-apf.getWidthDiff(this.$ext))+"px";
}else{this.$setStyleClass(this.$buttons,"",["scale"]);this.removeEventListener("resize",scalersz);
}};function visCheck(){scalersz.call(this);}var btnMoHandler;this.$scaleinit=function(node,type,callback){var pg=this.getPages();
var l=pg.length;this.minwidth=this.$minBtnWidth*l+10;this.$ext.style.minWidth=Math.max(0,this.minwidth-apf.getWidthDiff(this.$ext))+"px";
if(!apf.window.vManager.check(this,"tabscale",visCheck)){return;}if(!type){return scalersz.call(this);
}if(this.$control&&this.$control.type!="remove"&&this.$control.stop){this.$control.stop();
}var _self=this;var anim={steps:type=="remove"?8:8,control:this.$control={},anim:apf.tween.EASEOUT,interval:10,tweens:[],oHtml:node,onfinish:function(){if(!node){return;
}if(type=="add"){node.dispatchEvent("afteropen");}},onstop:function(){if(!node){return;
}if(type=="add"){node.dispatchEvent("afteropen");}else{if(type=="remove"){node.dispatchEvent("afterclose");
}}}};this.$control.type=type;if(type=="add"){var htmlNode=node.$button;htmlNode.style.width=this.$minBtnWidth+"px";
if(pg.length){scalersz.call(this,null,node);this.$buildScaleAnim(anim,pg,null,true);
}}else{if(type=="sync"){this.$buildScaleAnim(anim,pg);}else{if(type=="remove"){anim.onfinish=function(){callback();
if(_self.$waitForMouseOut==2){apf.removeListener(_self.$buttons,"mouseout",btnMoHandler);
delete _self.$waitForMouseOut;_self.$scaleinit(null,"sync");}else{if(isLast){delete _self.$waitForMouseOut;
}}node.dispatchEvent("afterclose");};anim.onstop=function(){apf.setOpacity(html,1);
};var html=node.$button;anim.tweens.push({oHtml:html,type:"width",from:html.offsetWidth-apf.getWidthDiff(html),to:0});
var over=apf.getWidthDiff(html)+this.$btnMargin;if(over){anim.tweens.push({oHtml:html,type:"marginLeft",from:0,to:-1*over});
}anim.tweens.push({oHtml:html,type:"fade",from:1,to:0});var isLast=pg[pg.length-1]==node;
if(isLast){this.$buildScaleAnim(anim,pg,node);}if(this.$activepage==node){var ln=node.nextSibling;
while(ln&&(!ln.$first||!ln.visible)){ln=ln.nextSibling;}var rn=node.previousSibling;
while(rn&&(!rn.$last||!rn.visible)){rn=rn.previousSibling;}if(ln||rn){this.set(ln||rn);
}}this.$waitForMouseOut=true;if(!isLast){if(!btnMoHandler){var _self=this;function btnMoHandler(e){var pos=apf.getAbsolutePosition(this);
if(e.clientX<=pos[0]||e.clientY<=pos[1]||e.clientX>=pos[0]+this.offsetWidth||e.clientY>=pos[1]+this.offsetHeight){apf.removeListener(_self.$buttons,"mouseout",btnMoHandler);
if(_self.$control.state==apf.tween.STOPPED){delete _self.$waitForMouseOut;_self.$scaleinit(null,"sync");
}else{if(_self.$waitForMouseOut){_self.$waitForMouseOut=2;}}}}}apf.addListener(_self.$buttons,"mouseout",btnMoHandler);
}}}}if(anim.tweens.length){apf.tween.multi(this,anim);}};this.$buildScaleAnim=function(anim,pg,excl,add){if(excl){pg=pg.slice();
pg.remove(excl);}if(!pg.length){return;}var cw=this.$buttons.offsetWidth-apf.getWidthDiff(this.$buttons);
var l=pg.length;var bw=Math.min(cw/l,this.$maxBtnWidth);var re=Math.round((bw%1)*10);
for(var wd,html,s,i=0;i<l-1;i++){s=Math.max(this.$minBtnWidth,round[i<re?1:0](bw));
cw-=s;html=pg[i].$button,wd=apf.getWidthDiff(html);anim.tweens.push({oHtml:html,type:"width",from:html.offsetWidth-wd,to:s-wd-this.$btnMargin});
}html=pg[l-1].$button,wd=apf.getWidthDiff(html);anim.tweens.push({oHtml:html,type:"width",from:html.offsetWidth-wd,to:Math.max(this.$minBtnWidth,Math.min(cw,this.$maxBtnWidth))-this.$btnMargin-wd});
};var round=[Math.floor,Math.ceil];function scalersz(e,excl){if(!this.length||this.$waitForMouseOut||this.$control&&this.$control.state==apf.tween.RUNNING){return;
}if(this.$btnMargin==undefined){this.$btnMargin=apf.getMargin(this.getPage().$button)[0];
}var pg=this.getPages();if(excl){pg.remove(excl);}if(!pg.length){return;}var cw=this.$buttons.offsetWidth-apf.getWidthDiff(this.$buttons)-(excl?excl.$button.offsetWidth+this.$btnMargin:0);
var l=pg.length;var bw=Math.min(cw/l,this.$maxBtnWidth);var re=Math.round((bw%1)*10);
for(var s,i=0;i<l-1;i++){s=Math.max(this.$minBtnWidth,round[i<re?1:0](bw));cw-=s;
if(!pg[i].$button){continue;}pg[i].$button.style.width=(s-apf.getWidthDiff(pg[i].$button)-this.$btnMargin)+"px";
}if(!pg[l-1].$button){return;}pg[l-1].$button.style.width=(Math.max(this.$minBtnWidth,Math.min(cw,this.$maxBtnWidth))-this.$btnMargin-apf.getWidthDiff(pg[l-1].$button))+"px";
}this.transition=function(pageIn,animIn,pageOut,animOut){var _self=this;if(!this.$transInfo){this.$int.style.overflow=apf.getStyle(this.$int,"overflow")||"hidden";
this.$transInfo={start:function(){var h=_self.$ext;this.size=[h.style.width,h.style.height];
var d=apf.getDiff(h);h.style.width=(h.offsetWidth-d[0])+"px";h.style.height=(h.offsetHeight-d[1])+"px";
if(this["in"]){var h=this["in"].oHtml.$ext;var d=apf.getDiff(h);h.style.width=(_self.$int.offsetWidth-d[0])+"px";
h.style.height=(_self.$int.offsetHeight-d[1])+"px";h.style.display="block";apf.tween.multi(h,this["in"]);
}if(this["out"]){var h=this["out"].oHtml.$ext;var d=apf.getDiff(h);h.style.width=(_self.$int.offsetWidth-d[0])+"px";
h.style.height=(_self.$int.offsetHeight-d[1])+"px";h.style.display="block";apf.tween.multi(h,this["out"]);
}},stop:function(){if(this["in"]&&this["in"].control.stop){this["in"].control.stop();
}if(this["out"]&&this["out"].control.stop){this["out"].control.stop();}},finish:function(){var h=_self.$ext;
h.style.width=this.size[0];h.style.height=this.size[1];if(this["in"]){var h=this["in"].oHtml.$ext;
h.style.width=this["in"].size[0];h.style.height=this["in"].size[1];h.style.display="";
h.style.position="";h.style.zIndex="";h.style.left="";h.style.top="";apf.setOpacity(h,1);
delete this["in"];}if(this["out"]){var h=this["out"].oHtml.$ext;h.style.width=this["out"].size[0];
h.style.height=this["out"].size[1];h.style.display="";h.style.position="";h.style.zIndex="";
h.style.left="";h.style.top="";apf.setOpacity(h,1);delete this["out"];}_self.oPages.style.width="";
_self.oPages.style.height="";}};}this.$transInfo.stop();var d=apf.getDiff(this.oPages);
this.oPages.style.width=(this.oPages.offsetWidth-d[0])+"px";this.oPages.style.height=(this.oPages.offsetHeight-d[1])+"px";
var preventNext=this.$createAnim(pageIn,animIn,false,pageOut);if(preventNext!==false&&pageOut){this.$createAnim(pageOut,animOut,true,pageIn);
}setTimeout(function(){_self.$transInfo.start();});};this.$cube={left:[-1,"offsetWidth","left","getHtmlInnerWidth"],right:[1,"offsetWidth","left","getHtmlInnerWidth"],top:[-1,"offsetHeight","top","getHtmlInnerHeight"],bottom:[1,"offsetHeight","top","getHtmlInnerHeight"]};
this.$createAnim=function(page,animType,out,pageOut){var _self=this;var anim={steps:apf.isIE?15:25,control:{},anim:out?apf.tween.EASEOUT:apf.tween.EASEOUT,interval:10,tweens:[],oHtml:page,size:[page.$ext.style.width,page.$ext.style.height],onfinish:function(){_self.$transInfo.finish(out);
}};this.$transInfo[out?"out":"in"]=anim;var from,to,h=page.$ext;h.style.zIndex=out?10:20;
h.style.position="absolute";h.style.left=0;h.style.top=0;h.style.display="block";
animType=animType.split("-");switch(animType[0]){case"fade":anim.anim=apf.tween.NORMAL;
if(out){h.style.zIndex=30;}anim.tweens.push(out?{type:"fade",from:1,to:0}:{type:"fade",from:0,to:1});
break;case"slide":var info=this.$cube[animType[1]];from=0;to=info[0]*h[info[1]];
if(!out){h.style[info[2]]=from+"px";}anim.tweens.push({type:info[2],from:out?from:to,to:out?to:from});
break;case"push":var info=this.$cube[animType[1]];var h2=pageOut.$ext;if(out){if(this.$transInfo["in"]){this.$transInfo["in"].tweens=[];
}}else{this.$createAnim(pageOut,"normal",true);}var hInt=apf[info[3]](this.$int);
var from1=info[0]*hInt;var to1=0;var from2=0;var to2=-1*info[0]*hInt;if(out){h2.style[info[2]]=to2+"px";
}else{h.style[info[2]]=from1+"px";}anim.tweens.push({oHtml:h,type:[info[2]],from:out?to1:from1,to:out?from1:to1});
anim.tweens.push({oHtml:h2,type:[info[2]],from:out?to2:from2,to:out?from2:to2});
return false;case"normal":break;default:throw new Error("Unknown animation type:"+animType[0]);
}};this.getPages=function(){var r=[],nodes=this.childNodes;for(var i=0,l=nodes.length;
i<l;i++){if("page|case".indexOf(nodes[i].localName)>-1&&nodes[i].visible!==false){r.push(nodes[i]);
}}return r;};this.getPage=function(nameOrId){if(apf.isNot(nameOrId)){return this.$activepage;
}else{return this.$findPage(nameOrId);}};this.add=function(caption,name,type,before,callback){var page=this.ownerDocument.createElementNS(apf.ns.aml,"page");
if(name){page.setAttribute("id",name);}if(type){page.setAttribute("type",type);
}if(caption){page.setAttribute("caption",caption);}if(callback){callback(page);
}this.insertBefore(page,before);return page;};this.remove=function(nameOrId,force){var page=typeof nameOrId=="object"?nameOrId:this.$findPage(nameOrId);
if(!page){return false;}var e={page:page};if(typeof force=="object"){e.htmlEvent=force;
force=false;}if(!force&&this.dispatchEvent("close",e)===false){return;}if(this.$scale){this.$scaleinit(page,"remove",function(){page.destroy(true,true);
});}else{page.destroy(true,true);page.dispatchEvent("afterclose");}return page;
};function getButtonsWidth(){var cId="cache_"+this.$buttons.childNodes.length;if(SCROLLANIM[cId]){return SCROLLANIM[cId];
}var iWidth=0;for(var i=0,l=this.$buttons.childNodes.length;i<l;i++){if(typeof this.$buttons.childNodes[i].offsetWidth!="undefined"){iWidth+=this.$buttons.childNodes[i].offsetWidth;
}}return SCROLLANIM[cId]=iWidth;}function setButtonState(dir,state){var bBoth=dir&SCROLL_BOTH;
if(bBoth){dir=SCROLL_LEFT;}var oBtn=this[dir&SCROLL_LEFT?"oLeftScroll":"oRightScroll"];
if(!(state&SCROLL_DIS)){if(dir&SCROLL_LEFT){SCROLL_L_STATE=state;}else{SCROLL_R_STATE=state;
}}if(state&SCROLL_OFF){apf.setStyleClass(oBtn,"",["disabled","hover","down"]);}else{if(state&SCROLL_HOVER){apf.setStyleClass(oBtn,"hover",["disabled","down"]);
}else{if(state&SCROLL_DOWN){apf.setStyleClass(oBtn,"down",["disabled","hover"]);
}else{if(state&SCROLL_DIS){apf.setStyleClass(oBtn,"disabled",["hover","down"]);
}}}}if(bBoth){setButtonState(SCROLL_RIGHT,state);}}this.setScrollerState=function(bOn,iBtns){if(!this.ready||!this.$hasButtons||!this.oScroller){return;
}if(typeof bOn=="undefined"){var scrollerWidth=this.oScroller.offsetWidth||parseInt(apf.getStyle(this.oScroller,"width").replace(/(px|em|%)/,""));
bOn=((getButtonsWidth.call(this)+scrollerWidth)>this.$ext.offsetWidth);iBtns=SCROLL_BOTH;
}if(iBtns&SCROLL_BOTH&&bOn!==SCROLLANIM.scrollOn){SCROLLANIM.scrollOn=bOn;if(!bOn){this.$buttons.style.left=SCROLLANIM.left+"px";
this.oScroller.style.display="none";}}else{this.oScroller.style.display="";}this.oScroller.style.display=(iBtns&SCROLL_BOTH&&!bOn)?"none":"";
if(typeof iBtns=="undefined"){iBtns=SCROLL_BOTH;}if(!bOn){if((iBtns&SCROLL_LEFT)||(iBtns&SCROLL_BOTH)){setButtonState.call(this,SCROLL_LEFT,SCROLL_DIS);
}if((iBtns&SCROLL_RIGHT)||(iBtns&SCROLL_BOTH)){setButtonState.call(this,SCROLL_RIGHT,SCROLL_DIS);
}}};this.correctScrollState=function(){if(!this.ready||!this.$hasButtons||!this.oScroller){return;
}this.setScrollerState();};function getAnimationBoundary(dir,useCache){if(SCROLLANIM.size<=0){SCROLLANIM.left=this.$buttons.offsetLeft;
SCROLLANIM.size=Math.round(this.firstChild.$button.offsetWidth);}if(dir&SCROLL_LEFT){return SCROLLANIM.left;
}else{if(dir&SCROLL_RIGHT){var oNode=this.$buttons.childNodes[this.$buttons.childNodes.length-1];
return this.$ext.offsetWidth-(oNode.offsetLeft+oNode.offsetWidth+(this.oScroller.offsetWidth+4));
}}}this.scroll=function(e,dir){if(!this.ready||!this.$hasButtons||!this.oScroller){return;
}if(!e){e=window.event;}if(typeof e.type=="unknown"){e={type:"click"};}if(bAnimating&&e.type!="dblclick"){return;
}bAnimating=true;if(typeof dir=="undefined"){dir=SCROLL_LEFT;}var iCurrentLeft=this.$buttons.offsetLeft,size=e.delta?Math.round(e.delta*36):SCROLLANIM.size,iBoundary=getAnimationBoundary.call(this,dir),_self=this;
if(dir&SCROLL_LEFT){setButtonState(SCROLL_LEFT,SCROLL_DOWN);setButtonState(SCROLL_RIGHT,SCROLL_OFF);
if(iCurrentLeft===iBoundary){this.setScrollerState(false,SCROLL_LEFT);return apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:20,from:iCurrentLeft,to:iCurrentLeft+12,type:"left",anim:apf.tween.EASEOUT,onstop:SCROLLANIM.stopHandle,onfinish:function(oNode){apf.tween.single(oNode,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,from:iCurrentLeft+12,to:iCurrentLeft,type:"left",anim:apf.tween.EASEIN,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_LEFT,SCROLL_OFF);}}});}});}var iTargetLeft=iCurrentLeft+(e.type=="dblclick"?size*3:size);
if(iTargetLeft>iBoundary){iTargetLeft=iBoundary;}if(iTargetLeft===iBoundary){this.setScrollerState(false,SCROLL_LEFT);
}this.setScrollerState(true,SCROLL_RIGHT);apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,control:SCROLLANIM.control,from:iCurrentLeft,to:iTargetLeft,type:"left",anim:apf.tween.NORMAL,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_LEFT,SCROLL_OFF);}if(keepScrolling){_self.scroll(e,globalDir);
}}});}else{if(dir&SCROLL_RIGHT){this.setScrollerState(true);setButtonState(SCROLL_RIGHT,SCROLL_DOWN);
setButtonState(SCROLL_LEFT,SCROLL_OFF);if(iCurrentLeft===iBoundary){this.setScrollerState(false,SCROLL_RIGHT);
return apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:20,from:iCurrentLeft,to:iCurrentLeft-24,type:"left",anim:apf.tween.EASEOUT,onstop:SCROLLANIM.stopHandle,onfinish:function(oNode,options){apf.tween.single(oNode,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,from:iCurrentLeft-24,to:iCurrentLeft,type:"left",anim:apf.tween.EASEIN,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_RIGHT,SCROLL_OFF);}}});}});}var iTargetLeft=iCurrentLeft-(e.type=="dblclick"?size*3:size);
if(iTargetLeft<iBoundary){iTargetLeft=iBoundary;}apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,control:SCROLLANIM.control,from:iCurrentLeft,to:iTargetLeft,type:"left",anim:apf.tween.NORMAL,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_RIGHT,SCROLL_OFF);}if(keepScrolling){_self.scroll(e,globalDir);
}}});}}};this.scrollIntoView=function(oPage){bAnimating=false;if(!this.ready||!this.$hasButtons||!this.oScroller||!oPage.$drawn){return;
}bAnimating=true;if(this.$buttons.offsetWidth<this.$ext.offsetWidth){return this.setScrollerState(false);
}var iTabLeft=oPage.$button.offsetLeft,iTabWidth=oPage.$button.offsetWidth,iCurrentLeft=this.$buttons.offsetLeft;
if(SCROLLANIM.size<=0){SCROLLANIM.left=this.$buttons.offsetLeft;var p=this.firstChild;
while(!p.$button){p=p.nextSibling;}SCROLLANIM.size=Math.round(p.$button.offsetWidth);
}this.$buttons.style.left=iCurrentLeft;var iRealWidth=this.$ext.offsetWidth,iScrollCorr=this.oScroller.offsetWidth+4,iTargetLeft=null,dir;
if((iTabLeft+iTabWidth)>((iRealWidth-iScrollCorr)-iCurrentLeft)){iTargetLeft=(-(iTabLeft-SCROLLANIM.left)+(iRealWidth-iTabWidth-iScrollCorr));
dir=SCROLL_RIGHT;}else{if((iCurrentLeft+iTabLeft)<SCROLLANIM.left){iTargetLeft=SCROLLANIM.left-iTabLeft;
dir=SCROLL_LEFT;}}if(iTargetLeft!==null){this.setScrollerState(true);setButtonState(SCROLL_RIGHT,dir&SCROLL_RIGHT?SCROLL_DOWN:SCROLL_OFF);
setButtonState(SCROLL_LEFT,dir&SCROLL_LEFT?SCROLL_DOWN:SCROLL_OFF);apf.tween.clearQueue(this.$buttons,true);
apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,from:iCurrentLeft,to:iTargetLeft,type:"left",anim:apf.tween.NORMAL,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
setButtonState(SCROLL_RIGHT,SCROLL_OFF);setButtonState(SCROLL_LEFT,SCROLL_OFF);
}});}else{bAnimating=false;}};this.addEventListener("DOMNodeRemoved",function(e){var amlNode=e.currentTarget;
if(e.$doOnlyAdmin||e.relatedNode!=this||amlNode.localName!="page"){return;}var ln=amlNode.nextSibling;
while(ln&&(!ln.$first||!ln.visible)){ln=ln.nextSibling;}var rn=amlNode.previousSibling;
while(rn&&(!rn.$last||!rn.visible)){rn=rn.previousSibling;}if(this.firstChild==amlNode&&ln){ln&&ln.$first();
}if(this.lastChild==amlNode&&rn){rn&&rn.$last();}if(this.$activepage==amlNode){if(ln||rn){this.set(ln||rn);
}else{amlNode.$deactivate();this.$activepage=this.activepage=this.activepagenr=null;
this.setProperty("activepage",null);}}else{if(this.$scale){this.$scaleinit();}}this.setProperty("length",this.childNodes.length);
});this.addEventListener("DOMNodeInserted",function(e){var amlNode=e.currentTarget;
if(amlNode.localName!="page"||e.relatedNode!=this||amlNode.nodeType!=1){return;
}if(!e.$beforeNode){var lastChild,pg=this.getPages();if(lastChild=pg[pg.length-1]){lastChild.$last(true);
}amlNode.$last();}var p=this.getPage(0);if(!p||e.$beforeNode==p){if(p){p.$first(true);
}amlNode.$first();}if(this.$activepage){var info={};this.$findPage(this.$activepage,info);
if(this.activepagenr!=info.position){if(parseInt(this.activepage)==this.activepage){this.activepage=info.position;
this.setProperty("activepage",info.position);}this.activepagenr=info.position;this.setProperty("activepagenr",info.position);
}}else{if(!this.$activepage){this.set(amlNode);}}if(this.$scale&&amlNode.visible){this.$scaleinit(amlNode,"add");
}else{amlNode.dispatchEvent("afteropen");}this.setProperty("length",this.childNodes.length);
});this.$findPage=function(nameOrId,info){var node,nodes=this.childNodes;if(nameOrId.localName){for(var t=0,i=0,l=nodes.length;
i<l;i++){node=nodes[i];if("page|case".indexOf(node.localName)>-1&&(++t)&&node==nameOrId){if(info){info.position=t-1;
}return node;}}}else{for(var t=0,i=0,l=nodes.length;i<l;i++){node=nodes[i];if("page|case".indexOf(node.localName)>-1&&(t++==nameOrId||node.name==nameOrId)){if(info){info.position=t-1;
}return node;}}}return null;};this.$enable=function(){var nodes=this.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(nodes[i].enable){nodes[i].enable();}}};this.$disable=function(){var nodes=this.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(nodes[i].disable){nodes[i].disable();}}};
this.addEventListener("keydown",function(e){if(!this.$hasButtons){return;}var page,key=e.keyCode;
switch(key){case 9:break;case 13:break;case 32:break;case 37:page=this.getPage().previousSibling;
while(page&&(page.nodeType!=1||"page|case".indexOf(page.localName)==-1||!page.visible)){page=page.previousSibling;
}if(page){this.setProperty("activepage",page);}break;case 39:page=this.getPage().nextSibling;
while(page&&(page.nodeType!=1||"page|case".indexOf(page.localName)==-1||!page.visible)){page=page.nextSibling;
}if(page){this.setProperty("activepage",page);}break;default:return;}},true);this.$loadChildren=function(callback){var page=false,_self=this,i,j,l,node,nodes;
this.inited=true;if(this.$hasButtons){this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);
this.$buttons.setAttribute("id",this.$uniqueId+"_buttons");}this.oPages=this.$getLayoutNode("main","pages",this.$ext);
if(this.$int){this.$int=this.oPages;page=true;nodes=this.childNodes;for(i=0;i<nodes.length;
i++){node=nodes[i];if(node.nodeType!=1){continue;}node.$draw(true);if(node.$skinchange){node.$skinchange();
}node.$loadAml();}}else{this.$int=this.oPages;nodes=this.getPages();if(nodes.length){nodes[0].$first();
(node=nodes[nodes.length-1]).$last();}}if(node){this.activepage=(typeof this.activepage!="undefined"?this.activepage:this.activepagenr)||0;
page=this.getPage(this.activepage);if(page.render!="runtime"||page.$rendered){this.$propHandlers.activepage.call(this,this.activepage);
}}else{this.isPages=false;}this.setProperty("length",j);this.ready=true;if(!this.activepage&&this.getAttribute("src")){this.src=this.getAttribute("src");
this.$propHandlers.activepage.call(this);}};this.$destroy=function(bSkinChange){if(bSkinChange||!this.oScroller){return;
}};}).call(apf.BaseTab.prototype=new apf.Presentation());apf.BaseTree=function(){this.$init(true);
this.$dynCssClasses=[];this.$nodes=[];};(function(){this.implement(apf.Rename,apf.DataAction,apf.Cache,apf.K);
this.$isTreeArch=true;this.$focussable=true;this.multiselect=false;this.bufferselect=true;
this.startcollapsed=true;this.$animType=apf.tween.NORMAL;this.$animOpenStep=3;this.$animCloseStep=1;
this.$animSpeed=10;var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;
var treeState=this.$treeState={};this.$treeState[0]="";this.$treeState[HAS_CHILD]="min";
this.$treeState[HAS_CHILD|IS_CLOSED]="plus";this.$treeState[IS_LAST]="last";this.$treeState[IS_LAST|HAS_CHILD]="minlast";
this.$treeState[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";this.$treeState[IS_ROOT]="root";
this.$booleanProperties.openadd=true;this.$booleanProperties.startcollapsed=true;
this.$booleanProperties.nocollapse=true;this.$booleanProperties.singleopen=true;
this.$booleanProperties.prerender=true;this.$booleanProperties.removecontainer=true;
this.$supportedProperties.push("openadd","startcollapsed","nocollapse","singleopen","prerender","removecontainer");
this.openadd=true;this.startcollapsed=1;this.prerender=true;this.expandAll=function(){if(!this.xmlRoot){return;
}var xpath=this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"),_self=this;
(function(node){var nodes=node.selectNodes(xpath);for(var o,i=0;i<nodes.length;
i++){if(o=apf.xmldb.getHtmlNode(nodes[i],_self)){_self.slideToggle(o,1,true);}arguments.callee(nodes[i]);
}})(this.xmlRoot);};this.collapseAll=function(){if(!this.xmlRoot){return;}var pNodes=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"));
for(var o,i=pNodes.length-1;i>=0;i--){if(o=apf.xmldb.getHtmlNode(pNodes[i],this)){this.slideToggle(o,2,true);
}}};this.expandAndSelect=function(xmlNode){if(!this.xmlRoot){return;}var _self=this;
if((function _recur(loopNode){var pNode=_self.getTraverseParent(loopNode);if(pNode==_self.xmlRoot){return true;
}if(!pNode||_recur(pNode)===false){return false;}_self.slideToggle(apf.xmldb.getHtmlNode(pNode,_self),1,true);
})(xmlNode)!==false){this.select(xmlNode);}};this.expandList=function(pathList,callback){pathList.sort();
var root=this.xmlRoot,_self=this;apf.asyncForEach(pathList,function(item,next){var paths=item.split("/");
var lastNode=root;apf.asyncForEach(paths,function(part,next2,index){apf.queue.empty();
setTimeout(function(){var xmlNode=(lastNode||root).selectSingleNode(part);if(xmlNode){lastNode=xmlNode;
_self.slideToggle(apf.xmldb.getHtmlNode(xmlNode,_self),1,true,null,function(){next2();
});}else{_self.slideToggle(apf.xmldb.getHtmlNode(lastNode,_self),1,true,null,function(){lastNode=lastNode.selectSingleNode(part);
if(!lastNode){next2(true);}else{next2();}});}},100);},function(err){next();});},function(err){if(callback){callback();
}});};this.selectPath=function(path){};this.slideToggle=function(htmlNode,force,immediate,userAction,callback){if(this.nocollapse||userAction&&this.disabled){return;
}if(!htmlNode){htmlNode=this.$selected;}if(!htmlNode){return callback&&callback();
}var id=htmlNode.getAttribute(apf.xmldb.htmlIdTag);while(!id&&htmlNode.parentNode){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}var container=this.$getLayoutNode("item","container",htmlNode);if(!container){return;
}if(apf.getStyle(container,"display")=="block"){if(force==1){if(callback){callback();
}return;}htmlNode.className=htmlNode.className.replace(/min/,"plus");this.slideClose(container,apf.xmldb.getNode(htmlNode),immediate,callback);
}else{if(force==2){if(callback){callback();}return;}htmlNode.className=htmlNode.className.replace(/plus/,"min");
this.slideOpen(container,apf.xmldb.getNode(htmlNode),immediate,callback);}};this.isCollapsed=function(xmlNode){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(xmlNode,this)),"display")=="none");
};var lastOpened={};this.slideOpen=function(container,xmlNode,immediate,callback){if(!xmlNode){xmlNode=this.selected;
}var htmlNode=apf.xmldb.getHtmlNode(xmlNode,this);if(!container){container=this.$findContainer(htmlNode);
}if(!container.childNodes.length&&!this.getTraverseNodes(xmlNode).length){return callback&&callback();
}if(this.singleopen){var pNode=this.getTraverseParent(xmlNode),p=(pNode||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);
if(lastOpened[p]&&lastOpened[p][1]!=xmlNode&&this.getTraverseParent(lastOpened[p][1])==pNode){this.slideToggle(lastOpened[p][0],2);
}lastOpened[p]=[htmlNode,xmlNode];}if(!this.nocollapse){container.style.display="block";
}if(!this.prerender&&this.$hasLoadStatus(xmlNode,"potential")&&!container.childNodes.length){this.$extend(xmlNode,container,immediate,callback);
return;}if(immediate||container.scrollHeight>1000){if(!this.nocollapse&&container!=this.$container){container.style.height="auto";
container.style.overflow="visible";}if(this.$hasLoadStatus(xmlNode,"potential")){return this.$extend(xmlNode,container,immediate,callback);
}this.dispatchEvent("expand",{xmlNode:xmlNode});return callback&&callback();}var _self=this;
var prevHeight=container.style.height;container.style.overflow="visible";if(!apf.isIE7){container.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";
}var height=container.scrollHeight;container.style.overflow="hidden";container.style.height=prevHeight;
apf.tween.single(container,{type:"scrollheight",from:container.offsetHeight,to:height,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(container){if(xmlNode&&_self.$hasLoadStatus(xmlNode,"potential")){$setTimeout(function(){if(container!=this.$container){container.style.height=container.scrollHeight+"px";
container.style.overflow="hidden";}_self.$extend(xmlNode,container,null,callback);
});if(container!=this.$container){if(!apf.isIE7){container.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";
}container.style.overflow="visible";}}else{if(container!=this.$container){container.style.overflow="visible";
if(!apf.isIE7){container.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";}}}_self.dispatchEvent("expand",{xmlNode:xmlNode});
}});};this.slideClose=function(container,xmlNode,immediate){if(this.nocollapse){return;
}if(!xmlNode){xmlNode=this.selected;}if(this.singleopen){var p=(this.getTraverseParent(xmlNode)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);
lastOpened[p]=null;}if(!container){var htmlNode=apf.xmldb.getHtmlNode(xmlNode,this);
container=this.$findContainer(htmlNode);}if(container!=this.$container){container.style.height=container.offsetHeight;
container.style.overflow="hidden";}if(immediate){if(container!=this.$container){container.style.height=0;
}container.style.display="none";this.dispatchEvent("collapse",{xmlNode:xmlNode});
return;}var _self=this;apf.tween.single(container,{type:"scrollheight",from:container.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(container,data){container.style.display="none";
_self.dispatchEvent("collapse",{xmlNode:xmlNode});}});};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode,isLast,depth,nextNode,action){if(this.$isTreeArch&&this.$needsDepth&&typeof depth=="undefined"){var loopNode=xmlParentNode;
depth=0;while(loopNode!=this.xmlRoot){depth++;loopNode=loopNode.parentNode;}}var loadChildren=this.$getBindRule("insert",xmlNode)?true:false,traverseNodes=this.getTraverseNodes(xmlNode),hasTraverseNodes=traverseNodes.length?true:false,hasChildren=loadChildren||hasTraverseNodes,startcollapsed=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",xmlNode)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",xmlNode)?false:true):this.startcollapsed),state=(hasChildren?HAS_CHILD:0)|(startcollapsed&&hasChildren||loadChildren?IS_CLOSED:0)|(isLast?IS_LAST:0),htmlNode=this.$initNode(xmlNode,state,Lid,depth),container=this.$getLayoutNode("item","container",htmlNode),eachLength;
if(!startcollapsed&&!this.nocollapse){container.setAttribute("style","overflow:visible;height:auto;display:block;");
}var msg,removeContainer=(!this.removecontainer||hasChildren);if(!hasChildren||loadChildren){container.setAttribute("style","display:none;");
}if(!this.prerender){eachLength=traverseNodes.length;}if(hasChildren&&!this.prerender&&eachLength>2&&startcollapsed||loadChildren&&(!this.$hasLoadStatus(xmlNode)||this.$hasLoadStatus(xmlNode,"potential"))){this.$setLoading(xmlNode,container);
}else{if(!hasTraverseNodes&&(msg=this.$applyBindRule("empty",xmlNode))){this.$setEmptyMessage(container,msg);
}}if((!htmlParentNode||htmlParentNode==this.$container)&&xmlParentNode==this.xmlRoot&&!beforeNode||action=="insert"){this.$nodes.push(htmlNode);
if(!apf.isChildOf(htmlNode,container,true)&&removeContainer){this.$nodes.push(container);
}if(action!="insert"){this.$setStyleClass(htmlNode,"root");this.$setStyleClass(container,"root");
}}else{if(!htmlParentNode){htmlParentNode=apf.xmldb.getHtmlNode(xmlNode.parentNode,this);
htmlParentNode=htmlParentNode?this.$getLayoutNode("item","container",htmlParentNode):this.$container;
}if(htmlParentNode==this.$container){this.$setStyleClass(htmlNode,"root");this.$setStyleClass(container,"root");
}var next;if(!beforeNode&&(next=this.getNextTraverse(xmlNode))){beforeNode=apf.xmldb.getHtmlNode(next,this);
}if(beforeNode&&beforeNode.parentNode!=htmlParentNode){beforeNode=null;}if(htmlParentNode.style&&this.getTraverseNodes(xmlNode.parentNode).length==1){this.$removeEmptyMessage(htmlParentNode);
}if(htmlParentNode.style){var isChildOfHtmlNode=!apf.isChildOf(htmlNode,container,true);
htmlNode=apf.insertHtmlNode(htmlNode,htmlParentNode,beforeNode);if(isChildOfHtmlNode&&removeContainer){var container=apf.insertHtmlNode(container,htmlParentNode,beforeNode);
}else{var container=this.$getLayoutNode("item","container",htmlNode);}}else{htmlParentNode.insertBefore(htmlNode,beforeNode);
if(!apf.isChildOf(htmlNode,container,true)&&removeContainer){htmlParentNode.insertBefore(container,beforeNode);
}}if(htmlParentNode.style){if(this.openadd&&htmlParentNode!=this.$container&&htmlParentNode.style.display!="block"){this.slideOpen(htmlParentNode,xmlParentNode,true);
}if(!this.$fillParent){this.$fillParent=xmlParentNode;}var next=nextNode==undefined?this.getNextTraverse(xmlNode,true):nextNode;
var html;if(next&&(html=apf.xmldb.getHtmlNode(next,this))){this.$fixItem(next,html);
}}}if((this.prerender||eachLength<3||!startcollapsed)&&(xmlNode.namespaceURI!=apf.ns.apf||xmlNode.localName!="item")){this.$addNodes(xmlNode,container,false,null,null,(depth||0)+1);
}return container;};this.$fill=function(){if(this.$useiframe){this.$pHtmlDoc=this.oDoc;
}if(this.$nodes.length){apf.insertHtmlNodes(this.$nodes,this.$fillParentHtml||this.$container);
this.$nodes.length=0;delete this.$fillParentHtml;}if(this.$fillParent){this.$fixItem(this.$fillParent,apf.xmldb.getHtmlNode(this.$fillParent,this));
delete this.$fillParent;}};this.$getParentNode=function(htmlNode){return htmlNode?this.$getLayoutNode("item","container",htmlNode):this.$container;
};this.$fixItem=function(xmlNode,htmlNode,isDeleting,oneLeft,noChildren){if(!htmlNode){return;
}if(isDeleting){var prevSib;if(prevSib=this.getNextTraverse(xmlNode,true)){this.$fixItem(prevSib,this.$findHtmlNode(prevSib.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);
}if(!this.emptyMessage&&xmlNode.parentNode.selectNodes(this.each).length==1){this.$fixItem(xmlNode.parentNode,this.$findHtmlNode(xmlNode.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);
}}else{var container=this.$getLayoutNode("item","container",htmlNode),hasChildren=false;
if(noChildren){hasChildren=false;}else{if(this.getTraverseNodes(xmlNode).length>0){hasChildren=true;
}else{if(this.$hasLoadStatus(xmlNode,"potential")){hasChildren=true;}else{hasChildren=false;
}}}var isClosed=hasChildren&&htmlNode.className.indexOf("plus")>-1;isLast=this.getNextTraverse(xmlNode,null,oneLeft?2:1)?false:true,state=(hasChildren?HAS_CHILD:0)|(isClosed?IS_CLOSED:0)|(isLast?IS_LAST:0);
this.$setStyleClass(this.$getLayoutNode("item","class",htmlNode),treeState[state],["min","plus","last","minlast","pluslast"]);
this.$setStyleClass(this.$getLayoutNode("item","container",htmlNode),treeState[state],["min","plus","last","minlast","pluslast"]);
if(this.$getLayoutNode("item","openclose",htmlNode)){this.$getLayoutNode("item","openclose",htmlNode).setAttribute("children",hasChildren);
}if(container){if(!hasChildren){container.style.display="none";}else{if(!isClosed){container.style.display="block";
}}}}};this.$deInitNode=function(xmlNode,htmlNode){var containerNode=this.$getLayoutNode("item","container",htmlNode),pContainer=htmlNode.parentNode;
containerNode.parentNode.removeChild(containerNode);pContainer.removeChild(htmlNode);
if(this.$withContainer){htmlNode.parentNode.removeChild(htmlNode.nextSibling);}if(xmlNode.parentNode!=this.xmlRoot){this.$fixItem(xmlNode,htmlNode,true);
}var msg;if(!pContainer.childNodes.length&&(msg=this.$applyBindRule("empty",xmlNode))){this.$setEmptyMessage(pContainer,msg);
}this.$fixItem(xmlNode,htmlNode,true);};this.$moveNode=function(xmlNode,htmlNode,oldXmlParent){if(!self.apf.debug&&!htmlNode){return;
}var container;if(this.$hasLoadStatus(xmlNode.parentNode,"potential")){container=this.$getLayoutNode("item","container",htmlNode);
htmlNode.parentNode.removeChild(htmlNode);container.parentNode.removeChild(container);
this.$extend(xmlNode.parentNode);return;}var oPHtmlNode=htmlNode.parentNode,tParent=this.getTraverseParent(xmlNode),pHtmlNode=apf.xmldb.getHtmlNode(tParent,this),nSibling=this.getNextTraverse(xmlNode),beforeNode=nSibling?apf.xmldb.getHtmlNode(nSibling,this):null,pContainer=pHtmlNode?this.$getLayoutNode("item","container",pHtmlNode):this.$container;
container=this.$getLayoutNode("item","container",htmlNode);if(pContainer!=oPHtmlNode&&this.getTraverseNodes(xmlNode.parentNode).length==1){this.$removeEmptyMessage(pContainer);
}pContainer.insertBefore(htmlNode,beforeNode);if(container){pContainer.insertBefore(container,beforeNode);
}var msg;if(!this.getTraverseNodes(oldXmlParent).length&&(msg=this.$applyBindRule("empty",oldXmlParent))){this.$setEmptyMessage(oPHtmlNode,msg);
}this.$fixItem(xmlNode,htmlNode);this.$fixItem(tParent,apf.xmldb.getHtmlNode(tParent,this));
this.$updateNode(oldXmlParent,apf.xmldb.getHtmlNode(oldXmlParent,this));var next;
if(next=this.getNextTraverse(xmlNode,true)){this.$fixItem(next,apf.xmldb.getHtmlNode(next,this));
}};this.$setLoading=function(xmlNode,container){this.$setLoadStatus(xmlNode,"potential");
var len=this.getTraverseNodes(xmlNode).length;if(!len||len>20){this.$getNewContext("loading");
apf.insertHtmlNode(this.$getLayoutNode("loading"),container);}};this.$removeLoading=function(htmlNode){if(!htmlNode){return;
}this.$getLayoutNode("item","container",htmlNode).innerHTML="";};this.$extend=function(xmlNode,container,immediate,callback){if(!this.$hasLoadStatus(xmlNode,"potential")){return;
}var rule=this.$getBindRule("insert",xmlNode),xmlContext=rule&&rule.match?(rule.cmatch||rule.compile("match"))(xmlNode):xmlNode;
if(rule&&xmlContext){this.$setLoadStatus(xmlNode,"loading");if(rule.get){if(!apf.offline.onLine){apf.offline.transactions.actionNotAllowed();
this.slideClose(container,xmlNode);return;}this.getModel().$insertFrom(rule.getAttribute("get"),{xmlNode:xmlContext,insertPoint:xmlContext,amlNode:this,callback:callback});
}else{if(this.$applyBindRule("insert",xmlNode)){this.insert(data,{insertPoint:xmlContext});
}}}else{if(!this.prerender){this.$setLoadStatus(xmlNode,"loaded");this.$removeLoading(apf.xmldb.getHtmlNode(xmlNode,this));
xmlUpdateHandler.call(this,{action:"insert",xmlNode:xmlNode,result:this.$addNodes(xmlNode,container,true),anim:!immediate});
}}};function xmlUpdateHandler(e){if(e.action=="move-away"){this.$fixItem(e.xmlNode,apf.xmldb.findHtmlNode(e.xmlNode,this),true);
}if(e.action!="insert"){return;}var htmlNode=this.$findHtmlNode(e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(!htmlNode){return;}if(e.action=="insert"&&e.result.length>0){if(this.$hasLoadStatus(e.xmlNode,"loaded",true)){var container=this.$getLayoutNode("item","container",htmlNode);
this.slideOpen(container,e.xmlNode);}else{if(this.$hasLoadStatus(e.xmlNode,"potential",true)){this.$setLoadStatus(e.xmlNode,"loaded");
}}}else{this.$fixItem(e.xmlNode,htmlNode);}}this.addEventListener("xmlupdate",xmlUpdateHandler);
this.addEventListener("beforerename",function(){if(this.$tempsel){clearTimeout(this.timer);
this.select(this.$tempsel);this.$tempsel=null;this.timer=null;}});this.addEventListener("keydown",function(e){var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,selHtml=this.$caret||this.$selected,pos,top,el,node,nodes,sNode,pNode,container;
if(e.returnValue==-1||!selHtml||this.renaming){return;}var selXml=this.caret||this.selected,oExt=this.$container;
switch(key){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);
}this.choose(selHtml);break;case 32:if(this.$tempsel){this.$selectTemp();}if(this.$mode&&!ctrlKey){var sel=this.getSelection();
if(!sel.length||!this.multiselect){this.checkToggle(this.caret,true);}else{this.checkList(sel,this.isChecked(this.selected),true,false,true);
}}else{if(ctrlKey||!this.isSelected(this.caret)){this.select(this.caret,true);}}return false;
case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.caret);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,shiftKey);
oExt.scrollTop=0;return false;case 35:var lastNode=this.getLastTraverseNode();while(!this.isCollapsed(lastNode)){lastNode=this.getLastTraverseNode(lastNode);
}this.$setTempSelected(lastNode,false,shiftKey,true);oExt.scrollTop=oExt.scrollHeight;
return false;case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)&&!this.isCollapsed(this.caret)){this.slideToggle(this.$caret||this.$selected,2);
}else{if((pNode=this.getTraverseParent(this.caret))&&pNode!=this.xmlRoot){this.select(pNode);
}}return false;case 107:case 187:case 39:if(this.$tempsel){this.$selectTemp();}if(this.$hasLoadStatus(this.caret,"potential")||this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,1);
}break;case 109:case 189:if(this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,2);
}break;case 38:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
sNode=this.getNextTraverse(node,true);if(sNode){nodes=this.getTraverseNodes(sNode);
do{container=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(sNode,this)));
if(container&&apf.getStyle(container,"display")=="block"&&nodes.length){sNode=nodes[nodes.length-1];
}else{break;}}while(sNode&&(nodes=this.getTraverseNodes(sNode)).length);}else{if(this.getTraverseParent(node)==this.xmlRoot){this.dispatchEvent("selecttop");
return;}else{sNode=this.getTraverseParent(node);}}if(sNode&&sNode.nodeType==1){this.$setTempSelected(sNode,ctrlKey,shiftKey,true);
}else{return false;}selHtml=apf.xmldb.getHtmlNode(sNode,this);top=apf.getAbsolutePosition(selHtml,this.$container)[1]-(selHtml.offsetHeight);
if(top<=oExt.scrollTop){oExt.scrollTop=top;}return false;case 40:if(!selXml&&!this.$tempsel){return;
}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;sNode=this.getFirstTraverseNode(node);
if(sNode){container=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(node,this)));
if(container&&apf.getStyle(container,"display")!="block"){sNode=null;}}while(!sNode){pNode=this.getTraverseParent(node);
if(!pNode){break;}var i=0;nodes=this.getTraverseNodes(pNode);while(nodes[i]&&nodes[i]!=node){i++;
}sNode=nodes[i+1];node=pNode;}if(sNode&&sNode.nodeType==1){this.$setTempSelected(sNode,ctrlKey,shiftKey);
}else{return false;}selHtml=apf.xmldb.getHtmlNode(sNode,this);top=apf.getAbsolutePosition(selHtml,this.$container)[1]+(selHtml.offsetHeight);
if(top>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=top-oExt.offsetHeight;}return false;
case 33:pos=apf.getAbsolutePosition(this.$container);el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+2);
sNode=apf.xmldb.findXmlNode(el);if(sNode==this.selected){oExt.scrollTop-=oExt.offsetHeight-apf.getHeightDiff(oExt);
el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+2);sNode=apf.xmldb.findXmlNode(el);
}this.select(sNode);selHtml=apf.xmldb.getHtmlNode(sNode,this);top=apf.getAbsolutePosition(selHtml,this.$container)[1]-(selHtml.offsetHeight);
if(top<=oExt.scrollTop){oExt.scrollTop=top;}break;case 34:pos=apf.getAbsolutePosition(this.$container);
el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+this.$ext.offsetHeight-4);
sNode=apf.xmldb.findXmlNode(el);if(sNode==this.selected){oExt.scrollTop+=oExt.offsetHeight-apf.getHeightDiff(oExt);
el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+this.$ext.offsetHeight-4);
sNode=apf.xmldb.findXmlNode(el);}this.select(sNode);selHtml=apf.xmldb.getHtmlNode(sNode,this);
top=apf.getAbsolutePosition(selHtml,this.$container)[1]+(selHtml.offsetHeight);
if(top>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=top-oExt.offsetHeight;}break;
default:if(this.celledit){if(!ctrlKey&&!e.altKey&&(key>46&&key<112||key>123)){this.startRename(null,true);
}return;}else{if(key==65&&ctrlKey){this.selectAll();return false;}else{if(this.caption||(this.bindingRules||{})["caption"]){if(!this.xmlRoot){return;
}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};
}this.lookup.str+=String.fromCharCode(key);var nodes=this.getTraverseNodes();for(var v,i=0;
i<nodes.length;i++){v=this.$applyBindRule("caption",nodes[i]);if(v&&v.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(nodes[i])){this.select(nodes[i]);
}if(selHtml){this.$container.scrollTop=selHtml.offsetTop-(this.$container.offsetHeight-selHtml.offsetHeight)/2;
}return;}}return;}}}break;}},true);this.$getCaptionElement=function(){if(!this.$selected){return false;
}var x=this.$getLayoutNode("item","caption",this.$selected);return x.nodeType==1?x:x.parentNode;
};this.$calcSelectRange=function(xmlStartNode,xmlEndNode){var r=[],f=false,i=0,pNodeStart=this.getTraverseParent(xmlStartNode),pNodeEnd=this.getTraverseParent(xmlEndNode),nodes=this.getTraverseNodes(pNodeStart);
for(;i<nodes.length;i++){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);
}if(nodes[i]==xmlEndNode){f=false;}}if(!r.length||f){r=[];for(f=false,i=nodes.length-1;
i>=0;i--){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);}if(nodes[i]==xmlEndNode){f=false;
}}}return r;};this.$findContainer=function(htmlNode){return this.$getLayoutNode("item","container",htmlNode);
};this.$selectDefault=function(xmlNode){if(this.select(this.getFirstTraverseNode(xmlNode),null,null,null,true)){return true;
}else{var nodes=this.getTraverseNodes(xmlNode);for(var i=0;i<nodes.length;i++){if(this.$selectDefault(nodes[i])){return true;
}}}};this.$setEmptyMessage=function(htmlNode,msg){this.$getNewContext("empty");
var xmlEmpty=this.$getLayoutNode("empty");if(!xmlEmpty){return;}var empty=apf.insertHtmlNode(xmlEmpty,htmlNode);
empty.setAttribute("empty","true");var caption=this.$getLayoutNode("empty","caption",empty);
if(caption){apf.setNodeValue(caption,msg||"");}if(htmlNode.style){this.slideOpen(htmlNode,null,true);
}else{if(this.nocollapse){htmlNode.setAttribute("style","display:inline-block;");
}else{htmlNode.setAttribute("style","overflow:visible;height:auto;display:block;");
}}};this.$removeEmptyMessage=function(htmlNode){var cNode=htmlNode.firstElementChild||htmlNode.firstChild;
if(!cNode){return;}do{if(cNode.getAttribute&&cNode.getAttribute("empty")){htmlNode.removeChild(cNode);
return;}cNode=cNode.nextSibling;}while(cNode);};this.$drawBase=function(){this.$ext=this.$getExternal();
this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("main","openclose");
if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var _self=this;
this.$ext.onclick=function(e){_self.dispatchEvent("click",{htmlEvent:e||event});
};this.$ext.onmousedown=function(e){_self.dispatchEvent("mousedown",{htmlEvent:e||event});
};this.$ext.onmouseover=function(e){_self.dispatchEvent("mouseover",{htmlEvent:e||event});
};this.$ext.onmousemove=function(e){_self.dispatchEvent("mousemove",{htmlEvent:e||event});
};};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.nocollapse){this.startcollapsed=false;
}else{if(this.startcollapsed===1){this.startcollapsed=!apf.isFalse(this.$getOption("main","startcollapsed"));
}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$ext.onclick=null;
apf.destroyHtmlNode(this.oDrag);this.oDrag=null;});}).call(apf.BaseTree.prototype=new apf.MultiSelect());
apf.__DELAYEDRENDER__=1<<11;apf.DelayedRender=function(){this.$regbase=this.$regbase|apf.__DELAYEDRENDER__;
this.$rendered=false;this.$render=function(usedelay){if(this.$rendered){return;
}if(this.dispatchEvent("beforerender")===false){return;}if(this["render-delay"]||usedelay){$setTimeout("apf.lookup("+this.$uniqueId+").$renderparse()",10);
}else{this.$renderparse();}};this.$renderparse=function(){if(this.$rendered){return;
}this.$ext.style.visibility="hidden";var domParser=this.ownerDocument.$domParser;
domParser.parseFromXml(this.$aml,{amlNode:this,doc:this.ownerDocument,delayedRender:true});
domParser.$continueParsing(this);this.$rendered=true;this.dispatchEvent("afterrender");
this.$ext.style.visibility="";};var f;this.addEventListener("prop.visible",f=function(){if(arguments[0].value){this.$render();
this.removeEventListener("prop.visible",f);}});};apf.GuiElement.propHandlers.render=function(value){if(!this.hasFeature(apf.__DELAYEDRENDER__)&&value=="runtime"){this.implement(apf.DelayedRender);
if(this.localName!="page"){this.visible=false;this.$ext.style.display="none";}if(typeof this["render-delay"]=="undefined"){this.$setInheritedAttribute("render-delay");
}}};apf.config.$inheritProperties["render-delay"]=1;apf.__DRAGDROP__=1<<5;apf.DragDrop=function(){this.$regbase=this.$regbase|apf.__DRAGDROP__;
this.$dragInited=false;this.copy=function(nodeList,pNode,beforeNode,isMove){if(nodeList.nodeType){nodeList=[nodeList];
}var exec,changes=[],i=0,l=nodeList.length;for(;i<l;i++){changes.push({action:isMove?"moveNode":"appendChild",args:[pNode,isMove?nodeList[i]:nodeList[i]=nodeList[i].cloneNode(true),beforeNode]});
}if(this.$actions[(isMove?"movegroup":"copygroup")]){exec=this.$executeAction("multicall",changes,(isMove?"movegroup":"copygroup"),nodeList[0]);
}else{exec=this.$executeAction("multicall",changes,(isMove?"move":"copy"),nodeList[0],null,null,nodeList.length>1?nodeList:null);
}if(exec!==false){return nodeList;}return false;};this.move=function(nodeList,pNode,beforeNode){return this.copy(nodeList,pNode,beforeNode,true);
};this.isDragAllowed=function(x,data){if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;
}if(this.disabled||!x||!x.length||!x[0]){return false;}if(this.drag||this.dragcopy){if(data){data.merge(x);
}return true;}var d,ruleList=[],j=0,l=x.length;for(;j<l;j++){d=this.$getDataNode("drag",x[j],null,ruleList);
if(!d){return false;}if(data){data.push(d);}}return ruleList.length?ruleList:false;
};this.isDropAllowed=function(x,target){if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;
}if(this.disabled||!x||!x.length||!target){return false;}var data,tgt,hasDropRule=this.$attrBindings&&this.$attrBindings.drop;
if(this.drop&&(!hasDropRule||hasDropRule.value=="true")){this.$setDynamicProperty("drop",this.hasFeature(apf.__MULTISELECT__)?"["+this.each+"]":"[node()]");
hasDropRule=true;}if(hasDropRule){for(var j=0,l=x.length;j<l;j++){data=this.$getDataNode("drop",x[j]);
if(!data){break;}}if(j==l&&target&&!apf.isChildOf(data,target,true)){return[target,null];
}}var rules=this.$bindings.drop;if(!rules||!rules.length){return false;}var rule,strTgt,i=0,rl=rules.length;
for(;i<rl;i++){rule=this.$bindings.getRuleIndex("drop",i);for(var j=0,l=x.length;
j<l;j++){data=rule.cvalue?rule.cvalue(x[j]):rule.cmatch(x[j]);if(!data){break;}}if(j!=l){continue;
}strTgt=rule.target;if(!strTgt||strTgt=="."){tgt=target;}else{tgt=(rule.ctarget||rule.compile("target"))(target);
}if(tgt&&!apf.isChildOf(data,tgt,true)){return[tgt,rule];}}return false;};this.$dragDrop=function(xmlReceiver,xmlNodeList,rule,defaction,isParent,srcRule,event){if(action=="tree-append"&&isParent){return false;
}var action=rule&&rule.action;if(action){action=(rule.caction||rule.compile("action"))(xmlNodeList[0]);
}else{action=defaction;}var context={internal:apf.DragServer.dragdata.host==this,ctrlKey:event.ctrlKey,keyCode:event.keyCode},ifcopy=rule&&rule.copy;
if(ifcopy){ifcopy=!apf.isFalse((rule.ccopy||rule.compile("copy"))(xmlNodeList[0],context));
}else{if(typeof this.dragcopy=="boolean"||typeof this.dropcopy=="boolean"){if(this.dropcopy){ifcopy=this.dropcopy;
}else{if(this.dragcopy){ifcopy=event.ctrlKey;}else{var copyRule=this.$attrBindings&&this.$attrBindings.dragcopy;
if(copyRule){ifcopy=!apf.isFalse((copyRule.cvalue2||copyRule.compile("value",{withopt:true}))(xmlNodeList[0],context));
}}}}}if(!ifcopy){for(var i=0,l=srcRule.length;i<l;i++){ifcopy=typeof srcRule[i]=="object"&&srcRule[i].copy?!apf.isFalse((srcRule[i].ccopy||srcRule[i].compile("copy"))(xmlNodeList[0],context)):event.ctrlKey;
if(ifcopy){break;}}}var sNode,actRule=ifcopy?"copy":"move",parentXpath=rule?rule.getAttribute("parent"):null;
switch(action){case"list-append":xmlReceiver=(isParent?xmlReceiver:this.getTraverseParent(xmlReceiver));
if(parentXpath){if(xmlReceiver.selectSingleNode(parentXpath)){xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);
}else{xmlReceiver.appendChild(xmlReceiver.ownerDocument.createElement(parentXpath));
xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);}}sNode=this[actRule](xmlNodeList,xmlReceiver);
break;case"insert-before":sNode=isParent?this[actRule](xmlNodeList,xmlReceiver):this[actRule](xmlNodeList,xmlReceiver.parentNode,xmlReceiver);
break;case"tree-append":if(parentXpath){if(xmlReceiver.selectSingleNode(parentXpath)){xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);
}else{xmlReceiver.appendChild(xmlReceiver.ownerDocument.createElement(parentXpath));
xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);}}sNode=this[actRule](xmlNodeList,xmlReceiver);
break;}if(this.selectable&&sNode){this.selectList(sNode);this.setCaret(sNode[0]);
this.focus();}return sNode;};this.enableDragDrop=function(){apf.console.info("Initializing Drag&Drop for "+this.localName+"["+(this.name||"")+"]");
this.icoAllowed="";this.icoDenied="";this.$ext.dragdrop=false;var _self=this;this.$ext[apf.isIphone?"ontouchstart":"onmousedown"]=function(e){if(_self.disabled){return;
}e=e||window.event;if(apf.isIphone){if(e.touches.length==1){return;}var old_e=e;
e=e.touches[0];var pos=apf.getAbsolutePosition(e.target,this);e.offsetX=pos[0];
e.offsetY=pos[1];}var fEl,srcEl=e.originalTarget||e.srcElement||e.target,multiselect=_self.hasFeature(apf.__MULTISELECT__);
if(multiselect&&srcEl==_self.$container){return;}_self.dragging=0;try{if(!apf.isIphone&&_self.allowdeselect&&(srcEl==this||srcEl.getAttribute(apf.xmldb.htmlIdTag)&&_self.$getLayoutNode("item","select",this)!=this)){return;
}}catch(e){return;}if(_self.$findValueNode){fEl=_self.$findValueNode(srcEl);}var el=(fEl?apf.xmldb.getNode(fEl):apf.xmldb.findXmlNode(srcEl));
if(multiselect&&(!_self.selected||!el||el==_self.xmlRoot)){return;}if(_self.isDragAllowed(multiselect?_self.$getSelection():el)){if(apf.isIphone){old_e.preventDefault();
}apf.DragServer.start(_self,srcEl,e);}};this.$ext[apf.isIphone?"ontouchmove":"onmousemove"]=function(e){if(this.host.dragging!=1||_self.disabled){return;
}};if(apf.isIphone){this.$ext.ontouchend=this.$ext.ontouchcancel=function(){if(_self.disabled){return;
}this.host.dragging=0;};}else{this.$ext.onmouseup=function(){if(_self.disabled){return;
}this.host.dragging=0;};this.$ext.ondragcopy=this.$ext.ondragstart=function(){return false;
};}if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);}if(this.$initDragDrop&&!this.$dragInited){this.$initDragDrop();
this.$dragInited=2;}else{this.$dragInited=true;}};function disableDragDrop(){this.$dragInited=false;
if(apf.isIphone){this.$ext.ontouchstart=this.$ext.ontouchmove=this.$ext.ontouchend=this.$ext.ontouchcancel=null;
}else{this.$ext.onmousedown=this.$ext.onmousemove=this.$ext.onmouseup=null;}if(document.elementFromPointRemove){document.elementFromPointRemove(this.$ext);
}}this.implement(this.hasFeature(apf.__MULTISELECT__)?apf.MultiselectDragDrop:apf.StandardDragDrop);
this.$supportedProperties.push("drop","drag","dragcopy");this.$propHandlers.dragcopy=this.$propHandlers.dropcopy=this.$propHandlers.drag=this.$propHandlers.drop=function(value,prop){this[prop]=apf.isTrue(value);
if(this.$dragInited&&prop=="drag"&&value&&this.$dragInited!=2){this.$initDragDrop();
this.$dragInited=2;return;}if(prop=="dragcopy"||prop=="dropcopy"){return;}if(!value&&!this.drag&&!this.drop&&!this.$bindings&&(this.$attrBindings&&(!this.$attrBindings.drag||!this.$attrBindings.drop))){disableDragDrop.call(this);
}else{if(value&&!this.$dragInited){this.enableDragDrop();}}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){disableDragDrop.call(this);
if(this.oDrag){apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}});};apf.GuiElement.propHandlers.dragcopy=apf.GuiElement.propHandlers.dropcopy=apf.GuiElement.propHandlers.drop=apf.GuiElement.propHandlers.drag=function(value,prop){if(!apf.isFalse(value)){if(!this.hasFeature(apf.__DRAGDROP__)){this.implement(apf.DragDrop);
this.enableDragDrop();}this[prop]=apf.isTrue(value);}};apf.DragServer={Init:function(){if(apf.isIphone){this.ontouchmove=this.onmousemove;
this.ontouchend=this.ontouchcancel=this.onmouseup;}apf.addEventListener("hotkey",function(e){if(apf.window.dragging&&e.keyCode==27){if(document.body.lastHost&&document.body.lastHost.dragOut){document.body.lastHost.dragOut(apf.dragHost);
}return apf.DragServer.stopdrag();}});},start:function(amlNode,srcEl,e,customNode){if(document.elementFromPointReset){document.elementFromPointReset();
}amlNode.dragging=1;var d=window.document;d=(!d.compatMode||d.compatMode=="CSS1Compat")?d.html||d.documentElement:d.body;
var scrollX=(apf.isIE?d.scrollLeft:window.pageXOffset),scrollY=(apf.isIE?d.scrollTop:window.pageYOffset),oParent=amlNode.$ext.offsetParent,pos;
while(oParent&&oParent!=d&&oParent.tagName!="BODY"){scrollX-=oParent.scrollLeft;
scrollY-=oParent.scrollTop;oParent=oParent.offsetParent;}if(!srcEl&&customNode){pos=[0,0];
}else{var loopEl=srcEl,lastId;while(loopEl&&loopEl.nodeType==1&&!(lastId=loopEl.getAttribute(apf.xmldb.htmlIdTag))){loopEl=loopEl.parentNode;
}if(!lastId){return;}pos=apf.getAbsolutePosition(loopEl);}apf.DragServer.coordinates={srcElement:srcEl,doc:d,scrollX:scrollX,scrollY:scrollY,offsetX:e.clientX-pos[0],offsetY:e.clientY-pos[1],clientX:e.pageX?e.pageX-window.pageXOffset:e.clientX,clientY:e.pageY?e.pageY-window.pageYOffset:e.clientY};
var selection=customNode||amlNode.hasFeature(apf.__MULTISELECT__)?amlNode.getSelection():[amlNode.xmlRoot],data=[],srcRules=amlNode.isDragAllowed(selection,data);
if(!srcRules){return;}if(amlNode.hasEventListener("dragdata")){data=amlNode.dispatchEvent("dragdata",{data:data});
}this.dragdata={rules:srcRules,selection:selection,data:data,indicator:amlNode.$showDragIndicator(selection,this.coordinates),host:amlNode};
if(amlNode.dispatchEvent("dragstart",this.dragdata)===false){return false;}amlNode.dragging=2;
apf.dragMode=true;document.onmousemove=this.onmousemove;document.onmouseup=this.onmouseup;
},stop:function(runEvent,success){if(this.last){this.dragout();}this.dragdata.host.dragging=0;
this.dragdata.host.$hideDragIndicator(success);apf.dragMode=false;document.onmousemove=document.onmouseup=null;
this.dragdata=null;},dragover:function(o,el,e){e=e||window.event;var fEl;if(o.$findValueNode){fEl=o.$findValueNode(el);
}if(this.lastFel&&this.lastFel==fEl||!this.lastFel&&this.last==o){return;}var elSel=(fEl?apf.xmldb.getNode(fEl):apf.xmldb.findXmlNode(el)),candrop=o.isDropAllowed&&o.xmlRoot?o.isDropAllowed(this.dragdata.data,elSel||o.xmlRoot):apf.isTrue(apf.getInheritedAttribute(o,"",function(p){if(p.drop){o=p;
if(o==apf.DragServer.last){return false;}return true;}}));if(this.last&&this.last!=o){this.dragout(this.last,e);
}this.last=o;this.lastFel=fEl;if(!candrop){return;}if(o.dispatchEvent("dragover",this.dragdata)===false){candrop=false;
}var srcEl=e.originalTarget||e.srcElement||e.target;if(o&&o.$dragover){o.$dragover(el,this.dragdata,candrop);
}},dragout:function(o,e){this.lastFel=null;if(o){this.dragdata.htmlEvent=e;o.dispatchEvent("dragout",this.dragdata);
}if(this.last&&this.last.$dragout){this.last.$dragout(null,this.dragdata);}this.last=null;
},dragdrop:function(o,el,srcO,e){var isParent,lastTop,elSel=(o.$findValueNode?apf.xmldb.getNode(o.$findValueNode(el)):apf.xmldb.findXmlNode(el)),candrop=(o.isDropAllowed&&o.xmlRoot)?o.isDropAllowed(this.dragdata.data,elSel||o.xmlRoot):false;
if(this.dragdata.indicator){lastTop=this.dragdata.indicator.style.top;this.dragdata.indicator.style.top="10000px";
}if(!candrop){candrop=apf.isTrue(apf.getInheritedAttribute(o,"",function(p){if(p.drop){o=p;
return true;}}));}if(candrop){if(o.dispatchEvent("dragdrop",apf.extend({candrop:candrop,htmlEvent:e,top:lastTop},this.dragdata))===false){candrop=false;
}else{if(!o.xmlRoot){var m=o.getModel?o.getModel(true):apf.nameserver.get("model",o.model);
if(m){m.load(this.dragdata.data[0]);}return true;}else{var action=candrop[1]&&candrop[1].action||(o.$isTreeArch?"tree-append":"list-append");
if(action=="list-append"&&(!o.$isTreeArch&&o==this.dragdata.host)){candrop=false;
}}}}if(this.dragdata.indicator){this.dragdata.indicator.style.top=lastTop;}if(!candrop){this.dragout(o,e);
return false;}if(o.$dragDrop){var rNode=o.$dragDrop(candrop[0],this.dragdata.data,candrop[1],action,isParent||candrop[0]==o.xmlRoot,this.dragdata.rules,e);
this.dragdata.resultNode=rNode;}if(o.$dragdrop){o.$dragdrop(el,apf.extend({htmlEvent:e,xmlNode:rNode},this.dragdata),candrop);
}this.last=null;this.lastFel=null;return true;},onmousemove:function(e){if(!apf.DragServer.dragdata){return;
}e=e||window.event;if(apf.isIphone){e.preventDefault();if(!e.touches){return apf.DragServer.stop(true);
}e=e.touches[0];}var dragdata=apf.DragServer.dragdata,c={clientX:e.pageX?e.pageX-window.pageXOffset:e.clientX,clientY:e.pageY?e.pageY-window.pageYOffset:e.clientY};
if(!dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-c.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-c.clientY)<6){return;
}if(!dragdata.started){if(dragdata.host.$dragstart){dragdata.host.$dragstart(null,dragdata);
}dragdata.started=true;}var storeIndicatorTopPos=dragdata.indicator.style.top;dragdata.indicator.style.display="block";
if(dragdata.indicator){dragdata.indicator.style.top="10000px";}apf.DragServer.dragdata.x=e.pageX?e.pageX-(!apf.isIE?window.pageXOffset:0):c.clientX;
apf.DragServer.dragdata.y=e.pageY?e.pageY-(!apf.isIE?window.pageYOffset:0):c.clientY;
var el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
if(!el){el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
}dragdata.indicator.style.top=storeIndicatorTopPos;dragdata.host.$moveDragIndicator(c);
var receiver=apf.findHost(el);if(receiver){apf.DragServer.dragover(receiver,el,e);
}else{if(apf.DragServer.last){apf.DragServer.dragout(apf.DragServer.last,e);}}apf.DragServer.lastTime=new Date().getTime();
},onmouseup:function(e){e=e||window.event;if(apf.isIphone){e.preventDefault();if(!e.changedTouches){return apf.DragServer.stop(true);
}e=e.changedTouches[0];}var c={clientX:e.pageX?e.pageX-window.pageXOffset:e.clientX,clientY:e.pageY?e.pageY-window.pageYOffset:e.clientY};
if(!apf.DragServer.dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-c.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-c.clientY)<6){apf.DragServer.stop(true);
return;}var indicator=apf.DragServer.dragdata.indicator,storeIndicatorTopPos=indicator.style.top;
if(indicator){indicator.style.top="10000px";}apf.DragServer.dragdata.x=e.pageX?e.pageX-(!apf.isIE?window.pageXOffset:0):c.clientX;
apf.DragServer.dragdata.y=e.pageY?e.pageY-(!apf.isIE?window.pageYOffset:0):c.clientY;
var el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
if(!el){el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
}indicator.style.top=storeIndicatorTopPos;var host=apf.findHost(el);if(apf.DragServer.host&&host!=apf.DragServer.host){apf.DragServer.dragout(apf.DragServer.host,e);
}var success=apf.DragServer.dragdrop(host,el,apf.DragServer.dragdata.host,e);apf.DragServer.stop(true,success);
}};apf.MultiselectDragDrop=function(){this.diffX=this.diffY=0;this.multiple=false;
this.lastDragNode=null;this.lastel=null;this.$showDragIndicator=function(sel,e){this.multiple=sel.length>1;
if(this.multiple){this.diffX=e.scrollX;this.diffY=e.scrollY;}else{this.diffX=-1*e.offsetX;
this.diffY=-1*e.offsetY;}var prefix=this.oDrag.className.split(" ")[0];this.$setStyleClass(this.oDrag,(this.multiple?prefix+"_multiple":"")+(this["class"]?" "+this["class"]:""),[prefix+"_multiple"]);
if(this.multiple){document.body.appendChild(this.oDrag);return this.oDrag;}else{if(this.localName=="datagrid"){if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);
}sel=this.$selected||this.$caret;var oDrag=sel.cloneNode(true);oDrag.removeAttribute("onmousedown");
oDrag.onmousedown=null;oDrag.removeAttribute("onmouseup");oDrag.onmouseup=null;
oDrag.removeAttribute("onmouseout");oDrag.onmouseout=null;oDrag.removeAttribute("ondblclick");
oDrag.ondblclick=null;document.body.appendChild(oDrag);oDrag.style.position="absolute";
oDrag.style.width=sel.offsetWidth+"px";oDrag.style.display="none";oDrag.removeAttribute("id");
this.$setStyleClass(oDrag,"draggrid");var nodes=sel.childNodes;var dragnodes=oDrag.childNodes;
for(var i=nodes.length-1;i>=0;i--){if(dragnodes[i].nodeType==1){dragnodes[i].style.width=apf.getStyle(nodes[i],"width");
}}return(this.lastDragNode=oDrag);}else{var sel=this.$selected||this.$caret,width=apf.getStyle(this.oDrag,"width");
if(!width||width=="auto"){this.oDrag.style.width=(sel.offsetWidth-apf.getWidthDiff(this.oDrag))+"px";
}this.$updateNode(this.selected,this.oDrag);}}apf.window.zManager.set("drag",this.oDrag);
return this.oDrag;};this.$hideDragIndicator=function(success){var oDrag=this.lastDragNode||this.oDrag,_self=this;
if(!this.multiple&&!success&&oDrag.style.display=="block"){if(!this.$selected&&!this.$caret){return;
}var pos=apf.getAbsolutePosition(this.$selected||this.$caret);apf.tween.multi(oDrag,{anim:apf.tween.easeInOutCubic,steps:apf.isIE?15:20,interval:15,tweens:[{type:"left",from:oDrag.offsetLeft,to:pos[0]},{type:"top",from:oDrag.offsetTop,to:pos[1]}],onfinish:function(){if(_self.lastDragNode){apf.destroyHtmlNode(_self.lastDragNode);
_self.lastDragNode=null;}else{_self.oDrag.style.display="none";}}});}else{if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);
this.lastDragNode=null;}else{this.oDrag.style.display="none";}}};this.$moveDragIndicator=function(e){var oDrag=this.lastDragNode||this.oDrag;
oDrag.style.left=(e.clientX+this.diffX)+"px";oDrag.style.top=(e.clientY+this.diffY+(this.multiple?15:0))+"px";
};this.addEventListener("$skinchange",function(){this.$initDragDrop();});this.$initDragDrop=function(){if(!this.$hasLayoutNode("dragindicator")){return;
}this.oDrag=apf.insertHtmlNode(this.$getLayoutNode("dragindicator"),document.body);
apf.window.zManager.set("drag",this.oDrag);this.oDrag.style.position="absolute";
this.oDrag.style.cursor="default";this.oDrag.style.display="none";};this.$findValueNode=function(el){if(!el){return null;
}while(el&&el.nodeType==1&&!el.getAttribute(apf.xmldb.htmlIdTag)){if(this.$isTreeArch&&el.previousSibling&&el.previousSibling.nodeType==1){el=el.previousSibling;
}else{el=el.parentNode;}}return(el&&el.nodeType==1&&el.getAttribute(apf.xmldb.htmlIdTag))?el:null;
};this.$dragout=function(el,dragdata,extra){if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);
}var sel=this.$getSelection(true);for(var i=0,l=sel.length;i<l;i++){this.$setStyleClass(sel[i],"selected",["dragDenied","dragInsert","dragAppend","indicate"]);
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Drop"]);this.lastel=null;
};if(!this.$dragdrop){this.$dragdrop=this.$dragout;}this.$dragover=function(el,dragdata,extra){this.$setStyleClass(this.$ext,this.$baseCSSname+"Drop");
var sel=this.$getSelection(true);for(var i=0,l=sel.length;i<l;i++){this.$setStyleClass(sel[i],"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);
}if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);
}var action=extra[1]&&extra[1].action;this.lastel=this.$findValueNode(el);if(this.$isTreeArch&&action=="list-append"){var htmlNode=apf.xmldb.findHtmlNode(this.getTraverseParent(apf.xmldb.getNode(this.lastel)),this);
this.lastel=htmlNode?this.$getLayoutNode("item","container",htmlNode):this.$container;
this.$setStyleClass(this.lastel,"dragInsert");}else{this.$setStyleClass(this.lastel,extra?(action=="insert-before"?"dragInsert":"dragAppend"):"dragDenied");
}};};apf.StandardDragDrop=function(){this.$showDragIndicator=function(sel,e){var x=e.offsetX+22,y=e.offsetY;
this.oDrag.startX=x;this.oDrag.startY=y;document.body.appendChild(this.oDrag);var oInt=this.$getLayoutNode("main","caption",this.oDrag);
if(oInt.nodeType!=1){oInt=oInt.parentNode;}oInt.innerHTML=this.$applyBindRule("caption",this.xmlRoot)||"";
return this.oDrag;};this.$hideDragIndicator=function(){this.oDrag.style.display="none";
};this.$moveDragIndicator=function(e){this.oDrag.style.left=(e.clientX-this.oDrag.startX+document.documentElement.scrollLeft)+"px";
this.oDrag.style.top=(e.clientY-this.oDrag.startY+document.documentElement.scrollTop)+"px";
};this.$initDragDrop=function(){if(!this.getAttribute("drag")){return;}this.oDrag=document.body.appendChild(this.$ext.cloneNode(true));
apf.window.zManager.set("drag",this.oDrag);this.oDrag.style.position="absolute";
this.oDrag.style.cursor="default";this.oDrag.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";
this.oDrag.style.MozOpacity=0.5;this.oDrag.style.opacity=0.5;this.oDrag.style.display="none";
};};apf.DragServer.Init();apf.__FOCUSSABLE__=1<<26;apf.Focussable=function(){this.$regbase=this.$regbase|apf.__FOCUSSABLE__;
if(this.disabled==undefined){this.disabled=false;}this.setTabIndex=function(tabindex){apf.window.$removeFocus(this);
apf.window.$addFocus(this,tabindex);return this;};this.focus=function(noset,e,nofix){if(!noset){if(this.$isWindowContainer>-1){apf.window.$focusLast(this,e,true);
}else{apf.window.$focus(this,e);if(!nofix&&apf.hasFocusBug){apf.window.$focusfix();
}}return this;}if(this.$focus&&!this.editable&&(!e||!e.mouse||this.$focussable==apf.KEYBOARD_MOUSE)){this.$focus(e);
}this.dispatchEvent("focus",apf.extend({bubbles:true},e));return this;};this.blur=function(noset,e){if((e&&!apf.isChildOf(e.fromElement,e.toElement))&&apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();
}if(this.$blur){this.$blur(e);}if(!noset){apf.window.$blur(this);}this.dispatchEvent("blur",apf.extend({bubbles:!e||!e.cancelBubble},e));
return this;};this.hasFocus=function(){return apf.document.activeElement==this||this.$isWindowContainer&&(apf.document.activeElement||{}).$focusParent==this;
};};apf.__INTERACTIVE__=1<<21;apf.Interactive=function(){var nX,nY,rX,rY,startPos,lastCursor=null,l,t,r,b,lMax,tMax,lMin,tMin,w,h,we,no,ea,so,rszborder,rszcorner,marginBox,verdiff,hordiff,_self=this,posAbs,oX,oY,overThreshold,dragOutline,resizeOutline,myPos,startGeo;
this.$regbase=this.$regbase|apf.__INTERACTIVE__;this.$dragStart=function(e,reparent){var nativeEvent=e||event;
if(!reparent&&nativeEvent.button==2){return;}if(!reparent){var f;var ev=e||{clientX:event.clientX,clientY:event.clientY,ctrlKey:event.ctrlKey};
var o=nativeEvent.srcElement||this;apf.addEventListener("mousedown",f=function(){dragStart.call(o,ev,reparent);
apf.removeEventListener("mousedown",f);});apf.cancelBubble(nativeEvent,nativeEvent.srcElement||this);
}else{dragStart.apply(nativeEvent.srcElement||this,arguments);}};this.$propHandlers.draggable=function(value){if(apf.isFalse(value)){this.draggable=value=false;
}else{if(apf.isTrue(value)){this.draggable=value=true;}}var o=this.editable?this.$ext:this.oDrag||this.$ext;
if(value){apf.addListener(o,"mousedown",this.$dragStart);}else{apf.removeListener(o,"mousedown",this.$dragStart);
}if(o.interactive&1){return;}o.interactive=(o.interactive||0)+1;};this.$propHandlers.resizable=function(value){if(apf.isFalse(value)){this.resizable=value=false;
}else{if(apf.isTrue(value)){this.resizable=value=true;}}this.$ext.style.cursor="";
var o=this.oResize||this.$ext;if(o.interactive&2){return;}if(!_self.editable){apf.addListener(o,"mousedown",function(){resizeStart.apply(o,arguments);
});apf.addListener(o,"mousemove",function(){resizeIndicate.apply(o,arguments);});
}o.interactive=(o.interactive||0)+2;rszborder=this.$getOption&&parseInt(this.$getOption("Main","resize-border"))||3;
rszcorner=this.$getOption&&parseInt(this.$getOption("Main","resize-corner"))||12;
marginBox=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};this.$cancelInteractive=function(){document.onmouseup(null,true);
};function dragStart(e,reparent){if(!e){e=event;}if(!reparent&&(!_self.draggable||apf.dragMode)){return;
}dragOutline=_self.dragOutline==true||apf.config.dragOutline;if(_self.dispatchEvent("beforedragstart",{htmlEvent:e})===false){return;
}apf.dragMode=true;if(reparent){_self.dispatchEvent("beforedrag");overThreshold=true;
}else{overThreshold=false;}apf.popup.forceHide();posAbs="absolute|fixed".indexOf(apf.getStyle(_self.$ext,"position"))>-1;
if(!posAbs){_self.$ext.style.position=posAbs?"absolute":"relative";}if(_self.editable){posAbs=true;
}if(posAbs&&!_self.aData){apf.plane.show(dragOutline?oOutline:_self.$ext,e.reappend);
}var ext=(reparent||oOutline.self)&&dragOutline?oOutline:_self.$ext;var pos=posAbs?apf.getAbsolutePosition(ext,ext.offsetParent,true):[parseInt(apf.getStyle(ext,"left"))||0,parseInt(apf.getStyle(ext,"top"))||0];
startGeo=[ext.style.left,ext.style.top,ext.style.right,ext.style.bottom,ext.style.width,ext.style.height];
nX=pos[0]-(oX=e.clientX);nY=pos[1]-(oY=e.clientY);if(!(reparent||oOutline.self)){if(posAbs&&dragOutline){oOutline.className="drag";
var diffOutline=apf.getDiff(oOutline);_self.$ext.offsetParent.appendChild(oOutline);
oOutline.style.left=pos[0]+"px";oOutline.style.top=pos[1]+"px";oOutline.style.width=(_self.$ext.offsetWidth-diffOutline[0])+"px";
oOutline.style.height=(_self.$ext.offsetHeight-diffOutline[1])+"px";if(_self.editable){oOutline.style.display="block";
}}else{if(_self.$ext.style.right){_self.$ext.style.left=pos[0]+"px";_self.$ext.style.right="";
}if(_self.$ext.style.bottom){_self.$ext.style.top=pos[1]+"px";_self.$ext.style.bottom="";
}}}document.onmousemove=dragMove;document.onmouseup=function(e,cancel){document.onmousemove=document.onmouseup=null;
if(posAbs&&!_self.aData){apf.plane.hide();}var htmlNode=dragOutline?oOutline:_self.$ext;
if(overThreshold&&!_self.$multidrag){if(cancel){var ext=_self.$ext;ext.style.left=startGeo[0];
ext.style.top=startGeo[1];ext.style.right=startGeo[2];ext.style.bottom=startGeo[3];
ext.style.width=startGeo[4];ext.style.height=startGeo[5];if(_self.dispatchEvent){_self.dispatchEvent("dragcancel");
}}else{if(_self.setProperty){updateProperties();}else{if(dragOutline){_self.$ext.style.left=l+"px";
_self.$ext.style.top=t+"px";}}}}l=t=w=h=null;if(!posAbs){_self.$ext.style.position="relative";
}if(_self.showdragging){apf.setStyleClass(_self.$ext,"",["dragging"]);}if(posAbs&&dragOutline&&!oOutline.self){oOutline.style.display="none";
}apf.dragMode=false;if(!cancel&&_self.dispatchEvent&&overThreshold){_self.dispatchEvent("afterdrag",{htmlNode:htmlNode});
}};if(reparent){document.onmousemove(e);}return false;}function dragMove(e){if(!e){e=event;
}if(!overThreshold&&_self.showdragging){apf.setStyleClass(_self.$ext,"dragging");
}var dx=e.clientX-oX,dy=e.clientY-oY,distance;if(!overThreshold&&(distance=dx*dx>dy*dy?dx:dy)*distance<2){return;
}else{if(!overThreshold){if(dragOutline&&oOutline.style.display!="block"){oOutline.style.display="block";
}if(_self.dispatchEvent&&_self.dispatchEvent("beforedrag")===false){document.onmouseup();
return;}}}var oHtml=dragOutline?oOutline:_self.$ext;oHtml.style.left=(l=e.clientX+nX)+"px";
oHtml.style.top=(t=e.clientY+nY)+"px";if(_self.realtime){var change=_self.$stick={};
_self.$showDrag(l,t,oHtml,e,change);if(typeof change.l!="undefined"){l=change.l,oHtml.style.left=l+"px";
}if(typeof change.t!="undefined"){t=change.t,oHtml.style.top=t+"px";}}overThreshold=true;
}this.$resizeStart=resizeStart;function resizeStart(e,options){if(!e){e=event;}if(!_self.resizable||String(_self.height).indexOf("%")>-1&&_self.parentNode.localName=="vbox"||String(_self.width).indexOf("%")>-1&&_self.parentNode.localName=="hbox"){return;
}resizeOutline=!(_self.resizeOutline==false||!apf.config.resizeOutline);var ext=_self.$ext;
if(!resizeOutline){var diff=apf.getDiff(ext);hordiff=diff[0];verdiff=diff[1];}startPos=apf.getAbsolutePosition(ext);
startPos.push(ext.offsetWidth);startPos.push(ext.offsetHeight);myPos=apf.getAbsolutePosition(ext,ext.offsetParent,true);
startGeo=[ext.style.left,ext.style.top,ext.style.right,ext.style.bottom,ext.style.width,ext.style.height];
var sLeft=0,sTop=0,x=(oX=e.clientX)-startPos[0]+sLeft+document.documentElement.scrollLeft,y=(oY=e.clientY)-startPos[1]+sTop+document.documentElement.scrollTop,resizeType;
if(options&&options.resizeType){posAbs="absolute|fixed".indexOf(apf.getStyle(ext,"position"))>-1;
resizeType=options.resizeType;}else{resizeType=getResizeType.call(ext,x,y);}rX=x;
rY=y;if(!resizeType){return;}if(_self.dispatchEvent&&_self.dispatchEvent("beforeresize",{type:resizeType,setType:function(type){resizeType=type;
}})===false){return;}apf.popup.forceHide();apf.dragMode=true;overThreshold=false;
we=resizeType.indexOf("w")>-1;no=resizeType.indexOf("n")>-1;ea=resizeType.indexOf("e")>-1;
so=resizeType.indexOf("s")>-1;if(!_self.minwidth){_self.minwidth=0;}if(!_self.minheight){_self.minheight=0;
}if(!_self.maxwidth){_self.maxwidth=10000;}if(!_self.maxheight){_self.maxheight=10000;
}if(posAbs){lMax=myPos[0]+startPos[2];tMax=myPos[1]+startPos[3];lMin=myPos[0]+startPos[2];
tMin=myPos[1]+startPos[3];}if(posAbs){apf.plane.show(resizeOutline?oOutline:ext);
}if(resizeOutline){oOutline.className="resize";var diffOutline=apf.getDiff(oOutline);
hordiff=diffOutline[0];verdiff=diffOutline[1];oOutline.style.left=startPos[0]+"px";
oOutline.style.top=startPos[1]+"px";oOutline.style.width=(ext.offsetWidth-hordiff)+"px";
oOutline.style.height=(ext.offsetHeight-verdiff)+"px";oOutline.style.display="block";
}else{if(ext.style.right){iStyleRight=ext.style.right.slice(0,-2);if(iStyleRight){myPos[0]=myPos[0]+parseInt(iStyleRight);
ext.style.left=myPos[0]+"px";}else{ext.style.left=myPos[0]+"px";}}if(ext.style.bottom){ext.style.top=myPos[1]+"px";
}}if(!options||!options.nocursor){if(lastCursor===null){lastCursor=document.body.style.cursor;
}document.body.style.cursor=resizeType+"-resize";}document.onmousemove=resizeMove;
document.onmouseup=function(e,cancel){document.onmousemove=document.onmouseup=null;
if(posAbs){apf.plane.hide();}clearTimeout(timer);if(resizeOutline){var diff=apf.getDiff(_self.$ext);
hordiff=diff[0];verdiff=diff[1];}if(cancel){var ext=_self.$ext;ext.style.left=startGeo[0];
ext.style.top=startGeo[1];ext.style.right=startGeo[2];ext.style.bottom=startGeo[3];
ext.style.width=startGeo[4];ext.style.height=startGeo[5];if(_self.dispatchEvent){_self.dispatchEvent("resizecancel");
}}else{doResize(e||event,true);}if(_self.setProperty){updateProperties();}document.body.style.cursor=lastCursor||"";
lastCursor=null;if(resizeOutline){oOutline.style.display="none";}apf.dragMode=false;
if(!cancel&&_self.dispatchEvent){_self.dispatchEvent("afterresize",{l:l,t:t,w:w+hordiff,h:h+verdiff});
}l=t=w=h=null;};return false;}function updateProperties(left,top,width,height,hdiff,vdiff,right,bottom){if(typeof left=="undefined"){left=l,top=t,width=w,height=h,vdiff=verdiff,hdiff=hordiff;
}else{posAbs=true;}var hasLeft=_self.left||_self.left===0;var hasRight=_self.right||_self.right===0;
var hasBottom=_self.bottom||_self.bottom===0;var hasTop=_self.top||_self.top===0;
if(posAbs){var htmlNode=oOutline.style.display=="block"?oOutline:_self.$ext;if(hasRight&&!(right||right===0)){right=apf.getHtmlRight(htmlNode);
}if(hasBottom&&!(bottom||bottom===0)){bottom=apf.getHtmlBottom(htmlNode);}if(hasRight){_self.setProperty("right",right,0,_self.editable);
if(!_self.left){htmlNode.style.left="";}}if(hasBottom){_self.setProperty("bottom",bottom,0,_self.editable);
if(!_self.top){htmlNode.style.top="";}}if((left||left===0)&&(!hasRight||hasLeft)){_self.setProperty("left",left,0,_self.editable);
}if((top||top===0)&&(!hasBottom||hasTop)){_self.setProperty("top",top,0,_self.editable);
}}if(hdiff!=undefined&&width&&(!hasLeft||!hasRight)){_self.setProperty("width",width+hdiff,0,_self.editable);
}if(vdiff!=undefined&&height&&(!hasTop||!hasBottom)){_self.setProperty("height",height+vdiff,0,_self.editable);
}}this.$updateProperties=updateProperties;var min=Math.min,max=Math.max,lastTime,timer;
function resizeMove(e){if(!e){e=event;}clearTimeout(timer);if(lastTime&&new Date().getTime()-lastTime<(resizeOutline?6:apf.mouseEventBuffer)){var z={clientX:e.clientX,clientY:e.clientY};
timer=setTimeout(function(){doResize(z);},10);return;}lastTime=new Date().getTime();
doResize(e);}function doResize(e,force){var oHtml=resizeOutline&&!force?oOutline:_self.$ext;
var sLeft=document.documentElement.scrollLeft,sTop=document.documentElement.scrollTop;
if(we){if(posAbs){oHtml.style.left=(l=max((lMin-_self.maxwidth),min((lMax-_self.minwidth),myPos[0]+e.clientX-oX+sLeft)))+"px";
}oHtml.style.width=(w=min(_self.maxwidth-hordiff,max(hordiff,_self.minwidth,startPos[2]-(e.clientX-oX)+sLeft)-hordiff))+"px";
}if(no){if(posAbs){oHtml.style.top=(t=max((tMin-_self.maxheight),min((tMax-_self.minheight),myPos[1]+e.clientY-oY+sTop)))+"px";
}oHtml.style.height=(h=min(_self.maxheight-verdiff,max(verdiff,_self.minheight,startPos[3]-(e.clientY-oY)+sTop)-verdiff))+"px";
}if(ea){oHtml.style.width=(w=min(_self.maxwidth-hordiff,max(hordiff,_self.minwidth,e.clientX-startPos[0]+(startPos[2]-rX)+sLeft)-hordiff))+"px";
}if(so){oHtml.style.height=(h=min(_self.maxheight-verdiff,max(verdiff,_self.minheight,e.clientY-startPos[1]+(startPos[3]-rY)+sTop)-verdiff))+"px";
}if(_self.parentNode&&_self.parentNode.localName=="table"){updateProperties();apf.layout.processQueue();
}if(_self.realtime){var change=_self.$stick={};_self.$showResize(l||apf.getHtmlLeft(oHtml),t||apf.getHtmlTop(oHtml),w&&w+hordiff||oHtml.offsetWidth,h&&h+verdiff||oHtml.offsetHeight,e,change,we,no,ea,so);
if(posAbs&&we&&typeof change.l!="undefined"){oHtml.style.left=(l=max((lMin-_self.maxwidth),min((lMax-_self.minwidth),change.l)))+"px";
}if(posAbs&&no&&typeof change.t!="undefined"){oHtml.style.top=(t=max((tMin-_self.maxheight),min((tMax-_self.minheight),change.t)))+"px";
}if(typeof change.w!="undefined"){oHtml.style.width=(w=min(_self.maxwidth-hordiff,max(hordiff,_self.minwidth,change.w)-hordiff))+"px";
}if(typeof change.h!="undefined"){oHtml.style.height=(h=min(_self.maxheight-verdiff,max(verdiff,_self.minheight,change.h)-verdiff))+"px";
}}if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);}}function getResizeType(x,y){var cursor="",tcursor="";
posAbs="absolute|fixed".indexOf(apf.getStyle(_self.$ext,"position"))>-1;if(_self.resizable==true||_self.resizable=="vertical"){if(y<rszborder+marginBox[0]){cursor=posAbs?"n":"";
}else{if(y>this.offsetHeight-rszborder){cursor="s";}else{if(y>this.offsetHeight-rszcorner){tcursor="s";
}}}}if(_self.resizable==true||_self.resizable=="horizontal"){if(x<(cursor?rszcorner:rszborder)+marginBox[0]){cursor+=tcursor+(posAbs?"w":"");
}else{if(x>this.offsetWidth-(cursor||tcursor?rszcorner:rszborder)){cursor+=tcursor+"e";
}}}return cursor;}var originalCursor;function resizeIndicate(e){if(!e){e=event;
}if(!_self.resizable||_self.editable||document.onmousemove){return;}var pos=apf.getAbsolutePosition(_self.$ext),sLeft=0,sTop=0,x=e.clientX-pos[0]+sLeft+document.documentElement.scrollLeft,y=e.clientY-pos[1]+sTop+document.documentElement.scrollTop;
if(!originalCursor){originalCursor=apf.getStyle(this,"cursor");}var cursor=getResizeType.call(_self.$ext,x,y);
this.style.cursor=cursor?cursor+"-resize":originalCursor||"default";}var oOutline;
function initOutline(e){var doc=this.$pHtmlDoc||document;oOutline=doc.getElementById("apf_outline");
if(!oOutline){oOutline=doc.body.appendChild(doc.createElement("div"));oOutline.refCount=0;
oOutline.setAttribute("id","apf_outline");oOutline.style.position="absolute";oOutline.style.display="none";
apf.window.zManager.set("drag",oOutline);oOutline.host=false;}oOutline.refCount++;
}if(this.addEventListener&&this.hasFeature(apf.__AMLNODE__)&&!this.$amlLoaded){if(document.body){initOutline.call(this);
}else{this.addEventListener("DOMNodeInsertedIntoDocument",initOutline);}}else{this.$pHtmlDoc=document;
initOutline.call(this);}this.$setOutline=function(o){oOutline=o;};};apf.GuiElement.propHandlers.resizable=function(value){this.implement(apf.Interactive);
this.$propHandlers.resizable.apply(this,arguments);};apf.GuiElement.propHandlers.draggable=function(value){this.implement(apf.Interactive);
this.$propHandlers.draggable.apply(this,arguments);};apf.Init.run("interactive");
apf.__MEDIA__=1<<20;apf.Media=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__MEDIA__;
this.muted=false;this.$booleanProperties.paused=true;this.$booleanProperties.muted=true;
this.$booleanProperties.seeking=true;this.$booleanProperties.autoplay=true;this.$booleanProperties.controls=true;
this.$booleanProperties.ready=true;this.$supportedProperties.push("position","networkState","readyState","progress","buffered","bufferedBytes","totalBytes","currentTime","paused","seeking","volume","type","src","autoplay","controls");
this.$mainBind="src";this.$sources=[];this.$nomedia=null;this.$amlTimer=null;this.$loadTimer=null;
this.$posTimer=null;this.$volTimer=null;this.$propHandlers.readyState=function(value){if(this.readyState!==value){this.readyState=value;
}if(value==apf.Media.HAVE_NOTHING){apf.console.error("Unable to open medium with URL '"+this.src+"'. Please check if the URL you entered as src is pointing to                    a valid resource.");
var oError=this.MediaError("Unable to open medium with URL '"+this.src+"'. Please check if the URL you entered as src is pointing to                    a valid resource.");
if(this.dispatchEvent("havenothing",{error:oError,bubbles:true})===false){throw oError;
}}else{if(value==apf.Media.HAVE_CURRENT_DATA){this.dispatchEvent("havecurrentdata");
}else{if(value==apf.Media.HAVE_FUTURE_DATA){this.dispatchEvent("havefuturedata");
}else{if(value==apf.Media.HAVE_ENOUGH_DATA){this.dispatchEvent("haveenoughdata");
this.setProperty("ready",true);}}}}};this.$propHandlers.bufferedBytes=function(value){this.setProperty("progress",this.totalBytes?value.end/this.totalBytes:0);
};this.$propHandlers.position=function(value){clearTimeout(this.$posTimer);if(this.duration<=0||!this.seek){return;
}var _self=this;this.$posTimer=$setTimeout(function(){if(value>=_self.progress){value=_self.progress-0.05;
}var isPlaying=!_self.paused;if(isPlaying){_self.pause();}if(value<0){value=0;}else{if(value>1){value=1;
}}_self.seek(Math.round(value*_self.duration));_self.setProperty("paused",!isPlaying);
});};this.$propHandlers.currentTime=function(value){if(value>=0&&this.seek){this.seek(value);
}};this.$propHandlers.volume=function(value){if(!this.player){return;}if(value<0){throw this.MediaError("Attempt to set the volume to a negative value  '"+value+"'");
}if(value<1&&value>0){value=value*100;}if(this.setVolume){this.setVolume(value);
}if(value>0&&this.muted){this.setProperty("muted",false);}};this.oldVolume=null;
this.$propHandlers.muted=function(value){if(!this.player||!this.setVolume){return;
}if(value){this.oldVolume=this.volume;this.setVolume(0);}else{this.setVolume(this.oldVolume||20);
}};this.$propHandlers.paused=function(value){if(!this.player){return;}this.paused=apf.isTrue(value);
if(this.paused){this.player.pause();}else{this.player.play();}};this.$propHandlers.type=function(value){if(this.$loadTimer){return;
}var _self=this;this.$loadTimer=window.setTimeout(function(){reload.call(_self);
});};this.$propHandlers.src=function(value){if(this.$loadTimer||!value){return;
}var oUrl=new apf.url(value);this.src=oUrl.uri;if(oUrl.protocol=="file"){apf.console.warn("Media player: the medium with URL '"+this.src+"'\nwill be loaded through the 'file://' protocol.\nThis can cause the medium to not load and/ or play.","media");
}else{if(!oUrl.isSameLocation()){apf.console.warn("Media player: the medium with URL '"+this.src+"'\ndoes not have the same origin as your web application.\nThis can cause the medium to not load and/ or play.","media");
}}if(this.src!=this.currentSrc&&this.networkState!==apf.Media.LOADING){var type=this.$guessType(this.src);
if(type==this.type){reset.call(this);this.loadMedia();}else{this.type=type;var _self=this;
this.$loadTimer=window.setTimeout(function(){reload.call(_self);});}}};this.$propHandlers.ID3=function(value){if(!this.player){return;
}if(typeof this.player.setID3=="function"){this.player.setID3(value);}};this.addEventListener("AMLRemove",function(doOnlyAdmin){apf.console.log("Media: removing node...");
reset.call(this);});this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}apf.console.log("Media: reparenting - "+beforeNode+", "+pNode);this.$draw();reload.call(this,true);
});function reset(){this.setProperty("networkState",apf.Media.NETWORK_EMPTY);this.setProperty("ready",false);
this.buffered={start:0,end:0,length:0};this.bufferedBytes={start:0,end:0,length:0};
this.totalBytes=0;this.setProperty("progress",0);this.setProperty("seeking",false);
this.setProperty("paused",true);this.setProperty("position",0);this.currentTime=this.duration=0;
this.played=this.seekable=null;this.ended=false;this.start=this.end=this.loopStart=this.loopEnd=this.playCount=this.currentLoop=0;
this.controls=this.muted=false;}function reload(bNoReset){apf.console.log("Media: reloading medium with mimetype '"+this.type+"'");
window.clearTimeout(this.$loadTimer);this.$loadTimer=null;if(!bNoReset){reset.call(this);
}this.$destroy(true);this.playerType=this.$getPlayerType(this.type);if(!this.playerType||!this.$isSupported()){this.$ext.innerHTML=this.notSupported;
return;}this.$initPlayer();}this.MediaError=function(sMsg){return new Error(apf.formatErrorString(0,this,"Media",sMsg));
};this.src=this.currentSrc=null;this.networkState=apf.Media.NETWORK_EMPTY;this.bufferingRate=0;
this.bufferingThrottled=false;this.buffered={start:0,end:0,length:0};this.bufferedBytes={start:0,end:0,length:0};
this.totalBytes=0;this.volume=100;this.loadMedia=function(){};this.readyState=apf.Media.HAVE_NOTHING;
this.seeking=false;this.currentTime=this.duration=0;this.paused=true;this.defaultPlaybackRate=this.playbackRate=0;
this.played=null;this.seekable=null;this.ended=this.autoplay=false;this.canPlayType=function(sType){if(this.$getPlayerType){var sPlayer=this.$getPlayerType(sType);
if(!sPlayer||!this.$isSupported(sPlayer)){return"no";}if(sPlayer.indexOf("Wmp")!=-1){return"maybe";
}return"probably";}return"no";};this.play=function(){this.setProperty("paused",false);
};this.pause=function(){this.setProperty("paused",true);};this.start=this.end=this.loopStart=this.loopEnd=this.playCount=this.currentLoop=0;
this.addCueRange=function(sClassName,sId,iStart,iEnd,bPauseOnExit,fEnterCallback,fExitCallback){};
this.removeCueRanges=function(sClassName){};this.getCounter=function(iMillis,sFormat,bReverse){if(bReverse){iMillis=iMillis-this.duration;
}var iSeconds=Math.round(Math.abs(iMillis/1000)),sHours=String(Math.round(Math.abs(iSeconds/60/60))).pad(2,"0"),sMinutes=String(Math.round(Math.abs(iSeconds/60))).pad(2,"0"),sSeconds=String(iSeconds).pad(2,"0"),sMillis=String(Math.round(Math.abs(iMillis%1000))).pad(3,"0");
return(bReverse?"- ":"")+sFormat.replace(/\%T/g,"%H:%M:%S").replace(/\%[a-zA-Z\%]/g,function(sMatch){switch(sMatch){case"%H":return sHours;
case"%M":return sMinutes;case"%S":return sSeconds;case"%Q":return sMillis;case"%n":return"\n";
case"%t":return"\t";case"%%":return"%";}});};this.setSource=function(){if(!this.src){var src,type,oSources=this.$sources;
for(var i=0,j=oSources.length;i<j;i++){src=oSources[i].src;if(!src){continue;}type=oSources[i].type;
if(!type){type=this.$guessType(src);}if(this.canPlayType(type)!="no"){this.src=src;
this.type=type;break;}}}else{if(!this.type){this.type=this.$guessType(this.src);
if(this.canPlayType(this.type)=="no"){return false;}}}return(this.src&&this.type);
};this.$addSource=function(amlNode){clearTimeout(this.$amlTimer);if(amlNode.localName!="source"){throw new Error(apf.formatErrorString(0,this,"Parsing Media node","Found element which is not a source element",this));
return false;}this.$sources.pushUnique(amlNode);var _self=this;this.$amlTimer=$setTimeout(function(){clearTimeout(_self.$amlTimer);
_self.dispatchEvent("AMLMediaReady");});};this.$removeSource=function(amlNode){this.$sources.remove(amlNode);
};this.addEventListener("DOMNodeInserted",function(e){if(e.relatedNode!=this||e.currentTarget.nodeType!=1){return;
}this.$addSource(e.currentTarget);});this.addEventListener("DOMNodeRemoved",function(e){var node=e.currentTarget;
if(!(node.parentNode==this||node.parentNode.parentNode==this)){return;}this.$removeSource(node);
});}).call(apf.Media.prototype=new apf.StandardBinding());apf.nomedia=function(struct,tagName){this.$init(tagName||"nomedia",apf.NODE_HIDDEN,struct);
};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.parentNode.notSupported=apf.getXmlString(this.$aml).replace(/<\/?a:nomedia[^>]*>/g,"");
});}).call(apf.nomedia.prototype=new apf.AmlElement());apf.aml.setElement("nomedia",apf.nomedia);
apf.Media.NETWORK_EMPTY=0;apf.Media.NETWORK_IDLE=1;apf.Media.NETWORK_LOADING=2;
apf.Media.NETWORK_LOADED=3;apf.Media.HAVE_NOTHING=0;apf.Media.HAVE_METADATA=1;apf.Media.HAVE_SOME_DATA=2;
apf.Media.HAVE_CURRENT_DATA=3;apf.Media.HAVE_FUTURE_DATA=4;apf.Media.HAVE_ENOUGH_DATA=5;
apf.__MULTICHECK__=1<<22;apf.MultiCheck=function(){this.$regbase=this.$regbase|apf.__MULTICHECK__;
this.multicheck=true;this.checklength=0;this.$checkedList=[];this.check=function(xmlNode,userAction){if(userAction&&this.disabled||this.$checkedList.indexOf(xmlNode)>-1){return;
}if(userAction&&this.$executeSingleValue("check","checked",xmlNode,"true")!==false){return;
}if(this.dispatchEvent("beforecheck",{xmlNode:xmlNode})===false){return false;}if(!this.multicheck&&this.$checkedList.length){this.clearChecked(true);
}this.$checkedList.push(xmlNode);if(this.$isTreeArch){var nodes=xmlNode.selectNodes(".//"+this.each.split("|").join("|.//"));
this.checkList(nodes,null,true,true);var all,pNode=this.getTraverseParent(xmlNode);
while(pNode&&pNode!=this.xmlRoot){nodes=this.getTraverseNodes(pNode);all=true;for(var i=0;
i<nodes.length;i++){if(this.$checkedList.indexOf(nodes[i])==-1){all=false;break;
}}apf.setStyleClass(apf.xmldb.getHtmlNode(pNode,this),all?"checked":"partial",["partial","checked"]);
if(all){this.$checkedList.push(pNode);}pNode=this.getTraverseParent(pNode);}}this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,this),"checked",["partial"]);
this.dispatchEvent("aftercheck",{list:this.$checkedList,xmlNode:xmlNode});};this.uncheck=function(xmlNode,userAction){if(userAction&&this.disabled||this.$checkedList.indexOf(xmlNode)==-1){return;
}if(userAction&&this.$executeSingleValue("check","checked",xmlNode,"false")!==false){return;
}if(this.$isTreeArch){return this.checkList([xmlNode],true,true);}if(this.dispatchEvent("beforeuncheck",{xmlNode:xmlNode})===false){return false;
}this.$checkedList.remove(xmlNode);this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,this),"",["checked","partial"]);
this.dispatchEvent("afteruncheck",{list:this.$checkedList,xmlNode:xmlNode});};this.checkToggle=function(xmlNode,userAction){if(userAction&&this.disabled){return;
}if(xmlNode.style){var htmlNode=xmlNode,id=htmlNode.getAttribute(apf.xmldb.htmlIdTag);
while(!id&&htmlNode.parentNode){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}xmlNode=apf.xmldb.getNode(htmlNode);}if(this.$checkedList.indexOf(xmlNode)>-1){this.uncheck(xmlNode,userAction);
}else{this.check(xmlNode,userAction);}};this.checkList=function(xmlNodeList,uncheck,noClear,noEvent,userAction){if(!xmlNodeList.indexOf){xmlNodeList=apf.getArrayFromNodelist(xmlNodeList);
}if(userAction){if(this.disabled){return;}var changes=[];for(var c,i=0;i<xmlNodeList.length;
i++){c=this.$executeSingleValue("check","checked",xmlNodeList[i],uncheck?"false":"true",true);
if(c===false){break;}changes.push(c);}if(changes.length){return this.$executeAction("multicall",changes,"checked",xmlNodeList[0],null,null,xmlNodeList.length>1?xmlNodeList:null);
}}if(userAction&&this.disabled){return;}if(!noEvent&&this.dispatchEvent("beforecheck",{list:xmlNodeList})===false){return false;
}if(!uncheck&&!noClear){this.clearChecked(true);}if(!this.multicheck){xmlNodeList=[xmlNodeList[0]];
}var i;if(uncheck){for(i=xmlNodeList.length-1;i>=0;i--){this.$checkedList.remove(xmlNodeList[i]);
this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNodeList[i],this),"",["checked"]);
}}else{for(i=xmlNodeList.length-1;i>=0;i--){this.$checkedList.push(xmlNodeList[i]);
this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNodeList[i],this),"checked");}}if(!noEvent&&this.$isTreeArch){var _self=this;
function recur(xmlNode,forceChange){var nodes=_self.getTraverseNodes(xmlNode);if(!nodes.length){if(forceChange){if(uncheck){_self.$checkedList.remove(xmlNode);
_self.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"",["checked"]);return 0;
}else{if(_self.$checkedList.indexOf(xmlNode)==-1){_self.$checkedList.push(xmlNode);
_self.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"checked");}return 1;
}}return _self.$checkedList.indexOf(xmlNode)>-1?1:0;}var isInList=_self.$checkedList.indexOf(xmlNode)!=-1,shouldBeChanged=forceChange||xmlNodeList.indexOf(xmlNode)>-1&&(uncheck?!isInList:isInList),all=true,none=true,partial=false,isChecked;
for(var i=nodes.length-1;i>=0;i--){isChecked=recur(nodes[i],shouldBeChanged);if(isChecked){none=false;
if(!partial&&isChecked==2){partial=true;}}else{all=false;}if(!all&&!none){partial=true;
}}if(xmlNode==_self.xmlRoot){return;}if(all){if(!isInList){_self.$checkedList.push(xmlNode);
apf.setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"checked",["partial"]);}}else{if(isInList){_self.$checkedList.remove(xmlNode);
}apf.setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),partial?"partial":"",["partial","checked"]);
}return all?1:(none?0:2);}recur(this.xmlRoot);}if(!noEvent){this.dispatchEvent("aftercheck",{list:xmlNodeList});
}};this.clearChecked=function(noEvent){if(!noEvent&&this.dispatchEvent("beforeuncheck",{xmlNode:this.$checkedList})===false){return false;
}for(var i=this.$checkedList.length-1;i>=0;i--){this.$setStyleClass(apf.xmldb.getHtmlNode(this.$checkedList[i],this),"",["checked"]);
}this.$checkedList.length=0;if(!noEvent){this.dispatchEvent("afteruncheck",{list:this.$checkedList});
}};this.isChecked=function(xmlNode){return this.$checkedList.indexOf(xmlNode)>-1;
};this.getChecked=function(xmldoc){var i,r;if(xmldoc){r=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();
for(i=0;i<this.$checkedList.length;i++){apf.xmldb.cleanNode(r.appendChild(this.$checkedList[i].cloneNode(true)));
}}else{for(r=[],i=0;i<this.$checkedList.length;i++){r.push(this.$checkedList[i]);
}}return r;};this.checkAll=function(userAction){if(!this.multicheck||userAction&&this.disabled||!this.xmlRoot){return;
}var nodes=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.getTraverseNodes();
this.checkList(nodes);};this.addEventListener("beforeload",function(){if(!this.$hasBindRule("checked")){this.clearChecked(true);
}});this.addEventListener("afterload",function(){if(!this.$hasBindRule("checked")&&this.$checkedList.length){this.checkList(this.$checkedList,false,true,false);
}});this.addEventListener("xmlupdate",function(e){if(e.action=="attribute"||e.action=="text"||e.action=="synchronize"||e.action=="update"){var c1=apf.isTrue(this.$applyBindRule("checked",e.xmlNode));
var c2=this.isChecked(e.xmlNode);if(c1!=c2){if(c1){this.check(e.xmlNode);}else{this.uncheck(e.xmlNode);
}}}});this.addEventListener("aftercheck",function(){if(this.checklength!=this.$checkedList.length){this.setProperty("checklength",this.$checkedList.length);
}});this.addEventListener("afteruncheck",function(){if(this.checklength!=this.$checkedList.length){this.setProperty("checklength",this.$checkedList.length);
}});};apf.Teleport=function(){this.$init(true);};apf.__TELEPORT__=1<<28;(function(){this.$parsePrio="002";
this.$regbase=this.$regbase|apf.__TELEPORT__;this.$booleanProperties.autoroute=true;
this.$supportedProperties.push("url","timeout","protocol","route-server","autoroute");
this.$propHandlers.url=function(value){var url=new apf.url(value);if(!url.protocol){return apf.console.error(apf.formatErrorString(0,this,"Communication (Teleport) initialization error","Invalid server url provided: '"+value+"'"));
}this.$host=url.host;this.$rootPath=url.path;this.$server=value.replace(new RegExp(this.$rootPath+"$"),"");
};this.$propHandlers.timeout=function(value){this.timeout=parseInt(value)||10000;
};this.$propHandlers.protocol=function(value){var proto=value.toLowerCase();if(!apf[proto]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+proto+"'",this));
}this.implement(apf[proto]);};this.toString=function(){return"[Ajax.org Teleport Component : "+(this.name||"")+" ("+this.type+")]";
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){var error;if(this.type&&this.type=="socket"){if(!apf.socket){error="Socket";
}else{this.implement(apf.socket);}}else{if(!apf.http){error="HTTP";}else{this.implement(apf.http);
}}if(error){throw new Error(apf.formatErrorString(1024,null,"Teleport baseclass","Could not find Ajax.org Teleport "+error+" Component",this.$aml));
}if(this.id){apf.$asyncObjects[this.id]=1;}});}).call(apf.Teleport.prototype=new apf.AmlElement());
apf.teleportLog=function(extra){var xml,request=extra.method+" "+extra.url+" HTTP/1.1\n\n"+extra.data;
this.setXml=function(pNode){if(!xml){var doc=pNode.ownerDocument;xml=doc.createElement(extra.tp.localName||extra.type||"http");
xml.appendChild(doc.createElement("request")).appendChild(doc.createTextNode(request||"-"));
xml.appendChild(doc.createElement("response")).appendChild(doc.createTextNode(response||"-"));
}apf.xmldb.appendChild(pNode,xml);};this.request=function(headers){request=request.replace(/\n\n/,"\n"+headers.join("\n")+"\n\n");
if(xml){apf.setQueryValue(xml,"request/text()",request);}this.request=function(){};
};var response="";this.response=function(extra){try{var headers=extra.http.getAllResponseHeaders();
response="HTTP/1.1 "+extra.status+" "+extra.statusText+"\n"+(headers?headers+"\n":"\n")+extra.http.responseText;
if(xml){apf.setQueryValue(xml,"response/text()",response);}}catch(ex){}};};apf.Init.run("teleport");
apf.__TRANSACTION__=1<<3;apf.Transaction=function(){this.$regbase=this.$regbase|apf.__TRANSACTION__;
this.$addParent=this.$transactionNode=this.$transactionSubject=this.$originalNode=this.$inTransaction=this.$lastAction=null;
this.$supportedProperties.push("autoshow");this.$booleanProperties.autoshow=true;
this.commit=function(repeat){if(!this.$inTransaction){return false;}if(!this.$validgroup&&this.validgroup){this.$validgroup=self[this.validgroup];
}if(this.$validgroup&&!this.$validgroup.isValid()){return false;}var returnValue=true;
if(!this.$at.undolength){if(repeat){return false;}this.$at.purge();this.$inTransaction=false;
this.load(this.$originalNode);this.$helperModel.reset();returnValue=false;}else{apf.console.info("Committing transaction on "+this.localName+"["+this.name+"]");
this.$at.reset();this.$inTransaction=false;this.$transactionNode.removeAttribute(apf.xmldb.xmlListenTag);
if(this.$lastAction=="add"){if(this.$transactionSubject.$executeAction("appendChild",[this.$addParent,this.$transactionNode],"add",this.$transactionNode)&&this.$transactionSubject.hasFeature(apf.__MULTISELECT__)){this.$transactionSubject.select(this.$transactionNode);
}this.$transactionSubject=null;}else{var at=this.$at;this.$at=this.dataParent?this.dataParent.parent.getActionTracker():null;
this.$transactionSubject.$executeAction("replaceNode",[this.$originalNode,this.$transactionNode],"update",this.$transactionNode);
this.$at=at;}}this.$transactionNode=null;this.$addParent=null;this.$originalNode=null;
if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.hide();}}return returnValue;
};this.rollback=function(noLoad){if(!this.$inTransaction){return;}apf.console.info("Rolling back transaction on "+this.localName+"["+this.name+"]");
if(this.$at){if(this.rpcMode=="realtime"){this.$at.undo(-1);}this.$at.reset();}this.$transactionNode=null;
this.$addParent=null;if(!noLoad){this.load(this.$originalNode);}this.$helperModel.reset();
this.$stopAction(this.$lastAction,true);this.$originalNode=null;this.$inTransaction=false;
if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.hide();}}};
this.begin=function(strAction,xmlNode,parentXmlNode,dataParent){if(this.$inTransaction){apf.console.warn("Rolling back transaction, while starting a new one");
if(this.autoshow){this.autoshow=-1;}this.rollback();}apf.console.info("Beginning transaction on "+this.localName+"["+this.name+"]");
var _self=this;this.$lastAction=strAction;if(!this.$lastAction){this.$lastAction=this.xmlRoot&&"update"||"add";
}if(!this.$lastAction){throw new Error(apf.formatErrorString(0,this,"Starting Transaction","Could not determine whether to add or update."));
}if(dataParent){this.$setDynamicProperty("model","["+dataParent.id+".selected]");
}if(xmlNode&&this.$lastAction=="update"){this.xmlRoot=xmlNode;}if(!this.$at){this.$at=new apf.actiontracker();
var propListen=function(e){_self.setProperty(e.prop,e.value);};this.$at.addEventListener("prop.undolength",propListen);
this.setProperty("undolength",0);this.$at.addEventListener("prop.redolength",propListen);
this.setProperty("redolength",0);}if(!this.$helperModel){this.$helperModel=new apf.model();
this.$helperModel["save-original"]=true;this.$helperModel.load("<data />");}this.$transactionNode=null;
this.$addParent=null;this.$originalNode=this.xmlRoot;if(typeof apf.offline!="undefined"&&!apf.offline.canTransact()){return false;
}this.$inTransaction=true;function begin(){if(!this.$transactionNode){throw new Error(apf.formatErrorString(0,this,"Starting transaction","Missing transaction node. Cannot start transaction.                      This error is unrecoverable."));
}this.$inTransaction=-1;this.$helperModel.data.appendChild(this.$transactionNode);
this.load(this.$helperModel.data.firstChild);this.$inTransaction=true;if(this.disabled){this.enable();
}if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.show();}}}dataParent=this.dataParent&&this.dataParent.parent;
if(!dataParent||!dataParent.$actions||!dataParent.$actions[this.$lastAction]){dataParent=this;
}if(this.$lastAction=="add"){var rule,actionRules=dataParent.$actions;if(actionRules){if(xmlNode&&xmlNode.nodeType){rule=actionRules.getRule("add",xmlNode);
}else{if(typeof xmlNode=="string"){if(xmlNode.trim().charAt(0)=="<"){xmlNode=apf.getXml(xmlNode);
rule=actionRules.getRule("add",xmlNode);}else{var rules=actionRules.$rules.add;
for(var i=0,l=rules.length;i<l;i++){if(rules[i].getAttribute("type")==xmlNode){xmlNode=null;
rule=rules[i];break;}}}}}if(!rule){rule=(dataParent.$actions.add||{})[0];}}else{rule=null;
}if(typeof apf.offline!="undefined"&&!apf.offline.onLine&&!rule.get){return false;
}var refNode=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot;var callback=function(addXmlNode,state,extra){if(state!=apf.SUCCESS){var oError;
oError=new Error(apf.formatErrorString(1032,dataParent,"Loading xml data","Could not add data for control "+dataParent.name+"["+dataParent.tagName+"] \nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+xmlNode));
if(extra.tpModule.retryTimeout(extra,state,dataParent,oError)===true){return true;
}throw oError;}if(typeof addXmlNode!="object"){addXmlNode=apf.getXmlDom(addXmlNode).documentElement;
}if(addXmlNode.getAttribute(apf.xmldb.xmlIdTag)){addXmlNode.setAttribute(apf.xmldb.xmlIdTag,"");
}if(!dataParent.$startAction("add",addXmlNode,_self.rollback)){return false;}var actionNode=(dataParent.$actions&&dataParent.$actions.getRule("add",dataParent.$isTreeArch?dataParent.selected:dataParent.xmlRoot)||{})[2];
if(parentXmlNode){_self.$addParent=parentXmlNode;}else{if(actionNode&&actionNode.getAttribute("parent")){_self.$addParent=dataParent.xmlRoot.selectSingleNode(actionNode.getAttribute("parent"));
}else{_self.$addParent=dataParent.$isTreeArch?dataParent.selected||dataParent.xmlRoot:dataParent.xmlRoot;
}}if(!_self.$addParent){_self.$addParent=dataParent.xmlRoot||dataParent.getModel(true).data;
}if(apf.isWebkit&&_self.$addParent.ownerDocument!=addXmlNode.ownerDocument){addXmlNode=_self.$addParent.ownerDocument.importNode(addXmlNode,true);
}_self.$transactionNode=addXmlNode;_self.$transactionSubject=dataParent;begin.call(_self);
};if(xmlNode){return callback(xmlNode,apf.SUCCESS);}else{if(rule&&rule.get){return apf.getData(rule.get,{xmlNode:refNode,callback:callback});
}else{throw new Error(apf.formatErrorString(0,this,"Starting transaction","Missing add rule for transaction"));
}}}else{if(!dataParent.$startAction(this.$lastAction,this.xmlRoot,this.rollback)){return false;
}this.$transactionSubject=dataParent;this.$transactionNode=this.$originalNode.cloneNode(true);
begin.call(this);}};this.$canLoadData=function(){return true;};this.addEventListener("prop.model",function(e){return false;
});this.clear=function(){this.documentId=this.xmlRoot=this.cacheId=null;};this.addEventListener("beforeload",function(e){var xmlNode=e.xmlNode;
if(this.$inTransaction==-1){return;}if(this.$inTransaction){if(this.$transactionNode&&xmlNode!=this.$transactionNode){if(this.autoshow){this.autoshow=-1;
}this.rollback(true);}else{return;}}if(this.autoshow){this.autoshow=-1;}if(this.begin("update",xmlNode)!==false){return false;
}});};apf.GuiElement.propHandlers.transaction=function(value){if(!(this.transaction=apf.isTrue(value))){return;
}if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);
}if(!this.hasFeature(apf.__DATAACTION__)){this.implement(apf.DataAction);if(this.actions){this.$propHandlers.actions.call(this,this.actions,"actions");
}}if(!this.hasFeature(apf.__TRANSACTION__)){this.implement(apf.Transaction);if(!this.validgroup){this.$validgroup=new apf.ValidationGroup();
this.$validgroup.register(this);}if(!this.id){this.setProperty("id",this.localName+"_"+this.$uniqueId);
}var attr=this.attributes.getNamedItem("model");if(!attr){this.attributes.push(attr=new apf.AmlAttr(this,"model",null));
}attr.inheritedValue="{"+this.id+".root}";if(typeof this.autoshow=="undefined"&&(this.localName=="modalwindow"||this.localName=="window")){this.autoshow=true;
}}};apf.__VIRTUALVIEWPORT__=1<<19;apf.VirtualViewport=function(){this.$init(true);
this.$regbase=this.$regbase|apf.__VIRTUALVIEWPORT__;this.virtualVTimer=null;this._xmlUpdate=this.$xmlUpdate;
apf.setStyleClass(this.$ext,"virtual");this.$deInitNode=function(xmlNode,htmlNode){this.viewport.redraw();
};this.$moveNode=function(xmlNode,htmlNode){this.viewport.redraw();};this.emptyNode=apf.xmldb.getXml("<empty />");
this.$addEmpty=this.$add;this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){var htmlNode=this.$pHtmlDoc.getElementById(Lid);
if(!htmlNode){return;}this.$updateNode(xmlNode,htmlNode);};this.$fill=function(){};
this.addEventListener("$load",function(){if(!this.viewport.limit){this.viewport.limit=1;
}});this.clear=function(nomsg,do_event){if(this.clearSelection){this.clearSelection(!do_event);
}this.documentId=this.xmlRoot=this.cacheId=null;if(!nomsg){this.viewport.offset=0;
this.viewport.length=0;this.viewport.resize(0);this.viewport.sb.update();this.$setClearMessage(this["empty-message"]);
}else{if(this.$removeClearMessage){this.$removeClearMessage();}}this.viewport.cache=null;
};var _self=this;this.viewport={offset:0,limit:2,length:0,sb:new apf.scrollbar(),host:this,cache:null,inited:false,draw:function(){this.inited=true;
var limit=this.limit;this.limit=0;this.resize(limit,true);},redraw:function(){this.change(this.offset);
},prepare:function(){if(!this.inited){this.draw();}var nodes=_self.getTraverseNodes();
if(!nodes){return;}var docId=apf.xmldb.getXmlDocId(_self.xmlRoot),hNodes=_self.$container.childNodes;
for(var j=0,i=0,l=hNodes.length;i<l;i++){if(hNodes[i].nodeType!=1){continue;}hNodes[i].style.display=(j>=nodes.length)?"none":"block";
apf.xmldb.nodeConnect(docId,nodes[j],hNodes[i],_self);j++;}},resize:function(limit,updateScrollbar){this.cache=null;
var i;if(limit<this.limit){var nodes=_self.$container.childNodes;for(i=nodes.length-1;
i>=0;i--){if(nodes[i].nodeType!=1){continue;}_self.$container.removeChild(nodes[i]);
if(--this.limit==limit){break;}}}else{if(limit>this.limit){for(i=this.limit;i<limit;
i++){_self.$addEmpty(_self.emptyNode,"",_self.xmlRoot,_self.$container);}}else{return;
}}this.limit=limit;if(updateScrollbar){this.sb.update(this.$container);}},findNewLimit:function(scrollTop){var oHtml=_self.$container;
if(!scrollTop){scrollTop=oHtml.scrollTop;}if(!_self.xmlRoot||oHtml.lastChild&&oHtml.lastChild.style.display=="none"){return;
}if(!oHtml.lastChild||oHtml.lastChild.offsetTop+oHtml.lastChild.offsetHeight<=oHtml.offsetHeight+scrollTop){var Lid,xmlNode,nodes,sel=_self.$getSelection();
while(this.limit<this.length-1&&(!oHtml.lastChild||oHtml.lastChild.offsetTop+oHtml.lastChild.offsetHeight<=oHtml.offsetHeight+scrollTop)){this.limit++;
nodes=_self.getTraverseNodes();if(nodes.length<this.limit){this.limit=nodes.length;
break;}xmlNode=nodes[nodes.length-1];Lid=apf.xmldb.nodeConnect(_self.documentId,xmlNode,null,_self);
_self.$addEmpty(xmlNode,Lid,_self.xmlRoot,oHtml);if(sel.indexOf(xmlNode)>-1){_self.$select(oHtml.lastChild);
}else{_self.$deselect(oHtml.lastChild);}}}else{if(oHtml.lastChild&&oHtml.lastChild.offsetTop>oHtml.offsetHeight+scrollTop){var lastChild;
while(this.limit>2&&(lastChild=oHtml.lastChild).offsetTop>oHtml.offsetHeight+scrollTop){_self.$container.removeChild(lastChild);
this.limit--;}}}if(!this.initialLimit){this.initialLimit=this.limit;}},change:function(offset,limit,updateScrollbar,noScroll){var offsetN;
if(offset<0){offset=0;}if(offset>this.length-this.limit-1){offsetN=Math.floor(this.length-this.limit-1);
}else{offsetN=Math.floor(offset);}if(!limit){limit=this.limit;}this.cache=null;
var diff=offsetN-this.offset,oldLimit=this.limit;if(diff*diff>=this.limit*this.limit){diff=false;
}this.offset=offsetN;if(diff>0){var lastNode=_self.$container.lastChild;if(lastNode.nodeType!=1){lastNode=lastNode.previousSibling;
}}if(updateScrollbar){this.sb.$curValue=this.offset/(this.length-this.limit-1);
this.sb.updatePos();}var nodes=_self.getTraverseNodes();if(!nodes){return;}if(nodes.length<this.limit){if(offset>0){alert("shouldnt get here");
}else{this.resize(nodes.length);}}var docId=apf.xmldb.getXmlDocId(_self.xmlRoot),hNodes=_self.$container.childNodes,xmlNode,htmlNode,xmlPos,sel,len,j,i;
if(diff>0){xmlPos=oldLimit-diff;len=hNodes.length,sel=_self.$getSelection();for(j=0,i=0;
j<diff&&i<len;i++){htmlNode=_self.$container.firstChild;if(htmlNode.nodeType==1){j++;
xmlNode=nodes[xmlPos++];if(xmlNode){apf.xmldb.nodeConnect(docId,xmlNode,htmlNode,_self);
_self.$updateNode(xmlNode,htmlNode);if(sel.indexOf(xmlNode)>-1){_self.$select(htmlNode);
}else{_self.$deselect(htmlNode);}htmlNode.style.display="block";}else{htmlNode.style.display="none";
}}_self.$container.appendChild(htmlNode);}}else{if(diff<0){diff=diff*-1;xmlPos=0;
sel=_self.$getSelection();for(j=0,i=hNodes.length-1;j<diff&&i>=0;i++){htmlNode=_self.$container.lastChild;
if(htmlNode.nodeType==1){j++;xmlNode=nodes[xmlPos++];apf.xmldb.nodeConnect(docId,xmlNode,htmlNode,_self);
_self.$updateNode(xmlNode,htmlNode);if(sel.indexOf(xmlNode)>-1){_self.$select(htmlNode);
}else{_self.$deselect(htmlNode);}htmlNode.style.display="block";}_self.$container.insertBefore(htmlNode,_self.$container.firstChild);
}}else{if(diff===false){len=hNodes.length;sel=_self.$getSelection();for(j=0,i=0;
i<len;i++){htmlNode=hNodes[i];if(htmlNode.nodeType==1){xmlNode=nodes[j++];apf.xmldb.nodeConnect(docId,xmlNode,htmlNode,_self);
_self.$updateNode(xmlNode,htmlNode);if(sel.indexOf(xmlNode)>-1){_self.$select(htmlNode);
}else{_self.$deselect(htmlNode);}}}}}}if(!noScroll){if(offset>=this.length-this.initialLimit){diff=offset-(this.length-this.initialLimit)+2;
_self.$container.scrollTop=(_self.$container.scrollHeight-_self.$container.offsetHeight)*(diff/2);
}else{var scrollTop=(offset%1)*_self.$container.firstChild.offsetHeight;this.findNewLimit(scrollTop);
_self.$container.scrollTop=scrollTop;}if(updateScrollbar){this.sb.update();}return;
}}};this.viewport.sb.parentNode=new apf.Class().$init();this.viewport.sb.parentNode.$container=this.$pHtmlNode;
this.viewport.sb.dispatchEvent("DOMNodeInsertedIntoDocument");this.viewport.sb.attach(this.$container,this.viewport,function(timed,pos){var vp=_self.viewport;
if(vp.sb.realtime||!timed){var l=vp.length-vp.initialLimit;if(l==0){_self.$container.scrollTop=pos*(_self.$container.scrollHeight-_self.$container.offsetHeight);
}else{vp.change(l*pos,vp.limit,false);}}else{clearTimeout(this.virtualVTimer);this.virtualVTimer=$setTimeout(function(){vp.change(Math.round((vp.length-vp.initialLimit)*pos),vp.limit,false);
},300);}});apf.layout.setRules(this.$container,"scrollbar","        var s = apf.all["+this.viewport.sb.$uniqueId+"];        s.update();    ",true);
apf.layout.queue(this.$container);this.$isInViewport=function(xmlNode,struct){var nodes=this.getTraverseNodes();
for(var i=0,l=nodes.length;i<l;i++){if(nodes[i]==xmlNode){return true;}}return false;
};this.scrollTo=function(xmlNode,last){var sPos={};this.$isInViewport(xmlNode,sPos);
this.viewport.change(sPos.position+(last?this.viewport.limit-1:0));};this.getFirstTraverseNode=function(xmlNode){return this.getTraverseNodes(xmlNode)[0];
};this.$clearVirtualDataset=function(parentNode){var nodes=parentNode.childNodes;
for(var i=nodes.length-1;i>=0;i--){parentNode.removeChild(nodes[i]);}};this.$createVirtualDataset=function(xmlNode,length,docId){var marker=xmlNode.selectSingleNode("a_marker")||xmlNode.appendChild(xmlNode.ownerDocument.createElement("a_marker"));
marker.setAttribute("start","0");if(length){marker.setAttribute("end",length);marker.setAttribute("reserved",++this.nodeCount[docId]);
this.nodeCount[docId]+=length;}};this.$xmlUpdate=function(){this.viewport.cache=null;
this.viewport.length=this.xmlRoot.selectNodes(this.each).length;this.viewport.sb.update(this.$container);
this._xmlUpdate.apply(this,arguments);};this.$load=function(XMLRoot){apf.xmldb.addNodeListener(XMLRoot,this);
if(!this.renderRoot&&!this.getTraverseNodes(XMLRoot).length){return this.clear("loading");
}if(this.$hasBindRule("load")){this.$createVirtualDataset(XMLRoot);}this.viewport.cache=null;
this.viewport.length=this.xmlRoot.selectNodes(this.each).length+1;this.viewport.prepare();
var nodes=this.$addNodes(XMLRoot,null,null,this.renderRoot);this.viewport.sb.update(this.$container);
if(this.selectable){if(this.autoselect){if(nodes.length){this.$selectDefault(XMLRoot);
}else{this.setProperty("selected",null);}}else{this.clearSelection(true);var xmlNode=this.getFirstTraverseNode();
if(xmlNode){this.setCaret(xmlNode);}this.setProperty("selected",null);this.setProperty("chosen",null);
}}if(this.$focussable){apf.window.hasFocus(this)?this.$focus():this.$blur();}};
this.$loadSubData=function(){};this.$loadPartialData=function(marker,start,length){var loadNode,rule=this.$getBindRule("load",xmlRootNode);
if(rule&&(!rule[1]||rule[1](xmlRootNode))){this.$setLoadStatus(xmlRootNode,"loading");
var mdl=this.getModel(true);if(!mdl){throw new Error("Could not find model");}if(!rule.getAttribute("total")){throw new Error(apf.formatErrorString(this,"Loading data","Error in load rule. Missing total xpath. Expecting <a:load total='xpath' />"));
}mdl.$insertFrom(rule.getAttribute("get"),{ascending:this.$sort?this.$sort.get().ascending:true,xmlNode:loadNode,documentId:this.documentId,marker:marker,start:start,length:length,insertPoint:this.xmlRoot,amlNode:this,callback:function(xmlNode){_self.setProperty("root",_self.xmlRoot);
var length=parseInt(apf.queryValue(xmlNode,rule.getAttribute("total")));if(_self.viewport.length!=length){_self.viewport.length=length;
this.$createVirtualDataset(_self.xmlRoot,_self.viewport.length,_self.documentId);
}}});}};function fillList(len,list,from){for(var i=0;i<len;i++){list.push(_self.documentId+"|"+(from+i));
}}function buildList(markers,markerId,distance,xml){var marker,nodes,start,vlen=this.viewport.limit,list=[];
if(markerId==-1){nodes=xml.selectNodes(_self.each);start=0;marker=markers[0];}else{if(distance<0){fillList(Math.abs(distance),list,parseInt(marker.getAttribute("reserved"))+parseInt(marker.getAttribute("end"))-parseInt(marker.getAttribute("start"))+distance);
distance=0;_self.$loadPartialData(marker);if(list.length==vlen){return list;}}nodes=markers[markerId].selectNodes("following-sibling::"+this.each.split("|").join("following-sibling::"));
start=markers[markerId].getAttribute("end");marker=markers[++markerId];}do{var loop=Math.min(marker.getAttribute("start")-start,vlen);
for(var i=distance;i<loop;i++){list.push(nodes[i]);}if(list.length==vlen){break;
}var mlen=parseInt(marker.getAttribute("end"))-parseInt(marker.getAttribute("start"));
fillList(Math.min(mlen,vlen-list.length),list,parseInt(marker.getAttribute("reserved")));
_self.$loadPartialData(marker);start=parseInt(marker.getAttribute("end"));marker=markers[++markerId];
distance=0;}while(list.length<vlen&&marker);_self.viewport.cache=list;return list;
}this.getTraverseNodes=function(xmlNode){if(!this.xmlRoot){return;}if(this.viewport.cache){return this.viewport.cache;
}var start=this.viewport.offset+1,end=start+this.viewport.limit;var markers=(xmlNode||this.xmlRoot).selectNodes("a_marker");
if(!markers.length){var list=(xmlNode||this.xmlRoot).selectNodes("("+this.each+")[position() >= "+start+" and position() < "+(end)+"]");
return this.$sort?this.$sort.apply(list):list;}for(var i=0;i<markers.length;i++){if(markers[i].getAttribute("end")<start){if(i==markers.length-1){return buildList(markers,i,start-markers[i].getAttribute("end"),(xmlNode||this.xmlRoot));
}continue;}if(markers[i].getAttribute("start")-end<=0&&start>=markers[i].getAttribute("start")){return buildList(markers,i,start-markers[i].getAttribute("end"),(xmlNode||this.xmlRoot));
}else{if(markers[i-1]){return buildList(markers,i-1,start-markers[i-1].getAttribute("end"),(xmlNode||this.xmlRoot));
}else{return buildList(markers,-1,start,(xmlNode||this.xmlRoot));}}}};var baseNTS=this.getNextTraverseSelected;
this.getNextTraverseSelected=function(xmlNode,up,count){if(!xmlNode){xmlNode=this.selected;
}if(!count){count=1;}var node=baseNTS.call(this,xmlNode,up,count);if(node&&node!=xmlNode){return node;
}var nodes=this.getTraverseNodes(),i=0;while(nodes[i]&&nodes[i]!=xmlNode){i++;}if(up){i=-1*(nodes.length-i-1);
}this.viewport.change(Math.max(0,this.viewport.offset+i+(up?count:-1*count)),null,true,true);
nodes=this.getTraverseNodes();return nodes[up?nodes.length-1:0];};this.caching=false;
};apf.__XFORMS__=1<<17;apf.clipboard=new apf.Class().$init();apf.clipboard.store=null;
apf.clipboard.empty=true;apf.clipboard.copied=null;apf.clipboard.put=function(item){this.store=item;
this.setProperty("empty",item?false:true);};apf.clipboard.clear=function(){this.setProperty("empty",true);
};apf.clipboard.get=function(){return this.store;};apf.clipboard.$highlightSelection=function(amlNode,nodes,unset){for(var i=0,l=nodes.length;
i<l;i++){apf.setStyleClass(apf.xmldb.getHtmlNode(nodes[i],amlNode),(unset?"":"cut"),["cut"]);
}};apf.clipboard.copySelection=function(amlNode){var nodes=this.get()||[];this.$highlightSelection(amlNode,nodes,true);
this.put(amlNode.getSelection().map(function(node){return apf.xmldb.getCleanCopy(node);
}));this.copied=true;};apf.clipboard.cutSelection=function(amlNode){var nodes=this.get()||[];
this.$highlightSelection(amlNode,nodes,true);this.put(nodes=amlNode.getSelection());
this.$highlightSelection(amlNode,nodes);this.copied=false;};apf.clipboard.pasteSelection=function(amlNode,selected){var nodes=this.get();
if(!nodes){return;}if(!selected){selected=amlNode.selected||amlNode.getFirstTraverseNode();
}if(amlNode.hasFeature(apf.__DRAGDROP__)){amlNode.copy(nodes,selected,undefined,!this.copied);
}else{if(nodes[0].parentNode){for(var i=0,l=nodes.length;i<l;i++){apf.xmldb.moveNode(selected,nodes[i]);
}}else{for(var i=0,l=nodes.length;i<l;i++){apf.xmldb.appendChild(selected,nodes[i]);
}}}this.$highlightSelection(amlNode,nodes,true);amlNode.selectList(nodes);};apf.ContentEditable.commands=(function(){var STATE=1;
var VALUE=2;var ENABL=3;var INDET=4;var commands={};var addType;commands.add=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}if(typeof addType=="object"){var amlNode=apf.getXml("<a:application xmlns:a='"+apf.ns.aml+"' />");
amlNode.appendChild(addType.cloneNode(true));}else{var amlNode=apf.getXml("<a:application xmlns:a='"+apf.ns.aml+"'><a:"+addType+" /></a:application>");
}if(options.skinset&&options.skinset!="default"){amlNode.firstChild.setAttribute("skinset",options.skinset);
}var htmlNode=options.htmlNode,parentNode=options.parentNode;if(!parentNode){parentNode=(apf.document.activeElement||apf.document.documentElement);
if(parentNode.getPage){parentNode=parentNode.getPage();}else{while(parentNode&&!parentNode.canHaveChildren){parentNode=parentNode.parentNode;
}}options.parentNode=parentNode;}var domParser=apf.document.$domParser;amlNode=domParser.parseFromXml(amlNode,{doc:this}).firstChild.firstChild;
if(!options.ignorePos){var pos=apf.getAbsolutePosition(parentNode.$int,null,true);
amlNode.setAttribute("left",htmlNode.offsetLeft-pos[0]);amlNode.setAttribute("top",htmlNode.offsetTop-pos[1]);
}if(amlNode.$getOption){var minwidth=amlNode.minwidth||parseInt(amlNode.$getOption("main","minwidth"))||5,minheight=amlNode.minheight||parseInt(amlNode.$getOption("main","minheight"))||5,maxwidth=amlNode.maxwidth||parseInt(amlNode.$getOption("main","maxwidth"))||10000,maxheight=amlNode.maxheight||parseInt(amlNode.$getOption("main","maxheight"))||10000;
}if(!options.ignorePos){amlNode.setAttribute("width",Math.min(maxwidth,Math.max(minwidth,htmlNode.offsetWidth)));
amlNode.setAttribute("height",Math.min(maxheight,Math.max(minheight,htmlNode.offsetHeight)));
}else{if(options.left||options.left===0){amlNode.setAttribute("left",options.left);
amlNode.setAttribute("top",options.top);}if(options.width||options.width===0){amlNode.setAttribute("width",options.width);
}if(options.height||options.height===0){amlNode.setAttribute("height",options.height);
}}var name,n=amlNode.localName.uCaseFirst(),i=0;do{name=n+ ++i;}while(self[name]);
amlNode.setAttribute("id",name);var hasProp=rename.getEditableProp(amlNode);if(hasProp){var prop=hasProp[1];
amlNode.setAttribute(prop,name);}if(options.userInteraction){amlNode.$adding=true;
}parentNode.insertBefore(amlNode,options.beforeNode);amlNode.setProperty("editable",true);
apf.layout.processQueue();if(!options.userInteraction){apf.document.getSelection().$selectList([amlNode]);
}options.addedNode=amlNode;};commands.contextmenu=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}if(options.amlNode.ownerDocument.dispatchEvent("contextmenu",{x:options.htmlEvent.x,y:options.htmlEvent.y,currentTarget:options.amlNode,bubbles:true})!==false&&showUI){mnuContentEditable.display(options.htmlEvent.x,options.htmlEvent.y,null,options.amlNode);
}};var rename={getInput:function(){apf.Rename.initEditableArea.call(this);var txt=this.$txt;
txt.className="editable";txt.style.height="auto";txt.onscroll=function(){return false;
};txt.host=this;return txt;},stopRename:function(n,success){if(success&&this.renaming){var doc=this.$renameElement.ownerDocument;
commands.begin.call(doc);this.stop(null,true);commands.commit.call(doc);}else{this.stop();
}},getEditableProp:function(el){var htmlNode,prop;if(el.$childProperty){prop=el.$childProperty;
}else{if(el.$editableCaption){prop=el.$editableCaption[0];}else{if(el.$getEditableCaption){var info=el.$getEditableCaption();
if(!info){return;}prop=info[1];htmlNode=info[0];}else{return;}}}if(!htmlNode){htmlNode=el.$getLayoutNode("main",prop,el.$ext);
}return[htmlNode,prop];},start:function(el){var info=this.getEditableProp(el);if(!info){return;
}htmlNode=info[0];this.$editableProp=info[1];if(!htmlNode){if(el.getPage){this.start(el.getPage());
}return;}this.$renameHtml=htmlNode;this.$renameElement=el;this.$renameContents=(htmlNode.nodeType==1?htmlNode.innerHTML:htmlNode.nodeValue);
var txt=this.getInput();if(htmlNode.nodeType==1){htmlNode.innerHTML="";htmlNode.appendChild(txt);
}else{htmlNode.parentNode.replaceChild(txt,htmlNode);}if(apf.hasContentEditable){txt.innerHTML=this.$renameContents.replace(/</g,"&lt;")||apf.hasContentEditableContainerBug&&"<br>"||"";
}else{txt.value=this.$renameContents;}txt.unselectable="Off";var f=function(){try{txt.focus();
txt.select();}catch(e){}};if(apf.isIE){f();}else{setTimeout(f);}this.renaming=true;
},stop:function(x,success){if(!this.renaming){return;}this.renaming=false;var htmlNode=this.$renameHtml;
if(htmlNode.nodeType==1){htmlNode.removeChild(this.$txt);}else{this.$txt.parentNode.replaceChild(htmlNode,this.$txt);
}var value=typeof success=="string"?success:(apf.hasContentEditable?this.$txt.innerText:this.$txt.value).replace(/<.*?nobr>/gi,"").replace(/\n$/,"");
var el=this.$renameElement;var prop=this.$editableProp;if(success&&el[prop]!=value){el.setAttribute(prop,value);
}else{if(htmlNode.nodeType==1){htmlNode.innerHTML=this.$renameContents;}else{htmlNode.nodeValue=this.$renameContents;
}}htmlNode.parentNode.scrollLeft=0;this.$editableProp=this.$renameHtml=this.$renameElement=this.$renameContents=null;
}};commands.rename=function(sel,showUI,value,query){switch(query){case STATE:return rename.renaming;
case VALUE:return String(rename.renaming);case ENABL:return rename.getEditableProp(value||sel[0]);
case INDET:return false;}if(showUI){if(sel.length){rename.start(sel[0]);}}else{rename.stop(null,value);
}};var mode,vcinited;commands.mode=function(sel,showUI,value,query){switch(query){case STATE:return mode||"default";
case VALUE:return mode||"default";case ENABL:return true;case INDET:return false;
}if(value=="select"){mode=value;this.$getSelectRect().activate();}else{if(value&&value.mode=="connect"){mode="connect";
var vc=this.$getVisualConnect();vc.setMode("draw");vc.activate(value.event,value.timeout);
if(!vcinited){this.$getVisualConnect().onchangemode=function(e){if(e.mode!=mode){if(e.mode=="element"){mode="connect-element";
}else{if(e.mode=="all"){mode="connect-all";}else{if(e.mode=="draw"){mode="connect";
}else{if(e.mode=="draw-started"){mode="connecting";}}}}}};}}else{if(value&&value.mode=="connect-element"){mode=value.mode;
var vc=this.$getVisualConnect();vc.setMode("element");vc.activate(value.event,value.timeout);
}else{if(value&&value.mode=="connect-all"){mode=value.mode;var vc=this.$getVisualConnect();
vc.setMode("all");vc.activate(value.event,value.timeout);}else{if(value&&value.mode=="add"){mode="add";
var e=value.ev;var pos=apf.getAbsolutePosition(e.indicator);(value.dragserver||apf.DragServer).stop(null,true);
addType=value.value;var opt={userInteraction:true,ignorePos:true,parentNode:value.parent||apf.document.body,skinset:apf.getInheritedAttribute(value.parent||apf.document.body,"skinset")};
commands.begin.call(this);commands.add.call(this,null,null,opt);var amlNode=opt.addedNode;
amlNode.$adding=true;if(value.parent){var ppos=apf.getAbsolutePosition(value.parent.$int);
pos[0]-=ppos[0];pos[1]-=ppos[1];}amlNode.$ext.style.left=(amlNode.left=pos[0])+"px";
amlNode.$ext.style.top=(amlNode.top=pos[1])+"px";amlNode.$ext.style.position="absolute";
amlNode.dragOutline=false;amlNode.$dragStart({reappend:true,clientX:e.htmlEvent.clientX,clientY:e.htmlEvent.clientY},true,true);
addType=null;}else{mode=value.mode||value;this.$getSelectRect().deactivate();this.$getVisualConnect().deactivate();
}}}}}};commands.select=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}var htmlNode=options.htmlNode,parentNode=options.parentNode;
if(!parentNode){parentNode=(apf.document.$getVisualSelect().getLastSelection()[0]||apf.document.documentElement);
if(parentNode.getPage){parentNode=parentNode.getPage();}else{while(parentNode&&!parentNode.canHaveChildren){parentNode=parentNode.parentNode;
}}options.parentNode=parentNode;}var nodes=apf.document.getElementsByTagName("*");
var htmlParent=htmlNode.parentNode;var left=apf.getHtmlLeft(htmlNode);var top=apf.getHtmlTop(htmlNode);
var right=left+htmlNode.offsetWidth;var bottom=top+htmlNode.offsetHeight;var first=true,ext,selList=[];
var refParent;for(var i=0;i<nodes.length;i++){if(!(ext=nodes[i].$ext)){continue;
}var pos=apf.getAbsolutePosition(ext,htmlParent);if(pos[0]>left&&pos[0]+ext.offsetWidth<right&&pos[1]>top&&pos[1]+ext.offsetHeight<bottom){if(!refParent){refParent=nodes[i].parentNode;
}else{if(refParent!=nodes[i].parentNode){continue;}}selList.push(nodes[i]);first=false;
}}if(selList.length){apf.document.getSelection().$selectList(selList);}};commands.remove=function(sel,showUI,value,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}var pNode=sel[0].parentNode;
sel.each(function(sel){sel.removeNode();});var s=pNode.ownerDocument.getSelection();
s.$selectList([apf.document.activeElement&&apf.document.activeElement.editable?apf.document.activeElement:(pNode.editable?pNode:pNode.firstChild)]);
};commands.each=function(sel,showUI,func,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}sel.each(func);
};commands.undo=function(sel,showUI,value,query){var um=apf.window.undoManager;
switch(query){case STATE:return um.undolength;case VALUE:return String(um.undolength);
case ENABL:return um.undolength>0;case INDET:return false;}um.undo(parseInt(value)||null);
};commands.redo=function(sel,showUI,value,query){var um=apf.window.undoManager;
switch(query){case STATE:return um.redolength;case VALUE:return String(um.redolength);
case ENABL:return um.redolength>0;case INDET:return false;}um.redo(parseInt(value)||null);
};commands.cut=function(sel,showUI,value,query){switch(query){case STATE:return apf.clipboard.store?true:false;
case VALUE:return apf.clipboard.store;case ENABL:return true;case INDET:return false;
}commands.copy.call(this,sel,showUI);commands.remove.call(this,sel,showUI);};commands.copy=function(sel,showUI,value,query){switch(query){case STATE:return apf.clipboard.store?true:false;
case VALUE:return apf.clipboard.store;case ENABL:return true;case INDET:return false;
}var nodes=[];sel.each(function(item){nodes.push(item.cloneNode(true));});apf.clipboard.put(nodes);
};commands.paste=function(sel,showUI,value,query){switch(query){case STATE:return apf.clipboard.store?true:false;
case VALUE:return apf.clipboard.store;case ENABL:return true;case INDET:return false;
}var content=apf.clipboard.get();if(!content){return;}var pNode=sel.length>1?sel[0].parentNode:sel[0];
if(typeof content=="string"){sel.insertMarkup(content);}else{if(content.dataType==apf.ARRAY){if(pNode.localName=="table"){command.resetgeo.call(this,sel,showUI);
}var docsel=this.getSelection();docsel.removeAllRanges();var _self=this;content.each(function(item){docsel.addRange(new apf.AmlRange(_self)).selectNode(pNode.appendChild(item.cloneNode(true)));
});}else{if(content.$regbase){sel.appendChild(content.cloneNode(true));}else{alert("Could not paste content");
}}}apf.layout.processQueue();};commands.duplicate=function(sel,showUI,value,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}var docsel=this.getSelection();
docsel.removeAllRanges();sel.each(function(item){docsel.addRange(new apf.AmlRange(item)).selectNode(item.parentNode.appendChild(apf.getCleanCopy(item)));
});apf.layout.processQueue();};commands.resetgeo=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}if(!sel.length){return;
}var props=["left","top","right","bottom","anchors"];if("vbox|hbox|table".indexOf(sel[0].parentNode.localName)==-1){props.push("align");
}if(!options||!options.keepwidth){props.push("width");}if(!options||!options.keepheight){props.push("height");
}sel.each(function(sel){props.each(function(item){if(sel[item]){sel.setAttribute(item,"");
}});sel.$ext.style.position="";});sel[0].ownerDocument.$getVisualSelect().updateGeo();
};commands.property=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}sel.each(function(sel){sel.setAttribute(options.name,options.value);
});sel[0].ownerDocument.$getVisualSelect().updateGeo();};commands.back=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}sel.each(function(sel){if(sel.zindex!=0){sel.setAttribute("zindex",0);
}});};commands.backward=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}sel.each(function(sel){if(sel.zindex!=0){sel.setAttribute("zindex",(sel.zindex||1)-1);
}});};commands.front=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}sel.each(function(sel){if(sel.zindex!=100000){sel.setAttribute("zindex",100000);
}});};commands.forward=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}sel.each(function(sel){if(sel.zindex!=100000){sel.setAttribute("zindex",(sel.zindex||0)+1);
}});};commands.align=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}apf.ContentEditable.execCommand("property",{name:"align",value:options.to});
if("left|middle|right".indexOf(options.to)>-1){apf.ContentEditable.execCommand("property",{name:"height",value:""});
}if("top|middle|bottom".indexOf(options.to)>-1){apf.ContentEditable.execCommand("property",{name:"width",value:""});
}sel[0].ownerDocument.$getVisualSelect().updateGeo();};var sortFn={hbox:function(a,b){return(a.$ext.offsetLeft-b.$ext.offsetLeft);
},vbox:function(a,b){return(a.$ext.offsetTop-b.$ext.offsetTop);},table:function(a,b){var dH=a.$ext.offsetTop-b.$ext.offsetTop;
if(Math.abs(dH)/b.$ext.offsetHeight<0.9){return(a.$ext.offsetLeft-b.$ext.offsetLeft);
}return dH;}};commands.surround=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}var pNode=sel[0].parentNode;
var pos=[100000,100000,0,0];for(var i=0;i<sel.length;i++){var oEl=sel[i].$ext;var opos=apf.getAbsolutePosition(oEl,pNode.$int);
if(opos[0]<pos[0]){pos[0]=opos[0];}if(opos[1]<pos[1]){pos[1]=opos[1];}if(opos[0]+oEl.offsetWidth>pos[2]){pos[2]=opos[0]+oEl.offsetWidth;
}if(opos[1]+oEl.offsetHeight>pos[3]){pos[3]=opos[1]+oEl.offsetHeight;}}pos[2]-=pos[0];
pos[3]-=pos[1];addType=options.to;sel.sort(sortFn[addType]);var isInLayout="vbox|hbox|table".indexOf(pNode.localName)>-1;
commands.resetgeo.call(this,sel,false,{keepwidth:!isInLayout&&options.to=="hbox",keepheight:!isInLayout&&options.to=="vbox"});
var opt={parentNode:pNode,beforeNode:sel[0],ignorePos:true,left:pos[0],top:pos[1]};
if(pNode.localName!="table"){if(pNode.localName!="vbox"){opt.width=pos[2];}if(pNode.localName!="hbox"){opt.height=pos[3];
}}commands.add.call(this,null,false,opt);if(isInLayout&&options.to!="table"){sel.each(function(sel){if(isInLayout){if(options.to=="hbox"&&pNode.localName=="vbox"){sel.setAttribute("width",sel.height);
}if(options.to=="vbox"&&pNode.localName=="hbox"){sel.setAttribute("height",sel.width);
}}});}sel.each(function(sel){opt.addedNode.appendChild(sel);});this.getSelection().$selectList([opt.addedNode]);
apf.layout.processQueue();};commands.convert=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}};commands.lock=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}};commands.unlock=function(sel,showUI,options,query){switch(query){case STATE:return false;
case VALUE:return"false";case ENABL:return true;case INDET:return false;}};commands.begin=function(sel,showUI,bClear){apf.window.undoManager.begin(this.documentElement,bClear);
};commands.rollback=function(){apf.window.undoManager.rollback(this.documentElement);
};commands.commit=function(){apf.window.undoManager.commit(this.documentElement);
};commands.pause=function(sel,showUI,bContinue){apf.window.undoManager.pause(this.documentElement,bContinue);
};apf.AmlDocument.prototype.$commands=apf.extend(apf.AmlDocument.prototype.$commands,commands);
})();(function(){function isCoord(n){return n||n===0;}function coord(n,other){return n||n===0?n:other;
}var dragIndicator1,dragIndicator2,dragIndicator3,dragIndicator4,dragIndicator5,inited=false,indicators=[],outline,dragOutline;
function init(){var div,classes=[null,"dragindicate","dragindicate indicate_common indicate_horizontal","dragindicate indicate_common","dragindicate indicate_common indicate_horizontal","dragindicate dragreparent","dragindicate dragelsort","dragindicate dragelsort"];
for(var i=1;i<8;i++){div=document.body.appendChild(document.createElement("div"));
div.style.position="absolute";div.className=classes[i];div.style.zIndex=1000000;
div.style.display="none";div.host=false;eval("dragIndicator"+i+" = indicators["+(i-1)+"] = div;");
}outline=dragOutline=document.getElementById("apf_outline");inited=true;}var lastReparent,movePosition;
function doReparentDrag(el,amlNode,e){if(lastReparent==amlNode){return;}var htmlNode=el.dragOutline?outline:el.$ext;
var pHtmlNode=amlNode.$int;var isBody=pHtmlNode.tagName=="BODY";var pos1=isBody?[0,0]:apf.getAbsolutePosition(pHtmlNode);
pos1[2]=isBody?apf.getWindowWidth():pHtmlNode.offsetWidth;pos1[3]=isBody?apf.getWindowHeight():pHtmlNode.offsetHeight;
var lastPHtmlNode=lastReparent?lastReparent.$int:el.$ext.parentNode;var pos2=lastPHtmlNode.tagName=="BODY"?[0,0]:apf.getAbsolutePosition(lastPHtmlNode,null,true);
amlNode.$int.appendChild(htmlNode);hideIndicators();dragIndicator5.style.left=pos1[0]+"px";
dragIndicator5.style.top=pos1[1]+"px";var diff=apf.getDiff(dragIndicator5);dragIndicator5.style.width=(pos1[2]-diff[0])+"px";
dragIndicator5.style.height=(pos1[3]-diff[1])+"px";dragIndicator5.style.display="block";
apf.tween.single(dragIndicator5,{type:"fade",from:0,to:1,anim:apf.tween.easeInSine,steps:5});
htmlNode.style.left=(apf.getHtmlLeft(htmlNode)-(pos1[0]-pos2[0]))+"px";htmlNode.style.top=(apf.getHtmlTop(htmlNode)-(pos1[1]-pos2[1]))+"px";
lastReparent=amlNode;el.$dragStart(e,true);}var lastAmlNode;var showDrag={vbox:function(l,t,htmlNode,e){if(e){var prevTop=htmlNode.style.top;
var el=this,plane=apf.plane.get();plane.plane.style.top=htmlNode.style.top="-2000px";
var amlNode=apf.findHost(document.elementFromPoint(e.clientX,e.clientY));plane.plane.style.top=0;
htmlNode.style.top=prevTop;if(amlNode&&amlNode!=el&&(amlNode.parentNode==(lastReparent||el.parentNode))){var ext1=amlNode.$altExt||amlNode.$ext;
var ext2=el.$altExt||el.$ext;var h=ext1.offsetHeight;var pos=apf.getAbsolutePosition(ext1);
if(pos[1]+(h/2)>e.clientY){if(ext1.previousSibling!=ext2){dragIndicator1.style.display="block";
dragIndicator1.style.top=(pos[1]-dragIndicator1.offsetHeight)+"px";dragIndicator1.style.left=(pos[0])+"px";
dragIndicator1.style.width=(ext1.offsetWidth-apf.getWidthDiff(dragIndicator1))+"px";
dragIndicator1.style.height=amlNode.parentNode.padding+"px";movePosition={where:"before",amlNode:amlNode};
}else{dragIndicator1.style.display="none";movePosition=null;}}else{if(ext1.nextSibling!=ext2){dragIndicator1.style.display="block";
dragIndicator1.style.top=(pos[1]+h)+"px";dragIndicator1.style.left=(pos[0])+"px";
dragIndicator1.style.width=(ext1.offsetWidth-apf.getWidthDiff(dragIndicator1))+"px";
dragIndicator1.style.height=amlNode.parentNode.padding+"px";movePosition={where:"after",amlNode:amlNode};
}else{dragIndicator1.style.display="none";movePosition=null;}}}else{dragIndicator1.style.display="none";
}}},hbox:function(l,t,htmlNode,e){if(e){var prevTop=htmlNode.style.top;var el=this,plane=apf.plane.get();
plane.plane.style.top=htmlNode.style.top="-2000px";var amlNode=apf.findHost(document.elementFromPoint(e.clientX,e.clientY));
plane.plane.style.top=0;htmlNode.style.top=prevTop;showDrag.reparent.call(this,amlNode,el,e);
if(amlNode&&amlNode!=el&&(amlNode.parentNode==(lastReparent||el.parentNode))){var ext1=amlNode.$altExt||amlNode.$ext;
var ext2=el.$altExt||el.$ext;var h=ext1.offsetWidth;var pos=apf.getAbsolutePosition(ext1);
if(pos[0]+(h/2)>e.clientX){if(ext1.previousSibling!=ext2){dragIndicator1.style.display="block";
dragIndicator1.style.top=(pos[1])+"px";dragIndicator1.style.left=(pos[0]-dragIndicator1.offsetWidth)+"px";
dragIndicator1.style.width=amlNode.parentNode.padding+"px";dragIndicator1.style.height=(ext1.offsetHeight-apf.getHeightDiff(dragIndicator1))+"px";
movePosition={where:"before",amlNode:amlNode};}else{dragIndicator1.style.display="none";
movePosition=null;}}else{if(ext1.nextSibling!=ext2){dragIndicator1.style.display="block";
dragIndicator1.style.top=(pos[1])+"px";dragIndicator1.style.left=(pos[0]+h)+"px";
dragIndicator1.style.width=amlNode.parentNode.padding+"px";dragIndicator1.style.height=(ext1.offsetHeight-apf.getHeightDiff(dragIndicator1))+"px";
movePosition={where:"after",amlNode:amlNode};}else{dragIndicator1.style.display="none";
movePosition=null;}}}else{dragIndicator1.style.display="none";movePosition=null;
}}},table:function(l,t,htmlNode,e){if(e){var prevTop=htmlNode.style.top,plane=apf.plane.get();
var el=this;dragIndicator1.style.top=plane.plane.style.top=htmlNode.style.top="-2000px";
var amlNode=apf.findHost(document.elementFromPoint(e.clientX,e.clientY));plane.plane.style.top=0;
htmlNode.style.top=prevTop;showDrag.reparent.call(this,amlNode,el,e);if(amlNode&&amlNode!=el&&(amlNode.parentNode==(lastReparent||el.parentNode))){var ext1=amlNode.$altExt||amlNode.$ext;
var ext2=el.$altExt||el.$ext;var pos=apf.getAbsolutePosition(ext1);if(ext1.previousSibling!=ext2){dragIndicator1.style.display="block";
dragIndicator1.style.top=pos[1]+"px";dragIndicator1.style.left=pos[0]+"px";dragIndicator1.style.width=(amlNode.$ext.offsetWidth-apf.getWidthDiff(dragIndicator1))+"px";
dragIndicator1.style.height=(amlNode.$ext.offsetHeight-apf.getHeightDiff(dragIndicator1))+"px";
movePosition={where:"before",amlNode:amlNode};}else{dragIndicator1.style.display="none";
movePosition=null;}}else{dragIndicator1.style.display="none";}}},reparent:function(amlNode,el,e){var htmlNode=el.dragOutline?outline:el.$ext;
while(amlNode&&!amlNode.$int){amlNode=amlNode.parentNode;}if(!amlNode.editable){return;
}if(lastAmlNode&&lastAmlNode[0]==amlNode&&Math.abs(e.clientX-lastAmlNode[2])<2&&Math.abs(e.clientY-lastAmlNode[3])<2){}else{if(lastAmlNode){clearTimeout(lastAmlNode[4]);
}var plane=apf.plane.get();if(el&&amlNode!=el&&amlNode.$int&&htmlNode.parentNode!=amlNode.$int&&(htmlNode.parentNode!=plane.plane||amlNode.$int!=document.body)&&!apf.isChildOf(el.$ext,amlNode.$int,true)){var ev={clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey};
lastAmlNode=[amlNode,new Date().getTime(),e.clientX,e.clientY,setTimeout(function(){doReparentDrag(el,amlNode,ev);
},300)];}else{lastAmlNode=[];}}},common:function(l,t,htmlNode,e,change,snapDiff){var oOutline=this.$ext;
var prevTop=htmlNode.style.top;var el=this,plane=apf.plane.get();dragIndicator1.style.top=plane.plane.style.top=htmlNode.style.top="-2000px";
var amlNode=apf.findHost(document.elementFromPoint(e.clientX,e.clientY));plane.plane.style.top=0;
htmlNode.style.top=prevTop;showDrag.reparent.call(this,amlNode,el,e);var d=dragInfo;
showDrag.common_resize.call(this,l,t,d.width,d.height,e,change,true,true,true,true,true);
apf.config.setProperty("x",change.l||(change.l===0?0:apf.getHtmlLeft(oOutline)));
apf.config.setProperty("y",change.t||(change.t===0?0:apf.getHtmlTop(oOutline)));
apf.config.setProperty("w",d.width);apf.config.setProperty("h",d.height);},common_resize:function(l,t,w,h,e,change,we,no,ea,so,isDrag,sd){var snapDiff=sd||8;
var lpos=false,tpos=false,loffset=0,toffset=0;var wpos=false,hpos=false;var force,d=dragInfo;
if(e.ctrlKey){hideIndicators(null,true);return;}if(isDrag&&e.shiftKey){var dt=d.top-t;
var dl=d.left-l;var corner=(Math.atan(Math.abs(dt)/Math.abs(dl))*2)/Math.PI;if(corner<1/3){change.st=t=d.top;
}else{if(corner<2/3){if(l>d.left&&t<d.top||l<d.left&&t>d.top){var min=Math.min(Math.abs(dl),Math.abs(dt));
change.l=d.left+(dl<0?1:-1)*min;change.t=d.top+(dt<0?1:-1)*min;}else{var min=Math.min(Math.abs(dl),Math.abs(dt));
change.l=d.left+(dl<0?1:-1)*min;change.t=d.top+(dt<0?1:-1)*min;}dragIndicator1.style.display="none";
dragIndicator2.style.display="none";return;}else{change.sl=l=d.left;}}force=true;
}if(apf.config.snapcontainer){var c=d.container;if(Math.abs(l)<snapDiff){change.l=0;
change.lsticky=5;}if(Math.abs(c[2]-l-w)<snapDiff){if(change.l==undefined){change.l=c[2]-w;
}change.rsticky=5;}if(Math.abs(t)<snapDiff){change.t=0;change.tsticky=5;}if(Math.abs(c[3]-t-h)<snapDiff){if(change.t==undefined){change.t=c[3]-h;
}change.bsticky=5;}if(!isDrag){if(Math.abs(c[2]-w-l)<(ea?snapDiff:1)){change.w=c[2]-l;
change.rsticky=5;}if(Math.abs(c[3]-h-t)<(so?snapDiff:1)){change.h=c[3]-t;change.bsticky=5;
}}}if(d.xl.length&&(typeof change.l=="undefined"||force)){for(var i=0,il=d.xl.length;
i<il;i++){if(Math.abs(d.xl[i]-l)<(we?snapDiff:1)){change.l=lpos=d.xl[i];change.loffset=loffset=-2;
change.lsticky=i==0;break;}}if(lpos===false){for(var i=0,il=d.xr.length;i<il;i++){if(Math.abs(d.xr[i]-l-w)<(ea?snapDiff:1)){change.l=(lpos=d.xr[i])-w;
change.loffset=loffset=0;change.rsticky=i==0;break;}}}if(lpos===false&&isDrag){for(var i=0,il=d.xm.length;
i<il;i++){if(Math.abs(d.xm[i]-l-d.cwidth)<snapDiff){change.l=(lpos=d.xm[i])-d.cwidth;
break;}}}}if(d.xr.length&&(typeof change.w=="undefined")&&change.rsticky!=5){for(var i=0,il=d.xr.length;
i<il;i++){if(Math.abs(d.xr[i]-w-(!isDrag&&ea||isDrag?change.l||l:l))<(!ea||isDrag&&typeof change.l!="undefined"?1:snapDiff)){if(!isDrag){change.w=(wpos=d.xr[i])-l;
}else{wpos=d.xr[i];}change.rsticky=i==0;break;}}}if(d.yl.length&&(typeof change.t=="undefined"||force)){for(var i=0,il=d.yl.length;
i<il;i++){if(Math.abs(d.yl[i]-t)<(no?snapDiff:1)){change.t=tpos=d.yl[i];change.toffset=toffset=-2;
change.tsticky=i==0;break;}}if(tpos===false){for(var i=0,il=d.yr.length;i<il;i++){if(Math.abs(d.yr[i]-t-h)<(so?snapDiff:1)){change.t=(tpos=d.yr[i])-h;
change.toffset=toffset=0;change.bsticky=i==0;break;}}}if(tpos===false&&isDrag){for(var i=0,il=d.ym.length;
i<il;i++){if(Math.abs(d.ym[i]-t-d.cheight)<snapDiff){change.t=(tpos=d.ym[i])-d.cheight;
change.toffset=toffset=-1;break;}}}}if(d.yr.length&&(typeof change.h=="undefined")&&change.bsticky!=5){for(var i=0,il=d.yr.length;
i<il;i++){if(Math.abs(d.yr[i]-h-(!isDrag&&so||isDrag?change.t||t:t))<(!so||isDrag&&typeof change.t!="undefined"?1:snapDiff)){if(!isDrag){change.h=(hpos=d.yr[i])-t;
}else{hpos=d.yr[i];}change.bsticky=i==0;break;}}}var oppDiff=5,oloffset,olpos=false,tdiff;
if(d.xl.length&&change.l!==0){if(!change.lsticky){for(var i=0,il=d.xr.length;i<il;
i++){tdiff=(Math.max(0,(change.l||l)-d.xr[i])||10000)-oppDiff;if((sd?Math.abs(tdiff):tdiff)<(we?snapDiff:1)){change.ol=(olpos=d.xr[i])+oppDiff;
change.olpos=olpos+oppDiff;change.olEl=d.els[i];change.oloffset=oloffset=0;break;
}}}if(!change.rsticky){for(var i=0,il=d.xl.length;i<il;i++){tdiff=(Math.max(0,d.xl[i]-(change.l||l)-w)||10000)-oppDiff;
if((sd?Math.abs(tdiff):tdiff)<(ea?snapDiff:1)){change.or=(olpos=d.xl[i]-oppDiff)-w;
change.orpos=d.container[2]-olpos;change.orEl=d.els[i];change.oloffset=oloffset=0;
break;}}}}var otoffset,otpos=false;if(d.yl.length&&change.t!==0){if(!change.tsticky){for(var i=0,il=d.yr.length;
i<il;i++){tdiff=Math.abs((Math.max(0,(change.t||t)-d.yr[i])||10000)-oppDiff);if((sd?Math.abs(tdiff):tdiff)<(no?snapDiff:1)){change.ot=(otpos=d.yr[i])+oppDiff;
change.otpos=otpos+oppDiff;change.otEl=d.els[i];change.otoffset=otoffset=0;break;
}}}if(!change.bsticky){for(var i=0,il=d.yl.length;i<il;i++){tdiff=Math.abs((Math.max(0,d.yl[i]-(change.t||t)-h)||10000)-oppDiff);
if((sd?Math.abs(tdiff):tdiff)<(so?snapDiff:1)){change.ob=(otpos=d.yl[i]-oppDiff)-h;
change.obpos=d.container[3]-otpos;change.obEl=d.els[i];change.otoffset=otoffset=0;
break;}}}}if(apf.config.snapgrid){var r,gs=apf.config.gridsize;if(tpos===false){change.t=t-(r=t%gs)+(r/gs>0.5?gs:0);
}if(lpos===false){change.l=l-(r=l%gs)+(r/gs>0.5?gs:0);}if(!we&&hpos===false){change.w=w-(r=w%gs)+(r/gs>0.5?gs:0);
}if(!no&&wpos===false){change.h=h-(r=h%gs)+(r/gs>0.5?gs:0);}}if(lpos!==false&&(olpos===false||change.or)){dragIndicator1.style.left=(lpos+loffset+d.container[0])+"px";
dragIndicator1.style.top=d.container[1]+"px";dragIndicator1.style.height=(d.container[3])+"px";
dragIndicator1.style.display="block";dragIndicator1.style.borderWidth="0 0 0 2px";
}else{dragIndicator1.style.display="none";}if(tpos!==false&&(otpos===false||change.ob)){dragIndicator2.style.left=(d.container[0])+"px";
dragIndicator2.style.top=(tpos+toffset+d.container[1])+"px";dragIndicator2.style.width=(d.container[2])+"px";
dragIndicator2.style.display="block";dragIndicator2.style.borderWidth="2px 0 0";
}else{dragIndicator2.style.display="none";}if(wpos!==false){dragIndicator3.style.left=(wpos+d.container[0])+"px";
dragIndicator3.style.top=d.container[1]+"px";dragIndicator3.style.height=(d.container[3])+"px";
dragIndicator3.style.display="block";dragIndicator3.style.borderWidth="0 0 0 2px";
}else{dragIndicator3.style.display="none";}if(hpos!==false){dragIndicator4.style.left=(d.container[0])+"px";
dragIndicator4.style.top=(hpos+d.container[1])+"px";dragIndicator4.style.width=(d.container[2])+"px";
dragIndicator4.style.display="block";dragIndicator4.style.borderWidth="2px 0 0";
}else{dragIndicator4.style.display="none";}if(olpos!==false){dragIndicator6.style.left=(olpos+oloffset+d.container[0])+"px";
dragIndicator6.style.top=d.container[1]+"px";dragIndicator6.style.height=(d.container[3])+"px";
dragIndicator6.style.display="block";dragIndicator6.style.borderWidth="0 0 0 "+oppDiff+"px";
}else{dragIndicator6.style.display="none";}if(otpos!==false){dragIndicator7.style.left=(d.container[0])+"px";
dragIndicator7.style.top=(otpos+otoffset+d.container[1])+"px";dragIndicator7.style.width=(d.container[2])+"px";
dragIndicator7.style.display="block";dragIndicator7.style.borderWidth=oppDiff+"px 0 0";
}else{dragIndicator7.style.display="none";}if(!isDrag){if(!we){change.l=l;}if(!no){change.t=t;
}if(we){if(change.ol!=undefined){change.w=d.width+(d.left-change.ol);change.l=change.ol;
}else{if(change.l!=undefined){change.w=d.width+(d.left-change.l);}}}else{if(ea&&change.or!=undefined){change.w=olpos-d.left;
}}if(no){if(change.ot!=undefined){change.h=d.height+(d.top-change.ot);change.t=change.ot;
}else{if(change.t!=undefined){change.h=d.height+(d.top-change.t);}}}else{if(so&&change.ob!=undefined){change.h=otpos-d.top;
}}}else{if(olpos!=false){change.l=change.ol||change.or;}if(otpos!=false){change.t=change.ot||change.ob;
}}if(isDrag&&e.shiftKey){if(change.sl){change.l=change.sl;}if(change.st){change.t=change.st;
}}}};var dragInfo;function setDragInfo(el,pEl,isDrag){apf.setStyleClass(dragIndicator1,"indicate_common",["indicate_vbox","indicate_hbox","indicate_table","indicate_common"]);
if(pEl.localName=="html"){pEl=pEl.ownerDocument.body;}var container=pEl.$int;var isBody=pEl.$int.tagName=="BODY";
var htmlEl=isDrag&&el.dragOutline?outline:el.$ext;var d=dragInfo={left:apf.getHtmlLeft(htmlEl),top:apf.getHtmlTop(htmlEl),width:htmlEl.offsetWidth,height:htmlEl.offsetHeight};
d.cwidth=Math.round(d.width/2);d.cheight=Math.round(d.height/2);d.container=isBody?[0,0]:apf.getAbsolutePosition(container,null,true);
if(isBody){var m=apf.getMargin(container);}d.container.push((isBody?apf.getWindowWidth():apf.getHtmlInnerWidth(container)),(isBody?apf.getWindowHeight():apf.getHtmlInnerHeight(container)));
var els=pEl.getElementsByTagName("*",true);var xl=d.xl=[],yl=d.yl=[],curel;var xm=d.xm=[],ym=d.ym=[];
var xr=d.xr=[],yr=d.yr=[],dels=d.els=[];if(apf.config.snapcontainer){xl.push(10);
xr.push(d.container[2]-10);yl.push(10);yr.push(d.container[3]-10);dels.push(d.container);
}if(apf.config.snapelement){var selected=apf.document.$getVisualSelect().getLastSelection();
var q=apf.getBorderOffset(container);var bLeft=q[0];var bTop=q[1];for(var l,t,h,w,i=0,il=els.length;
i<il;i++){if(selected.indexOf(curel=els[i])>-1||!curel.$ext){continue;}l=curel.$ext.offsetLeft-bLeft;
xl.push(l);xm.push(l+Math.round((w=curel.$ext.offsetWidth)/2));xr.push(l+w);t=curel.$ext.offsetTop-bTop;
yl.push(t);ym.push(t+Math.round((h=curel.$ext.offsetHeight)/2));yr.push(t+h);dels.push(curel);
}}}function setStickyEdges(el,extra){var s=el.$stick,d=dragInfo,t=el.$stuck||(el.$stuck=[false,false,false,false]);
var setOpp=false;if(!apf.config.snapcontainer){return;}if(isCoord(s.orpos)&&!s.orEl.left){if(!t[1]&&!isCoord(el.right)){t[1]=true;
}el.setAttribute("right",s.orpos);setOpp=true;}else{if(isCoord(s.w)&&s.rsticky){if(!isCoord(el.right)){el.setAttribute("right",d.container[2]-coord(s.l,d.left)-s.w);
t[1]=true;}setOpp=true;}}if(isCoord(s.l)){if(isCoord(s.olpos)&&!s.olEl.right){el.setAttribute("left",s.olpos);
t[3]=true;}else{if(s.lsticky&&!isCoord(el.left)){el.setAttribute("left",s.l);t[3]=true;
}}if(!setOpp){if(s.rsticky){if(!t[1]&&!isCoord(el.right)){t[1]=true;}el.setAttribute("right",d.container[2]-s.l-coord(s.w,d.width));
setOpp=true;}else{if(t[1]&&isCoord(el.right)&&(isCoord(s.l)||s.lsticky)){if(!isCoord(el.left)){el.setAttribute("left",s.l);
t[3]=true;}el.removeAttribute("right");el.setAttribute("width",extra&&extra.w||el.$ext.offsetWidth);
t[1]=false;}}}}if(t[1]&&isCoord(el.left)&&(setOpp||isCoord(el.right))&&!(s.rsticky||(isCoord(s.orpos)&&!s.orEl.left))){el.removeAttribute("right");
el.setAttribute("width",extra&&extra.w||el.$ext.offsetWidth);t[1]=false;}else{if(t[3]&&isCoord(el.left)&&(setOpp||isCoord(el.right))&&!(s.lsticky||(isCoord(s.olpos)&&!s.olEl.right))){el.removeAttribute("left");
el.setAttribute("width",extra&&extra.w||el.$ext.offsetWidth);t[3]=false;}else{if(t[1]&&(setOpp||isCoord(el.right))&&!(s.rsticky||(isCoord(s.orpos)&&!s.orEl.left))){el.setAttribute("left",extra&&extra.l||el.$ext.offsetLeft);
t[3]=true;el.removeAttribute("right");el.setAttribute("width",extra&&extra.w||el.$ext.offsetWidth);
t[1]=false;}}}var setOpp=false;if(isCoord(s.obpos)&&!s.obEl.top){if(!t[2]&&!isCoord(el.bottom)){t[2]=true;
}el.setAttribute("bottom",s.obpos);setOpp=true;}else{if(isCoord(s.h)&&s.bsticky){if(!isCoord(el.bottom)){el.setAttribute("bottom",d.container[3]-coord(s.t,d.top)-s.h);
t[2]=true;}setOpp=true;}}if(isCoord(s.t)){if(isCoord(s.otpos)&&!s.otEl.bottom){el.setAttribute("top",s.otpos);
t[0]=true;}else{if(s.tsticky&&!isCoord(el.top)){el.setAttribute("top",s.t);t[0]=true;
}}if(!setOpp){if(s.bsticky){if(!t[2]&&!isCoord(el.bottom)){t[2]=true;}el.setAttribute("bottom",d.container[3]-s.t-coord(s.h,d.height));
setOpp=true;}else{if(t[2]&&isCoord(el.bottom)&&(isCoord(s.t)||s.tsticky)){if(!isCoord(el.top)){el.setAttribute("top",s.t);
t[0]=true;}el.removeAttribute("bottom");el.setAttribute("height",extra&&extra.h||el.$ext.offsetHeight);
t[2]=false;}}}}if(t[2]&&isCoord(el.top)&&(setOpp||isCoord(el.bottom))&&!(s.bsticky||(isCoord(s.obpos)&&!s.obEl.top))){el.removeAttribute("bottom");
el.setAttribute("height",extra&&extra.h||el.$ext.offsetHeight);t[2]=false;}else{if(t[0]&&isCoord(el.top)&&(setOpp||isCoord(el.bottom))&&!(s.tsticky||(isCoord(s.otpos)&&!s.otEl.bottom))){el.removeAttribute("top");
el.setAttribute("height",extra&&extra.h||el.$ext.offsetHeight);t[0]=false;}else{if(t[2]&&(setOpp||isCoord(el.bottom))&&!(s.bsticky||(isCoord(s.obpos)&&!s.obEl.top))){el.setAttribute("top",extra&&extra.t||el.$ext.offsetTop);
t[0]=true;el.removeAttribute("bottom");el.setAttribute("height",extra&&extra.h||el.$ext.offsetHeight);
t[2]=false;}}}}var control={stop:apf.K};function hideIndicators(animate,exclude5){if(!dragIndicator1){return;
}if(animate){control={};var tweens=[];for(var i=0;i<indicators.length;i++){if(indicators[i].style.display=="block"){tweens.push({oHtml:indicators[i],type:"fade",from:1,to:0});
}}function done(){for(var i=0;i<tweens.length;i++){tweens[i].oHtml.style.filter="";
tweens[i].oHtml.style.display="none";}}apf.tween.multi(dragIndicator1,{anim:apf.tween.easeInQuad,tweens:tweens,steps:20,control:control,onfinish:done,onstop:done});
}else{dragIndicator1.style.display="none";dragIndicator2.style.display="none";dragIndicator3.style.display="none";
dragIndicator4.style.display="none";if(!exclude5){dragIndicator5.style.display="none";
}dragIndicator6.style.display="none";dragIndicator7.style.display="none";}}var lastPos;
function beforedragstart(e){var selection=apf.document.$getVisualSelect().getLastSelection();
outline=selection.length>1&&!e.htmlEvent.ctrlKey?apf.document.$getVisualSelect().$getOutline():dragOutline;
this.$setOutline(outline);}function beforedrag(e,reparent,add){var name,pEl;var selection=apf.document.$getVisualSelect().getLastSelection();
if((this.$multidrag=selection.length>1)&&selection.indexOf(this)==-1){return false;
}if(outline!=(selection.length>1?apf.document.$getVisualSelect().$getOutline():dragOutline)){return false;
}control.stop();if(lastReparent&&!add){pEl=lastReparent;name=pEl.localName;}else{if(!e){e=event;
}name=(pEl=this.parentNode).localName;}if(!lastPos){lastPos=apf.getAbsolutePosition(outline,pEl.localName=="table"?pEl.$ext:outline.offsetParent);
}if("vbox|hbox|table".indexOf(name)>-1){this.realtime=true;apf.setStyleClass(dragIndicator1,"indicate_"+name,["indicate_vbox","indicate_hbox","indicate_table","indicate_common"]);
dragIndicator1.style.borderWidth="";this.$showDrag=showDrag[pEl.localName];}else{if(pEl.editable||add||this.$adding){this.realtime=true;
setDragInfo(this,pEl,true);this.$showDrag=showDrag.common;}else{this.realtime=false;
}}this.ownerDocument.execCommand("begin");}function afterdrag(e){if(lastAmlNode){clearTimeout(lastAmlNode[4]);
lastAmlNode=null;}lastReparent=null;var el=this;var htmlNode=el.dragOutline?outline:el.$ext;
delete this.$multidrag;var l,t,w,h,selected,prevParent,pNode;if(el.$adding){selected=[el];
prevParent=pNode=apf.findHost(htmlNode.parentNode);}else{selected=apf.document.$getVisualSelect().getLastSelection();
prevParent=selected[0].parentNode;pNode=apf.findHost(htmlNode.parentNode);}if(selected.length>1&&lastPos&&"vbox|hbox|table".indexOf(pNode.localName)==-1){var deltaX=apf.getHtmlLeft(htmlNode)-lastPos[0];
var deltaY=apf.getHtmlTop(htmlNode)-lastPos[1];var pWidth=outline.parentNode.tagName=="BODY"?apf.getWindowWidth():apf.getHtmlInnerWidth(outline.parentNode);
var pHeight=outline.parentNode.tagName=="BODY"?apf.getWindowHeight():apf.getHtmlInnerHeight(outline.parentNode);
if(deltaX||deltaY||"vbox|hbox|table".indexOf(prevParent.localName)>-1){var isTable=prevParent.localName=="table";
for(var n,i=0;i<selected.length;i++){n=selected[i];var diff=apf.getDiff(n.$ext);
if(isTable){var itemPos=apf.getAbsolutePosition(n.$ext,prevParent.$ext);}n.$updateProperties(l=(isTable?itemPos[0]:apf.getHtmlLeft(n.$ext))+deltaX,t=(isTable?itemPos[1]:apf.getHtmlTop(n.$ext))+deltaY,(w=n.$ext.offsetWidth)-diff[0],(h=n.$ext.offsetHeight)-diff[1],diff[0],diff[1],Math.max(0,pWidth-l-w),Math.max(0,pHeight-t-h));
showDrag.common_resize.call(n,l,t,w,h,{},n.$stick={},true,true,true,true,true,1);
dragInfo.left=l;dragInfo.top=t;dragInfo.width=w;dragInfo.height=h;setStickyEdges(n,{t:t,l:l,h:h,w:w});
delete n.$stick;}}}if(movePosition){if(el.$adding||htmlNode.parentNode!=el.$ext.parentNode){for(var i=0;
i<selected.length;i++){selected[i].$ext.style.left=selected[i].$ext.style.top=selected[i].$ext.style.right=selected[i].$ext.style.width=selected[i].$ext.style.height=selected[i].$ext.style.bottom="";
selected[i].$ext.style.position="static";}}if("vbox|hbox|table".indexOf(pNode.localName)>-1){for(var i=0;
i<selected.length;i++){pNode.insertBefore(selected[i],movePosition.where=="after"?movePosition.amlNode.nextSibling:movePosition.amlNode);
}}movePosition=null;}else{if(el.$adding||htmlNode.parentNode!=el.$ext.parentNode){if(el.$adding){el.removeNode();
el.ownerDocument.execCommand("begin",null,true);}for(var i=0;i<selected.length;
i++){pNode.appendChild(selected[i]);if(!el.$adding){setDefaultStuck(selected[i]);
}}}if(el.$stick){if(selected.length==1){setStickyEdges(el);delete el.$stick;}}}apf.document.getSelection().$selectList(selected);
if(selected.indexOf(apf.document.activeElement)==-1){selected[0].focus();}hideIndicators();
this.ownerDocument.execCommand("commit");apf.layout.processQueue();if(el.$adding){delete el.$adding;
el.dragOutline=true;el.focus();}else{this.ownerDocument.$getVisualSelect().updateGeo();
}lastPos=null;}function beforeresize(e){var type=e.type;var name=this.parentNode.localName;
control.stop();if(name=="vbox"){var pack=this.align||this.parentNode.pack;if(pack!="middle"){var xType=pack=="start"?"n":"s";
type=type.replace(xType,"");type=type.replace("w","");if(!type){return;}}this.realtime=true;
this.$showResize=function(l,t,w,h,e,c,we,no,ea,so){if(h&&(no||so)){this.setProperty("height",h);
}if(w&&(ea||we)){this.setProperty("width",w);}apf.layout.processQueue();};}else{if(name=="hbox"){var pack=this.align||this.parentNode.pack;
if(pack!="middle"){var xType=pack=="start"?"w":"e";type=type.replace(xType,"");
type=type.replace("n","");if(!type){return;}}this.realtime=true;this.$showResize=function(l,t,w,h){this.setProperty("width",w);
if(h){this.setProperty("height",h);}apf.layout.processQueue();};}else{if(this.parentNode.editable&&name!="table"){this.realtime=true;
setDragInfo(this,this.parentNode);this.$showResize=showDrag.common_resize;}else{this.realtime=false;
}}}if("hbox|vbox|table".indexOf(name)==-1&&apf.getStyle(this.$ext,"position")!="absolute"){this.$ext.style.width=(this.$ext.offsetWidth-apf.getWidthDiff(this.$ext))+"px";
this.$ext.style.height=(this.$ext.offsetHeight-apf.getHeightDiff(this.$ext))+"px";
}var m,edge;if(name=="vbox"){this.maxheight=Math.min(this.maxheight||10000,this.parentNode.$ext.offsetHeight-apf.getVerBorders(this.parentNode.$ext)-(this.parentNode.$hasPerc?this.parentNode.$totalPerc*5:0)-this.parentNode.$totalFixed+this.$ext.offsetHeight);
if(this.margin){m=apf.getBox(this.margin);}if(this.parentNode.edge){edge=apf.getBox(this.parentNode.edge);
}this.maxwidth=Math.min(this.maxwidth||10000,this.parentNode.$ext.offsetWidth-apf.getHorBorders(this.parentNode.$ext)-(edge?edge[1]+edge[3]:0)-(m?m[1]+m[3]:0));
}else{if(name=="hbox"){this.maxwidth=Math.min(this.maxwidth||10000,this.parentNode.$ext.offsetWidth-apf.getHorBorders(this.parentNode.$ext)-(this.parentNode.$hasPerc?this.parentNode.$totalPerc*5:0)-this.parentNode.$totalFixed+this.$ext.offsetWidth);
if(this.margin){m=apf.getBox(this.margin);}if(this.parentNode.edge){edge=apf.getBox(this.parentNode.edge);
}this.maxheight=Math.min(this.maxheight||10000,this.parentNode.$ext.offsetHeight-apf.getVerBorders(this.parentNode.$ext)-(edge?edge[0]+edge[2]:0)-(m?m[0]+m[2]:0));
}}e.setType(name=="table"?"s":type);}function afterresize(e){hideIndicators();var name=this.parentNode.localName;
if(name=="hbox"){if(this.maxheight==this.$ext.offsetHeight&&this.height){this.setAttribute("height","");
}}else{if(name=="vbox"){if(this.maxwidth==this.$ext.offsetWidth&&this.width){this.setAttribute("width","");
}}else{if(this.$stick){setStickyEdges(this,e);}}}this.$stick=null;this.ownerDocument.execCommand("commit");
this.ownerDocument.$getVisualSelect().$finishResize();}function cancel(){hideIndicators();
this.ownerDocument.execCommand("rollback");this.ownerDocument.$getVisualSelect().$finishResize();
}function keydown(e){if(!apf.document.$getVisualSelect){return;}var selected=apf.document.$getVisualSelect().getLastSelection();
if(!selected.length){return;}if(apf.document.queryCommandState("rename")){return;
}var name=selected[0].parentNode.localName;if("vbox|hbox|table".indexOf(name)>-1){return;
}var dirX=0,dirY=0;switch(e.keyCode){case 38:dirY=-1;break;case 40:dirY=1;break;
case 39:dirX=1;break;case 37:dirX=-1;break;default:return;}control.stop();var l,t,w,h,n=selected[0],ext,d;
n.ownerDocument.execCommand("begin");for(var i=0,il=selected.length;i<il;i++){n=selected[i];
ext=n.$ext;d=apf.getDiff(ext);n.$updateProperties(l=apf.getHtmlLeft(ext)+(dirX*(e.ctrlKey?10:(e.shiftKey?30:1))),t=apf.getHtmlTop(ext)+(dirY*(e.ctrlKey?10:(e.shiftKey?30:1))),(w=ext.offsetWidth)-d[0],(h=ext.offsetHeight)-d[1],d[0],d[1]);
}n.ownerDocument.execCommand("commit");apf.layout.processQueue();n.ownerDocument.$getVisualSelect().updateGeo();
if(selected.length>1){var vOutline=n.ownerDocument.$getVisualSelect().$getOutline();
l=apf.getHtmlLeft(vOutline);t=apf.getHtmlTop(vOutline);w=vOutline.offsetWidth;h=vOutline.offsetheight;
}setDragInfo(n,n.parentNode,true);showDrag.common_resize.call(n,l,t,w,h,{},{},true,true,true,true,true,1);
hideIndicators(true);}apf.addEventListener("keydown",keydown);function setDefaultStuck(amlNode){amlNode.$stuck=[amlNode.$adding||amlNode.top&&!amlNode.bottom||amlNode.top==10||amlNode.top===0,amlNode.right&&!amlNode.left||amlNode.right==10||amlNode.right===0,amlNode.bottom&&!amlNode.top||amlNode.bottom==10||amlNode.bottom===0,amlNode.$adding||amlNode.left&&!amlNode.right||amlNode.left==10||amlNode.left===0];
var s=amlNode.$stuck;if(s[0]&&s[1]&&s[2]&&s[3]){amlNode.$stuck=[false,false,false,false];
}}apf.ContentEditable.addInteraction=function(amlNode){if(!inited){init();}amlNode.addEventListener("beforedragstart",beforedragstart);
amlNode.addEventListener("beforedrag",beforedrag);amlNode.addEventListener("beforeresize",beforeresize);
amlNode.addEventListener("afterdrag",afterdrag);amlNode.addEventListener("afterresize",afterresize);
amlNode.addEventListener("resizecancel",cancel);amlNode.addEventListener("dragcancel",cancel);
setDefaultStuck(amlNode);};apf.ContentEditable.removeInteraction=function(amlNode){amlNode.removeEventListener("beforedragstart",beforedragstart);
amlNode.removeEventListener("beforedrag",beforedrag);amlNode.removeEventListener("beforeresize",beforeresize);
amlNode.removeEventListener("afterdrag",afterdrag);amlNode.removeEventListener("afterresize",afterresize);
amlNode.removeEventListener("resizecancel",cancel);amlNode.removeEventListener("dragcancel",cancel);
delete amlNode.$stuck;};})();apf.selectrect=function(){var active;var p1=document.body.appendChild(document.createElement("div")),p2=document.body.appendChild(document.createElement("div")),q=document.body.appendChild(document.createElement("div")),_self=this,startX,startY;
p1.className="pointer_left";p2.className="pointer_right";q.className="new_element";
this.activate=function(){if(active){return;}active=true;document.onmousemove=function(e){if(!e){e=event;
}p1.style.width=(Math.abs(e.clientX)||1)+"px";p1.style.height=(Math.abs(e.clientY)||1)+"px";
p2.style.width=(Math.abs(document.documentElement.offsetWidth-e.clientX-5)||1)+"px";
p2.style.height=(Math.abs(document.documentElement.offsetHeight-e.clientY-5)||1)+"px";
if(q.style.display=="block"){var wt=e.clientX-startX-1,ht=e.clientY-startY-1,min=Math.min(wt,ht);
q.style.width=(wt<0?-1*(wt-1):(wt||1))+"px";q.style.height=(ht<0?-1*(ht-1):(ht||1))+"px";
q.style.left=wt<0?"":(startX)+"px";q.style.right=wt<0?(document.documentElement.offsetWidth-startX-4)+"px":"";
q.style.bottom=ht<0?(document.documentElement.offsetHeight-startY-4)+"px":"";q.style.top=ht<0?"":(startY)+"px";
apf.config.setProperty("x",apf.getHtmlLeft(q));apf.config.setProperty("y",apf.getHtmlTop(q));
apf.config.setProperty("w",q.offsetWidth);apf.config.setProperty("h",q.offsetHeight);
}else{apf.config.setProperty("x",e.clientX);apf.config.setProperty("y",e.clientY);
apf.config.setProperty("w","");apf.config.setProperty("h","");}};document.onmousedown=function(e){if(!e){e=event;
}p1.style.top="-2000px";p2.style.top="-2000px";var el=document.elementFromPoint(e.clientX,e.clientY);
var amlNode=apf.findHost(el);p1.style.top="";p2.style.top="";if(amlNode){while(amlNode&&!amlNode.$int){amlNode=amlNode.parentNode;
}}if(!amlNode){amlNode=apf.document.documentElement;}if(!amlNode.editable){return;
}q.style.display="block";q.style.left=(startX=event.clientX)+"px";q.style.top=(startY=event.clientY)+"px";
q.style.width=q.style.height="1px";apf.dragMode=true;};document.onmouseup=function(){if(q.offsetWidth>10&&q.offsetHeight>10){if(apf.document.queryCommandValue("mode")=="select"){apf.document.execCommand("select",false,{htmlNode:q});
}else{apf.document.execCommand("add",false,{htmlNode:q});}_self.deactivate();}q.style.display="none";
startX=false;startY=false;apf.dragMode=false;};p1.style.display=p2.style.display="block";
document.body.style.cursor=document.documentElement.style.cursor="crosshair";};
this.deactivate=function(){active=false;document.onmousemove=null;document.onmousedown=null;
document.onmouseup=null;p1.style.display=p2.style.display=q.style.display="none";
document.body.style.cursor=document.documentElement.style.cursor="";};};apf.visualConnect=function(sel){var lineMode="draw";
var active,div,cTemplate;var fromEl,toEl;var fromAtt,toAtt;var connections;var attMenu;
var ignoreFromAtts=["id"];var ignoreToAtts=["for"];var _self=this;var prevSelection;
var width=document.body.clientWidth;var height=800;var paintGroup=apf.vector.group({w:width,h:height,z:1000});
var paintRect=paintGroup.rect({sw:1,s:"#24a3f4",f:"#24a3f4",o:0.2});var paintLine=paintGroup.shape({p:"",sw:1.5,s:"#24a3f4",f:"#24a3f4"});
var paintConnections=paintGroup.shape({p:"",sw:1.5,s:"#24a3f4",f:"#24a3f4"});this.setMode=function(mode){lineMode=mode;
if(this.onchangemode){this.onchangemode({mode:mode});}};this.activate=function(e,timeout){if(active){return;
}active=true;var _self=this;var drawPath=[],connectionPath=[],hNode,pos,selection=sel.$getNodeList(),lines=[];
var timer,lastTime;var isDrawing=false;apf.addEventListener("vcpropchange",function(e){if(connections[e.obj.fromEl.id]&&connections[e.obj.fromEl.id][e.obj.toEl.id]){var el1=e.obj.fromEl.id,el2=e.obj.toEl.id;
}else{var el1=e.obj.toEl.id,el2=e.obj.fromEl.id;}for(var maxBoxWidth=0,maxLeftWidth=0,i=0,l=connections[el1][el2].length;
i<l;i++){if((c=connections[el1][el2][i].conn).getMaxLeftWidth()>maxLeftWidth){maxLeftWidth=c.getMaxLeftWidth();
}if(c.getMaxBoxWidth()>maxBoxWidth){maxBoxWidth=c.getMaxBoxWidth();}}for(i=0,l=connections[el1][el2].length;
i<l;i++){(c=connections[el1][el2][i].conn).$fromBox.style.width=maxLeftWidth+20+"px";
c.$ext.style.width=maxBoxWidth+90+"px";}});apf.addEventListener("vcdelete",function(e){e.el.style.display="none";
});apf.addEventListener("vcmoveselection",function(e){sel.$selectList(selection=[e.target]);
createConnections(selection);showConnections();});apf.plane.show();div=document.body.appendChild(document.createElement("div"));
div.style.display="block";div.style.position="absolute";div.style.left="0px";div.style.top="0px";
div.style.zIndex=100000001;switch(lineMode){case"draw":startDraw(e);break;case"element":if(selection.length){createConnections(selection);
showConnections();}break;case"all":var all=[];for(var el,i=0,l=apf.all.length;i<l;
i++){if((el=apf.all[i]).$ext&&el.prefix=="a"){all.push(apf.all[i]);}}if(createConnections(all)){selection=all;
}showConnections();break;}function createConnections(elements){connections=null;
if(elements.length){var all=[];for(var el,i=0,l=apf.all.length;i<l;i++){if((el=apf.all[i]).$ext&&el.prefix=="a"){all.push(apf.all[i]);
}}for(var al,attrs,el,i=0,l=elements.length;i<l;i++){for(var fromAt in (attrs=(el=elements[i]).$funcHandlers)){for(var at,targetList=[],ai=0,al=attrs[fromAt].length;
ai<al;ai++){targetList.push({el:(at=attrs[fromAt][ai]).amlNode,at:at.prop});}createConnection(el,fromAt,targetList);
}}}var found=false;for(var id in connections){found=true;}return found;}function showConnections(){if(connections){drawConnections();
paintConnections.style({p:connectionPath.join(" ")});apf.plane.show();paintGroup.style({v:1});
paintGroup.repaint();}else{alert("no connections");}}function startDraw(e){apf.dragMode=true;
fromEl=null;toEl=null;}function stopDraw(e){apf.dragMode=true;apf.plane.hide();
paintGroup.style({v:0});paintGroup.repaint();var htmlNode=document.elementFromPoint(e.clientX,e.clientY);
var amlNode=apf.findHost(htmlNode);if(amlNode&&amlNode.editable&&selection.indexOf(amlNode)==-1&&amlNode.tagName!="html"){toEl=amlNode;
var hNode,x,y,w,h,pos;var from={x:(x=(pos=apf.getAbsolutePosition((hNode=fromEl.$ext)))[0]),y:(y=pos[1]),w:(w=hNode.offsetWidth),h:(h=hNode.offsetHeight),c:[Math.round(x+w/2),Math.round(y+h/2)]};
var to={x:(x=(pos=apf.getAbsolutePosition((hNode=toEl.$ext)))[0]),y:(y=pos[1]),w:(w=hNode.offsetWidth),h:(h=hNode.offsetHeight),c:[Math.round(x+w/2),Math.round(y+h/2)]};
var pos1=from.c,pos2=to.c;paintGroup.style({v:1});paintLine.style({p:["M",pos1[0],pos1[1],"L",pos2[0],pos2[1],paintGroup.circlePath(pos2[0],pos2[1],1,1)].join(" ")});
paintGroup.repaint();var x=e.clientX,y=e.clientY;if(!toEl.attributes.length){return;
}for(var name,attList=[],i=0,l=toEl.attributes.length;i<l;i++){if(ignoreToAtts.indexOf((name=toEl.attributes[i].name))>-1){continue;
}attList.push(new apf.item({caption:name}));}attMenu=new apf.menu({htmlNode:div,id:"attMenu",childNodes:attList});
setTimeout(function(e){attMenu.display(x,y,true);});attMenu.addEventListener("mousedown",function(e){(e||event).cancelBubble=true;
});attMenu.addEventListener("mouseup",function(e){(e||event).cancelBubble=true;
});attMenu.addEventListener("itemclick",function(e){sel.$selectList(selection=[fromEl]);
apf.dragMode=true;toAtt=e.value;attMenu.setProperty("visible",false);fromEl.setAttribute(fromAtt,"{"+toEl.id+"."+toAtt+"}");
paintLine.style({p:""});if(createConnections([fromEl])){showConnections();}});}isDrawing=false;
}function updateDraw(e){apf.plane.hide();paintGroup.style({v:0});paintGroup.repaint();
var htmlNode=document.elementFromPoint(e.clientX,e.clientY);var amlNode=apf.findHost(htmlNode);
if(amlNode&&amlNode.editable&&selection.indexOf(amlNode)==-1){htmlNode=amlNode.$ext;
var pos=apf.getAbsolutePosition(htmlNode);paintRect.style({x:pos[0],y:pos[1],w:htmlNode.offsetWidth,h:htmlNode.offsetHeight});
}else{paintRect.style({w:0,h:0});}var drawPath=[];for(var i=0,il=selection.length;
i<il;i++){hNode=selection[i].$ext;pos=apf.getAbsolutePosition(hNode);var sx=~~(pos[0]+(hNode.offsetWidth/2)),sy=~~(pos[1]+(hNode.offsetHeight/2)),ex=e.clientX,ey=e.clientY;
drawPath.push("M",sx,sy,"L",ex,ey,paintGroup.circlePath(sx,sy,3,3),paintGroup.circlePath(ex,ey,3,3));
}paintLine.style({p:drawPath.join(" ")});apf.plane.show();paintGroup.style({v:1});
paintGroup.repaint();}document.onmousemove=function(e){if(!e){e=event;}clearTimeout(timer);
if(lastTime&&new Date().getTime()-lastTime<apf.mouseEventBuffer){var z={clientX:e.clientX,clientY:e.clientY};
timer=setTimeout(function(){},10);return;}lastTime=new Date().getTime();if(isDrawing){updateDraw(e);
}};document.onmousedown=function(e){if(!e){e=event;}var amlNode;if(lineMode=="element"){}else{if(lineMode=="draw"&&!fromEl){apf.plane.hide();
var htmlNode=document.elementFromPoint(e.clientX,e.clientY);amlNode=apf.findHost(htmlNode);
if(amlNode){fromEl=amlNode;sel.$selectList(selection=[fromEl]);var x=e.clientX,y=e.clientY;
if(!fromEl.attributes.length){return;}for(var name,attList=[],i=0,l=fromEl.attributes.length;
i<l;i++){if(ignoreFromAtts.indexOf((name=fromEl.attributes[i].name))>-1){continue;
}attList.push(new apf.item({caption:name}));}attMenu=new apf.menu({htmlNode:div,id:"attMenu",childNodes:attList});
setTimeout(function(e){attMenu.display(x,y,true);});attMenu.addEventListener("itemclick",function(e){sel.$selectList(selection=[fromEl]);
fromAtt=e.value;attMenu.setProperty("visible",false);isDrawing=true;});}_self.setMode("draw-started");
apf.plane.show();}else{if(attMenu.visible){attMenu.setProperty("visible",false);
}if(fromEl){stopDraw(e);}}}};document.onmouseup=function(e){};function createConnection(el1,at1,targetList){if(!(el1.id&&at1&&targetList.length)){return;
}var pos,x,y,w,h;if(targetList.length==1){var el2=targetList[0].el;var at2=targetList[0].at;
var from={x:(x=(pos=apf.getAbsolutePosition((hNode=el1.$ext)))[0]),y:(y=pos[1]),w:(w=hNode.offsetWidth),h:(h=hNode.offsetHeight),t:[Math.round(x+w/2),y],b:[Math.round(x+w/2),y+h],l:[x,Math.round(y+h/2)],r:[x+w,Math.round(y+h/2)],c:[Math.round(x+w/2),Math.round(y+h/2)]};
var to={x:(x=(pos=apf.getAbsolutePosition((hNode=el2.$ext)))[0]),y:(y=pos[1]),w:(w=hNode.offsetWidth),h:(h=hNode.offsetHeight),t:[Math.round(x+w/2),y],b:[Math.round(x+w/2),y+h],l:[x,Math.round(y+h/2)],r:[x+w,Math.round(y+h/2)],c:[Math.round(x+w/2),Math.round(y+h/2)]};
var conn={from:{el:el1,at:at1,pos:from.c},to:{el:el2,at:at2,pos:to.c}};var val;
if(val=el2.getAttribute(at2)){conn.val=val;}else{conn.val="{"+el2.id+"."+at2+"}";
conn.readonly=true;}var fromId,toId;if(!connections){connections={};}if(!connections[(fromId=el1.id)]){connections[fromId]={};
}if(!connections[fromId][toId]){connections[fromId][toId]=[conn];}else{connections[fromId][toId].push(conn);
}}else{return;}}function drawConnections(){connectionPath=[];if(div){document.body.removeChild(div);
}div=document.body.appendChild(document.createElement("div"));div.style.display="block";
div.style.position="absolute";div.style.left="0px";div.style.top="0px";div.style.width=width+"px";
div.style.height=height+"px";div.style.zIndex=100000001;for(var id in connections){for(var id2 in connections[id]){var curConnections=connections[id][id2];
for(var c,cType,connEdit,connDivs=[],maxBoxWidth=0,maxLeftWidth=0,centerPos,pos1,pos2,i=0,l=curConnections.length;
i<l;i++){pos1=(c=curConnections[i]).from.pos;pos2=c.to.pos;centerPos=[Math.round((pos1[0]+pos2[0])/2),Math.round((pos1[1]+pos2[1])/2)];
if(c.readonly){cType="readonly";}connEdit=new connectEdit(div,c.from.el,c.to.el,c.from.at,c.to.at,c.val,cType);
div.appendChild(connEdit.$ext);connections[id][id2][i].conn=connEdit;if(connEdit.getMaxLeftWidth()>maxLeftWidth){maxLeftWidth=connEdit.getMaxLeftWidth();
}if(connEdit.getMaxBoxWidth()>maxBoxWidth){maxBoxWidth=connEdit.getMaxBoxWidth();
}connDivs.push(connEdit);var linePadding=4;centerPos=(l%2==0)?[centerPos[0]-(connEdit.$box.offsetWidth+10)/2,centerPos[1]-l/2*connEdit.$box.offsetHeight*i]:centerPos=[centerPos[0]-(connEdit.$box.offsetWidth+10)/2,centerPos[1]-(l+1)/2*connEdit.$box.offsetHeight*(i+0.5)];
centerPos[0]=(centerPos[0]>0)?centerPos[0]:0;centerPos[1]=(centerPos[1]>0)?centerPos[1]:0;
connEdit.$ext.style.display="none";connEdit.$ext.style.top=centerPos[1]+"px";connEdit.$ext.style.left=centerPos[0]+"px";
connectionPath.push("M",pos1[0],pos1[1],"L",pos2[0],pos2[1],paintGroup.circlePath(pos2[0],pos2[1],1,1));
}for(var c,container,spans,cDiv,i=0,l=connDivs.length;i<l;i++){(c=connDivs[i]).$ext.style.display="block";
c.$fromBox.style.width=maxLeftWidth+20+"px";c.$ext.style.width=maxBoxWidth+90+"px";
}}}}};this.deactivate=function(){if(!active){return;}active=false;var selection;
if(selection=sel.$getNodeList()){prevSelection=selection;}document.onmousedown=document.onmousemove=document.onmouseup=null;
apf.dragMode=false;apf.plane.hide();paintLine.style({p:""});paintConnections.style({p:""});
paintRect.style({w:0,h:0});paintGroup.style({v:0});paintGroup.repaint();if(div){div.style.display="none";
}if(div){document.body.removeChild(div);}};};function connectEdit(container,fromEl,toEl,fromAt,toAt,val,type){this.container=container;
this.fromEl=fromEl;this.toEl=toEl;this.fromAt=fromAt;this.toAt=toAt;this.value=val;
this.type=type||"simple";this.draw();}(function(){this.ignoreFromAtts=["id"];this.ignoreToAtts=["for"];
this.$getInput=function(){apf.Rename.initEditableArea.call(this);var txt=this.$txt;
txt.host=this;return txt;};this.startEdit=function(el){htmlNode=this.$value;var value=this.value;
var txt=this.$getInput();htmlNode.innerHTML="";htmlNode.appendChild(txt);if(apf.hasContentEditable){txt.innerHTML=value.replace(/</g,"&lt;")||apf.hasContentEditableContainerBug&&"<br>"||"";
}else{txt.value=value;}txt.unselectable="Off";var f=function(){try{txt.focus();
txt.select();}catch(e){}};if(apf.isIE){f();}else{setTimeout(f);}this.renaming=true;
},this.stopRename=this.stopEdit=function(x,success){if(!this.renaming){return;}this.renaming=false;
var htmlNode=this.$value;htmlNode.removeChild(this.$txt);var value=typeof success=="string"?success:(apf.hasContentEditable?this.$txt.innerText:this.$txt.value).replace(/<.*?nobr>/gi,"").replace(/\n$/,"");
if(success&&this.value!=value){this.setPropValue(value);}else{if(htmlNode.nodeType==1){htmlNode.innerHTML=this.value;
}else{htmlNode.nodeValue=this.value;}}htmlNode.parentNode.scrollLeft=0;};this.setPropName=function(name){this.fromAt=name;
this.$lblAttMenu.innerHTML=this.fromAt;};this.setPropValue=function(value){this.value=value;
this.$lblVal.innerHTML=this.value;};this.draw=function(name,prop,value){var _self=this;
this.$ext=document.createElement("div");this.$ext.setAttribute("class","atchart_box");
this.$ext.setAttribute("style","width:285px;color:#000000;font-family:Tahoma;font-size:12px;height:29px;min-width:30px;min-height:29px;max-height:29px;overflow:hidden;cursor:default;position:absolute;");
this.$ext.innerHTML='<div class="left"> </div><div class="red_button"> </div><div class="right"> </div><div class="lbl"><div><span class="section1">Button.</span><span class="section2"><a href="#">caption</a></span></div><span class="section3">=</span><span class="section4">&quot;</span><label class="section5">{button2.value}</label><span class="section4">&quot;</span></div>';
this.$ext.onmousedown=this.$ext.onmouseup=function(e){(e||event).cancelBubble=true;
};var divs,spans;this.$delBtn=(divs=this.$ext.getElementsByTagName("div"))[1];if(this.type=="readonly"){this.$delBtn.style.display="none";
}this.$box=divs[3];this.$fromBox=this.$box.getElementsByTagName("div")[0];this.$lblFromEl=(spans=this.$fromBox.getElementsByTagName("span"))[0];
this.$lblFromEl.innerHTML=this.fromEl.id+".";this.$attMenu=spans[1];this.$lblAttMenu=this.$attMenu.firstChild;
this.setPropName(this.fromAt);if(this.type!="readonly"){this.$delBtn.onmousedown=function(e){(e||event).cancelBubble=true;
};this.$delBtn.onmouseup=function(e){_self.fromEl.setAttribute(_self.fromAt,"");
apf.dispatchEvent("vcdelete",{el:_self.$ext});(e||event).cancelBubble=true;};this.$attMenu.onmousedown=function(e){(e||event).cancelBubble=true;
};this.$attMenu.onmouseup=function(e){var e=e||event;for(var name,attList=[],ai=0,al=_self.fromEl.attributes.length;
ai<al;ai++){if(_self.ignoreFromAtts.indexOf((name=_self.fromEl.attributes[ai].name))>-1){continue;
}attList.push(new apf.item({caption:name}));}attMenu=new apf.menu({htmlNode:_self.$ext,id:"attMenu",childNodes:attList});
var pos=apf.getAbsolutePosition(this);var x=pos[0],y=pos[1]+this.offsetHeight;setTimeout(function(){attMenu.display(x,y,true);
attMenu.$ext.style.left=x;attMenu.$ext.style.zIndex=100000002;apf.popup.cache[apf.popup.last].content.onmousedown=function(e){var newAt=attMenu.$selected.caption;
if(_self.fromAt==newAt){return;}attMenu.setProperty("visible",false);_self.fromEl.setAttribute(_self.fromAt,"");
_self.setPropName(newAt);_self.fromEl.setAttribute(newAt,_self.value);(e||event).cancelBubble=true;
_self.container.onmousedown=_self.container.onmouseup=function(e){_self.container.onmousedown=_self.container.onmouseup=null;
apf.dispatchEvent("vcpropchange",{obj:_self});(e||event).cancelBubble=true;};};
});(e||event).cancelBubble=true;};}this.$lblVal=this.$box.getElementsByTagName("label")[0];
this.setPropValue(this.value);if(this.type!="readonly"){this.$inputVal=this.createInput();
}if(this.type=="readonly"){this.$ext.onmousedown=function(e){apf.dispatchEvent("vcmoveselection",{target:_self.toEl});
(e||event).cancelBubble=true;};this.$ext.onmouseup=function(e){(e||event).cancelBubble=true;
};}};this.createInput=function(){var inputVal=document.createElement("input");inputVal.setAttribute("type","text");
inputVal.setAttribute("class","section5");inputVal.setAttribute("value",this.$lblVal.innerHTML);
inputVal.style.width=(this.$lblVal.offsetWidth-2>0?this.$lblVal.offsetWidth-2:0)+"px";
inputVal.onkeydown=inputVal.onkeypress=inputVal.onmousedown=inputVal.onmouseup=function(e){(e||event).cancelBubble=true;
};inputVal.onblur=function(){this.hasFocus=false;this.onkeydown=this.onkeypress=this.onkeyup=null;
_self.$lblVal.setAttribute("value",this.value);_self.$lblVal.getAttribute("el").setAttribute(lblVal.getAttribute("at"),this.value);
if(createConnections(selection)){showConnections();}(e||event).cancelBubble=true;
};inputVal.onkeyup=function(e){if((e||event).keyCode==13){_self.$lblVal.setAttribute("value","x"+this.value);
_self.$lblVal.getAttribute("el").setAttribute(lblVal.getAttribute("at"),this.value);
if(createConnections(selection)){showConnections();}}(e||event).cancelBubble=true;
};inputVal.onfocus=function(e){this.hasFocus=true;};inputVal.onmouseout=function(e){if(this.hasFocus){return;
}$this.inputVal.replaceNode(lblVal,inputVal);};return inputVal;};this.getMaxLeftWidth=function(){return this.$lblFromEl.offsetWidth+this.$lblAttMenu.offsetWidth;
};this.getMaxBoxWidth=function(){return this.$lblFromEl.offsetWidth+this.$lblAttMenu.offsetWidth+this.$lblVal.offsetWidth;
};}).call(connectEdit.prototype=new apf.Class());apf.visualSelect=function(selection){this.$init();
var _self=this;selection.addEventListener("update",function(){_self.updateSelection();
});this.$selection=selection;};(function(){var nodes=[],pos=["n","ne","e","se","s","sw","w","nw"],div,oOutline,inited=false;
function init(){while(nodes.length!=8){div=document.body.appendChild(document.createElement("div"));
div.className="idegrabber";div.style.display="none";div.onmousedown=mousedown;div.self=this;
div.host=false;nodes.push(div);nodes[(div.type=pos.pop())]=div;}oOutline=document.body.appendChild(document.createElement("div"));
oOutline.className="multiselect_container";oOutline.host=false;oOutline.self=this;
oOutline.onmouseup=oOutline.onmousedown=function(e){if(!e){e=event;}var prevTop=this.style.top;
this.style.top="-10000px";var el=document.elementFromPoint(e.clientX,e.clientY);
this.style.top=prevTop;apf.fireEvent(el,(e.type||e.name),e);e.cancelBubble=true;
};inited=true;}this.$getOutline=function(){return oOutline;};var selected=[],anchors,size=7,margin=-1;
this.show=function(){if(!inited){init.call(this);}this.visible=true;for(var i=0;
i<nodes.length;i++){nodes[i].style.display="";}oOutline.style.display="";if(lastSelection){this.updateGeo();
}};this.hide=function(){if(!inited){return;}this.visible=false;for(var i=0;i<nodes.length;
i++){nodes[i].style.display="none";}oOutline.style.display="none";};this.$finishResize=function(noGeo){apf.setStyleClass(resizing,"",["idegrabber_resizing"]);
resizing=false;if(lastSelection.length==1){this.updateGeo(false,true);}};var lastSelection=[];
this.updateSelection=function(){var nodes=this.$selection.$getNodeList();if(!inited){init.call(this);
}for(var s,i=0,l=lastSelection.length;i<l;i++){if(nodes.indexOf(s=lastSelection[i])==-1){apf.layout.removeRule(s.$ext,"visualselect");
apf.layout.activateRules(s.$ext);}}for(i=0,l=nodes.length;i<l;i++){if(lastSelection.indexOf(s=nodes[i])==-1){apf.layout.setRules(s.$ext,"visualselect","apf.all["+this.$uniqueId+"].updateGeo()",true);
apf.layout.queue(s.$ext);}}if(s.$ext.parentNode.tagName=="BODY"){apf.layout.setRules(document.documentElement,"visualselect","apf.all["+this.$uniqueId+"].updateGeo()",true);
apf.layout.queue(document.documentElement);}else{apf.layout.removeRule(document.documentElement,"visualselect");
apf.layout.activateRules(document.documentElement);}lastSelection=nodes;if(!nodes.length){return this.hide();
}else{if(nodes.length>1){oOutline.innerHTML=Array(nodes.length+1).join("<div></div>");
}}this.updateGeo();if(!this.visible){this.show();}};this.getLastSelection=function(){return lastSelection;
};var lastPos,txt,recursion;this.updateGeo=function(force,onlyUpdateAnchors){if(recursion){return;
}var selection=lastSelection;if(!selection.length){return;}recursion=true;if(selection.length==1){var sel=selection[0];
if(!sel.parentNode){sel.$focusParent.focus();return(recursion=false);}if(sel.$adding){return(recursion=false);
}var anchors=selection.length==1?(sel.$anchors&&sel.$anchors.length?sel.$anchors:[sel.top,sel.right,sel.bottom,sel.left]):[];
if(anchors&&!resizing&&!this.renaming){var pel=sel.parentNode;var name=pel.localName;
var exclPNode="table|vbox|hbox".indexOf(name)>-1;var fullDisabled=name=="vbox"&&String(sel.height).indexOf("%")>-1||name=="hbox"&&String(sel.width).indexOf("%")>-1;
var pack=sel.align||pel.pack;apf.setStyleClass(nodes.n,fullDisabled||name=="table"||name=="vbox"&&pack=="start"||name=="hbox"?"idegrabber_disabled":(!exclPNode&&(anchors[0]||anchors[0]===0)?"idegrabber_selected":""),["idegrabber_selected","idegrabber_disabled"]);
apf.setStyleClass(nodes.e,fullDisabled||name=="table"||name=="hbox"&&pack=="end"?"idegrabber_disabled":(!exclPNode&&(anchors[1]||anchors[1]===0)?"idegrabber_selected":""),["idegrabber_selected","idegrabber_disabled"]);
apf.setStyleClass(nodes.s,fullDisabled||name=="vbox"&&pack=="end"?"idegrabber_disabled":(!exclPNode&&(anchors[2]||anchors[2]===0)?"idegrabber_selected":""),["idegrabber_selected","idegrabber_disabled"]);
apf.setStyleClass(nodes.w,fullDisabled||name=="table"||name=="vbox"||name=="hbox"&&pack=="start"?"idegrabber_disabled":(!exclPNode&&(anchors[3]||anchors[3]===0)?"idegrabber_selected":""),["idegrabber_selected","idegrabber_disabled"]);
apf.setStyleClass(nodes.nw,fullDisabled||name=="table"||name=="vbox"&&pack=="start"||name=="hbox"?"idegrabber_disabled":"",["idegrabber_disabled"]);
apf.setStyleClass(nodes.ne,fullDisabled||name=="table"||name=="hbox"&&pack=="end"?"idegrabber_disabled":"",["idegrabber_disabled"]);
apf.setStyleClass(nodes.sw,fullDisabled||name=="vbox"&&pack=="end"?"idegrabber_disabled":"",["idegrabber_disabled"]);
apf.setStyleClass(nodes.se,fullDisabled?"idegrabber_disabled":"",["idegrabber_disabled"]);
this.$selection.dispatchEvent("update-content",{sel:sel});}var oHtml=sel.$ext;oOutline.style.display="none";
if(!oHtml.offsetParent||onlyUpdateAnchors){return(recursion=false);}if(apf.isIE){oHtml.parentNode.appendChild(txt||(txt=document.createTextNode("")));
}var pos=apf.getAbsolutePosition(oHtml);pos.push(oHtml.offsetWidth,oHtml.offsetHeight);
}else{var oHtml,opos,pos=[100000,100000,0,0];for(var i=0;i<selection.length;i++){if(!selection[i].parentNode){this.$selection.removeRange(this.$selection.getRangeAt(i));
return(recursion=false);}oHtml=selection[i].$ext;opos=apf.getAbsolutePosition(oHtml);
if(opos[0]<pos[0]){pos[0]=opos[0];}if(opos[1]<pos[1]){pos[1]=opos[1];}if(opos[0]+oHtml.offsetWidth>pos[2]){pos[2]=opos[0]+oHtml.offsetWidth;
}if(opos[1]+oHtml.offsetHeight>pos[3]){pos[3]=opos[1]+oHtml.offsetHeight;}}if(!oHtml.offsetParent){return(recursion=false);
}oHtml.offsetParent.appendChild(oOutline);pos[2]-=pos[0];pos[3]-=pos[1];for(i=0,l=nodes.length;
i<l;i++){apf.setStyleClass(nodes[i],"idegrabber_disabled",["idegrabber_selected","idegrabber_disabled"]);
}var diff=apf.getDiff(oOutline),ppos=oHtml.offsetParent.tagName=="BODY"?[0,0]:apf.getAbsolutePosition(oHtml.offsetParent,null,true);
oOutline.style.left=(pos[0]-ppos[0])+"px";oOutline.style.top=(pos[1]-ppos[1])+"px";
oOutline.style.width=Math.max(0,pos[2]-diff[0])+"px";oOutline.style.height=Math.max(0,pos[3]-diff[1])+"px";
oOutline.style.display="block";if(selection.length>1){var ext,html,epos;for(i=0,l=selection.length;
i<l;i++){ext=selection[i].$ext;if(!ext.offsetWidth&&!ext.offsetHeight){continue;
}epos=apf.getAbsolutePosition(ext);html=oOutline.childNodes[i];html.style.left=(epos[0]-pos[0])+"px";
html.style.top=(epos[1]-pos[1])+"px";html.style.width=(ext.offsetWidth-2)+"px";
html.style.height=(ext.offsetHeight-2)+"px";}}}nodes.s.style.left=nodes.n.style.left=(pos[0]+(pos[2]-size)/2)+"px";
nodes.e.style.top=nodes.w.style.top=(pos[1]+(pos[3]-size)/2)+"px";nodes.nw.style.top=nodes.ne.style.top=nodes.n.style.top=(pos[1]-size-margin)+"px";
nodes.sw.style.left=nodes.nw.style.left=nodes.w.style.left=(pos[0]-size-margin)+"px";
nodes.ne.style.left=nodes.se.style.left=nodes.e.style.left=(pos[0]+pos[2]+margin)+"px";
nodes.se.style.top=nodes.sw.style.top=nodes.s.style.top=(pos[1]+pos[3]+margin)+"px";
recursion=false;};var resizing,map={e:"right",w:"left",n:"top",s:"bottom"};function mousedown(e){if(!e){e=event;
}var docsel=this.self.$selection;if(e.button==2||docsel.rangeCount>1){return;}var sel=docsel.$getFirstNode();
var doc=docsel.$ownerDocument;var name=sel.parentNode.localName;var type=this.type;
doc.$commands.begin.call(doc);if(e.ctrlKey&&type.length==1){if(sel.$anchors&&sel.$anchors.length){var anchors=sel.$anchors;
sel.setAttribute("anchors",null);sel.setAttribute("top",anchors[0]);sel.setAttribute("right",anchors[1]);
sel.setAttribute("bottom",anchors[2]);sel.setAttribute("left",anchors[3]);}var value=sel[map[type]];
apf.setStyleClass(this,!value&&value!==0?"idegrabber_selected":"",["idegrabber_selected"]);
var pHtmlNode=sel.$ext.offsetParent;if(pHtmlNode.tagName=="BODY"){pHtmlNode=document.documentElement;
}var curWidth=sel.$ext.offsetWidth;var curHeight=sel.$ext.offsetHeight;var prop=map[type];
if(sel[prop]||sel[prop]===0){if(prop=="right"&&!sel.left&&sel.left!==0){sel.setAttribute("left",apf.getHtmlLeft(sel.$ext));
}else{if(prop=="bottom"&&!sel.top&&sel.top!==0){sel.setAttribute("top",apf.getHtmlTop(sel.$ext));
}else{if(prop=="left"&&!sel.right&&sel.right!==0){sel.setAttribute("right",apf.getHtmlRight(sel.$ext));
}else{if(prop=="top"&&!sel.bottom&&sel.bottom!==0){sel.setAttribute("bottom",apf.getHtmlBottom(sel.$ext));
}}}}sel.removeAttribute(prop);}else{switch(type){case"e":sel.setAttribute("right",apf.getHtmlRight(sel.$ext));
break;case"w":sel.setAttribute("left",apf.getHtmlLeft(sel.$ext));break;case"n":sel.setAttribute("top",apf.getHtmlTop(sel.$ext));
break;case"s":sel.setAttribute("bottom",apf.getHtmlBottom(sel.$ext));break;}}if(!sel.left&&sel.left!==0||!sel.right&&sel.right!==0){sel.setAttribute("width",curWidth);
}else{sel.removeAttribute("width");}if(!sel.top&&sel.right!==0||!sel.bottom&&sel.bottom!==0){sel.setAttribute("height",curHeight);
}else{sel.removeAttribute("height");}doc.$commands.commit.call(doc);this.self.updateGeo();
}else{sel.$resizeStart(e||event,{resizeType:type,nocursor:true});resizing=this;
apf.setStyleClass(this,"idegrabber_resizing");}}}).call(apf.visualSelect.prototype=new apf.Class());
apf.window=function(){this.$uniqueId=apf.all.push(this);this.apf=apf;this.toString=function(){return"[apf.window]";
};this.getActionTracker=function(){return this.$at;};this.loadCodeFile=function(url){if(self[url]){apf.importClass(self[url],true,this.win);
}else{apf.include(url);}};this.flash=function(){if(apf.window.hasFocus()||apf.isIphone){return;
}if(apf.isDeskrun){jdwin.Flash();}else{if(apf.isIE){if(!this.popup){this.popup=window.createPopup();
}if(apf.window.stopFlash){return;}state+="x";function doFlash(nopopup){if(apf.window.hasFocus()){return;
}window.focus();function doPopup(){if(apf.window.hasFocus()){return;}this.popup.hide();
this.popup.show(0,0,0,0,document.body);this.popup.document.write("<body><script>                        document.p = window.createPopup();                        document.p.show(0, 0, 0, 0, document.body);                        <\/script></body>");
this.popup.document.focus();clearInterval(this.flashTimer);this.flashTimer=setInterval(function(){if(!apf.window.popup.isOpen||!apf.window.popup.document.p.isOpen){clearInterval(apf.window.flashTimer);
if(!apf.window.hasFocus()){apf.window.popup.hide();document.body.focus();state="d";
determineAction();}}},10);}if(nopopup){$setTimeout(function(){doPopup.call(apf.window);
},10);}else{doPopup.call(apf.window);}}if("TEXTAREA|INPUT|SELECT".indexOf(document.activeElement.tagName)>-1){document.activeElement.blur();
document.body.focus();apf.window.stopFlash=true;$setTimeout(function(){doFlash.call(apf.window,true);
apf.window.stopFlash=false;},10);}else{doFlash.call(apf.window);}}}};this.show=function(){if(apf.isDeskrun){jdwin.Show();
}};this.hide=function(){if(apf.isDeskrun){jdwin.Hide();}else{this.loaded=false;
if(this.win){this.win.close();}}};this.focus=function(){if(apf.isDeskrun){jdwin.SetFocus();
}else{window.focus();}};this.setIcon=function(url){if(apf.isDeskrun){jdwin.icon=parseInt(url)==url?parseInt(url):url;
}};this.setTitle=function(value){this.title=value||"";if(apf.isDeskrun){jdwin.caption=value;
}else{document.title=(value||"");}};this.loadAml=function(x){if(x[apf.TAGNAME]=="deskrun"){this.loadDeskRun(x);
}};var jdwin=apf.isDeskrun?window.external:null,jdshell=apf.isDeskrun?jdwin.shell:null;
this.loadDeskRun=function(q){jdwin.style=q.getAttribute("style")||"ismain|taskbar|btn-close|btn-max|btn-min|resizable";
apf.config.drRegName=q.getAttribute("record");if(q.getAttribute("minwidth")){jdwin.setMin(q.getAttribute("minwidth"),q.getAttribute("minheight"));
}if(q.getAttribute("record")&&jdshell.RegGet(apf.config.drRegName+"/window")){var winpos=jdshell.RegGet(apf.config.drRegName+"/window");
if(winpos){winpos=winpos.split(",");window.external.width=Math.max(q.getAttribute("minwidth"),Math.min(parseInt(winpos[2]),window.external.shell.GetSysValue("deskwidth")));
window.external.height=Math.max(q.getAttribute("minheight"),Math.min(parseInt(winpos[3]),window.external.shell.GetSysValue("deskheight")));
window.external.left=Math.max(0,Math.min(parseInt(winpos[0]),screen.width-window.external.width));
window.external.top=Math.max(0,Math.min(parseInt(winpos[1]),screen.height-window.external.height));
}}else{jdwin.left=q.getAttribute("left")||200;jdwin.top=q.getAttribute("top")||200;
jdwin.width=q.getAttribute("width")||800;jdwin.height=q.getAttribute("height")||600;
}jdwin.caption=q.getAttribute("caption")||"DeskRun";jdwin.icon=q.getAttribute("icon")||100;
var ct=$xmlns(q,"context",apf.ns.aml);if(ct.length){ct=ct[0];if(!apf.config.tray){apf.config.tray=window.external.CreateWidget("trayicon");
}var tray=apf.config.tray;tray.icon=q.getAttribute("tray")||100;tray.tip=q.getAttribute("tooltip")||"DeskRun";
tray.PopupClear();tray.PopupItemAdd("Exit",3);tray.PopupItemAdd("SEP",function(){});
var nodes=ct.childNodes;for(var i=nodes.length-1;i>=0;i--){if(nodes[i].nodeType!=1){continue;
}if(nodes[i][apf.TAGNAME]=="divider"){tray.PopupItemAdd("SEP",function(){});}else{tray.PopupItemAdd(apf.queryValue(nodes[i],"."),nodes[i].getAttribute("href")?new Function("window.open('"+nodes[i].getAttribute("href")+"')"):new Function(nodes[i].getAttribute("onclick")));
}}}jdwin.shell.debug=apf.debug?7:0;jdwin.Show();jdwin.SetFocus();};this.vManager=new apf.visibilitymanager();
this.zManager=new apf.zmanager();this.$tabList=[];this.$addFocus=function(amlNode,tabindex,isAdmin){if(!isAdmin){amlNode.addEventListener("DOMNodeInserted",moveFocus);
amlNode.addEventListener("DOMNodeRemoved",removeFocus);if(amlNode.$isWindowContainer>-2){amlNode.addEventListener("focus",trackChildFocus);
amlNode.addEventListener("blur",trackChildFocus);amlNode.$focusParent=amlNode;if(amlNode.$isWindowContainer>-1){if(!amlNode.$tabList){amlNode.$tabList=[amlNode];
}this.$tabList.push(amlNode);return;}else{amlNode.$tabList=[amlNode];}}}var fParent=findFocusParent(amlNode),list=fParent.$tabList;
if(list[tabindex]){apf.console.warn("Aml node already exist for tabindex "+tabindex+". Will insert "+amlNode.tagName+" ["+(amlNode.name||"")+"] before existing one");
}if(!amlNode.$isWindowContainer){amlNode.$focusParent=fParent;}else{amlNode.$focusParent2=fParent;
}if(list[tabindex]){list.insertIndex(amlNode,tabindex);}else{list.push(amlNode);
}};this.$removeFocus=function(amlNode){if(!amlNode.$focusParent){return;}amlNode.$focusParent.$tabList.remove(amlNode);
if(!amlNode.$isWindowContainer){amlNode.removeEventListener("DOMNodeInserted",moveFocus);
amlNode.removeEventListener("DOMNodeRemoved",removeFocus);}if(amlNode.$isWindowContainer>-2){amlNode.removeEventListener("focus",trackChildFocus);
amlNode.removeEventListener("blur",trackChildFocus);}};var focusLoopDetect;this.$focus=function(amlNode,e,force){var aEl=this.document.activeElement;
if(aEl==amlNode&&!force){return;}var hadAlreadyFocus=aEl==amlNode;this.$settingFocus=amlNode;
if(!e){e={};}e.toElement=amlNode;e.fromElement=aEl;if(aEl&&aEl!=amlNode&&focusLoopDetect!=aEl){focusLoopDetect=aEl;
aEl.blur(true,e);if(focusLoopDetect!=aEl){return false;}}(apf.activeElement=this.document.activeElement=amlNode).focus(true,e);
this.$settingFocus=null;apf.dispatchEvent("movefocus",{toElement:amlNode});if(!hadAlreadyFocus){apf.console.info("Focus given to "+amlNode.localName+" ["+(amlNode.name||"")+"]");
}if(typeof apf.offline!="undefined"&&apf.offline.state.enabled&&apf.offline.state.realtime){apf.offline.state.set(this,"focus",amlNode.name||amlNode.$uniqueId);
}};this.$blur=function(amlNode){var aEl=this.document.activeElement;if(aEl!=amlNode){return false;
}apf.console.info(aEl.localName+" ["+(aEl.name||"")+"] was blurred.");aEl.$focusParent.$lastFocussed=null;
apf.activeElement=this.document.activeElement=null;apf.dispatchEvent("movefocus",{fromElement:amlNode});
};var lastFocusParent;this.$focusDefault=function(amlNode,e){var fParent=findFocusParent(amlNode);
this.$focusLast(fParent,e);};this.$focusRoot=function(e){var docEl=apf.document.documentElement;
if(this.$focusLast(docEl,e)===false){}};this.$focusLast=function(amlNode,e,ignoreVisible){var lf=amlNode.$lastFocussed;
if(lf&&lf.parentNode&&lf.$focussable===true&&(ignoreVisible||lf.$ext.offsetHeight)){this.$focus(lf,e,true);
}else{var next,node=amlNode,skip;while(node){if(!skip&&node.focussable!==false&&node.$focussable===true&&!node.$tabList&&(ignoreVisible||node.$ext&&node.$ext.offsetHeight)&&node.disabled<1){this.$focus(node,e,true);
break;}if((next=!skip&&node.firstChild||!(skip=false)&&node.nextSibling)){node=next;
if(node.$isWindowContainer>0){skip=true;}}else{if(node==amlNode){if(node.$isWindowContainer){this.$focus(node,e,true);
}return;}else{do{node=node.parentNode;}while(node&&!node.nextSibling&&node!=amlNode&&!node.$isWindowContainer);
if(node==amlNode){if(node.$isWindowContainer){this.$focus(node,e,true);}return;
}if(node){if(node.$isWindowContainer){this.$focus(node,e,true);break;}node=node.nextSibling;
}}}}if(!node){this.$focus(apf.document.documentElement);}}};function trackChildFocus(e){if(e.name=="blur"){if(e.srcElement!=this&&this.$blur){this.$blur();
}return;}if(e.srcElement!=this&&this.$focus&&(!e||!e.mouse||this.$focussable==apf.KEYBOARD_MOUSE)){this.$focus();
}if(e.srcElement==this||e.trackedChild){e.trackedChild=true;return;}this.$lastFocussed=e.srcElement;
if(this.localName&&this.localName.indexOf("window")>-1){e.trackedChild=true;}}function findFocusParent(amlNode){var node=amlNode;
do{node=node.parentNode;}while(node&&!node.$isWindowContainer);return node||apf.document.documentElement;
}function moveFocus(e){if(e&&e.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.pushUnique(this);
}else{apf.window.$addFocus(this,this.tabindex,true);}}function removeFocus(e){if(e&&(e.currentTarget!=this||e.$doOnlyAdmin)){return;
}var list=this.$focusParent.$tabList;var nodes=this.childNodes;for(var i=0,l=nodes.length;
i<l;i++){list.remove(nodes[i]);}if(apf.document.activeElement==this){apf.window.moveNext();
}if(this.$isWindowContainer){apf.window.$tabList.remove(this);return;}if(!this.$focusParent){return;
}list.remove(this);}this.hasFocus=function(amlNode){return this.document.activeElement==amlNode;
};this.moveNext=function(shiftKey,relObject,switchWindows,e){if(switchWindows&&apf.document.activeElement){var p=apf.document.activeElement.$focusParent;
if(p.visible&&p.modal){return false;}}var dir,start,next,amlNode=relObject||apf.document.activeElement,fParent=amlNode?(switchWindows&&amlNode.$isWindowContainer&&amlNode.$isWindowContainer!=-1?apf.window:e&&e.innerList?amlNode.$focusParent:amlNode.$focusParent2||amlNode.$focusParent):apf.document.documentElement,list=fParent.$tabList;
if(amlNode&&(switchWindows||amlNode!=apf.document.documentElement)){start=(list||[]).indexOf(amlNode);
if(start==-1){apf.console.warn("Moving focus from element which isn't in the list                                  of it's parent. This should never happen.");
return;}}else{start=-1;}if(this.document.activeElement&&this.document.activeElement==amlNode&&list.length==1||list.length==0){return false;
}dir=(shiftKey?-1:1);next=start;if(start<0){start=0;}do{next+=dir;if(next>=list.length){next=0;
}else{if(next<0){next=list.length-1;}}if(start==next&&amlNode){if(list[0].$isWindowContainer){this.$focus(list[0],e);
}return false;}amlNode=list[next];}while(!amlNode||amlNode.disabled>0||amlNode==apf.document.activeElement||(switchWindows?!amlNode.visible:amlNode.$ext&&!amlNode.$ext.offsetHeight)||amlNode.focussable===false||switchWindows&&!amlNode.$tabList.length);
if(fParent==apf.window&&amlNode.$isWindowContainer!=-2){this.$focusLast(amlNode,{mouse:true},switchWindows);
}else{(e||(e={})).shiftKey=shiftKey;this.$focus(amlNode,e);}};this.focusDefault=function(){if(typeof apf.offline!="undefined"&&apf.offline.state.enabled){var node,id=apf.offline.state.get(this,"focus");
if(id==-1){return this.$focusRoot();}if(id){node=self[id]||apf.lookup(id);}if(node){if(!node.$focussable){apf.console.warn("Invalid offline state detected. The application was probably changed in between sessions. Resetting offline state and rebooting.");
apf.offline.clear();apf.offline.reboot();}else{this.$focus(node);return;}}}if(this.moveNext()===false){this.moveNext(null,apf.document.documentElement,true);
}};apf.addListener(window,"beforeunload",function(){return apf.dispatchEvent("exit");
});apf.addListener(window,"unload",function(){if(!apf){return;}apf.window.isExiting=true;
apf.window.destroy();});var timer,state="",last="";this.$focusfix=function(){if(apf.isIphone){return;
}state+="a";clearTimeout(timer);$setTimeout("window.focus();");timer=$setTimeout(determineAction);
};this.$focusfix2=function(){if(apf.isIphone){return;}state+="b";clearTimeout(timer);
timer=$setTimeout(determineAction);};this.$blurfix=function(){if(apf.isIphone){return;
}state+="c";clearTimeout(timer);timer=$setTimeout(determineAction);};function determineAction(){clearTimeout(timer);
if(state=="e"||state=="c"||state.charAt(0)=="x"&&!state.match(/eb$/)||state=="ce"||state=="de"){if(last!="blur"){last="blur";
apf.window.dispatchEvent("blur");}}else{if(last!="focus"){last="focus";apf.window.dispatchEvent("focus");
}}state="";timer=null;}apf.addListener(window,"focus",this.$focusevent=function(){if(apf.isIphone){return apf.window.dispatchEvent("focus");
}if(apf.hasFocusBug){state+="d";clearTimeout(timer);timer=$setTimeout(determineAction);
}else{clearTimeout(iframeFixTimer);iframeFix.newState="focus";iframeFixTimer=$setTimeout(iframeFix,10);
}});apf.addListener(window,"blur",this.$blurevent=function(){if(!apf){return;}if(apf.isIphone){return apf.window.dispatchEvent("blur");
}if(apf.hasFocusBug){state+="e";clearTimeout(timer);timer=$setTimeout(determineAction);
}else{clearTimeout(iframeFixTimer);iframeFix.newState="blur";iframeFixTimer=$setTimeout(iframeFix,10);
}});var iframeFixTimer;function iframeFix(){clearTimeout(iframeFixTimer);var newState=iframeFix.newState;
if(last==newState){return;}last=newState;apf.dispatchEvent(last);}this.hasFocus=function(){return(last=="focus");
};apf.addListener(document,"contextmenu",function(e){if(!e){e=event;}var pos,ev,amlNode=apf.findHost(e.srcElement||e.target)||apf.document.activeElement||apf.document&&apf.document.documentElement;
if(amlNode&&amlNode.localName=="menu"){return false;}if(apf.contextMenuKeyboard){if(amlNode){pos=amlNode.selected?apf.getAbsolutePosition(amlNode.$selected):apf.getAbsolutePosition(amlNode.$ext||amlNode.$pHtmlNode);
}else{pos=[0,0];}ev={x:pos[0]+10+document.documentElement.scrollLeft,y:pos[1]+10+document.documentElement.scrollTop,amlNode:amlNode,htmlEvent:e};
}else{if(e.htmlEvent){ev=e;}else{ev={x:e.clientX+document.documentElement.scrollLeft,y:e.clientY+document.documentElement.scrollTop,htmlEvent:e};
}}ev.bubbles=true;apf.contextMenuKeyboard=null;if((amlNode||apf).dispatchEvent("contextmenu",ev)===false||ev.returnValue===false){if(e.preventDefault){e.preventDefault();
}return false;}if(apf.config.disableRightClick){if(e.preventDefault){e.preventDefault();
}return false;}});apf.addListener(document,"mouseup",function(e){if(!e){e=event;
}apf.dispatchEvent("mouseup",{htmlEvent:e});});var ta={INPUT:1,TEXTAREA:1,SELECT:1};
apf.addListener(document,"mousedown",this.$mousedown=function(e){if(!e){e=event;
}var p,amlNode=apf.findHost(e.srcElement||e.target);if(apf.popup.last&&(!amlNode||apf.popup.last!=amlNode.$uniqueId)&&apf.popup.cache[apf.popup.last]&&!apf.isChildOf(apf.popup.cache[apf.popup.last].content,e.srcElement||e.target,true)){apf.popup.forceHide();
}if(amlNode===false){amlNode=apf.document.activeElement;}if((!amlNode||((!amlNode.$focussable||amlNode.focussable===false)&&amlNode.canHaveChildren!=2&&!amlNode.$focusParent))&&apf.config.allowBlur){lastFocusParent=null;
if(apf.document.activeElement){apf.document.activeElement.blur();}}else{if(amlNode){if((p=apf.document.activeElement&&apf.document.activeElement.$focusParent||lastFocusParent)&&p.visible&&p.modal&&amlNode.$focusParent!=p&&amlNode.$isWindowContainer!=-1){apf.window.$focusLast(p,{mouse:true,ctrlKey:e.ctrlKey});
}else{if(!amlNode&&apf.document.activeElement){apf.window.$focusRoot();}else{if(amlNode.$isWindowContainer==-1){if(amlNode.$tabList.length){apf.window.moveNext(null,amlNode.$tabList[0],null,{mouse:true,innerList:true});
}else{apf.window.$focus(amlNode);}}else{if((amlNode.disabled==undefined||amlNode.disabled<1)&&amlNode.focussable!==false){if(amlNode.$focussable){apf.window.$focus(amlNode,{mouse:true,ctrlKey:e.ctrlKey});
}else{if(amlNode.canHaveChildren==2){if(!apf.config.allowBlur||!apf.document.activeElement||apf.document.activeElement.$focusParent!=amlNode){apf.window.$focusLast(amlNode,{mouse:true,ctrlKey:e.ctrlKey});
}}else{if(!apf.config.allowBlur||amlNode!=apf.document.documentElement){apf.window.$focusDefault(amlNode,{mouse:true,ctrlKey:e.ctrlKey});
}}}}else{apf.window.$focusDefault(amlNode,{mouse:true,ctrlKey:e.ctrlKey});}}}}if(apf.hasFocusBug){var isTextInput=(ta[e.srcElement.tagName]||e.srcElement.isContentEditable)&&!e.srcElement.disabled||amlNode.$isTextInput&&amlNode.$isTextInput(e)&&amlNode.disabled<1;
if(!amlNode||!isTextInput){apf.window.$focusfix();}}else{if(!last){apf.window.$focusevent();
}}}}apf.dispatchEvent("mousedown",{htmlEvent:e,amlNode:amlNode||apf.document.documentElement});
if(apf.isIE||apf.isIphone){return;}var canSelect=!((!apf.document&&(!apf.isParsingPartial||amlNode)||apf.dragMode)&&!ta[e.target.tagName]);
if(canSelect&&amlNode){if(!e.target&&e.srcElement){e.target={};}var isTextInput=(ta[e.target.tagName]||e.target.contentEditable=="true")&&!e.target.disabled||amlNode.$isTextInput&&amlNode.$isTextInput(e)&&amlNode.disabled<1;
if(!apf.config.allowSelect&&!isTextInput&&amlNode.nodeType!=amlNode.NODE_PROCESSING_INSTRUCTION&&!amlNode.textselect){canSelect=false;
}}if(!canSelect&&e.button!=2){if(e.preventDefault){e.preventDefault();}try{if(document.activeElement&&document.activeElement.contentEditable=="true"){document.activeElement.blur();
}}catch(e){}}});apf.addListener(document,"selectstart",function(e){if(!e){e=event;
}var amlNode=apf.findHost(e.srcElement);var canSelect=!(!apf.document&&(!apf.isParsingPartial||amlNode)||apf.dragMode);
if(canSelect){if(!apf.config.allowSelect&&(amlNode&&amlNode.nodeType!=amlNode.NODE_PROCESSING_INSTRUCTION&&!amlNode.textselect)){canSelect=false;
}}if(!canSelect){e.returnValue=false;return false;}});apf.addListener(document,"keyup",this.$keyup=function(e){if(!e){e=event;
}var ev={keyCode:e.keyCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altkey,htmlEvent:e,bubbles:true};
var aEl=apf.document&&apf.document.activeElement;if((aEl&&!aEl.disableKeyboard?aEl.dispatchEvent("keyup",ev):apf.dispatchEvent("keyup",ev))===false){apf.preventDefault(e);
return false;}});var wheel=this.$mousewheel=function wheel(e){if(!e){e=event;}var delta=null;
if(e.wheelDelta){delta=e.wheelDelta/120;if(apf.isOpera){delta*=-1;}}else{if(e.detail){delta=-e.detail/3;
}}if(delta!==null){if(apf.isIE){var el=e.srcElement||e.target;while(el&&el.scrollHeight<=el.offsetHeight){el=el.parentNode||el.$parentNode;
}if(el&&el.nodeType==9){el=el.documentElement;}if(!el||el.nodeType!=1){return;}if(el&&el.tagName=="BODY"&&"auto|scroll".indexOf(apf.getStyle(el,"overflowY"))==-1){el=document.documentElement;
}if(el&&"auto|scroll".indexOf(apf.getStyle(el,"overflowY"))>-1){var max,dist=0.35*el.offsetHeight*delta;
if(delta<0){if(el&&el.scrollTop>=(max=el.scrollHeight-el.offsetHeight+apf.getVerBorders(el))+dist){el.scrollTop=max;
e.returnValue=false;}}else{if(el&&el.scrollTop<=dist){el.scrollTop=0;e.returnValue=false;
}}}}var ev={delta:delta,target:e.target||e.srcElement,button:e.button,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,bubbles:true,htmlEvent:e};
var amlNode=apf.findHost(e.srcElement||e.target);var res=(amlNode||apf).dispatchEvent("mousescroll",ev);
if(res===false||ev.returnValue===false){if(e.preventDefault){e.preventDefault();
}e.returnValue=false;}}};if(document.addEventListener){document.addEventListener("DOMMouseScroll",wheel,false);
}window.onmousewheel=document.onmousewheel=wheel;apf.addListener(document,"keyup",function(e){e=e||event;
if(e.ctrlKey&&e.keyCode==9&&apf.document.activeElement){var w=apf.document.activeElement.$focusParent;
if(w.modal){if(e.preventDefault){e.preventDefault();}return false;}apf.window.moveNext(e.shiftKey,apf.document.activeElement.$focusParent,true);
w=apf.document.activeElement.$focusParent;if(w&&w.bringToFront){w.bringToFront();
}if(e.preventDefault){e.preventDefault();}return false;}});apf.addListener(document,"keydown",this.$keydown=function(e){e=e||event;
if(e.keyCode==93){apf.contextMenuKeyboard=true;}var amlNode=apf.document.activeElement,htmlNode=(e.explicitOriginalTarget||e.srcElement||e.target),isTextInput=(ta[htmlNode.tagName]||htmlNode.contentEditable||htmlNode.contentEditable=="true")&&!htmlNode.disabled||amlNode&&amlNode.$isTextInput&&amlNode.$isTextInput(e)&&amlNode.disabled<1;
var o,ctrlKey=apf.isMac?e.metaKey:e.ctrlKey;if(!isTextInput&&apf.config.undokeys&&ctrlKey){if(e.keyCode==90){o=apf.document.activeElement;
while(o&&!o.getActionTracker&&!o.$at){o=o.parentNode;}if(!o){o=apf.window;}(o.$at||o.getActionTracker()).undo();
}else{if(e.keyCode==89){o=apf.document.activeElement;while(o&&!o.getActionTracker&&!o.$at){o=o.parentNode;
}if(!o){o=apf.window;}(o.$at||o.getActionTracker()).redo();}}}var eInfo={ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,keyCode:e.keyCode,htmlEvent:e,isTextInput:isTextInput,bubbles:true};
delete eInfo.currentTarget;var aEl=amlNode;if((aEl&&!aEl.disableKeyboard&&!aEl.editable?aEl.dispatchEvent("keydown",eInfo):apf.dispatchEvent("keydown",eInfo))===false){apf.stopEvent(e);
if(apf.canDisableKeyCodes){try{e.keyCode=0;}catch(e){}}return false;}else{if((!apf.config.disableTabbing||apf.document.activeElement)&&e.keyCode==9){if(e.ctrlKey&&apf.document.activeElement){var w=apf.document.activeElement.$focusParent;
if(w.modal){if(e.preventDefault){e.preventDefault();}return false;}apf.window.moveNext(e.shiftKey,apf.document.activeElement.$focusParent,true);
w=apf.document.activeElement.$focusParent;if(w&&w.bringToFront){w.bringToFront();
}}else{if(!apf.document.activeElement||apf.document.activeElement.tagName!="menu"){apf.window.moveNext(e.shiftKey);
}}if(e.preventDefault){e.preventDefault();}return false;}}var altKey=apf.isMac?e.metaKey:e.altKey;
if(apf.config.disableBackspace&&e.keyCode==8&&!isTextInput){if(apf.canDisableKeyCodes){try{e.keyCode=0;
}catch(e){}}e.returnValue=false;}if(apf.config.disableF5&&(e.keyCode==116||e.keyCode==117)){if(apf.canDisableKeyCodes){try{e.keyCode=0;
}catch(e){}}else{e.preventDefault();e.stopPropagation();}}if(e.keyCode==27){e.returnValue=false;
}if(!apf.config.allowSelect&&e.shiftKey&&(e.keyCode>32&&e.keyCode<41)&&!isTextInput){e.returnValue=false;
}if(e.returnValue===false&&e.preventDefault){e.preventDefault();}return e.returnValue;
});apf.document={};this.init=function(strAml){if(apf.actiontracker){this.$at=new apf.actiontracker();
this.$at.name="default";apf.nameserver.register("actiontracker","default",this.$at);
}this.undoManager=new apf.actiontracker();apf.console.info("Start parsing main application");
apf.Latometer.start();this.$domParser=new apf.DOMParser();this.document=apf.document=this.$domParser.parseFromString(strAml,"text/xml",{timeout:apf.config.initdelay,callback:function(doc){if(apf.parsed!=2){var inital=apf.parsed;
apf.parsed=2;apf.dispatchEvent("parse",{initial:inital});apf.parsed=true;}if(!apf.loaded){if(apf.isDeskrun){apf.window.deskrun.Show();
}if(!apf.document.activeElement&&(!apf.config.allowBlur||apf.document.documentElement&&apf.document.documentElement.editable)){apf.window.focusDefault();
}apf.loaded=true;$setTimeout(function(){apf.dispatchEvent("load");apf.addEventListener("$event.load",function(cb){cb();
});});}apf.console.info("Initialization finished");apf.Latometer.end();apf.Latometer.addPoint("Total load time");
apf.Latometer.start(true);}});};var lastFocusElement;this.addEventListener("focus",function(e){if(!apf.document.activeElement&&lastFocusParent&&!apf.isIphone){lastFocusElement.focus();
}});this.addEventListener("blur",function(e){if(!apf.document.activeElement||apf.isIphone){return;
}apf.document.activeElement.blur(true,{srcElement:this});lastFocusParent=apf.document.activeElement.$focusParent;
lastFocusElement=apf.document.activeElement;apf.activeElement=apf.document.activeElement=null;
});this.getLastActiveElement=function(){return apf.activeElement||lastFocusElement;
};this.destroy=function(){this.$at=null;apf.unload(this);apf=this.win=this.window=this.document=null;
window.onfocus=window.onerror=window.onunload=window.onbeforeunload=window.onbeforeprint=window.onafterprint=window.onmousewheel=window.onblur=null;
document.oncontextmenu=document.onmousedown=document.onmousemove=document.onmouseup=document.onmousewheel=document.onkeyup=document.onkeydown=null;
if(document.body){document.body.onmousedown=document.body.onmousemove=document.body.onmouseup=null;
document.body.innerHTML="";}};};apf.window.prototype=new apf.Class().$init();apf.window=new apf.window();
apf.sanitizeTextbox=function(oTxt){if(!apf.hasFocusBug){return;}oTxt.onfocus=function(){if(apf.window){apf.window.$focusfix2();
}};oTxt.onblur=function(){if(apf.window){apf.window.$blurfix();}};};apf.initGears=function(){var factory,results;
var gearsObj=apf.nameserver.get("google","gears");if(gearsObj){return gearsObj;
}if(typeof GearsFactory!="undefined"){factory=new GearsFactory();}else{if(apf.isIE){try{factory=new ActiveXObject("Gears.Factory");
}catch(e){}}else{if(navigator.mimeTypes["application/x-googlegears"]){factory=document.createElement("object");
factory.setAttribute("type","application/x-googlegears");factory.setAttribute("width",0);
factory.setAttribute("height",0);factory.style.display="none";document.documentElement.appendChild(factory);
}}}if(!factory){return null;}return apf.nameserver.register("google","gears",factory);
};apf.runGecko=function(){if(apf.runNonIe){apf.runNonIe();}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(sExpr,contextNode){try{var oResult=this.evaluate(sExpr,(contextNode||this),this.createNSResolver(this.documentElement),7,null);
}catch(ex){var msg=ex.message;if(ex.code==ex.INVALID_EXPRESSION_ERR){msg=msg.replace(/the expression/i,"'"+sExpr+"'");
}throw new Error(ex.lineNumber,"XPath error: "+msg);}var nodeList=new Array(oResult.snapshotLength);
nodeList.expr=sExpr;for(var i=nodeList.length-1;i>=0;i--){nodeList[i]=oResult.snapshotItem(i);
}return nodeList;};Text.prototype.selectNodes=Attr.prototype.selectNodes=Element.prototype.selectNodes=function(sExpr){return this.ownerDocument.selectNodes(sExpr,this);
};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){try{var oResult=this.evaluate(sExpr,(contextNode||this),this.createNSResolver(this.documentElement),9,null);
}catch(ex){var msg=ex.message;if(ex.code==ex.INVALID_EXPRESSION_ERR){msg=msg.replace(/the expression/i,"'"+sExpr+"'");
}throw new Error(ex.lineNumber,"XPath error: "+msg);}return oResult.singleNodeValue;
};Text.prototype.selectSingleNode=Attr.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(sExpr){return this.ownerDocument.selectSingleNode(sExpr,this);
};var serializer=new XMLSerializer();var o=document.createElement("div");apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var frag,l,node,i;
if(nodeList){frag=document.createDocumentFragment();for(i=nodeList.length-1;i>=0;
i--){node=nodeList[i];frag.insertBefore(node,frag.firstChild);}}o.innerHTML=typeof s=="string"?s:apf.html_entity_decode(serializer.serializeToString(frag)).replace(/<([^>]+)\/>/g,"<$1></$1>");
frag=document.createDocumentFragment();for(i=0,l=o.childNodes.length;i<l;i++){node=o.childNodes[0];
frag.appendChild(node);}if(beforeNode){htmlNode.insertBefore(frag,beforeNode);}htmlNode.appendChild(frag);
};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,s){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}if(!s){s=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):((xmlNode.nodeType==3||xmlNode.nodeType==4||xmlNode.nodeType==2)?xmlNode.nodeValue:serializer.serializeToString(xmlNode)));
}o.innerHTML=s.replace(/<([^>]+)\/>/g,"<$1></$1>");if(beforeNode){htmlNode.insertBefore(o.firstChild,beforeNode);
}else{htmlNode.appendChild(o.firstChild);}return beforeNode?beforeNode.previousSibling:htmlNode.lastChild;
};function Error(nr,msg){if(!apf.$debugwin.nativedebug){apf.$debugwin.errorHandler(msg,"",0);
}this.message=msg;this.nr=nr;}apf.getHtmlLeft=function(oHtml){return(oHtml.offsetLeft+(parseInt(apf.getStyle(oHtml.parentNode,"borderLeftWidth"))||0));
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(2*(parseInt(apf.getStyle(p,"borderLeftWidth"))||0))-(parseInt(apf.getStyle(p,"borderRightWidth"))||0));
};apf.getHtmlTop=function(oHtml){return(oHtml.offsetTop+(parseInt(apf.getStyle(oHtml.parentNode,"borderTopWidth"))||0));
};apf.getHtmlBottom=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(2*(parseInt(apf.getStyle(p,"borderTopWidth"))||0))-(parseInt(apf.getStyle(p,"borderBottomWidth"))||0));
};apf.getBorderOffset=function(oHtml){return[-1*(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0),-1*(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)];
};};apf.runIE=function(){var hasIE7Security=false,hasIESecurity=false;if(self.XMLHttpRequest){try{new XMLHttpRequest();
}catch(e){hasIE7Security=true;}}try{new ActiveXObject("microsoft.XMLHTTP");}catch(e){hasIESecurity=true;
}if(hasIESecurity){apf.importClass(runTpIframe,true,self);}apf.getHttpReq=hasIESecurity?function(){if(apf.availHTTP.length){return apf.availHTTP.pop();
}return new XMLHttpRequest();}:function(){if(apf.availHTTP.length){return apf.availHTTP.pop();
}return new ActiveXObject("microsoft.XMLHTTP");};apf.getXmlDom=hasIESecurity?function(message,noError){var xmlParser=getDOMParser(message,noError);
return xmlParser;}:function(message,noError,preserveWhiteSpaces){var xmlParser=new ActiveXObject("microsoft.XMLDOM");
xmlParser.setProperty("SelectionLanguage","XPath");if(preserveWhiteSpaces){xmlParser.preserveWhiteSpace=true;
}if(message){if(apf.cantParseXmlDefinition){message=message.replace(/\] \]/g,"] ]").replace(/^<\?[^>]*\?>/,"");
}xmlParser.loadXML(message);if(xmlParser.parseError!=0&&apf.xmldb&&apf.isJson(message)){try{xmlParser=apf.json2Xml(message,noError);
}catch(e){throw new Error(apf.formatErrorString(1051,null,"JSON to XML conversion error occurred."+e.message,"\nSource Text : "+message.replace(/\t/gi," ")));
}}else{if(!noError){this.xmlParseError(xmlParser);}}}return xmlParser;};apf.xmlParseError=function(xml){var xmlParseError=xml.parseError;
if(xmlParseError!=0){throw new Error(apf.formatErrorString(1050,null,"XML Parse error on line "+xmlParseError.line,xmlParseError.reason+"Source Text:\n"+xmlParseError.srcText.replace(/\t/gi," ")));
}return xml;};apf.getStyle=function(el,prop){return el.currentStyle[prop];};apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var str;
if(nodeList){for(str=[],i=0,l=nodeList.length;i<l;i++){str[i]=nodeList[i].xml;}}str=s||apf.html_entity_decode(str.join(""));
if(apf.isIE<7){str=str.replace(/style="background-image:([^"]*)"/g,"find='$1' style='background-image:$1'");
}try{(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",str);
}catch(e){document.body.insertAdjacentHTML("beforeend","<table><tr>"+str+"</tr></table>");
var x=document.body.lastChild.firstChild.firstChild;for(i=x.childNodes.length-1;
i>=0;i--){htmlNode.appendChild(x.childNodes[apf.hasDynamicItemList?0:i]);}}if(apf.isIE<7){$setTimeout(function(){var nodes=htmlNode.getElementsByTagName("*");
for(var s,i=0,l=nodes.length;i<l;i++){if(s=nodes[i].getAttribute("find")){nodes[i].style.backgroundImage=s.trim();
}}});}};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,str){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}var pNode=beforeNode||htmlNode;if(!str){str=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):xmlNode.xml||xmlNode.outerHTML||xmlNode.nodeValue);
}try{pNode.insertAdjacentHTML(beforeNode?"beforeBegin":"beforeEnd",str);}catch(e){apf.console.warn("Warning found block element inside a "+pNode.tagName+" element. Rendering will give unexpected results");
pNode.insertAdjacentHTML("afterEnd",str);return pNode.nextSibling;}if(beforeNode){return beforeNode.previousSibling;
}else{return htmlNode.lastChild.nodeType==1?htmlNode.lastChild:htmlNode.lastChild.previousSibling;
}};apf.getHtmlLeft=function(oHtml){return(oHtml.offsetLeft-(apf.isIE>7&&parseInt(oHtml.parentNode.currentStyle.borderLeftWidth)||0));
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(apf.isIE<8&&parseInt(p.currentStyle.borderLeftWidth)||0)-(parseInt(p.currentStyle.borderRightWidth)||0));
};apf.getHtmlTop=function(oHtml){return(oHtml.offsetTop-(apf.isIE>7&&parseInt(oHtml.offsetParent.currentStyle.borderTopWidth)||0));
};apf.getHtmlBottom=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(apf.isIE<8&&parseInt(p.currentStyle.borderTopWidth)||0)-(parseInt(p.currentStyle.borderBottomidth)||0));
};apf.getBorderOffset=function(oHtml){return apf.isIE<8&&[0,0]||[parseInt(oHtml.currentStyle.borderLeftWidth)||0,parseInt(oHtml.currentStyle.borderTopWidth)||0];
};apf.getOpacity=function(oHtml){return parseInt(((oHtml.currentStyle.filter||"").match(/alpha\(opacity=(\d*)\)/)||[0,0])[1])/100;
};apf.setOpacity=function(oHtml,value){oHtml.style.filter=value==1?"":"alpha(opacity="+Math.round(value*100)+")";
};apf.popup2={cache:{},setContent:function(cacheId,content,style,width,height){if(!this.popup){this.init();
}this.cache[cacheId]={content:content,style:style,width:width,height:height};if(content.parentNode){content.parentNode.removeChild(content);
}if(style){apf.importCssString(style,this.popup.document);}return this.popup.document;
},removeContent:function(cacheId){this.cache[cacheId]=null;delete this.cache[cacheId];
},init:function(){this.popup=window.createPopup();this.popup.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml" xmlns:a='+apf.ns.aml+' xmlns:xsl="http://www.w3.org/1999/XSL/Transform">                <head>                    <script>                    var apf = {                        all: [],                        lookup:function(uniqueId){                            return this.all[uniqueId] || {                                $setStyleClass:function(){}                            };                        }                    };                    function destroy(){                        apf.all=null;                    }                    <\/script>                    <style>                    HTML{border:0;overflow:hidden;margin:0}                    BODY{margin:0}                    </style>                </head>                <body onmouseover="if(!self.apf) return;if(this.c){apf.all = this.c.all;this.c.Popup.parentDoc=self;}"></body>                </html>');
var c=apf;this.popup.document.body.onmousemove=function(){this.c=c;};},show:function(cacheId,x,y,animate,ref,width,height,callback){if(!this.popup){this.init();
}var o=this.cache[cacheId];this.popup.document.body.innerHTML=o.content.outerHTML;
if(animate){var iVal,steps=7,i=0,popup=this.popup;iVal=setInterval(function(){var value=++i*((height||o.height)/steps);
popup.show(x,y,width||o.width,value,ref);popup.document.body.firstChild.style.marginTop=(i-steps-1)*((height||o.height)/steps);
if(i>steps){clearInterval(iVal);callback(popup.document.body.firstChild);}},10);
}else{this.popup.show(x,y,width||o.width,height||o.height,ref);}this.last=cacheId;
},hide:function(){if(this.popup){this.popup.hide();}},forceHide:function(){if(this.last){apf.lookup(this.last).dispatchEvent("popuphide");
}},destroy:function(){if(!this.popup){return;}this.popup.document.body.c=null;this.popup.document.body.onmouseover=null;
}};apf.importClass(apf.runXpath,true,self);};apf.runIphone=function(){if(!apf.isIphone){return;
}$setTimeout(function(){apf.importCssString('html, body {                margin: 0;                font-family: Helvetica;                background: #fff;                color: #000000;                overflow-x: hidden;                -webkit-user-select: none;                -webkit-text-size-adjust: none;                -webkit-touch-callout: none;            }            body > *:not(.toolbar) {                min-height: 372px;            }            body[orient="landscape"] > *:not(.toolbar) {                min-height: 268px;            }            body > *[selected="true"] {                display: block;            }',"screen");
var head=document.getElementsByTagName("head")[0];if(apf.config.iphoneIcon){var link=document.createElement("link");
link.setAttribute("rel","apple-touch-icon"+(apf.config.iphoneIconIsGlossy?"":"-precomposed"));
link.setAttribute("href","apf.config.iphoneIcon");head.appendChild(link);}function appendMeta(name,content){var meta=document.createElement("meta");
meta.setAttribute("name",name);meta.setAttribute("content",content);head.appendChild(meta);
}if(apf.config.iphoneFixedViewport){appendMeta("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;");
}if(apf.config.iphoneFullScreen){appendMeta("apple-mobile-web-app-capable","yes");
if(apf.config.iphoneStatusBar){appendMeta("apple-mobile-web-app-status-bar-style","apf.config.iphoneStatusBar");
}}});var hasOrientationEvent=false,currentWidth=0,portraitVal="portrait",landscapeVal="landscape",checkTimer=null;
apf.addDomLoadEvent(function(){$setTimeout(checkOrientAndLocation,0);checkTimer=setInterval(checkOrientAndLocation,300);
});function orientChangeHandler(){switch(window.orientation){case 0:setOrientation(portraitVal);
break;case 90:case -90:setOrientation(landscapeVal);break;}}if(typeof window.onorientationchange=="object"){window.onorientationchange=orientChangeHandler;
hasOrientationEvent=true;$setTimeout(orientChangeHandler,0);}function checkOrientAndLocation(){if(!hasOrientationEvent){if(window.innerWidth!=currentWidth){currentWidth=window.innerWidth;
var orient=currentWidth==320?portraitVal:landscapeVal;setOrientation(orient);}}}function setOrientation(orient){document.body.setAttribute("orient",orient);
$setTimeout("scrollTo(0,1)",100);}["gesturestart","gesturechange","gestureend","orientationchange"].forEach(function(type){document["on"+type]=function(evt){if(apf.dispatchEvent){apf.dispatchEvent(type,evt);
}};});apf.iphone={titleNode:null,linkEvents:function(el,bClick){return;el[bClick?"onclick":"ontouchstart"]=function(evt){if(!evt.touches||evt.touches.length!=1){return;
}var e=evt.touches[0];if(typeof this.onmousedown=="function"){this.onmousedown(e);
if(this!=document){return false;}}};el.ontouchmove=function(evt){if(!evt.touches||evt.touches.length!=1){return;
}var e=evt.touches[0];if(typeof this.onmousemove=="function"){this.onmousemove(e);
if(this!=document){return false;}}};var _touching=false;el.ontouchend=el.ontouchcancel=function(evt){if(_touching){return;
}var e=evt.touches&&evt.touches.length?evt.touches[0]:evt.changedTouches[0];if(!e){return;
}_touching=true;$setTimeout(function(){_touching=false;});if(typeof this.onmouseup=="function"){this.onmouseup(e);
if(this!=document){return false;}}};return this;},nav:{sections:null,active:null,def:"home",divideChar:"/",levelTwoChar:"-",go:function(where,noanim){var i,p,_self=apf.iphone.nav;
_self.update();if(!(p=_self.sections[where.page])){return;}scrollTo(0,1);apf.dispatchEvent("pagechange",where);
var sTitle=p.getAttribute("title");if(apf.iphone.titleNode&&sTitle){apf.iphone.titleNode.innerHTML=sTitle;
}if(noanim){for(i in _self.sections){_self.sections[i].hide();}p.show();}else{for(i in _self.sections){if(!_self.sections[i].visible||i==where.page){continue;
}var section=_self.sections[i];section.setProperty("zindex",0);apf.tween.single(section.$ext,{steps:5,interval:10,from:section.$ext.offsetLeft,to:(where.index<0)?1000:-1000,type:"left",anim:apf.tween.EASEOUT,onfinish:function(){section.setProperty("visible",false);
}});}var pad=10,el=p.$ext,iFrom=(where.index<0)?-(el.offsetWidth)-pad:window.innerWidth+el.offsetLeft+pad;
p.setProperty("visible",true);p.setProperty("zindex",apf.all.length+1);apf.tween.single(el,{steps:5,interval:10,from:iFrom,to:0,type:"left",anim:apf.tween.EASEIN});
}},update:function(force){if(this.sections&&!force){return;}this.sections={};for(var i in window){if(window[i]&&window[i]["tagName"]&&window[i].tagName=="section"){this.sections[i]=window[i];
}}}}};$setTimeout(function(){apf.addEventListener("hashchange",apf.iphone.nav.go);
if(location.href.match(/#(.*)$/)){apf.history.init(decodeURI(RegExp.$1));}else{if(apf._GET.page){apf.history.init(apf._GET.page);
}else{apf.history.init();}}});document.ontouchstart=function(evt){if(!evt.touches||evt.touches.length!=1){return;
}var e=evt.touches[0],el=e.target,amlNode=apf.findHost(e.target);if(!amlNode){return;
}while(typeof el.onmousedown!="function"&&el!=document.body){el=el.parentNode;}if(typeof el.onmousedown=="function"){if(typeof el.onmouseover=="function"){el.onmouseover(e);
}else{if(typeof el.onmousemove=="function"){el.onmousemove(e);}}el.onmousedown(e);
return false;}};document.ontouchmove=function(evt){if(!evt.touches||evt.touches.length!=1){return;
}var e=evt.touches[0],el=e.target,amlNode=apf.findHost(e.target);if(!amlNode){return;
}while(typeof el.onmousemove!="function"&&el!=document.body){el=el.parentNode;}if(typeof el.onmousemove=="function"){el.onmousemove(e);
return false;}else{if(typeof document.onmousemove=="function"){return document.onmousemove(e);
}}};document.ontouchend=document.ontouchcancel=function(evt){var e=evt.touches&&evt.touches.length?evt.touches[0]:evt.changedTouches[0];
if(!e){return;}var el=e.target,amlNode=apf.findHost(e.target);if(!amlNode){return;
}while(typeof el.onmouseup!="function"&&el!=document.body){el=el.parentNode;}if(typeof el.onmouseup=="function"){if(typeof el.onmouseout=="function"){el.onmouseout(e);
}el.onmouseup(e,true);return false;}else{if(typeof document.onmouseup=="function"){return document.onmouseup(e);
}}};};apf.runNonIe=function(){DocumentFragment.prototype.getElementById=function(id){return this.childNodes.length?this.childNodes[0].ownerDocument.getElementById(id):null;
};if(XMLDocument.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);
});XMLDocument.prototype.__defineSetter__("xml",function(){throw new Error(apf.formatErrorString(1042,null,"XML serializer","Invalid assignment on read-only property 'xml'."));
});Node.prototype.__defineGetter__("xml",function(){if(this.nodeType==3||this.nodeType==4||this.nodeType==2){return this.nodeValue;
}return(new XMLSerializer()).serializeToString(this);});Element.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);
});}if(typeof HTMLElement!="undefined"){if(!HTMLElement.prototype.insertAdjacentElement){Text.prototype.insertAdjacentElement=HTMLElement.prototype.insertAdjacentElement=function(where,parsedNode){switch(where.toLowerCase()){case"beforebegin":this.parentNode.insertBefore(parsedNode,this);
break;case"afterbegin":this.insertBefore(parsedNode,this.firstChild);break;case"beforeend":this.appendChild(parsedNode);
break;case"afterend":if(this.nextSibling){this.parentNode.insertBefore(parsedNode,this.nextSibling);
}else{this.parentNode.appendChild(parsedNode);}break;}};}if(!HTMLElement.prototype.insertAdjacentHTML){Text.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML=function(where,htmlStr){var r=this.ownerDocument.createRange();
r.setStartBefore(apf.isWebkit?document.body:(self.document?document.body:this));
var parsedHTML=r.createContextualFragment(htmlStr);this.insertAdjacentElement(where,parsedHTML);
};}if(!HTMLBodyElement.prototype.insertAdjacentHTML){HTMLBodyElement.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML;
}if(!HTMLElement.prototype.insertAdjacentText){Text.prototype.insertAdjacentText=HTMLElement.prototype.insertAdjacentText=function(where,txtStr){var parsedText=document.createTextNode(txtStr);
this.insertAdjacentElement(where,parsedText);};}HTMLElement.prototype.removeNode=function(){if(!this.parentNode){return;
}this.parentNode.removeChild(this);};if(HTMLElement.prototype.__defineSetter__){HTMLElement.prototype.__defineSetter__("innerText",function(sText){var s=""+sText;
this.innerHTML=s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
});HTMLElement.prototype.__defineGetter__("innerText",function(){return this.innerHTML.replace(/<[^>]+>/g,"").replace(/\s\s+/g," ").replace(/^\s+|\s+$/g," ");
});HTMLElement.prototype.__defineGetter__("outerHTML",function(){return(new XMLSerializer()).serializeToString(this);
});}}var ASYNCNOTSUPPORTED=false;try{XMLDocument.prototype.async=true;ASYNCNOTSUPPORTED=true;
}catch(e){}Document.prototype.onreadystatechange=null;Document.prototype.parseError=0;
Array.prototype.item=function(i){return this[i];};Array.prototype.expr="";XMLDocument.prototype.$clearDOM=function(){while(this.hasChildNodes()){this.removeChild(this.firstChild);
}};XMLDocument.prototype.$copyDOM=function(oDoc){this.$clearDOM();if(oDoc.nodeType==9||oDoc.nodeType==11){var oNodes=oDoc.childNodes;
for(var i=0;i<oNodes.length;i++){this.appendChild(this.importNode(oNodes[i],true));
}}else{if(oDoc.nodeType==1){this.appendChild(this.importNode(oDoc,true));}}};XMLDocument.prototype.loadXML=function(strXML){apf.xmldb.setReadyState(this,1);
var sOldXML=this.xml||this.serialize();var oDoc=(new DOMParser()).parseFromString(strXML,"text/xml");
apf.xmldb.setReadyState(this,2);this.$copyDOM(oDoc);apf.xmldb.setReadyState(this,3);
apf.xmldb.loadHandler(this);return sOldXML;};Node.prototype.getElementById=function(id){};
HTMLElement.prototype.replaceNode=Element.prototype.replaceNode=function(xmlNode){if(!this.parentNode){return;
}this.parentNode.insertBefore(xmlNode,this);this.parentNode.removeChild(this);};
XMLDocument.prototype.$load=XMLDocument.prototype.load;XMLDocument.prototype.load=function(sURI){var oDoc=document.implementation.createDocument("","",null);
oDoc.$copyDOM(this);this.parseError=0;apf.xmldb.setReadyState(this,1);try{if(this.async==false&&ASYNCNOTSUPPORTED){var tmp=new XMLHttpRequest();
tmp.open("GET",sURI,false);tmp.overrideMimeType("text/xml");tmp.send(null);apf.xmldb.setReadyState(this,2);
this.$copyDOM(tmp.responseXML);apf.xmldb.setReadyState(this,3);}else{this.$load(sURI);
}}catch(objException){this.parseError=-1;}finally{apf.xmldb.loadHandler(this);}return oDoc;
};Element.prototype.transformNodeToObject=function(xslDoc,oResult){var oDoc=document.implementation.createDocument("","",null);
oDoc.$copyDOM(this);oDoc.transformNodeToObject(xslDoc,oResult);};Document.prototype.transformNodeToObject=function(xslDoc,oResult){var xsltProcessor=null;
try{xsltProcessor=new XSLTProcessor();if(xsltProcessor.reset){xslDoc=apf.getXmlDom(xslDoc.xml||xslDoc.serialize());
xsltProcessor.importStylesheet(xslDoc);var newFragment=xsltProcessor.transformToFragment(this,oResult);
oResult.$copyDOM(newFragment);}else{xsltProcessor.transformDocument(this,xslDoc,oResult,null);
}}catch(e){if(xslDoc&&oResult){throw new Error(apf.formatErrorString(1043,null,"XSLT Transformation","Failed to transform document. \nInfo : "+e));
}else{if(!xslDoc){throw new Error(apf.formatErrorString(1044,null,"XSLT Transformation","No Stylesheet Document was provided. \nInfo : "+e));
}else{if(!oResult){throw new Error(apf.formatErrorString(1045,null,"XSLT Transformation","No Result Document was provided. \nInfo : "+e));
}else{if(xsltProcessor==null){throw new Error(apf.formatErrorString(1046,null,"XSLT Transformation","Could not instantiate an XSLTProcessor object. \nInfo : "+e));
}else{throw e;}}}}}};Element.prototype.transformNode=function(xslDoc){return apf.getXmlDom(this.xml||this.serialize()).transformNode(xslDoc);
};Document.prototype.transformNode=function(xslDoc){var xsltProcessor=new XSLTProcessor();
xslDoc=apf.getXmlDom(xslDoc.xml||xslDoc.serialize());xsltProcessor.importStylesheet(xslDoc);
var newFragment=xsltProcessor.transformToFragment(this,document.implementation.createDocument("","",null));
return newFragment.xml||newFragment.serialize();};var getStyle=apf.getStyle=function(el,prop){try{return(window.getComputedStyle(el,"")||{})[prop]||"";
}catch(e){}};HTMLDocument.prototype.setProperty=XMLDocument.prototype.setProperty=function(x,y){};
apf.getHttpReq=function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();
};apf.getXmlDom=function(message,noError,preserveWhiteSpaces){var xmlParser;if(message){if(preserveWhiteSpaces===false){message=message.replace(/>[\s\n\r]*</g,"><");
}xmlParser=new DOMParser();xmlParser=xmlParser.parseFromString(message,"text/xml");
if(xmlParser.getElementsByTagName("parsererror").length&&apf.xmldb&&apf.isJson(message)){try{xmlParser=apf.json2Xml(message,noError);
}catch(e){throw new Error(apf.formatErrorString(1051,null,"JSON to XML conversion error occurred.","\nSource Text : "+message.replace(/\t/gi," ")));
}}else{if(!noError){this.xmlParseError(xmlParser);}}}else{xmlParser=document.implementation.createDocument("","",null);
}return xmlParser;};apf.xmlParseError=function(xml){if(xml.getElementsByTagName("parsererror").length){var nodeValue=xml.documentElement.firstChild.nodeValue;
if(nodeValue!=null){var str=nodeValue.split("\n"),linenr=str[2].match(/\w+ (\d+)/)[1],message=str[0].replace(/\w+ \w+ \w+: (.*)/,"$1");
}else{if(nodeValue=xml.documentElement.firstChild.getElementsByTagName("div")[0].firstChild.nodeValue){var linenr=nodeValue.match(/line\s(\d*)/)[1]||"N/A",message=nodeValue.match(/column\s\d*:(.*)/)[1]||"N/A";
}else{var linenr="N/A",message="N/A";}}var srcText=xml.documentElement.lastChild.firstChild,srcMsg="";
if(srcText&&srcText.nodeValue){srcMsg="\nSource Text : "+srcText.nodeValue.replace(/\t/gi," ");
}throw new Error(apf.formatErrorString(1050,null,"XML Parse Error on line "+linenr,message+srcMsg));
}return xml;};apf.xmldb.setReadyState=function(oDoc,iReadyState){oDoc.readyState=iReadyState;
if(oDoc.onreadystatechange!=null&&typeof oDoc.onreadystatechange=="function"){oDoc.onreadystatechange();
}};apf.xmldb.loadHandler=function(oDoc){if(!oDoc.documentElement||oDoc.documentElement.tagName=="parsererror"){oDoc.parseError=-1;
}apf.xmldb.setReadyState(oDoc,4);};apf.Init.add(function(){var i,nodes=document.getElementsByTagName("form");
for(i=0;i<nodes.length;i++){nodes[i].removeNode();}nodes=document.getElementsByTagName("xml");
for(i=0;i<nodes.length;i++){nodes[i].removeNode();}nodes=null;});if(document.body){document.body.focus=function(){};
}if(!document.elementFromPoint){Document.prototype.elementFromPointRemove=function(el){if(!this.RegElements){return;
}this.RegElements.remove(el);};Document.prototype.elementFromPointAdd=function(el){if(!this.RegElements){this.RegElements=[];
}this.RegElements.push(el);};Document.prototype.elementFromPointReset=function(RegElements){FoundValue=[];
FoundNode=null;LastFoundAbs=document.documentElement;};Document.prototype.elementFromPoint=function(x,y){document.elementFromPointReset();
if(this.RegElements){var calc_z=-1,i,calc,n,sx,sy,ex,ey,z;for(calc_z=-1,calc,i=0;
i<this.RegElements.length;i++){n=this.RegElements[i];if(getStyle(n,"display")=="none"){continue;
}sx=getElementPosX(n);sy=getElementPosY(n);ex=sx+n.offsetWidth;ey=sy+n.offsetHeight;
if(x>sx&&x<ex&&y>sy&&y<ey){z=getElementZindex(n);if(z>calc_z){calc=[n,x,y,sx,sy];
calc_z=z;}}}if(calc){efpi(calc[0],calc[1],calc[2],0,FoundValue,calc[3],calc[4]);
if(!FoundNode){FoundNode=calc[0];LastFoundAbs=calc[0];FoundValue=[calc_z];}}}if(!this.RegElements||!this.RegElements.length){efpi(document.body,x,y,0,[],getElementPosX(document.body),getElementPosY(document.body));
}return FoundNode;};function efpi(from,x,y,CurIndex,CurValue,px,py){var StartValue=CurValue,StartIndex=CurIndex,nodes=from.childNodes,n,i,z,sx,sy,ex,ey,isAbs,isHidden,inSpace;
for(n,i=0;i<from.childNodes.length;i++){n=from.childNodes[i];if(n.nodeType==1&&getStyle(n,"display")!="none"&&n.offsetParent){sx=px+n.offsetLeft-n.offsetParent.scrollLeft;
sy=py+n.offsetTop-n.offsetParent.scrollTop;ex=sx+n.offsetWidth;ey=sy+n.offsetHeight;
isAbs=getStyle(n,"position");isAbs=(isAbs=="absolute")||(isAbs=="relative");isHidden=getStyle(n,"overflow")=="hidden";
inSpace=(x>sx&&x<ex&&y>sy&&y<ey);if(isAbs&&isHidden&&!inSpace){continue;}CurIndex=StartIndex;
CurValue=StartValue.copy();z=parseInt(getStyle(n,"zIndex"))||0;if(isAbs&&(z||z==0)||isHidden){if(!isAbs){z=0;
}if(z>=(FoundValue[CurIndex]||0)){if(z>(CurValue[CurIndex]||0)){CurValue[CurIndex]=z;
}CurIndex++;if(inSpace&&CurIndex>=FoundValue.length){FoundNode=n;FoundValue=CurValue;
LastFoundAbs=n;}}else{continue;}}else{if(inSpace&&CurIndex>=FoundValue.length){FoundNode=n;
FoundValue=CurValue;}}efpi(n,x,y,CurIndex,CurValue,isAbs?sx:px,isAbs?sy:py);}}}function getElementPosY(myObj){return myObj.offsetTop+parseInt(apf.getStyle(myObj,"borderTopWidth"))+(myObj.offsetParent?getElementPosY(myObj.offsetParent):0);
}function getElementPosX(myObj){return myObj.offsetLeft+parseInt(apf.getStyle(myObj,"borderLeftWidth"))+(myObj.offsetParent?getElementPosX(myObj.offsetParent):0);
}function getElementZindex(myObj){var z=0,n,p=myObj;while(p&&p.nodeType==1){z=Math.max(z,parseInt(getStyle(p,"zIndex"))||-1);
p=p.parentNode;}return z;}}apf.getOpacity=function(oHtml){return apf.getStyle(oHtml,"opacity");
};apf.setOpacity=function(oHtml,value){oHtml.style.opacity=value;};};apf.runOpera=function(){if(apf.runNonIe){apf.runNonIe();
}Document.prototype.selectNodes=XMLDocument.prototype.selectNodes=HTMLDocument.prototype.selectNodes=function(sExpr,contextNode){var oResult=this.evaluate(sExpr,(contextNode?contextNode:this),this.createNSResolver(this.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
var nodeList=new Array(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=0;
i<nodeList.length;i++){nodeList[i]=oResult.snapshotItem(i);}return nodeList;};Text.prototype.selectNodes=Attr.prototype.selectNodes=Element.prototype.selectNodes=function(sExpr){var doc=this.ownerDocument;
if(!doc.selectSingleNode){doc.selectSingleNode=HTMLDocument.prototype.selectSingleNode;
doc.selectNodes=HTMLDocument.prototype.selectNodes;}if(doc.selectNodes){return doc.selectNodes(sExpr,this);
}else{throw new Error(apf.formatErrorString(1047,null,"XPath Selection","Method selectNodes is only supported by XML Nodes"));
}};Document.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=HTMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var nodeList=this.selectNodes(sExpr+"[1]",contextNode?contextNode:null);
return nodeList.length>0?nodeList[0]:null;};Text.prototype.selectSingleNode=Attr.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(sExpr){var doc=this.ownerDocument;
if(!doc.selectSingleNode){doc.selectSingleNode=HTMLDocument.prototype.selectSingleNode;
doc.selectNodes=HTMLDocument.prototype.selectNodes;}if(doc.selectSingleNode){return doc.selectSingleNode(sExpr,this);
}else{throw new Error(apf.formatErrorString(1048,null,"XPath Selection","Method selectSingleNode is only supported by XML Nodes. \nInfo : "+e));
}};var serializer=new XMLSerializer();apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var node,frag,i,l;
if(nodeList){frag=document.createDocumentFragment();i=0;l=nodeList.length;for(;
i<l;i++){if(!(node=nodeList[i])){continue;}frag.appendChild(node);}}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s||apf.html_entity_decode(serializer.serializeToString(frag)).replace(/<([^>]+)\/>/g,"<$1></$1>"));
};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,s){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}if(!s){s=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):((xmlNode.nodeType==3||xmlNode.nodeType==4||xmlNode.nodeType==2)?xmlNode.nodeValue:serializer.serializeToString(xmlNode)));
}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s.replace(/<([^>]+)\/>/g,"<$1></$1>"));
return beforeNode?beforeNode.previousSibling:htmlNode.lastChild;};apf.getHtmlLeft=function(oHtml){return(oHtml.offsetLeft-(parseInt(apf.getStyle(oHtml.parentNode,"borderLeftWidth"))||0));
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(parseInt(apf.getStyle(p,"borderRightWidth"))||0));
};apf.getHtmlTop=function(oHtml){return(oHtml.offsetTop-(parseInt(apf.getStyle(oHtml.offsetParent,"borderTopWidth"))||0));
};apf.getHtmlBottom=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(parseInt(apf.getStyle(p,"borderBottomWidth"))||0));
};apf.getBorderOffset=function(oHtml){return[parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0,parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0];
};};apf.runWebkit=function(){if(!apf.isChrome){var setTimeoutSafari=window.setTimeout;
self.lookupSafariCall=[];$setTimeout=function(call,time){if(typeof call=="string"){return setTimeoutSafari(call,time);
}return setTimeoutSafari("self.lookupSafariCall["+(self.lookupSafariCall.push(call)-1)+"]()",time);
};if(apf.isSafariOld){HTMLHtmlElement=document.createElement("html").constructor;
Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.apf.__proto__.apf.__proto__;
HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;
Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;
x=null;}if(!XMLDocument.prototype.__defineGetter__){Document.prototype.serialize=Node.prototype.serialize=XMLDocument.prototype.serialize=function(){return(new XMLSerializer()).serializeToString(this);
};}}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(sExpr,contextNode){if(sExpr.substr(0,2)=="//"){sExpr="."+sExpr;
}try{var oResult=this.evaluate(sExpr,(contextNode||this),this.createNSResolver(this.documentElement),7,null);
}catch(ex){try{var oResult=this.evaluate("child::"+sExpr,(contextNode||this),this.createNSResolver(this.documentElement),7,null);
}catch(ex){throw new Error("XPath error: "+ex.message+"\nLine: "+ex.lineNumber+"\nExpression: '"+sExpr+"'");
}}var nodeList=new Array(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=nodeList.length-1;
i>=0;i--){nodeList[i]=oResult.snapshotItem(i);}return nodeList;};Text.prototype.selectNodes=Attr.prototype.selectNodes=Element.prototype.selectNodes=function(sExpr){return this.ownerDocument.selectNodes(sExpr,this);
};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var nodeList=this.selectNodes(sExpr,contextNode||null);
return nodeList[0]||null;};Text.prototype.selectSingleNode=Attr.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(sExpr){return this.ownerDocument.selectSingleNode(sExpr,this);
};var serializer=new XMLSerializer();apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var node,frag,a,i,l;
if(nodeList){frag=document.createDocumentFragment();a=[],i=0,l=nodeList.length;
for(;i<l;i++){if(!(node=nodeList[i])){continue;}frag.appendChild(node);}}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s||apf.html_entity_decode(serializer.serializeToString(frag)).replace(/<([^>]+)\/>/g,"<$1></$1>"));
};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,s){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}if(!s){s=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):((xmlNode.nodeType==3||xmlNode.nodeType==4||xmlNode.nodeType==2)?xmlNode.nodeValue:serializer.serializeToString(xmlNode)));
}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s.match(/<(IMG|LINK|META|BR|HR|BASEFONT)[^\/>]*/i)?s.replace(/<([^>]+)\/>/g,"<$1 />"):s.replace(/<([^>]+)\/>/g,"<$1></$1>"));
return beforeNode?beforeNode.previousSibling:htmlNode.lastChild;};apf.getHtmlLeft=function(oHtml){return oHtml.offsetLeft;
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(parseInt(apf.getStyle(p,"borderLeftWidth"))||0)-(parseInt(apf.getStyle(p,"borderRightWidth"))||0));
};apf.getHtmlTop=function(oHtml){return oHtml.offsetTop;};apf.getHtmlBottom=function(oHtml){var p;
return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(parseInt(apf.getStyle(p,"borderTopWidth"))||0)-(parseInt(apf.getStyle(p,"borderBottomWidth"))||0));
};apf.getBorderOffset=function(oHtml){return[0,0];};if(apf.runNonIe){apf.runNonIe();
}};apf.crypto.Barrett=function(){this.init.apply(this,arguments);};apf.crypto.Barrett.prototype={init:function(m){this.modulus=apf.crypto.BigInt.copy(m);
this.k=apf.crypto.BigInt.highIndex(this.modulus)+1;var b2k=new apf.crypto.BigInt.construct();
b2k.digits[2*this.k]=1;this.mu=apf.crypto.BigInt.divide(b2k,this.modulus);this.bkplus1=new apf.crypto.BigInt.construct();
this.bkplus1.digits[this.k+1]=1;},modulo:function(x){var q1=apf.crypto.BigInt.divideByRadixPower(x,this.k-1);
var q2=apf.crypto.BigInt.multiply(q1,this.mu);var q3=apf.crypto.BigInt.divideByRadixPower(q2,this.k+1);
var r1=apf.crypto.BigInt.moduloByRadixPower(x,this.k+1);var r2term=apf.crypto.BigInt.multiply(q3,this.modulus);
var r2=apf.crypto.BigInt.moduloByRadixPower(r2term,this.k+1);var r=apf.crypto.BigInt.subtract(r1,r2);
if(r.isNeg){r=apf.crypto.BigInt.add(r,this.bkplus1);}var rgtem=apf.crypto.BigInt.compare(r,this.modulus)>=0;
while(rgtem){r=apf.crypto.BigInt.subtract(r,this.modulus);rgtem=apf.crypto.BigInt.compare(r,this.modulus)>=0;
}return r;},multiplyMod:function(x,y){var xy=apf.crypto.BigInt.multiply(x,y);return this.modulo(xy);
},powMod:function(x,y){var result=new apf.crypto.BigInt.construct();result.digits[0]=1;
var a=x;var k=y;while(true){if((k.digits[0]&1)!=0){result=this.multiplyMod(result,a);
}k=apf.crypto.BigInt.shiftRight(k,1);if(k.digits[0]==0&&apf.crypto.BigInt.highIndex(k)==0){break;
}a=this.multiplyMod(a,a);}return result;}};apf.crypto.Base64=(function(){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
function encode(data){var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];
if(!data){return data;}data=apf.crypto.UTF8.encode(data+"");do{o1=data.charCodeAt(i++);
o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;
h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);
}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";
break;case 2:enc=enc.slice(0,-1)+"=";break;}return enc;}function decode(data){var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,tmp_arr=[];
if(!data){return data;}data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));
h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;
o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);
}else{if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);
}}}while(i<data.length);return apf.crypto.UTF8.decode(tmp_arr.join(""));}return{decode:decode,encode:encode};
})();apf.crypto.UTF8={encode:function(string){string=(string+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");
var tmp_arr=[],start=0,end=0,c1,enc;for(var n=0,l=string.length;n<l;n++){c1=string.charCodeAt(n);
enc=null;if(c1<128){end++;}else{if((c1>127)&&(c1<2048)){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128);
}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128);
}}if(enc!==null){if(end>start){tmp_arr.push(string.substring(start,end));}tmp_arr.push(enc);
start=end=n+1;}}if(end>start){tmp_arr.push(string.substring(start,string.length));
}return tmp_arr.join("");},decode:function(str_data){var tmp_arr=[],i=0,ac=0,c1=0,c2=0,c3=0;
str_data+="";while(i<str_data.length){c1=str_data.charCodeAt(i);if(c1<128){tmp_arr[ac++]=String.fromCharCode(c1);
i++;}else{if((c1>191)&&(c1<224)){c2=str_data.charCodeAt(i+1);tmp_arr[ac++]=String.fromCharCode(((c1&31)<<6)|(c2&63));
i+=2;}else{c2=str_data.charCodeAt(i+1);c3=str_data.charCodeAt(i+2);tmp_arr[ac++]=String.fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));
i+=3;}}}return tmp_arr.join("");}};apf.crypto.BigInt=(function(){var biRadixBase=2;
var biRadixBits=16;var bitsPerDigit=biRadixBits;var biRadix=1<<16;var biHalfRadix=biRadix>>>1;
var biRadixSquared=biRadix*biRadix;var maxDigitVal=biRadix-1;var maxInteger=9999999999999998;
var maxDigits;var ZERO_ARRAY;var bigZero,bigOne;function setMaxDigits(value){maxDigits=value;
ZERO_ARRAY=new Array(maxDigits);for(var iza=0;iza<ZERO_ARRAY.length;iza++){ZERO_ARRAY[iza]=0;
}bigZero=new BigInt();bigOne=new BigInt();bigOne.digits[0]=1;}setMaxDigits(20);
var dpl10=15;var lr10=biFromNumber(1000000000000000);function BigInt(flag){if(typeof flag=="boolean"&&flag==true){this.digits=null;
}else{this.digits=ZERO_ARRAY.slice(0);}this.isNeg=false;}function biFromDecimal(s){var isNeg=s.charAt(0)=="-";
var i=isNeg?1:0;var result;while(i<s.length&&s.charAt(i)=="0"){++i;}if(i==s.length){result=new BigInt();
}else{var digitCount=s.length-i;var fgl=digitCount%dpl10;if(fgl==0){fgl=dpl10;}result=biFromNumber(Number(s.substr(i,fgl)));
i+=fgl;while(i<s.length){result=biAdd(biMultiply(result,lr10),biFromNumber(Number(s.substr(i,dpl10))));
i+=dpl10;}result.isNeg=isNeg;}return result;}function biCopy(bi){var result=new BigInt(true);
result.digits=bi.digits.slice(0);result.isNeg=bi.isNeg;return result;}function biFromNumber(i){var result=new BigInt();
result.isNeg=i<0;i=Math.abs(i);var j=0;while(i>0){result.digits[j++]=i&maxDigitVal;
i=Math.floor(i/biRadix);}return result;}function reverseStr(s){var result="";for(var i=s.length-1;
i>-1;--i){result+=s.charAt(i);}return result;}var hexatrigesimalToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");
function biToString(x,radix){var b=new BigInt();b.digits[0]=radix;var digit,qr=biDivideModulo(x,b),result=hexatrigesimalToChar[qr[1].digits[0]];
while(biCompare(qr[0],bigZero)==1){qr=biDivideModulo(qr[0],b);digit=qr[1].digits[0];
result+=hexatrigesimalToChar[qr[1].digits[0]];}return(x.isNeg?"-":"")+reverseStr(result);
}function biToDecimal(x){var b=new BigInt();b.digits[0]=10;var qr=biDivideModulo(x,b);
var result=String(qr[1].digits[0]);while(biCompare(qr[0],bigZero)==1){qr=biDivideModulo(qr[0],b);
result+=String(qr[1].digits[0]);}return(x.isNeg?"-":"")+reverseStr(result);}var hexToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");
function digitToHex(n){var i,mask=15,result="";for(i=0;i<4;++i){result+=hexToChar[n&mask];
n>>>=4;}return reverseStr(result);}function biToHex(x){var result="";var n=biHighIndex(x);
for(var i=biHighIndex(x);i>-1;--i){result+=digitToHex(x.digits[i]);}return result;
}function charToHex(c){var ZERO=48;var NINE=ZERO+9;var littleA=97;var littleZ=littleA+25;
var bigA=65;var bigZ=65+25;var result;if(c>=ZERO&&c<=NINE){result=c-ZERO;}else{if(c>=bigA&&c<=bigZ){result=10+c-bigA;
}else{if(c>=littleA&&c<=littleZ){result=10+c-littleA;}else{result=0;}}}return result;
}function hexToDigit(s){var result=0;var sl=Math.min(s.length,4);for(var i=0;i<sl;
++i){result<<=4;result|=charToHex(s.charCodeAt(i));}return result;}function biFromHex(s){var result=new BigInt();
var sl=s.length;for(var i=sl,j=0;i>0;i-=4,++j){result.digits[j]=hexToDigit(s.substr(Math.max(i-4,0),Math.min(i,4)));
}return result;}function biFromString(s,radix){var isNeg=s.charAt(0)=="-";var istop=isNeg?1:0;
var result=new BigInt();var place=new BigInt();place.digits[0]=1;for(var i=s.length-1;
i>=istop;i--){var c=s.charCodeAt(i);var digit=charToHex(c);var biDigit=biMultiplyDigit(place,digit);
result=biAdd(result,biDigit);place=biMultiplyDigit(place,radix);}result.isNeg=isNeg;
return result;}function biDump(b){return(b.isNeg?"-":"")+b.digits.join(" ");}function biAdd(x,y){var result;
if(x.isNeg!=y.isNeg){y.isNeg=!y.isNeg;result=biSubtract(x,y);y.isNeg=!y.isNeg;}else{result=new BigInt();
var c=0;var n;for(var i=0;i<x.digits.length;++i){n=x.digits[i]+y.digits[i]+c;result.digits[i]=n%biRadix;
c=Number(n>=biRadix);}result.isNeg=x.isNeg;}return result;}function biSubtract(x,y){var result;
if(x.isNeg!=y.isNeg){y.isNeg=!y.isNeg;result=biAdd(x,y);y.isNeg=!y.isNeg;}else{result=new BigInt();
var n,c;c=0;for(var i=0;i<x.digits.length;++i){n=x.digits[i]-y.digits[i]+c;result.digits[i]=n%biRadix;
if(result.digits[i]<0){result.digits[i]+=biRadix;}c=0-Number(n<0);}if(c==-1){c=0;
for(var i=0;i<x.digits.length;++i){n=0-result.digits[i]+c;result.digits[i]=n%biRadix;
if(result.digits[i]<0){result.digits[i]+=biRadix;}c=0-Number(n<0);}result.isNeg=!x.isNeg;
}else{result.isNeg=x.isNeg;}}return result;}function biHighIndex(x){var result=x.digits.length-1;
while(result>0&&x.digits[result]==0){--result;}return result;}function biNumBits(x){var n=biHighIndex(x);
var d=x.digits[n];var m=(n+1)*bitsPerDigit;var result;for(result=m;result>m-bitsPerDigit;
--result){if((d&32768)!=0){break;}d<<=1;}return result;}function biMultiply(x,y){var result=new BigInt();
var c;var n=biHighIndex(x);var t=biHighIndex(y);var u,uv,k,i,j;for(i=0;i<=t;++i){c=0;
k=i;for(j=0;j<=n;++j,++k){uv=result.digits[k]+x.digits[j]*y.digits[i]+c;result.digits[k]=uv&maxDigitVal;
c=uv>>>biRadixBits;}result.digits[i+n+1]=c;}result.isNeg=x.isNeg!=y.isNeg;return result;
}function biMultiplyDigit(x,y){var n,c,uv,result=new BigInt();n=biHighIndex(x);
c=0;for(var j=0;j<=n;++j){uv=result.digits[j]+x.digits[j]*y+c;result.digits[j]=uv&maxDigitVal;
c=uv>>>biRadixBits;}result.digits[1+n]=c;return result;}function arrayCopy(src,srcStart,dest,destStart,n){var m=Math.min(srcStart+n,src.length);
for(var i=srcStart,j=destStart;i<m;++i,++j){dest[j]=src[i];}}var highBitMasks=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);
function biShiftLeft(x,n){var digitCount=Math.floor(n/bitsPerDigit);var result=new BigInt();
arrayCopy(x.digits,0,result.digits,digitCount,result.digits.length-digitCount);
var bits=n%bitsPerDigit;var rightBits=bitsPerDigit-bits;for(var i=result.digits.length-1,i1=i-1;
i>0;--i,--i1){result.digits[i]=((result.digits[i]<<bits)&maxDigitVal)|((result.digits[i1]&highBitMasks[bits])>>>(rightBits));
}result.digits[0]=((result.digits[i]<<bits)&maxDigitVal);result.isNeg=x.isNeg;return result;
}var lowBitMasks=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);
function biShiftRight(x,n){var digitCount=Math.floor(n/bitsPerDigit);var result=new BigInt();
arrayCopy(x.digits,digitCount,result.digits,0,x.digits.length-digitCount);var bits=n%bitsPerDigit;
var leftBits=bitsPerDigit-bits;for(var i=0,i1=i+1;i<result.digits.length-1;++i,++i1){result.digits[i]=(result.digits[i]>>>bits)|((result.digits[i1]&lowBitMasks[bits])<<leftBits);
}result.digits[result.digits.length-1]>>>=bits;result.isNeg=x.isNeg;return result;
}function biMultiplyByRadixPower(x,n){var result=new BigInt();arrayCopy(x.digits,0,result.digits,n,result.digits.length-n);
return result;}function biDivideByRadixPower(x,n){var result=new BigInt();arrayCopy(x.digits,n,result.digits,0,result.digits.length-n);
return result;}function biModuloByRadixPower(x,n){var result=new BigInt();arrayCopy(x.digits,0,result.digits,0,n);
return result;}function biCompare(x,y){if(x.isNeg!=y.isNeg){return 1-2*Number(x.isNeg);
}for(var i=x.digits.length-1;i>=0;--i){if(x.digits[i]!=y.digits[i]){if(x.isNeg){return 1-2*Number(x.digits[i]>y.digits[i]);
}else{return 1-2*Number(x.digits[i]<y.digits[i]);}}}return 0;}function biDivideModulo(x,y){var nb=biNumBits(x);
var tb=biNumBits(y);var origYIsNeg=y.isNeg;var q,r;if(nb<tb){if(x.isNeg){q=biCopy(bigOne);
q.isNeg=!y.isNeg;x.isNeg=false;y.isNeg=false;r=biSubtract(y,x);x.isNeg=true;y.isNeg=origYIsNeg;
}else{q=new BigInt();r=biCopy(x);}return new Array(q,r);}q=new BigInt();r=x;var t=Math.ceil(tb/bitsPerDigit)-1;
var lambda=0;while(y.digits[t]<biHalfRadix){y=biShiftLeft(y,1);++lambda;++tb;t=Math.ceil(tb/bitsPerDigit)-1;
}r=biShiftLeft(r,lambda);nb+=lambda;var n=Math.ceil(nb/bitsPerDigit)-1;var b=biMultiplyByRadixPower(y,n-t);
while(biCompare(r,b)!=-1){++q.digits[n-t];r=biSubtract(r,b);}for(var i=n;i>t;--i){var ri=(i>=r.digits.length)?0:r.digits[i];
var ri1=(i-1>=r.digits.length)?0:r.digits[i-1];var ri2=(i-2>=r.digits.length)?0:r.digits[i-2];
var yt=(t>=y.digits.length)?0:y.digits[t];var yt1=(t-1>=y.digits.length)?0:y.digits[t-1];
if(ri==yt){q.digits[i-t-1]=maxDigitVal;}else{q.digits[i-t-1]=Math.floor((ri*biRadix+ri1)/yt);
}var c1=q.digits[i-t-1]*((yt*biRadix)+yt1);var c2=(ri*biRadixSquared)+((ri1*biRadix)+ri2);
while(c1>c2){--q.digits[i-t-1];c1=q.digits[i-t-1]*((yt*biRadix)|yt1);c2=(ri*biRadix*biRadix)+((ri1*biRadix)+ri2);
}b=biMultiplyByRadixPower(y,i-t-1);r=biSubtract(r,biMultiplyDigit(b,q.digits[i-t-1]));
if(r.isNeg){r=biAdd(r,b);--q.digits[i-t-1];}}r=biShiftRight(r,lambda);q.isNeg=x.isNeg!=origYIsNeg;
if(x.isNeg){if(origYIsNeg){q=biAdd(q,bigOne);}else{q=biSubtract(q,bigOne);}y=biShiftRight(y,lambda);
r=biSubtract(y,r);}if(r.digits[0]==0&&biHighIndex(r)==0){r.isNeg=false;}return new Array(q,r);
}function biDivide(x,y){return biDivideModulo(x,y)[0];}function biModulo(x,y){return biDivideModulo(x,y)[1];
}function biMultiplyMod(x,y,m){return biModulo(biMultiply(x,y),m);}function biPow(x,y){var result=bigOne;
var a=x;while(true){if((y&1)!=0){result=biMultiply(result,a);}y>>=1;if(y==0){break;
}a=biMultiply(a,a);}return result;}function biPowMod(x,y,m){var result=bigOne;var a=x;
var k=y;while(true){if((k.digits[0]&1)!=0){result=biMultiplyMod(result,a,m);}k=biShiftRight(k,1);
if(k.digits[0]==0&&biHighIndex(k)==0){break;}a=biMultiplyMod(a,a,m);}return result;
}return{construct:BigInt,setMaxDigits:setMaxDigits,fromDecimal:biFromDecimal,copy:biCopy,fromNumber:biFromNumber,toString:biToString,toDecimal:biToDecimal,toHex:biToHex,fromHex:biFromHex,fromString:biFromString,dump:biDump,add:biAdd,subtract:biSubtract,highIndex:biHighIndex,numBits:biNumBits,multiply:biMultiply,shiftLeft:biShiftLeft,shiftRight:biShiftRight,compare:biCompare,pow:biPow,powMod:biPowMod,divide:biDivide,divideByRadixPower:biDivideByRadixPower,moduloByRadixPower:biModuloByRadixPower};
})();(function(global){if(typeof apf.crypto=="undefined"){apf.crypto={};}function stringtoints(instring){var binary=[];
var i,ch;for(i=0;i<instring.length;i++){ch=instring.charCodeAt(i);binary[i>>2]|=ch<<(3-i%4)*8;
}return binary;}function intstostring(intvalues){var outstring=new String();for(var i=0;
i<intvalues.length;i++){outstring+=String.fromCharCode(intvalues[i]>>>24,(intvalues[i]>>>16)&255,(intvalues[i]>>>8)&255,intvalues[i]&255);
}return outstring;}function base64tobin(codestring){var temp,i=0;var binary=[];
while(i<codestring.length*6){temp=codestring.charCodeAt(i/6);if(temp>47&&temp<58){temp-=48;
}if(temp>62&&temp<91){temp-=53;}if(temp>96&&temp<123){temp-=59;}switch(i&31){case 0:binary[i>>5]=temp;
i+=6;break;case 28:binary[i>>5]=(binary[i>>5]<<4)|(temp>>2);i+=4;binary[i>>5]=temp&3;
i+=2;break;case 30:binary[i>>5]=(binary[i>>5]<<2)|(temp>>4);i+=2;binary[i>>5]=temp&15;
i+=4;break;default:binary[i>>5]=(binary[i>>5]<<6)|temp;i+=6;}}return binary;}function base64encode(binary){var temp,x,bincount=0,codestring="",chars="0123456789?@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
while(bincount<binary.length){for(x=0;x<2;x++){temp=binary[bincount]>>>26;codestring+=chars.charAt(temp);
temp=(binary[bincount]>>>20)&63;codestring+=chars.charAt(temp);temp=(binary[bincount]>>>14)&63;
codestring+=chars.charAt(temp);temp=(binary[bincount]>>>8)&63;codestring+=chars.charAt(temp);
temp=(binary[bincount]>>>2)&63;codestring+=chars.charAt(temp);temp=(binary[bincount++]&3)<<4;
temp=temp|(binary[bincount]>>>28);codestring+=chars.charAt(temp);temp=(binary[bincount]>>>22)&63;
codestring+=chars.charAt(temp);temp=(binary[bincount]>>>16)&63;codestring+=chars.charAt(temp);
temp=(binary[bincount]>>>10)&63;codestring+=chars.charAt(temp);temp=(binary[bincount]>>>4)&63;
codestring+=chars.charAt(temp);temp=(binary[bincount++]&15)<<2;temp=temp|(binary[bincount]>>>30);
codestring+=chars.charAt(temp);temp=(binary[bincount]>>>24)&63;codestring+=chars.charAt(temp);
temp=(binary[bincount]>>>18)&63;codestring+=chars.charAt(temp);temp=(binary[bincount]>>>12)&63;
codestring+=chars.charAt(temp);temp=(binary[bincount]>>>6)&63;codestring+=chars.charAt(temp);
temp=binary[bincount++]&63;codestring+=chars.charAt(temp);}}return codestring;}apf.crypto.Blowfish=function(){this.init.apply(this,arguments);
};apf.crypto.Blowfish.prototype={init:function(m){this.P;this.S;this.previous_xHi=0;
this.previous_xLo=0;},encode:function(str,pass){var ciphertext=new String(""),IV=new Array(),x;
for(x=0;x<4;x++){if(typeof(this.customRand)=="function"){IV[x]=this.customRand();
}else{IV[x]=Math.floor(Math.random()*4294967295);}}var key=this.passtokey(pass,IV[2],IV[3],IV[4]);
IV[4]=key[14];IV[5]=key[15];this.initialise(key,IV);var binary=stringtoints(str);
this.encipher_array(binary);return{code:base64encode(binary),init:base64encode(IV)};
},decode:function(code,pass,init){var initialints=base64tobin(init);var key=this.passtokey(pass,initialints[2],initialints[3]);
if((initialints[4]==key[14])&&(initialints[5]==key[15])){this.initialise(key,initialints);
var bincode=base64tobin(code);this.decipher(bincode);return intstostring(bincode);
}return null;},setConstants:function(){var s0=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946];
var s1=[1266315497,3048417604,3681880366,3289982499,2909710000,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055];
var s2=[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504];
var s3=[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409000,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462];
this.S=[s0,s1,s2,s3];this.P=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731];
},encipher:function(x){var xHi=x[0];var xLo=x[1];var Round=0;xHi^=this.P[0];while(Round<16){xLo^=(((this.S[0][xHi>>>24]+this.S[1][(xHi>>>16)&255])^this.S[2][(xHi>>>8)&255])+this.S[3][xHi&255])^this.P[++Round];
xHi^=(((this.S[0][xLo>>>24]+this.S[1][(xLo>>>16)&255])^this.S[2][(xLo>>>8)&255])+this.S[3][xLo&255])^this.P[++Round];
}xLo^=this.P[16+1];x[0]=xLo;x[1]=xHi;},encipher_array:function(x){var i,count,xHi,xLo,Round,temp;
for(i=0;(i<x.length)||(x.length%6);i+=2){xHi=x[i];xLo=x[i+1];xHi^=this.previous_xHi;
xLo^=this.previous_xLo;xHi^=this.P[0];Round=0;while(Round<16){xLo^=(((this.S[0][xHi>>>24]+this.S[1][(xHi>>>16)&255])^this.S[2][(xHi>>>8)&255])+this.S[3][xHi&255])^this.P[++Round];
xHi^=(((this.S[0][xLo>>>24]+this.S[1][(xLo>>>16)&255])^this.S[2][(xLo>>>8)&255])+this.S[3][xLo&255])^this.P[++Round];
}xLo^=this.P[17];this.previous_xHi=xLo;this.previous_xLo=xHi;x[i+1]=xHi;x[i]=xLo;
}},decipher:function(x){var i,xHi,xLo,Round,temp;for(i=0;i<x.length;i+=2){xHi=x[i];
xLo=x[i+1];xHi^=this.P[17];Round=16;while(Round>0){xLo^=(((this.S[0][xHi>>>24]+this.S[1][(xHi>>>16)&255])^this.S[2][(xHi>>>8)&255])+this.S[3][xHi&255])^this.P[Round--];
xHi^=(((this.S[0][xLo>>>24]+this.S[1][(xLo>>>16)&255])^this.S[2][(xLo>>>8)&255])+this.S[3][xLo&255])^this.P[Round--];
}xLo^=this.P[0];temp=x[i];x[i]=xLo^this.previous_xHi;this.previous_xHi=temp;temp=x[i+1];
x[i+1]=xHi^this.previous_xLo;this.previous_xLo=temp;}},initialise:function(key,IV){var i,j,k,data;
var block=new Array(2);this.previous_xHi=IV[0];this.previous_xLo=IV[1];this.setConstants();
for(j=0,i=0;i<16+2;++i){this.P[i]=this.P[i]^key[j];j=(j+1)%14;}for(i=0;i<16+2;i+=2){this.encipher(block);
this.P[i]=block[0];this.P[i+1]=block[1];}for(i=0;i<4;++i){for(j=0;j<256;j+=2){this.encipher(block);
this.S[i][j]=block[0];this.S[i][j+1]=block[1];}}},passtokey:function(pass,HiIV,LoIV){var binarypassword=stringtoints(pass);
var block=new Array(2);var key=new Array(16);var i=0,j;block[0]=HiIV;block[1]=LoIV;
do{this.initialise(key,block,16);for(j=0;j<16;){block[0]^=binarypassword[i];this.encipher(block);
key[j++]^=block[0];key[j++]^=block[1];}}while(++i<binarypassword.length);return key;
}};})(this);apf.crypto.MD4={hexcase:0,b64pad:"",chrsz:8,hex_md4:function(s){return this.binl2hex(this.core_md4(this.str2binl(s),s.length*this.chrsz));
},b64_md4:function(s){return this.binl2b64(this.core_md4(this.str2binl(s),s.length*this.chrsz));
},str_md4:function(s){return this.binl2str(this.core_md4(this.str2binl(s),s.length*this.chrsz));
},hex_hmac_md4:function(key,data){return this.binl2hex(this.core_hmac_md4(key,data));
},b64_hmac_md4:function(key,data){return this.binl2b64(this.core_hmac_md4(key,data));
},str_hmac_md4:function(key,data){return this.binl2str(this.core_hmac_md4(key,data));
},md4_vm_test:function(){return this.hex_md4("abc")=="a448017aaf21d8525fc10ae87aa6729d";
},core_md4:function(x,len){x[len>>5]|=128<<(len%32);x[(((len+64)>>>9)<<4)+14]=len;
var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;
i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=this.md4_ff(a,b,c,d,x[i+0],3);
d=this.md4_ff(d,a,b,c,x[i+1],7);c=this.md4_ff(c,d,a,b,x[i+2],11);b=this.md4_ff(b,c,d,a,x[i+3],19);
a=this.md4_ff(a,b,c,d,x[i+4],3);d=this.md4_ff(d,a,b,c,x[i+5],7);c=this.md4_ff(c,d,a,b,x[i+6],11);
b=this.md4_ff(b,c,d,a,x[i+7],19);a=this.md4_ff(a,b,c,d,x[i+8],3);d=this.md4_ff(d,a,b,c,x[i+9],7);
c=this.md4_ff(c,d,a,b,x[i+10],11);b=this.md4_ff(b,c,d,a,x[i+11],19);a=this.md4_ff(a,b,c,d,x[i+12],3);
d=this.md4_ff(d,a,b,c,x[i+13],7);c=this.md4_ff(c,d,a,b,x[i+14],11);b=this.md4_ff(b,c,d,a,x[i+15],19);
a=this.md4_gg(a,b,c,d,x[i+0],3);d=this.md4_gg(d,a,b,c,x[i+4],5);c=this.md4_gg(c,d,a,b,x[i+8],9);
b=this.md4_gg(b,c,d,a,x[i+12],13);a=this.md4_gg(a,b,c,d,x[i+1],3);d=this.md4_gg(d,a,b,c,x[i+5],5);
c=this.md4_gg(c,d,a,b,x[i+9],9);b=this.md4_gg(b,c,d,a,x[i+13],13);a=this.md4_gg(a,b,c,d,x[i+2],3);
d=this.md4_gg(d,a,b,c,x[i+6],5);c=this.md4_gg(c,d,a,b,x[i+10],9);b=this.md4_gg(b,c,d,a,x[i+14],13);
a=this.md4_gg(a,b,c,d,x[i+3],3);d=this.md4_gg(d,a,b,c,x[i+7],5);c=this.md4_gg(c,d,a,b,x[i+11],9);
b=this.md4_gg(b,c,d,a,x[i+15],13);a=this.md4_hh(a,b,c,d,x[i+0],3);d=this.md4_hh(d,a,b,c,x[i+8],9);
c=this.md4_hh(c,d,a,b,x[i+4],11);b=this.md4_hh(b,c,d,a,x[i+12],15);a=this.md4_hh(a,b,c,d,x[i+2],3);
d=this.md4_hh(d,a,b,c,x[i+10],9);c=this.md4_hh(c,d,a,b,x[i+6],11);b=this.md4_hh(b,c,d,a,x[i+14],15);
a=this.md4_hh(a,b,c,d,x[i+1],3);d=this.md4_hh(d,a,b,c,x[i+9],9);c=this.md4_hh(c,d,a,b,x[i+5],11);
b=this.md4_hh(b,c,d,a,x[i+13],15);a=this.md4_hh(a,b,c,d,x[i+3],3);d=this.md4_hh(d,a,b,c,x[i+11],9);
c=this.md4_hh(c,d,a,b,x[i+7],11);b=this.md4_hh(b,c,d,a,x[i+15],15);a=this.safe_add(a,olda);
b=this.safe_add(b,oldb);c=this.safe_add(c,oldc);d=this.safe_add(d,oldd);}return Array(a,b,c,d);
},md4_cmn:function(q,a,b,x,s,t){return this.safe_add(rol(this.safe_add(this.safe_add(a,q),this.safe_add(x,t)),s),b);
},md4_ff:function(a,b,c,d,x,s){return this.md4_cmn((b&c)|((~b)&d),a,0,x,s,0);},md4_gg:function(a,b,c,d,x,s){return this.md4_cmn((b&c)|(b&d)|(c&d),a,0,x,s,1518500249);
},md4_hh:function(a,b,c,d,x,s){return this.md4_cmn(b^c^d,a,0,x,s,1859775393);},core_hmac_md4:function(key,data){var bkey=this.str2binl(key);
if(bkey.length>16){bkey=this.core_md4(bkey,key.length*this.chrsz);}var ipad=Array(16),opad=Array(16);
for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828;}var hash=this.core_md4(ipad.concat(this.str2binl(data)),512+data.length*this.chrsz);
return this.core_md4(opad.concat(hash),512+128);},safe_add:function(x,y){var lsw=(x&65535)+(y&65535);
var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&65535);},rol:function(num,cnt){return(num<<cnt)|(num>>>(32-cnt));
},str2binl:function(str){var bin=Array();var mask=(1<<this.chrsz)-1;for(var i=0;
i<str.length*this.chrsz;i+=this.chrsz){bin[i>>5]|=(str.charCodeAt(i/this.chrsz)&mask)<<(i%32);
}return bin;},binl2str:function(bin){var str="";var mask=(1<<this.chrsz)-1;for(var i=0;
i<bin.length*32;i+=this.chrsz){str+=String.fromCharCode((bin[i>>5]>>>(i%32))&mask);
}return str;},binl2hex:function(binarray){var hex_tab=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";
var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt((binarray[i>>2]>>((i%4)*8+4))&15)+hex_tab.charAt((binarray[i>>2]>>((i%4)*8))&15);
}return str;},binl2b64:function(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
var str="";for(var i=0;i<binarray.length*4;i+=3){var triplet=(((binarray[i>>2]>>8*(i%4))&255)<<16)|(((binarray[i+1>>2]>>8*((i+1)%4))&255)<<8)|((binarray[i+2>>2]>>8*((i+2)%4))&255);
for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32){str+=this.b64pad;}else{str+=tab.charAt((triplet>>6*(3-j))&63);
}}}return str;}};apf.crypto.MD5={hexcase:0,b64pad:"",chrsz:8,hex_md5:function(s){return this.binl2hex(this.core_md5(this.str2binl(s),s.length*this.chrsz));
},b64_md5:function(s){return this.binl2b64(this.core_md5(this.str2binl(s),s.length*this.chrsz));
},str_md5:function(s){return this.binl2str(this.core_md5(this.str2binl(s),s.length*this.chrsz));
},hex_hmac_md5:function(key,data){return this.binl2hex(this.core_hmac_md5(key,data));
},b64_hmac_md5:function(key,data){return this.binl2b64(this.core_hmac_md5(key,data));
},str_hmac_md5:function(key,data){return this.binl2str(this.core_hmac_md5(key,data));
},core_md5:function(x,len){x[len>>5]|=128<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;
var a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(var i=0;i<x.length;
i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=this.md5_ff(a,b,c,d,x[i+0],7,-680876936);
d=this.md5_ff(d,a,b,c,x[i+1],12,-389564586);c=this.md5_ff(c,d,a,b,x[i+2],17,606105819);
b=this.md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=this.md5_ff(a,b,c,d,x[i+4],7,-176418897);
d=this.md5_ff(d,a,b,c,x[i+5],12,1200080426);c=this.md5_ff(c,d,a,b,x[i+6],17,-1473231341);
b=this.md5_ff(b,c,d,a,x[i+7],22,-45705983);a=this.md5_ff(a,b,c,d,x[i+8],7,1770035416);
d=this.md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=this.md5_ff(c,d,a,b,x[i+10],17,-42063);
b=this.md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=this.md5_ff(a,b,c,d,x[i+12],7,1804603682);
d=this.md5_ff(d,a,b,c,x[i+13],12,-40341101);c=this.md5_ff(c,d,a,b,x[i+14],17,-1502002290);
b=this.md5_ff(b,c,d,a,x[i+15],22,1236535329);a=this.md5_gg(a,b,c,d,x[i+1],5,-165796510);
d=this.md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=this.md5_gg(c,d,a,b,x[i+11],14,643717713);
b=this.md5_gg(b,c,d,a,x[i+0],20,-373897302);a=this.md5_gg(a,b,c,d,x[i+5],5,-701558691);
d=this.md5_gg(d,a,b,c,x[i+10],9,38016083);c=this.md5_gg(c,d,a,b,x[i+15],14,-660478335);
b=this.md5_gg(b,c,d,a,x[i+4],20,-405537848);a=this.md5_gg(a,b,c,d,x[i+9],5,568446438);
d=this.md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=this.md5_gg(c,d,a,b,x[i+3],14,-187363961);
b=this.md5_gg(b,c,d,a,x[i+8],20,1163531501);a=this.md5_gg(a,b,c,d,x[i+13],5,-1444681467);
d=this.md5_gg(d,a,b,c,x[i+2],9,-51403784);c=this.md5_gg(c,d,a,b,x[i+7],14,1735328473);
b=this.md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=this.md5_hh(a,b,c,d,x[i+5],4,-378558);
d=this.md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=this.md5_hh(c,d,a,b,x[i+11],16,1839030562);
b=this.md5_hh(b,c,d,a,x[i+14],23,-35309556);a=this.md5_hh(a,b,c,d,x[i+1],4,-1530992060);
d=this.md5_hh(d,a,b,c,x[i+4],11,1272893353);c=this.md5_hh(c,d,a,b,x[i+7],16,-155497632);
b=this.md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=this.md5_hh(a,b,c,d,x[i+13],4,681279174);
d=this.md5_hh(d,a,b,c,x[i+0],11,-358537222);c=this.md5_hh(c,d,a,b,x[i+3],16,-722521979);
b=this.md5_hh(b,c,d,a,x[i+6],23,76029189);a=this.md5_hh(a,b,c,d,x[i+9],4,-640364487);
d=this.md5_hh(d,a,b,c,x[i+12],11,-421815835);c=this.md5_hh(c,d,a,b,x[i+15],16,530742520);
b=this.md5_hh(b,c,d,a,x[i+2],23,-995338651);a=this.md5_ii(a,b,c,d,x[i+0],6,-198630844);
d=this.md5_ii(d,a,b,c,x[i+7],10,1126891415);c=this.md5_ii(c,d,a,b,x[i+14],15,-1416354905);
b=this.md5_ii(b,c,d,a,x[i+5],21,-57434055);a=this.md5_ii(a,b,c,d,x[i+12],6,1700485571);
d=this.md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=this.md5_ii(c,d,a,b,x[i+10],15,-1051523);
b=this.md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=this.md5_ii(a,b,c,d,x[i+8],6,1873313359);
d=this.md5_ii(d,a,b,c,x[i+15],10,-30611744);c=this.md5_ii(c,d,a,b,x[i+6],15,-1560198380);
b=this.md5_ii(b,c,d,a,x[i+13],21,1309151649);a=this.md5_ii(a,b,c,d,x[i+4],6,-145523070);
d=this.md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=this.md5_ii(c,d,a,b,x[i+2],15,718787259);
b=this.md5_ii(b,c,d,a,x[i+9],21,-343485551);a=this.safe_add(a,olda);b=this.safe_add(b,oldb);
c=this.safe_add(c,oldc);d=this.safe_add(d,oldd);}return[a,b,c,d];},md5_cmn:function(q,a,b,x,s,t){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(a,q),this.safe_add(x,t)),s),b);
},md5_ff:function(a,b,c,d,x,s,t){return this.md5_cmn((b&c)|((~b)&d),a,b,x,s,t);
},md5_gg:function(a,b,c,d,x,s,t){return this.md5_cmn((b&d)|(c&(~d)),a,b,x,s,t);
},md5_hh:function(a,b,c,d,x,s,t){return this.md5_cmn(b^c^d,a,b,x,s,t);},md5_ii:function(a,b,c,d,x,s,t){return this.md5_cmn(c^(b|(~d)),a,b,x,s,t);
},core_hmac_md5:function(key,data){var bkey=this.str2binl(key),ipad=Array(16),opad=Array(16);
if(bkey.length>16){bkey=this.core_md5(bkey,key.length*this.chrsz);}for(var i=0;
i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828;}return this.core_md5(opad.concat(this.core_md5(ipad.concat(this.str2binl(data)),512+data.length*this.chrsz)),512+128);
},safe_add:function(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);
return(msw<<16)|(lsw&65535);},bit_rol:function(num,cnt){return(num<<cnt)|(num>>>(32-cnt));
},str2binl:function(str){var bin=[],i,mask=(1<<this.chrsz)-1;for(i=0;i<str.length*this.chrsz;
i+=this.chrsz){bin[i>>5]|=(str.charCodeAt(i/this.chrsz)&mask)<<(i%32);}return bin;
},binl2str:function(bin){var str=[],i,mask=(1<<this.chrsz)-1;for(i=0;i<bin.length*32;
i+=this.chrsz){str.push(String.fromCharCode((bin[i>>5]>>>(i%32))&mask));}return str.join("");
},binl2hex:function(binarray){var hex_tab=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",str=[],i;
for(i=0;i<binarray.length*4;i++){str.push(hex_tab.charAt((binarray[i>>2]>>((i%4)*8+4))&15)+hex_tab.charAt((binarray[i>>2]>>((i%4)*8))&15));
}return str.join("");},binl2b64:function(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",str=[],i;
for(i=0;i<binarray.length*4;i+=3){var triplet=(((binarray[i>>2]>>8*(i%4))&255)<<16)|(((binarray[i+1>>2]>>8*((i+1)%4))&255)<<8)|((binarray[i+2>>2]>>8*((i+2)%4))&255);
for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32){str.push(this.b64pad);}else{str.push(tab.charAt((triplet>>6*(3-j))&63));
}}}return str.join("");}};apf.crypto.RSA=(function(){function RSAKeyPair(encryptionExponent,decryptionExponent,modulus){this.e=apf.crypto.BigInt.fromHex(encryptionExponent);
this.d=apf.crypto.BigInt.fromHex(decryptionExponent);this.m=apf.crypto.BigInt.fromHex(modulus);
this.digitSize=2*apf.crypto.BigInt.highIndex(this.m)+2;this.chunkSize=this.digitSize-11;
this.radix=16;this.barrett=new apf.crypto.Barrett(this.m);}function twoDigit(n){return(n<10?"0":"")+String(n);
}function encryptedString(key,s){if(key.chunkSize>key.digitSize-11){return"Error";
}var a=new Array();var sl=s.length;var i=0;while(i<sl){a[i]=s.charCodeAt(i);i++;
}var al=a.length;var result="";var j,k,block;for(i=0;i<al;i+=key.chunkSize){block=new apf.crypto.BigInt.construct();
j=0;var x;var msgLength=(i+key.chunkSize)>al?al%key.chunkSize:key.chunkSize;var b=new Array();
for(x=0;x<msgLength;x++){b[x]=a[i+msgLength-1-x];}b[msgLength]=0;var paddedSize=Math.max(8,key.digitSize-3-msgLength);
for(x=0;x<paddedSize;x++){b[msgLength+1+x]=Math.floor(Math.random()*254)+1;}b[key.digitSize-2]=2;
b[key.digitSize-1]=0;for(k=0;k<key.digitSize;++j){block.digits[j]=b[k++];block.digits[j]+=b[k++]<<8;
}var crypt=key.barrett.powMod(block,key.e);var text=key.radix==16?apf.crypto.BigInt.toHex(crypt):apf.crypto.BigInt.toString(crypt,key.radix);
result+=text+" ";}return result.substring(0,result.length-1);}function decryptedString(key,s){var blocks=s.split(" ");
var result="";var i,j,block;for(i=0;i<blocks.length;++i){var bi;if(key.radix==16){bi=apf.crypto.BigInt.fromHex(blocks[i]);
}else{bi=apf.crypto.BigInt.fromString(blocks[i],key.radix);}block=key.barrett.powMod(bi,key.d);
for(j=0;j<=apf.crypto.BigInt.highIndex(block);++j){result+=String.fromCharCode(block.digits[j]&255,block.digits[j]>>8);
}}if(result.charCodeAt(result.length-1)==0){result=result.substring(0,result.length-1);
}return result;}return{F4:"10001",E3:"3",getKeyPair:RSAKeyPair,twoDigit:twoDigit,encrypt:encryptedString,decrypt:decryptedString};
})();(function(global){function rotate_left(n,s){var t4=(n<<s)|(n>>>(32-s));return t4;
}function cvt_hex(val){var str="";var i;var v;for(i=7;i>=0;i--){v=(val>>>(i*4))&15;
str+=v.toString(16);}return str;}global.SHA1=function(str){var blockstart,i,j,W=new Array(80),H0=1732584193,H1=4023233417,H2=2562383102,H3=271733878,H4=3285377520,A,B,C,D,E,temp;
str=apf.crypto.UTF8.encode(str);var str_len=str.length,word_array=[];for(i=0;i<str_len-3;
i+=4){j=str.charCodeAt(i)<<24|str.charCodeAt(i+1)<<16|str.charCodeAt(i+2)<<8|str.charCodeAt(i+3);
word_array.push(j);}switch(str_len%4){case 0:i=2147483648;break;case 1:i=str.charCodeAt(str_len-1)<<24|8388608;
break;case 2:i=str.charCodeAt(str_len-2)<<24|str.charCodeAt(str_len-1)<<16|32768;
break;case 3:i=str.charCodeAt(str_len-3)<<24|str.charCodeAt(str_len-2)<<16|str.charCodeAt(str_len-1)<<8|128;
break;}word_array.push(i);while((word_array.length%16)!=14){word_array.push(0);
}word_array.push(str_len>>>29);word_array.push((str_len<<3)&4294967295);for(blockstart=0;
blockstart<word_array.length;blockstart+=16){for(i=0;i<16;i++){W[i]=word_array[blockstart+i];
}for(i=16;i<=79;i++){W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);}A=H0;B=H1;
C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+1518500249)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+1859775393)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+2400959708)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+3395469782)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}H0=(H0+A)&4294967295;H1=(H1+B)&4294967295;
H2=(H2+C)&4294967295;H3=(H3+D)&4294967295;H4=(H4+E)&4294967295;}temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);
return temp.toLowerCase();};})(apf.crypto);apf.dump=apf.vardump=function(obj,o,depth,stack){o=o||{};
if(o.maxdepth===undefined){o.maxdepth=99;}if(apf.isWebkit){return"";}if(!obj){return obj+"";
}if(!stack){stack="";}if(!depth){depth=0;}var str;switch(obj.dataType){case apf.STRING:return'"'+(o.clip?(obj.length>o.clip?(obj.slice(0,o.clip)+"..."):obj):obj).replace(/[\"]/g,"'")+'"';
case apf.NUMBER:return obj;case apf.BOOLEAN:return(obj?"true":"false");case apf.DATE:return'Date("'+obj+")";
case apf.ARRAY:if(obj[obj.length-2]=="$__vardump"){return"this"+obj[obj.length-1];
}obj.push("$__vardump",stack);str=["[ "];for(var i=0;i<obj.length-2;i++){str.push(str.length>1?",":"",(depth>=o.maxdepth?typeof(obj[i]):apf.vardump(obj[i],o,depth+1,stack+"["+i+"]")));
}str.push(" ]");obj.pop();obj.pop();return str.join("");default:if(typeof obj=="function"){return"function";
}if(obj.nodeType!==undefined){return o.xml?(str=obj.xml,o.clip?((str=str.replace(/\s*[\r\n]\s*/g,"")).length>o.clip?str.slice(0,o.clip)+"...>":str):str):("<"+obj.tagName+"../>");
}if(depth>=o.maxdepth){return"object";}if(obj["$__vardump"]){return"this"+obj["$__vardump"]+"";
}obj["$__vardump"]=stack;str=["{"+(o.clip?"":"\n")];for(var prop in obj){if(prop!="$__vardump"){if(o.clipobj&&str.join("").length>o.clipobj){str.push(", ...");
break;}try{var propname=prop;if(str.length>1){str.push(o.clip?", ":",\n");}str.push(o.clip?"":("\t".repeat(depth+1)),propname,": ",(depth>=o.maxdepth?typeof(obj[prop]):apf.vardump(obj[prop],o,depth+1,stack+"."+prop)));
}catch(e){str.push(o.clip?"":("\t".repeat(depth+1)),prop,": dumperror");}}}str.push(o.clip?"":"\n",o.clip?"":("\t".repeat(depth)),"}");
function cleanup(obj){if(obj["$__vardump"]!==undefined){delete obj["$__vardump"];
}else{return;}for(var prop in obj){var v=obj[prop];if(typeof(v)=="object"&&v){cleanup(v);
}}}cleanup(obj);return str.join("");}};if(apf.isOpera){window.console={};["log","debug","info","warn","error"].forEach(function(type){window.console[type]=function(){if(typeof arguments==="undefined"){return null;
}if(arguments.length===1){opera.postError(type+": "+arguments[0]);return type+": "+arguments[0];
}var s=arguments[0],regexp=/%([sdifo])/g,i=0,match=null;while(match=regexp.exec(s)){s=s.replace(match[0],String(arguments[++i]));
}var len=arguments.length;while(len>i++){if(arguments[i]){s+=" ";s+=String(arguments[i]);
}}opera.postError(type+": "+s);};});}apf.dump2=apf.vardump2=function(obj,depth,recur,stack){if(!obj){return obj+"";
}if(!depth){depth=0;}switch(obj.dataType){case"string":return'"'+obj+'"';case"number":return obj;
case"boolean":return obj?"true":"false";case"date":return"Date["+new Date()+"]";
case"array":var str="{\n";for(var i=0;i<obj.length;i++){str+="     ".repeat(depth+1)+i+" => "+(!recur&&depth>0?typeof obj[i]:apf.vardump(obj[i],depth+1,!recur))+"\n";
}str+="     ".repeat(depth)+"}";return str;default:if(typeof obj=="function"){return"function";
}if(obj.xml||obj.serialize){return depth==0?"[ "+(obj.xml||obj.serialize())+" ]":"XML Element";
}if(!recur&&depth>0){return"object";}var str="{\n";for(prop in obj){try{str+="     ".repeat(depth+1)+prop+" => "+(!recur&&depth>0?typeof obj[prop]:apf.vardump(obj[prop],depth+1,!recur))+"\n";
}catch(e){str+="     ".repeat(depth+1)+prop+" => [ERROR]\n";}}str+="     ".repeat(depth)+"}";
return str;}};String.prototype.s=function(){return this.replace(/[\r\n]/g,"");};
apf.alert_r=function(obj,recur){alert(apf.vardump(obj,null,recur));};apf.alert_r2=function(obj,recur){alert(apf.vardump2(obj,null,!recur));
};apf.ProfilerClass=function(nostart){this.totalTime=0;this.start=function(clear){if(clear){this.totalTime=0;
}this.startTime=new Date().getTime();this.isStarted=true;};this.stop=this.end=function(){if(!this.startTime){return;
}this.totalTime+=new Date().getTime()-this.startTime;this.isStarted=false;};this.addPoint=function(msg){this.end();
apf.console.time("[TIME] "+(msg||"Profiled Section")+": "+this.totalTime+"ms");
this.start(true);};if(!nostart){this.start();}};apf.Latometer=new apf.ProfilerClass(true);
if(self.navigator&&navigator.userAgent.indexOf("Opera")!=-1){window.console={};
["log","debug","info","warn","error"].forEach(function(type){window.console[type]=function(){if(typeof arguments==="undefined"){return null;
}if(arguments.length===1){opera.postError(type+": "+arguments[0]);return type+": "+arguments[0];
}var s=arguments[0],regexp=/%([sdifo])/g,i=0,match=null;while(match=regexp.exec(s)){s=s.replace(match[0],String(arguments[++i]));
}var len=arguments.length;while(len>i++){if(arguments[i]){s+=" ";s+=String(arguments[i]);
}}opera.postError(type+": "+s);};});}apf.JsParser=new (function(){var tok_lut={'"':4,"'":4,"[":2,"]":3,"{":2,"}":3,"(":2,")":3,"\n":6,"\r\n":6,"//":7,"/*":7,"*/":7,"/":8},tok_close={"}":"{","]":"[",")":"("},tokenizerx=/(\r?[\n]|\/[\/*]|\*\/|["'{(\[\])}\]\/])|([ \t]+)|([\w\$._])+|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>])/g;
function errToString(){return this.t+"["+this.pos+"]";}function posToString(){return"Ln : "+this.line+", Col : "+this.col;
}function argToString(){return this.type+" "+this.name+(this.def!==undefined?"="+this.def:"");
}function markerToString(){return"Marker:"+this.type+"  ["+this.pos+"] "+(this.args?"("+this.args.join(",")+")":"");
}function funcToString(){return this.type+" "+this.ret+" "+this.name+(this.args?"("+this.args.join(",")+")":"")+"  ["+this.pos+"]"+(this.doc?(" Doc: "+this.doc):"");
}function concat(t,b,e,m){for(var s=[],sl=0,i=b;i<e;i+=3){s[sl++]=(t[i]==2)?concat(t[i+2],0,t[i+2].length):t[i+2];
if(m&&i<e-3){s[sl++]=m;}}return s.join("");}function formatPos(l,pos){return JsParser.line(l,pos).toString();
}var pre_regex={"throw":1,"return":1,"(":1,"[":1,",":1,"=":1,":":1};this.parse=function(str){var t=[],b=0,stack=[],type=0,mode_tok=0,n,lines=[],err=[];
var last_tok=null;str.replace(tokenizerx,function(tok,rx_lut,rx_ws,rx_word,rx_misc,pos){type=rx_lut?tok_lut[rx_lut]:(rx_ws?9:(rx_word?5:0));
if(!mode_tok){switch(type){case 8:if(pre_regex[last_tok]||pre_regex[t[t.length-1]]){if(t[t.length-3]=="["){mode_tok="objRgx";
var openTags=1;}else{mode_tok=tok;}t[n=t.length]=type,t[++n]=pos;b=[tok];}else{t[n=t.length]=0;
t[++n]=pos;t[++n]=tok;}break;case 4:case 7:t[n=t.length]=type,t[++n]=pos;mode_tok=tok;
b=[tok];break;case 2:t[n=t.length]=type;t[++n]=pos;stack.push(t);t=t[++n]=[0,pos,tok];
break;case 3:if(t[2]!=tok_close[tok]){err.push({t:"Error closing "+tok+" (opened with: "+t[2]+")",pos:pos,toString:errToString});
}else{t[n=t.length]=type;t[++n]=pos;t[++n]=tok;t=stack.pop();}break;case 6:lines[lines.length]=pos;
break;case 9:break;default:t[n=t.length]=type;t[++n]=pos;t[++n]=tok;break;}}else{b[b.length]=tok;
if(mode_tok=="objRgx"){if(tok=="["){openTags++;}else{if(tok=="]"){openTags--;}}if(openTags==0){mode_tok=0;
t[++n]=b.join("");}}switch(type){case 4:if(mode_tok==tok){mode_tok=0;t[++n]=b.join("");
}break;case 7:if(tok=="*/"&&mode_tok=="/*"){mode_tok=0;t[++n]=b.join("");}else{if(tok=="*/"&&mode_tok=="/"){mode_tok=0;
t[++n]=b.join("");}}break;case 8:if(mode_tok=="/"){mode_tok=0;t[++n]=b.join("");
}break;case 6:lines[lines.length]=pos;if(mode_tok=="//"){mode_tok=0;b.pop();t[++n]=b.join("");
}break;}}if(type<9){last_tok=tok;}});while(stack.length){err.push({t:"Not closed: "+(n=t[2],t=stack.pop(),n),pos:formatPos(lines,t[t.length-2]),toString:errToString});
}if(mode_tok){err.push({t:"Blockmode not closed of "+b[0],pos:formatPos(lines,t[t.length-1]),toString:errToString});
}return{tree:t,lines:lines,err:err};};this.dump=function(s,t,level){for(var i=0;
i<t.length;i+=3){var type=t[i];if(type==2){this.dump(s,t[i+2],level+1);}else{s.push(Array(level).join("----"),type," ",t[i+2],"\n");
}}};this.line=function(lines,pos){for(var i=0,j=lines.length;i<j&&lines[i]<pos;
i++){}return{line:i+1,col:pos-lines[i-1],toString:posToString};};this.scan=function(t,tag_prefix,classes,err,in_struct,scope,outer,base_class){};
})();apf.lm=new (function(){var statement_lut={"var":1,"for":1,"while":1,"do":1,"if":1,"else":1,"switch":1,"case":1,"break":1,"continue":1,"default":1,"function":2,"return":1,"try":1,"catch":1,"throw":1,"debugger":1,alert:1,confirm:1,setTimeout:1,setInterval:1,"delete":1,"export":1,"import":1,label:1,foreach:1,each:1,eachrev:1,foreachrev:1,node:1,local:1,yield:1,let:1,"finally":1,"delete":1},type_lut={"\n":1,"\r\n":1,"==":2,"++":2,"--":2,'"':5,"'":5,"<!--":6,"-->":6,"/*":6,"//":6,"*/":6,"{":7,"}":8,"[":9,"]":10,"(":11,")":12,"<":13,">":14,"+=":2,"-=":2,"/=":2,"*=":2,"!=":2},type_close={"{":"}","[":"]","(":")","{{":"}"},xpath_axes={ancestor:1,"ancestor-or-self":1,attribute:1,child:1,descendant:1,"descendant-or-self":1,following:1,"following-sibling":1,namespace:1,parent:1,preceding:1,self:1},misc_tok={";":1,",":2,"^":3,"=":4,"+=":4,"-=":4,"/=":4,"*=":4,"/":5,":":6},xpath_lut_code={"~":"_val(_n,","%":"_nod(_n,","*":"_nods(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_text={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_attr={"~":"_val(_n,","%":"_val(_n,","*":"_val(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_node,xpath_lut_node_normal={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_node_langedit={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lnged("},pre_regexp={"[":1,"(":1,",":1,"=":1,"return":1,"throw":1},pre_xpath={"else":1,"return":1,"delete":1},pre_plain={"do":1,"else":1,"try":1},op_lut={"=":"_asn(","+=":"_add(","-=":"_sub(","/=":"_div(","*=":"_mul("},new_block={"+":1,"%":1,"-":1,"/":1,"=":1,"(":1,"?":1,"|":1,"^":1,"[":1,"&":1,"*":1,"!":1,":":1,"<":1,",":1},out_context_word={"{":1,"} ":1,")":1,")   ":1,";":1,"\n":1,"else":1},out_context_paren={"{":1,";":1,"\n":1,"else":1},markup_in_code_lut={"} ":1,")   ":1,"(":1,";":1,"&":1,"^":1,"|":1,",":1,'"':1,"'":1,"=":1,"!=":2,"+=":2,"-=":2,"/=":2,"*=":2,"?":1,"{":1,"}":1,">":1,"[":1,"+":1,":":1,"else":1,"return":1},block_autoappend={'"':1,"'":1,">":1,"]":1,"}":1},unesc_lut={'\\"':'"',"\\'":"'","\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\"},call_exclusion={alert:1,confirm:1,setTimeout:1,setInterval:1,"switch":1,call:1,"return":1,"throw":1,"case":1,"catch":1,abs:1,acos:1,asin:1,atan:1,atan2:1,ceil:1,cos:1,exp:1,floor:1,log:1,max:1,min:1,pow:1,random:1,round:1,sin:1,sqrt:1,tan:1,lin:1,linear:1,idx:1,sort:1,"typeof":1},is_out_space={" ":1,"\n":1},newline_notallowed={"{":1,";":1,"(":1,"\n":1},unesc_str={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")"},unesc_txt={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\\\\\\\","\\":"\\\\","\\<":"<","\\>":">"},xml_code_operators={lte:"<=",gte:">=",lt:"<",gt:">",and:"&&",or:"||",andbin:"&",orbin:"|",LTE:"<=",GTE:">=",LT:"<",GT:">",AND:"&&",OR:"||",ANDBIN:"&",ORBIN:"|"},xpath_macro={0:"_val(_n,",1:"_valcr(_n,_cr,",2:"_nod(_n,",3:"_nodcr(_n,_cr,",4:"_nods(_n,",5:"_xpt(_n,",6:"_valst(_n,",7:"_valed(_n,",8:"_valattr(_n,",foreach:"_nods(_n,",each:"_nods(_n,",foreachrev:"_nods(_n,",eachrev:"_nods(_n,",xabs:"_valst(_n,",local:"_nod(_n,",tagName:"_nod(_n,",localName:"_nod(_n,",xml:"_xmlq(",_call:"_val(_n,"},xpath_model={"_val(_n,":"_valm(","_valcr(_n,_cr,":"_valcr(0,_cr,","_nod(_n,":"_nodm(","_nodcr(_n,_cr,":"_nodcr(0,_cr,","_nods(_n,":"_nodsm(","_argwrap(_n,":"_argwrapm(","_xml(_n,":"_xml(0,","_xmls(_n,":"_xmls(0,","_cnt(_n,":"_cntm(","_xpt(_n,":"_xptm(","_valst(_n,":"_valm(","_valed(_n,":"_valed(0,","_lng(":"_lng(","_lnged(":"_lnged("},parserx=/(\r?[\n]|\/\*|\*\/|\/\/|\<\!\-\-|\-\-\>|[=\!+\/\*-]=|\+\+|\-\-|["'{(\[\])}\]\<\>]|$)|([ \t]+)|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF.$_][\w.$_]*)|(\d[x\d.]*)|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>]?)/g,selfrx=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g,macro_o={},macro_c={},macro_m={},c_async_lut=apf.$asyncObjects||{comm:1,rpc:1,http:1,"apf.ajax":1},c_process_async,c_xpathmode,c_elemxpath,c_statexpath,c_injectself,c_propassign,c_export,o,ol,o_asyncs,o_xpathpairs,o_props,o_segs,o_xpaths,o_models,s=[],sl,bt=[],bts=[],parse_mode,scope,segment,start_tok,str,str_len,line_no,nesting,last_tok,last_type,last_dot,last_model,last_prop,last_cmt_mode,last_cmt_tok,last_cmt_type,last_line,last_ns,last_word;
macro_o["if"]="if(",macro_c["if"]=")",macro_o["while"]="while(",macro_c["while"]=")",macro_o["for"]="for(",macro_c["for"]=")",macro_o["switch"]="switch(",macro_c["switch"]=")",macro_o["catch"]="catch(",macro_c["catch"]=")",macro_c["function"]=")  ";
macro_o.foreach=macro_o.each="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(",macro_c.foreach=macro_c.each=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-2]++])||(_t.length-=2,_n=_t.pop(),0);)",macro_o.foreachrev=macro_o.eachrev="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(",macro_c.foreachrev=macro_c.eachrev=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-1].length-(_t[_t.length-2]++)-1])||(_t.length-=2,_n=_t.pop(),0);)",macro_o.local="\nfor(var _t=_t||[],_t=(_t.push(_n,((_n=_local(",macro_c.local=")),1)),_t);(_t[_t.length-1]--&&_n)||(_t.length--,_n=_t.pop(),0);)",macro_o._editlm="_valedx(true, ",macro_o._editnormal="_valedx(false, ",macro_c.edit=")",macro_o.xabs="  (  ",macro_c.xabs="  )  ",macro_o.localName="_localName(_n",macro_c.localName=")",macro_o.output="_o.join(''",macro_c.output=")",macro_o.reset="(_o=[],l=0",macro_c.reset=")",macro_o.index="apf.getChildNumber.call(apf",macro_c.index=")",macro_o.item="(_t[_t.length-1][_t[_t.length-2]-1]",macro_c.item=")",macro_o.first="(_t[_t.length-2]==1",macro_c.first=")",macro_o.last="(_t[_t.length-2]==_t[_t.length-1].length",macro_c.last=")",macro_o.total="(_t[_t.length-1].length",macro_c.total=")",macro_o.pos="(_t[_t.length-2]-1",macro_c.pos=")",macro_o.tagName="_tagName(_n",macro_c.tagName=")",macro_o._nodeValue="_nodeValue(_n",macro_c._nodeValue=")",macro_c.async="])",macro_c.precall="])",macro_c._call=")";
var call_args_lut={_call:".call(_n",localName:macro_o.localName,tagName:macro_o.tagName,nodeValue:macro_o.nodeValue,index:macro_o.index},cf_block_o="(function(){var _o=[],_l=0;\n",cf_block_c=";return _l==1?_o[0]:_o.join('');})()",cf_async_o="_async(_n,_c,_a,_w,_f,this,",cf_async_m="',_a[++_a.i]||[",cf_obj_output="_r=",cf_mode_output,cf_str_output="_o[_l++]=",cf_def_output="",cf_func_o="{var _o=[],_l=0,_n=this;\n",cf_func_c=";\nreturn _l==1?_o[0]:_o.join('');}",cc_async_o="(_a=_a||{}).i=0;try{\n",cc_async_c="}catch(_e){if(_e.x)return;throw(_e);}\n",cc_pc_o="(_a=_a||{}).i=0;try{_precall(_w);",cc_pc_c="}catch(_e){if(_e.x)return;throw(_e);}",cc_opt_o="with(_w){",cc_opt_c="}",cc_v_blk_o="var _o=[],_l=0;_o[_l++]=",cc_v_blk_ob="var _o=[],_l=0;\n",cc_v_blk_c=";\nreturn _ret(_l==1?_o[0]:_o.join(''));",cc_v_blk_cb=";\n_c(_ret(_l==1?_o[0]:_o.join('')),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",cc_v_ret_o="return _ret(",cc_v_ret_c=");",cc_v_cb_o="_c(_ret(",cc_v_cb_c="),apf.SUCCESS,apf.$lmx);apf.$lmx=null;\n",cc_o_blk_o="var _r=",cc_o_blk_ob="var _r;",cc_o_blk_c=";\nreturn _r;",cc_o_blk_cb=";\n_c(_r,apf.SUCCESS,apf.$lmx);apf.$lmx=null;",cc_o_blk_ce=";\n_c(0,apf.SUCCESS,apf.$lmx);apf.$lmx=null;;",cc_o_ret_o="return ",cc_o_ret_c="",cc_o_cb_o="_c(",cc_o_cb_c=",apf.SUCCESS);",cc_f_async_o="var _f=function(_n,_c,_w,_a){",cc_f_opt_o="var _f=function(_n,_w){",cc_f_o="var _f=function(_n){",cc_fc_async_o="var _f=function(_n,_c,_w,_cr,_a){",cc_fc_opt_o="var _f=function(_n,_w,_cr,){",cc_fc_o="var _f=function(_n,_cr){",cc_fe_async_o="var _f=function(event,_c,_w,_a,_n){",cc_fe_opt_o="var _f=function(event,_w,_n){",cc_fe_o="var _f=function(event,_n){",cc_f_c="}",cc_f_match_o="var _f=function(_m){",cc_m_m_blk=";\nif(_n=_r){if(!_n.nodeType)_n=_m;",cc_m_m_value_o=";\nif(_n=",cc_m_m_value_c="){if(!_n.nodeType)_n=_m;",cc_m_v_string="\nreturn ",cc_m_v_o="\nreturn _ret(",cc_m_v_c=");",cc_m_n_string="\nreturn _n;",cc_m_n_o="\nreturn (_r = (",cc_m_n_c="))?(_r.nodeType?_r:_n):(_r===null?null:_n);",cc_m_o="var _r, _n = _m;",cc_m_brk=";\n_n = _m;",cc_m_v_ret="\nreturn _ret(_nodeValue(_n));",cc_m_n_ret="\nreturn _n;",cc_m_c="\n}";
function switchToBlock(no_output){var u,v;if(o[scope-1]=="{{"){u=scope-1;}else{for(v=sl-2,u=0;
v>=0&&o[u=(s[v]&268435455)-1]!="{{";v-=2){}}if(!no_output&&ol>u+1){o[u]=cf_block_o+cf_str_output;
}else{o[u]=cf_block_o;}parse_mode=1;}function parser(tok,rx_lut,rx_white,rx_word,rx_num,rx_misc,pos){var u,v,w,type=rx_lut?type_lut[rx_lut]:(rx_white?0:(rx_word?3:(rx_num?4:(tok?2:15))));
switch(parse_mode){case 0:case 1:switch(type){case 0:if((last_type==3&&last_tok!="$")||last_type==4){o[ol++]=" ";
}else{if(xpath_lut_code[last_tok]){last_type=0;}}break;case 1:line_no++,last_line=pos;
if(o[ol-1]!="\n"&&!newline_notallowed[last_tok]){o[ol++]="\n";}if(xpath_lut_code[last_tok]){last_type=0;
}break;case 2:if(v=misc_tok[tok]){switch(v){case 1:if(!s[sl-1]){o[ol++]=")",sl-=2;
}if(!parse_mode){if(o[ol-1]!="\n"&&last_tok!="{"&&last_tok!=";"){o[ol++]="\n";}}else{if(!sl||s[sl-1]){o[ol++]=";";
}}break;case 2:if(!s[sl-1]){o[ol++]=")",sl-=2;}o[ol++]=",";break;case 3:if(o[ol-1]=="\n"||o[ol-1]==";"||last_tok=="{"||last_tok=="} "||ol==scope){if(!parse_mode){switchToBlock();
}o[ol++]="  ";}else{o[ol++]="^";}break;case 4:if(last_tok!="<"&&last_tok!=">"){if(!parse_mode&&o[scope-1]!="("){switchToBlock(true);
}o[ol++]=tok;for(v=ol;v>=scope&&!statement_lut[o[v]]&&!((o[v]=="  "||o[v]==(nesting?cf_str_output:cf_mode_output))&&(o[v]="",1));
v--){}if(last_type==3&&last_dot>0&&last_tok.charAt(0)!="."){if(c_propassign){ol-=2;
while(is_out_space[o[ol]]){ol--;}w=last_tok;o[ol++]=op_lut[tok],o[ol++]=w.slice(0,last_dot),o[ol++]=",'",o[ol++]=w.slice(last_dot+1),o[ol++]="',",s[sl++]=scope|(parse_mode<<28),s[sl++]="";
}}}else{o[ol++]=tok;}break;case 5:if(pre_regexp[last_tok]){s[sl++]=scope|(parse_mode<<28);
s[sl++]=o[ol++]=tok;scope=segment=ol-1;nesting++,parse_mode=5,start_tok=tok;}else{o[ol++]="/";
}break;case 6:if(sl>2&&s[sl-1]=="{{"&&(ol<scope+4&&last_type==5)||(ol<scope+3&&(last_type==3||last_type==4))){o[scope-1]=s[sl-1]="{";
parse_mode=(v=s[sl-2])>>28;s[sl-2]=v&268435455,nesting--;}else{if(o[ol-3]=="case"||(last_type==5&&last_word=="case")){tok=";";
}}o[ol++]=":";break;default:o[ol++]=tok;break;}}else{o[ol++]=unesc_lut[tok]||tok;
}break;case 3:case 4:if(v=xml_code_operators[tok]){o[ol++]=tok=v,type=2;}else{v=u=w=0;
last_dot=(last_word=tok).lastIndexOf(".");if(tok.charAt(0)!="."&&((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)||(w=statement_lut[tok]))&&!parse_mode){if(w==2&&s[sl-1].indexOf("{")){w=0;
}switchToBlock(w);}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v&&parse_mode&&!statement_lut[tok]&&!call_exclusion[tok]){o[ol++]=(nesting?cf_str_output:cf_mode_output);
}if(last_dot>0&&tok.charAt(0)!="."){o_props[o[ol++]=last_prop=tok]=1;}else{o[ol++]=tok;
}}break;case 5:if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]="+";}}s[sl++]=scope|(parse_mode<<28),s[sl++]=o[ol++]=tok;
scope=segment=ol-1,nesting++,parse_mode=5,start_tok=tok;break;case 6:if(tok=="*/"||tok=="-->"){throw {t:"Unmatched comment "+tok,p:pos};
}last_cmt_mode=parse_mode,last_cmt_tok=last_tok,last_cmt_type=last_type,parse_mode=6,start_tok=tok;
break;case 7:if(o[ol-1]==")  "||(o[ol-2]==")  "&&ol--)){if(s[sl-1]!="("&&s[sl-1]!="["){s[sl++]=scope|(parse_mode<<28),s[sl++]="{{",o[ol++]=cf_func_o,scope=ol,parse_mode=1,nesting++,o[ol++]="";
}else{s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=ol;parse_mode=1;}}else{if((macro_o[s[sl+1]]&&last_tok==")   ")||pre_plain[last_tok]){s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=ol;
o[ol++]="";}else{if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+''+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]=(last_tok=="}")?"+''+":"+";}}s[sl++]=scope|(parse_mode<<28),s[sl++]=o[ol++]="{{";
if(!nesting&&scope!=ol){o_segs++;}nesting++,segment=scope=ol,parse_mode=0;}}break;
case 8:if(!s[sl-1]){o[ol++]=")",o[ol++]="\n",sl-=2;}if(type_close[v=s[--sl]]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}if(v=="{{"){if(scope==ol-1){if((s[sl-1]>>28)<=1){o[scope-1]="{",o[ol-1]="}";}else{o[scope-1]=o[ol-1]="'";
}}else{if(!parse_mode){o[scope-1]="(",o[ol-1]=")";}else{if(o[scope-1]==cf_func_o){if(scope==ol-2){o[scope-1]="{",o[ol-1]="}";
}else{o[ol-1]=cf_func_c;}}else{o[ol-1]=cf_block_c;}}}parse_mode=(v=s[--sl])>>28,scope=v&268435455;
segment=ol,nesting--;if(!nesting){o_segs++;}if(parse_mode==7){o[ol++]='+"\\"',parse_mode=4;
}}else{scope=s[--sl];}break;case 9:if(((last_type==3&&!pre_xpath[last_tok]&&last_tok!="$")||last_tok==")"||last_tok=="]")&&o[ol-1]!="\n"){o[ol++]="[",s[sl++]=scope|(parse_mode<<28),s[sl++]=tok,segment=scope=ol;
}else{last_model=null;if((w=xpath_lut_code[last_tok])){ol--,last_tok=o[ol-1];}else{w=xpath_macro[s[sl-1]]||xpath_macro[nesting?0:c_xpathmode];
}if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&(ol>scope||s[sl-1].length==1))&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]="+";}}if(!nesting&&ol!=scope){o_segs++;
}nesting++,s[sl++]=scope|(parse_mode<<28),s[sl++]=o[ol++]=w,segment=scope=ol,bt[scope]=pos,parse_mode=3;
}break;case 10:if(!s[sl-1]){o[ol++]=")",sl-=2;}if(type_close[v=s[--sl]]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}scope=s[--sl]&268435455;break;case 11:if(((v=(u=((out_context_paren[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope))&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v&&parse_mode){o[ol++]=(nesting?cf_str_output:cf_mode_output),last_type=0;}if(w=macro_o[last_tok]){if(o[ol-1]==" "){ol--;
}o[ol-1]=w,s[sl++]=scope,s[sl++]=last_tok,scope=segment=ol;}else{if(last_type==3){if(last_dot<0){v=0;
if(last_tok=="function"||o[ol-3]=="function"||o[ol-4]=="function"){s[sl++]=scope,s[sl++]="function",o[ol++]="(",scope=segment=ol;
if(last_tok!="function"&&c_export&&sl==4){o[v=(o[ol-4]=="function")?(ol-4):(ol-5)]="var "+last_tok+" = "+c_export+"."+last_tok+" = function";
o[v+2]="";}}else{if(!call_exclusion[last_tok]&&o[ol-3]!="new"){o[ol++]=".call(_n",s[sl++]=scope,s[sl++]="_call",scope=segment=ol;
}else{s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=segment=ol;}}}else{if(last_dot>1&&c_process_async&&(c_async_lut[v=last_tok.substring(0,last_dot)]||c_async_lut[v=last_tok])){if(o[--ol]==" "){ol--;
}o[ol++]=cf_async_o,o[ol++]=v,o[ol++]=",'";o[ol++]=last_tok.slice(last_dot+1);o[ol++]=cf_async_m,s[sl++]=scope,s[sl++]="async",scope=segment=ol,o_asyncs++;
}else{if(last_tok.indexOf(".")!=last_dot){o_props[last_tok.slice(0,last_dot)]=1;
}s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=segment=ol;}}}else{s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=segment=ol;
}if(last_tok==last_prop){delete o_props[last_tok];}}break;case 12:if(!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(w=macro_c[v=s[--sl]]){if(v!="_call"){tok=")   ";}if((u=call_args_lut[v])&&u!=o[ol-1]){o[scope-1]=u+",";
}o[ol++]=w;}else{if(type_close[v]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}}scope=s[--sl]&268435455;break;case 13:if(ol==scope||markup_in_code_lut[last_tok]||o[ol-1]=="\n"){if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+''+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]="+";}}last_ns=null,o[ol++]='"',o[ol++]="<",nesting++,s[sl++]=scope|(parse_mode<<28),sl+=3,s[sl-2]=s[sl-1]=0;
segment=scope=ol-1,parse_mode=4;}else{o[ol++]="<";}break;case 14:o[ol++]=">";break;
case 15:if(sl&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}break;}break;case 2:switch(type){case 1:line_no++,last_line=pos;if(ol!=scope&&ol!=segment){o[ol++]="\\n";
}break;case 2:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=unesc_txt[tok]||tok;
break;case 3:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}o[ol++]=(tok=='"')?'\\"':"'";break;case 7:if(ol==segment){if(ol!=scope){o[ol++]="+";
}}else{o[ol++]='"+',nesting||o_segs++;}s[sl++]=scope|536870912,s[sl++]=o[ol++]="{{",nesting++,segment=scope=ol,parse_mode=0;
break;case 9:last_model=null;if((w=xpath_lut_text[last_tok])&&o[ol-1]==last_tok){if(--ol-1==scope){ol--;
}}else{w=xpath_macro[(nesting||scope!=ol)?0:c_xpathmode];}if(ol!=scope){o[ol]=(ol++==segment)?"+":(nesting||o_segs++,'"+');
if(!nesting){o_segs++;}}s[sl++]=scope|536870912,s[sl++]=o[ol++]=w,segment=scope=ol,nesting++,parse_mode=3;
break;case 15:if(sl){throw {t:"Unclosed "+s[sl-1]+" found at end in textmode",p:pos};
}if(ol!=scope&&ol!=segment){o[ol++]='"',nesting||o_segs++;}break;default:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}o[ol++]=tok;}break;case 3:switch(type){case 0:if(ol!=scope){if(ol==segment){o[ol++]='+"';
}o[ol++]=tok;}break;case 1:line_no++,last_line=pos;break;case 2:if(tok==":"&&last_tok==":"&&!xpath_axes[w=o[ol-2]]&&((v=s[sl-2])>>28)!=6){if(o[ol-2]=='+"'){o[ol-2]=o[ol-1]="",last_model="#";
}else{o[ol-1]='"';if(segment==scope){last_model=o.slice(segment+1,ol-1).join("");
}else{last_model="#";}}if(!(w=xpath_model[o[scope-1]])){throw {t:"Invalid model found for: "+o[scope-1],p:pos};
}o[scope-1]=w,o[ol++]=",",segment=scope=ol;}else{if(tok==","&&(v=(s[sl-2]>>28))<=1){ol=scope-1,u=str.slice(bt[scope]+1,pos+1);
last_type=9,parse_mode=v,o[ol++]=last_tok="[";s[sl-2]=(s[sl-2]&268435455)|(parse_mode<<28),s[sl-1]=last_tok,segment=scope=ol,nesting--;
if(!nesting){o_xpaths--;}if(u.length>1){bts.push(str);(str=u).replace(parserx,parser);
str=bts.pop();}}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=unesc_lut[tok]||tok;
}}break;case 3:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}if(s[sl-1]=="["){s[sl-1]=tok;}else{if(s[sl-1]==tok){s[sl-1]="[";}}if(tok=='"'){o[ol++]="\\";
}o[ol++]=tok;break;case 7:if(ol==segment){if(ol!=scope){o[ol++]="+''+";}}else{o[ol++]='"+';
}s[sl++]=scope|805306368,s[sl++]=o[ol++]="{{",nesting++,segment=scope=ol,parse_mode=0;
if(last_model&&s[sl-3]!=xpath_lut_text["$"]){o_xpathpairs.push(last_model,"#");
last_model=null,o_models++;}break;case 9:if(s[sl-1]=="'"||s[sl-1]=='"'||((last_type!=3||last_tok=="$")&&last_tok!=")"&&last_tok!="]")){if(last_model){o_xpathpairs.push(last_model,"#"),o_models++;
}last_model=null;if((w=xpath_lut_text[last_tok])&&o[ol-1]==last_tok){ol--;}else{w=xpath_macro[0];
}if(ol==segment){if(ol!=scope){o[ol++]="+";}}else{o[ol++]='"+';}s[sl++]=scope|805306368,s[sl++]=o[ol++]=w,nesting++,segment=scope=ol,parse_mode=3;
}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}s[sl++]=scope|1610612736,s[sl++]=o[ol++]="[";
}break;case 10:sl--,parse_mode=(w=s[--sl])>>28,w=w&268435455;if(parse_mode==6){if(s[sl+1]!="["){throw {t:"In xpath, cannot close "+s[sl+1]+" with "+tok,p:pos};
}if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]="]";parse_mode=3;}else{if(ol==scope){if((s[sl]>>28)<=1){o[scope-1]="[",o[ol++]="]";
}else{o[scope-1]=o[ol++]='"';}segment=ol;}else{if(ol!=segment){o[ol++]='"';}if(segment==scope){v=o.slice(segment+1,ol-1).join("");
if(c_injectself&&o[scope-1]!=","&&v!=(u=v.replace(selfrx,"$1self::"))&&s[sl+1]!=xpath_lut_text["$"]){o[scope+1]=v=u;
for(u=scope+2;u<ol-1;u++){o[u]="";}}}else{if((u=o[scope-1])!=","){v="#";if(c_injectself){o[scope-1]=u+"_injself(",o[ol++]=")";
}}else{v="";}}if(s[sl+1]!=xpath_lut_text["$"]&&v){o_xpathpairs.push(last_model,v);
if(last_model){o_models++;}}o[ol++]=") ",segment=ol;if(parse_mode==7){o[ol++]='+"\\"',parse_mode=4;
}}nesting--,last_model=null;if(!nesting){o_segs++,o_xpaths++;}}scope=w;break;case 11:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}s[sl++]=scope|805306368,s[sl++]=o[ol++]="(";break;case 12:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}if(type_close[v=s[--sl]]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}scope=s[--sl]&268435455;break;case 15:throw {t:"Unexpected end whilst parsing xpath",p:pos};
break;default:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=tok;break;}break;
case 4:switch(type){case 0:if(ol==segment){o[ol++]='+"';}o[ol++]=" ",last_type=0;
break;case 1:if(ol==segment){o[ol++]='+"';}line_no++,last_line=pos,o[ol++]="\\n",last_type=1;
break;case 2:if(ol==segment){o[ol++]='+"';}if(tok=="/"&&last_tok=="<"){sl-=4;if(s[sl]||s[sl+2]){throw {t:"Unexpected closing tag whilst parsing xml",p:pos};
}}else{if(tok==":"&&last_type==3&&o[ol-2]=="<"){last_ns=last_tok;}}o[ol++]=unesc_txt[tok]||tok;
break;case 3:if(ol==segment){o[ol++]='+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(ol==segment){o[ol++]='+"';}if(tok=='"'){o[ol++]="\\";
}o[ol++]=tok;break;case 6:if(tok=="//"&&!s[sl-1]){if(ol==segment){o[ol++]='+"';
}o[ol++]=tok;}else{if(tok=="*/"){throw {t:"Unmatched comment "+tok,p:pos};}last_cmt_mode=parse_mode,last_cmt_tok=last_tok,last_cmt_type=last_type,parse_mode=6,start_tok=tok;
}break;case 13:last_ns=null;if(ol==segment){o[ol++]='+"';}o[ol++]=tok,s[sl]=s[sl+2]=0,sl+=4,s[sl-1]=0;
break;case 14:if(ol==segment){o[ol++]='+"';}o[ol++]=tok;if(last_tok!="<"){if(last_tok=="/"){sl-=4;
if(s[sl+2]){throw {t:"Unexpected / whilst parsing xml",p:pos};}if(o[ol-3]=="<"){ol-=2,o[ol-1]="";
}}else{sl-=2;}if(s[sl]){nesting--,o[ol++]='"',scope=s[sl],segment=ol,parse_mode=scope>>28,scope=scope&268435455;
}else{s[sl-1]=1;}}else{ol--,o[ol-1]="";}break;case 9:last_model=null;if(last_tok=="!"&&o[ol-2]=="<"&&!s[sl-1]){o[ol++]=tok,s[sl++]=scope|(parse_mode<<28);
s[sl++]="]]>",scope=segment=ol-1;nesting++,parse_mode=5;}else{if(s[sl-1]){if((v=xpath_lut_node[last_tok])){ol--;
}else{v=xpath_macro[c_elemxpath];}s[sl++]=scope|1073741824;}else{s[sl++]=scope|1073741824;
if((v=xpath_lut_attr[last_tok])){ol--;if(o[ol-1]=="="){last_tok="=";}}else{v=xpath_macro[last_ns?c_statexpath:8];
}if(last_tok=="="){o[ol++]='\\"',s[sl-1]=scope|1879048192;}}o[ol]=(ol++==segment)?"+''+":'"+';
nesting++,s[sl++]=o[ol++]=v,segment=scope=ol,parse_mode=3;}break;case 7:if(!s[sl-1]&&last_tok=="="){o[ol++]='\\"',s[sl++]=scope|1879048192;
}else{s[sl++]=scope|1073741824;}o[ol]=(ol++==segment)?"+''+":'"+';s[sl++]=o[ol++]="{{",nesting++;
segment=scope=ol,parse_mode=0;break;default:if(ol==segment){o[ol++]='+"';}o[ol++]=tok;
break;case 15:throw {t:"Unexpected end whilst parsing xml",p:pos};break;}break;
case 5:switch(type){case 1:line_no++,last_line=pos;if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}o[ol++]="\\n";break;case 2:if(tok=="/"&&s[sl-1]=="/"){o[ol++]="/",scope=s[sl-=2],segment=ol,parse_mode=scope>>28,scope=scope&268435455,nesting--;
}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=(s[sl-1]!="/"&&unesc_str[tok])||tok;
}break;case 3:if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(s[sl-1]==tok){if(scope!=segment){o[ol]=(ol++!=segment)?(tok+")"):")";
}else{o[ol++]=tok;}scope=s[sl-=2],segment=ol,parse_mode=scope>>28;scope=scope&268435455,nesting--;
}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=tok=='"'?'\\"':tok;
}break;case 6:if(s[sl-1]=="/"&&tok=="*/"){o[ol++]="*/",scope=s[sl-=2],segment=ol,parse_mode=scope>>28,scope=scope&268435455,nesting--;
}else{if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}o[ol++]=tok;}break;case 7:if(s[sl-1]!="'"&&s[sl-1]!="/"){if(s[sl-1]=='"'){o[scope]='("';
}if(ol==segment){if(ol!=scope){o[ol++]="+";}}else{o[ol++]='"+';}s[sl++]=scope|1342177280,o[ol++]=s[sl++]="{{",nesting++,segment=scope=ol,parse_mode=0;
}else{o[ol++]=tok;}break;case 9:if(s[sl-1]!="'"&&s[sl-1]!="/"&&(s[sl-1]=='"'&&(o[scope]='("')||ol!=scope+2||last_tok!="CDATA")){last_model=null;
if((w=xpath_lut_text[last_tok])&&o[ol-1]==last_tok){ol--;}else{w=xpath_macro[0];
}if(ol!=scope){o[ol]=(ol++==segment)?"+":'"+';}s[sl++]=scope|1342177280,s[sl++]=o[ol++]=w,segment=scope=ol,nesting++,parse_mode=3;
}else{o[ol++]=tok;}break;case 14:if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}o[ol++]=tok;
if(s[sl-1]=="]]>"&&last_tok=="]"&&o[ol-3]=="]"){scope=s[sl-=2],parse_mode=scope>>28;
scope=scope&268435455,nesting--;sl-=4;if(s[sl]){nesting--,o[ol++]='"',scope=s[sl],segment=ol,parse_mode=scope>>28,scope=scope&268435455;
}else{s[sl-1]=1;}}break;case 15:throw {t:"Unexpected end whilst parsing string",p:pos};
break;default:if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}o[ol++]=tok;break;}break;
case 6:switch(type){case 1:line_no++,last_line=pos;if(start_tok=="//"){parse_mode=last_cmt_mode,tok=last_tok=last_cmt_tok,type=last_type=last_cmt_type;
}break;case 6:if((start_tok=="/*"&&tok=="*/")||(start_tok=="<!--"&&tok=="-->")){parse_mode=last_cmt_mode,tok=last_tok=last_cmt_tok,type=last_type=last_cmt_type;
}break;case 15:if(start_tok!="//"){throw {t:"Unexpected end whilst parsing comment",p:pos};
}else{parse_mode=last_cmt_mode,tok=last_tok=last_cmt_tok,type=last_type=last_cmt_type;
if(sl&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}}break;}break;}if(type>1){last_tok=tok,last_type=type;}}this.lastCode=function(){if(typeof(o)=="object"){return o.join("");
}return o;};function handleError(e,last_line,part,linenr){if(e.t){throw new Error(apf.formatErrorString(0,null,"Parsing live markup source","Error whilst parsing: "+e.t+" on line:"+line_no+" col:"+(e.p-last_line-2)+(part?(" part: "+part):"")+"\n"+str));
}else{throw new Error(apf.formatErrorString(0,null,"Compiling live markup function on line "+linenr,"Error whilst compiling: "+e.message+"\nInput:\n"+str+"\nGenerated:\n"+apf.lm.lastCode()));
}}var cache={},emptyCfg={};this.resetCache=function(){cache={};};var lmcache_rx=/^\s*~~(c\d+)~~/;
this.compile=function(istr,cfg){if(!cfg){cfg=emptyCfg;}if(istr==null||!istr.length){return(cfg.nostring||cfg.event)?function(){return istr;
}:{type:2,str:istr};}var c,f,is_single_prop;if(istr.charAt(0)=="~"&&(c=istr.match(lmcache_rx))){if(c=apf.lm_exec[c[1]]){return c;
}alert("ERROR, undefined live markup cache marker found:"+istr);return{type:2,str:istr};
}var key=(cfg.xpathmode|(cfg.withopt&&16)|(cfg.precall&&32)|(cfg.alwayscb&&64)|(cfg.nostring&&128)|(cfg.parsecode&&256)|(cfg.nostate&&512)|(cfg.liveedit&&1024)|(cfg.langedit&&2048)|(cfg.injectself&&4096)|(cfg.event&&8192)|(cfg.funcglobal&&16384))+istr;
if(c=cache[key]){return c;}c_injectself=cfg.injectself,c_xpathmode=cfg.xpathmode||0,c_statexpath=cfg.nostate?0:6,c_elemxpath=0;
c_export=cfg.funcglobal?"self":(cfg.withopt?"_w":null);c_process_async=!cfg.event;
xpath_macro.edit=cfg.liveedit?"_argwrap(_n,":"_argwrap(_n,";macro_o.edit=cfg.liveedit?macro_o._editlm:macro_o._editnormal;
xpath_lut_node=cfg.langedit?xpath_lut_node_langedit:xpath_lut_node_normal;o_props={},o_xpathpairs=[],s=[],o=["","","",""],str=istr,str_len=str.length;
ol=scope=segment=o.length,o_segs=o_xpaths=o_asyncs=o_models=nesting=line_no=last_type=last_line=0;
if(cfg.parsecode){parse_mode=0,sl=2,s[0]=ol,s[1]="{{",last_tok="{",cf_mode_output=cfg.event?"":(c_xpathmode<=1?cf_str_output:cf_obj_output);
}else{parse_mode=2,sl=last_tok=0,cf_mode_output=cf_str_output;}if(cfg.nothrow){str.replace(parserx,parser);
}else{try{str.replace(parserx,parser);}catch(e){handleError(e,last_line);return null;
}}if(cfg.parsecode){if(nesting||s[sl-1].length==1){handleError({t:"Unclosed "+s[sl-1]+" found at end in codemode",p:str_len},last_line);
}if(segment!=ol){o_segs++;}}else{if((ol==7||ol==8)&&o_segs==1){is_single_prop=0;
for(c in o_props){is_single_prop++;}if(is_single_prop!=1){is_single_prop=0;}}}if((!cfg.nostring&&!cfg.event)&&(parse_mode==2&&segment==4||ol==4)){return{type:2,str:o.slice(5,-1).join("").replace(/\\n/g,"\n").replace(/\\"/g,'"')};
}if(o_asyncs||cfg.alwayscb){if(cfg.event){if(parse_mode==1){o[3]="";}o[ol++]=cc_o_blk_ce;
}else{if(c_xpathmode){if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_o_blk_o:cc_o_blk_ob,o[ol++]=cc_o_blk_cb;
}else{o[3]=cc_o_cb_o,o[ol++]=cc_o_cb_c;}}else{if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_v_blk_o:cc_v_blk_ob,o[ol++]=cc_v_blk_cb;
}else{o[3]=cc_v_cb_o,o[ol++]=cc_v_cb_c;}}}if(o_asyncs){if(parse_mode==1){if(cfg.precall){o[2]=cc_pc_o,o[ol-1]=cc_pc_c+o[ol-1];
}else{o[2]=cc_async_o,o[ol-1]=cc_async_c+o[ol-1];}}else{o[ol++]=o[3]+"_r"+o[ol-2];
if(cfg.precall){o[2]=cc_pc_o,o[3]=cc_o_blk_o,o[ol-2]=cc_pc_c;}else{o[2]=cc_async_o,o[3]=cc_o_blk_o,o[ol-2]=cc_async_c;
}}}if(cfg.withopt){o[1]=cc_opt_o,o[ol++]=cc_opt_c;}o[0]=cfg.event?cc_fe_async_o:((c_xpathmode==1||c_xpathmode==3)?cc_fc_async_o:cc_f_async_o);
o[ol++]=cc_f_c;}else{if(cfg.event){if(parse_mode==1){o[3]="";}}else{if(c_xpathmode){if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_o_blk_o:cc_o_blk_ob,o[ol++]=cc_o_blk_c;
}else{o[3]=cc_o_ret_o,o[ol++]=cc_o_ret_c;}}else{if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_v_blk_o:cc_v_blk_ob,o[ol++]=cc_v_blk_c;
}else{o[3]=cc_v_ret_o,o[ol++]=cc_v_ret_c;}}}if(cfg.withopt){o[2]=cc_opt_o,o[ol++]=cc_opt_c;
}o[0]=cfg.event?(cfg.withopt?cc_fe_opt_o:cc_fe_o):(cfg.withopt?((c_xpathmode==1||c_xpathmode==3)?cc_fc_opt_o:cc_f_opt_o):((c_xpathmode==1||c_xpathmode==3)?cc_fc_o:cc_f_o));
o[ol++]=cc_f_c;}if(cfg.nothrow){f=apf.lm_exec.compile(o.join(""));}else{try{f=apf.lm_exec.compile(o.join(""));
}catch(e){if(!apf.isIE){var oErr=window.onerror;window.onerror=function(x,y,line){window.onerror=oErr;
handleError(e,last_line,null,line);return true;};apf.include("","",null,o.join(""));
window.onerror=oErr;}else{handleError(e,last_line);}return null;}}f.type=(o_segs==1&&o_xpaths==1)?3:(is_single_prop?4:1);
f.xpaths=o_xpathpairs,f.models=o_models,f.props=o_props,f.asyncs=o_asyncs;cache[key]=f;
return f;};this.compileMatch=function(strarray,cfg){if(!cfg){cfg=emptyCfg;}o_props={},o_xpathpairs=[],o=[cc_f_match_o,cc_m_o],s=[],nesting=0,ol=o.length,xpath_lut_node=xpath_lut_node_normal;
for(var st,ob,i=0,j=strarray.length;i<j;i+=2){if(str=strarray[i]){str_len=s.length,c_xpathmode=2;
if(i){o[ol++]=cc_m_brk;}o[ol++]="";s[0]=ob=ol=scope=segment=o.length,cf_mode_output=cf_obj_output;
line_no=last_type=o_segs=o_xpaths=o_asyncs=parse_mode=last_line=0;sl=2,s[1]="{{",last_tok="{";
c_injectself=1;if(cfg.nothrow){str.replace(parserx,parser);}else{try{str.replace(parserx,parser);
}catch(e){handleError(e,last_line);return null;}}if(nesting||s[sl-1].length==1){handleError({t:"Unclosed "+s[sl-1]+" found at end in codemode",p:str_len});
}if(o_asyncs){handleError({t:"Asynchronous calls not supported in match/value"});
}if(parse_mode==1){o[ob-1]=(o[ob-1]!=cf_block_o)?cf_mode_output:"",o[ol++]=cc_m_m_blk;
}else{o[ob-1]=cc_m_m_value_o,o[ol++]=cc_m_m_value_c;}}if(str=strarray[i+1]){str_len=s.length;
if(!strarray[i]&&i){o[ol++]=cc_m_brk;}o[ol++]="";ob=ol=scope=segment=o.length,cf_mode_output=cf_str_output;
c_xpathmode=c_injectself=last_tok=sl=line_no=o_segs=o_xpaths=last_type=o_asyncs=last_line=0;
if(cfg.node){c_xpathmode=2;}parse_mode=2,c_injectself=0;if(cfg.nothrow){str.replace(parserx,parser);
}else{try{str.replace(parserx,parser);}catch(e){handleError(e,last_line);return null;
}}if(o_asyncs){handleError({t:"Asynchronous calls not supported in match/value"});
}if(cfg.node){if(parse_mode==2&&segment==ob||ol==ob){o[ob-1]=cc_m_n_string;}else{o[ob-1]=cc_m_n_o,o[ol++]=cc_m_n_c;
}}else{if(parse_mode==2&&segment==ob||ol==ob){o[ob-1]=cc_m_v_string;}else{o[ob-1]=cc_m_v_o,o[ol++]=cc_m_v_c;
}}if(strarray[i]){o[ol++]=cc_m_c;}else{break;}}else{if(!strarray[i]){handleError({t:"Both match and value are empty"});
}if(cfg.node){o[ol++]=cc_m_n_ret;}else{o[ol++]=cc_m_v_ret;}c_xpathmode=2;o[ol++]=cc_m_c;
}}o[ol++]=cc_f_c;var f;if(cfg.nothrow){f=apf.lm_exec.compile(o.join(""));}else{try{f=apf.lm_exec.compile(o.join(""));
}catch(e){handleError(e,last_line);return null;}}f.type=1,f.xpaths=o_xpathpairs,f.props=o_props,f.asyncs=o_asyncs;
return f;};this.setWarnLevel=function(lvl){apf.lm_exec.setWarnLevel(lvl);};this.parseExpression=function(istr,cfg){if(!cfg){cfg=emptyCfg;
}o_props={},o_xpathpairs=[],o=[],s=[],nesting=0,xpath_lut_node=xpath_lut_node_normal;
str=istr,str_len=str.length;ob=ol=scope=segment=o.length,cf_mode_output=cf_str_output;
c_xpathmode=c_injectself=last_tok=sl=line_no=o_segs=o_xpaths=last_type=o_asyncs=last_line=0;
parse_mode=2;if(cfg.nothrow){str.replace(parserx,parser);}else{try{str.replace(parserx,parser);
}catch(e){handleError(e,last_line);return null;}}return o.join("");};})();apf.lm_exec=new (function(){var wlvl=1;
this.setWarnLevel=function(lvl){wlvl=lvl;};function wxpath(x,t){apf.console.warn("Live Markup warning in "+t+", no results for xpath: '"+x+"'");
}function wnode(x,t){apf.console.warn("Live Markup warning in "+t+", xpath on null node: '"+x+"'");
}function wmodel(m,x,t){apf.console.log("Live Markup warning in "+t+", xpath on empty model: '"+m+"' xpath: '"+x+"'");
}function wlang(x,t){apf.console.log("Live Markup warning in "+t+", language symbol not found: '"+x+"'");
}function xmlParse(str){var n=apf.getXmlDom("<_apflmlist_>"+str+"</_apflmlist_>");
if(!n||!(n=n.documentElement)){return null;}return(n.firstChild==n.lastChild)?n.firstChild:n;
}function __val(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(!n.nodeType&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x,"_val"),"");
}var __valattrrx=/(["'])/g;function __valattrrp(m,a){return m=='"'?"&quot;":"&apos;";
}function __valattr(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue.replace(__valattrrx,__valattrrp)||(wlvl>2&&wxpath(x,"_val"),"");
}function __valm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valm"),"");
}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x),"");
}function __nod(n,x){return n?n.selectSingleNode(x):(wlvl>1&&wnode(x,"_nod"),null);
}function _nods(n,x){return n?n.selectNodes(x):(wlvl>1&&wnode(x,"_nods"),[]);}function __nodm(m,x){var n;
if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodm"),null);
}return n.selectSingleNode(x);}function _nodsm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodsm"),[]);
}return n.selectNodes(x);}function __cnt(n,x){return n?n.selectNodes(x).length:(wlvl>1&&wnode(x,"_cnt"),0);
}function __cntm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_cntm"),0);
}return n.selectNodes(x).length;}function _xpt(n,x){return{xpath:x,toString:function(){return"LM Xpath object: "+this.x;
}};}function _xptm(m,x){if(m&&!m.$isModel){var node=m;m=apf.xmldb.findModel(m);
x=apf.xmlToXpath(node,m.data)+"/"+x;}return{model:m,xpath:x,toString:function(){return"LM Xpath object with model: "+this.x;
}};}function _xml(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xml"),"");
}}return(n&&(n=n.selectSingleNode(x)))&&n.xml||(wlvl>0&&!n&&wnode(x,"_xml"),"");
}function _xmls(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xmls"),"");
}}for(var i=0,j=((n=n.selectNodes(x))).length,o=[];i<j;i++){o[i]=n[i].xml;}return o.join("");
}function _valcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valcr"),"");
}}if(cr){apf.createNodeFromXpath(ni,x);}else{if(n=ni.selectSingleNode(x)){return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";
}}return(wlvl>2&&wxpath(x,"_valcr"),"");}function _nodcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodcr"),null);
}}return n.selectSingleNode(x)||(cr&&apf.createNodeFromXpath(n,x));}function _valst(n,x){var m=apf.xmldb.findModel(n);
if(!m){return(wlvl>0&&wmodel(m,x,"_valst"),"");}return"["+m.id+"::"+apf.xmlToXpath(n,m.data,true)+(!x||x=="."?"":"/"+x)+"]";
}function _asn(o,p,v){if(!o||typeof(o)!="object"){throw new Error(apf.formatErrorString(0,0,"LM Property Assign","Cannot assign property on non object, property:"+p));
}if(o.setAttribute){o.setAttribute(p,v);}else{o[p]=v;}return v;}function _add(o,p,v){return _asn(o,p,o&&o[p]+v);
}function _sub(o,p,v){return _asn(o,p,o&&o[p]-v);}function _div(o,p,v){return _asn(o,p,o&&o[p]/v);
}function _mul(o,p,v){return _asn(o,p,o&&o[p]*v);}function _local(n){if(n&&n.charAt&&n.charAt(0)=="<"){return apf.getXmlDom(n).documentElement;
}if(!n&&wlvl>1){wnode("-","_local");}return n;}function _tagName(n1,n2){return(n2&&n2.tagName)||(n1&&n1.tagName);
}function _localName(n1,n2){return(n2&&n2[apf.TAGNAME])||(n1&&n1[apf.TAGNAME]);
}function _nodeValue(n,n2){if(n2){n=n2;}return(n=(n.nodeType!=1&&n||(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";
}var langrx=/(\\*)\$\[(.*?)\]/g;var lang=apf.language;apf.$lm_has_lang=0;function _lngrx(tok,esc,x){apf.$lm_has_lang=1;
if(esc){return"$["+x+"]";}return lang.words[x]||(wlvl>1&&wlang(x,"_lngrx"),"");
}function __ret(r){if(r&&r.indexOf&&r.indexOf("$[")!=-1){return r.replace(langrx,_lngrx);
}return r;}function __lng(x,x2){apf.$lm_has_lang=1;return lang.words[x]||(wlvl>1&&wlang(x,"_lng"),"");
}function _lnged(x,x2){apf.$lm_has_lang=1;return lang.words[x]||(wlvl>1&&wlang(x,"_lnged"),"");
}function _(n,m,x){return'<span class="liveEdit" xpath="'+(n?(m.substr(0,1)!="/"?apf.xmlToXpath(n,null,false):"")+"/"+m:"")+'">'+((n?__val(n,m):__valm(m,x))||"&#32;")+"</span>";
}function _argwrap(n,x){return[n,x];}function _argwrapm(m,x){return[0,m,x];}function _valedx(editMode,args,opt){args[3]=opt;
args[4]=editMode;return _valed.apply(this,args);}function _valed(n,m,x,options,editMode){var res=(n?__val(n,m):__valm(m,x));
if(options&&options.multiline&&options.editor!="richtext"){res=res.replace(/\n/g,"<br />");
}if(editMode!==false){return'<div onmousedown="apf.LiveEdit.mousedown(this, event)" class="liveEdit'+(options&&options.multiline?" liveeditMultiline":"")+(!res&&options&&options.initial?" liveEditInitial":"")+'" xpath="'+(n?((m.substr(0,1)!="/"?apf.xmlToXpath(n,null,false):"")+"/"+m).replace(/([\[\{\}\]])/g,"\\$1"):"")+'"'+(options?' options="'+apf.serialize(options).escapeHTML().replace(/"/g,"&quot;").replace(/([\[\{\}\]])/g,"\\$1")+'"'+(options.editor?' editor="'+options.editor+'"':""):"")+">"+(res||options&&options.initial||"&#32;")+"</div>";
}else{return res;}}var selfrx=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g;function _injself(s){return s.charAt?s.replace(selfrx,"$1self::"):s;
}apf.$lmx=null;function _async(_n,_c,_a,_w,_f,_this,obj,func,args){var i=_a.i,v;
if(!_a.ret){_a.ret=[];}if(_a[i]){return _a.ret[i];}_a[i]=true;if(!obj.exec){return _a.ret[i]=(func)?obj[func].apply(obj,args):obj.apply(obj,args);
}var cb=function(data,state,extra){if(_w){delete _w._pc;}if(state!=apf.SUCCESS){_c(null,state,extra);
}else{apf.$lmx=extra;_a.ret[i]=data;if(_w){_f.call(_this,_n,_c,_w,_a);}else{_f.call(_this,_n,_c,_a);
}}};if(_w&&_w._pc){_w._pc={obj:obj,func:func,args:args,message:obj.createMessage&&obj.createMessage(func,args),_c:_c,cb:cb};
}else{obj.exec(func,args,cb);}throw ({x:1});}function _precall(_w){var o;if(typeof(o=_w._pc)!="object"||!o){return;
}o.obj.exec(o.func,o.args,o.cb,{message:o.message});throw ({x:1});}var _clut=apf.color?apf.color.colorshex:{},_cparse=/^(rgb|hsv|hsb)\(\s+(\d+)\s+,\s+(\d+)\s+,\s+(\d+)\)/;
function sort(set,xpath,options){var s=new apf.Sort();options=options||{};if(!xpath.charAt){xpath="";
}if(xpath.charAt(0)=="@"){xpath=xpath.slice(1);options.getValue=function(n){return n.getAttribute(xpath);
};}else{options.getValue=function(n){return apf.queryValue(n,xpath);};}s.set(options);
return s.apply(apf.getArrayFromNodelist(set));}function _cthex(c){var t;if((t=typeof(c))=="string"){if(c.indexOf("#")==0){if(c.length==7){return parseInt(c.slice(-1),16);
}return parseInt(c.slice(-1),16);}if(t=_clut[a]){return t;}if(c=c.match(_cparse)){if((t=c[1])=="rgb"){return(((t=c[2])<0?0:(t>255?255:parseInt(t)))<<16)+(((t=c[3])<0?0:(t>255?255:parseInt(t)))<<8)+(((t=c[4])<0?0:(t>255?255:parseInt(t))));
}else{var h=parseFloat(c[2]),s=parseFloat(c[3]),v=parseFloat(c[4]),i,m=v*(1-s),n=v*(1-s*((i=floor(((h<0?-h:h)%1)*6))?h-i:1-(h-i)));
switch(i){case 6:case 0:return((v&255)<<16)+((n&255)<<8)+(m&255);case 1:return((n&255)<<16)+((v&255)<<8)+(m&255);
case 2:return((m&255)<<16)+((v&255)<<8)+(n&255);case 3:return((m&255)<<16)+((n&255)<<8)+(v&255);
case 4:return((n&255)<<16)+((m&255)<<8)+(v&255);default:case 5:return((v&255)<<16)+((m&255)<<8)+(n&255);
}}}}else{if(t=="number"){return t;}}return null;}function lin(f,a,b){var fa=parseFloat(a),fb=parseFloat(b),fm=1-(f=f<0?0:(f>1?1:f));
if(fa!=a||fb!=b){return(((fa=_cthex(a))&16711680)*f+((fb=_cthex(b))&16711680)*fm)&16711680|((fa&65280)*f+(fb&65280)*fm)&65280|((fa&255)*f+(fb&255)*fm)&255;
}return f*fa+fm*fb;}var abs=Math.abs,acos=Math.acos,asin=Math.asin,atan=Math.atan,atan2=Math.atan2,ceil=Math.ceil,cos=Math.cos,exp=Math.exp,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,random=Math.random,round=Math.round,sin=Math.sin,sqrt=Math.sqrt,tan=Math.tan,linear=lin;
function tsin(x){return 0.5*sin(x)+0.5;}function tcos(x){return 0.5*cos(x)+0.5;
}function usin(x){return 0.5-0.5*sin(x);}function ucos(x){return 0.5-0.5*cos(x);
}function snap(a,b){return round(a/b)*b;}function clamp(a,b,c){return a<b?b:(a>c?c:a);
}this.compile=function(code){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;
eval(code);return _f;};this.compileWith=function(code,withs){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;
eval(code);return _f;};var LMBEGINCACHE;var LMENDCACHE;})();apf.url=function(str){var base;
var location=(window.location&&window.location.toString())||"";if(str.indexOf(":")==-1&&(base=location).indexOf(":")!=-1){base=new apf.url(base);
str=apf.getAbsolutePath(base.protocol+"://"+base.host+(base.directory.charAt(0)=="/"?"":"/")+(base.directory.charAt(base.directory.length-1)=="/"?base.directory:base.directory+"/"),str).replace(/\/\/\/\//,"///");
}var o=apf.url.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),i=14;
this.uri=str.toString();while(i--){this[o.key[i]]=m[i]||"";}this[o.q.name]={};var _self=this;
this[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1){_self[o.q.name][$1]=$2;
}});this.isSameLocation=function(){if(this.uri.length&&this.uri.charAt(0)=="#"){return false;
}if(!this.protocol&&!this.port&&!this.host){return true;}if(!this.protocol&&this.host&&this.port&&window.location.hostname==this.host&&window.location.port==this.port){return true;
}if(!this.protocol&&this.host&&!this.port&&window.location.hostname==this.host&&window.location.port==80){return true;
}return window.location.protocol==(this.protocol+":")&&window.location.hostname==this.host&&(window.location.port==this.port||!window.location.port&&!this.port);
};};apf.url.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
apf.runXpath=function(){apf.XPath={cache:{},getSelf:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];
if(data){data[0](htmlNode,data[1],info,count+1,numfound++,sResult);}else{sResult.push(htmlNode);
}},getChildNode:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];
var nodes=htmlNode.childNodes;if(!nodes){return;}for(var i=0;i<nodes.length;i++){if(tagName&&(tagName!=nodes[i].tagName)&&(nodes[i].style?nodes[i].tagName.toLowerCase():nodes[i].tagName)!=tagName){continue;
}htmlNode=nodes[i];if(data){data[0](nodes[i],data[1],info,count+1,numfound++,sResult);
}else{sResult.push(nodes[i]);}}},doQuery:function(htmlNode,qData,info,count,num,sResult){var result=null,data=info[count];
var query=qData[0];var returnResult=qData[1];try{var qResult=eval(query);}catch(e){apf.console.error(e.name+" "+e.type+":"+apf.XPath.lastExpr+"\n\n"+query);
return;}if(returnResult){return sResult.push(qResult);}if(!qResult||qResult.dataType==apf.ARRAY&&!qResult.length){return;
}if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);
}},getTextNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.childNodes;
for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;
}if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);
}}},getAnyNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.getElementsByTagName("*");
for(var i=0;i<nodes.length;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);
}else{sResult.push(nodes[i]);}}},getAttributeNode:function(htmlNode,attrName,info,count,num,sResult){if(!htmlNode||htmlNode.nodeType!=1){return;
}if(attrName=="*"){var nodes=htmlNode.attributes;for(var i=0;i<nodes.length;i++){arguments.callee.call(this,htmlNode,nodes[i].nodeName,info,count,i,sResult);
}return;}var data=info[count],value=htmlNode.getAttributeNode(attrName);if(data){data[0](value,data[1],info,count+1,0,sResult);
}else{if(value){sResult.push(value);}}},getAllNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],prefix=x[2],nodes,i,l;
if(inclSelf&&(htmlNode.tagName==tagName||tagName=="*"||tagName=="node()")){if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);
}else{sResult.push(htmlNode);}}if(tagName=="node()"){tagName="*";prefix="";if(apf.isIE){nodes=htmlNode.getElementsByTagName("*");
}else{nodes=[];(function recur(x){for(var n,i=0;i<x.childNodes.length;i++){n=x.childNodes[i];
if(n.nodeType!=1){continue;}nodes.push(n);recur(n);}})(htmlNode);}}else{nodes=htmlNode.getElementsByTagName((prefix&&(apf.isGecko||apf.isOpera||htmlNode.nodeFunc)?prefix+":":"")+tagName);
}for(i=0,l=nodes.length;i<l;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);
}else{sResult.push(nodes[i]);}}},getAllAncestorNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],i=0,s=inclSelf?htmlNode:htmlNode.parentNode;
while(s&&s.nodeType==1){if(s.tagName==tagName||tagName=="*"||tagName=="node()"){if(data){data[0](s,data[1],info,count+1,++i,sResult);
}else{sResult.push(s);}}s=s.parentNode;}},getParentNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],node=htmlNode.parentNode;
if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);
}}},getPrecedingSibling:function(htmlNode,tagName,info,count,num,sResult){var data=info[count],node=htmlNode.previousSibling;
while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.previousSibling;
continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);
break;}}}},getFollowingSibling:function(htmlNode,tagName,info,count,num,sResult){var result=null,data=info[count];
var node=htmlNode.nextSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.nextSibling;
continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);
break;}}}},multiXpaths:function(contextNode,list,info,count,num,sResult){for(var i=0;
i<list.length;i++){info=list[i][0];var rootNode=(info[3]?contextNode.ownerDocument.documentElement:contextNode);
info[0](rootNode,info[1],list[i],1,0,sResult);}sResult.makeUnique();},compile:function(sExpr){var isAbsolute=sExpr.match(/^\//);
sExpr=sExpr.replace(/\[(\d+)\]/g,"/##$1").replace(/\|\|(\d+)\|\|\d+/g,"##$1").replace(/\.\|\|\d+/g,".").replace(/\[([^\]]*)\]/g,function(match,m1){return"/##"+m1.replace(/\|/g,"_@_");
});if(sExpr=="/"||sExpr=="."){return sExpr;}return this.processXpath(sExpr.replace(/\/\//g,"descendant::"),isAbsolute);
},processXpath:function(sExpr,isAbsolute){var results=[],i,l,m,query;sExpr=sExpr.replace(/'[^']*'/g,function(m){return m.replace("|","_@_");
});sExpr=sExpr.split("|");for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=sExpr[i].replace(/_\@\_/g,"|");
}if(sExpr.length==1){sExpr=sExpr[0];}else{for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=this.processXpath(sExpr[i]);
}results.push([this.multiXpaths,sExpr]);return results;}var sections=sExpr.split("/");
for(i=0,l=sections.length;i<l;i++){if(sections[i]=="."||sections[i]==""){continue;
}else{if(sections[i]==".."){results.push([this.getParentNode,null]);}else{if(sections[i].match(/^[\w\-_\.]+(?:\:[\w\-_\.]+){0,1}$/)){results.push([this.getChildNode,sections[i]]);
}else{if(sections[i].match(/^\#\#(\d+)$/)){results.push([this.doQuery,["num+1 == "+parseInt(RegExp.$1)]]);
}else{if(sections[i].match(/^\#\#(.*)$/)){query=RegExp.$1;m=[query.match(/\(/g),query.match(/\)/g)];
if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;
}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query)]]);
}else{if(sections[i]=="*"){results.push([this.getChildNode,null]);}else{if(sections[i].substr(0,2)=="[]"){results.push([this.getAllNodes,["*",false]]);
}else{if(sections[i].match(/descendant-or-self::node\(\)$/)){results.push([this.getAllNodes,["*",true]]);
}else{if(sections[i].match(/descendant-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);
}else{if(sections[i].match(/descendant::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);
}else{if(sections[i].match(/ancestor-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);
}else{if(sections[i].match(/ancestor::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);
}else{if(sections[i].match(/^\@(.*)$/)){results.push([this.getAttributeNode,RegExp.$1]);
}else{if(sections[i]=="text()"){results.push([this.getTextNode,null]);}else{if(sections[i]=="node()"){results.push([this.getChildNode,null]);
}else{if(sections[i].match(/following-sibling::(.*)$/)){results.push([this.getFollowingSibling,RegExp.$1.toLowerCase()]);
}else{if(sections[i].match(/preceding-sibling::(.*)$/)){results.push([this.getPrecedingSibling,RegExp.$1.toLowerCase()]);
}else{if(sections[i]=="self::node()"){results.push([this.getSelf,null]);}else{if(sections[i].match(/self::(.*)$/)){results.push([this.doQuery,["apf.XPath.doXpathFunc(htmlNode, 'local-name') == '"+RegExp.$1+"'"]]);
}else{query=sections[i];m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;
}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query),true]]);
}}}}}}}}}}}}}}}}}}}}results[0][3]=isAbsolute;return results;},compileQuery:function(code){return new apf.CodeCompilation(code).compile();
},doXpathFunc:function(contextNode,type,nodelist,arg2,arg3,xmlNode,force){if(!nodelist||nodelist.length==0){nodelist="";
}if(type=="not"){return !nodelist;}if(!force){var arg1,i,l;if(typeof nodelist=="object"||nodelist.dataType==apf.ARRAY){if(nodelist&&!nodelist.length){nodelist=[nodelist];
}var res=false,value;for(i=0,l=nodelist.length;i<l;i++){xmlNode=nodelist[i];if(!xmlNode||typeof xmlNode=="string"||"position|last|count|local-name|name".indexOf(type)>-1){value=xmlNode;
}else{if(xmlNode.nodeType==1&&xmlNode.firstChild&&xmlNode.firstChild.nodeType!=1){xmlNode=xmlNode.firstChild;
}value=xmlNode.nodeValue;}if(res=arguments.callee.call(this,contextNode,type,value,arg2,arg3,xmlNode,true)){return res;
}}return res;}else{arg1=nodelist;}}else{arg1=nodelist;}switch(type){case"position":return apf.getChildNumber(contextNode)+1;
case"format-number":return apf.formatNumber(arg1);case"floor":return Math.floor(arg1);
case"ceiling":return Math.ceil(arg1);case"starts-with":return arg1?arg1.substr(0,arg2.length)==arg2:false;
case"string-length":return arg1?arg1.length:0;case"count":return arg1?arg1.length:0;
case"last":return arg1?arg1[arg1.length-1]:null;case"name":var c=xmlNode||contextNode;
return c.nodeName||c.tagName;case"local-name":var c=xmlNode||contextNode;if(c.nodeType!=1){return false;
}return c.localName||(c.tagName||"").split(":").pop();case"substring":return arg1&&arg2?arg1.substring(arg2,arg3||0):"";
case"contains":return arg1&&arg2?arg1.indexOf(arg2)>-1:false;case"concat":var str="";
for(i=1,l=arguments.length;i<l;i++){if(typeof arguments[i]=="object"){str+=getNodeValue(arguments[i][0]);
continue;}str+=arguments[i];}return str;case"translate":for(i=0,l=arg2.length;i<l;
i++){arg1=arg1.replace(arg2.substr(i,1),arg3.substr(i,1));}return arg1;}},selectNodeExtended:function(sExpr,contextNode,match){var sResult=this.selectNodes(sExpr,contextNode);
if(sResult.length==0){return null;}if(!match){return sResult;}for(var i=0,l=sResult.length;
i<l;i++){if(String(getNodeValue(sResult[i]))==match){return[sResult[i]];}}return null;
},getRoot:function(xmlNode){while(xmlNode.parentNode&&xmlNode.parentNode.nodeType==1){xmlNode=xmlNode.parentNode;
}return xmlNode.parentNode;},selectNodes:function(sExpr,contextNode){if(!this.cache[sExpr]){this.cache[sExpr]=this.compile(sExpr);
}if(sExpr.length>20){this.lastExpr=sExpr;this.lastCompile=this.cache[sExpr];}if(typeof this.cache[sExpr]=="string"){if(this.cache[sExpr]=="."){return[contextNode];
}if(this.cache[sExpr]=="/"){return[(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode))];
}}if(typeof this.cache[sExpr]=="string"&&this.cache[sExpr]=="."){return[contextNode];
}var info=this.cache[sExpr][0],rootNode=(info[3]?(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode)):contextNode),sResult=[];
if(rootNode){info[0](rootNode,info[1],this.cache[sExpr],1,0,sResult);}return sResult;
}};function getNodeValue(sResult){if(sResult.nodeType==1){return sResult.firstChild?sResult.firstChild.nodeValue:"";
}if(sResult.nodeType>1||sResult.nodeType<5){return sResult.nodeValue;}return sResult;
}apf.CodeCompilation=function(code){this.data={F:[],S:[],I:[],X:[]};this.compile=function(){code=code.replace(/ or /g," || ").replace(/ and /g," && ").replace(/!=/g,"{}").replace(/=/g,"==").replace(/\{\}/g,"!=");
this.tokenize();this.insert();code=code.replace(/, \)/g,", htmlNode)");return code;
};this.tokenize=function(){var data=this.data.F;code=code.replace(/(translate|format-number|contains|substring|local-name|last|position|round|starts-with|string|string-length|sum|floor|ceiling|concat|count|not)\s*\(/g,function(d,match){return(data.push(match)-1)+"F_";
});data=this.data.S;code=code.replace(/'([^']*)'/g,function(d,match){return(data.push(match)-1)+"S_";
}).replace(/"([^"]*)"/g,function(d,match){return(data.push(match)-1)+"S_";});data=this.data.X;
code=code.replace(/(^|\W|\_)([\@\.\/A-Za-z\*][\*\.\@\/\w\:\-]*(?:\(\)){0,1})/g,function(d,m1,m2){return m1+(data.push(m2)-1)+"X_";
}).replace(/(\.[\.\@\/\w]*)/g,function(d,m1,m2){return(data.push(m1)-1)+"X_";});
data=this.data.I;code=code.replace(/(\d+)(\W)/g,function(d,m1,m2){return(data.push(m1)-1)+"I_"+m2;
});};this.insert=function(){var data=this.data;code=code.replace(/(\d+)X_\s*==\s*(\d+S_)/g,function(d,nr,str){return"apf.XPath.selectNodeExtended('"+data.X[nr].replace(/'/g,"\\'")+"', htmlNode, "+str+")";
}).replace(/(\d+)([FISX])_/g,function(d,nr,type){var value=data[type][nr];if(type=="F"){return"apf.XPath.doXpathFunc(htmlNode, '"+value+"', ";
}else{if(type=="S"){return"'"+value+"'";}else{if(type=="I"){return value;}else{if(type=="X"){return"apf.XPath.selectNodeExtended('"+value.replace(/'/g,"\\'")+"', htmlNode)";
}}}}}).replace(/, \)/g,")");};};};apf.BindingRule=function(struct,tagName){this.$init(tagName||true,apf.NODE_HIDDEN,struct);
};(function(){this.$bindingRule=true;this.compile=function(prop){return(this["c"+prop]=apf.lm.compile(this[prop],{xpathmode:3,injectself:true}));
};this.$compile=function(prop,options){return(this["c"+prop+"2"]=apf.lm.compile(this[prop],options));
};this.$attrExcludePropBind=apf.extend({value:1,match:1},this.$attrExcludePropBind);
this.$booleanProperties.hasaml=true;this.$propHandlers.value=this.$propHandlers.match=function(value,prop){delete this["c"+prop];
if(this.$amlLoaded){var node=this;while(node&&node.$bindingRule){node=node.parentNode;
}if(!node){return;}apf.queue.add("reload"+node.$uniqueId,function(){node.reload();
});if(node.$bindings.$isCompiled){node.$bindings.$compiled=node.$bindings.compile(this.localName!="each"&&this.localName);
}}};this.addEventListener("DOMNodeInserted",function(e){var node=this;while(node.$bindingRule){node=node.parentNode;
}apf.queue.add("reload"+node.$uniqueId,function(){node.reload();});if(e.currentTarget==this){(node.$bindings[this.localName]||(node.$bindings[this.localName]=[])).push(this);
}else{if(!this.attributes.getNamedItem("value")){this.value=apf.serializeChildren(this);
}else{return;}}if(node.$bindings.$isCompiled){node.$bindings.$compiled=node.$bindings.compile(this.localName!="each"&&this.localName);
}});this.addEventListener("DOMNodeRemoved",function(e){if(this.$amlDestroyed){return;
}var first,node=this;while(node&&node.$bindingRule){node=node.parentNode;}if(!node){return;
}if(e.currentTarget==this){if(node.$bindings&&node.$bindings[this.localName]){node.$bindings[this.localName].remove(this);
}else{return;}}else{if(!this.attributes.getNamedItem("value")&&(first=this.firstChild)){if(first.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(first.target=="lm"){this.value="{"+first.nodeValue+"}";
}else{this.value=first.nodeValue;}}else{this.value=apf.serializeChildren(this).trim();
}}else{return;}}apf.queue.add("reload"+node.$uniqueId,function(){if(!node.$amlDestroyed){node.reload();
}});if(node.$bindings.$isCompiled){node.$bindings.$compiled=node.$bindings.compile(this.localName!="each"&&this.localName);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.match&&(!this.value&&!this.childNodes.length&&!this.get||this.localName=="each")||this.select){throw new Error(apf.formatErrorString(0,this,"Bindingrule","Missing attribute 'match'"));
}var first;if(!this.value&&this.localName!="each"&&(first=this.$aml&&this.$aml.firstChild||this.firstChild)){if(first.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(first.target=="lm"){this.value="{"+first.nodeValue+"}";
}else{this.value=first.nodeValue;}}else{this.value=apf.serializeChildren(this.$aml).trim();
}}var pNode=this.parentNode;while(pNode.$bindingRule){pNode=pNode.parentNode;}var bindings=pNode.$bindings||(pNode.$bindings=new apf.ruleList());
(bindings[this.localName]||(bindings[this.localName]=[])).push(this);if(pNode.localName!="bindings"&&(this.localName!="each"||!this.childNodes.length)){var ns=this;
while((ns=ns.nextSibling)&&ns.nodeType!=1){}if(!ns||!ns.$bindingRule){pNode.$cbindings=pNode.$bindings.compile(pNode.$bindings.$isCompiled?this.localName:null);
pNode.dispatchEvent("bindingsload",{bindings:pNode.$bindings,compiled:pNode.$cbindings});
pNode.$checkLoadQueue();}}});}).call(apf.BindingRule.prototype=new apf.AmlElement());
apf.aml.setElement("icon",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);
apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("tooltip",apf.BindingRule);
apf.aml.setElement("css",apf.BindingRule);apf.aml.setElement("selectable",apf.BindingRule);
apf.aml.setElement("value",apf.BindingRule);apf.aml.setElement("src",apf.BindingRule);
apf.aml.setElement("collapsed",apf.BindingRule);apf.aml.setElement("expanded",apf.BindingRule);
apf.aml.setElement("empty",apf.BindingRule);apf.accordion=function(struct,tagName){this.$init(tagName||"accordion",apf.NODE_VISIBLE,struct);
this.$animtype1=apf.tween.NORMAL;this.$animtype2=apf.tween.NORMAL;this.animdelay=10;
this.hoverdelay=500;this.multiexpand=true;this.expand="click";this.startexpanded=true;
this.$animStep={};this.$animStep[apf.tween.NORMAL]=5;this.$animStep[apf.tween.EASEIN]=10;
this.$animStep[apf.tween.EASEOUT]=10;this.bars={};this.hoverTimer=null;this.startExpanded=0;
this.$focussable=false;this.animType={normal:apf.tween.NORMAL,easein:apf.tween.EASEIN,easeout:apf.tween.EASEOUT,none:"none"};
this.lastOpened=[];this.inprogress=false;};(function(){this.$booleanProperties.multiexpand=true;
this.$booleanProperties.startexpanded=true;this.$supportedProperties.push("animtype","animdelay","multiexpand","expand","startexpanded");
this.addEventListener("AMLRemoveChild",function(amlNode,doOnlyAdmin){if(doOnlyAdmin){return;
}});this.addEventListener("AMLInsert",this.insertChild=function(amlNode,beforeNode,withinParent){if(amlNode.tagName!="bar"){return;
}amlNode.$propHandlers.icon=function(value){var oIcon=this.$getLayoutNode("bar","icon",this.$ext);
if(!oIcon){return;}if(oIcon.tagName=="img"){oIcon.setAttribute("src",value?this.iconPath+value:"");
}else{oIcon.style.backgroundImage=value?"url("+this.iconPath+value+")":"";}};});
this.$propHandlers.animtype=function(value){value=value.split(" ");if(value[0]){this.$animtype1=this.animType[value[0]];
}if(value[1]){this.$animtype2=this.animType[value[1]];}};this.$propHandlers.animdelay=function(value){this.animdelay=parseInt(value);
};this.slideToggle=function(id){if(!this.bars[id]){return;}if(this.bars[id].opened){this.slideUp(id);
}else{this.slideDown(id);}};this.slideDown=function(id){var id2=null;if(!this.bars[id]||this.inprogress){return;
}this.inprogress=true;var bar=this.bars[id];bar.htmlBody.style.display="block";
if(!this.multiexpand&&this.lastOpened.length>0){var _temp=this.lastOpened.shift();
if(_temp!==id){id2=_temp;}}this.lastOpened.push(id);this.$setStyleClass(bar.htmlNode,"active");
if(this.$dir=="vertical"){if(bar.htmlBody.scrollHeight<2){var timer;clearInterval(timer);
timer=setInterval(function(){if(bar.htmlBody.scrollHeight>0){_self.slideDown(bar.htmlTitle.id);
clearInterval(timer);}},100);}bar.htmlBody.style.height="1px";}if(this.$animtype1=="none"){if(id2){var bar2=this.bars[id2];
this.$setStyleClass(bar2.htmlNode,"",["active"]);bar2.htmlBody.style.display="none";
if(this.$dir=="horizontal"){bar2.htmlBody.style.width="auto";}}if(this.$dir=="horizontal"){bar.htmlBody.style.width="auto";
}this.bars[id].opened=true;this.inprogress=false;}else{var _self=this;if(id2){var bar2=this.bars[id2];
this.$setStyleClass(bar2.htmlNode,"",["active"]);apf.tween.multi(bar.htmlBody,{steps:this.$animStep[this.$animtype1],anim:this.$animtype1,interval:this.animdelay,tweens:[{type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:0,to:this.$dir=="vertical"?bar.htmlBody.scrollHeight:bar.htmlBody.scrollWidth},{type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:this.$dir=="vertical"?bar2.htmlBody.scrollHeight:bar2.htmlBody.scrollWidth,to:0,oHtml:bar2.htmlBody}],onfinish:function(){_self.$setStyleClass(bar.htmlNode,"active",[""]);
if(_self.$dir=="horizontal"){bar.htmlBody.style.width="auto";}_self.bars[id].opened=true;
_self.$setStyleClass(bar2.htmlNode,"",["active"]);bar2.htmlBody.style.display="none";
if(_self.$dir=="horizontal"){bar2.htmlBody.style.width="auto";}_self.bars[id2].opened=false;
_self.inprogress=false;}});}else{apf.tween.single(bar.htmlBody,{steps:this.$animStep[this.$animtype1],type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:0,to:this.$dir=="vertical"?bar.htmlBody.scrollHeight:bar.htmlBody.scrollWidth,anim:this.$animtype1,interval:this.animdelay,onfinish:function(){_self.$setStyleClass(bar.htmlNode,"active",[""]);
if(_self.$dir=="horizontal"){bar.htmlBody.style.width="auto";}_self.bars[id].opened=true;
_self.inprogress=false;}});}}};this.slideUp=function(id){if(!this.bars[id]||this.inprogress){return;
}this.inprogress=true;var bar=this.bars[id];apf.setStyleClass(bar.htmlNode,"",["active"]);
if(this.$animtype2=="none"){bar.htmlBody.style.display="none";if(this.$dir=="horizontal"){bar.htmlBody.style.width="auto";
}this.bars[id].opened=false;this.inprogress=false;}else{var _self=this;apf.tween.single(bar.htmlBody,{steps:this.$animStep[this.$animtype2],type:this.$dir=="vertical"?"scrollheight":"scrollwidth",from:this.$dir=="vertical"?bar.htmlBody.scrollHeight:bar.htmlBody.scrollWidth,to:0,anim:this.$animtype2,interval:this.animdelay,onfinish:function(){_self.$setStyleClass(bar.htmlNode,"",["active"]);
bar.htmlBody.style.display="none";if(_self.$dir=="horizontal"){bar.htmlBody.style.width="auto";
}_self.bars[id].opened=false;_self.inprogress=false;}});}return false;};this.$getbarIdByNumber=function(number){var counter=1;
for(var id in this.bars){if(counter++==number){return id;}}return null;};this.$draw=function(){this.$ext=this.$getExternal("main");
this.$int=this.$getLayoutNode("main","container",this.$ext);this.$dir=this.$getOption("main","direction")||"vertical";
var nodes=this.childNodes;var len=nodes.length;var node;var _self=this;var xmlBars=0;
var htmlBars=0;var barsToOpen=[];for(var i=0;i<len;i++){node=nodes[i];if((node.tagName||"").indexOf("a:bar")>-1&&!node.$amlLoaded){xmlBars++;
node.addEventListener("DOMNodeInsertedIntoDocument",function(e){htmlBars++;var htmlNode=_self.$ext.lastChild;
var amlNode=e.currentTarget;var htmlCaption;var htmlTitle;var htmlIcon;var htmlBody;
var opened=(amlNode.getAttribute("expanded")?(amlNode.getAttribute("expanded")=="true"?true:false):false);
var nodes=htmlNode.childNodes;var l1=nodes.length;for(var i=0;i<l1;i++){if((nodes[i].className||"").indexOf("body")>-1){htmlBody=nodes[i];
}if((nodes[i].className||"").indexOf("title")>-1){htmlTitle=nodes[i];}var subnodes=nodes[i].childNodes;
var l2=subnodes.length;for(var j=0;j<l2;j++){if((subnodes[j].className||"").indexOf("icon")>-1){htmlIcon=subnodes[j];
}if(((subnodes[j].tagName||"").toLowerCase()).indexOf("span")>-1){htmlCaption=subnodes[j];
}}}if(!htmlTitle&&!htmlBody){return;}apf.setUniqueHtmlId(htmlTitle);apf.setUniqueHtmlId(htmlBody);
var caption=amlNode.getAttribute("title");if(caption){htmlCaption.innerHTML=caption;
}var icon=amlNode.getAttribute("icon");if(icon){htmlIcon.style.backgroundImage="url("+this.iconPath+icon+")";
}if(_self.expand=="click"){htmlTitle.onmousedown=function(e){_self.slideToggle(this.id);
};}else{if(this.expand=="hover"){htmlTitle.onmouseover=function(e){(e||event).cancelBubble=true;
var id=this.id;clearInterval(_self.hoverTimer);_self.hoverTimer=setInterval(function(){_self.slideToggle(id);
clearInterval(_self.hoverTimer);},_self.hoverdelay);};htmlIcon.onmouseover=function(e){(e||event).cancelBubble=true;
var id=(e.srcElement||e.target).parentNode.id;clearInterval(_self.hoverTimer);_self.hoverTimer=setInterval(function(){_self.slideToggle(id);
clearInterval(_self.hoverTimer);},_self.hoverdelay);};}}_self.bars[htmlTitle.id]={amlNode:amlNode,htmlNode:htmlNode,opened:false,htmlTitle:htmlTitle,htmlBody:htmlBody,htmlIcon:htmlIcon};
if((opened||_self.startexpanded)&&(_self.multiexpand||_self.startExpanded==0)){barsToOpen.push(htmlTitle.id);
_self.startExpanded++;}if(htmlBars==xmlBars){_self.oEnding=_self.$getExternal("ending");
var oEnding=_self.$getLayoutNode("ending","container",_self.oEnding);_self.$int.appendChild(oEnding);
}});}}var openBarTimer=null;clearInterval(openBarTimer);openBarTimer=setInterval(function(){if(htmlBars==xmlBars){for(var i=0;
i<barsToOpen.length;i++){var id=barsToOpen.pop();_self.slideDown(id);}clearInterval(openBarTimer);
}},50);};this.$loadAml=function(x){};this.$destroy=function(){};}).call(apf.accordion.prototype=new apf.Presentation());
apf.aml.setElement("accordion",apf.accordion);apf.ActionRule=function(struct,tagName){this.$init(tagName||true,apf.NODE_HIDDEN,struct);
};(function(){this.$actionRule=true;this.compile=function(prop,options){return(this["c"+prop]=apf.lm.compile(this[prop],options||{xpathmode:2}));
};this.$attrExcludePropBind=apf.extend({set:1,get:1,undo:1,lock:1,match:1,parent:1},this.$attrExcludePropBind);
this.$propHandlers.set=this.$propHandlers.get=this.$propHandlers.parent=this.$propHandlers.match=function(value,prop){delete this["c"+prop];
};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this){var pNode=this.parentNode;
if(!pNode.$actions){pNode.$actions=new apf.ruleList();}(pNode.$actions[this.localName]||(pNode.$actions[this.localName]=[])).push(this);
}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);
}});this.addEventListener("DOMNodeRemoved",function(e){if(this.$amlDestroyed){return;
}if(e.currentTarget==this){this.parentNode.$actions[this.localName].remove(this);
}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.get){this.get=apf.serializeChildren(this.$aml).trim();
}var actions=this.parentNode.$actions||(this.parentNode.$actions=new apf.ruleList());
(actions[this.localName]||(actions[this.localName]=[])).push(this);});}).call(apf.ActionRule.prototype=new apf.AmlElement());
apf.aml.setElement("rename",apf.ActionRule);apf.aml.setElement("remove",apf.ActionRule);
apf.aml.setElement("add",apf.ActionRule);apf.aml.setElement("update",apf.ActionRule);
apf.aml.setElement("copy",apf.ActionRule);apf.aml.setElement("move",apf.ActionRule);
apf.aml.setElement("check",apf.ActionRule);apf.aml.setElement("change",apf.ActionRule);
apf.actions=function(struct,tagName){this.$init(tagName||"actions",apf.NODE_HIDDEN,struct);
this.$actions=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;
this.register=function(amlNode){if(amlNode.localName=="smartbinding"){this.$smartbinding=amlNode;
this.$smartbinding.add(this);return;}this.$amlNodes[amlNode.$uniqueId]=amlNode;
amlNode.$actions=this.$actions;amlNode.$actionsElement=this;amlNode.dispatchEvent("actionsload",{bindings:this});
};this.unregister=function(amlNode){this.$amlNodes[amlNode.$uniqueId]=null;delete this.$amlNodes[amlNode.$uniqueId];
delete amlNode.$actionsElement;delete amlNode.$actions;amlNode.dispatchEvent("actionsunload",{bindings:this});
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var nodes=this.childNodes;
for(var node,i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeType!=1){continue;
}node.dispatchEvent("DOMNodeInsertedIntoDocument");}this.register(this.parentNode);
});}).call(apf.actions.prototype=new apf.AmlElement());apf.aml.setElement("actions",apf.actions);
apf.actiontracker=function(struct,tagName){this.$init(tagName||"actiontracker",apf.NODE_HIDDEN,struct);
this.$undostack=[];this.$redostack=[];this.$execstack=[];this.$transtack={};};(function(){this.$lastExecStackItem=null;
this.realtime=true;this.undolength=0;this.redolength=0;this.length=0;this.position=0;
this.$booleanProperties={};this.$booleanProperties.realtime=true;this.$supportedProperties=["realtime","undolength","redolength","alias","length","position"];
this.$handlePropSet=function(prop,value,force){if(this.$booleanProperties[prop]){value=apf.isTrue(value);
}switch(prop){case"undolength":this.undolength=this.$undostack.length;this.setProperty("position",this.position=this.undolength);
break;case"redolength":this.redolength=this.$redostack.length;break;case"position":var d=this.undolength-(this.position=value);
if(d>0){change.call(this,d,false,true);}else{if(d<0){change.call(this,-1*d);}}break;
case"length":this.length=this.undolength+this.redolength;break;default:this[prop]=value;
}};this.item=function(index){if(index<this.$undostack.length){return this.$undostack[index];
}return this.$redostack[index-this.$undostack.length];};this.add=function(data,title){throw new Error("Not implemented yet");
};this.remove=function(index){throw new Error("Not implemented yet");};this.clearUndo=function(){this.setProperty("undolength",this.$undostack.length=0);
this.setProperty("length",this.$redostack.length);this.dispatchEvent("afterchange",{action:"clear-undo"});
};this.clearRedo=function(){this.setProperty("redolength",this.$redostack.length=0);
this.setProperty("length",this.$undostack.length);this.dispatchEvent("afterchange",{action:"clear-redo"});
};this.define=function(action,func){apf.actiontracker.actions[action]=func;};this.getParent=function(){return this.parentNode&&this.parentNode.getActionTracker?this.parentNode.getActionTracker(true):(apf.window.$at!=this?apf.window.$at:null);
};this.getDone=function(time){if(typeof time!="number"){return[];}for(var o,i=this.$undostack.length;
i>=0;--i){if(!(o=this.$undostack[i])||!o.timestamp){continue;}if(o.timestamp>=time){return this.$undostack.slice(i);
}}return[];};this.getUndone=function(time){if(typeof time!="number"){return[];}for(var o,i=0,l=this.$redostack.length;
i<l;++i){if(!(o=this.$redostack[i])||!o.timestamp){continue;}if(o.timestamp<=time){return this.$redostack.slice(0,i+1);
}}return[];};this.execute=function(options){if(this.dispatchEvent("beforechange",options)===false){return false;
}var UndoObj=new apf.UndoData(options,this);if(options.action&&!options.transaction){apf.actiontracker.actions[options.action](UndoObj,false,this);
}UndoObj.id=this.$undostack.push(UndoObj)-1;this.setProperty("undolength",this.$undostack.length);
if(typeof apf.offline!="undefined"){var t=apf.offline.transactions;if(t.doStateSync){t.addAction(this,UndoObj,"undo");
t.clearActions(this,"redo");}}if(UndoObj.multiple){this.$addToQueue(UndoObj.multiple,false,true);
}else{this.$addToQueue(UndoObj,false);}if(!options.rdb){this.$redostack.length=0;
this.setProperty("redolength",this.$redostack.length);this.setProperty("length",this.$undostack.length);
}this.dispatchEvent("afterchange",{action:"do"});return UndoObj;};this.purge=function(nogrouping,forcegrouping){if(true){if(this.$execstack.length){this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this);
this.$lastExecStackItem=this.$execstack[this.$execstack.length-1];}}else{if(parent){this.reset();
}}};this.begin=function(dataNode,bClear){var id;if(dataNode&&(dataNode.$regbase||dataNode.$regbase===0)){id=dataNode.$uniqueId;
if(this.$transtack[id]&&!bClear){return;}dataNode.$stack=this.$transtack[id]=[];
dataNode.addEventListener("DOMCharacterDataModified",domCharMod);dataNode.addEventListener("DOMAttrModified",domCharMod);
dataNode.addEventListener("DOMNodeInserted",domNodeIns);dataNode.addEventListener("DOMNodeRemoved",domNodeRem);
}else{id=apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(dataNode),dataNode);if(dataNode){apf.xmldb.addNodeListener(dataNode,this);
}if(this.$transtack[id]&&!bClear){return;}this.$transtack[id]=[];this.$transtack[id].$native=true;
if(!this.$execute){this.$execute=this.execute;this.execute=function(options){var inTrans=false;
if(options.selNode){inTrans=this.$transtack[options.selNode.getAttribute(apf.xmldb.xmlIdTag)];
}if(inTrans){inTrans.push(options);}else{this.$execute(options);}};}}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj,lastParent){};
this.rollback=function(dataNode){var id;if(dataNode&&(dataNode.$regbase||dataNode.$regbase===0)){id=dataNode.$uniqueId;
var stack=this.$transtack[id];if(!stack){return;}for(var s,i=stack.length-1;i>=0;
i--){s=stack[i];apf.actiontracker.actions[s.action].call(s,true,this);}dataNode.removeEventListener("DOMCharacterDataModified",domCharMod);
dataNode.removeEventListener("DOMAttrModified",domCharMod);dataNode.removeEventListener("DOMNodeInserted",domNodeIns);
dataNode.removeEventListener("DOMNodeRemoved",domNodeRem);delete dataNode.$stack;
}else{id=dataNode.getAttribute(apf.xmldb.xmlIdTag);}delete this.$transtack[id];
};this.commit=function(dataNode){var id,stack;if(dataNode&&(dataNode.$regbase||dataNode.$regbase===0)){id=dataNode.$uniqueId;
stack=this.$transtack[id];if(!stack){this.log&&this.log("Commit called without transaction started");
return;}if(stack.length){this.execute({xmlNode:dataNode,action:"multicall",transaction:true,args:stack});
}dataNode.removeEventListener("DOMCharacterDataModified",domCharMod);dataNode.removeEventListener("DOMAttrModified",domCharMod);
dataNode.removeEventListener("DOMNodeInserted",domNodeIns);dataNode.removeEventListener("DOMNodeRemoved",domNodeRem);
delete dataNode.$stack;}else{id=dataNode.getAttribute(apf.xmldb.xmlIdTag);stack=this.$transtack[id];
if(stack.length){this.execute({xmlNode:dataNode,action:"multicall",args:stack});
}}delete this.$transtack[id];};this.pause=function(dataNode,bContinue){var id=dataNode&&(dataNode.$regbase||dataNode.$regbase===0)?dataNode.$uniqueId:dataNode.getAttribute(apf.xmldb.xmlIdTag);
var stack=this.$transtack[id];if(!stack){throw new Error("Pausing non existent transaction");
return;}if(bContinue){dataNode.addEventListener("DOMCharacterDataModified",domCharMod);
dataNode.addEventListener("DOMAttrModified",domCharMod);dataNode.addEventListener("DOMNodeInserted",domNodeIns);
dataNode.addEventListener("DOMNodeRemoved",domNodeRem);}else{dataNode.removeEventListener("DOMCharacterDataModified",domCharMod);
dataNode.removeEventListener("DOMAttrModified",domCharMod);dataNode.removeEventListener("DOMNodeInserted",domNodeIns);
dataNode.removeEventListener("DOMNodeRemoved",domNodeRem);}};this.transact=function(func,dataNode){this.begin(dataNode);
func();this.commit(dataNode);};var domCharMod=function(e){if(e.$didtrans||!e.currentTarget.$amlLoaded){return;
}var context=e.name=="DOMAttrModified"?e.relatedNode:e.currentTarget;if(context.nodeName.substr(0,2)!="a_"){this.$stack.push({action:context.nodeType==2?"setAttribute":"setTextNode",args:context.nodeType==2?[e.currentTarget,e.attrName,e.newValue]:[e.currentTarget,e.newValue],extra:{name:e.attrName,oldValue:e.prevValue}});
}e.$didtrans=true;};var domNodeIns=function(e){if(e.$didtrans){return;}var n=e.currentTarget;
if(n.nodeType==1){this.$stack.push({action:"appendChild",args:[e.relatedNode,n,n.nextSibling],xmlNode:n});
}else{if(n.nodeType==2){if(n.nodeName.substr(0,2)!="a_"){this.$stack.push({action:"setAttribute",args:[n.ownerElement,n.nodeName,n.nodeValue],extra:{name:n.nodeValue}});
}}else{this.$stack.push({action:"setTextNode",args:[n,n.nodeValue],extra:{}});}}e.$didtrans=true;
};var domNodeRem=function(e){if(e.$didtrans){return;}this.$stack.push({action:"removeNode",args:[e.currentTarget],extra:{parent:e.relatedNode,removedNode:e.currentTarget,beforeNode:e.currentTarget.nextSibling}});
e.$didtrans=true;};this.reset=function(){this.$undostack.length=this.$redostack.length=0;
this.setProperty("undolength",0);this.setProperty("redolength",0);this.setProperty("length",0);
this.dispatchEvent("afterchange",{action:"reset"});};this.undo=function(id,single,rollback){change.call(this,id,single,true,rollback);
};this.redo=function(id,single,rollback){change.call(this,id,single,false,rollback);
};function change(id,single,undo,rollback){var undoStack=undo?this.$undostack:this.$redostack,redoStack=undo?this.$redostack:this.$undostack;
if(!undoStack.length){return;}if(single){var UndoObj=undoStack[id];if(!UndoObj){return;
}if(id!=undoStack.length-1){throw new Error("callstack got corrupted");}undoStack.length--;
redoStack.push(UndoObj);if(typeof apf.offline!="undefined"&&apf.offline.transactions.doStateSync){apf.offline.transactions.removeAction(this,true,undo?"undo":"redo");
apf.offline.transactions.addAction(this,UndoObj,undo?"redo":"undo");}if(UndoObj.action){apf.actiontracker.actions[UndoObj.action](UndoObj,undo,this);
}if(!rollback){if(UndoObj.multiple){this.$addToQueue(UndoObj.multiple,undo,true);
}else{this.$addToQueue(UndoObj,undo);}}this.setProperty("undolength",this.$undostack.length);
this.setProperty("redolength",this.$redostack.length);return UndoObj;}if(this.dispatchEvent("beforechange")===false){return;
}this.log&&this.log("Executing "+(undo?"undo":"redo"));if(id==-1){id=undoStack.length;
}if(!id){id=1;}var i=0;while(i<id&&undoStack.length>0){if(!undoStack[undoStack.length-1]){undoStack.length--;
apf.console.error("The actiontracker is in an invalid                                    state. The entire undo and redo stack will                                    be cleared to prevent further corruption                                   This is a serious error, please contact                                    the system administrator.");
this.$undostack=[];this.$redostack=[];if(typeof apf.offline!="undefined"){var t=apf.offline.transactions;
if(t.doStateSync){t.clear("undo|redo");}}return false;}else{change.call(this,undoStack.length-1,true,undo,rollback);
i++;}}this.dispatchEvent("afterchange",{action:undo?"undo":"redo",rollback:rollback});
}this.$receive=function(data,state,extra,UndoObj,callback){if(state==apf.TIMEOUT&&extra.tpModule.retryTimeout(extra,state,this)===true){return true;
}if(state!=apf.SUCCESS){if(this.dispatchEvent("actionfail",apf.extend(extra,{state:state,message:"Could not sent Action RPC request for control "+this.name+"["+this.localName+"] \n\n"+extra.message,bubbles:true}))===false){this.log&&this.log("You have cancelled the automatic undo                     process! Please be aware that if you don't retry this call                     the queue will fill up and none of the other actions will                     be sent through.");
return true;}if(typeof apf.offline!="undefined"&&!apf.offline.reloading){this.undo(UndoObj.id,extra.userdata,true);
}if(callback){callback(!extra.userdata);}if(!extra.userdata){this.$execstack=[];
var oError=new Error(apf.formatErrorString(0,this,"Executing action","Error sending action to the server:\n"+(extra.url?"Url:"+extra.url+"\n\n":"")+extra.message));
if((UndoObj&&UndoObj.xmlActionNode||extra.amlNode||apf).dispatchEvent("error",apf.extend({error:oError,state:state,bubbles:true},extra))===false){return;
}throw oError;}}else{this.dispatchEvent("actionsuccess",apf.extend(extra,{state:state,bubbles:true},extra));
UndoObj.processRsbQueue();if(callback){callback();}}this.$queueNext(UndoObj,callback);
};this.$addToQueue=function(UndoObj,undo,isGroup){if(!isGroup&&this.$execstack.length&&!UndoObj.state&&this.$execstack[this.$execstack.length-1].undoObj==UndoObj){this.$execstack.length--;
if(typeof apf.offline!="undefined"&&apf.offline.transactions.enabled){apf.offline.transactions.removeAction(this,true,"queue");
}UndoObj.clearRsbQueue();return;}var idx,undoObj,qItem;if(isGroup){var undoObj,qItem=this.$execstack.shift();
for(var i=0;i<UndoObj.length;i++){undoObj=UndoObj[i];this.$execstack.unshift({undoObj:(undoObj.tagName?undoObj:new apf.UndoData(undoObj,this)).preparse(undo,this),undo:undo});
}if(qItem){this.$execstack.unshift(qItem);}return;}qItem={undoObj:UndoObj.preparse(undo,this),undo:undo};
this.$execstack.push(qItem)-1;if(typeof apf.offline!="undefined"&&apf.offline.transactions.enabled){apf.offline.transactions.addAction(this,qItem,"queue");
}if(this.$execstack.length==1&&this.realtime){UndoObj.saveChange(undo,this);}};
this.$queueNext=function(UndoObj,callback){if(!this.$execstack[0]||this.$execstack[0].undoObj!=UndoObj){throw new Error(apf.formatErrorString(0,this,"Executing Next                 action in queue","The execution stack was corrupted. This is                 a fatal error. The application should be restarted. You will                 lose all your changes. Please contact the administrator."));
}UndoObj.state=null;var lastItem=this.$execstack.shift();if(typeof apf.offline!="undefined"&&apf.offline.transactions.enabled){apf.offline.transactions.removeAction(this,null,"queue");
}if(!this.$execstack[0]||lastItem==this.$lastExecStackItem){return;}this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this,callback);
};this.$loadQueue=function(stack,type){if(type=="queue"){if(this.$execstack.length){throw new Error("oops");
}this.$execstack=stack;}else{if(type=="undo"){if(this.$undostack.length){throw new Error("oops");
}this.$undostack=stack;}else{if(type=="redo"){if(this.$redostack.length){throw new Error("oops");
}this.$redostack=stack;}else{throw new Error("unknown");}}}};this.$getQueueLength=function(){return this.$execstack.length;
};this.$startQueue=function(callback){if(!this.$execstack[0]||this.$execstack[0].undoObj.state){return false;
}this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this,callback);};
}).call(apf.actiontracker.prototype=new apf.AmlElement());apf.aml.setElement("actiontracker",apf.actiontracker);
apf.application=function(){this.$init("application",apf.NODE_HIDDEN);if(!apf.isO3){this.$int=document.body;
this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;
this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");
};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);
}};apf.application.prototype=new apf.AmlElement();apf.aml.setElement("application",apf.application);
apf.appsettings=function(struct,tagName){this.$init(tagName||"appsettings",apf.NODE_HIDDEN,struct);
};(function(){this.$parsePrio="001";this.$attrExcludePropBind={language:1,login:1,logout:1};
this.$supportedProperties=["debug","name","baseurl","resource-path","disable-right-click","allow-select","allow-blur","auto-disable-actions","auto-disable","disable-f5","auto-hide-loading","disable-space","disable-backspace","undokeys","initdelay","default-page","query-append","outline","drag-outline","resize-outline","resize-outline","iepngfix","iepngfix-elements","iphone-fullscreen","iphone-statusbar","iphone-icon","iphone-icon-is-glossy","iphone-fixed-viewport","skinset","language","storage","offline","login"];
this.$booleanProperties={snapcontainer:1,snapelement:1,snapguide:1,snapgrid:1,showgrid:1,debug:1,"disable-right-click":1,"allow-select":1,"allow-blur":1,"auto-disable-actions":1,"auto-disable":1,"disable-f5":1,"auto-hide-loading":1,"disable-space":1,"disable-backspace":1,undokeys:1,initdelay:1,outline:1,iepngfix:1,"iphone-fullscreen":1,"iphone-icon-is-glossy":1,"iphone-fixed-viewport":1};
var $setProperty=this.setProperty;this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){if(inherited!=2){$setProperty.apply(this,arguments);
}};this.$handlePropSet=function(prop,value,force){if(this.$booleanProperties[prop]){value=apf.isTrue(value);
}this[prop]=value;apf.config.setProperty(prop,value);};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(apf.isIphone&&apf.runIphone){apf.runIphone();
delete apf.runIphone;}});}).call(apf.appsettings.prototype=new apf.AmlElement());
apf.aml.setElement("appsettings",apf.appsettings);apf.audio=function(struct,tagName){this.$init(tagName||"audio",apf.NODE_VISIBLE,struct);
};(function(){this.$supportedProperties.push("waveform","peak","EQ","ID3");this.$mainBind="src";
this.loadMedia=function(){if(!this.player){return this;}this.setProperty("currentSrc",this.src);
this.setProperty("networkState",apf.Media.NETWORK_LOADING);this.player.load(this.src);
return this;};this.seek=function(iTo){if(this.player&&iTo>=0&&iTo<=this.duration){this.player.seek(iTo);
}};this.setVolume=function(iVolume){if(this.player){this.player.setVolume(iVolume);
}};this.$guessType=function(path){var ext=path.substr(path.lastIndexOf(".")+1),type="";
if(apf.hasAudio&&((ext=="ogg"||ext=="wav")||(ext=="mp3"&&apf.isWebkit))){type="audio/ogg";
}else{if(ext=="mp3"){type="audio/flash";}}return type;};this.$getPlayerType=function(mimeType){if(!mimeType){return null;
}var playerType=null;var aMimeTypes=mimeType.splitSafe(",");if(aMimeTypes.length==1){aMimeTypes=aMimeTypes[0].splitSafe(";");
}for(var i=0,l=aMimeTypes.length;i<l;i++){if(mimeType.indexOf("ogg")>-1){playerType="TypeNative";
}if(mimeType.indexOf("flash")>-1){playerType="TypeFlash";}else{if(mimeType.indexOf("quicktime")>-1){playerType="TypeQT";
}else{if(mimeType.indexOf("wmv")>-1){playerType=apf.isMac?"TypeQT":"TypeWmp";}else{if(mimeType.indexOf("silverlight")>-1){playerType="TypeSilverlight";
}}}}if(this.$isSupported(playerType)){return playerType;}}return playerType;};this.$isSupported=function(playerType){playerType=playerType||this.playerType;
return(apf.audio[playerType]&&apf.audio[playerType].isSupported());};this.$initPlayer=function(){this.player=new apf.audio[this.playerType](this,this.$ext,{src:this.src,width:this.width,height:this.height,autoLoad:true,autoPlay:this.autoplay,showControls:this.controls,volume:this.volume,mimeType:this.type});
return this;};this.$initHook=function(e){if(e.error){var oError=this.MediaError(e.error);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false){throw oError;
}}this.loadMedia();};this.$cuePointHook=function(){};this.$playheadUpdateHook=function(){};
this.$errorHook=function(e){apf.console.log("Error: <audio>");apf.console.error(e.error);
};this.$progressHook=function(e){this.setProperty("bufferedBytes",{start:0,end:e.bytesLoaded,length:e.bytesLoaded});
this.setProperty("totalBytes",e.totalBytes);var iDiff=Math.abs(e.bytesLoaded-e.totalBytes);
if(iDiff<=20){this.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);}};this.$stateChangeHook=function(e){if(e.state=="connectionError"){this.networkState=apf.Media.HAVE_NOTHING;
this.$propHandlers.readyState.call(this,this.networkState);}};this.$changeHook=function(e){if(typeof e.volume!="undefined"){this.volume=e.volume;
this.muted=(e.volume>0);this.setProperty("volume",e.volume);}else{this.duration=this.player.getTotalTime();
this.position=e.playheadTime/this.duration;if(isNaN(this.position)){return;}this.setProperty("position",this.position);
this.currentTime=e.playheadTime;this.setProperty("currentTime",this.currentTime);
}};this.$completeHook=function(e){this.paused=true;this.setProperty("paused",true);
};this.$readyHook=function(e){this.setProperty("networkState",apf.Media.NETWORK_LOADED);
this.setProperty("readyState",apf.Media.HAVE_FUTURE_DATA);this.setProperty("duration",this.player.getTotalTime());
this.seeking=false;this.seekable=true;this.setProperty("seeking",false);if(this.autoplay){this.play();
}return this;};this.$metadataHook=function(e){this.oVideo.setProperty("readyState",apf.Media.HAVE_METADATA);
if(e.waveData){this.setProperty("waveform",e.waveData);}if(e.peakData){this.setProperty("peak",e.peakData);
}if(e.eqData){this.setProperty("EQ",e.eqData);}if(e.id3Data){this.setProperty("ID3",e.id3Data);
}};this.$draw=function(){this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));
this.$ext.className="apf_audio "+(this.getAttributeNode("class")||"");this.$ext;
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.setSource()){this.$propHandlers.type.call(this,this.type);
}});this.$destroy=function(bRuntime){if(this.player&&this.player.$detroy){this.player.$destroy();
}delete this.player;this.player=null;if(bRuntime){this.$ext.innerHTML="";}};}).call(apf.audio.prototype=new apf.Media());
apf.aml.setElement("audio",apf.audio);apf.audio.TypeInterface={properties:["src","volume","showControls","autoPlay","totalTime","mimeType"],setOptions:function(options){if(options==null){return this;
}var hash=this.properties;for(var i=0;i<hash.length;i++){var prop=hash[i];if(options[prop]==null){continue;
}this[prop]=options[prop];}return this;},getElement:function(id){return apf.flash.getElement(id);
}};apf.auth=function(struct,tagName){this.$init(tagName||"auth",apf.NODE_HIDDEN,struct);
this.$services={};this.$cache={};this.$queue=[];this.$credentials=null;};apf.aml.setElement("auth",apf.auth);
(function(){this.autostart=true;this.authenticated=false;this.enablequeue=false;
this.$retry=true;this.loggedIn=false;this.$needsLogin=false;this.$hasHost=false;
this.inProcess=0;this.$attrExcludePropBind=apf.extend({login:1,logout:1},this.$attrExcludePropBind);
this.$booleanProperties.autostart=true;this.$booleanProperties.remember=true;this.$supportedProperties.push("login","logout","fail-state","error-state","login-state","logout-state","waiting-state","window","autostart","remember","authenticated","enablequeue");
this.$propHandlers.login=this.$propHandlers["login-state"]=function(value){this.$services["default"]=value?this:null;
this.$needsLogin=value?true:false;};this.register=function(node){this.$services[node.name]=node;
this.$needsLogin=true;};this.unregister=function(node){var prop;delete this.$services[node.name];
if(!(prop in this.$services)){this.$needsLogin=false;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.inited=true;
if(this.parentNode&&this.parentNode.$setAuth){this.parentNode.$setAuth(this);this.$hasHost=true;
}if(this.autostart&&!this.$hasHost){var _self=this;apf.addEventListener("load",function(){_self.authRequired();
apf.removeEventListener("load",arguments.callee);});}});this.addEventListener("authrequired",function(){if(self[this.window]){this.win=self[this.window];
if(this.win){this.win.show();return false;}}if(self[this["authreq-state"]]){this.state=self[this["authreq-state"]];
if(this.state){this.state.activate();return false;}}});this.addEventListener("beforelogin",function(){if(self[this["waiting-state"]]){this.state=self[this["waiting-state"]];
if(this.state){this.state.activate();}}});var knownHttpAuthErrors={401:1,403:1};
function failFunction(e){var st=(e.state==apf.TIMEOUT||!knownHttpAuthErrors[e.status]?self[this["error-state"]]:self[this["fail-state"]])||self[this["fail-state"]];
if(st){this.state=st;if(this.state){this.state.activate();return false;}}}this.addEventListener("loginfail",failFunction);
this.addEventListener("logoutfail",failFunction);this.addEventListener("logoutsuccess",function(){if(self[this["logout-state"]]){this.state=self[this["logout-state"]];
if(this.state){this.state.activate();}}});this.addEventListener("loginsuccess",function(e){if(self[this.window]){this.win=self[this.window];
if(this.win){this.win.hide();}}if(self[this["login-state"]]){this.state=self[this["login-state"]];
if(this.state){this.state.activate();}}if(e.data&&this.model){this.model=apf.nameserver.get("model",this.model);
if(this.model){this.model.load(e.data);}}});this.logIn=function(username,password,callback,options){if(!options){options={};
}options.username=username;options.password=password;if(this.dispatchEvent("beforelogin",options)===false){return false;
}this.inProcess=1;var pos=0,len=0,_self=this,doneCallback=function(){if(len!=++pos){return;
}_self.inProcess=0;_self.loggedIn=true;_self.clearQueue();if(callback){callback();
}};if(this.$hasHost){this.$credentials=options;callback=this.$hostCallback;this.$hostCallback=null;
len=1;doneCallback();this.dispatchEvent("loginsuccess",{state:1,data:null,bubbles:true,username:username,password:password});
if(!this.remember){this.$credentials=null;}}else{if(!options.service){var s=options.$services||this.$services;
for(var name in s){len++;this.$do(name,options,"in",null,doneCallback);}}else{if(options.service){len=1;
this.$do(options.service,options,"in",null,doneCallback);}}}};this.relogin=function(){if(this.dispatchEvent("beforerelogin")===false){return false;
}apf.console.info("Retrying login...","auth");var name,pos=0,len=0,_self=this,doneCallback=function(){if(len!=++pos){return;
}_self.inProcess=0;_self.loggedIn=true;_self.clearQueue();};for(name in this.$services){if(!this.$cache[name]){return false;
}len++;this.$do(name,this.$cache[name],"in",true,doneCallback);}return true;};this.$do=function(service,options,type,isRelogin,callback){var xmlNode=this.$services[service],_self=options.userdata=this;
options.ignoreOffline=true;apf.console.info("Logging "+type+" on service '"+service+"'","auth");
options.callback=function(data,state,extra){if(state==apf.TIMEOUT&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}var result=_self.dispatchEvent("log"+type+"check",apf.extend({state:state,data:data,service:service,bubbles:true},extra)),loginFailed=typeof result=="boolean"?!result:!(state==apf.SUCCESS||type=="out"&&extra.status==401);
if(loginFailed){_self.inProcess=0;if(isRelogin){return _self.authRequired();}apf.console.info("Log "+type+" failure for service '"+service+"'","auth");
var commError=new Error(apf.formatErrorString(0,null,"Logging "+type,"Error logging in: "+extra.message));
if(_self.dispatchEvent("log"+type+"fail",apf.extend({error:commError,service:service,state:state,data:data,bubbles:true,username:options.username,password:options.password},extra))!==false){throw commError;
}_self.setProperty("authenticated",false);return;}if(type=="in"){if(!isRelogin&&_self.$retry){var cacheItem={};
for(var prop in options){if("object|array".indexOf(typeof options[prop])==-1){cacheItem[prop]=options[prop];
}}_self.$cache[service||"default"]=cacheItem;}}else{if(_self.$cache[service||"default"]){_self.$cache[service||"default"]=null;
}}if(callback){callback();}_self.dispatchEvent("log"+type+"success",apf.extend({},extra,{state:state,service:service,data:data,bubbles:true,username:options.username,password:options.password}));
apf.console.info("Log "+type+" success for service '"+service+"'","auth");_self.setProperty("authenticated",true);
};apf.saveData(xmlNode.getAttribute("log"+type),options);};this.clearQueue=function(){if(!this.loggedIn){return;
}var queue=this.$queue.slice();this.$queue.length=0;for(var i=0;i<queue.length;
i++){var qItem=queue[i];if(!this.loggedIn){this.$queue.push(qItem);continue;}if(qItem.retry){qItem.$retry.call(qItem.object);
}else{if(qItem.id){qItem.tpModule.retry(qItem.id);}else{apf.console.warn("Unable to retry queue item after successfull logging in. It seems the protocol that sent the message doesn't allow it.");
}}}if(this.$queue.length){this.clearQueue();}};this.logOut=function(callback,options){if(!options){options={};
}if(this.dispatchEvent("beforelogout",options)===false){return;}this.loggedIn=false;
if(!options.service){for(var name in this.$services){this.$do(name,options,"out",null,callback);
}}else{if(options.service){this.$do(options.service,options,"out",null,callback);
}}};this.getCredentials=function(service){var cache=this.$cache[service||"default"];
return !cache?["",""]:[cache.username,cache.password];};this.authRequired=function(options,forceNoRetry){if(options&&options.userdata==this){return;
}if(this.loggedIn&&!forceNoRetry&&this.$retry&&this.relogin()){var result=false;
}else{if(this.inProcess!=1){if(this.$hasHost&&typeof options=="function"){if(this.$credentials){return options();
}this.$hostCallback=options;}var result=this.dispatchEvent("authrequired",apf.extend({bubbles:true,data:options&&options.data},options));
}}this.loggedIn=false;if(result===false){if(this.enablequeue&&options){this.$queue.push(options);
}return true;}};}).call(apf.auth.prototype=new apf.AmlElement());apf.Axis=function(struct,tagName){this.$init(tagName||"axis",apf.NODE_VISIBLE,struct);
this.$subpos={left:0,right:0,width:1,height:1};};apf.aml.setElement("axis",apf.Axis);
(function(){this.$supportedProperties=["left","top","width","height","mode","zoom","zoomx","zoomy","movex","movey","orbitx","orbity","distance","x1","x2","y1","y2","z1","z2","t1","t2","x3d","y3d","z3d","p3d","orbitxanim","orbityanim","orbitzanim"];
this.$drawCode=0;this.$_style=null;this.$docompile=true;this.$doinit=true;this.$timer;
this.zoomx=1,this.zoomy=1,this.zoomz=1;this.movex=0,this.movey=0,this.movez=0;this.mousex=0,this.mousey=0;
this.$tilex=0,this.$tiley=0;this.orbitx=0,this.orbity=0,this.orbitz=0;this.distance=4;
this.rotate=0;this.orbitxanim=0;this.orbityanim=0;this.orbitzanim=0;this.x1=-2,this.x2=2;
this.y1=-1,this.y2=2;this.z1=-0.7,this.z2=1;this.t1=0,this.t2=1;this.x3d=2,this.y3d=2,this.z3d=2;
this.p3d=1;this.$styletag="";this.style="";this.mode="2D";this.left=0,this.top=0,this.width=0,this.height=0;
this.resetView=function(){if(!this.animreset){this.setProperty("movex",0);this.setProperty("movey",0);
this.setProperty("movez",0);this.setProperty("zoomx",1);this.setProperty("zoomy",1);
this.setProperty("zoomz",1);this.setProperty("orbitx",0);this.setProperty("orbity",0);
this.setProperty("orbitz",0);this.setProperty("distance",4);}var step=0;var _self=this;
var iid=window.setInterval(function(){var s1=0.7,s2=1-s1;if(step++>20){window.clearInterval(iid),iid=0;
}_self.setProperty("movex",!iid?0:s1*_self.movex);_self.setProperty("movey",!iid?0:s1*_self.movey);
_self.setProperty("zoomx",!iid?1:s2+s1*_self.zoomx);_self.setProperty("zoomy",!iid?1:s2+s1*_self.zoomy);
_self.setProperty("orbitx",!iid?0:s2*0+s1*_self.orbitx);_self.setProperty("orbity",!iid?0:s2*0+s1*_self.orbity);
_self.setProperty("distance",!iid?4:s2*4+s1*_self.distance);},20);};this.$copySubPos=function(t){t.left=this.$subpos.left,t.top=this.$subpos.top;
t.width=this.$subpos.width,t.height=this.$subpos.height;};this.$mouseDown=function(x,y,bt,keys){if(bt==3){this.resetView();
}for(var i=0,d=this.childNodes,len=d.length,n;i<len;){if((n=d[i++]).$mouseDown){n.$mouseDown(x,y,bt,keys);
}}};this.$mouseUp=function(x,y){for(var i=0,d=this.childNodes,len=d.length,n;i<len;
){if((n=d[i++]).$mouseUp){n.$mouseUp(x,y);}}};this.$mouseMove=function(dx,dy,bt,ox,oy,lx,ly,keys){var cx=this.$subpos.left,cy=this.$subpos.top;
for(var i=0,d=this.childNodes,len=d.length,n;i<len;){if((n=d[i++]).$mouseMove){n.$mouseMove(dx,dy,bt,ox-cx,oy-cy,lx-cx,ly-cy,keys);
}}dx=dx/this.$subpos.width,dy=dy/this.$subpos.height;var zx=this.zoomx,zy=this.zoomy,zz=this.zoomz,v;
this.mousex=lx/this.$subpos.width;this.mousey=ly/this.$subpos.height;if(ox<this.$subpos.left){dx=0;
}if(oy>this.$subpos.top+this.$subpos.height){dy=0;}if(this.mode=="2D"){if(bt==1){this.$tilex-=dx*this.$subpos.width;
this.$tiley-=dy*this.$subpos.height;this.setProperty("movex",this.movex+dx*this.zoomx);
this.setProperty("movey",this.movey+dy*this.zoomy);}else{if(bt==2){var tx=(ox-this.$subpos.left)/this.$subpos.width,ty=1-((oy-this.$subpos.top)/this.$subpos.height);
this.setProperty("zoomx",(v=this.zoomx*(1-4*dx))<0.001?0.001:(v>10000?10000:v));
this.setProperty("zoomy",(v=this.zoomy*(1-4*dy))<0.001?0.001:(v>10000?10000:v));
this.setProperty("movex",this.movex-(zx-this.zoomx)*tx);this.setProperty("movey",this.movey+(zy-this.zoomy)*ty);
}}}else{if(bt==1){if(keys&1){this.setProperty("movex",this.movex+dx*this.zoomx*1.5);
this.setProperty("movey",this.movey+dy*this.zoomy*1.5);}else{if(keys&2){this.setProperty("movex",this.movex+dx*this.zoomx*1.5);
this.setProperty("movez",this.movez-dy*this.zoomz*1.5);}else{this.setProperty("orbitx",this.orbitx-4*dx);
this.setProperty("orbity",this.orbity+4*dy);}}}else{if(bt==2){if(keys&1){this.setProperty("zoomx",(v=this.zoomx*(1-4*dx))<0.001?0.001:(v>10000?10000:v));
this.setProperty("zoomy",(v=this.zoomy*(1-4*dy))<0.001?0.001:(v>10000?10000:v));
this.setProperty("movex",this.movex-(zx-this.zoomx)*0.5);this.setProperty("movey",this.movey+(zy-this.zoomy)*0.5);
}else{if(keys&2){this.setProperty("zoomx",(v=this.zoomx*(1-4*dx))<0.001?0.001:(v>10000?10000:v));
this.setProperty("zoomz",(v=this.zoomz*(1-4*dy))<0.001?0.001:(v>10000?10000:v));
this.setProperty("movex",this.movex-(zx-this.zoomx)*0.5);this.setProperty("movez",this.movez+(zz-this.zoomz)*0.5);
}else{this.setProperty("distance",Math.min(Math.max(this.distance*(1-4*dy),1),100));
}}}}}};this.$mouseWheel=function(x,y,d,keys){var zx=this.zoomx,zy=this.zoomy,zz=this.zoomz,v,tx=(x-this.$subpos.left)/this.$subpos.width,ty=1-((y-this.$subpos.top)/this.$subpos.height);
if(this.mode=="2D"){if(!this.lockxzoom){this.setProperty("zoomx",(v=this.zoomx*(1-0.1*d))<0.001?0.001:(v>10000?10000:v));
}if(!this.lockyzoom){this.setProperty("zoomy",(v=this.zoomy*(1-0.1*d))<0.001?0.001:(v>10000?10000:v));
}this.setProperty("movex",this.movex-(zx-this.zoomx)*tx);this.setProperty("movey",this.movey+(zy-this.zoomy)*ty);
}else{if(keys&1){if(!this.lockxzoom){this.setProperty("zoomx",(v=this.zoomx*(1-0.1*d))<0.001?0.001:(v>10000?10000:v));
}if(!this.lockyzoom){this.setProperty("zoomy",(v=this.zoomy*(1-0.1*d))<0.001?0.001:(v>10000?10000:v));
}this.setProperty("movex",this.movex-(zx-this.zoomx)*0.5);this.setProperty("movey",this.movey+(zy-this.zoomy)*0.5);
}else{if(keys&2){if(!this.lockzzoom){this.setProperty("zoomz",(v=this.zoomz*(1-0.1*d))<0.001?0.001:(v>10000?10000:v));
}this.setProperty("movez",this.movez+(zz-this.zoomz)*0.5);}else{this.setProperty("distance",Math.min(Math.max(this.distance*(1-0.1*d),3),100));
}}}this.$redraw();};this.$propHandlers.left=this.$propHandlers.top=this.$propHandlers.width=this.$propHandlers.height=function(value){};
this.$propHandlers.mode=function(value){this.$_style=null;for(var i=0,d=this.childNodes,len=d.length,n;
i<len;){if((n=d[i++]).$drawGraph){n.$regenerate();}}this.$docompile=true;this.$redraw(false,true);
};this.$propHandlers.style=function(value){this.$_style=null;this.$docompile=true;
this.$redraw(false,true);};this.$propHandlers.x1=this.$propHandlers.x2=this.$propHandlers.y1=this.$propHandlers.y2=this.$propHandlers.z1=this.$propHandlers.z2=this.$propHandlers.t1=this.$propHandlers.t2=this.$propHandlers.x3d=this.$propHandlers.y3d=this.$propHandlers.z3d=this.$propHandlers.p3d=this.$propHandlers.orbitxanim=this.$propHandlers.orbityanim=this.$propHandlers.orbitzanim=function(value,name){this[name]=parseFloat(value);
this.$redraw();};this.$propHandlers.movex=this.$propHandlers.movey=this.$propHandlers.movez=this.$propHandlers.zoomx=this.$propHandlers.zoomy=this.$propHandlers.zoomz=this.$propHandlers.distance=this.$propHandlers.orbitx=this.$propHandlers.orbity=this.$propHandlers.orbitz=function(value,name){this[name]=parseFloat(value);
this.$redraw();};this.$redraw=function(now,resize){if(this.$parentChart){this.$parentChart.$redraw(now,resize);
}};this.$calcViewport=function(){var x1=this.x1,y1=this.y1,z1=this.z1,w=this.x2-x1,h=this.y2-y1,d=this.z2-z1;
this.orbitx+=this.orbitxanim;this.orbity+=this.orbityanim;this.orbitz+=this.orbitzanim;
this.a=this.$parentChart.a;this.b=this.$parentChart.b;this.c=this.$parentChart.c;
this.d=this.$parentChart.d;this.rx=this.orbity,this.ry=this.orbitx,this.rz=this.orbitz+3.141516;
this.tx=0,this.ty=0,this.tz=-this.distance;this.vx2=(this.vx1=x1+this.movex*-w)+this.zoomx*w,this.vy2=(this.vy1=y1+this.movey*h)+this.zoomy*h;
this.vz2=(this.vz1=z1+this.movez*d)+this.zoomz*d;};this.$drawAxis=function(doresize){this.$calcViewport();
if(this.$doinit){this.$doinit=false;this.$parentChart.$copyPos(this);apf.draw.initLayer(this,this.$parentChart);
}else{if(doresize){this.$parentChart.$copyPos(this);if(this.$_style){this.$parentChart.$copyPos(this.$subpos,this.$_style.margin);
}apf.draw.resizeLayer(this,this.$parentChart);}}if(this.$docompile){this.$docompile=false;
var err={};var mode="axis"+this.mode;if(!this.$_style){this.$_style=apf.draw.parseStyle(apf.chart_draw["_"+mode],this.style+this.$styletag,err);
}if(this.$_style){this.$parentChart.$copyPos(this.$subpos,this.$_style.margin);
}else{this.$parentChart.$copyPos(this.$subpos);}this.$drawCode=apf.chart_draw[mode](this,this.$_style);
}if(this.$drawCode){this.$drawCode(this,this);}for(var i=0,d=this.childNodes,len=d.length,n;
i<len;){if((n=d[i++]).$drawGraph){n.$tilex=this.$tilex,n.$tiley=this.$tiley,n.zoomx=this.zoomx,n.zoomy=this.zoomy,n.zoomz=this.zoomz;
n.p3d=this.p3d;n.a=this.a;n.b=this.b;n.c=this.c;n.d=this.d;n.$drawGraph(this,doresize);
}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$parentChart=this.parentNode;
var n=this.getElementsByTagNameNS(apf.ns.apf,"style");if(n.length>0){this.$styletag=n[0].firstChild.nodeValue.trim().replace(/\t/g," ");
}this.$redraw();});}).call(apf.Axis.prototype=new apf.AmlElement());apf.section=function(struct,tagName){this.$init(tagName||"section",apf.NODE_VISIBLE,struct);
};apf.menubar=function(struct,tagName){this.$init(tagName||"menubar",apf.NODE_VISIBLE,struct);
};apf.bar=function(struct,tagName){this.$init(tagName||"bar",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$canLeechSkin=true;this.$isLeechingSkin=false;
this.$propHandlers.caption=function(value){this.$int.innerHTML=value;};this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}if(this.$isLeechingSkin&&!withinParent&&this.skinName!=pNode.skinName||!this.$isLeechingSkin&&this.parentNode.$hasLayoutNode&&this.parentNode.$hasLayoutNode(this.localName)){this.$isLeechingSkin=true;
this.$forceSkinChange(this.parentNode.skinName.split(":")[0]+":"+skinName);}});
this.$draw=function(){this.$ext=this.$getExternal(this.$isLeechingSkin?this.localName:"main");
if(this.oDrag){this.oDrag.parentNode.removeChild(this.oDrag);}this.oDrag=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","dragger",this.$ext);
this.$int=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","container",this.$ext);
};this.$loadAml=function(x){};this.$skinchange=function(){};}).call(apf.bar.prototype=new apf.Presentation());
apf.menubar.prototype=apf.section.prototype=apf.bar.prototype;apf.aml.setElement("bar",apf.bar);
apf.aml.setElement("menubar",apf.menubar);apf.aml.setElement("section",apf.section);
apf.BindingColorRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.$bindings&&this.$bindings.color){var clr=this.$bindings.color[0];
apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"color",clr.getAttribute("text"),null,this.oWin);
apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"backgroundColor",clr.getAttribute("row"),null,this.oWin);
apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight":" .records .highlight"),"backgroundColor",clr.getAttribute("row"),null,this.oWin);
}apf.importStylesheet([["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align],["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align]]);
this.$draw();});}).call(apf.BindingColorRule.prototype=new apf.BindingRule());apf.aml.setElement("color",apf.BindingColorRule);
apf.BindingColumnRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
this.$className="col"+this.$uniqueId;};(function(){this.$defaultwidth="100";this.$width=100;
this.$sortable=true;this.$resizable=true;this.$movable=true;this.$cssInit=false;
this.$attrExcludePropBind=apf.extend({css:1,icon:1,caption:1,eachcaption:1,eachvalue:1,each:1,icon:1},this.$attrExcludePropBind);
this.$supportedProperties.push("tree","icon","caption","width","options","check","editor","colspan","align","css","sorted","each","eachvalue","eachcaption","model");
this.$booleanProperties.tree=true;this.$booleanProperties.check=true;this.$booleanProperties.sorted=true;
this.$propHandlers.width=function(value,prop){if(!value){value=this.$defaultwidth;
}this.$isPercentage=value&&String(value).indexOf("%")>-1;this.$width=parseFloat(value);
};this.$propHandlers.options=function(value,prop){this.$sortable=value.indexOf("sort")>-1;
this.$resizable=value.indexOf("size")>-1;this.$movable=value.indexOf("move")>-1;
};this.resize=function(newsize,pNode){var hN;if(this.$isPercentage){var oldsize=(this.$ext.offsetWidth-(pNode.$widthdiff-3)),ratio=newsize/oldsize,next=[],fixed=[],total=0,node=this.$ext.nextSibling;
while(node&&node.getAttribute("hid")){hN=apf.all[node.getAttribute("hid")];if(hN.$isPercentage){next.push(hN);
total+=hN.$width;}else{fixed.push(hN);}node=node.nextSibling;}if(fixed.length&&!next.length){return fixed[0].resize(fixed[0].$width+(oldsize-newsize),pNode);
}var newPerc=ratio*this.$width,diffPerc=newPerc-this.$width,diffRatio=(total-diffPerc)/total;
if(diffRatio<0.01){if(newsize<20){return;}return this.resize(newsize-10,pNode);
}for(var n,i=0;i<next.length;i++){n=next[i];n.$width*=diffRatio;apf.setStyleRule("."+n.$className,"width",n.$width+"%");
}this.$width=newPerc;apf.setStyleRule("."+this.$className,"width",this.$width+"%");
}else{var diff=newsize-this.$width;this.$width=newsize;if(apf.isIE&&pNode.oIframe){this.$ext.style.width=newsize+"px";
}else{}apf.setStyleRule("."+this.$className,"width",newsize+"px",null,pNode.oWin);
pNode.$fixed+=diff;var vLeft=(pNode.$fixed)+"px";if(!this.$isFixedGrid){apf.setStyleRule("."+pNode.$baseCSSname+" .row"+pNode.$uniqueId,"paddingRight",vLeft,null,this.oWin);
apf.setStyleRule("."+pNode.$baseCSSname+" .row"+pNode.$uniqueId,"marginRight","-"+vLeft,null,pNode.oWin);
pNode.$container.style.paddingRight=pNode.$head.style.paddingRight=vLeft;}}};this.hide=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","hidden",null,this.oWin);
};this.show=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","visible",null,this.oWin);
};this.sort=function(pNode,initial){if(pNode.$lastSorted==this){apf.setStyleClass(this.$int,pNode.toggleSortOrder()?"ascending":"descending",["descending","ascending"]);
return;}var h;if(h=pNode.$lastSorted){apf.setStyleRule("."+h.$className,"background","white");
apf.setStyleClass(h.$int,"",["descending","ascending"]);}apf.setStyleRule("."+this.$className,"background","#f3f3f3");
apf.setStyleClass(this.$int,"ascending",["descending","ascending"]);pNode.resort({order:"ascending",xpath:(this.cvalue||this.compile("value")).xpaths[1]},false,initial||!pNode.length);
pNode.$lastSorted=this;};this.move=function(hTo,pNode){if(hTo&&this==hTo){return;
}var hFrom=this,childNrFrom=apf.getChildNumber(hFrom.$int),childNrTo=hTo&&apf.getChildNumber(hTo.$int);
pNode.$head.insertBefore(hFrom.$int,hTo&&hTo.$int||null);if(!pNode.length){return;
}(function _recur(nodes){for(var node,i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;
}node=nodes[i];if(pNode.$isTreeArch&&node.tagName=="BLOCKQUOTE"){_recur(node.childNodes);
}else{node.insertBefore(node.childNodes[childNrFrom],childNrTo!=undefined&&node.childNodes[childNrTo]||null);
}}})(pNode.$container.childNodes);};this.$draw=function(pNode,caption,width,className){var pNode=pNode||this.parentNode;
while(pNode.$bindingRule){pNode=pNode.parentNode;}if(!pNode.hasFeature(apf.__PRESENTATION__)){return;
}if(width){this.$propHandlers.width.call(this,width);}apf.importStylesheet([["."+this.$className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+this.align]]);
pNode.$getNewContext("headitem");var $head=pNode.$getLayoutNode("headitem");$head.setAttribute("class",this.$className+(className?" "+className:""));
$head.setAttribute("hid",this.$uniqueId);var hCaption=pNode.$getLayoutNode("headitem","caption");
hCaption.nodeValue=this.caption||caption||"&nbsp";this.$ext=this.$int=apf.insertHtmlNode($head,pNode.$head||pNode.$container);
var dragging=false;var _self=this;if(this.sorted){this.sort(pNode,true);}this.$int.onmouseup=function(e){if(!e){e=event;
}if(pNode.disabled||!apf.isChildOf(dragging,this,true)){return;}apf.setStyleClass(this,"hover",["down"]);
if(_self.$sortable){_self.sort(pNode);}pNode.dispatchEvent("sortcolumn",_self);
};this.$int.onmousedown=function(e){if(!e){e=event;}dragging=target=this;if(pNode.disabled){return;
}var pos=apf.getAbsolutePosition(target),sLeft=pNode.$head.scrollLeft;var d=e.clientX-pos[0]+sLeft;
if(d<4||target.offsetWidth-d-8<3&&apf.getChildNumber(_self.$int)<pNode.$headings.length-1){var t=d<4&&target.previousSibling||target;
if(_self.$resizable){pos=apf.getAbsolutePosition(t);apf.setStyleClass(pNode.$pointer,"size_pointer",["move_pointer"]);
pNode.$pointer.style.display="block";pNode.$pointer.style.left=(t.offsetLeft-sLeft-1)+"px";
pNode.$pointer.style.width=(t.offsetWidth-pNode.$widthdiff+1)+"px";apf.plane.show(pNode.$pointer,null,true);
dragging=true;document.onmouseup=function(){if(!e){e=event;}document.onmouseup=document.onmousemove=null;
apf.all[t.getAttribute("hid")].resize(pNode.$pointer.offsetWidth,pNode);dragging=false;
pNode.$pointer.style.display="none";apf.plane.hide();};document.onmousemove=function(e){if(!e){e=event;
}pNode.$pointer.style.width=Math.max(10,Math.min(pNode.$container.offsetWidth-pNode.$pointer.offsetLeft-20,e.clientX-pos[0]-1+sLeft))+"px";
};return;}}apf.setStyleClass(target,"down",["hover"]);if(!_self.$movable){document.onmouseup=function(e){document.onmouseup=null;
dragging=false;};return;}apf.setStyleClass(pNode.$pointer,"move_pointer",["size_pointer"]);
var x=e.clientX-target.offsetLeft,sX=e.clientX,y=e.clientY-target.offsetTop,sY=e.clientY,copy;
document.onmouseup=function(e){if(!e){e=event;}document.onmouseup=document.onmousemove=null;
dragging=false;pNode.$pointer.style.display="none";if(!copy){return;}copy.style.top="-100px";
var el=document.elementFromPoint(e.clientX,e.clientY);if(el.parentNode==copy.parentNode){var pos=apf.getAbsolutePosition(el);
var beforeNode=(e.clientX-pos[0]>el.offsetWidth/2?el.nextSibling:el);_self.move(beforeNode?apf.all[beforeNode.getAttribute("hid")]:null,pNode);
}apf.destroyHtmlNode(copy);};document.onmousemove=function(e){if(!e){e=event;}if(!copy){if(Math.abs(e.clientX-sX)<3&&Math.abs(e.clientY-sY)<3){return;
}copy=target.cloneNode(true);copy.style.position="absolute";var diff=apf.getWidthDiff(target);
copy.style.width=(target.offsetWidth-diff-pNode.$widthdiff+2)+"px";copy.style.left=target.offsetLeft;
copy.style.top=target.offsetTop;copy.style.margin=0;copy.removeAttribute("hid");
apf.setStyleClass(copy,"drag",["ascending","descending"]);target.parentNode.appendChild(copy);
}copy.style.top="-100px";pNode.$pointer.style.display="none";var el=document.elementFromPoint(e.clientX,e.clientY);
if(el.parentNode==copy.parentNode){var pos=apf.getAbsolutePosition(el);pNode.$pointer.style.left=(el.offsetLeft+((e.clientX-pos[0]>el.offsetWidth/2)?el.offsetWidth-8:0))+"px";
pNode.$pointer.style.display="block";}copy.style.left=(e.clientX-x)+"px";copy.style.top=(e.clientY-y)+"px";
};};this.$int.onmouseout=function(e){if(!e){e=event;}if(pNode.disabled){return;
}var _self=this;this.$timer=setTimeout(function(){pNode.$ext.style.cursor="";apf.setStyleClass(_self,"",["hover","down"]);
},10);};this.$int.onmousemove=function(e){if(dragging||pNode.disabled){return;}if(!e){e=event;
}var pos=apf.getAbsolutePosition(this),sLeft=pNode.$head.scrollLeft;var d=e.clientX-pos[0]+sLeft;
if(d<4||this.offsetWidth-d-pNode.$widthdiff<3&&apf.getChildNumber(_self.$int)<pNode.$headings.length-1){var t=d<4?this.previousSibling:this;
pNode.$ext.style.cursor=t&&_self.$resizable?"w-resize":"default";apf.setStyleClass(this,"",["hover","down"]);
}else{pNode.$ext.style.cursor="default";apf.setStyleClass(this,"hover",["down"]);
}};if(!this.options&&pNode.options){this.$propHandlers.options.call(this,this.options=pNode.options);
}return this;};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$draw();
});this.addEventListener("DOMNodeRemovedFromDocument",function(e){if(!this.$int){return;
}this.$int.onmouseover=this.$int.onmouseup=this.$int.onmousedown=this.$int.onmousemove=this.$int.onmouseout=null;
});}).call(apf.BindingColumnRule.prototype=new apf.BindingRule());apf.aml.setElement("column",apf.BindingColumnRule);
apf.BindingDndRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){this.compile=function(prop){if(!this[prop]){return;}var compileData;
if(prop=="value"){compileData=apf.lm.compile(this[prop],{xpathmode:3});}else{if(prop=="match"){compileData=apf.lm.compile(this[prop],{xpathmode:3,injectself:true});
}else{if(prop=="target"){compileData=apf.lm.compile(this[prop],{xpathmode:2,injectself:true});
}else{if(prop=="action"){compileData=apf.lm.compile(this[prop],{nostring:true});
}else{if(prop=="copy"){compileData=apf.lm.compile(this[prop],{withopt:true,nostring:true});
}else{throw new Error("Missing property handler for compile");}}}}}return(this["c"+prop]=compileData);
};this.$attrExcludePropBind=apf.extend({target:1,parent:1,action:1,dragcopy:1},this.$attrExcludePropBind);
this.$propHandlers.target=this.$propHandlers.parent=this.$propHandlers.action=this.$propHandlers.dragcopy=function(value,prop){delete this["c"+prop];
};this.$noderegister=function(e){apf.GuiElement.propHandlers.drop.call(e.amlNode,true);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;
while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}if(!pNode){return;}if(pNode.localName=="bindings"){pNode.addEventListener("noderegister",this.$noderegister);
var nodes=pNode.$amlNodes;for(var i=0;i<nodes.length;i++){apf.GuiElement.propHandlers.drop.call(nodes[i],true);
}}else{apf.GuiElement.propHandlers.drop.call(pNode,true);}});}).call(apf.BindingDndRule.prototype=new apf.BindingRule());
apf.aml.setElement("drag",apf.BindingDndRule);apf.aml.setElement("drop",apf.BindingDndRule);
apf.BindingEachRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
var _self=this;this.$noderegister=function(e){e.amlNode.$handleBindingRule(_self.match,"each");
e.amlNode.$sort=_self.sort?new apf.Sort(_self):null;};};(function(){this.$attrExcludePropBind=apf.extend({sort:1,"data-type":1,"date-format":1,"sort-method":1,order:1,"case-order":1},this.$attrExcludePropBind);
this.$booleanProperties.animate=true;this.$propHandlers.sort=this.$propHandlers["data-type"]=this.$propHandlers["date-format"]=this.$propHandlers.order=this.$propHandlers["case-order"]=function(value,prop){delete this["c"+prop];
};this.$updateEach=function(value){var pNode=this.parentNode;if(pNode.localName=="bindings"){var nodes=pNode.$amlNodes,i=0,l=nodes.length;
for(;i<l;++i){if(nodes[i].each!=value){nodes[i].$handleBindingRule(value,"each");
}}}else{if(pNode.each!=value){pNode.$handleBindingRule(value,"each");}}};this.$getFilteredMatch=function(value){if(!value){return this.match;
}var keywords=value.trim().toLowerCase().split(" ");var each=this.match.charAt(0)=="["&&this.match.charAt(this.match.length-1)=="]"?this.match.replace(/^\[|\]$/g,""):this.match;
var model;if(each.indexOf("::")>-1){var parsed=each.split("::");if(!apf.xPathAxis[parsed[0]]){model=parsed[0];
each=parsed[1];}}var search=[],word,words,fields=this.$fields||["text()"];for(var i=0,l=keywords.length;
i<l;i++){words=[],word=keywords[i];for(var j=0,jl=fields.length;j<jl;j++){words.push("contains(translate("+fields[j]+", 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), '"+word+"')");
}search.push(words.join(" or "));}var filter="("+search.join(") and (")+")";var groups=(this["filter-groups"]||"").split("|");
each=each.split("|");var newEach=[];for(i=0,l=each.length;i<l;i++){if(!groups.contains(each[i])){newEach.push("("+each[i]+")["+filter+"]");
}}for(i=0;i<groups.length;i++){newEach.push(groups[i]);}return newEach.join("|");
};this.$propHandlers.filter=function(value,prop){if(!this.$amlLoaded){return;}this.$updateEach(this.$getFilteredMatch(value));
};this.$propHandlers["filter-fields"]=function(value,prop){this.$fields=value.splitSafe(",");
};this.addEventListener("prop.match",function(e){if(!this.$amlLoaded){return;}if(this.filter){this.$propHandlers.filter.call(this,this.filter);
}else{this.$updateEach(this.match);}});var f;this.addEventListener("DOMNodeInserted",f=function(e){if(e.currentTarget!=this){return;
}var match=this.$getFilteredMatch(this.filter);var pNode=this.parentNode;if(pNode.localName=="bindings"){pNode.addEventListener("noderegister",this.$noderegister);
var nodes=pNode.$amlNodes,i=0,l=nodes.length;for(;i<l;++i){nodes[i].$handleBindingRule(match,"each");
nodes[i].$sort=this.sort?new apf.Sort(this):null;}}else{pNode.$handleBindingRule(match,"each");
pNode.$sort=this.sort?new apf.Sort(this):null;}});this.addEventListener("DOMNodeRemoved",function(e){if(e.currentTarget!=this){return;
}var pNode=this.parentNode;if(pNode.localName=="bindings"){pNode.removeEventListener("noderegister",this.$noderegister);
var nodes=pNode.$amlNodes,i=0,l=nodes.length;for(;i<l;++i){delete nodes[i].$sort;
}}else{delete pNode.$sort;}});this.addEventListener("DOMNodeInsertedIntoDocument",f);
}).call(apf.BindingEachRule.prototype=new apf.BindingRule());apf.aml.setElement("each",apf.BindingEachRule);
apf.BindingLoadRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){this.$attrExcludePropBind=apf.extend({get:1},this.$attrExcludePropBind);
this.$propHandlers.get=function(value,prop){delete this["c"+prop];};}).call(apf.BindingLoadRule.prototype=new apf.BindingRule());
apf.aml.setElement("load",apf.BindingLoadRule);apf.aml.setElement("insert",apf.BindingLoadRule);
apf.BindingQuicksandRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){function getFilteredNodes(pNode){pNode=pNode||this.$parent;var attr,tmp,res=[],dataIDs=[],xmlNodes=pNode.$getDataNode("quicksand",pNode.xmlRoot,false,null,true),domNodes=pNode.$ext.childNodes,i=0,l=xmlNodes.length;
if(!domNodes.length||!l){return res;}for(;i<l;++i){dataIDs.push(xmlNodes[i].getAttribute("a_id"));
}for(i=0,l=domNodes.length;i<l;++i){if(!domNodes[i]||!(attr=domNodes[i].getAttribute("id"))){continue;
}tmp=attr.split("|");tmp.pop();if(dataIDs.indexOf(tmp.join("|"))>-1){res.push(domNodes[i]);
}}return res;}function nodeInFilter(node,filtered){var i=0,l=filtered.length,s=node.getAttribute("id");
for(;i<l;++i){if(filtered[i].getAttribute("id")==s){return filtered[i];}}return null;
}function quicksand(parent,customOptions){parent=this.$parent.$ext;var i,l,dest,src,offset,_self=this,coll=getFilteredNodes.call(this),parentOffset=apf.getAbsolutePosition(parent),offsets=[],callbackFunction=typeof(arguments[1])=="function"?arguments[1]:typeof arguments[2]=="function"?arguments[2]:apf.K,postCallback=function(){_self.dispatchEvent("afterquicksand");
callbackFunction.call(_self);},options={steps:60,anim:apf.tween.easeInOutQuad,onfinish:postCallback,adjustHeight:true};
apf.extend(options,customOptions);if(apf.isIE&&apf.isIE<7){parent.innerHTML="";
for(i=0,l=coll.length;i<l;i++){parent.appendChild(coll[i]);}return;}var $source=parent.childNodes;
var correctionOffset=[0,0];parent.style.height=parent.offsetHeight+"px";apf.tween.clearQueue(parent,true);
for(i=0,l=$source.length;i<l;++i){src=$source[i];offsets[i]=apf.getAbsolutePosition(src,parent,false);
}for(i=0,l=$source.length;i<l;++i){src=$source[i];with(src.style){position="absolute";
margin="0";top=(offsets[i][1]-parentOffset[1])+"px";left=(offsets[i][0]-parentOffset[0])+"px";
}}var $dest=parent.cloneNode(false);$dest.setAttribute("id","");for(i=0,l=coll.length;
i<l;++i){$dest.appendChild(coll[i].cloneNode(true));coll[i].$offset=apf.getAbsolutePosition(coll[i]);
}parent.parentNode.insertBefore($dest,parent);with($dest.style){zIndex=1;opacity=0;
margin=0;position="absolute";top=parentOffset[1]-correctionOffset[1]+"px";left=parentOffset[0]-correctionOffset[0]+"px";
}if(false){apf.tween.single(parent,{steps:options.steps,anim:options.anim,type:"height",from:parent.offsetHeight,to:$dest.offsetHeight});
}var insets=[];for(i=0,l=$source.length;i<l;++i){src=$source[i];if(dest=nodeInFilter(src,coll)){offset=insets.shift()||offsets[i];
options.tweens=[{type:"top",from:dest.$offset[1]-parentOffset[1],to:offset[1]-parentOffset[1]},{type:"left",from:dest.$offset[0]-parentOffset[0],to:offset[0]-parentOffset[0]},{type:"opacity",from:apf.getStyle(src,"opacity"),to:1}];
if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:0,to:1});
}apf.tween.multi(src,options);}else{options.tweens=[{type:"opacity",from:apf.getStyle(src,"opacity"),to:0}];
if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:1,to:0});
}insets.push(offsets[i]);apf.tween.multi(src,options);}}for(i=0,l=coll.length;i<l;
++i){var item=coll[i];if(!nodeInFilter(item,$source)){dest=nodeInFilter(item,coll);
options.tweens=[{type:"opacity",from:0,to:1}];if(!apf.isIE){}offset=apf.getAbsolutePosition(dest);
dest=dest.cloneNode(true);with(dest.style){position="absolute";margin="0";top=(offset[1]-parentOffset[1])+"px";
left=(offset[0]-parentOffset[0])+"px";opacity="0";transform="scale(.0)";}parent.appendChild(dest);
apf.tween.multi(dest,options);}}}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;
while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}this.$parent=pNode;if(!pNode){return;
}var _self=this;setTimeout(function(){quicksand.call(_self);});});}).call(apf.BindingQuicksandRule.prototype=new apf.BindingRule());
apf.aml.setElement("quicksand",apf.BindingQuicksandRule);apf.bindings=function(struct,tagName){this.$init(tagName||"bindings",apf.NODE_HIDDEN,struct);
this.$bindings=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;
this.register=function(amlNode){if(amlNode.localName=="smartbinding"){this.$smartbinding=amlNode;
this.$smartbinding.add(this);return;}if(!amlNode.hasFeature(apf.__DATABINDING__)){return;
}this.$amlNodes[amlNode.$uniqueId]=amlNode;if(!this.$amlLoaded){return;}if(!this.$bindings.$isCompiled){this.$cbindings=this.$bindings.compile();
}amlNode.$bindings=this.$bindings;amlNode.$cbindings=this.$cbindings;amlNode.$bindingsElement=this;
amlNode.dispatchEvent("bindingsload",{bindings:this.$bindings,compiled:this.$cbindings});
this.dispatchEvent("noderegister",{amlNode:amlNode});amlNode.$checkLoadQueue();
};this.unregister=function(amlNode){this.$amlNodes[amlNode.$uniqueId]=null;delete this.$amlNodes[amlNode.$uniqueId];
amlNode.$bindingsElement=amlNode.$bindings=amlNode.$cbindings=false;amlNode.dispatchEvent("bindingsunload",{bindings:this.$bindings,compiled:this.$cbindings});
};this.reload=function(){for(var id in this.$amlNodes){this.$amlNodes[id].reload();
}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var nodes=this.childNodes;
for(var node,i=0,l=nodes.length;i<l;i++){if(!(node=nodes[i]).$amlLoaded&&node.nodeType==1){node.dispatchEvent("DOMNodeInsertedIntoDocument");
}}this.register(this.parentNode);for(var id in this.$amlNodes){this.register(this.$amlNodes[id]);
}});}).call(apf.bindings.prototype=new apf.AmlElement());apf.ruleList=function(){this.$compiled={};
};apf.ruleList.prototype={$isCompiled:false,getRule:function(name,xmlNode){var rules=this[name];
if(!rules){return false;}for(var func,rule,i=0,l=rules.length;i<l;i++){rule=rules[i];
if(!rule.match){return rule;}func=rule.cmatch||rule.compile("match",{injectself:true,xpathmode:2});
if(func&&func(xmlNode)){return rule;}}},compile:function(name){var rules,s,c=this.$compiled,hasAml=false;
if(name){s=[];rules=this[name];for(var rule,i=0,l=rules.length;i<l;i++){if(!(rule=rules[i]).match&&!rule.value){continue;
}s.push(rule.match,rule.value);if(!hasAml&&rule.value){hasAml=rule.hasaml||rule.value.indexOf("<a:")>-1;
}}c[name]=apf.lm.compileMatch(s);c[name].hasAml=hasAml;return c;}for(name in this){if(name=="each"){continue;
}rules=this[name];if(rules.dataType!=apf.ARRAY){continue;}s=[],hasAml=false;for(var rule,i=0,l=rules.length;
i<l;i++){if(!(rule=rules[i]).match&&!rule.value){continue;}s.push(rule.match,rule.value);
if(!hasAml&&rule.value){hasAml=rule.hasaml||rule.value.indexOf("<a:")>-1;}}c[name]=apf.lm.compileMatch(s);
c[name].hasAml=hasAml;}this.$isCompiled=true;return c;},getRuleIndex:function(name,index){var rule=this[name][index];
if(rule.value){if(!rule.cvalue){rule.compile("value");}}else{if(rule.match){if(!rule.cmatch){rule.compile("match");
}}}return rule;},getDataNode:function(name,xmlNode,createNode,ruleList,multiple){var i,l,func,node,rule,rules=this[name];
if(!rules){return;}for(rule,i=0,l=rules.length;i<l;i++){rule=rules[i];func=rule.cvaluematch;
if(!func){if(rule.match&&rule.value&&rule.value.match(/^\[.*\]$/)){rule.valuematch="{_n = "+rule.match+"; %[child::"+rule.value.substr(1,rule.value.length-2).split("|").join("|child::")+"]}";
}else{rule.valuematch=rule.match||rule.value;}func=rule.$compile("valuematch",{xpathmode:multiple?4:3,injectself:rule.match?true:false});
}if(func&&(node=func(xmlNode,createNode))){if(ruleList){ruleList.push(rule);}return node;
}}return false;}};apf.aml.setElement("bindings",apf.bindings);apf.BindingSeriesRule=function(struct,tagName){this.$init(tagName||"series",apf.NODE_HIDDEN,struct);
};(function(){this.$attrExcludePropBind=apf.extend({formula:1},this.$attrExcludePropBind);
this.$propHandlers.formula=function(value,prop){delete this["c"+prop];};}).call(apf.BindingSeriesRule.prototype=new apf.BindingRule());
apf.aml.setElement("series",apf.BindingSeriesRule);apf.body=function(){this.$init("body",apf.NODE_VISIBLE);
};apf.AmlConfig=function(){this.$init("config",apf.NODE_VISIBLE);};(function(){this.focussable=false;
this.$canLeechSkin=true;this.$draw=function(){this.$ext=this.$int=this.$getExternal(this.$isLeechingSkin?this.localName:"main");
};}).call(apf.body.prototype=new apf.Presentation());apf.AmlConfig.prototype=apf.body.prototype;
apf.aml.setElement("body",apf.body);apf.aml.setElement("config",apf.AmlConfig);
apf.browser=function(struct,tagName){this.$init(tagName||"browser",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.StandardBinding);this.$supportedProperties.push("value","src");
this.$propHandlers.src=this.$propHandlers.value=function(value,force){try{this.$browser.src=value||"about:blank";
}catch(e){this.$browser.src="about:blank";}};this.$propHandlers.border=apf.Presentation.prototype.$propHandlers.border;
this.getValue=function(){return this.value||this.src;};this.getURL=function(){return this.$browser.src;
};this.back=function(){this.$browser.contentWindow.history.back();};this.forward=function(){this.$browser.contentWindow.history.forward();
};this.reload=function(){this.$browser.src=this.$browser.src;};this.print=function(){this.$browser.contentWindow.print();
};this.runCode=function(str,noError){if(noError){try{this.$browser.contentWindow.eval(str);
}catch(e){}}else{this.$browser.contentWindow.eval(str);}};this.$draw=function(parentNode){if(!parentNode){parentNode=this.$pHtmlNode;
}if(apf.cannotSizeIframe){var _iframe=document.createElement("iframe");_iframe.setAttribute("frameborder","0");
this.$ext=parentNode.appendChild(document.createElement("DIV")).appendChild(_iframe).parentNode;
this.$ext.style.width="100px";this.$ext.style.height="100px";this.$browser=this.$ext.firstChild;
this.$browser.style.width="100%";this.$browser.style.height="100%";this.$browser.frameBorder=0;
}else{this.$ext=parentNode.appendChild(document.createElement("iframe"));this.$ext.style.width="100px";
this.$ext.style.height="100px";this.$browser=this.$ext;}this.$ext.className="apfbrowser";
var _self=this;apf.addListener(this.$browser,"load",function(){_self.dispatchEvent("load");
});apf.addListener(this.$browser,"error",function(){_self.dispatchEvent("error");
});this.$ext.host=this;};}).call(apf.browser.prototype=new apf.GuiElement());apf.aml.setElement("browser",apf.browser);
apf.submit=function(struct,tagName){this.$init(tagName||"submit",apf.NODE_VISIBLE,struct);
};apf.trigger=function(struct,tagName){this.$init(tagName||"trigger",apf.NODE_VISIBLE,struct);
};apf.reset=function(struct,tagName){this.$init(tagName||"reset",apf.NODE_VISIBLE,struct);
};apf.button=function(struct,tagName){this.$init(tagName||"button",apf.NODE_VISIBLE,struct);
};(function(){this.$useExtraDiv;this.$childProperty="caption";this.$inited=false;
this.$isLeechingSkin=false;this.$canLeechSkin=true;this.$focussable=apf.KEYBOARD;
this.value=null;this.$init(function(){var forceFocus,_self=this,lastDefaultParent;
this.$propHandlers["default"]=function(value){if(parseInt(value)!=value){value=apf.isTrue(value)?1:0;
}this["default"]=parseInt(value);if(!this.focussable&&value||forceFocus){this.setAttribute("focussable",forceFocus=value);
}if(lastDefaultParent){lastDefaultParent.removeEventListener("focus",setDefault);
lastDefaultParent.removeEventListener("blur",removeDefault);}if(!value){return;
}var pNode=this.parentNode;while(pNode&&!pNode.focussable&&value--){pNode=pNode.parentNode;
}if(pNode){pNode.addEventListener("focus",setDefault);pNode.addEventListener("blur",removeDefault);
}};function setDefault(e){if(e.defaultButtonSet||e.returnValue===false){return;
}e.defaultButtonSet=true;if(this.$useExtraDiv){_self.$ext.appendChild(apf.button.$extradiv);
}_self.$setStyleClass(_self.$ext,_self.$baseCSSname+"Default");if(e.srcElement!=_self&&_self.$focusParent){_self.$focusParent.addEventListener("keydown",btnKeyDown);
}}function removeDefault(e){if(this.$useExtraDiv&&apf.button.$extradiv.parentNode==_self.$ext){_self.$ext.removeChild(apf.button.$extradiv);
}_self.$setStyleClass(_self.$ext,"",[_self.$baseCSSname+"Default"]);if(e.srcElement!=_self&&_self.$focusParent){_self.$focusParent.removeEventListener("keydown",btnKeyDown);
}}function btnKeyDown(e){var ml;var f=apf.document.activeElement;if(f){if(f.hasFeature(apf.__MULTISELECT__)){return;
}ml=f.multiline;}if(!_self.$ext.onmouseup){return;}if(ml&&ml!="optional"&&e.keyCode==13&&e.ctrlKey||(!ml||ml=="optional")&&e.keyCode==13&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){apf.preventDefault(e.htmlEvent);
_self.$ext.onmouseup(e.htmlEvent,true);}}this.addEventListener("focus",setDefault);
this.addEventListener("blur",removeDefault);this.$enable=function(){if(this["default"]){setDefault({});
if(apf.document.activeElement){apf.document.activeElement.focus(true);}}if(this.state&&this.value){this.$setState("Down",{});
}else{if(this.$mouseOver){this.$updateState({},"mouseover");}else{this.$doBgSwitch(1);
}}};this.$disable=function(){if(this["default"]){removeDefault({});}this.$doBgSwitch(4);
this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over",this.$baseCSSname+"Down"]);
};});this.$booleanProperties.state=true;this.$supportedProperties.push("icon","value","tooltip","state","color","caption","action","target","default","submenu","hotkey");
this.$propHandlers.icon=function(value){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");
}if(value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);
}apf.skins.setIcon(this.oIcon,value,this.iconPath);};this.$propHandlers.value=function(value){if(!this.state&&!this.submenu){return;
}if(value===undefined){value=!this.value;}this.value=value;if(this.value){this.$setState("Down",{});
}else{this.$setState("Out",{});}};this.$propHandlers.state=function(value){if(value){this.$setStateBehaviour(this.value);
}else{this.$setNormalBehaviour();}};this.$propHandlers.color=function(value){if(this.oCaption){this.oCaption.parentNode.style.color=value;
}};this.$propHandlers.caption=function(value){if(!this.oCaption){return;}if(value){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);
}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=String(value||"").trim();
}else{this.oCaption.nodeValue=String(value||"").trim();}};this.$propHandlers.hotkey=function(value){if(this.$hotkey){apf.setNodeValue(this.$hotkey,value);
}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(value){this.$lastHotkey=value;
var _self=this;apf.registerHotkey(value,function(e){_self.$setState("Over",{});
$setTimeout(function(){_self.$setState("Out",{});},200);if(_self.$clickHandler&&_self.$clickHandler()){_self.$updateState(e||event,"click");
}else{_self.dispatchEvent("click");}});}if(this.tooltip){apf.GuiElement.propHandlers.tooltip.call(this,this.tooltip);
}};function menuKeyHandler(e){return;var key=e.keyCode;var next,nr=apf.getChildNumber(this);
if(key==37){next=nr==0?this.parentNode.childNodes.length-1:nr-1;this.parentNode.childNodes[next].dispatchEvent("mouseover");
}else{if(key==39){next=(nr>=this.parentNode.childNodes.length-1)?0:nr+1;this.parentNode.childNodes[next].dispatchEvent("mouseover");
}}}function menuDown(e){var menu=self[this.submenu],$button1;this.value=!this.value;
if(this.value){this.$setState("Down",{});}if(!menu){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));
}var menuPressed=this.parentNode.menuIsPressed;if(menuPressed&&menuPressed!=this){menuPressed.setValue(false);
var oldMenu=self[menuPressed.submenu];if(oldMenu!=self[this.submenu]){oldMenu.$propHandlers.visible.call(oldMenu,false,true);
}}if(!this.value){menu.hide();this.$setState("Over",{},"toolbarover");if($button1=this.parentNode.$button1){$button1.$setState("Over",{},"toolbarover");
}this.parentNode.menuIsPressed=false;if(this.parentNode.hasMoved){this.value=false;
}if(apf.hasFocusBug){apf.window.$focusfix();}return false;}this.parentNode.menuIsPressed=this;
menu.display(null,null,false,this,null,null,this.$ext.offsetWidth-2);this.parentNode.hasMoved=false;
if(e){apf.stopPropagation(e.htmlEvent);}return false;}function menuOver(){var menuPressed=this.parentNode.menuIsPressed;
if(!menuPressed||menuPressed==this){return;}var menu=self[this.submenu];if(menu.pinned){return;
}menuPressed.setValue(false);var oldMenu=self[menuPressed.submenu];oldMenu.$propHandlers.visible.call(oldMenu,false,true);
this.setValue(true);this.parentNode.menuIsPressed=this;if(!menu){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));
}var pos=apf.getAbsolutePosition(this.$ext,menu.$ext.offsetParent);menu.display(pos[0],pos[1]+this.$ext.offsetHeight,true,this,null,null,this.$ext.offsetWidth-2);
this.$focus();this.parentNode.hasMoved=true;return false;}this.$propHandlers.submenu=function(value){if(!value){if(this.value&&this.parentNode){try{menuDown.call(this);
}catch(ex){}}this.$focussable=true;this.$setNormalBehaviour();this.removeEventListener("mousedown",menuDown);
this.removeEventListener("mouseover",menuOver);this.removeEventListener("keydown",menuKeyHandler,true);
return;}this.$focussable=false;this.$setStateBehaviour();this.addEventListener("mouseover",menuOver);
this.addEventListener("mousedown",menuDown);this.addEventListener("keydown",menuKeyHandler,true);
};this.setValue=function(value){this.setProperty("value",value,false,true);};this.showMenu=function(){if(this.submenu&&!this.value){menuDown.call(this);
}};this.hideMenu=function(){if(this.submenu&&this.value){menuDown.call(this);}};
this.setCaption=function(value){this.setProperty("caption",value,false,true);};
this.setIcon=function(url){this.setProperty("icon",url,false,true);};this.$setStateBehaviour=function(value){this.value=value||false;
this.isBoolean=true;this.$setStyleClass(this.$ext,this.$baseCSSname+"Bool");if(this.value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");
this.$doBgSwitch(this.states.Down);}};this.$setNormalBehaviour=function(){this.value=null;
this.isBoolean=false;this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Bool"]);
};this.$setState=function(state,e,strEvent){var parentNode=this.parentNode;if(strEvent&&this.dispatchEvent(strEvent,{htmlEvent:e})===false){return;
}if(parentNode&&parentNode.$button2&&parentNode.$button2.value&&!this.submenu){return;
}this.$doBgSwitch(this.states[state]);var bs=this.$baseCSSname;this.$setStyleClass(this.$ext,(state!="Out"?bs+state:""),[(this.value?"":bs+"Down"),bs+"Over"]);
if(this.submenu){bs=this.$baseCSSname+"menu";this.$setStyleClass(this.$ext,(state!="Out"?bs+state:""),[(this.value?"":bs+"Down"),bs+"Over"]);
}};this.$clickHandler=function(){if(this.isBoolean&&!this.submenu){this.setProperty("value",!this.value);
return true;}};this.$submenu=function(hide,force){if(hide){this.setValue(false);
this.$setState("Out",{},"mouseout");if(this.parentNode){this.parentNode.menuIsPressed=false;
}}};this.addEventListener("$skinchange",function(e){if(this.tooltip){apf.GuiElement.propHandlers.tooltip.call(this,this.tooltip);
}});this.$draw=function(){var pNode,isToolbarButton=(pNode=this.parentNode)&&pNode.parentNode.localName=="toolbar";
if(isToolbarButton){if(typeof this.focussable=="undefined"){this.focussable=false;
}this.$focussable=apf.KEYBOARD;}this.$ext=this.$getExternal();this.oIcon=this.$getLayoutNode("main","icon",this.$ext);
this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$useExtraDiv=apf.isTrue(this.$getOption("main","extradiv"));
if(!apf.button.$extradiv&&this.$useExtraDiv){(apf.button.$extradiv=document.createElement("div")).className="extradiv";
}if(this.localName=="submit"){this.action="submit";}else{if(this.localName=="reset"){this.action="reset";
}}this.$setupEvents();};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);
}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}this.$updateState({reset:1});
});this.addEventListener("click",function(e){var action=this.action;if(!action){action=this.localName;
}var _self=this;$setTimeout(function(){(apf.button.actions[action]||apf.K).call(_self);
});});}).call(apf.button.prototype=new apf.BaseButton());apf.submit.prototype=apf.trigger.prototype=apf.reset.prototype=apf.button.prototype;
apf.aml.setElement("submit",apf.submit);apf.aml.setElement("trigger",apf.trigger);
apf.aml.setElement("reset",apf.reset);apf.aml.setElement("button",apf.button);apf.submit.action=apf.trigger.actions=apf.reset.actions=apf.button.actions={undo:function(action){var tracker;
if(this.target&&self[this.target]){tracker=self[this.target].localName=="actiontracker"?self[this.target]:self[this.target].getActionTracker();
}else{var at,node=this;while(node.parentNode){at=(node=node.parentNode).$at;}}(tracker||apf.window.$at)[action||"undo"]();
},redo:function(){apf.button.actions.undo.call(this,"redo");},remove:function(){if(this.target&&self[this.target]){self[this.target].remove();
}else{apf.console.warn("Target to remove wasn't found or specified:'"+this.target+"'");
}},add:function(){if(this.target&&self[this.target]){self[this.target].add();}else{apf.console.warn("Target to add wasn't found or specified:'"+this.target+"'");
}},rename:function(){if(this.target&&self[this.target]){self[this.target].startRename();
}else{apf.console.warn("Target to rename wasn't found or specified:'"+this.target+"'");
}},login:function(){var parent=this.target&&self[this.target]?self[this.target]:this.parentNode;
var vg=parent.$validgroup||new apf.ValidationGroup();if(!vg.childNodes.length){vg.childNodes=parent.childNodes.slice();
}var vars={};function loopChildren(nodes){for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.hasFeature(apf.__VALIDATION__)&&!node.$validgroup&&!node.form){node.setProperty("validgroup",vg);
}if(node.type){vars[node.type]=node.getValue();}if(vars.username&&vars.password){return;
}if(node.childNodes.length){loopChildren(node.childNodes);}}}loopChildren(parent.childNodes);
if(!vg.isValid()){return;}if(!vars.username||!vars.password){throw new Error(apf.formatErrorString(0,this,"Clicking the login button","Could not find the username or password box"));
return;}var auth=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}auth.logIn(vars.username,vars.password);},logout:function(){var auth=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}auth.logOut();},submit:function(doReset){var vg,model;var parent=this.target&&self[this.target]?self[this.target]:this.parentNode;
if(parent.$isModel){model=parent;}else{if(!parent.$validgroup){parent.$validgroup=parent.validgroup?self[parent.validgroup]:new apf.ValidationGroup();
}vg=parent.$validgroup;if(!vg.childNodes.length){vg.childNodes=parent.childNodes.slice();
}function loopChildren(nodes){for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.getModel){model=node.getModel();if(model){return false;}}if(node.childNodes.length){if(loopChildren(node.childNodes)===false){return false;
}}}}loopChildren(parent.childNodes);if(!model){model=apf.globalModel;if(!model){throw new Error(apf.formatErrorString(0,this,"Finding a model to submit","Could not find a model to submit."));
return;}}}if(doReset){model.reset();return;}if(vg&&!vg.isValid()){return;}model.submit();
},reset:function(){apf.button.actions.submit.call(this,true);},ok:function(){var node;
if(this.target){node=self[this.target];}else{var node=this.parentNode;while(node&&!node.hasFeature(apf.__TRANSACTION__)){node=node.parentNode;
}if(node&&!node.hasFeature(apf.__TRANSACTION__)){return;}}if(node.commit()&&node.close){node.close();
}},cancel:function(){var node;if(this.target){node=self[this.target];}else{var node=this.parentNode;
while(node&&!node.hasFeature(apf.__TRANSACTION__)){node=node.parentNode;}if(node&&!node.hasFeature(apf.__TRANSACTION__)){return;
}}node.rollback();if(node.close){node.close();}},apply:function(){var node;if(this.target){node=self[this.target];
}else{var node=this.parentNode;while(node&&!node.hasFeature(apf.__TRANSACTION__)){node=node.parentNode;
}if(node&&!node.hasFeature(apf.__TRANSACTION__)){return;}}if(node.autoshow){node.autoshow=-1;
}if(node.commit(true)){node.begin("update");}},close:function(){var parent=this.target&&self[this.target]?self[this.target]:this.parentNode;
while(parent&&!parent.close){parent=parent.parentNode;}if(parent&&parent.close){parent.close();
}else{apf.console.warn("Target to close wasn't found or specified:'"+this.target+"'");
}}};apf.caldropdown=function(struct,tagName){this.$animType=1;this.$animSteps=5;
this.$animSpeed=20;this.$itemSelectEvent="onmouseup";this.dragdrop=false;this.reselectable=true;
this.$focussable=true;this.autoselect=false;this.multiselect=false;this.outputFormat="yyyy-mm-dd";
this.captionFormat="yyyy-mm-dd";this.$sliderHeight=0;this.isOpen=false;this.$calVars={day:null,month:null,year:null,hours:1,minutes:0,seconds:0,currentMonth:null,currentYear:null,numberOfDays:null,dayNumber:null,days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:[{name:"January",number:31},{name:"February",number:28},{name:"March",number:31},{name:"April",number:30},{name:"May",number:31},{name:"June",number:30},{name:"July",number:31},{name:"August",number:31},{name:"September",number:30},{name:"October",number:31},{name:"November",number:30},{name:"December",number:31}]};
this.$init(tagName||"caldropdown",apf.NODE_VISIBLE,struct);};(function(){this.implement(apf.DataAction);
this.$supportedProperties.push("initial-message","output-format","default","caption-format","value");
this.$propHandlers["output-format"]=function(value){this.outputFormat=value;};this.$propHandlers["caption-format"]=function(value){if(this.value){var c=this.$calVars;
this.$setLabel(new Date(c.year,c.month,c.day,c.hours,c.minutes,c.seconds).format(this.captionFormat=value));
}else{this.captionFormat=value;}};this.$propHandlers.value=function(value){var c=this.$calVars;
var outputFormat=this.getAttribute("output-format");if(outputFormat!==null&&outputFormat!=this.outputFormat){this.outputFormat=outputFormat;
}if(!value){this.$setLabel();return;}var date=apf.date.getDateTime(value,this.outputFormat);
if(!date||isNaN(date)){return;}c.day=date.getDate();c.month=date.getMonth();c.year=date.getFullYear();
c.hours=date.getHours();c.minutes=date.getMinutes();c.seconds=date.getSeconds();
this.value=value;this.$setLabel(new Date(c.year,c.month,c.day,c.hours,c.minutes,c.seconds).format(this.captionFormat));
this.redraw(c.month,c.year);};this.getValue=function(){return this.value;};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.addEventListener("keydown",function(e){e=e||event;var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,c=this.$calVars;
switch(key){case 13:this.selectDay(c.day);this.slideUp();break;case 33:this.nextMonth();
break;case 34:this.prevMonth();break;case 37:if(ctrlKey){this.prevMonth();}else{if(shiftKey){this.prevYear();
}else{if(c.day-1<1){this.prevMonth();this.selectDay(c.months[c.currentMonth].number);
}else{this.selectDay(c.day-1);}}}break;case 38:if(ctrlKey){this.slideUp();}else{if(c.day-7<1){this.prevMonth();
this.selectDay(c.months[c.currentMonth].number+c.day-7);}else{this.selectDay(c.day-7);
}}break;case 39:if(ctrlKey){this.nextMonth();}else{if(shiftKey){this.nextYear();
}else{this.selectDay(c.day+1);}}break;case 40:if(ctrlKey){this.slideDown(e);}else{this.selectDay(c.day+7);
}break;case 84:if(ctrlKey){this.today();}return false;break;}},true);this.slideToggle=function(e,userAction){if(!e){e=event;
}if(userAction&&this.disabled){return;}if(this.isOpen){this.slideUp();}else{this.slideDown(e);
}};this.slideDown=function(e){if(this.dispatchEvent("slidedown")===false){return false;
}this.isOpen=true;this.oSlider.style.display="block";this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";
this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");
this.oSlider.style.height=(this.$sliderHeight>0?this.$sliderHeight-1:0)+"px";this.oSlider.style.width=(this.$ext.offsetWidth>0?this.$ext.offsetWidth-1:0)+"px";
apf.caldropdown.cache.oSlider.host=this;this.redraw(this.$calVars.month,this.$calVars.year);
apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:this.$ext.offsetWidth+1,height:this.$sliderHeight,callback:function(container){container.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";
}});};this.$getPageScroll=function(){return[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];
};this.slideUp=function(){if(this.dispatchEvent("slideup")===false){return false;
}this.isOpen=false;if(this.selected){var htmlNode=apf.xmldb.findHtmlNode(this.selected,this);
if(htmlNode){this.$setStyleClass(htmlNode,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);
apf.popup.hide();return false;};this.$setLabel=function(value){this.oLabel.innerHTML=value||this["initial-message"]||"";
this.$setStyleClass(this.$ext,value?"":this.$baseCSSname+"Initial",[!value?"":this.$baseCSSname+"Initial"]);
};this.addEventListener("afterselect",function(e){if(!e){e=event;}this.slideUp();
if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(e.selection.length?this.$applyBindRule("value",this.selected):"");
if(this.hasFeature(apf.__VALIDATION__)&&this.form){this.validate(true);}});this.$blur=function(){this.slideUp();
if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
};this.$focus=function(){apf.popup.forceHide();this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");
};this.$setClearMessage=function(msg){if(msg){this.$setLabel(msg);}};this.$removeClearMessage=function(){this.$setLabel("");
};this.addEventListener("slidedown",function(){if(!this.form||!this.form.xmlActions||this.xmlRoot){return;
}var loadlist=this.form.xmlActions.selectSingleNode("LoadList[@element='"+this.name+"']");
if(!loadlist){return;}this.form.processLoadRule(loadlist,true,[loadlist]);return false;
});this.addEventListener("popuphide",this.slideUp);var isLeapYear=function(year){return((year%4===0)&&(year%100!==0))||(year%400===0)?true:false;
};this.redraw=function(month,year){var c=this.$calVars;c.currentMonth=month;c.currentYear=year;
var _width=this.$ext.offsetWidth,temp=Math.floor((_width-36)/8)*8+32-apf.getDiff(this.oNavigation)[0],w_days=new Date(year,0,1).getDay();
if(temp>=0){this.oNavigation.style.width=temp+"px";}for(i=0;i<=month;i++){if(isLeapYear(year)&&i==1){w_days++;
}w_days+=c.months[i].number;}var w_weeks=Math.ceil(w_days/7),date=new Date(year,month);
c.numberOfDays=c.months[date.getMonth()].number;if(isLeapYear(year)&&date.getMonth()==1){c.numberOfDays++;
}c.dayNumber=new Date(year,month,1).getDay();var prevMonth=month==0?11:month-1,prevMonthDays=c.months[prevMonth].number-c.dayNumber+1,nextMonthDays=1,rows=this.oNavigation.childNodes,cells,y;
for(i=0;i<rows.length;i++){if((rows[i].className||"").indexOf("today")!=-1){if(_width<300){var shortTodayText=apf.language.getWord("sub.calendar.shortToday")||"T";
rows[i].innerHTML=shortTodayText;rows[i].style.width="8px";rows[i].setAttribute("title",shortTodayText);
}else{var TodayText=apf.language.getWord("sub.calendar.today")||"Today";rows[i].innerHTML=TodayText;
rows[i].style.width="32px";rows[i].setAttribute("title",TodayText);}}else{if((rows[i].className||"").indexOf("status")!=-1){if(_width>=300){rows[i].innerHTML=c.months[c.currentMonth].name+" "+c.currentYear;
}else{rows[i].innerHTML=(c.currentMonth+1)+"/"+c.currentYear;}}}}this.$sliderHeight=22;
temp=Math.floor((_width-37)/8);var squareSize=temp>0?temp:0;var daysofweek=this.oDow.childNodes,d_height=Math.floor(squareSize/4+6),d_paddingTop=Math.floor(squareSize/4-8)>0?Math.floor(squareSize/4-8):0,d_fontSize=_width<150?"6px":(_width<=220?"9px":"11px"),d_width=(squareSize*8+32);
this.oDow.style.width=d_width+"px";this.$sliderHeight+=d_height+d_paddingTop;for(var z=0,i=0;
i<daysofweek.length;i++){if((daysofweek[i].className||"").indexOf("dayofweek")>-1){daysofweek[i].style.width=squareSize+"px";
daysofweek[i].style.height=d_height+"px";daysofweek[i].style.paddingTop=d_paddingTop+"px";
daysofweek[i].style.fontSize=d_fontSize;if(z>0){daysofweek[i].innerHTML=c.days[z-1].substr(0,3);
}z++;}}var c_height=Math.floor((squareSize+12)/2),c_paddingTop=squareSize-c_height>0?squareSize-c_height:0;
rows=this.oSlider.childNodes;for(z=0,y=0,i=0;i<rows.length;i++){if((rows[i].className||"").indexOf("row")==-1){continue;
}rows[i].style.width=(d_width-apf.getDiff(rows[i])[0])+"px";if(!apf.isGecko){rows[i].style.paddingTop="1px";
}this.$sliderHeight+=(squareSize+5);cells=rows[i].childNodes;for(var j=0,disabledRow=0;
j<cells.length;j++){if((cells[j].className||"").indexOf("cell")==-1){continue;}z++;
cells[j].style.width=squareSize+"px";cells[j].style.height=c_height+"px";cells[j].style.paddingTop=c_paddingTop+"px";
cells[j].style.margin=z%8==0&&z!==1?"1px 0 1px 0":"1px 2px 1px 0";this.$setStyleClass(cells[j],"",["weekend","disabled","active","prev","next","weeknumber"]);
if((z-1)%8==0){cells[j].innerHTML=w_weeks-Math.ceil((c.months[c.currentMonth].number+c.dayNumber)/7)+1+(z-1)/8;
this.$setStyleClass(cells[j],"weeknumber");}else{y++;if(y<=c.dayNumber){cells[j].innerHTML=prevMonthDays++;
this.$setStyleClass(cells[j],"disabled prev");}else{if(y>c.dayNumber&&y<=c.numberOfDays+c.dayNumber){cells[j].innerHTML=y-c.dayNumber;
var dayNrWeek=new Date(year,month,y-c.dayNumber).getDay();if(dayNrWeek==0||dayNrWeek==6){this.$setStyleClass(cells[j],"weekend");
}if(month==c.month&&year==c.year&&y-c.dayNumber==c.day){this.$setStyleClass(cells[j],"active");
}}else{if(y>c.numberOfDays+c.dayNumber){cells[j].innerHTML=nextMonthDays++;this.$setStyleClass(cells[j],"disabled next");
disabledRow++;}}}}}rows[i].style.visibility=disabledRow==7?"hidden":"visible";}};
this.selectDay=function(nr,type){var c=this.$calVars,newMonth=type=="prev"?c.currentMonth:(type=="next"?c.currentMonth+2:c.currentMonth+1),newYear=c.currentYear;
if(newMonth<1){newMonth=12;newYear--;}else{if(newMonth>12){newMonth=1;newYear++;
}}this.change(new Date(newYear,(newMonth-1),nr,c.hours,c.minutes,c.seconds).format(this.outputFormat));
};this.nextYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear+1);
};this.prevYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear-1);
};this.nextMonth=function(){var newMonth,newYear,c=this.$calVars;if(c.currentMonth>10){newMonth=0;
newYear=c.currentYear+1;}else{newMonth=c.currentMonth+1;newYear=c.currentYear;}this.redraw(newMonth,newYear);
};this.prevMonth=function(){var newMonth,newYear,c=this.$calVars;if(c.currentMonth<1){newMonth=11;
newYear=c.currentYear-1;}else{newMonth=c.currentMonth-1;newYear=c.currentYear;}this.redraw(newMonth,newYear);
};this.nextDay=function(){var c=this.$calVars;this.$propHandlers.value.call(this,new Date(c.year,c.month,c.day+1,0,0,0).format(this.outputFormat));
};this.previousDay=function(){var c=this.$calVars;this.$propHandlers.value.call(this,new Date(c.year,c.month,c.day-1,0,0,0).format(this.outputFormat));
};this.today=function(){this.$propHandlers.value.call(this,new Date().format(this.outputFormat));
};this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");
this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";
this.$ext=this.$getExternal(null,null,function(oExt){oExt.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');                 o.$setStyleClass(o.$ext, o.$baseCSSname + "Over", null, true);');
oExt.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');                 if (o.isOpen) return;                 o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"], true);');
var oButton=this.$getLayoutNode("main","button",oExt);if(oButton){oButton.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}var oLabel=this.$getLayoutNode("main","label",oExt);if(this.clickOpen=="both"){oLabel.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;
}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);
}if(apf.caldropdown.cache){var cal=apf.caldropdown.cache;this.oSlider=cal.oSlider;
this.oNavigation=cal.oNavigation;this.oDow=cal.oDow;apf.caldropdown.cache.refcount++;
this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));
}else{this.oSlider=this.$getExternal("container",null,function(oExt1){var i,oSlider=this.$getLayoutNode("container","contents",oExt1);
for(i=0;i<6;i++){this.$getNewContext("row");var oRow=oSlider.appendChild(this.$getLayoutNode("row"));
for(var j=0;j<8;j++){this.$getNewContext("cell");var oCell=this.$getLayoutNode("cell");
if(j>0){oCell.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+").$setStyleClass(this, '', ['hover'], true);");
oCell.setAttribute("onmouseover","if (this.className.indexOf('disabled') > -1                                    || this.className.indexOf('active') > -1)                                      return;                                 apf.lookup("+this.$uniqueId+").$setStyleClass(this, 'hover', null, true);");
oCell.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                                 if (o.disabled) return;                                 if (this.className.indexOf('prev') > -1)                                      o.selectDay(this.innerHTML, 'prev');                                 else if (this.className.indexOf('next') > -1)                                      o.selectDay(this.innerHTML, 'next');                                 else                                      o.selectDay(this.innerHTML);                                 o.slideUp();");
}oRow.appendChild(oCell);}}var oNavigation=this.$getLayoutNode("container","navigation",oExt1);
if(oNavigation){var buttons=["prevYear","prevMonth","nextYear","nextMonth","today","status"];
for(i=0;i<buttons.length;i++){this.$getNewContext("button");var btn=oNavigation.appendChild(this.$getLayoutNode("button"));
this.$setStyleClass(btn,buttons[i]);if(buttons[i]!=="status"){btn.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+"); if (o.disabled) return; o."+buttons[i]+'();apf.setStyleClass(this, "down");');
btn.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["down"], true);');
btn.setAttribute("onmouseover","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "hover", null, true);');
btn.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["hover"], true);');
}}}var oDaysOfWeek=this.$getLayoutNode("container","daysofweek",oExt1);for(i=0;
i<this.$calVars.days.length+1;i++){this.$getNewContext("day");oDaysOfWeek.appendChild(this.$getLayoutNode("day"));
}});this.oNavigation=this.$getLayoutNode("container","navigation",this.oSlider);
this.oDow=this.$getLayoutNode("container","daysofweek",this.oSlider);}this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));
document.body.appendChild(this.oSlider);this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;
if(!apf.caldropdown.cache){apf.caldropdown.cache={oSlider:this.oSlider,oNavigation:this.oNavigation,oDow:this.oDow};
apf.caldropdown.cache.refcount=0;}};this.$loadAml=function(x){var date,c=this.$calVars;
if(typeof this.value=="undefined"){switch(this["default"]){case"today":this.$propHandlers.value.call(this,new Date().format(this.outputFormat));
break;default:date=new Date();c.day=0;c.month=date.getMonth();c.year=date.getFullYear();
this.$setLabel();break;}}else{date=apf.date.getDateTime(this.value,this.outputFormat);
c.day=date.getDate();c.month=date.getMonth();c.year=date.getFullYear();if(c.day&&c.month&&c.year){this.$propHandlers.value.call(this,new Date(c.year,c.month,c.day,c.hours,c.minutes,c.seconds).format(this.outputFormat));
}}};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.oSlider);
this.oSlider=null;if(apf.caldropdown.cache){if(apf.caldropdown.cache.refcount==0){apf.caldropdown.cache=null;
}else{apf.caldropdown.cache.refcount--;}}};}).call(apf.caldropdown.prototype=new apf.StandardBinding());
apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("caldropdown",apf.caldropdown);
apf.calendar=function(struct,tagName){this.$init(tagName||"calendar",apf.NODE_VISIBLE,struct);
this.$calVars={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:[{name:"January",number:31},{name:"February",number:28},{name:"March",number:31},{name:"April",number:30},{name:"May",number:31},{name:"June",number:30},{name:"July",number:31},{name:"August",number:31},{name:"September",number:30},{name:"October",number:31},{name:"November",number:30},{name:"December",number:31}],day:null,month:null,year:null,hours:1,minutes:0,seconds:0,currentMonth:null,currentYear:null,numberOfDays:null,dayNumber:null,startDay:0,temp:null,inited:false,startDiffs:[],prevWidth:0,rRows:[],rCells:[[],[],[],[],[],[]],rDoW:[]};
};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("output-format","default","day","month","year");
this.$propHandlers["output-format"]=function(value){if(this.value){var c=this.$calVars;
this.setProperty("value",new Date(c.year,c.month,c.day,c.hours,c.minutes,c.seconds).format(this.outputFormat=value));
}else{this.outputFormat=value;}};this.$propHandlers["start-day"]=function(value){this.$calVars.startDay=parseInt(value);
};this.$propHandlers.value=function(value){var c=this.$calVars;if(!this.outputFormat){c.temp=value;
return;}var date=apf.date.getDateTime(value,this.outputFormat);if(!date||isNaN(date)){return;
}c.day=date.getDate();c.month=date.getMonth();c.year=date.getFullYear();c.hours=date.getHours();
c.minutes=date.getMinutes();c.seconds=date.getSeconds();this.setProperty("day",c.day);
this.setProperty("month",c.month+1);this.setProperty("year",c.year);this.value=value;
this.redraw(c.month,c.year);};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.value;};this.addEventListener("keydown",function(e){e=e||event;
var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,c=this.$calVars;switch(key){case 13:this.selectDay(c.day);
break;case 33:this.nextMonth();break;case 34:this.prevMonth();break;case 37:if(ctrlKey){this.prevMonth();
}else{if(shiftKey){this.prevYear();}else{if(c.day-1<1){this.prevMonth();this.selectDay(c.months[c.currentMonth].number);
}else{this.selectDay(c.day-1);}}}break;case 38:if(c.day-7<1){this.prevMonth();this.selectDay(c.months[c.currentMonth].number+c.day-7);
}else{this.selectDay(c.day-7);}break;case 39:if(ctrlKey){this.nextMonth();}else{if(shiftKey){this.nextYear();
}else{this.selectDay(c.day+1);}}break;case 40:this.selectDay(c.day+7);break;case 84:if(ctrlKey){this.today();
}return false;break;}},true);this.$blur=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
};this.$focus=function(){this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");
};var isLeapYear=function(year){return((year%4==0)&&(year%100!==0))||(year%400==0)?true:false;
};this.$getMargin=function(oHtml){return[(parseInt(apf.getStyle(oHtml,"marginLeft"))||0)+(parseInt(apf.getStyle(oHtml,"marginLeft"))||0),(parseInt(apf.getStyle(oHtml,"marginTop"))||0)+(parseInt(apf.getStyle(oHtml,"marginBottom"))||0)];
};this.$getFontSize=function(oHtml){return parseInt(apf.getStyle(oHtml,"fontSize"));
};this.$getPadding=function(oHtml){return[parseInt(apf.getStyle(oHtml,"paddingLeft"))+parseInt(apf.getStyle(oHtml,"paddingRight")),parseInt(apf.getStyle(oHtml,"paddingTop"))+parseInt(apf.getStyle(oHtml,"paddingBottom"))];
};this.$resize=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear);
};this.redraw=function(month,year){var w_firstYearDay=new Date(year,0,1),w_dayInWeek=w_firstYearDay.getDay(),w_days=w_dayInWeek,c=this.$calVars;
c.currentMonth=month;c.currentYear=year;for(i=0;i<=month;i++){if(isLeapYear(year)&&i==1){w_days++;
}w_days+=c.months[i].number;}var w_weeks=Math.ceil(w_days/7),date=new Date(year,month);
c.numberOfDays=c.months[date.getMonth()].number;if(isLeapYear(year)&&date.getMonth()==1){c.numberOfDays++;
}c.dayNumber=new Date(year,month,1).getDay();var dayInTheWeek=c.dayNumber-c.startDay;
dayInTheWeek=dayInTheWeek<0?6+1+dayInTheWeek:dayInTheWeek;var prevMonth=month==0?11:month-1,prevMonthDays=c.months[prevMonth].number-dayInTheWeek+1,nextMonthDays=1,ctDiff=apf.getDiff(this.$ext),_width=parseInt(this.$ext.offsetWidth||this.$ext.style.width||apf.getStyle(this.$ext,"width"))-ctDiff[0],navi=this.oNavigation.childNodes;
if(!_width){return;}for(i=0;i<navi.length;i++){if((navi[i].className||"").indexOf("today")!=-1){navi[i].innerHTML="T";
}else{if((navi[i].className||"").indexOf("status")!=-1){if(_width>=300){navi[i].innerHTML=c.months[c.currentMonth].name+" "+c.currentYear;
navi[i].style.width="100px";navi[i].style.marginLeft="-50px";}else{navi[i].innerHTML=(c.currentMonth+1)+"/"+c.currentYear;
navi[i].style.width="40px";navi[i].style.marginLeft="-20px";}}}}var rows=this.oContent.childNodes,cWidthf,pl;
for(var i=0,z=0,y=0;i<rows.length;i++){if((rows[i].className||"").indexOf("row")>-1){var rDiff=!c.inited?apf.getDiff(rows[i]):c.startDiffs[0];
var rDiff2=!c.inited?this.$getMargin(rows[i]):c.startDiffs[1];var rWidth=_width-rDiff[0]-rDiff2[0];
if(!c.inited){c.startDiffs[0]=rDiff;c.startDiffs[1]=rDiff2;}var cells=rows[i].childNodes;
for(var j=0,disabledRow=0;j<cells.length;j++){if((cells[j].className||"").indexOf("cell")>-1){var cDiff=!c.inited?apf.getDiff(cells[j]):c.startDiffs[2],cDiff2=!c.inited?this.$getMargin(cells[j]):c.startDiffs[3];
if(!c.inited){c.startDiffs[2]=cDiff;c.startDiffs[3]=cDiff2;}cWidthf=Math.floor(rWidth/8)-cDiff[0]-cDiff2[0];
var width=cWidthf,height=cWidthf+(cDiff[1]>cDiff[0]?cDiff[0]-cDiff[1]:0)+(cDiff2[1]>cDiff2[0]?cDiff2[0]-cDiff2[1]:0),paddingTop;
var paddingBottom=paddingTop=Math.ceil((height-this.$getFontSize(cells[j]))/2);
height-=(paddingTop+paddingBottom-cDiff[1]);cells[j].style.width=(width>0?width:0)+"px";
if(height>0){cells[j].style.height=height+"px";}cells[j].style.paddingTop=(paddingTop>0?paddingTop+1:0)+"px";
cells[j].style.paddingBottom=(paddingBottom>0?paddingBottom-1:0)+"px";this.$setStyleClass(cells[j],"",["weekend","disabled","active","prev","next","weeknumber"]);
z++;if((z-1)%8==0){cells[j].innerHTML=w_weeks-Math.ceil((c.months[c.currentMonth].number+c.dayNumber)/7)+1+(z-1)/8;
this.$setStyleClass(cells[j],"weeknumber");}else{y++;var dayNrWeek=new Date(year,month,y-dayInTheWeek).getDay();
if(dayNrWeek==0||dayNrWeek==6){this.$setStyleClass(cells[j],"weekend");}if(y<=dayInTheWeek){this.$getLayoutNode("cell","container",cells[j]).innerHTML=prevMonthDays++;
this.$setStyleClass(cells[j],"disabled prev");}else{if(y>dayInTheWeek&&y<=c.numberOfDays+dayInTheWeek){this.$getLayoutNode("cell","container",cells[j]).innerHTML=y-dayInTheWeek;
if(month==c.month&&year==c.year&&y-dayInTheWeek==c.day){this.$setStyleClass(cells[j],"active");
}}else{if(y>c.numberOfDays+dayInTheWeek){this.$getLayoutNode("cell","container",cells[j]).innerHTML=nextMonthDays++;
this.$setStyleClass(cells[j],"disabled next");disabledRow++;}}}}}}pl=Math.floor((rWidth-rDiff[0]-rDiff2[0]-(cWidthf+cDiff[0]+cDiff2[0])*8)/2);
rows[i].style.paddingLeft=pl+"px";var eDiff=!c.inited?this.$getPadding(this.$ext):c.startDiffs[4];
if(!c.inited){c.startDiffs[4]=eDiff;}this.$ext.style.paddingBottom=(Math.floor(eDiff[1]/2)+pl)+"px";
if(!this.height){rows[i].style.display=disabledRow==7?"none":"block";}else{rows[i].style.visibility=disabledRow==7?"hidden":"visible";
}}}var daysofweek=this.oDow.childNodes,startDay=this.$calVars.startDay,dayIndex;
this.oDow.style.paddingLeft=pl+"px";for(var z=0,i=0;i<daysofweek.length;i++){if((daysofweek[i].className||"").indexOf("dayofweek")>-1){daysofweek[i].style.width=(cWidthf>0?cWidthf:0)+"px";
if(cWidthf<16){daysofweek[i].style.fontSize="9px";}if(z>0){dayIndex=(z-1+startDay)%7;
daysofweek[i].innerHTML=c.days[dayIndex].substr(0,cWidthf<12?1:(cWidthf<30?2:3));
apf.setStyleClass(daysofweek[i],c.days[dayIndex],c.days,true);}else{daysofweek[i].innerHTML="W";
apf.setStyleClass(daysofweek[i],"weeknumber_column",null,true);}z++;}}c.inited=true;
};this.getYear=function(){return this.$calVars.currentYear;};this.getMonth=function(){return this.$calVars.currentMonth+1;
};this.getDay=function(){return this.$calVars.day;};this.setYear=function(value){this.redraw(this.$calVars.currentMonth,value);
};this.setMonth=function(value){this.redraw(parseInt(value)-1,this.$calVars.currentYear);
};this.selectDay=function(cellNode,type,userAction){if(userAction&&this.disabled){return;
}var nr=this.$getLayoutNode("cell","container",cellNode).innerHTML;var c=this.$calVars,newMonth=type=="prev"?c.currentMonth:(type=="next"?c.currentMonth+2:c.currentMonth+1),newYear=c.currentYear;
if(newMonth<1){newMonth=12;newYear--;}else{if(newMonth>12){newMonth=1;newYear++;
}}this.change(new Date(newYear,(newMonth-1),nr,c.hours,c.minutes,c.seconds).format(this.outputFormat));
};this.nextYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear+1);
};this.prevYear=function(){this.redraw(this.$calVars.currentMonth,this.$calVars.currentYear-1);
};this.nextMonth=function(){var c=this.$calVars;this.redraw(c.currentMonth>10?0:c.currentMonth+1,c.currentMonth>10?c.currentYear+1:c.currentYear);
};this.prevMonth=function(){var c=this.$calVars;this.redraw(c.currentMonth<1?11:c.currentMonth-1,c.currentMonth<1?c.currentYear-1:c.currentYear);
};this.today=function(){this.setProperty("value",new Date().format(this.outputFormat));
};this.$draw=function(){this.$ext=this.$getExternal("main",null,function(oExt){var oContent=this.$getLayoutNode("main","content",oExt);
for(var i=0;i<6;i++){this.$getNewContext("row");var oRow=oContent.appendChild(this.$getLayoutNode("row"));
for(var j=0;j<8;j++){this.$getNewContext("cell");var oCell=this.$getLayoutNode("cell");
if(j>0){oCell.setAttribute("onmouseover","if (this.className.indexOf('disabled') > -1 || this.className.indexOf('active') > -1) return; apf.lookup("+this.$uniqueId+").$setStyleClass(this, 'hover', null, true);");
oCell.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+").$setStyleClass(this, '', ['hover'], true);");
oCell.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+"); if (this.className.indexOf('prev') > -1) { o.selectDay(this, 'prev', true);} else if (this.className.indexOf('next') > -1) {o.selectDay(this, 'next', true);} else {o.selectDay(this, null, true);}");
}oRow.appendChild(oCell);}}var oNavigation=this.$getLayoutNode("main","navigation",oExt);
if(oNavigation){var buttons=["prevYear","prevMonth","nextYear","nextMonth","today","status"];
for(var i=0;i<buttons.length;i++){this.$getNewContext("button");var btn=oNavigation.appendChild(this.$getLayoutNode("button"));
this.$setStyleClass(btn,buttons[i]);if(buttons[i]!=="status"){btn.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                                             if (!o.disabled)                                                 o."+buttons[i]+'();                                                apf.setStyleClass(this, "down");');
}btn.setAttribute("onmouseup",'apf.setStyleClass(this, "", ["down"]);');}}var oDaysOfWeek=this.$getLayoutNode("main","daysofweek",oExt);
for(var i=0;i<this.$calVars.days.length+1;i++){this.$getNewContext("day");oDaysOfWeek.appendChild(this.$getLayoutNode("day"));
}});this.oNavigation=this.$getLayoutNode("main","navigation",this.$ext);this.oDow=this.$getLayoutNode("main","daysofweek",this.$ext);
this.oContent=this.$getLayoutNode("main","content",this.$ext);apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];        if (o) o.$resize()",true);
apf.layout.queue(this.$ext);};this.$loadAml=function(x){if(typeof this.value=="undefined"){switch(this["default"]){case"today":this.setProperty("value",new Date().format(this.outputFormat));
break;default:this.setProperty("value",new Date().format(this.outputFormat));break;
}}else{var c=this.$calVars,date=apf.date.getDateTime(c.temp||this.value,this.outputFormat);
c.day=date.getDate();c.month=date.getMonth();c.year=date.getFullYear();if(c.day&&c.month&&c.year){this.setProperty("value",new Date(c.year,c.month,c.day,c.hours,c.minutes,c.seconds).format(this.outputFormat));
}}};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.$ext);
this.oCalendar=null;};}).call(apf.calendar.prototype=new apf.StandardBinding());
apf.aml.setElement("calendar",apf.calendar);apf.calendarlist=function(struct,tagName){this.$init(tagName||"calendarlist",apf.NODE_VISIBLE,struct);
this.date=new Date();this.strDate="";this.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
this.months=[{name:"January",number:31},{name:"February",number:28},{name:"March",number:31},{name:"April",number:30},{name:"May",number:31},{name:"June",number:30},{name:"July",number:31},{name:"August",number:31},{name:"September",number:30},{name:"October",number:31},{name:"November",number:30},{name:"December",number:31}];
this.range="day";this.mode="normal";this.dateFormat="mm-dd-yyyy";this.interval=null;
this.intervals={day:15,week:60,month:60};this.ranges={day:1440,week:10080};this.calendarEvents=[];
};(function(){if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;
}var x=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!x){return;
}return x.nodeType==1?x:x.parentNode;};this.addEventListener("afterselect",function(e){if(this.hasFeature(apf.__VALIDATION__)){this.validate(true);
}});this.$supportedProperties.push("appearance","mode","range","date","date-format","interval");
this.$propHandlers.range=function(value){this.date=this.getStartDate(this.date,this.range=value);
this.$updateHours();};this.$propHandlers.day=function(value){this.strDate=value;
this.date=this.getStartDate(apf.date.getDateTime(value,this.dateFormat),this.range);
this.$updateHours();};this.$propHandlers["date-format"]=function(value){this.dateFormat=value;
};this.$propHandlers.interval=function(value){value=parseInt(value);this.interval=value>5?value:5;
this.$updateHours();};this.$propHandlers.mode=function(value){this.mode=value;};
this.getStartDate=function(objDate,range){switch(range){case"day":return apf.date.getDateTime(this.strDate,this.dateFormat);
case"week":return new Date(objDate.getFullYear(),objDate.getMonth(),objDate.getDate()-objDate.getDay(),0,0,0);
case"month":return new Date(objDate.getFullYear(),objDate.getMonth(),1,0,0,0);}};
function $xmlUpdate(e){}this.addEventListener("keydown",this.$keyHandler,true);
this.$draw=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);
this.$oHours=this.$getLayoutNode("main","hours",this.$ext);this.$oNoteField=this.$getLayoutNode("main","note_field",this.$ext);
this.$oNoteFieldCon=this.$getLayoutNode("main","note_field_con",this.$ext);this.$container.setAttribute("onmousemove","var o = apf.lookup("+this.$uniqueId+"); if (o.mode == 'add')o.$showNoteField(event);");
this.$oNoteField.setAttribute("onmousemove","var o = apf.lookup("+this.$uniqueId+"); if (o.mode == 'add')o.$showNoteField(event);");
this.$oNoteField.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+"); o.$hideNoteField(event);");
this.$oNoteField.setAttribute("onclick","var o = apf.lookup("+this.$uniqueId+"); if (o.mode == 'add')o.$editNoteField();");
if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var _self=this;
this.$ext.onclick=function(e){_self.dispatchEvent("click",{htmlEvent:e||event});
};};function getScrollPage(){return[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];
}this.$showNoteField=function(e){e=e||event;var cy=e.clientY;var intervalHeight=this.getInterval("pixels");
var interval=this.getInterval("minutes");this.$oNoteField.style.display="block";
this.$oNoteField.style.height=(intervalHeight*2-apf.getDiff(this.$oNoteField)[1])+"px";
this.$oNoteField.style.marginTop=-1*intervalHeight+"px";var scrollPage=getScrollPage()[1];
var absPosE=apf.getAbsolutePosition(this.$ext)[1];var marginTop=parseInt(this.$oNoteField.style.marginTop);
this.$oNoteField.style.top=(cy+scrollPage-absPosE+this.$ext.scrollTop+intervalHeight/2)+"px";
intervalHeight=5*intervalHeight/interval;var unit=parseInt((cy+scrollPage-absPosE+this.$ext.scrollTop+marginTop+intervalHeight/2)/intervalHeight);
unit*=5;var hours=parseInt(unit/60);var minutes=unit%60;if(minutes<0){minutes=0;
}minutes=minutes<10?"0"+minutes:minutes;if(hours>=24){hours%=24;}this.$oNoteFieldCon.innerHTML=hours+":"+minutes;
};this.$hideNoteField=function(e){e=e||event;if(this.mode!=="edit"){this.$oNoteField.style.display="none";
}};this.$editNoteField=function(){this.mode="edit";};this.getInterval=function(unit){if(unit=="minutes"){return this.interval||this.intervals[this.range];
}else{if(unit=="pixels"){var nodes=this.$oHours.childNodes,l=nodes.length;for(var i=0;
i<l;i++){if((nodes[i].className||"").indexOf("hour")>-1){return nodes[i].offsetHeight;
}}}}};this.$isLeapYear=function(year){return((year%4==0)&&(year%100!==0))||(year%400==0)?true:false;
};this.getTimeRange=function(rangeType){switch(rangeType){case"day":case"week":return this.ranges[rangeType];
case"month":return this.months[this.date.getMonth()].number*1440+this.$isLeapYear(this.date.getFullYear())?1:0;
}};this.$addModifier=function(xmlNode,oItem,htmlParentNode,beforeNode){apf.insertHtmlNodes([oItem],this.$container);
var htmlNode=apf.xmldb.findHtmlNode(xmlNode,this);this.calendarEvents.push({xmlNode:xmlNode,htmlNode:htmlNode});
this.updateCalendarEvent(xmlNode,htmlNode);return false;};this.updateCalendarEvent=function(xmlNode,htmlNode){var date1=apf.date.getDateTime(this.$applyBindRule("date",xmlNode),this.dateFormat),date2=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate(),0,0,0),duration=parseInt(this.$applyBindRule("duration",xmlNode)),interval=this.getInterval("minutes"),intervalHeight=this.getInterval("pixels"),max=parseInt(this.getTimeRange(this.range)/interval)*intervalHeight,top=(((date1.getTime()-date2.getTime())/60000)/interval)*intervalHeight;
if(top>=0&&top<max){htmlNode.style.display="block";htmlNode.style.top=top+"px";
htmlNode.style.height=((duration/interval)*intervalHeight)-apf.getDiff(htmlNode)[1]-1+"px";
}else{htmlNode.style.display="none";}};this.updateCalendarEvents=function(){var calEvents=this.calendarEvents,calEvents_len=calEvents.length;
for(var i=0;i<calEvents_len;i++){this.updateCalendarEvent(calEvents[i].xmlNode,calEvents[i].htmlNode);
}};this.$loadAml=function(x){this.$updateHours();};this.$getHours=function(){var nodes=this.$oHours.childNodes,l=nodes.length,hours=[];
for(var i=0;i<l;i++){if((nodes[i].className||"").indexOf("hour")>-1){hours.push(nodes[i]);
}}return hours;};this.$updateHours=function(){var range=this.getTimeRange(this.range),interval=this.getInterval("minutes"),start=0,hours=0,minutes=0,day=this.date.getDate(),caption,cssClass,isMidnight,oHour,oCaption;
var nodes=[],existingNodes=this.$getHours();for(var i=0,l=parseInt(range/interval);
i<l;i++){hours=parseInt(start/60);minutes=start%60;minutes=minutes<10?"0"+minutes:minutes;
cssClass=null;isMidnight=parseInt(hours)==24&&parseInt(minutes)==0;if(isMidnight){hours=0;
minutes="00";start=0;cssClass="midnight";}caption=(i%2==0?hours+":"+minutes:"")+(isMidnight?" ("+new Date(this.date.getFullYear(),this.date.getMonth(),++day,0,0,0).format(this.dateFormat)+")":"");
if(i%2==0){cssClass=cssClass?cssClass+" odd":"odd";}if(existingNodes.length){oHour=existingNodes.shift();
oHour.style.display="block";if(cssClass){this.$setStyleClass(oHour,cssClass,[]);
}oCaption=this.$getLayoutNode("hour","caption",oHour);apf.setNodeValue(oCaption,caption);
}else{this.$getNewContext("hour");oHour=this.$getLayoutNode("hour");if(cssClass){this.$setStyleClass(oHour,cssClass,[]);
}apf.setNodeValue(this.$getLayoutNode("hour","caption"),caption);nodes.push(oHour);
}start+=interval;}if(nodes.length){apf.insertHtmlNodes(nodes,this.$oHours);}var existingNodes_len=existingNodes.length;
if(existingNodes_len){for(var i=0;i<existingNodes_len;i++){existingNodes[i].style.display="none";
}}this.$container.style.height=this.$oHours.offsetHeight+"px";this.updateCalendarEvents();
};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;}apf.destroyHtmlNode(this.oDrag);
this.oDrag=null;};}).call(apf.calendarlist.prototype=new apf.BaseList());apf.aml.setElement("calendarlist",apf.calendarlist);
apf.aml.setElement("date",apf.BindingRule);apf.aml.setElement("duration",apf.BindingRule);
apf.Chart=function(struct,tagName){this.$init(tagName||"chart",apf.NODE_VISIBLE,struct);
};apf.aml.setElement("chart",apf.Chart);(function(){this.$timer=null;this.$animTimer=null;
this.$doinit=true;this.$doresize=false;this.drawtime=10;this.anim=0;this.a=0;this.b=0;
this.c=0;this.d=0;this.$supportedProperties=["anim","a","b","c","d"];this.$redraw=function(now,resize){if(resize){this.$doresize=true;
}if(now){if(this.$timer){window.clearTimeout(this.$timer);}this.$timer=null;this.$drawChart();
}else{var _self=this;if(!this.$timer){this.$timer=window.setTimeout(function(){_self.$timer=null;
_self.$drawChart();},this.drawtime);}}};this.$drawChart=function(){if(!this.childNodes){return;
}if(!this.$ext.offsetHeight&&(apf.isIE||!this.$ext.offsetWidth)){return;}if(this.$doinit){this.$doinit=false;
this.$doresize=false;this.$copyPos();apf.draw.initRoot(this);}else{if(this.$doresize){this.$copyPos();
apf.draw.resizeRoot(this);}}for(var n,i=0;i<this.childNodes.length;i++){if((n=this.childNodes[i]).$drawAxis){n.$drawAxis(this.$doresize);
}}this.$doresize=false;};this.$copyPos=function(t,m){this.left=0,this.top=0;var w,h,rw=this.width!=(w=this.$ext.offsetWidth),rh=this.height!=(h=this.$ext.offsetHeight);
if(t){if(m){t.left=this.left+m.left,t.top=this.top+m.top;t.width=this.width-(m.left+m.right),t.height=this.height-(m.top+m.bottom);
}else{t.left=this.left,t.top=this.top;t.width=this.width,t.height=this.height;}}return rw||rh;
};this.$resize=function(){if(this.$copyPos()){this.$redraw(true,true);}};this.$draw=function(){this.$ext=this.$getExternal();
this.$getLayoutNode("main","container",this.$ext);var ox,oy,lx,ly,bt,stack=[],interact=false;
var iebt=[0,1,2,3,3],ffbt=[1,3,2,0,0];var _self=this;this.$ext.onmousedown=function(e){if(this.$doinit){return;
}if(!e){e=event;}if(e.button>4||e.button<0){return;}bt=(_self.canvas)?ffbt[e.button]:iebt[e.button];
if(!bt){return;}var keys=e.shiftKey?1:0+e.ctrlKey?2:0+e.altKey?4:0;var pos=apf.getAbsolutePosition(_self.$ext,document.documentElement);
lx=e.clientX-pos[0]+document.documentElement.scrollLeft,ly=e.clientY-pos[1]+document.documentElement.scrollTop;
ox=lx,oy=ly;for(var t,i=_self.childNodes.length-1;i>=0;i--){t=_self.childNodes[i];
if(ox>=t.left&&ox<=t.left+t.width&&oy>=t.top&&oy<=t.top+t.height){if(t.$mouseDown){t.$mouseDown(ox-t.left,oy-t.top,bt,keys);
stack.push(t);}}}hasMoved=false;};this.$ext.oncontextmenu=function(){return false;
};this.$ext.onselectstart=function(){return false;};var hasMoved;this.addEventListener("contextmenu",function(e){if(hasMoved){e.cancelBubble=true;
}});this.$ext.onmouseup=function(e){if(this.$doinit){return;}if(!e){e=event;}bt=0;
var pos=apf.getAbsolutePosition(_self.$ext,document.documentElement);var x=e.clientX-pos[0]+document.documentElement.scrollLeft,y=e.clientY-pos[1]+document.documentElement.scrollTop;
for(var t,i=stack.length-1;i>=0;i--){(t=stack[i]).$mouseUp(x-t.left,y-t.top);}stack.length=0;
};this.$ext.onmousemove=function(e){if(this.$doinit){return;}if(!e){e=event;}var pos=apf.getAbsolutePosition(_self.$ext,document.documentElement);
var dx=(-lx+(lx=e.clientX-pos[0]+document.documentElement.scrollLeft)),dy=(-ly+(ly=e.clientY-pos[1]+document.documentElement.scrollTop));
var keys=e.shiftKey?1:0+e.ctrlKey?2:0+e.altKey?4:0;if(bt){if(bt==2){hasMoved=true;
}for(var t,i=stack.length-1;i>=0;i--){(t=stack[i]).$mouseMove(dx,dy,bt,ox-t.left,oy-t.top,lx-t.left,ly-t.top,keys);
}}else{for(var t,i=_self.childNodes.length-1;i>=0;i--){if((t=_self.childNodes[i]).$mouseMove){t.$mouseMove(dx,dy,bt,ox-t.left,oy-t.top,lx-t.left,ly-t.top,keys);
}}}};var wheelEvent=function(e){if(this.$doinit){return;}if(!e){e=window.event;
}var d=e.wheelDelta?(window.opera?-1:1)*e.wheelDelta/120:(e.detail?-e.detail/3:0);
var keys=e.shiftKey?1:0+e.ctrlKey?2:0+e.altKey?4:0;if(d){var pos=apf.getAbsolutePosition(_self.$ext,document.documentElement);
var x=e.clientX-pos[0]+document.documentElement.scrollLeft,y=e.clientY-pos[1]+document.documentElement.scrollTop;
for(var t,i=0;i<_self.childNodes.length;i++){t=_self.childNodes[i];if(x>=t.left&&x<=t.left+t.width&&y>=t.top&&y<=t.top+t.height){t.$mouseWheel(x-t.left,y-t.top,d,keys);
}}}if(e.preventDefault){e.preventDefault();}e.returnValue=false;};if(!apf.supportVML&&this.$ext.addEventListener){this.$ext.addEventListener("DOMMouseScroll",wheelEvent,false);
}this.$ext.onmousewheel=wheelEvent;apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.$resize()",true);
apf.layout.queue(this.$ext);};this.$loadAml=function(x){apf.draw.initDriver();if(this.anim>0){var _self=this;
this.$animTimer=window.setInterval(function(){_self.$redraw();},this.anim);}};this.$destroy=function(){apf.layout.removeRule(this.$ext,"resize");
this.$ext.onmousedown=this.$ext.oncontextmenu=this.$ext.onselectstart=this.$ext.onmouseup=this.$ext.onmousemove=this.$ext.onmousewheel=null;
window.clearTimeout(this.$timer);window.clearInterval(this.$animTimer);};}).call(apf.Chart.prototype=new apf.Presentation());
apf.checkbox=function(struct,tagName){this.$init(tagName||"checkbox",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=apf.KEYBOARD;this.checked=false;
this.$booleanProperties.checked=true;this.$supportedProperties.push("value","checked","label","values");
this.$propHandlers.value=function(value){value=(typeof value=="string"?value.trim():value);
if(this.$values){this.checked=(typeof value!="undefined"&&value!==null&&value.toString()==this.$values[0].toString());
}else{this.checked=apf.isTrue(value);}if(this.checked){apf.setStyleClass(this.$ext,this.$baseCSSname+"Checked");
}else{apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);}};this.$propHandlers.checked=function(value){if(!this.$values){if(this.getAttribute("values")){this.$propHandler.values.call(this,this.getAttribute("values"));
}}this.setProperty("value",this.$values?this.$values[value?0:1]:true);};this.$propHandlers.label=function(value){if(!this.$ext){return;
}var lbl=this.$getLayoutNode("main","label",this.$ext);if(!lbl){return;}if(lbl.nodeType==1){lbl.innerHTML=value;
}else{lbl.nodeValue=value;}};this.$propHandlers.values=function(value){this.$values=typeof value=="string"?value.split("|"):(value||[1,0]);
this.$propHandlers.value.call(this,this.value);};this.setValue=function(value){if(!this.$values){return;
}this.setProperty("value",value,false,true);};this.getValue=function(){return this.xmlRoot?(this.$values?this.$values[this.checked?0:1]:this.checked):this.value;
};this.check=function(){this.setProperty("value",this.$values?this.$values[0]:true,false,true);
};this.uncheck=function(){this.setProperty("value",this.$values?this.$values[1]:false,false,true);
};this.addEventListener("$clear",function(){this.setProperty("value",this.$values?this.$values[1]:false);
});this.$enable=function(){if(this.$input){this.$input.disabled=false;}this.$doBgSwitch(1);
};this.$disable=function(){if(this.$input){this.$input.disabled=true;}this.$doBgSwitch(4);
};this.$setState=function(state,e,strEvent){this.$doBgSwitch(this.states[state]);
this.$setStyleClass(this.$ext,(state!="Out"?this.$baseCSSname+state:""),[this.$baseCSSname+"Down",this.$baseCSSname+"Over"]);
this.state=state;if(strEvent){this.dispatchEvent(strEvent,{htmlEvent:e});}};this.$clickHandler=function(){this.change(this.$values?this.$values[(!this.checked)?0:1]:!this.checked);
if(this.validate){this.validate(true);}return true;};this.$draw=function(){this.$ext=this.$getExternal();
this.$input=this.$getLayoutNode("main","input",this.$ext);this.$notfromext=this.$input&&this.$input!=this.$ext;
this.$setupEvents();};this.$childProperty="label";this.addEventListener("$skinchange",function(){if(this.label){this.$propHandlers.label.call(this,this.label);
}});}).call(apf.checkbox.prototype=new apf.BaseButton());apf.aml.setElement("checkbox",apf.checkbox);
if(!apf.hasRequireJS){apf.aml.setElement("codeeditor",apf.textbox);}else{define(function(require,exports,module){require("pilot/fixoldbrowsers");
var Editor=require("ace/editor").Editor;var EditSession=require("ace/edit_session").EditSession;
var VirtualRenderer=require("ace/virtual_renderer").VirtualRenderer;var UndoManager=require("ace/undomanager").UndoManager;
var Range=require("ace/range").Range;apf.codeeditor=function(struct,tagName){this.$init(tagName||"codeeditor",apf.NODE_VISIBLE,struct);
this.documents=[];this.$cache={};this.setProperty("line",1);this.setProperty("col",1);
};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$childProperty="value";
this.$isTextInput=true;this.value="";this.multiline=true;this.caching=true;this.$booleanProperties.activeline=true;
this.$booleanProperties.caching=true;this.$booleanProperties.readonly=true;this.$booleanProperties.activeline=true;
this.$booleanProperties.showinvisibles=true;this.$booleanProperties.showprintmargin=true;
this.$booleanProperties.overwrite=true;this.$booleanProperties.softtabs=true;this.$booleanProperties.gutter=true;
this.$booleanProperties.highlightselectedword=true;this.$booleanProperties.autohidehorscrollbar=true;
this.$supportedProperties.push("value","syntax","activeline","selectstyle","caching","readonly","showinvisibles","showprintmargin","printmargincolumn","overwrite","tabsize","softtabs","debugger","model-breakpoints","scrollspeed","theme","gutter","highlightselectedword","autohidehorscrollbar");
var cacheId=0;this.$getCacheKey=function(value){if(typeof value=="string"){var key=this.xmlRoot?this.xmlRoot.getAttribute(apf.xmldb.xmlIdTag):value;
}else{if(value.nodeType){key=value.getAttribute(apf.xmldb.xmlIdTag);}}return key;
};this.clearCacheItem=function(xmlNode){if(!this.caching){return;}var key=this.$getCacheKey(xmlNode);
if(key){delete this.$cache[key];}};this.addEventListener("unloadmodel",function(e){this.syncValue();
});this.$propHandlers.value=function(value){var doc,key,_self=this;if(this.caching){key=this.$getCacheKey(value);
}if(value instanceof EditSession){doc=value;}if(!doc&&key){doc=this.$cache[key];
}if(!doc){if(value.nodeType){apf.xmldb.addNodeListener(value.nodeType==1?value:value.parentNode,this);
}doc=new EditSession(typeof value=="string"?value:(value.nodeType>1&&value.nodeType<5?value.nodeValue:value.firstChild&&value.firstChild.nodeValue||""));
doc.cacheId=key;doc.setUndoManager(new UndoManager());if(key){this.$cache[key]=doc;
}}else{if(typeof value=="string"&&!doc.hasValue){doc.setValue(value);this.$editor.moveCursorTo(0,0);
doc.hasValue=true;}}_self.$getMode(_self.syntax,function(mode){doc.setMode(mode);
});doc.setTabSize(parseInt(_self.tabsize));doc.setUseSoftTabs(_self.softtabs);_self.$removeDocListeners&&_self.$removeDocListeners();
_self.$removeDocListeners=_self.$addDocListeners(doc);_self.$editor.setSession(doc);
_self.$updateMarker();_self.$updateBreakpoints(doc);};this.$addDocListeners=function(doc){var _self=this;
var onCursorChange=function(){var cursor=doc.getSelection().getCursor();_self.setProperty("line",cursor.row+1);
_self.setProperty("col",cursor.column+1);};doc.getSelection().addEventListener("changeCursor",onCursorChange);
onCursorChange();return function(){doc.getSelection().removeEventListener("changeCursor",onCursorChange);
};};this.$updateMarker=function(removeOnly){if(this.$marker){this.$editor.renderer.removeGutterDecoration(this.$lastRow[0],this.$lastRow[1]);
this.$editor.getSession().removeMarker(this.$marker);this.$marker=null;if(removeOnly){return;
}}if(!this.$debugger){return;}var frame=this.$debugger.activeframe;if(!frame){return;
}var script=this.xmlRoot;if(script.getAttribute("scriptid")!==frame.getAttribute("scriptid")){return;
}var head=this.$debugger.$mdlStack.queryNode("frame[1]");var isTop=frame==head;
var lineOffset=parseInt(script.getAttribute("lineoffset")||"0");var row=parseInt(frame.getAttribute("line"))-lineOffset;
var range=new Range(row,0,row+1,0);this.$marker=this.$editor.getSession().addMarker(range,isTop?"ace_step":"ace_stack","line");
var type=isTop?"arrow":"stack";this.$lastRow=[row,type];this.$editor.renderer.addGutterDecoration(row,type);
this.$editor.gotoLine(row+1,parseInt(frame.getAttribute("column")));};this.$updateBreakpoints=function(doc){doc=doc||this.$editor.getSession();
doc.setBreakpoints([]);if(!this.$breakpoints){return;}if(this.xmlRoot){var scriptName=this.xmlRoot.getAttribute("scriptname");
if(!scriptName){return;}var breakpoints=this.$breakpoints.queryNodes("//breakpoint[@script='"+scriptName+"']");
var rows=[];for(var i=0;i<breakpoints.length;i++){rows.push(parseInt(breakpoints[i].getAttribute("line"))-parseInt(breakpoints[i].getAttribute("lineoffset")));
}if(rows.length){doc.setBreakpoints(rows);}}};this.$toggleBreakpoint=function(row){this.$debugger.toggleBreakpoint(this.xmlRoot,row);
};this.$propHandlers.theme=function(value){this.$editor.setTheme(value);};this.$propHandlers.syntax=function(value){var _self=this;
this.$getMode(value,function(mode){_self.$editor.getSession().setMode(mode);});
};this.$modes={};this.$getMode=function(syntax,callback){syntax=(syntax||"text").toLowerCase();
if(syntax.indexOf("/")==-1){syntax="ace/mode/"+syntax;}if(this.$modes[syntax]){return callback(this.$modes[syntax]);
}var _self=this;require([syntax],function(modeModule){if(typeof modeModule.Mode!="function"){return apf.console.error("Unkown syntax type: '"+syntax+"'");
}_self.$modes[syntax]=new modeModule.Mode();callback(_self.$modes[syntax]);});};
this.$propHandlers.activeline=function(value){this.$editor.setHighlightActiveLine(value);
};this.$propHandlers.selectstyle=function(value){this.$editor.setSelectionStyle(value);
};this.$propHandlers.showprintmargin=function(value,prop,initial){this.$editor.setShowPrintMargin(value);
};this.$propHandlers.printmargincolumn=function(value,prop,initial){this.$editor.setPrintMarginColumn(value);
};this.$propHandlers.showinvisibles=function(value,prop,initial){this.$editor.setShowInvisibles(value);
};this.$propHandlers.overwrite=function(value,prop,initial){this.$editor.setOverwrite(value);
};this.$propHandlers.readonly=function(value,prop,initial){this.$editor.setReadOnly(value);
};this.$propHandlers.tabsize=function(value,prop,initial){this.$editor.getSession().setTabSize(parseInt(value));
};this.$propHandlers.softtabs=function(value,prop,initial){this.$editor.getSession().setUseSoftTabs(value);
};this.$propHandlers.scrollspeed=function(value,prop,initial){this.$editor.setScrollSpeed(value||2);
};this.$propHandlers.gutter=function(value,prop,initial){this.$editor.renderer.setShowGutter(value);
};this.$propHandlers.fontsize=function(value,prop,initial){this.$ext.style.fontSize=value+"px";
};this.$propHandlers.wrapmode=function(value,prop,initial){this.$editor.getSession().setUseWrapMode(value);
};this.$propHandlers.wraplimitmin=function(value,prop,initial){this.$editor.getSession().setWrapLimitRange(value,this.wraplimitmax);
if(value){this.setProperty("wrapmode",true);}};this.$propHandlers.wraplimitmax=function(value,prop,initial){this.$editor.getSession().setWrapLimitRange(this.wraplimitmin,value);
if(value){this.setProperty("wrapmode",true);}};this.$propHandlers.highlightselectedword=function(value,prop,initial){this.$editor.setHighlightSelectedWord(value);
};this.$propHandlers.autohidehorscrollbar=function(value,prop,initial){this.$editor.renderer.setHScrollBarAlwaysVisible(!value);
};this.$propHandlers["model-breakpoints"]=function(value,prop,inital){this.$debuggerBreakpoints=false;
if(this.$breakpoints){this.$breakpoints.removeEventListener("update",this.$onBreakpoint);
}this.$breakpoints=value;if(!this.$breakpoints){this.$updateBreakpoints();return;
}var _self=this;_self.$updateBreakpoints();this.$onBreakpoint=function(){_self.$updateBreakpoints();
};this.$breakpoints.addEventListener("update",this.$onBreakpoint);this.$updateBreakpoints();
};this.$propHandlers["debugger"]=function(value,prop,inital){if(this.$debugger){this.$debugger.removeEventListener("changeframe",this.$onChangeActiveFrame);
this.$debugger.removeEventListener("break",this.$onChangeActiveFrame);this.$debugger.removeEventListener("beforecontinue",this.$onBeforeContinue);
}if(typeof value==="string"){this.$debugger=apf.nameserver.get("debugger",value);
}else{this.$debugger=value;}if(!this.$breakpoints||this.$debuggerBreakpoints){this.setProperty("model-breakpoints",this.$debugger?this.$debugger.$mdlBreakpoints:null);
this.$debuggerBreakpoints=true;}if(!this.$debugger){this.$updateMarker();return;
}this.$updateMarker();var _self=this;this.$onChangeActiveFrame=function(e){_self.$updateMarker();
};this.$onBeforeContinue=function(){_self.$updateMarker(true);};this.$debugger.addEventListener("changeframe",this.$onChangeActiveFrame);
this.$debugger.addEventListener("break",this.$onChangeActiveFrame);this.$debugger.addEventListener("beforecontinue",this.$onBeforeContinue);
};var propModelHandler=this.$propHandlers.model;this.$propHandlers.model=function(value){propModelHandler.call(this,value);
this.$updateMarker();this.$updateBreakpoints();};this.addEventListener("xmlupdate",function(e){var id=e.xmlNode.getAttribute(apf.xmldb.xmlIdTag);
if(this.$cache[id]){}});this.setValue=function(value){return this.setProperty("value",value,false,true);
};this.clear=function(){this.$propHandlers.value.call(this,"",null,true);this.dispatchEvent("clear");
};this.getValue=function(){return this.$editor.getSession().getValue();};this.getDocument=this.getSession=function(){return this.$editor.getSession();
};this.getSelection=function(){return this.$editor.getSession().getSelection();
};this.getLastSearchOptions=function(){return this.$editor.getLastSearchOptions();
};this.select=function(){};this.deselect=function(){this.$editor.clearSelection();
};this.scrollTo=function(){};this.getDefaults=function(){return this.$defaults;
};this.$focus=function(e){if(!this.$ext||this.$ext.disabled){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");
this.$editor.focus();};this.syncValue=function(){var doc=this.$editor.getSession();
if(!doc.cacheId||doc.cacheId==this.$getCacheKey(this.value)){var value=this.getValue();
if(this.value!=value){this.setProperty("value",value);}}};this.$blur=function(e){if(!this.$ext){return;
}this.syncValue();this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
this.$editor.blur();};this.addEventListener("keydown",function(e){},true);this.$isTextInput=function(e){return true;
};this.$draw=function(){this.$ext=this.$getExternal();this.$input=this.$getLayoutNode("main","content",this.$ext);
this.addEventListener("resize",function(e){this.$editor.resize();});this.$editor=new Editor(new VirtualRenderer(this.$input));
var ed=this.$editor;var _self=this;ed.addEventListener("changeOverwrite",function(e){_self.setProperty("overwrite",e.data);
});ed.addEventListener("gutterclick",function(e){_self.dispatchEvent("gutterclick",e);
if(_self.$debugger){_self.$toggleBreakpoint(e.row);}});ed.addEventListener("gutterdblclick",function(e){_self.dispatchEvent("gutterdblclick",e);
});apf.sanitizeTextbox(ed.renderer.container.getElementsByTagName("textarea")[0]);
};this.$loadAml=function(){var ed=this.$editor,doc=ed.getSession();if(this.syntax==undefined){this.syntax="Text";
}if(this.tabsize==undefined){this.tabsize=doc.getTabSize();}if(this.softtabs==undefined){this.softtabs=doc.getUseSoftTabs();
}if(this.scrollspeed==undefined){this.scrollspeed=ed.getScrollSpeed();}if(this.selectstyle==undefined){this.selectstyle=ed.getSelectionStyle();
}if(this.activeline==undefined){this.activeline=ed.getHighlightActiveLine();}if(this.readonly==undefined){this.readonly=ed.getReadOnly();
}if(this.showinvisibles==undefined){this.showinvisibles=ed.getShowInvisibles();
}if(this.showprintmargin==undefined){this.showprintmargin=ed.getShowPrintMargin();
}if(this.printmargincolumn==undefined){this.printmargincolumn=ed.getPrintMarginColumn();
}if(this.overwrite==undefined){this.overwrite=ed.getOverwrite();}if(this.fontsize==undefined){this.fontsize=12;
}var wraplimit=doc.getWrapLimitRange();if(this.wraplimitmin==undefined){this.wraplimitmin=wraplimit.min;
}if(this.wraplimitmax==undefined){this.wraplimitmax=wraplimit.max;}if(this.wrapmode==undefined){this.wrapmode=doc.getUseWrapMode();
}if(this.gutter==undefined){this.gutter=ed.renderer.getShowGutter();}if(this.highlightselectedword==undefined){this.highlightselectedword=ed.getHighlightSelectedWord();
}if(this.autohidehorscrollbar){this.autohidehorscrollbar=!ed.renderer.getHScrollBarAlwaysVisible();
}};}).call(apf.codeeditor.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;
apf.aml.setElement("codeeditor",apf.codeeditor);});}apf.collection=function(struct,tagName){this.$init(tagName||"collection",apf.NODE_HIDDEN,struct);
};apf.docklet=function(struct,tagName){this.$init(tagName||"docklet",apf.NODE_HIDDEN,struct);
};(function(){this.$focussable=false;this.$propHandlers.visible=function(value){alert(value);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode&&this.parentNode.$int!=this.$pHtmlNode){this.$pHtmlNode=this.parentNode.$int;
}this.$int=this.$pHtmlNode;this.$originalNodes=this.parentNode.$originalNodes;this.skinName=this.parentNode.skinName;
});}).call(apf.collection.prototype=new apf.AmlElement());apf.docklet.prototype=apf.collection.prototype;
apf.aml.setElement("collection",apf.collection);apf.aml.setElement("docklet",apf.docklet);
apf.colorpicker=function(struct,tagName){this.$init(tagName||"colorpicker",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.StandardBinding,apf.DataAction);this.$focussable=true;
this.setValue=function(value,type){if(!type){type="RGBHEX";}var a;switch(type){case"HSL":this.fill(value[0],value[1],value[2]);
break;case"RGB":a=RGBtoHLS(value[0],value[1],value[2]);this.fill(a[0],a[1],a[2]);
break;case"RGBHEX":var RGB=arguments[0].match(/(..)(..)(..)/);a=RGBtoHLS(Math.hexToDec(RGB[0]),Math.hexToDec(RGB[1]),Math.hexToDec(RGB[2]));
this.fill(a[0],a[1],a[2]);break;}};this.getValue=function(type){return HSLRangeToRGB(cH,cS,cL);
};var cL=120,cS=239,cH=0,cHex="#FF0000",HSLRange=240;function HSLRangeToRGB(H,S,L){return HSLtoRGB(H/(HSLRange-1),S/HSLRange,Math.min(L/HSLRange,1));
}function RGBtoHLS(R,G,B){var RGBMAX=255,HLSMAX=HSLRange,UNDEF=(HLSMAX*2/3),cMax=Math.max(Math.max(R,G),B),cMin=Math.min(Math.min(R,G),B);
L=(((cMax+cMin)*HLSMAX)+RGBMAX)/(2*RGBMAX);if(cMax==cMin){S=0;H=UNDEF;}else{if(L<=(HLSMAX/2)){S=(((cMax-cMin)*HLSMAX)+((cMax+cMin)/2))/(cMax+cMin);
}else{S=(((cMax-cMin)*HLSMAX)+((2*RGBMAX-cMax-cMin)/2))/(2*RGBMAX-cMax-cMin);}Rdelta=(((cMax-R)*(HLSMAX/6))+((cMax-cMin)/2))/(cMax-cMin);
Gdelta=(((cMax-G)*(HLSMAX/6))+((cMax-cMin)/2))/(cMax-cMin);Bdelta=(((cMax-B)*(HLSMAX/6))+((cMax-cMin)/2))/(cMax-cMin);
if(R==cMax){H=Bdelta-Gdelta;}else{if(G==cMax){H=(HLSMAX/3)+Rdelta-Bdelta;}else{H=((2*HLSMAX)/3)+Gdelta-Rdelta;
}}if(H<0){H+=HLSMAX;}if(H>HLSMAX){H-=HLSMAX;}}return[H,S,L];}function hueToColorValue(hue){var V;
if(hue<0){hue=hue+1;}else{if(hue>1){hue=hue-1;}}if(6*hue<1){V=M1+(M2-M1)*hue*6;
}else{if(2*hue<1){V=M2;}else{if(3*hue<2){V=M1+(M2-M1)*(2/3-hue)*6;}else{V=M1;}}}return Math.max(Math.floor(255*V),0);
}function HSLtoRGB(H,S,L){var R,G,B;if(S==0){G=B=R=Math.round(255*L);}else{M2=(L<=0.5)?(L*(1+S)):(L+S-L*S);
M1=2*L-M2;R=hueToColorValue(H+1/3);G=hueToColorValue(H);B=hueToColorValue(H-1/3);
}return Math.decToHex(R)+""+Math.decToHex(G)+""+Math.decToHex(B);}this.fill=function(H,S,L){var Hex=HSLRangeToRGB(H,S,L);
this.value=Hex;var RGB=Hex.match(/(..)(..)(..)/);this.tbRed.value=Math.hexToDec(RGB[1]);
this.tbGreen.value=Math.hexToDec(RGB[2]);this.tbBlue.value=Math.hexToDec(RGB[3]);
this.tbHue.value=Math.round(H);this.tbSatern.value=Math.round(S);this.tbLuminance.value=Math.round(L);
this.tbHexColor.value=Hex;this.shower.style.backgroundColor=Hex;var HSL120=HSLRangeToRGB(H,S,120);
this.bar1.style.backgroundColor=HSL120;this.bgBar1.style.backgroundColor=HSLRangeToRGB(H,S,240);
this.bar2.style.backgroundColor=HSLRangeToRGB(H,S,0);this.bgBar2.style.backgroundColor=HSL120;
};this.movePointer=function(e){e=e||event;var ty=this.pHolder.ty;if((e.clientY-ty>=0)&&(e.clientY-ty<=this.pHolder.offsetHeight-this.pointer.offsetHeight+22)){this.pointer.style.top=e.clientY-ty;
}if(e.clientY-ty<21){this.pointer.style.top=21;}if(e.clientY-ty>this.pHolder.offsetHeight-this.pointer.offsetHeight+19){this.pointer.style.top=this.pHolder.offsetHeight-this.pointer.offsetHeight+19;
}cL=(255-(this.pointer.offsetTop-22))/2.56*2.4;this.fill(cH,cS,cL);e.returnValue=false;
e.cancelBubble=true;};this.setLogic=function(){var _self=this;this.pHolder.style.zIndex=10;
this.pHolder.onmousedown=function(){this.ty=apf.getAbsolutePosition(this)[1]-20;
_self.movePointer();document.onmousemove=_self.movePointer;document.onmouseup=function(){this.onmousemove=function(){};
};};this.container.onmousedown=function(e){e=e||event;this.active=true;if(e.srcElement==this){if(e.offsetX>=0&&e.offsetX<=256&&e.offsetY>=0&&e.offsetY<=256){cS=(256-e.offsetY)/2.56*2.4;
cH=e.offsetX/2.56*2.39;}_self.fill(cH,cS,cL);_self.shower.style.backgroundColor=_self.currentColor;
}_self.point.style.display="none";e.cancelBubble=true;};this.container.onmouseup=function(e){e=e||event;
this.active=false;_self.point.style.top=e.offsetY-_self.point.offsetHeight-2;_self.point.style.left=e.offsetX-_self.point.offsetWidth-2;
_self.point.style.display="block";_self.change(_self.tbHexColor.value);};this.container.onmousemove=function(e){e=e||event;
if(this.active){if(e.offsetX>=0&&e.offsetX<=256&&e.offsetY>=0&&e.offsetY<=256){cS=(256-e.offsetY)/2.56*2.4;
cH=e.offsetX/2.56*2.39;}_self.fill(cH,cS,cL);_self.shower.style.backgroundColor=_self.currentColor;
}};};this.$mainBind="color";this.$draw=function(parentNode,clear){this.$ext=this.$getExternal();
this.tbRed=this.$getLayoutNode("main","red",this.$ext);this.tbGreen=this.$getLayoutNode("main","green",this.$ext);
this.tbBlue=this.$getLayoutNode("main","blue",this.$ext);this.tbHue=this.$getLayoutNode("main","hue",this.$ext);
this.tbSatern=this.$getLayoutNode("main","satern",this.$ext);this.tbLuminance=this.$getLayoutNode("main","luminance",this.$ext);
this.tbHexColor=this.$getLayoutNode("main","hex",this.$ext);var _self=this;this.tbHexColor.onchange=function(){_self.setValue(this.value,"RGBHEX");
};this.shower=this.$getLayoutNode("main","shower",this.$ext);this.bar1=this.$getLayoutNode("main","bar1",this.$ext);
this.bgBar1=this.$getLayoutNode("main","bgbar1",this.$ext);this.bar2=this.$getLayoutNode("main","bar2",this.$ext);
this.bgBar2=this.$getLayoutNode("main","bgbar2",this.$ext);this.pHolder=this.$getLayoutNode("main","pholder",this.$ext);
this.pointer=this.$getLayoutNode("main","pointer",this.$ext);this.container=this.$getLayoutNode("main","container",this.$ext);
this.point=this.$getLayoutNode("main","point",this.$ext);var nodes=this.$ext.getElementsByTagName("input");
for(var i=0;i<nodes.length;i++){nodes[i].onselectstart=function(e){e=e||event;e.cancelBubble=true;
};}this.setLogic();this.setValue("ffffff");};this.$loadAml=function(x){if(x.getAttribute("color")){this.setValue(x.getAttribute("color"));
}};this.$destroy=function(){this.container.host=this.tbRed.host=this.tbGreen.host=this.tbBlue.host=this.tbHexColor.host=this.pHolder.host=null;
};}).call(apf.colorpicker.prototype=new apf.GuiElement());apf.aml.setElement("colorpicker",apf.colorpicker);
apf.colorpicker=function(struct,tagName){this.$init(tagName||"colorpicker",apf.NODE_VISIBLE,struct);
};(function(){this.value="ff0000";this.changeTimer=null;var c=apf.color;this.$supportedProperties.push("color","red","green","blue","hue","saturation","brightness","hex");
this.$propHandlers.red=this.$propHandlers.green=this.$propHandlers.blue=this.$propHandlers.hue=this.$propHandlers.saturation=this.$propHandlers.brightness=this.$propHandlers.hex=function(val,doChange){clearTimeout(this.changeTimer);
if(doChange){var _self=this;this.changeTimer=$setTimeout(function(){_self.$change();
});}};this.$propHandlers.value=function(val){this.$restoreOriginal();};this.$restoreOriginal=function(){this.$change(c.hexToHSB(this.value));
this.oCustomColor.style.backgroundColor=(this.value.substr(0,1)!="#"?"#":"")+this.value;
};this.$change=function(hsb){if(!hsb){hsb={h:this.hue,s:this.saturation,b:this.brightness};
}hsb=c.fixHSB(hsb);var hex=c.HSBToHex(hsb),rgb=c.HSBToRGB(hsb);this.oNewColor.style.backgroundColor="#"+hex;
this.setProperty("red",rgb.r);this.setProperty("green",rgb.g);this.setProperty("blue",rgb.b);
this.setProperty("saturation",hsb.s);this.setProperty("brightness",hsb.b);this.setProperty("hue",hsb.h);
this.setProperty("hex",hex);this.oSelector.style.background="#"+c.HSBToHex({h:hsb.h,s:100,b:100});
this.oHue.style.top=parseInt(150-150*hsb.h/360,10)+"px";this.oSelectorInd.style.left=parseInt(150*hsb.s/100,10)+"px";
this.oSelectorInd.style.top=parseInt(150*(100-hsb.b)/100,10)+"px";};this.$draw=function(){if(!this.id){this.setProperty("id","colorpicker"+this.$uniqueId);
}this.$ext=this.$getExternal();this.oSelector=this.$getLayoutNode("main","selector",this.$ext);
this.oSelectorInd=this.$getLayoutNode("main","selector_indic",this.$ext);this.oHue=this.$getLayoutNode("main","hue",this.$ext);
this.oNewColor=this.$getLayoutNode("main","newcolor",this.$ext);this.oCustomColor=this.$getLayoutNode("main","customcolor",this.$ext);
this.oInputs=this.$getLayoutNode("main","inputs",this.$ext);this.$restoreOriginal();
var _self=this,doc=(!document.compatMode||document.compatMode=="CSS1Compat")?document.html:document.body;
function stopMoving(){document.onmousemove=document.onmouseup=null;_self.$change();
return false;}function selectorDown(){var el=this,pos=apf.getAbsolutePosition(el);
function selectorMove(e){e=e||event;var pageX=e.pageX||e.clientX+(doc?doc.scrollLeft:0),pageY=e.pageY||e.clientY+(doc?doc.scrollTop:0);
_self.brightness=parseInt(100*(150-Math.max(0,Math.min(150,(pageY-pos[1]))))/150,10);
_self.saturation=parseInt(100*(Math.max(0,Math.min(150,(pageX-pos[0]))))/150,10);
_self.$change();pos=apf.getAbsolutePosition(el);return false;}document.onmousemove=selectorMove;
document.onmouseup=function(e){selectorMove(e);return stopMoving(e);};}function hueDown(e){var el=this,pos=apf.getAbsolutePosition(el);
function hueMove(e){e=e||event;var pageY=e.pageY||e.clientY+(doc?doc.scrollTop:0);
_self.hue=parseInt(360*(150-Math.max(0,Math.min(150,(pageY-pos[1]))))/150,10);_self.$change();
pos=apf.getAbsolutePosition(el);}document.onmousemove=hueMove;document.onmouseup=function(e){hueMove(e);
return stopMoving(e);};}this.oSelector.onmousedown=selectorDown;this.oHue.parentNode.onmousedown=hueDown;
this.oCustomColor.onmousedown=function(){_self.$restoreOriginal();};function spinnerChange(e){var o=e.currentTarget,isRGB=false;
if(o.id.indexOf("hue")>-1){_self.hue=e.value;}else{if(o.id.indexOf("saturation")>-1){_self.saturation=e.value;
}else{if(o.id.indexOf("brightness")>-1){_self.brightness=e.value;}else{if(o.id.indexOf("red")>-1){_self.red=e.value,isRGB=true;
}else{if(o.id.indexOf("green")>-1){_self.green=e.value,isRGB=true;}else{if(o.id.indexOf("blue")>-1){_self.blue=e.value,isRGB=true;
}}}}}}if(isRGB){var hsb=c.RGBToHSB({r:_self.red,g:_self.green,b:_self.blue});_self.hue=hsb.h;
_self.saturation=hsb.s;_self.brightness=hsb.b;}_self.$change();}var skin=apf.getInheritedAttribute(this.parentNode,"skinset");
new apf.table({htmlNode:this.oInputs,skinset:skin,left:206,top:52,width:150,columns:"50%,50%",cellheight:26,childNodes:[new apf.spinner({id:this.id+"_hue",width:62,min:0,max:360,value:"{"+this.id+".hue}",onafterchange:spinnerChange}),new apf.spinner({id:this.id+"_red",width:62,min:0,max:255,value:"{"+this.id+".red}",onafterchange:spinnerChange}),new apf.spinner({id:this.id+"_saturation",width:62,min:0,max:100,value:"{"+this.id+".saturation}",onafterchange:spinnerChange}),new apf.spinner({id:this.id+"_green",width:62,min:0,max:255,value:"{"+this.id+".green}",onafterchange:spinnerChange}),new apf.spinner({id:this.id+"_brightness",width:62,min:0,max:100,value:"{"+this.id+".brightness}",onafterchange:spinnerChange}),new apf.spinner({id:this.id+"_blue",width:62,min:0,max:255,value:"{"+this.id+".blue}",onafterchange:spinnerChange})]});
new apf.label({htmlNode:this.oInputs,skinset:skin,left:212,top:142,width:7,value:"#","for":this.id+"_hex"});
new apf.textbox({htmlNode:this.oInputs,skinset:skin,left:222,top:140,width:75,value:"{"+this.id+".hex}",onafterchange:function(e){_self.hex=c.fixHex(e.value);
var hsb=c.hexToHSB(_self.hex);_self.hue=hsb.h;_self.saturation=hsb.s;_self.brightness=hsb.b;
_self.$change();}});};this.$destroy=function(){this.$ext=this.oSelector=this.oSelectorInd=this.oHue=this.oNewColor=this.oCustomColor=this.oInputs=null;
};}).call(apf.colorpicker.prototype=new apf.StandardBinding());apf.aml.setElement("colorpicker",apf.colorpicker);
apf.comment=function(){this.$init("comment",apf.NODE_HIDDEN);};apf.comment.prototype=new apf.AmlComment();
apf.aml.setElement("comment",apf.comment);apf.contextmenu=function(){this.$init("contextmenu",apf.NODE_HIDDEN);
};(function(){this.$amlNodes=[];this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);
this.register=function(amlParent){if(!amlParent.contextmenus){amlParent.contextmenus=[];
}amlParent.contextmenus.push(this);};this.unregister=function(amlParent){amlParent.contextmenus.remove(this);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.register(this.parentNode);
});}).call(apf.contextmenu.prototype=new apf.AmlElement());apf.aml.setElement("contextmenu",apf.contextmenu);
apf.datagrid=function(struct,tagName){this.$init(tagName||"datagrid",apf.NODE_VISIBLE,struct);
this.$headings=[],this.$cssRules=[];this.$lastOpened={};this.$editors={};this.$dynCssClasses=[];
};(function(){var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4,treeState=this.$treeState;
this.implement(apf.DataAction);this.bufferselect=false;this.$useTable=false;this.$focussable=true;
this.$isWindowContainer=-1;this.$widthdiff=0;this.$defaultwidth=0;this.$useiframe=0;
this.$needsDepth=true;this.canrename=false;this.$booleanProperties.iframe=true;
this.$mode=0;this.$propHandlers.mode=function(value){if("check|radio".indexOf(value)>-1){if(!this.hasFeature(apf.__MULTICHECK__)){this.implement(apf.MultiCheck);
}this.addEventListener("afterrename",$afterRenameMode);this.multicheck=value=="check";
this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",$afterRenameMode);
this.$mode=0;}};function $afterRenameMode(){}this.$propHandlers.options=function(value){for(var i=0,l=this.$headings.length;
i<l;i++){this.$headings[i].setAttribute("options",value);}};function scrollIntoView(){var Q=(this.current||this.$selected),o=this.$container;
o.scrollTop=(Q.offsetTop)-21;}this.$getCaptionElement=function(){if(!this.$selected){return false;
}var nodes=this.$head.childNodes,htmlNodes=this.$selected.childNodes,i=0;nodeIter=htmlNodes[i];
while(nodeIter){if(nodeIter.nodeType!=1){nodeIter=nodeIter.nextSibling;continue;
}h=apf.all[nodes[i].getAttribute("hid")];if(h.tree||h.rename){return this.$getLayoutNode(h.tree?"treecell":"cell","caption",nodeIter)||nodeIter;
}i++;nodeIter=nodeIter.nextSibling;}throw new Error("Datagrid without rename column specified");
};this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;
}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}};this.$blur=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);
}hideEditor.call(this);};this.addEventListener("bindingsload",this.$loaddatabinding=function(e){var rules=e.bindings.column;
if(!rules||!rules.length){return;}this.$headings=rules;var fixed=0,found=false;
for(var h,i=0,l=rules.length;i<l;i++){h=rules[i];if(!h.$width){throw new Error("missing width");
}if(!h.$isPercentage){fixed+=parseFloat(h.$width)||0;}else{found=true;}}if(!found){this.$isFixedGrid=true;
this.$setStyleClass(this.$ext,"fixed");if(this.$useiframe){this.$setStyleClass(this.oDoc.documentElement,"fixed");
}}else{}if(fixed>0&&!this.$isFixedGrid){var vLeft=fixed;this.$cssRules.push(["."+this.$baseCSSname+" .row"+this.$uniqueId,"padding-right:"+vLeft+"px;margin-right:-"+vLeft+"px"]);
this.$container.style.paddingRight=this.$head.style.paddingRight=vLeft+"px";}this.$fixed=fixed;
this.$first=0;this.$withContainer=e.bindings.description?true:false;apf.importStylesheet(this.$cssRules,window);
if(this.$useiframe){apf.importStylesheet(this.$cssRules,this.oWin);}});this.$initNode=function(xmlNode,state,Lid,depth){this.$getNewContext("item");
var oRow=this.$getLayoutNode("item");oRow.setAttribute("id",Lid);oRow.setAttribute("class",oRow.getAttribute("class")+" "+treeState[state]+" item"+this.$uniqueId);
this.$setStyleClass(this.$getLayoutNode("item","container"),treeState[state]);oRow.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");o.choose(null, true);"+(this.$withContainer?"o.slideToggle(this, null, true);":"")+(this.celledit&&!this.namevalue?"o.startRename(null, null, true);":""));
if(this.hasFeature(apf.__DRAGDROP__)){oRow.setAttribute("onmouseout","this.hasPassedDown = false;");
oRow.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, isSelected);":""));
oRow.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");
}else{oRow.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var wasSelected = o.$selected == this;                o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, wasSelected);":""));
}for(var cellType,cell,h,i=0;i<this.$headings.length;i++){h=this.$headings[i];if(h.tree&&h.check){cellType="treecheckcell";
this.$getNewContext("treecheckcell");cell=this.$getLayoutNode("treecheckcell");
var oc=this.$getLayoutNode("treecheckcell","openclose");oc.setAttribute("style","margin-left:"+(((depth||0))*15+4)+"px;");
oc.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");
oc.setAttribute("ondblclick","event.cancelBubble = true");}else{if(h.tree){cellType="treecell";
this.$getNewContext("treecell");cell=this.$getLayoutNode("treecell");var oc=this.$getLayoutNode("treecell","openclose");
oc.setAttribute("style","margin-left:"+(((depth||0))*15+4)+"px;");oc.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");
oc.setAttribute("ondblclick","event.cancelBubble = true");}else{cellType=h.check?"checkcell":"cell";
this.$getNewContext(cellType);cell=this.$getLayoutNode(cellType);}}if(this.$mode&&h.check){var elCheck=this.$getLayoutNode(cellType,"check");
if(elCheck){elCheck.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                        o.checkToggle(this, true);o.$skipSelect = true;");
if(apf.isTrue(this.$applyBindRule("checked",xmlNode))){this.$checkedList.push(xmlNode);
this.$setStyleClass(oRow,"checked");}else{if(this.isChecked(xmlNode)){this.$setStyleClass(oRow,"checked");
}}}else{throw new Error(apf.formatErrorString(0,this,"Could not find check attribute",'Maybe the attribute check is missing from your skin file:                            <a:item                              class        = "."                              caption      = "label/u/text()"                              icon         = "label"                              openclose    = "span"                              select       = "label"                              check        = "label/b"                              container    = "following-sibling::blockquote"                            >                                <div><span> </span><label><b> </b><u>-</u></label></div>                                <blockquote> </blockquote>                            </a:item>                        '));
return false;}}apf.setStyleClass(cell,h.$className);if(h.css){apf.setStyleClass(cell,(apf.lm.compile(h.css))(xmlNode));
}if(h.icon){var node=this.$getLayoutNode(cellType,"caption",oRow.appendChild(cell));
node=(node.nodeType==1&&node||node.parentNode);node.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,((h.cicon||h.$compile("icon",{nostring:true}))(xmlNode)||""))+");");
this.$setStyleClass(node,"iconCell",[]);}if(h.value){if(!h.cvalue2){h.$compile("value",{nostring:true});
if(h.value){h.cvalue2.hasAml=h.value.indexOf("<a:")>-1;}}if(h.cvalue2.hasAml){var q=(this.$amlBindQueue||(this.$amlBindQueue={}));
var htmlEl=this.$getLayoutNode(cellType,"caption",oRow.appendChild(cell));htmlEl.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.column||(q.column=[])).push(xmlNode)-1));
apf.setNodeValue(htmlEl,"&nbsp");}else{apf.setNodeValue(this.$getLayoutNode(cellType,"caption",oRow.appendChild(cell)),h.cvalue2(xmlNode)||"&nbsp");
}}}if(this.$bindings&&this.$bindings.color){var colorRule=this.$getDataNode("color",xmlNode);
this.$setStyleClass(oRow,colorRule?"highlight":null,colorRule?["highlight"]:null);
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass){this.$setStyleClass(oRow,cssClass);
if(cssClass){this.$dynCssClasses.push(cssClass);}}return oRow;};this.$updateNode=function(xmlNode,htmlNode){if(!htmlNode){return;
}var nodes=this.$head.childNodes,htmlNodes=htmlNode.childNodes,cell,p;if(!this.namevalue&&this.$curBtn){p=this.$curBtn.parentNode;
}var nodeIter,h,i=0;nodeIter=htmlNodes[0];while(nodeIter){if(nodeIter.nodeType!=1){nodeIter=nodeIter.nextSibling;
continue;}h=apf.all[nodes[i].getAttribute("hid")];cell=this.$getLayoutNode(h.tree?"treecell":"cell","caption",nodeIter)||nodeIter;
if(h.css){apf.setStyleClass(cell,(apf.lm.compile(h.css))(xmlNode));}if(h.tree){}if(h.value){if(!h.cvalue2){h.$compile("value",{nostring:true});
if(h.value){h.cvalue2.hasAml=h.value.indexOf("<a:")>-1;}}if(!h.cvalue2.hasAml){cell.innerHTML=h.cvalue2(xmlNode)||"";
}}if(h.icon){(cell.nodeType==1&&cell||cell.parentNode).style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,((h.cicon||h.$compile("icon",{nostring:true}))(xmlNode)||""))+")";
}i++;nodeIter=nodeIter.nextSibling;}if(this.$bindings&&this.$bindings.color){var colorRule=this.$getDataNode("color",xmlNode);
this.$setStyleClass(htmlNode,colorRule?"highlight":null,colorRule?["highlight"]:null);
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}};this.$dblclick=function(htmlNode){var _self=this,id,cell;while(!(id=htmlNode.getAttribute(apf.xmldb.htmlIdTag))||id.indexOf("|")==-1){htmlNode=(cell=htmlNode).parentNode;
if(htmlNode.nodeType!=1){return;}}if(this.$lastEditor&&this.$lastEditor[3]==htmlNode){return;
}var h,colId=cell.className.match(/(col\d+)/)[1];for(var i=0;i<this.$headings.length;
i++){if(this.$headings[i].$className==colId){h=this.$headings[i];break;}}if(!h.editor){return;
}var xmlNode=apf.xmldb.getNode(htmlNode);var editParent=h.tree?this.$getLayoutNode("cell","caption",cell):cell;
var oEditor,editor=h.editor;var ceditor=apf.lm.compile(editor,{xpathmode:2});var nodes=editParent.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(!nodes[i].host){if(nodes[i].nodeType==1){nodes[i].style.display="none";
}else{this.$lastTextValue=nodes[i].nodeValue;nodes[i].nodeValue="";}}}if(ceditor.type==2){if(!this.$editors[editor]){var constr=apf.namespaces[apf.ns.aml].elements[editor];
var info={htmlNode:editParent,style:"position:relative;z-index:10000",value:"[{"+this.id+".selected}::"+(v=h.value).substr(1,v.length-2)+"]",focussable:false};
if(!h.tree){info.width="100%-3";}if(constr.prototype.hasFeature(apf.__MULTISELECT__)){info.caption=h.eachcaption||"[text()]";
info.eachvalue=h.eachvalue;var model;if(model=h.getAttribute("model")){info.model=model;
info.each=h.each;}else{info.model="{"+this.id+".selected}";info.each=h.each;}}if(h.skin){info.skin=h.skin;
}oEditor=this.$editors[editor]=new constr(info);var box=apf.getBox(apf.getStyle(oEditor.$ext,"margin"));
if(box[1]||box[3]){oEditor.setAttribute("width","100%+2-"+(box[1]+box[3]));}oEditor.addEventListener("blur",function(){hideEditor.call(_self);
});oEditor.parentNode=this;oEditor.realtime=false;oEditor.$focusParent=this;oEditor.setAttribute("focussable","true");
oEditor.addEventListener("keydown",function(e){if(e.keyCode==13){hideEditor.call(_self);
_self.$focus();}else{if(e.keyCode==27){oEditor.removeAttribute("value");hideEditor.call(_self);
}}});oEditor.$executeAction=function(){this.parentNode.$executeAction.apply(this.parentNode,arguments);
};}else{oEditor=this.$editors[editor];if(oEditor.hasFeature(apf.__MULTISELECT__)&&!h.model){oEditor.setAttribute("value","[{"+this.id+".selected}::"+(v=h.value).substr(1,v.length-2)+"]");
}oEditor.setProperty("visible",true);editParent.appendChild(oEditor.$ext);oEditor.setAttribute("width",h.tree?"":"100%-3");
}}else{var obj=ceditor.call(this,this.xmlRoot);if(obj.localName=="template"){}else{}}if(oEditor.localName=="textbox"){oEditor.select();
}oEditor.focus();oEditor.$focus();this.$setStyleClass(htmlNode,"editing");this.$lastEditor=[oEditor,editParent,xmlNode,htmlNode,this.getActionTracker().undolength];
};this.addEventListener("mousedown",function(e){if(this.$lastEditor&&!apf.isChildOf(this.$lastEditor[1],e.htmlEvent.srcElement||e.htmlEvent.target,true)){hideEditor.call(this);
}});var hideEditor=function(e){if(this.$lastEditor){var ed=this.$lastEditor;this.$lastEditor=null;
if(ed[0].hasFeature(apf.__MULTISELECT__)){ed[0].$clearDynamicProperty("value");
}ed[0].setProperty("visible",false);var nodes=ed[1].childNodes;for(var i=0,l=nodes.length;
i<l;i++){if(!nodes[i].host){if(nodes[i].nodeType==1){nodes[i].style.display="";
}else{if(!ed[0].value){nodes[i].nodeValue=this.$lastTextValue;}}}}this.$setStyleClass(ed[3],"",["editing"]);
this.focus();}};this.addEventListener("beforeselect",hideEditor);this.getColumn=function(nr){return this.$headings[nr||this.$lastcol||0];
};this.resizeColumn=function(nr,newsize){var h=this.$headings[nr];h.resize(newsize);
};this.hideColumn=function(nr){var h=this.$headings[nr];h.hide();};this.showColumn=function(nr){var h=this.$headings[nr];
h.show();};this.sortColumn=function(hid){var h=this.$headings[nr];h.sort();};this.moveColumn=function(from,to){var h=this.$headings[nr];
h.move(to);};this.$draw=function(){this.$drawBase();var _self=this;this.$ext.onmousedown=function(e){_self.dispatchEvent("mousedown",{htmlEvent:e||event});
};this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);
if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$container.firstChild){this.$container.removeChild(this.$container.firstChild);
}var widthdiff=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";
this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);
if(this.$useiframe&&!this.oIframe){var sClass=this.$container.className;this.oIframe=this.$container.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));
this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;
this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');
this.$container=this.oDoc.body;this.$container.className=sClass;this.oDoc.documentElement.className=this.$ext.className;
apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);
if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,"overflowY")=="auto"){this.oIframe.onresize=function(){_self.$head.style.marginRight=_self.oDoc.documentElement.scrollHeight>_self.oDoc.documentElement.offsetHeight?"16px":"0";
};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);
}this.oDoc.documentElement.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.oDoc.documentElement.scrollLeft;
}};}else{if(apf.getStyle(this.$container,"overflowY")=="auto"){this.$resize=function(){_self.$head.style.marginRight=_self.$container.scrollHeight>_self.$container.offsetHeight?"16px":"0";
};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");
apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);
}this.$container.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.$container.scrollLeft;
}};}this.$container[this.clickedit?"onmousedown":"ondblclick"]=function(e){if(!e){e=event;
}_self.$dblclick(e.srcElement||e.target);};};this.$destroy=function(){this.$ext.onclick=this.$container.onresize=null;
apf.layout.removeRule(this.$container,"dg"+this.$uniqueId);apf.layout.activateRules(this.$container);
};}).call(apf.datagrid.prototype=new apf.BaseTree());apf.aml.setElement("datagrid",apf.datagrid);
apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);
apf.aml.setElement("contents",apf.BindingRule);if(apf.hasRequireJS){require.def("apf/elements/debugger",[],function(){apf.dbg=function(struct,tagName){this.$init(tagName||"debugger",apf.NODE_HIDDEN,struct);
};(function(){this.$host=null;this.$debugger=null;this.$supportedProperties.push("state-running","state-attached","model-sources","model-stacks","model-breakpoints","activeframe");
this.$createModelPropHandler=function(name,xml,callback){return function(value){if(!value){return;
}this[name]=apf.setReference(value,apf.nameserver.register("model",value,new apf.model()));
this[name].id=this[name].name=value;this[name].load(xml);};};this.$createStatePropHandler=function(name){return function(value){if(!value){return;
}this[name]=apf.setReference(value,apf.nameserver.register("state",value,new apf.state()));
this[name].id=this[name].name=value;this[name].deactivate();};};this.$propHandlers["model-sources"]=this.$createModelPropHandler("$mdlSources","<sources />");
this.$propHandlers["model-stack"]=this.$createModelPropHandler("$mdlStack","<frames />");
this.$propHandlers["model-breakpoints"]=this.$createModelPropHandler("$mdlBreakpoints","<breakpoints />");
this.$propHandlers["state-running"]=this.$createStatePropHandler("$stRunning");
this.$propHandlers["state-attached"]=this.$createStatePropHandler("$stAttached");
this.$propHandlers.activeframe=function(value){if(this.$debugger){this.$ignoreFrameEvent=true;
this.$debugger.setFrame(value);this.$ignoreFrameEvent=false;}this.dispatchEvent("changeframe",{data:value});
};this.attach=function(host,tab){var _self=this;host.$attach(this,tab,function(err,dbgImpl){_self.$host=host;
_self.$debugger=dbgImpl;dbgImpl.addEventListener("afterCompile",_self.$onAfterCompile.bind(_self));
_self.$stAttached.activate();_self.$stRunning.setProperty("active",dbgImpl.isRunning());
dbgImpl.addEventListener("changeRunning",_self.$onChangeRunning.bind(_self));dbgImpl.addEventListener("break",_self.$onBreak.bind(_self));
dbgImpl.addEventListener("detach",_self.$onDetach.bind(_self));dbgImpl.addEventListener("changeFrame",_self.$onChangeFrame.bind(_self));
_self.$loadSources(function(){dbgImpl.setBreakpoints(_self.$mdlBreakpoints,function(){_self.$debugger.backtrace(_self.$mdlStack,function(){var frame=_self.$mdlStack.queryNode("frame[1]");
if(frame){var scriptId=frame.getAttribute("scriptid");var scriptName=_self.$mdlSources.queryValue("file[@scriptid='"+scriptId+"']/@scriptname");
if(scriptName){var line=frame.getAttribute("line");var bp=_self.$mdlBreakpoints.queryNode("breakpoint[@script='"+scriptName+"' and @line='"+line+"']");
}if(!scriptName||!bp){_self.$debugger.continueScript();}}});});});});};this.$onChangeRunning=function(){var isRunning=this.$debugger&&this.$debugger.isRunning();
if(this.$stRunning.active&&!isRunning){this.$onBreak();}this.$stRunning.setProperty("active",isRunning);
};this.$onBreak=function(){var _self=this;if(!this.$debugger||this.$debugger.isRunning()){return;
}this.$debugger.backtrace(this.$mdlStack,function(){_self.dispatchEvent("break");
});};this.$onAfterCompile=function(e){var id=e.script.getAttribute("id");var oldNode=this.$mdlSources.queryNode("//file[@id='"+id+"']");
if(oldNode){this.$mdlSources.removeXml(oldNode);}this.$mdlSources.appendXml(e.script);
};this.$onDetach=function(){if(this.$debugger){this.$debugger.destroy();this.$debugger=null;
}this.$host=null;this.$mdlSources.load("<sources />");this.$mdlStack.load("<frames />");
this.$stAttached.deactivate();this.setProperty("activeframe",null);};this.$onChangeFrame=function(){if(!this.$ignoreFrameEvent){this.setProperty("activeframe",this.$debugger.getActiveFrame());
}};this.changeFrame=function(frame){this.$debugger.setFrame(frame);};this.detach=function(callback){this.continueScript();
if(this.$host){this.$host.$detach(this.$debugger,callback);}else{this.$onDetach();
}};this.$loadSources=function(callback){this.$debugger.scripts(this.$mdlSources,callback);
};this.loadScript=function(script,callback){this.$debugger.loadScript(script,callback);
};this.loadObjects=function(item,callback){this.$debugger.loadObjects(item,callback);
};this.loadFrame=function(frame,callback){this.$debugger.loadFrame(frame,callback);
};this.toggleBreakpoint=function(script,row){var model=this.$mdlBreakpoints;if(this.$debugger){this.$debugger.toggleBreakpoint(script,row,model);
}else{var scriptName=script.getAttribute("scriptname");var bp=model.queryNode("breakpoint[@script='"+scriptName+"' and @line='"+row+"']");
if(bp){model.removeXml(bp);}else{var bp=apf.n("<breakpoint/>").attr("script",scriptName).attr("line",row).attr("text",script.getAttribute("path")+":"+row).attr("lineoffset",0).node();
model.appendXml(bp);}}};this.continueScript=function(callback){this.dispatchEvent("beforecontinue");
if(this.$debugger){this.$debugger.continueScript(callback);}else{callback&&callback();
}};this.stepInto=function(){this.dispatchEvent("beforecontinue");this.$debugger&&this.$debugger.stepInto();
};this.stepNext=function(){this.dispatchEvent("beforecontinue");this.$debugger&&this.$debugger.stepNext();
};this.stepOut=function(){this.dispatchEvent("beforecontinue");this.$debugger&&this.$debugger.stepOut();
};this.suspend=function(){this.$debugger&&this.$debugger.suspend();};this.evaluate=function(expression,frame,global,disableBreak,callback){this.$debugger&&this.$debugger.evaluate(expression,frame,global,disableBreak,callback);
};this.changeLive=function(scriptId,newSource,previewOnly,callback){this.$debugger&&this.$debugger.changeLive(scriptId,newSource,previewOnly,callback);
};}).call(apf.dbg.prototype=new apf.AmlElement());apf.aml.setElement("debugger",apf.dbg);
window.adbg={exec:function(method,args,callback,options){if(method=="loadScript"){var dbg=args[0];
var script=args[1];dbg.loadScript(script,function(source){if(options&&options.callback){options.callback(apf.escapeXML(source),apf.SUCCESS);
}else{callback("<file><![CDATA["+source.replace("]]>","]] >")+"]]></file>",apf.SUCCESS);
}});}else{if(method=="loadObjects"){var dbg=args[0];var item=args[1];dbg.loadObjects(item,function(xml){if(options&&options.callback){options.callback(xml,apf.SUCCESS);
}else{callback(xml,apf.SUCCESS);}});}else{if(method=="loadFrame"){var dbg=args[0];
var frame=args[1];dbg.loadFrame(frame,function(xml){if(options&&options.callback){options.callback(xml,apf.SUCCESS);
}else{callback(xml,apf.SUCCESS);}});}}}}};(apf.$asyncObjects||(apf.$asyncObjects={}))["adbg"]=1;
return apf.dbg;});}if(apf.hasRequireJS){require.def("apf/elements/debughost",["apf/elements/dbg/chromedebughost","apf/elements/dbg/v8debughost","apf/elements/dbg/v8websocketdebughost"],function(ChromeDebugHost,V8DebugHost,V8WebSocketDebugHost){apf.debughost=function(struct,tagName){this.$init(tagName||"debughost",apf.NODE_HIDDEN,struct);
};(function(){this.port=9222;this.server="localhost";this.type="chrome";this.autoinit=false;
this.$modelTabs=null;this.$stateConnected=null;this.$host=null;this.$booleanProperties.autostart=true;
this.$supportedProperties.push("port","server","type","autoinit","model-tabs","state-connected","strip");
this.$propHandlers["model-tabs"]=function(value){if(!value){return;}this.$modelTabs=apf.nameserver.get("model",value)||apf.setReference(value,apf.nameserver.register("model",value,new apf.model()));
this.$modelTabs.id=this.$modelTabs.name=value;this.$modelTabs.load("<tabs/>");};
this.$propHandlers["state-connected"]=function(value){if(!value){return;}this.$stateConnected=apf.nameserver.get("state",value)||apf.setReference(value,apf.nameserver.register("state",value,new apf.state()));
this.$stateConnected.id=this.$stateConnected.name=value;this.$stateConnected.deactivate();
};this.init=function(){if(this.$host){return;}if(this.type=="chrome"||this.type=="v8"||this.type=="v8-ws"){if(!apf.debughost.$o3obj&&this.type!=="v8-ws"){apf.debughost.$o3obj=window.o3Obj||o3.create("8A66ECAC-63FD-4AFA-9D42-3034D18C88F4",{oninstallprompt:function(){alert("can't find o3 plugin");
},product:"O3Demo"});}if(this.type=="chrome"){this.$host=new ChromeDebugHost(this.server,this.port,apf.debughost.$o3obj);
}else{if(this.type=="v8"){this.$host=new V8DebugHost(this.server,this.port,apf.debughost.$o3obj);
}else{if(this.type=="v8-ws"){var socket=this.dispatchEvent("socketfind");if(!socket){throw new Error("no socket found!");
}this.$host=new V8WebSocketDebugHost(socket);}else{if(this.type=="chrome-ws"){var socket=this.dispatchEvent("socketfind");
if(!socket){throw new Error("no socket found!");}this.$host=new ChromeDebugHost(null,null,null,socket);
}}}}var self=this;this.$host.addEventListener("connect",function(){self.dispatchEvent("connect");
self.$stateConnected.activate();});this.$host.addEventListener("disconnect",function(){self.dispatchEvent("disconnect");
self.$stateConnected.deactivate();});this.loadTabs();}};this.loadTabs=function(){if(!this.$host){this.init();
}var self=this;this.$host.loadTabs(this.$modelTabs,function(){self.$dispatchEvent("tabsloaded");
});};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.autoinit){this.init();
}});this.$attach=function(dbg,tab,callback){if(!this.$host){this.init();}if(tab){var id=tab.getAttribute("id");
}else{var id=null;}var _self=this;this.$host.attach(id,function(err,dbg){dbg.setStrip(_self.strip||"");
callback(err,dbg);});};this.$detach=function(dbgImpl,callback){if(!this.$host){return;
}this.$host.detach(dbgImpl,callback);};this.disconnect=function(){if(!this.$host){return;
}this.$host.disconnect();this.$host=null;};}).call(apf.debughost.prototype=new apf.AmlElement());
apf.aml.setElement("debughost",apf.debughost);return apf.debughost;});}apf.defaults=function(struct,tagName){this.$init(tagName||"services",apf.NODE_HIDDEN,struct);
};(function(){this.$parsePrio="002";this.$propHandlers["for"]=function(value){if(this.$lastFor){apf.nameserver.remove("defaults_"+this.$lastFor,this);
}apf.nameserver.add("defaults_"+value,this);this.$lastFor=value;};this.addEventListener("DOMNodeRemovedFromDocument",function(e){apf.nameserver.remove("defaults_"+this.$lastFor,this);
});}).call(apf.defaults.prototype=new apf.AmlElement());apf.aml.setElement("defaults",apf.defaults);
apf.divider=function(struct,tagName){this.$init(tagName||"divider",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.implement(apf.ChildValue);this.$childProperty="caption";
this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}if(!withinParent&&this.skinName!=pNode.skinName){this.loadAml();}});this.$supportedProperties.push("caption","value","for","textalign");
this.$propHandlers.caption=function(value){if(this.$caption){this.$setStyleClass(this.$ext,this.$baseCSSname+"Caption");
this.$caption.innerHTML=value;}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Caption"]);
}};this.$canLeechSkin=true;this.$draw=function(){if(this.parentNode.isPaged&&this.parentNode.$buttons){this.$pHtmlNode=this.parentNode.$buttons;
}if(this.$isLeechingSkin){this.$ext=apf.insertHtmlNode(this.parentNode.$getLayoutNode("divider"),this.$pHtmlNode);
}else{this.$ext=this.$getExternal("main");this.$caption=this.$getLayoutNode("main","caption",this.$ext);
}};}).call(apf.divider.prototype=new apf.Presentation);apf.aml.setElement("divider",apf.divider);
apf.dropdown=function(struct,tagName){this.$init(tagName||"dropdown",apf.NODE_VISIBLE,struct);
};(function(){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";
this.dragdrop=false;this.reselectable=true;this.$focussable=apf.KEYBOARD;this.autoselect=false;
this.multiselect=false;this.disableremove=true;this.delayedselect=false;this.maxitems=5;
this.$booleanProperties.disableremove=true;this.$supportedProperties.push("maxitems","disableremove","initial-message","fill");
this.$propHandlers.maxitems=function(value){this.sliderHeight=value?(Math.min(this.maxitems||100,value)*this.itemHeight):10;
this.containerHeight=value?(Math.min(this.maxitems||100,value)*this.itemHeight):10;
};this.$propHandlers["class"]=function(value){this.$setStyleClass(this.oSlider,value);
};this.slideToggle=function(e,userAction){if(!e){e=event;}if(userAction&&this.disabled){return;
}if(this.isOpen){this.slideUp();}else{this.slideDown(e);}};this.slideDown=function(e){if(this.dispatchEvent("slidedown")===false){return false;
}this.isOpen=true;this.$propHandlers.maxitems.call(this,this.xmlRoot&&this.each?this.getTraverseNodes().length:this.childNodes.length);
this.oSlider.style.display="block";if(!this.ignoreOverflow){this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="visible";
this.$container.style.overflowY="hidden";}this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");
this.oSlider.style.height=(this.sliderHeight-1)+"px";this.oSlider.style.width=(this.$ext.offsetWidth-2-this.widthdiff)+"px";
var _self=this;apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,container:this.$getLayoutNode("container","contents",this.oSlider),ref:this.$ext,width:this.$ext.offsetWidth-this.widthdiff,height:this.containerHeight,callback:function(container){if(!_self.ignoreOverflow){_self.$container.style.overflowY="auto";
}}});};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;
}this.isOpen=false;if(this.selected){var htmlNode=apf.xmldb.findHtmlNode(this.selected,this);
if(htmlNode){this.$setStyleClass(htmlNode,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);
apf.popup.hide();return false;};this.$setLabel=function(value){this.oLabel.innerHTML=value||this["initial-message"]||"";
this.$setStyleClass(this.$ext,value?"":this.$baseCSSname+"Initial",!value?[]:[this.$baseCSSname+"Initial"]);
};this.addEventListener("afterselect",function(e){if(!e){e=event;}this.slideUp();
if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(e.selection.length?this.$applyBindRule("caption",this.selected):"");
});function setMaxCount(){if(this.isOpen==2){this.slideDown();}}this.addEventListener("afterload",setMaxCount);
this.addEventListener("xmlupdate",function(){setMaxCount.call(this);this.$setLabel(this.$applyBindRule("caption",this.selected));
});this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$setClearMessage=function(msg){this.$setLabel(msg);
};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("popuphide",this.slideUp);
this.addEventListener("keydown",function(e){var key=e.keyCode;if(!this.xmlRoot){return;
}var node;switch(key){case 32:this.slideToggle(e.htmlEvent);break;case 38:if(e.altKey){this.slideToggle(e.htmlEvent);
return;}if(!this.selected){return;}node=this.getNextTraverseSelected(this.caret||this.selected,false);
if(node){this.select(node);}break;case 40:if(e.altKey){this.slideToggle(e.htmlEvent);
return;}if(!this.selected){node=this.getFirstTraverseNode();if(!node){return;}}else{node=this.getNextTraverseSelected(this.selected,true);
}if(node){this.select(node);}break;default:if(key==9||!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>1000){this.lookup={str:"",date:new Date()};
}this.lookup.str+=String.fromCharCode(key);var caption,nodes=this.getTraverseNodes();
for(var i=0;i<nodes.length;i++){caption=this.$applyBindRule("caption",nodes[i]);
if(caption&&caption.indexOf(this.lookup.str)>-1){this.select(nodes[i]);return;}}return;
}return false;},true);this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");
this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";
this.$ext=this.$getExternal(null,null,function(oExt){oExt.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');o.$setStyleClass(o.$ext, o.$baseCSSname + "Over", null, true);');
oExt.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');if(o.isOpen) return;o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"], true);');
var oButton=this.$getLayoutNode("main","button",oExt);if(oButton){oButton.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}var oLabel=this.$getLayoutNode("main","label",oExt);if(this.clickOpen=="both"){oLabel.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;
}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);
}this.oSlider=apf.insertHtmlNode(this.$getLayoutNode("container"),document.body);
this.$container=this.$getLayoutNode("container","contents",this.oSlider);this.$container.host=this;
this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));
this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;this.itemHeight=this.$getOption("main","item-height")||18.5;
this.widthdiff=this.$getOption("main","width-diff")||0;this.ignoreOverflow=apf.isTrue(this.$getOption("main","ignore-overflow"))||false;
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");
}if(!this.selected&&this["initial-message"]){this.$setLabel();}});this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);
apf.destroyHtmlNode(this.oSlider);this.oSlider=null;};}).call(apf.dropdown.prototype=new apf.BaseList());
apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("dropdown",apf.dropdown);
apf.editor=function(struct,tagName){this.$init(tagName||"editor",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.LiveEdit);this.value="";this.$value="";this.$oWin=this.$oBookmark=this.$fTimer=null;
this.$isTextInput=true;this.$booleanProperties.scalewithiframe=true;this.$supportedProperties.push("value","characterset","scalewithiframe");
this.$propHandlers.value=function(html){if(typeof html!="string"){html="";}if(this.$value.replace(/\r/g,"")==html){return;
}this.$value=html;html=html.replace(/<p[^>]*>/gi,"").replace(/<\/p>/gi,"<br _apf_marker='1' /><br _apf_marker='1' />");
html=apf.htmlCleaner.prepare(html);if(this.$pluginsActive=="code"){this.$plugins.code.update(this,html);
}else{if(this.$activeDocument){this.$activeDocument.body.innerHTML=html;this.$controlAgentBehavior(this.$activeDocument.body);
}}if(this.scalewithiframe){rescale.call(this);}this.dispatchEvent("sethtml",{editor:this});
};var rescaleTimer;function rescale(timeout){clearTimeout(rescaleTimer);var _self=this;
rescaleTimer=$setTimeout(function(){var h,w,el=_self.$activeDocument&&_self.$activeDocument.body;
if(!el||!(h=el.scrollHeight)||!(w=el.scrollWidth)){return;}_self.$resize({height:h});
},timeout||0);}this.addEventListener("execcommand",function(e){if(this.scalewithiframe){rescale.call(this);
}});this.makeEditable=function(){var _self=this;if(apf.isIE){$setTimeout(function(){_self.$activeDocument.body.contentEditable=true;
});}else{try{this.$activeDocument.designMode="on";if(apf.isGecko){this.$activeDocument.execCommand("enableObjectResizing",false,this.imagehandles);
this.$activeDocument.execCommand("enableInlineTableEditing",false,this.tablehandles);
}}catch(e){}}this.dispatchEvent("complete",{editor:this});};this.getValue=function(bStrict){if(!this.$activeDocument){return"";
}return(this.$value=apf.htmlCleaner.parse(this.$activeDocument.body.innerHTML,bStrict));
};this.setValue=function(value){return this.setProperty("value",value,false,true);
};this.addEventListener("$clear",function(e){if(!e.nomsg){this.value="";return this.$propHandlers.value.call(this,"");
}});var clickTimer;function onClick(e){clearTimeout(clickTimer);if(this.$oBookmark&&apf.isGecko){var oNewBm=_self.$selection.getBookmark();
if(typeof oNewBm.start=="undefined"&&typeof oNewBm.end=="undefined"){}}var which=e.which,button=e.button,_self=this;
clickTimer=$setTimeout(function(){var rClick=((which==3)||(button==2));if(apf.document.activeElement!=this){_self.focus({});
}else{if(!rClick){_self.$focus({});}}});}function onContextmenu(e){if(this.state==apf.DISABLED){return;
}this.$notifyAllPlugins("context",e);}this.$focus=function(e){if(!this.$ext||this.$ext.disabled){return;
}clearInterval(this.$fTimer);this.setProperty("state",(this.$pluginsActive=="code")?apf.DISABLED:apf.OFF);
this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");var _self=this;this.$fTimer=setInterval(function delay(){try{if(!_self.$fTimer||document.activeElement!=_self.$ext){_self.$visualFocus(true);
clearInterval(_self.$fTimer);}else{clearInterval(_self.$fTimer);return;}}catch(e){}},1);
};this.$isTextInput=function(e){return apf.isChildOf(this.$activeDocument,e.srcElement,true);
};this.$blur=function(e){if(!this.$ext){return;}var pParent=apf.popup.last&&apf.lookup(apf.popup.last);
if(pParent&&pParent.editor==this){apf.popup.forceHide();}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
var bCode=(this.$pluginsActive=="code");if(!this.realtime||bCode){this.change(bCode?this.$plugins.code.getValue():this.getValue());
}this.setProperty("state",apf.DISABLED);};this.$addListeners=function(){var _self=this;
apf.addListener(this.$activeDocument,"mouseup",onClick.bindWithEvent(this));apf.addListener(this.$activeDocument,"keyup",function(e){e=e||window.event;
if(_self.scalewithiframe){rescale.call(_self);}apf.document.activeElement=_self;
apf.window.$keyup(e);});apf.addListener(this.$activeDocument,"keydown",function(e){apf.document.activeElement=_self;
apf.window.$keydown(e);});apf.addListener(this.$activeDocument,"mousedown",function(e){e=e||window.event;
_self.$selection.cache();apf.popup.forceHide();apf.window.$mousedown(e);});var scrollHandler=function(e){if(!e){e=event;
}apf.window.$mousewheel.call(window,{target:_self.$ext,wheelDelta:e.wheelDelta,detail:e.detail});
};if(this.$oWin&&this.$oWin.document.addEventListener){this.$oWin.document.addEventListener("DOMMouseScroll",scrollHandler,false);
}window.onmousewheel=document.onmousewheel=scrollHandler;apf.addListener(this.$activeDocument,"contextmenu",onContextmenu.bindWithEvent(this));
apf.addListener(this.$activeDocument,"focus",apf.window.$focusevent);apf.addListener(this.$activeDocument,"blur",apf.window.$blurevent);
this.$activeDocument.host=this;apf.addListener(this.$activeDocument.body,"paste",function(e){e=e||window.event;
_self.$paste(e);$setTimeout(function(){if(_self.scalewithiframe){rescale.call(_self);
}});});};this.$draw=function(){this.$editable(function(){var oEditor=this.$getLayoutNode("main","editor",this.$ext),_self=this;
this.iframe=document.createElement("iframe");this.iframe.setAttribute("frameborder","0");
this.iframe.setAttribute("border","0");this.iframe.setAttribute("scrolling","no");
this.iframe.setAttribute("marginwidth","0");this.iframe.setAttribute("marginheight","0");
oEditor.appendChild(this.iframe);this.$oWin=this.iframe.contentWindow;this.$activeDocument=this.$oWin.document;
this.$selection=new apf.selection(this.$oWin,this.$activeDocument,this);var sCss=apf.queryValue($xmlns(apf.skins.skins[this.skinName.split(":")[0]].xml,"docstyle",apf.ns.aml)[0],"text()");
if(!sCss){sCss="                    html {                        cursor: text;                        border: 0;                    }                    body {                        margin: 8px;                        padding: 0;                        border: 0;                        color: #000;                        font-family: Verdana,Arial,Helvetica,sans-serif;                        font-size: 10pt;                        background: #fff;                        word-wrap: break-word;                    }                    .itemAnchor {                        background:url(images/editor/items.gif) no-repeat left bottom;                        line-height:6px;                        overflow:hidden;                        padding-left:12px;                        width:12px;                    }                    .visualAid table,                    .visualAid table td {                        border: 1px dashed #bbb;                    }                    .visualAid table td {                        margin: 8px;                    }                    h1 {                        margin : 15px 0 15px 0;                    }                    p {                        margin: 0;                        padding: 0;                    }                    sub, sup {                        line-height: 10px;                    }";
}var c=this.getAttribute("characterset")||this.getAttribute("charset")||apf.characterSet;
this.$activeDocument.open();this.$activeDocument.write('<?xml version="1.0" encoding="'+c+'"?>                <html>                <head>                    <meta http-equiv="Content-Type" content="text/html; charset='+c+'" />                    <title></title>                    <style type="text/css">'+sCss+'</style>                </head>                <body class="visualAid"></body>                </html>');
this.$activeDocument.close();if(apf.hasFocusBug){apf.sanitizeTextbox(this.$activeDocument.body);
}this.addEventListener("resize",this.$resize);this.$addListeners();this.makeEditable();
$setTimeout(function(){_self.setProperty("state",apf.DISABLED);});});};this.$resize=function(oSize){if(!this.iframe||!this.iframe.parentNode||!this.$ext.offsetHeight){return;
}if(this.$container){var h=(this.$ext.offsetHeight-this.$toolbar.offsetHeight-2);
if(!h||h<0){h=0;}this.$container.style.height=h+"px";}if(this.scalewithiframe&&oSize){if(oSize.width){this.iframe.style.width=oSize.width+"px";
}if(oSize.height){this.iframe.style.height=oSize.height+"px";}}this.$notifyAllPlugins("resize");
if(this.$pluginsActive=="code"){this.$plugins.code.setSize(this);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.$container=this.$getLayoutNode("main","container",this.$ext);
if(apf.isOnlyChild(this.firstChild,[3,4])){this.$handlePropSet("value",this.firstChild.nodeValue.trim());
}if(this.scalewithiframe){rescale.call(this,2000);}});this.$destroy=function(){this.$selection.$destroy();
this.$selection=this.$activeDocument.host=this.oToobar=this.$activeDocument=this.$oWin=this.iframe=null;
};}).call(apf.editor.prototype=new apf.StandardBinding());apf.aml.setElement("editor",apf.editor);
apf.errorbox=function(struct,tagName){this.$init(tagName||"errorbox",apf.NODE_VISIBLE,struct);
};(function(){this.$positioning="basic";this.display=function(host){this.host=host;
var refHtml=host.validityState&&host.validityState.$errorHtml||host.$ext;document.body.appendChild(this.$ext);
var x=(parseFloat(host.$getOption&&host.$getOption("main","erroffsetx")||0)),y=(parseFloat(host.$getOption&&host.$getOption("main","erroffsety")||0));
this.show();apf.popup.show(this.$uniqueId,{x:x,y:y,animate:false,ref:refHtml,allowTogether:true});
this.$setStyleClass(this.$ext,x+this.$ext.offsetWidth>this.$ext.offsetParent.offsetWidth?"rightbox":"leftbox",["leftbox","rightbox"]);
};this.setMessage=function(value){if(value&&value.indexOf(";")>-1){value=value.split(";");
value="<strong>"+value.shift()+"</strong>"+value.join(";");}this.$int.innerHTML=value||"";
};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
this.oClose=this.$getLayoutNode("main","close",this.$ext);if(this.oClose){var _self=this;
this.oClose.onclick=function(){_self.hide();if(apf.document.activeElement){apf.document.activeElement.focus(true,{mouse:true});
}};}this.$ext.onmousedown=function(e){(e||event).cancelBubble=true;if(apf.hasFocusBug){apf.window.$focusfix();
}};apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(x){if(!apf.isTrue(this.getAttribute("visible"))){this.hide();
}};this.$destroy=function(){if(this.oClose){this.oClose.onclick=null;}this.$ext.onmousedown=null;
apf.popup.removeContent(this.$uniqueId);};}).call(apf.errorbox.prototype=new apf.Presentation());
apf.aml.setElement("errorbox",apf.errorbox);apf.event=function(struct,tagName){this.$init(tagName||"event",apf.NODE_HIDDEN,struct);
};(function(){this.$hasInitedWhen=false;this.$booleanProperties.repeat=true;this.$supportedProperties.push("when","message","icon","repeat");
this.$propHandlers.when=function(value){if(this.$hasInitedWhen&&value&&this.parentNode&&this.parentNode.popup){var _self=this;
$setTimeout(function(){_self.parentNode.popup(_self.message,_self.icon,_self);});
}this.$hasInitedWhen=true;if(this.repeat){delete this.when;}};this.$loadAml=function(x){};
}).call(apf.event.prototype=new apf.AmlElement());apf.aml.setElement("event",apf.event);
apf.filler=function(struct,tagName){this.$init(tagName||"filler",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.flex=1;this.$draw=function(){this.$ext=this.$pHtmlNode.appendChild(this.$pHtmlNode.ownerDocument.createElement("div"));
};}).call(apf.filler.prototype=new apf.GuiElement());apf.aml.setElement("filler",apf.filler);
apf.flashplayer=function(struct,tagName){this.$init(tagName||"flashplayer",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.StandardBinding);this.setValue=function(value){this.setProperty("value",value,false,true);
};this.$supportedProperties.push("value");this.$propHandlers.value=function(value){this.setSource(value);
};this.$draw=function(){this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));
this.$ext.onclick=function(){this.host.dispatchEvent("click");};var src=this.getAttribute("src")||"";
this.$ext.insertAdjacentHTML("beforeend",'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"               codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"               width="100%"               height="100%"               align="middle">                <param name="allowScriptAccess" value="sameDomain" />                <param name="allowFullScreen" value="false" />                <param name="movie" value="'+src+'" />                <param name="play" value="true" />                <param name="menu" value="false" />                <param name="quality" value="high" />                <param name="wmode" value="transparent" />                <param name="bgcolor" value="#ffffff" />                <embed src="'+src+'" play="true" menu="false"                   quality="high" wmode="transparent" bgcolor="#ffffff" width="100%"                   height="100%" align="middle" allowScriptAccess="sameDomain"                   allowFullScreen="false" type="application/x-shockwave-flash"                   pluginspage="http://www.macromedia.com/go/getflashplayer" />            </object>');
};this.$loadAml=function(x){};}).call(apf.flashplayer.prototype=new apf.GuiElement());
apf.aml.setElement("flashplayer",apf.flashplayer);apf.flowchart=function(struct,tagName){this.$init(tagName||"flowchart",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.Cache,apf.Rename);this.objCanvas=null;
this.nodes=[];this.snap=false;this.gridW=48;this.gridH=48;this.$flowVars={lastBlockId:0,template:null,resizeManager:null,xmlBlocks:{},objBlocks:{},xmlConnections:{},connToPaint:[]};
this.$init(function(){var _self=this;var onkeydown_=function(e){e=(e||event);var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,sel=this.getSelection(),value=this.snap?((key==37||key==39?this.gridW:(key==38||key==40?this.gridH:0))*(ctrlKey?2:(shiftKey?3:1))):(ctrlKey?10:(shiftKey?100:1)),disabled=_self.objCanvas.disableremove;
if(!sel||disabled){return;}switch(key){case 37:this.moveTo(sel,-value,0);break;
case 38:this.moveTo(sel,0,-value);break;case 39:this.moveTo(sel,value,0);break;
case 40:this.moveTo(sel,0,value);break;case 46:_self.$flowVars.resizeManager.hide();
switch(_self.objCanvas.mode){case"normal":this.removeBlocks(sel);break;case"connection-change":var connectionsToDelete=[],connectors=_self.objCanvas.htmlConnectors;
for(var id in connectors){if(connectors[id].selected){connectionsToDelete.push(connectors[id].other.xmlNode);
connectors[id].destroy();}}_self.removeConnectors(connectionsToDelete);_self.objCanvas.mode="normal";
break;}break;}return false;};this.addEventListener("keydown",onkeydown_,true);apf.addEventListener("contextmenu",function(){return false;
});function $afterRenameMode(){_self.objCanvas.disableremove=false;}this.addEventListener("afterrename",$afterRenameMode);
this.addEventListener("stoprename",$afterRenameMode);});this.$propHandlers.snap=function(value){var isNumber=parseInt(value)>0?true:false;
this.snap=this.objCanvas.snap=value=="true"||isNumber?true:false;if(isNumber){this.gridW=this.objCanvas.gridW=parseInt(value);
this.gridH=this.objCanvas.gridH=parseInt(value);}};this.$propHandlers["grid-width"]=function(value){this.gridW=this.objCanvas.gridW=parseInt(value);
};this.$propHandlers["grid-height"]=function(value){this.gridH=this.objCanvas.gridH=parseInt(value);
};this.$getCaptionElement=function(){var objBlock=this.$flowVars.objBlocks[this.$applyBindRule("id",this.selected)];
if(!objBlock){return;}return objBlock.caption;};this.$beforeRename=function(e,userAction){if(userAction&&this.disabled){return;
}e=e||event;var target=e.srcElement||e.target;this.$selectCaption(target);this.objCanvas.disableremove=true;
this.$deselectCaption(target);this.startRename();var rename_input=this.$pHtmlDoc.getElementById("txt_rename");
this.$setStyleClass(rename_input,target.className);var c=rename_input;if((target.className||"").indexOf("inside")!=-1){if(c.offsetHeight!==0){c.style.marginTop="-"+(Math.ceil(c.offsetHeight/2))+"px";
}}return false;};this.$selectCaption=function(o){if(!o||o.nodeType!=1){return;}this.$setStyleClass(o,"selected");
};this.$deselectCaption=function(o){if(!o||o.nodeType!=1){return;}this.$setStyleClass(o,"",["selected"]);
};this.$select=function(o){if(!o){return;}var objBlock=apf.flow.isBlock(o);if(objBlock){if(this.$flowVars.resizeManager){var prop=objBlock.other;
if(prop.lock==1){return;}this.$flowVars.resizeManager.grab(o,{scalex:prop.scalex,scaley:prop.scaley,scaleratio:prop.scaleratio,dwidth:prop.dwidth,dheight:prop.dheight,ratio:prop.ratio,snap:this.snap,gridH:this.gridH,gridW:this.gridW});
}this.$setStyleClass(o,"selected");if(objBlock.other.capPos!=="inside"){this.$selectCaption(objBlock.caption);
}}};this.$deselect=function(o){if(!o){return;}this.$setStyleClass(o,"",["selected"]);
var objBlock=apf.flow.isBlock(o);if(!objBlock){return;}this.$deselectCaption(objBlock.caption);
this.$flowVars.resizeManager.hide();};this.moveTo=function(xmlNodeArray,dl,dt){if(!xmlNodeArray){return;
}if(!xmlNodeArray.length){xmlNodeArray=[xmlNodeArray];}var changes=[],setNames=["top","left"],node,value,i,l,j;
for(i=0,l=xmlNodeArray.length;i<l;i++){for(j=0;j<setNames.length;j++){node=this.$getDataNode(setNames[j],xmlNodeArray[i],this.$createModel);
value=(setNames[j]=="left"?dl:dt)+(parseInt(this.$applyBindRule(setNames[j],xmlNodeArray[i]))||0);
if(this.snap){var gridSize=setNames[j]=="top"?this.gridH:this.gridW;value=Math.round(value/gridSize)*gridSize;
}if(node){var atAction=node.nodeType==1||node.nodeType==3||node.nodeType==4?"setTextNode":"setAttribute";
var args=node.nodeType==1?[node,value]:(node.nodeType==3||node.nodeType==4?[node.parentNode,value]:[node.ownerElement||node.selectSingleNode(".."),node.nodeName,value]);
changes.push({action:atAction,args:args});}}}this.$executeAction("multicall",changes,"moveTo",xmlNodeArray);
};this.setZindex=function(xmlNode,value){this.$executeSingleValue("setzindex","zindex",xmlNode,value);
};this.setMode=function(mode){this.objCanvas.setMode(mode);};this.getMode=function(){return this.objCanvas.getMode();
};this.setLock=function(xmlNode,value){this.$executeSingleValue("setlock","lock",xmlNode,String(value));
};this.rotate=function(xmlNode,newRotation){var prevFlipV=this.$applyBindRule("flipv",xmlNode)=="true"?true:false,prevFlipH=this.$applyBindRule("fliph",xmlNode)=="true"?true:false,prevRotation=parseInt(this.$applyBindRule("rotation",xmlNode))||0,names=["fliph","flipv","rotation"],values;
if(prevFlipV&&prevFlipH){values=["false","false",(newRotation+180)%360];}else{values=[String(prevFlipH),String(prevFlipV),newRotation];
if(Math.abs(newRotation-prevRotation)%180!==0){var w=parseInt(this.$applyBindRule("width",xmlNode))||0,h=parseInt(this.$applyBindRule("height",xmlNode))||0;
names.push("width","height");values.push(h,w);}}this.$executeMulticallAction("rotate",names,xmlNode,values);
};this.flipVertical=function(xmlNode,newFlipV){var prevFlipH=this.$applyBindRule("fliph",xmlNode)=="true"?true:false,prevRotate=this.$applyBindRule("rotation",xmlNode)?parseInt(this.$applyBindRule("rotation",xmlNode)):0;
var values=prevFlipH&&newFlipV?["false","false",(prevRotate+180)%360]:[String(prevFlipH),String(newFlipV),prevRotate];
this.$executeMulticallAction("verticalFlip",["fliph","flipv","rotation"],xmlNode,values);
};this.flipHorizontal=function(xmlNode,newFlipH){var prevFlipV=this.$applyBindRule("flipv",xmlNode)=="true"?true:false,prevRotate=this.$applyBindRule("rotation",xmlNode)?parseInt(this.$applyBindRule("rotation",xmlNode)):0;
var values=prevFlipV&&newFlipH?["false","false",(prevRotate+180)%360]:[String(newFlipH),String(prevFlipV),prevRotate];
this.$executeMulticallAction("horizontalFlip",["fliph","flipv","rotation"],xmlNode,values);
};this.resize=function(xmlNode,newWidth,newHeight,newTop,newLeft){this.$executeMulticallAction("resize",["top","left","width","height"],xmlNode,[newTop,newLeft,newWidth,newHeight]);
};this.$executeMulticallAction=function(atName,setNames,xmlNode,values){var i,node,value,atAction,args,changes=[],l=setNames.length;
for(i=0;i<l;i++){node=this.$getDataNode(setNames[i],xmlNode,this.$createModel);
value=values[i];if(node){atAction=node.nodeType==1||node.nodeType==3||node.nodeType==4?"setTextNode":"setAttribute";
args=node.nodeType==1?[node,value]:(node.nodeType==3||node.nodeType==4?[node.parentNode,value]:[node.ownerElement||node.selectSingleNode(".."),node.nodeName,value]);
changes.push({action:atAction,args:args});}}this.$executeAction("multicall",changes,atName,xmlNode);
};this.addConnector=function(sXmlNode,sInput,dXmlNode,dInput){var nXmlNode=this.xmlRoot.ownerDocument.createElement("connection");
nXmlNode.setAttribute("ref",this.$applyBindRule("id",dXmlNode));nXmlNode.setAttribute("output",sInput);
nXmlNode.setAttribute("input",dInput);this.$executeAction("appendChild",[sXmlNode,nXmlNode],"addConnector",sXmlNode);
};this.removeConnectors=function(xmlNodeArray){var changes=[],i=0,l=xmlNodeArray.length;
for(;i<l;i++){changes.push({action:"removeNode",args:[xmlNodeArray[i]]});}this.$executeAction("multicall",changes,"removeConnectors",xmlNodeArray[0]);
};this.addBlock=function(type,left,top,caption){if(!type){return;}var elTemplate=this.$flowVars.template.selectSingleNode("//element[@type='"+type+"']");
if(!elTemplate){return;}var nXmlNode=this.xmlRoot.ownerDocument.createElement("block");
nXmlNode.setAttribute("id","b"+(this.$flowVars.lastBlockId+1));nXmlNode.setAttribute("left",left||20);
nXmlNode.setAttribute("top",top||20);nXmlNode.setAttribute("width",elTemplate.getAttribute("dwidth"));
nXmlNode.setAttribute("height",elTemplate.getAttribute("dheight"));nXmlNode.setAttribute("type",type);
nXmlNode.setAttribute("caption",caption);this.$executeAction("appendChild",[this.xmlRoot,nXmlNode],"addBlock",this.xmlRoot);
};this.removeBlocks=function(xmlNodeArray){var id,id2,j,k,changes=[],ids=[],i=0,l=xmlNodeArray.length;
for(;i<l;i++){id=this.$applyBindRule("id",xmlNodeArray[i]);ids.push(id);changes.push({action:"removeNode",args:[xmlNodeArray[i]]});
}for(id2 in this.$flowVars.xmlConnections){for(j=this.$flowVars.xmlConnections[id2].length-1;
j>=0;j--){for(k=0,l=ids.length;k<l;k++){if(this.$flowVars.xmlConnections[id2][j].ref==ids[k]){changes.push({action:"removeNode",args:[this.$flowVars.xmlConnections[id2][j].xmlNode]});
}}}}this.$executeAction("multicall",changes,"removeBlocksWithConnections",xmlNodeArray);
};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
this.objCanvas=new apf.flow.getCanvas(this.$int);apf.flow.init();};this.$deInitNode=function(xmlNode,htmlNode){var id=this.$applyBindRule("id",xmlNode);
this.$flowVars.objBlocks[id].destroy();delete this.$flowVars.objBlocks[id];delete this.$flowVars.xmlBlocks[id];
htmlNode.parentNode.removeChild(htmlNode);this.$flowVars.resizeManager.hide();};
this.addEventListener("dragdrop",function(e){var blockPos=apf.getAbsolutePosition(e.indicator),canvasPos=apf.getAbsolutePosition(this.objCanvas.htmlElement);
apf.setNodeValue(this.$getDataNode("top",e.data[0],true),parseInt(e.top)-canvasPos[1]);
apf.setNodeValue(this.$getDataNode("left",e.data[0],true),blockPos[0]-canvasPos[0]);
});this.$updateModifier=function(xmlNode,htmlNode){apf.console.info("UPDATE");var fv=this.$flowVars,blockId=this.$applyBindRule("id",xmlNode),objBlock=fv.objBlocks[blockId],t=parseInt(this.$applyBindRule("top",xmlNode))?this.$applyBindRule("top",xmlNode):parseInt(objBlock.htmlElement.style.top),l=parseInt(this.$applyBindRule("left",xmlNode))?this.$applyBindRule("left",xmlNode):parseInt(objBlock.htmlElement.style.left);
objBlock.moveTo(t,l);var w=parseInt(this.$applyBindRule("width",xmlNode))?this.$applyBindRule("width",xmlNode):objBlock.other.dwidth,h=parseInt(this.$applyBindRule("height",xmlNode))?this.$applyBindRule("height",xmlNode):objBlock.other.dheight;
objBlock.resize(w,h);objBlock.setCaption(this.$applyBindRule("caption",xmlNode));
var lock=this.$applyBindRule("lock",xmlNode)=="true"?true:false;objBlock.setLock(lock);
objBlock.changeRotation(this.$applyBindRule("rotation",xmlNode),this.$applyBindRule("fliph",xmlNode),this.$applyBindRule("flipv",xmlNode));
var j,l2,found,ref,output,input,label,type,cNew=this.$getDataNode("connection",xmlNode,null,null,true),cCurrent=fv.xmlConnections[blockId]||[],i=0;
l=cCurrent.length;if(cCurrent.length){for(;i<l;i++){for(j=0,found=false,l2=cNew.length;
j<l2;j++){if(cCurrent[i].xmlNode==cNew[j]){found=true;break;}}if(!found){if(fv.objBlocks[blockId]&&fv.objBlocks[cCurrent[i].ref]){var ConToDel=apf.flow.findConnector(fv.objBlocks[blockId],cCurrent[i].output,fv.objBlocks[cCurrent[i].ref],cCurrent[i].input);
if(ConToDel){apf.flow.removeConnector(ConToDel.connector.htmlElement);}fv.xmlConnections[blockId].removeIndex(i);
}}}}else{delete fv.xmlConnections[blockId];}for(i=0,l=cNew.length;i<l;i++){found=false;
if(cCurrent){for(j=0,l2=cCurrent.length;j<l2;j++){if(cCurrent[j].xmlNode==cNew[i]){found=true;
break;}}}if(!found){ref=this.$applyBindRule("ref",cNew[i]),output=this.$applyBindRule("blockoutput",cNew[i]),input=this.$applyBindRule("blockinput",cNew[i]),label=this.$applyBindRule("blocklabel",cNew[i]),type=this.$applyBindRule("type",cNew[i]);
if(fv.xmlBlocks[ref]){var r=fv.xmlConnections[blockId]||[];r.push({ref:ref,output:output,input:input,label:label,type:type,xmlNode:cNew[i]});
new apf.flow.addConnector(this.objCanvas,fv.objBlocks[blockId],fv.objBlocks[ref],{output:output,input:input,label:label,type:type,xmlNode:cNew[i]});
fv.xmlConnections[blockId]=r;}else{apf.console.info("Destination block doesn't exist.");
}}}if(fv.resizeManager&&xmlNode==this.selected&&!lock){fv.resizeManager.show();
}else{fv.resizeManager.hide();}objBlock.updateOutputs();objBlock.onMove();};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){this.$flowVars.lastBlockId++;
apf.console.info("ADD");this.$getNewContext("item");var block=this.$getLayoutNode("item"),elSelect=this.$getLayoutNode("item","select"),elImage=this.$getLayoutNode("item","image"),elimageContainer=this.$getLayoutNode("item","imagecontainer"),elCaption=this.$getLayoutNode("item","caption");
if(elCaption){elCaption.setAttribute("ondblclick","apf.lookup("+this.$uniqueId+").$beforeRename(event, true); return false;");
}this.nodes.push(block);var style=[],style2=[],_style,k,l,left=this.$applyBindRule("left",xmlNode)||0,top=this.$applyBindRule("top",xmlNode)||0,zindex=this.$applyBindRule("zindex",xmlNode)||1001;
if(this.snap){left=Math.round(left/this.gridW)*this.gridW;top=Math.round(top/this.gridH)*this.gridH;
}style.push("z-index:"+zindex);style.push("left:"+left+"px");style.push("top:"+top+"px");
if(this.$flowVars.template){var elTemplate=this.$flowVars.template.selectSingleNode("//element[@type='"+this.$applyBindRule("type",xmlNode)+"']");
if(elTemplate){var stylesFromTemplate=elTemplate.getAttribute("css");if(stylesFromTemplate){stylesFromTemplate=stylesFromTemplate.split(";");
for(k=0,l=stylesFromTemplate.length;k<l;k++){_style=stylesFromTemplate[k].trim();
if(_style!==""){if(_style.substr(0,5)=="color"&&elCaption){elCaption.setAttribute("style",[_style].join(";"));
}else{style.push(_style);}}}}var w=elTemplate.getAttribute("dwidth"),h=elTemplate.getAttribute("dheight");
}}if(this.$applyBindRule("id",xmlNode)){var _id=this.$applyBindRule("id",xmlNode).substr(1);
if(_id>this.$flowVars.lastBlockId){this.$flowVars.lastBlockId=_id;}}var id=this.$applyBindRule("id",xmlNode)||"b"+this.$flowVars.lastBlockId,width=this.$applyBindRule("width",xmlNode)||w||56,height=this.$applyBindRule("height",xmlNode)||h||56,lock=this.$applyBindRule("lock",xmlNode)||"false",capPos=this.$applyBindRule("cap-pos",xmlNode)||"outside";
style.push("width:"+width+"px");style.push("height:"+height+"px");block.setAttribute("style",style.join(";"));
style2.push("width:"+width+"px");style2.push("height:"+height+"px");elImage.setAttribute("style",style2.join(";"));
elimageContainer.setAttribute("style",style2.join(";"));xmlNode.setAttribute("id",id);
xmlNode.setAttribute("width",width);xmlNode.setAttribute("height",height);xmlNode.setAttribute("lock",lock);
xmlNode.setAttribute("left",left);xmlNode.setAttribute("top",top);xmlNode.setAttribute("zindex",zindex);
xmlNode.setAttribute("cap-pos",capPos);if(elCaption){this.$setStyleClass(elCaption,capPos);
}elSelect.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey)");
apf.xmldb.nodeConnect(this.documentId,xmlNode,block,this);this.$flowVars.xmlBlocks[id]=xmlNode;
var r=[],i,connections=this.$getDataNode("connection",xmlNode,null,null,true);for(i=0,l=connections.length;
i<l;i++){r.push({ref:this.$applyBindRule("ref",connections[i]),output:this.$applyBindRule("blockoutput",connections[i]),input:this.$applyBindRule("blockinput",connections[i]),label:this.$applyBindRule("blocklabel",connections[i]),type:this.$applyBindRule("type",connections[i]),xmlNode:connections[i]});
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass){this.$setStyleClass(block,cssClass);
if(cssClass){this.$dynCssClasses.push(cssClass);}}if(r.length>0){this.$flowVars.xmlConnections[id]=r;
}};this.$fill=function(){apf.insertHtmlNodes(this.nodes,this.$int);apf.console.info("FILL");
var id,i,l,fv=this.$flowVars;for(id in fv.xmlBlocks){var xmlBlock=fv.xmlBlocks[id],htmlElement=apf.xmldb.findHtmlNode(xmlBlock,this),type=this.$flowVars.xmlBlocks[id].getAttribute("type")||null,inputList={};
if(type){if(fv.template){var elTemplate=fv.template.selectSingleNode("element[@type='"+this.$applyBindRule("type",xmlBlock)+"']");
if(elTemplate){var inputs=elTemplate.selectNodes("input");if(inputs){for(i=0,l=inputs.length;
i<l;i++){inputList[parseInt(inputs[i].getAttribute("name"))]={x:parseInt(inputs[i].getAttribute("x")),y:parseInt(inputs[i].getAttribute("y")),position:inputs[i].getAttribute("position")};
}}}}}var lock=this.$applyBindRule("lock",xmlBlock)=="true"?true:false;var other={};
other.lock=lock;other.flipv=this.$applyBindRule("flipv",xmlBlock)=="true"?true:false;
other.fliph=this.$applyBindRule("fliph",xmlBlock)=="true"?true:false;other.rotation=parseInt(this.$applyBindRule("rotation",xmlBlock))||0;
other.inputList=inputList;other.type=type;other.picture=type&&fv.template&&elTemplate?elTemplate.getAttribute("picture"):null;
other.dwidth=type&&fv.template&&elTemplate?parseInt(elTemplate.getAttribute("dwidth")):56;
other.dheight=type&&fv.template&&elTemplate?parseInt(elTemplate.getAttribute("dheight")):56;
other.scalex=type&&fv.template&&elTemplate?(elTemplate.getAttribute("scalex")=="true"?true:false):true;
other.scaley=type&&fv.template&&elTemplate?(elTemplate.getAttribute("scaley")=="true"?true:false):true;
other.scaleratio=type&&fv.template&&elTemplate?(elTemplate.getAttribute("scaleratio")=="true"?true:false):false;
other.xmlNode=xmlBlock;other.caption=this.$applyBindRule("caption",xmlBlock);other.capPos=this.$applyBindRule("cap-pos",xmlBlock);
var objBlock=apf.flow.isBlock(htmlElement);var _self=this;if(objBlock){this.$setStyleClass(htmlElement,"",["empty"]);
objBlock.other=other;objBlock.initBlock();}else{objBlock=apf.flow.addBlock(htmlElement,this.objCanvas,other);
if(objBlock){objBlock.oncreateconnection=function(sXmlNode,sInput,dXmlNode,dInput){_self.addConnector(sXmlNode,sInput,dXmlNode,dInput);
};objBlock.onremoveconnection=function(xmlNodeArray){_self.removeConnectors(xmlNodeArray);
};fv.objBlocks[id]=objBlock;}}}for(id in fv.xmlBlocks){var c=fv.xmlConnections[id]||[];
for(i=0,l=c.length;i<l;i++){var con=apf.flow.findConnector(fv.objBlocks[id],c[i].output,fv.objBlocks[c[i].ref],c[i].input);
if(!con){if(fv.objBlocks[id]&&fv.objBlocks[c[i].ref]){fv.objBlocks[id].onMove();
new apf.flow.addConnector(this.objCanvas,fv.objBlocks[id],fv.objBlocks[c[i].ref],{output:c[i].output,input:c[i].input,label:c[i].label,type:c[i].type,xmlNode:c[i].xmlNode});
}else{fv.connToPaint.push({id:id,id2:c[i].ref,output:c[i].output,input:c[i].input,label:c[i].label,type:c[i].type,xmlNode:c[i].xmlNode});
}}else{con.connector.other={output:c[i].output,input:c[i].input,label:c[i].label,type:c[i].type,xmlNode:c[i].xmlNode};
con.connector.activateInputs();con.connector.draw();}}}for(i=fv.connToPaint.length-1;
i>=0;i--){if(fv.objBlocks[fv.connToPaint[i].id]&&fv.objBlocks[fv.connToPaint[i].id2]){new apf.flow.addConnector(this.objCanvas,fv.objBlocks[fv.connToPaint[i].id],fv.objBlocks[fv.connToPaint[i].id2],{output:fv.connToPaint[i].output,input:fv.connToPaint[i].input,label:fv.connToPaint[i].label,type:fv.connToPaint[i].type,xmlNode:fv.connToPaint[i].xmlNode});
fv.connToPaint.removeIndex(i);}}this.nodes=[];if(!this.objCanvas.scrollPointer){this.objCanvas.addScrollPointer();
}};this.$destroy=function(){};this.$loadAml=function(x){apf.getData(this.getAttribute("template"),{callback:function(data,state,extra){if(state==apf.SUCCESS){_self.loadTemplate(data);
}else{apf.console.info("An error has occurred: "+extra.message,2);return;}}});var _self=this,fv=this.$flowVars;
fv.resizeManager=new apf.resize();fv.resizeManager.onresizedone=function(w,h,t,l){_self.resize(_self.selected,w,h,t,l);
};fv.resizeManager.onresize=function(htmlElement,t,l,w,h){if(!htmlElement){return;
}var objBlock=apf.flow.isBlock(htmlElement);objBlock.moveTo(t,l);objBlock.resize(w,h);
objBlock.updateOutputs();objBlock.onMove();};apf.flow.onaftermove=function(dt,dl){_self.moveTo(_self.selected,dl,dt);
};apf.flow.onblockmove=function(){fv.resizeManager.show();};};this.loadTemplate=function(xmlRootNode){if(typeof xmlRootNode!="object"){xmlRootNode=apf.getXmlDom(xmlRootNode);
}if(xmlRootNode.nodeType==9){xmlRootNode=xmlRootNode.documentElement;}if(xmlRootNode.nodeType==3||xmlRootNode.nodeType==4){xmlRootNode=xmlRootNode.parentNode;
}if(xmlRootNode.nodeType==2){xmlRootNode=xmlRootNode.ownerElement||xmlRootNode.parentNode||xmlRootNode.selectSingleNode("..");
}this.$flowVars.template=xmlRootNode;this.$checkLoadQueue();};this.$canLoadData=function(){return this.$flowVars.template?true:false;
};}).call(apf.flowchart.prototype=new apf.BaseList());apf.aml.setElement("flowchart",apf.flowchart);
apf.aml.setElement("resize",apf.BindingRule);apf.aml.setElement("left",apf.BindingRule);
apf.aml.setElement("top",apf.BindingRule);apf.aml.setElement("id",apf.BindingRule);
apf.aml.setElement("width",apf.BindingRule);apf.aml.setElement("height",apf.BindingRule);
apf.aml.setElement("flipv",apf.BindingRule);apf.aml.setElement("fliph",apf.BindingRule);
apf.aml.setElement("rotation",apf.BindingRule);apf.aml.setElement("lock",apf.BindingRule);
apf.aml.setElement("type",apf.BindingRule);apf.aml.setElement("cap-pos",apf.BindingRule);
apf.aml.setElement("zindex",apf.BindingRule);apf.aml.setElement("connection",apf.BindingRule);
apf.aml.setElement("ref",apf.BindingRule);apf.aml.setElement("blockoutput",apf.BindingRule);
apf.aml.setElement("blockinput",apf.BindingRule);apf.aml.setElement("blocklabel",apf.BindingRule);
apf.panel=function(struct,tagName){this.$init(tagName||"panel",apf.NODE_VISIBLE,struct);
};apf.fieldset=function(struct,tagName){this.$init(tagName||"fieldset",apf.NODE_VISIBLE,struct);
};apf.frame=function(struct,tagName){this.$init(tagName||"submit",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.BaseStateButtons);this.$focussable=false;this.$editableCaption=["caption"];
this.$supportedProperties.push("caption","url");this.$propHandlers.caption=function(value){if(!this.oCaption){return;
}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=value;}else{this.oCaption.nodeValue=value;
}};this.$propHandlers.icon=function(value){var oIcon=this.$getLayoutNode("main","icon",this.$ext);
if(!oIcon){return;}if(oIcon.nodeType==1){oIcon.style.display=value?"block":"none";
}apf.skins.setIcon(oIcon,value,this.iconPath);};this.$propHandlers.url=function(value){var node=this.oCaption;
if(node.tagName=="A"||node.nodeType!=1){node=node.parentNode;}node.innerHTML="<a href='"+value+"' "+(value.match(/^http:\/\//)?"target='_blank'":"")+">"+this.caption+"</a>";
this.oCaption=this.oCaption.firstChild;};this.setTitle=function(value){this.setProperty("title",value);
};this.$draw=function(){this.$ext=this.$getExternal(null,null,function(oExt){this.$initButtons(oExt);
});this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$int=this.$getLayoutNode("main","container",this.$ext);
this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);};this.$loadAml=function(x){};
}).call(apf.frame.prototype=new apf.Presentation());apf.panel.prototype=apf.fieldset.prototype=apf.frame.prototype;
apf.aml.setElement("panel",apf.panel);apf.aml.setElement("fieldset",apf.fieldset);
apf.aml.setElement("frame",apf.frame);apf.gallery=function(struct,tagName){this.$init(tagName||"gallery",apf.NODE_VISIBLE,struct);
this.imageheight="auto";this.defaultthumb=null;this.defaultimage=null;this.scalewidth=false;
this.zoomIcon=false;this.previous=null,this.next=null,this.current=null,this.last=null;
this.thumbnailMode="grid";this.title="text";this.nodes=[];this.tmrRefresh=null;
this.tmrSlide=null;this.stepShow=apf.isIE?10:15;this.stepShowFast=apf.isIE?5:8;
this.stepSlide=apf.isIE?25:30;this.stepHide=apf.isIE?5:7;this.intSSlide=apf.isIE?2:10;
this.imageStack={};this.isOnStack=false;this.noThumbArrows=false;this.mediaType=null;
this.supportedMediaTypes=["image","flash"];};(function(){this.$supportedProperties.push("thumbheight","imageheight","scalewidth","defaultthumb","defaultimage","thumb-mode","title","zoom-icon");
this.$booleanProperties.scalewidth=true;this.$booleanProperties["zoom-icon"]=true;
this.$propHandlers["zoom-icon"]=function(value){this.zoomIcon=value;this.$oZoomIcon.style.display=this.zoomIcon?"block":"none";
};this.$propHandlers.imageheight=function(value){this.imageheight=value=="auto"?"auto":parseInt(value);
};this.$propHandlers["thumb-mode"]=function(value){this.thumbnailMode=value;this.$setStyleClass(this.$ext,value+"Mode",["barMode","gridMode"]);
};this.isSupportedType=function(type){for(var i=0,l=this.supportedMediaTypes.length;
i<l;i++){if(type==this.supportedMediaTypes[i]){return true;}}return false;};this.$setSiblings=function(){var temp_n=this.getNextTraverse(this.current),temp_p=this.getNextTraverse(this.current,true);
this.next=temp_n?temp_n:this.getFirstTraverseNode();this.previous=temp_p?temp_p:this.getLastTraverseNode();
};this.show=function(){this.$show();};this.hide=function(){};this.calcThumbBarSize=function(){var nodes=this.$oThumbs.childNodes;
var nodes_len=nodes.length;var thumbBarSize=0;for(var i=0;i<nodes_len;i++){if((nodes[i].className||"").indexOf("thumbnail")>-1){thumbBarSize+=nodes[i].offsetWidth+apf.getMargin(nodes[i])[0];
}}this.$oThumbs.style.width=thumbBarSize+"px";this.noThumbArrows=this.$oThumbs.offsetWidth<this.$oThumbs.parentNode.offsetWidth?true:false;
if(this.noThumbArrows){this.$setStyleClass(this.$oBar,"noArrows",null);}else{this.$setStyleClass(this.$oBar,"",["noArrows"]);
}this.calculateRange();};this.initiateThumbnailEvents=function(){var thumbs=this.$oThumbs.childNodes;
var thumbs_len=thumbs.length;var _self=this;var tHeight,tWidth=null;var iHeight,iWidth;
for(var i=0;i<thumbs_len;i++){if((thumbs[i].className||"").indexOf("thumbnail")>-1){if(tHeight==null||tHeight<=0){tHeight=(thumbs[i].offsetHeight||parseInt(thumbs[i].height))-apf.getVerBorders(thumbs[i]);
}thumbs[i].onmouseover=function(e){_self.$hoverThumb(e,this);};thumbs[i].onmouseout=function(e){_self.$hoverThumb(e,this);
};var images=thumbs[i].childNodes;images_len=images.length;for(var j=0;j<images_len;
j++){if((images[j].tagName||"").toLowerCase()=="img"){iHeight=images[j].offsetHeight||images[j].height;
iWidth=images[j].offsetWidth||images[j].width;if(iHeight>0&&iWidth>0&&tHeight>0){images[j].style.height=tHeight+"px";
images[j].parentNode.style.width=images[j].style.width=parseInt(iWidth*tHeight/iHeight)+"px";
}else{images[j].onload=function(){iHeight=this.offsetHeight||this.height;iWidth=this.offsetWidth||this.width;
if(iHeight>0&&iWidth>0&&tHeight>0){this.style.height=tHeight+"px";if(this.parentNode){this.parentNode.style.width=this.style.width=parseInt(iWidth*tHeight/iHeight)+"px";
}}};}}}}}if(_self.thumbnailMode=="bar"){_self.calcThumbBarSize();}};this.$hoverThumb=function(e,htmlElement){e=e||event;
var target=e.target||e.srcElement;var from=e.type=="mouseover"?0.7:1;var to=e.type=="mouseover"?1:0.7;
if(apf.isChildOf(htmlElement,target,false)){if((htmlElement.className||"").indexOf("selected")>-1){return;
}apf.tween.single(htmlElement,{steps:10,type:"fade",from:from,to:to});}};this.loading=false;
this.$show=function(){var _self=this;this.$showLoader();if(this.imageheight!=="auto"){this.$oImageContainer.style.height=this.$oViewport.style.height=this.imageheight+"px";
}this.initiateThumbnailEvents();if(this.thumbnailMode=="bar"){this.calcThumbBarSize();
}this.$oImage.onload=function(){_self.$hideLoader();_self.$oImageBase.src=_self.$oImage.src;
_self.last=_self.current;_self.$setSiblings();_self.$oImageBase.style.display="block";
var imgWidth=_self.$oImageBase.offsetWidth||_self.$oImageBase.width;var imgHeight=_self.$oImageBase.offsetHeight||_self.$oImageBase.height;
_self.$oImageBase.style.display="none";if(_self.imageheight!=="auto"){var vpWidth=_self.$oViewport.offsetWidth;
var vpHeight=_self.$oViewport.offsetHeight;var nHeight=imgHeight,nWidth=imgWidth;
if(nHeight>vpHeight){nWidth=parseInt(imgWidth*(vpHeight/nHeight));nHeight=vpHeight;
}if(nWidth>vpWidth){nHeight=parseInt(nHeight*(vpWidth/nWidth));nWidth=vpWidth;}if(nWidth>0&&nHeight>0){_self.$oImage.style.width=nWidth+"px";
_self.$oImage.style.height=nHeight+"px";_self.$oImage.style.marginTop=parseInt((vpHeight-nHeight)/2)+"px";
_self.$oImage.style.marginLeft=parseInt((vpWidth-nWidth)/2)+"px";}}else{if(imgWidth>0&&imgHeight>0){_self.$oImageContainer.style.width=imgWidth+"px";
_self.$oImageContainer.style.height=imgHeight+"px";}_self.$oImageContainer.style.margin="0 auto";
}_self.$oImage.style.display="block";if(!_self.isOnStack){apf.tween.single(_self.$oImage,{steps:_self.stepShow,type:"fade",anim:apf.tween.NORMAL,from:0,to:1,onfinish:function(){_self.loading=false;
}});}else{if(apf.isIE){_self.$oImage.style.filter="alpha(opacity=100)";}else{_self.$oImage.style.opacity=1;
}_self.loading=false;}_self.imageStack[_self.$applyBindRule("src",_self.current)]=true;
};};this.$showVideo=function(){this.$oImage.style.display="none";this.$hideLoader();
this.last=this.current;this.$setSiblings();if(this.mediaType=="flash"){var vpWidth=this.$oViewport.offsetWidth;
var vpHeight=this.$oViewport.offsetHeight;this.$oMedia.style.width=vpWidth+"px";
this.$oMedia.style.height=vpHeight+"px";this.$oMedia.style.display="block";if(!this.isOnStack){var _self=this;
apf.tween.single(this.$oMedia,{steps:_self.stepShow,type:"fade",anim:apf.tween.NORMAL,from:0,to:1,onfinish:function(){_self.loading=false;
}});}else{this.$oMedia.style.filter="alpha(opacity=100)";this.$oMedia.style.opacity=1;
this.loading=false;}}this.imageStack[this.$applyBindRule("src",this.current)]=true;
};this.$refresh=function(){this.isOnStack=this.imageStack[this.$applyBindRule("src",this.current)]?true:false;
if(!this.isOnStack){this.$showLoader();}var _self=this;clearTimeout(this.tmrRefresh);
_self.tmrRefresh=window.setTimeout(function(){clearTimeout(_self.tmrRefresh);if(_self.$amlDestroyed){return;
}if(!_self.isOnStack){apf.tween.single(_self.mediaType=="image"?_self.$oMedia:_self.$oImage,{steps:_self.stepHide,type:"fade",anim:apf.tween.NORMAL,from:1,to:0,onfinish:function(){_self.setImagePath(_self.current);
if(_self.mediaType!=="image"){_self.$showVideo();}else{_self.$oMedia.style.display="none";
}}});}else{_self.setImagePath(_self.current);if(_self.mediaType!=="image"){_self.$showVideo();
}else{_self.$oMedia.style.display="none";}}},apf.isIE?80:100);};this.setDescription=function(xmlNode){var title=this.$applyBindRule("caption",xmlNode||this.current);
switch(this.title){case"text":var descr=title||"No description";break;case"number+text":case"text+number":var part1=(apf.language.getWord("sub/slideshow/image")||"Image")+" "+(this.getPos()+1)+" "+(apf.language.getWord("sub/slideshow/of")||"of")+" "+this.getTraverseNodes().length;
var part2=title||this.defaulttitle||apf.language.getWord("sub/slideshow/defaulttitle")||"No description";
var descr="<b>"+part1+"</b><br />"+part2;break;default:var descr=apf.language.getWord("sub/slideshow/image")||"Image "+(this.getPos()+1)+" "+(apf.language.getWord("sub/slideshow/of")||"of")+" "+this.getTraverseNodes().length;
break;}this.$oDescr.innerHTML=descr;};this.getPos=function(){return Array.prototype.indexOf.call(this.getTraverseNodes(),this.current);
};this.setImagePath=function(xmlNode){var src=this.$applyBindRule("src",xmlNode);
if(this.mediaType=="image"){this.$oImage.src=src||this.defaultimage||this.defaultthumb;
}else{if(this.mediaType=="flash"){this.loadMedia(this.mediaType,src);}else{alert("Not supported media type.");
}}};this.loadMedia=function(mediaType,data){this.$oMedia.innerHTML=data;};this.$next=function(){this.select(this.current=this.next);
};this.$previous=function(){this.select(this.current=this.previous);};this.centerThumbnail=function(xmlNode){var htmlNode=apf.xmldb.findHtmlNode(xmlNode,this);
if(!htmlNode||this.noThumbArrows){return;}var oLeft=htmlNode.offsetLeft;var oWidth=htmlNode.offsetWidth;
var _self=this;var ocLeft=this.$oThumbs.offsetLeft;if(htmlNode==this.$oThumbs.firstChild&&ocLeft==0){return;
}var tCenteredPos=-1*oLeft-parseInt((oWidth+apf.getMargin(htmlNode)[0])/2);var vpCenteredPos=parseInt(this.$oThumbs.parentNode.offsetWidth/2);
var newLeft=tCenteredPos+this.maxLeft+vpCenteredPos;newLeft=newLeft>this.maxLeft?this.maxLeft:(newLeft<this.minLeft?this.minLeft:newLeft);
apf.tween.single(this.$oThumbs,{steps:15,type:"left",anim:apf.tween.EASEOUT,from:ocLeft,to:newLeft,onfinish:function(){}});
};this.isLoaderActive=false;this.$showLoader=function(){if(this.isLoaderActive){return;
}this.isLoaderActive=true;this.$oLoader.style.display="block";apf.tween.single(this.$oLoader,{steps:6,type:"fade",from:0,to:1});
};this.$hideLoader=function(){this.$oLoader.style.display="none";this.isLoaderActive=false;
};this.$removeFilters=function(){this.$oLoader.style.filter="";};this.addEventListener("$clear",function(){return false;
});this.addEventListener("afterload",function(){this.$setStyleClass(this.$ext,this.$baseCSSname+this.thumbnailMode+"Mode");
this.imageStack={};this.$show();});this.addEventListener("beforeselect",function(e){if(this.loading){return false;
}if(e.selected){this.current=e.selected;}var mediaType=this.$applyBindRule("mediatype",this.current);
this.mediaType=this.isSupportedType(mediaType)?mediaType:"image";});this.addEventListener("afterselect",function(e){if(this.thumbnailMode=="bar"){this.centerThumbnail(this.current);
}this.loading=true;if(this.$oZoomIcon){if(this.mediaType=="image"){var _self=this;
var url=this.$applyBindRule("url",this.current);this.$oZoomIcon.onclick=function(){_self.dispatchEvent("zoomclick",{url:url,selected:_self.current});
if(url){window.location.href=url;}};}}this.setDescription();this.$refresh();});
this.$resize=function(){};this.calculateRange=function(){this.maxLeft=this.$oThumbs.offsetLeft;
this.minLeft=-1*(this.$oThumbs.offsetWidth-this.$oThumbs.parentNode.offsetWidth);
};this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");
this.$ext=this.$getExternal(null,null,function(oExt){});this.$oImageContainer=this.$getLayoutNode("main","image_container",this.$ext);
this.$oViewport=this.$getLayoutNode("main","viewport",this.$ext);this.$oZoomIcon=this.$getLayoutNode("main","zoom_icon",this.$ext);
this.$oImage=this.$getLayoutNode("main","image",this.$ext);this.$oImageBase=this.$getLayoutNode("main","image_base",this.$ext);
this.$oNext=this.$getLayoutNode("main","next",this.$ext);this.$oPrevious=this.$getLayoutNode("main","previous",this.$ext);
this.$oBar=this.$getLayoutNode("main","bar",this.$ext);this.$oDescr=this.$getLayoutNode("main","descr",this.$ext);
this.$oLoader=this.$getLayoutNode("main","loader",this.$ext);this.$oThumbs=this.$getLayoutNode("main","thumbs",this.$ext);
this.$container=this.$oThumbs;this.$oArrowPrev=this.$getLayoutNode("main","arrow_prev",this.$ext);
this.$oArrowNext=this.$getLayoutNode("main","arrow_next",this.$ext);this.$oMedia=this.$getLayoutNode("main","media",this.$ext);
var rules="var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()";
apf.layout.setRules(this.$pHtmlNode,this.$uniqueId+"_scaling",rules,true);apf.layout.queue(this.$pHtmlNode);
var _self=this;this.$oNext.onclick=function(){_self.$next();};this.$oPrevious.onclick=function(){_self.$previous();
};this.calculateRange();this.slideFinish=true;this.$oArrowPrev.onmouseover=function(){if(_self.noThumbArrows){return;
}clearTimeout(_self.tmrSlide);_self.tmrSlide=window.setTimeout(function(){var oLeft=_self.$oThumbs.offsetLeft;
if(oLeft+1>_self.minLeft&&oLeft<_self.maxLeft){_self.$oThumbs.style.left=(oLeft+1)+"px";
}},_self.intSSlide);};this.$oArrowPrev.onmouseout=function(){clearTimeout(_self.tmrSlide);
};this.$oArrowNext.onmouseover=function(){if(_self.noThumbArrows){return;}clearTimeout(_self.tmrSlide);
_self.tmrSlide=window.setTimeout(function(){var oLeft=_self.$oThumbs.offsetLeft;
if(oLeft>_self.minLeft&&oLeft-1<_self.maxLeft){_self.$oThumbs.style.left=(oLeft-1)+"px";
}},_self.intSSlide);};this.$oArrowNext.onmouseout=function(){clearTimeout(_self.tmrSlide);
};this.$oArrowPrev.onclick=function(){if(!_self.slideFinish||_self.noThumbArrows){return;
}_self.slideFinish=false;var oLeft=_self.$oThumbs.offsetLeft;var newLeft=oLeft+200>_self.maxLeft?_self.maxLeft:oLeft+200;
apf.tween.single(_self.$oThumbs,{steps:_self.stepSlide,type:"left",anim:apf.tween.EASEOUT,from:oLeft,to:newLeft,onfinish:function(){_self.slideFinish=true;
}});};this.$oArrowNext.onclick=function(){if(!_self.slideFinish||_self.noThumbArrows){return;
}_self.slideFinish=false;var oLeft=_self.$oThumbs.offsetLeft;var newLeft=oLeft-200<_self.minLeft?_self.minLeft:oLeft-200;
apf.tween.single(_self.$oThumbs,{steps:_self.stepSlide,type:"left",anim:apf.tween.EASEOUT,from:oLeft,to:newLeft,onfinish:function(){_self.slideFinish=true;
}});};this.arrowsAreVisible=false;this.arrowsVisible;this.arrowsInvisible;this.$oImage.onmouseover=function(e){e=e||event;
if(_self.arrowsAreVisible){return;}_self.arrowsVisible={stop:false};if(_self.arrowsInvisible){_self.arrowsInvisible.stop=true;
}_self.arrowsAreVisible=true;_self.$oNext.style.display="block";_self.$oPrevious.style.display="block";
apf.tween.multi(_self.$oNext,{steps:15,control:_self.arrowsVisible,anim:apf.tween.EASEOUT,tweens:[{type:"fade",from:apf.getOpacity(_self.$oNext),to:1},{type:"fade",from:apf.getOpacity(_self.$oPrevious),to:1,oHtml:_self.$oPrevious}],onfinish:function(){_self.$oNext.style.display="block";
_self.$oPrevious.style.display="block";_self.$oNext.style.filter="";_self.$oPrevious.style.filter="";
}});};this.$oImageContainer.onmouseout=function(e){e=e||event;var target=e.target||e.srcElement;
if(!_self.arrowsAreVisible){return;}target=e.toElement?e.toElement:(e.relatedTarget?e.relatedTarget:null);
if(apf.isChildOf(_self.$oImageContainer,target,true)){return;}_self.arrowsInvisible={stop:false};
if(_self.arrowsVisible){_self.arrowsVisible.stop=true;}_self.arrowsAreVisible=false;
apf.tween.multi(_self.$oNext,{steps:15,control:_self.arrowsInvisible,anim:apf.tween.EASEOUT,tweens:[{type:"fade",from:apf.getOpacity(_self.$oNext),to:0},{type:"fade",from:apf.getOpacity(_self.$oPrevious),to:0,oHtml:_self.$oPrevious}],onfinish:function(){_self.$oNext.style.display="none";
_self.$oPrevious.style.display="none";}});};if(apf.window.vManager.check(this,"gallery",this.initiateThumbnailEvents)){this.initiateThumbnailEvents();
}};}).call(apf.gallery.prototype=new apf.BaseList());apf.aml.setElement("gallery",apf.gallery);
apf.aml.setElement("url",apf.BindingRule);apf.aml.setElement("mediatype",apf.BindingRule);
apf.Graph=function(struct,tagName){this.$init(tagName||"graph",apf.NODE_VISIBLE,struct);
};apf.aml.setElement("graph",apf.Graph);(function(){this.$focussable=false;this.$drawCode=0;
this.$_style=null;this.$docompile=true;this.$doinit=true;this.style="";this.$microtime=0;
this.$datasource=null;this.$datamode=null;this.$datatype=null;this.dataslice="1X";
this.steps=100;this.$data=null;this.$tilex=0;this.$tiley=0;this.m={x:0,y:0};this.nc=0;
this.$styletag="";this.$propHandlers.left=this.$propHandlers.top=this.$propHandlers.width=this.$propHandlers.height=function(value){};
this.$propHandlers.series=function(value){var v_yval=this.v_yval=[];var v_xval=this.v_xval=[];
var v_zval=this.v_zval=[];var v_time=this.v_time=[];var v_caption=this.v_caption=[];
var v_class=this.v_class=[];var v_state=this.v_state=[];this.v_stateresolve=false;
var p,v,n,k,l,t=(new Date()).getTime()*0.001,css;var series,split,delim,caption,cls,formula,length,mip;
if(typeof value=="string"){series=value;split=",";delim=" ";css="#";caption=null;
}else{series=value.series;split=value.split;caption=value.caption;delim=value.delim;
css=value.css;formula=value.formula;length=value.length;}if(!series){return;}if(formula){var mdl=this.getModel();
if(!mdl.v_yval){var f=new Function("length","v_yval",apf.draw.baseMacro(["for(v = 0;v<length;v++){","v_yval[v] = ",[formula],";","}"]));
f(length,v_yval);mdl.v_yval=v_yval;}else{v_yval=mdl.v_yval;}if(this.mipstep>1){var step=this.mipstep;
var v_yvalmip=this.v_yvalmip=[v_yval];var newd=[],oldd=v_yval,i,j,v,n,m,c;switch(this.mipset){case"avg":while(oldd.length>10){v_yvalmip.push(newd);
for(j=0,n=0,m=oldd.length;n<m;n++){if(!(n%step)){if(n){newd[j++]=v/step;}v=oldd[n];
}else{v+=oldd[n];}}oldd=newd,newd=[];}break;case"add":while(oldd.length>10){v_yvalmip.push(newd);
for(j=0,n=0,m=oldd.length;n<m;n++){if(!(n%step)){if(n){newd[j++]=v;}v=oldd[n];}else{v+=oldd[n];
}}oldd=newd,newd=[];}break;case"min":while(oldd.length>10){v_yvalmip.push(newd);
for(j=0,n=0,m=oldd.length;n<m;n++){if(!(n%step)){if(n){newd[j++]=v;}v=oldd[n];}else{if(v>(c=oldd[n])){v=c;
}}}oldd=newd,newd=[];}break;case"max":while(oldd.length>10){v_yvalmip.push(newd);
for(j=0,n=0,m=oldd.length;n<m;n++){if(!(n%step)){if(n){newd[j++]=v;}v=oldd[n];}else{if(v<(c=oldd[n])){v=c;
}}}oldd=newd,newd=[];}break;}this.$datamode="series";}}else{p=series.split(delim);
for(v=0;v<p.length;v++){this.v_time[v]=t;n=p[v].split(css);this.v_state[v]=0;if(n.length>1){this.v_class[v]=n[1];
}if(caption){k=n[0].split(caption);if(k.length>1){v_caption[v]=k[1];}k=k[0].split(split);
}else{k=n[0].split(split);}var dim=1;if((l=k.length)>0){if(l==1){v_yval[v]=parseFloat(k[0]);
}else{if(l>=2){v_xval[v]=parseFloat(k[0]);v_yval[v]=parseFloat(k[1]);if(l>=3){v_zval[v]=parseFloat(k[2]);
}}}}}this.$datamode="series";}};this.$propHandlers.formula=function(value){this.pformula=apf.draw.parseJSS(value);
this.$datamode="math";this.$docompile=true;};this.$propHandlers.mode=function(value){this.$regenerate();
};this.$propHandlers.style=function(value){this.$regenerate();};this.$propHandlers.a=this.$propHandlers.b=this.$propHandlers.c=this.$propHandlers.d=function(value){this.$redraw();
};this.$redraw=function(now,resize){if(this.$parentChart){this.$parentChart.$redraw(now,resize);
}};this.$regenerate=function(){this.$_style=null;this.$docompile=true;};this.$drawGraph=function(v,doresize){if(this.$doinit){this.$doinit=false;
this.$parentAxis.$copySubPos(this);apf.draw.initLayer(this,this.$parentChart);}else{if(doresize){this.$parentAxis.$copySubPos(this);
apf.draw.resizeLayer(this,this.$parentChart);}}if(this.$docompile){if(!this.$datamode){return this.$redraw();
}this.$docompile=false;var err={};var mode=this.mode+this.$parentAxis.mode;if(!this.$_style){this.$_style=apf.draw.parseStyle(apf.chart_draw["_"+mode],this.style+this.$styletag,err);
}if(this.$_style.graph&&this.$_style.graph.$clslist&&this.v_class){for(var t,c=this.v_class,s=this.v_state,i=0,j=c.length;
i<j;i++){if(t=c[i]){s[i]=this.$_style.graph.$clslist[t];}}}this.$datatype=apf.chart_draw["dt_"+this.$datamode+this.dataslice](this);
this.$drawCode=apf.chart_draw[mode](this,this.$datatype,this.$_style);}if(this.$drawCode){this.$drawCode(this,v);
if(this._anim){this.$redraw();}}};this.$drawBalloons=function(v,doresize){if(this.$doinit){this.$doinit=false;
apf.draw.initLayer(this,this.$parentChart);}else{if(doresize){this.$parentAxis.$copySubPos(this);
apf.draw.resizeLayer(this,this.$parentChart);}}if(this.$docompile){if(!this.$datamode){return this.$redraw();
}this.$docompile=false;var err={};var mode=this.mode+this.$parentAxis.mode;if(!this.$_style){this.$_style=apf.draw.parseStyle(apf.chart_draw["_"+mode],this.style+this.$styletag,err);
}if(this.$_style.graph.$clslist&&this.v_class){for(var t,c=this.v_class,s=this.v_state,i=0,j=c.length;
i<j;i++){if(t=c[i]){s[i]=this.$_style.graph.$clslist[t];}}}this.$datatype=apf.chart_draw["dt_"+this.$datamode+this.dataslice](this);
this.$drawCode=apf.chart_draw[mode](this,this.$datatype,this.$_style);}if(this.$drawCode){this.$drawCode(this,v);
if(this._anim){this.$redraw();}}};this.$mouseDown=function(x,y,bt){};this.$mouseUp=function(x,y){};
this.lastOver=-1;this.$mouseMove=function(dx,dy,bt,ox,oy,lx,ly){if(!this.$drawCode){return;
}var m=this.m;m.x=lx*this.ds,m.y=ly*this.ds;var o=this.$drawCode(this,this.parentNode,this.m),l,nlt;
var t=(new Date()).getTime()*0.001;var _self=this;function switchState(i,newstate,oldstate){var s,c,ht,v,vn;
s=(v=_self.v_state[i])&4294901760,c=v&65535;ht=Math.min(1,(t-_self.v_time[i])*(_self.$_style.graph.$speedlut?(_self.$_style.graph.$speedlut[v]||1):1));
_self.v_state[i]=vn=c|newstate;if(_self.$_style.graph.notransit==1||_self.$_style.graph.nogap==1){ht=1;
}_self.v_time[i]=s==oldstate?(t-(1-ht)/(_self.$_style.graph.$speedlut?(_self.$_style.graph.$speedlut[vn]||1):1)):t;
}function setState(i,newstate,t,lt){var s,c,v,vn;s=(v=_self.v_state[i])&4294901760,c=v&65535;
_self.v_state[i]=vn=c|newstate,_self.v_time[i]=(t-(1-lt)/(this.$_style.graph.$speedlut?(this.$_style.graph.$speedlut[vn]||1):1));
}if(o!=(l=this.lastOver)){var sb=apf.draw.stateBit;if(l>=0){switchState(l,sb.hoverout,sb.hoverin);
if(this.$_style.graph.nogap==1&&t-this.lasttime<0.3){if(t-this.lasttime==0){}var s=this.lastOut,e=l;
if(s>e){for(var i=s;i>e;i--){setState(i,sb.hoverout,t-(t-this.lasttime)*(1-(s-i)/(s-e)),1);
}}else{for(var i=s;i<e;i++){setState(i,sb.hoverout,t-(t-this.lasttime)*((e-i)/(e-s)),1);
}}}this.lasttime=t,this.lastOut=l,this.lastMicro=this.$microtime;}if(o>=0){switchState(o,sb.hoverin,sb.hoverout);
}this.lastOver=o;this.$redraw();}};this.$load=function(XMLRoot){apf.xmldb.addNodeListener(XMLRoot,this);
var v_yval=this.v_yval=[];var v_xval=this.v_xval=[];var v_zval=this.v_zval=[];var v_time=this.v_time=[];
var v_caption=this.v_caption=[];var v_state=this.v_state=[];if(this.$hasBindRule("series")){var rule=(this.$getBindRule("series",XMLRoot)||{})[4];
this.setProperty("series",{series:this.$applyBindRule("series",XMLRoot),split:rule.getAttribute("split")||",",datatype:rule.getAttribute("datatype")||"1X",caption:rule.getAttribute("caption")||null,cls:rule.getAttribute("class")||null,delim:rule.getAttribute("delimeter")||" ",formula:rule.getAttribute("formula")||null,length:rule.getAttribute("length")||null,mip:rule.getAttribute("mip")||null});
}else{if(this.$hasBindRule("formula")){this.setProperty("formula",this.$applyBindRule("formula",XMLRoot));
}else{var v_nodes=this.v_nodes=this.getTraverseNodes(XMLRoot);var n,p,v,k,length,t=(new Date()).getTime()*0.001;
if(!this.$hasBindRule("y")){apf.console.warn("No y binding rule found for graph "+this.name+" ["+this.localName+"]");
}else{var bz=this.$hasBindRule("z")?true:false,bx=this.$hasBindRule("x")?true:false;
for(v=0,length=v_nodes.length;v<length;v++){n=v_nodes[v];this.v_time[v]=t;v_yval[v]=parseFloat(this.$applyBindRule("y",n));
if(bx){v_xval[v]=parseFloat(this.$applyBindRule("x",n));if(bz){v_zval[v]=parseFloat(this.$applyBindRule("z",n));
}}var cls=this.$applyBindRule("css",n);v_caption[v]=this.$applyBindRule("caption",n);
v_state[v]=0;}this.$sourcetype="seriesX";}if(length!=this.length){this.setProperty("length",length);
}}}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(action=="redo-remove"){var retreatToListenMode=false,model=this.getModel(true);
if(model){var xpath=model.getXpathByAmlNode(this);if(xpath){var xmlNode=model.data.selectSingleNode(xpath);
if(xmlNode!=this.xmlRoot){retreatToListenMode=true;}}}if(retreatToListenMode||this.xmlRoot==xmlNode){return model.$waitForXml(this);
}}if(this.$hasBindRule("series")||this.$hasBindRule("formula")){if(UndoObj&&!UndoObj.xmlNode){UndoObj.xmlNode=this.xmlRoot;
}}else{var v_yval=this.v_yval=[];var v_xval=this.v_xval=[];var v_zval=this.v_zval=[];
var v_time=this.v_time=[];var v_caption=this.v_caption=[];var v_state=this.v_state=[];
var v_nodes=this.v_nodes=this.getTraverseNodes(this.xmlRoot);var n,p,v,k,length,t=(new Date()).getTime()*0.001;
if(!this.$hasBindRule("y")){apf.console.warn("No y binding rule found for graph "+this.name+" ["+this.localName+"]");
}else{var bz=this.$hasBindRule("z")?true:false,bx=this.$hasBindRule("x")?true:false;
for(v=0,length=v_nodes.length;v<length;v++){n=v_nodes[v];this.v_time[v]=t;v_yval[v]=parseFloat(this.$applyBindRule("y",n));
if(bx){v_xval[v]=parseFloat(this.$applyBindRule("x",n));if(bz){v_zval[v]=parseFloat(this.$applyBindRule("z",n));
}}var cls=this.$applyBindRule("css",n);v_caption[v]=this.$applyBindRule("caption",n);
v_state[v]=0;}this.$sourcetype="seriesX";}if(length!=this.length){this.setProperty("length",length);
}this.$redraw();}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$parentAxis=this.parentNode;
this.$parentChart=this.$parentAxis.parentNode;var n=this.getElementsByTagNameNS(apf.ns.apf,"style");
if(n.length>0){this.$styletag=n[0].firstChild.nodeValue;}});}).call(apf.Graph.prototype=new apf.AmlElement());
apf.hbox=function(struct,tagName){this.$init(tagName||"hbox",apf.NODE_VISIBLE,struct);
};apf.vbox=function(struct,tagName){this.$init(tagName||"vbox",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$useLateDom=true;this.$box=true;this.$layout=true;
var MOZSTACK="-moz-stack";var input={INPUT:1,SELECT:1,TEXTAREA:1};this.$booleanProperties.splitters=true;
this.$supportedProperties.push("padding","reverse","edge","pack","align","splitters");
this.$propHandlers.padding=function(value){this.padding=parseInt(value);var node,nodes=this.childNodes,elms=[];
for(var i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeFunc==apf.NODE_VISIBLE&&node.$amlLoaded&&node.visible!==false){elms.push(node);
}}if(!elms.length){return;}for(var last,b,el,i=elms.length-2;i>=0;i--){b=(el=elms[i]).margin&&apf.getBox(el.margin)||[0,0,0,0];
if((!last||!last.$splitter)&&!el.$splitter){b[this.$vbox?2:1]+=this.padding;if(!apf.hasFlexibleBox&&i!=0&&this.align=="stretch"&&this.$vbox){b[0]+=this.padding;
}}el.$ext.style.margin=b.join("px ")+"px";last=el;}b=(el=elms[elms.length-1]).margin&&apf.getBox(el.margin)||[0,0,0,0];
el.$ext.style.margin=b.join("px ")+"px";if(!apf.hasFlexibleBox){this.$resize();
}};this.$propHandlers.reverse=function(value){if(apf.hasFlexibleBox){this.$int.style[apf.CSSPREFIX+"BoxDirection"]=value?"reverse":"normal";
}else{}};this.$propHandlers.edge=function(value){var el=!apf.hasFlexibleBox&&this.$vbox?this.$ext:this.$int;
el.style.padding=(this.$edge=apf.getBox(value)).join("px ")+"px";if(!apf.hasFlexibleBox){this.$resize();
}};this.$propHandlers.pack=function(value){if(apf.hasFlexibleBox){this.$int.style[apf.CSSPREFIX+"BoxPack"]=value||"start";
}else{if(this.$amlLoaded){if(this.$vbox){this.$int.style.verticalAlign=value=="center"?"middle":(value=="end"?"bottom":"top");
}else{this.$int.style.textAlign="";var nodes=this.childNodes;for(var i=0,l=nodes.length;
i<l;i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||!node.$amlLoaded){continue;
}node.$ext.style.textAlign=apf.getStyle(node.$ext,"textAlign")||"left";}this.$int.style.textAlign=value=="center"?"center":(value=="end"?"right":"left");
}}}};this.$propHandlers.align=function(value){if(apf.hasFlexibleBox){this.$int.style[apf.CSSPREFIX+"BoxAlign"]=value||"stretch";
if(apf.isGecko){this.$int.style.overflow="visible";}var stretch=!value||value=="stretch";
var nodes=this.childNodes;var size=this.$vbox?"width":"height";var isInFixed=false,loopNode=this;
while(!isInFixed&&loopNode){isInFixed=loopNode[size]||loopNode.anchors||(loopNode.$vbox?loopNode.top&&loopNode.bottom:loopNode.left&&loopNode.right);
if(!loopNode.flex){break;}loopNode=loopNode.parentNode||loopNode.$parentNode;}for(var i=0,l=nodes.length;
i<l;i++){if(!(node=nodes[i]).$ext||node.$ext.nodeType!=1){continue;}if(stretch&&!node[size]){node.$ext.style[size]=apf.isGecko&&(this.flex||node.flex)?(isInFixed?"1px":"auto"):(apf.isWebkit&&input[node.$ext.tagName]?"100%":(apf.isWebkit&&node[this.$vbox?"minwidth":"minheight"]&&this.flex?"0px":"auto"));
}else{if(node[size]){handlers["true"][size].call(node,node[size]);}}}}else{if(this.$amlLoaded){var stretch=!value||value=="stretch";
if(!this.$vbox){var nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||!node.$amlLoaded){continue;
}node.$ext.style.verticalAlign=value=="center"?"middle":(value=="end"?"bottom":"top");
}}else{var el=!apf.hasFlexibleBox&&this.$vbox?this.$ext:this.$int;el.style.textAlign="";
var nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||!node.$amlLoaded){continue;
}if(node.visible!==false){node.$ext.style.display=value=="stretch"?"block":apf.INLINE;
node.$br.style.display=value=="stretch"?"none":"";if(apf.needZoomForLayout){node.$ext.style.zoom=1;
}}node.$ext.style.textAlign=apf.getStyle(node.$ext,"textAlign")||"left";}el.style.textAlign=value=="center"?"center":(value=="end"?"right":"left");
}}}};function visibleHandler(e){if(this.parentNode.splitters&&!this.$splitter){if(!e.value){if(this.nextSibling&&this.nextSibling.$splitter){this.nextSibling.removeNode();
}else{if(this.previousSibling&&this.previousSibling.$splitter){this.previousSibling.removeNode();
}}}else{var isLast=isLastVisibleChild(this);if(!isLast){if(!this.nextSibling.$splitter&&!this.nextSibling.nosplitter){this.parentNode.insertBefore(this.ownerDocument.createElementNS(apf.ns.aml,"splitter"),this.nextSibling);
}}else{if(this.previousSibling&&!this.previousSibling.$splitter&&!this.previousSibling.nosplitter){this.parentNode.insertBefore(this.ownerDocument.createElementNS(apf.ns.aml,"splitter"),this);
}}}}this.parentNode.$propHandlers.padding.call(this.parentNode,this.parentNode.padding);
apf.layout.forceResize(this.parentNode.$int);if(apf.hasFlexibleBox){if(this.$altExt){this.$altExt.style.display=e.value?(apf.isGecko?MOZSTACK:apf.CSSPREFIX2+"-box"):"none";
}return;}if(e.value){this.$ext.style.display=this.parentNode.$vbox&&this.parentNode.align=="stretch"?"block":apf.INLINE;
if(apf.needZoomForLayout){this.$ext.style.zoom=1;}if(this.$br){this.$br.style.display=this.parentNode.align=="stretch"?"none":"";
}}else{if(this.$br){this.$br.style.display="none";}}this.parentNode.$resize();}function resizeHandler(){if(!this.flex){if(this.$isRszHandling||this.$lastSizeChild&&this.$lastSizeChild[0]==this.$ext.offsetWidth&&this.$lastSizeChild[1]==this.$ext.offsetHeight){return;
}this.parentNode.$resize(true);this.$lastSizeChild=[this.$ext.offsetWidth,this.$ext.offsetHeight];
}}var handlers={"true":{optimize:function(value){this.optimize=apf.isTrue(value);
},width:function(value){(this.$altExt||this.$ext).style.width=value?(parseFloat(value)==value?value+"px":value):"";
},height:function(value){(this.$altExt||this.$ext).style.height=value?(parseFloat(value)==value?value+"px":value):(apf.isGecko&&this.flex&&this.parentNode.$vbox?"auto":"");
},margin:function(value){var b=apf.getBox(value);if(!isLastVisibleChild(this)){b[this.parentNode.$vbox?2:1]+=this.parentNode.padding;
}this.$ext.style.margin=b.join("px ")+"px";},flex:function(value){this.flex=value=parseInt(value);
if(value){if(!this.optimize&&!this.$altExt){this.$altExt=this.$ext.ownerDocument.createElement("div");
this.parentNode.$int.replaceChild(this.$altExt,this.$ext);this.$altExt.appendChild(this.$ext);
this.$altExt.style[apf.CSSPREFIX+"BoxSizing"]="border-box";this.$altExt.style.display=apf.CSSPREFIX2+"-box";
this.$altExt.style[apf.CSSPREFIX+"BoxOrient"]="vertical";this.$ext.style[apf.CSSPREFIX+"BoxFlex"]=1;
var size=this.parentNode.$vbox?"height":"width";if(apf.isWebkit){if(!this.preventforcezero){this.$altExt.style[size]="0px";
}}else{if(apf.isGecko){this.$altExt.style[size]="0px";if(!this.$box){this.$altExt.style.overflow="hidden";
}if(apf.getStyle(this.$ext,"overflow")=="visible"){this.$ext.style.overflow="hidden";
}this.$ext.style[size]="1px";this.$altExt.style.minHeight=this.$ext.style.minHeight;
this.$altExt.style.maxHeight=this.$ext.style.maxHeight;this.$altExt.style.minWidth=this.$ext.style.minWidth;
this.$altExt.style.maxWidth=this.$ext.style.maxWidth;}}}(this.$altExt||this.$ext).style[apf.CSSPREFIX+"BoxFlex"]=parseInt(value)||1;
}else{if(this.$altExt){this.parentNode.$int.replaceChild(this.$ext,this.$altExt);
this.$ext.style[apf.CSSPREFIX+"BoxFlex"]="";if(apf.isGecko){this.$ext.style.overflow="";
}delete this.$altExt;}}}},"false":{width:function(value){this.$ext.style.width=value?(parseFloat(value)==value?Math.max(0,value-apf.getWidthDiff(this.$ext))+"px":value):"";
},height:function(value){this.$ext.style.height=value?(parseFloat(value)==value?Math.max(0,value-apf.getHeightDiff(this.$ext))+"px":value):"";
},margin:function(value){var b=apf.getBox(value);if(this.padding){if(!isLastVisibleChild(this)){b[this.parentNode.$vbox?2:1]+=this.padding;
}if(this!=this.parentNode.firstChild&&this.parentNode.align=="stretch"&&this.parentNode.$vbox){b[0]+=this.padding;
}}this.$ext.style.margin=b.join("px ")+"px";},flex:function(value){this.flex=parseInt(value);
if(this.$amlLoaded){this.parentNode.$resize(true);}}}};function isLastVisibleChild(amlNode){var lastChild=amlNode.parentNode.lastChild;
while(lastChild&&(lastChild.nodeFunc!=apf.NODE_VISIBLE||lastChild.visible===false||lastChild.visible==2&&apf.isFalse(lastChild.getAttribute("visible")))){lastChild=lastChild.previousSibling;
}return lastChild&&lastChild==amlNode;}this.register=function(amlNode,insert){if(amlNode.$altExt){return;
}amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=apf.K;
var propHandlers=handlers[apf.hasFlexibleBox];for(var prop in propHandlers){amlNode.$propHandlers[prop]=propHandlers[prop];
}if(amlNode.nodeFunc==apf.NODE_VISIBLE){if(apf.hasFlexibleBox){if(amlNode.$ext.tagName=="INPUT"||apf.isWebkit&&input[amlNode.$ext.tagName]){var doc=amlNode.$ext.ownerDocument;
amlNode.$altExt=doc.createElement("div");amlNode.parentNode.$int.replaceChild(amlNode.$altExt,amlNode.$ext);
amlNode.$altExt.style[apf.CSSPREFIX+"BoxSizing"]="border-box";amlNode.$altExt.appendChild(amlNode.$ext);
if(apf.isWebkit){var d=apf.getDiff(amlNode.$ext);amlNode.$altExt.style.height="100%";
amlNode.$altExt.style.width="0";amlNode.$altExt.style.lineHeight=0;amlNode.$altExt.style.margin="-1px 0 0 0";
amlNode.$ext.style.width="100%";amlNode.$ext.style.height="100%";amlNode.$ext.style.top="1px";
amlNode.$ext.style.position="relative";}else{amlNode.$altExt.style.display=apf.CSSPREFIX2+"-box";
amlNode.$altExt.style[apf.CSSPREFIX+"BoxOrient"]="horizontal";amlNode.$altExt.style[apf.CSSPREFIX+"BoxAlign"]="stretch";
amlNode.$ext.style[apf.CSSPREFIX+"BoxFlex"]=1;}}else{if(apf.getStyle(amlNode.$ext,"display")=="inline"){amlNode.$ext.style.display="block";
}}amlNode.$ext.style[apf.CSSPREFIX+"BoxSizing"]="border-box";}else{if(this.$vbox){amlNode.$br=this.$int.insertBefore(amlNode.$ext.ownerDocument.createElement("br"),amlNode.$ext.nextSibling);
if(amlNode.visible===false){amlNode.$br.style.display="none";}}else{if(amlNode.visible!==false){amlNode.$ext.style.display=apf.INLINE;
if(apf.needZoomForLayout){amlNode.$ext.style.zoom=1;}}this.$int.style.whiteSpace="";
amlNode.$ext.style.whiteSpace=apf.getStyle(amlNode.$ext,"whiteSpace")||"normal";
this.$int.style.whiteSpace="nowrap";}this.$int.style.fontSize="0";if(!amlNode.$box){var fontSize=apf.getStyle(amlNode.$ext,"fontSize");
if(fontSize=="0px"){amlNode.$ext.style.fontSize="";var pNode=this.$int.parentNode;
while(apf.getStyle(pNode,"fontSize")=="0px"){pNode=pNode.parentNode;}fontSize=apf.getStyle(pNode,"fontSize");
}amlNode.$ext.style.fontSize=fontSize;}amlNode.addEventListener("resize",resizeHandler);
}amlNode.addEventListener("prop.visible",visibleHandler);this.$noResize=true;if(amlNode.height){propHandlers.height.call(amlNode,amlNode.height);
}if(amlNode.width){propHandlers.width.call(amlNode,amlNode.width);}if(amlNode.margin){propHandlers.margin.call(amlNode,amlNode.margin);
}if(amlNode.flex){propHandlers.flex.call(amlNode,amlNode.flex);}var isLast=isLastVisibleChild(amlNode);
if(isLast||insert){this.$propHandlers.padding.call(this,this.padding);this.$propHandlers.align.call(this,this.align);
if(!apf.hasFlexibleBox){this.$propHandlers.pack.call(this,this.pack);}if(insert&&amlNode.visible!==false){visibleHandler.call(amlNode,{value:true});
}}else{if(this.splitters&&!amlNode.$splitter&&amlNode.visible!==false&&!amlNode.nosplitter){this.insertBefore(this.ownerDocument.createElementNS(apf.ns.aml,"splitter"),amlNode.nextSibling);
}}delete this.$noResize;if(!apf.hasFlexibleBox&&isLast){this.$resize();}}};this.unregister=function(amlNode){amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=null;
var propHandlers=handlers[apf.hasFlexibleBox];for(var prop in propHandlers){delete amlNode.$propHandlers[prop];
}if(amlNode.nodeFunc==apf.NODE_VISIBLE){if(amlNode.flex){propHandlers.flex.call(amlNode,0);
}if(apf.hasFlexibleBox){amlNode.$ext.style[apf.CSSPREFIX+"BoxSizing"]="";if(apf.isGecko){this.$int.style.overflow="visible";
if(amlNode.$ext.style.display=="block"){amlNode.$ext.style.display="";}}}else{amlNode.$ext.style.verticalAlign="";
amlNode.$ext.style.textAlign="";amlNode.$ext.style.whiteSpace="";if(amlNode.$br){amlNode.$br.parentNode.removeChild(amlNode.$br);
delete amlNode.$br;}amlNode.removeEventListener("resize",resizeHandler);}amlNode.removeEventListener("prop.visible",visibleHandler);
amlNode.$ext.style.display=amlNode.visible?"block":"none";if(amlNode.margin){amlNode.$ext.style.margin="";
}if(amlNode.width){amlNode.$ext.style.width="";}if(this.splitters&&!amlNode.$splitter&&amlNode.nextSibling&&amlNode.nextSibling.$splitter){amlNode.nextSibling.removeNode();
}}};this.addEventListener("DOMNodeRemoved",function(e){if(e.$doOnlyAdmin||e.currentTarget==this){return;
}if(e.relatedNode==this){this.unregister(e.currentTarget);}});this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this||e.currentTarget.nodeType!=1){return;
}if(e.relatedNode==this&&!e.$isMoveWithinParent){e.currentTarget.$setLayout(this.localName,true);
if(e.currentTarget.$altExt){return false;}}});function myVisibleHandler(e){if(e.value){this.$int.style.display=apf.CSSPREFIX2+"-box";
}}function myHeightHandler(e){clearInterval(this.$heighttimer);if(e.value||this.align!="stretch"){delete this.$heighttimer;
}else{if(!this.$heighttimer){var _self=this;this.$heighttimer=$setInterval(function(){if(_self.$amlDestroyed){return;
}var nodes=_self.childNodes;for(var $int,i=0,l=nodes.length;i<l;i++){if(!($int=(node=nodes[i]).$int||node.$container)){continue;
}if(Math.min($int.scrollHeight,node.maxheight||10000)>$int.offsetHeight){return _self.$resize(true);
}}if(_self.flex){clearInterval(this.$heighttimer);}},this.flex?1:500);}}}this.$draw=function(){var doc=this.$pHtmlNode.ownerDocument;
this.$ext=this.$pHtmlNode.appendChild(doc.createElement("div"));this.$ext.className=this.localName;
this.$vbox=this.localName=="vbox";this.$int=apf.isGecko&&!this.parentNode.$box||!apf.hasFlexibleBox&&this.$vbox?this.$ext.appendChild(doc.createElement("div")):this.$ext;
this.$ext.host=this;if(apf.isGecko&&!this.parentNode.$box){this.$int.style.width="100%";
this.$int.style.height="100%";}else{if(!apf.hasFlexibleBox&&this.$vbox){this.$int.style.display=apf.INLINE;
if(apf.needZoomForLayout){this.$int.style.zoom=1;}this.$int.style.width="100%";
}}if(apf.hasFlexibleBox){this.$display="-"+apf.CSSPREFIX+"-box";this.$int.style.display=apf.CSSPREFIX2+"-box";
this.$int.style[apf.CSSPREFIX+"BoxOrient"]=this.localName=="hbox"?"horizontal":"vertical";
if(apf.isGecko){this.$int.style[apf.CSSPREFIX+"BoxSizing"]="border-box";}this.$int.style[apf.CSSPREFIX+"BoxAlign"]="stretch";
this.addEventListener("prop.visible",myVisibleHandler);}else{if(!this.$vbox){this.$int.style.whiteSpace="nowrap";
this.addEventListener("prop.height",myHeightHandler);}var spacer=(!apf.hasFlexibleBox&&this.$vbox?this.$ext:this.$int).appendChild(doc.createElement("strong"));
spacer.style.height="100%";spacer.style.display=apf.INLINE;if(apf.needZoomForLayout){spacer.style.zoom=1;
}spacer.style.verticalAlign="middle";this.addEventListener("resize",this.$resize);
}if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));
}this.$originalMin=[this.minwidth||0,this.minheight||0];};this.$resize=function(force){if(!this.$amlLoaded||this.$noResize){return;
}if(force!==true&&this.$lastSize&&this.$lastSize[0]==this.$int.offsetWidth&&this.$lastSize[1]==this.$int.offsetHeight){return;
}if(!apf.window.vManager.check(this,this.$uniqueId,this.$resize)){return;}this.$noResize=true;
this.$lastSize=[this.$int.offsetWidth,this.$int.offsetHeight];var total=0;var size=this.$vbox?"width":"height";
var minsize=this.$vbox?"minWidth":"minHeight";var osize=this.$vbox?"height":"width";
var scroll=this.$vbox?"scrollWidth":"scrollHeight";var offset=this.$vbox?"offsetWidth":"offsetHeight";
var ooffset=this.$vbox?"offsetHeight":"offsetWidth";var getDiff=this.$vbox?"getWidthDiff":"getHeightDiff";
var ogetDiff=this.$vbox?"getHeightDiff":"getWidthDiff";var inner=this.$vbox?"getHtmlInnerWidth":"getHtmlInnerHeight";
var oinner=this.$vbox?"getHtmlInnerHeight":"getHtmlInnerWidth";var borders=this.$vbox?"getVerBorders":"getHorBorders";
var nodes=this.childNodes,hNodes=[],fW=0,max=0;for(var node,i=0;i<nodes.length;
i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||node.visible===false||!node.$amlLoaded){continue;
}hNodes.push(node);if(!node[size]){var m=node.margin&&apf.getBox(node.margin);if(m&&this.$vbox){m.unshift();
}var mdiff=(m?m[0]+m[2]:0);max=Math.max(max,mdiff+Math.min(node.$ext[scroll]+apf[borders](node.$ext),node["max"+size]||10000));
}if(parseInt(node.flex)){total+=parseFloat(node.flex);}else{var m=node.margin&&apf.getBox(node.margin);
if(m&&!this.$vbox){m.shift();}fW+=node.$ext[ooffset]+(m?m[0]+m[2]:0);}}if(!max&&this[size]){max=this[size]-apf[ogetDiff](this.$ext);
}if(this.align=="stretch"){var l=hNodes.length;var pH=max;for(var i=0;i<l;i++){node=hNodes[i];
if(!node[size]&&!this.$vbox||this.$vbox&&input[node.$ext.tagName]){var m=node.margin&&apf.getBox(node.margin);
if(m&&this.$vbox){m.unshift();}var mdiff=(m?m[0]+m[2]:0);if(max&&Math.min(node.$ext[scroll],node["max"+size]||10000)!=max){node.$ext.style[size]=Math.max(0,max-apf[getDiff](node.$ext)-mdiff)+"px";
}else{node.$ext.style[size]="";}}}}if(total>0){if(this.$vbox){this.$int.style.height="100%";
}this.$int.style.overflow="hidden";var splitterCount=apf.n(this).children("a:splitter").length()*2;
var rW=this.$int[ooffset]-apf[ogetDiff](this.$int)-fW-((hNodes.length-1-splitterCount)*this.padding);
var lW=rW,done=0;for(var i=0,l=hNodes.length;i<l;i++){if((node=hNodes[i]).flex){var v=(i%2==0?Math.floor:Math.ceil)((rW/total)*parseInt(node.flex));
done+=parseInt(node.flex);var m=node.margin&&apf.getBox(node.margin);if(m&&!this.$vbox){m.shift();
}node.$ext.style[osize]=Math.max(0,(done==total?lW:v)-apf[ogetDiff](node.$ext)-(m?m[0]+m[2]:0))+"px";
lW-=v;}}}else{if(this.$vbox){this.$int.style.height="";}this.$int.style.overflow="";
}this.$noResize=false;};this.$loadAml=function(x){if(this.padding==undefined){this.padding=0;
}if(this.edge==undefined){this.$propHandlers.edge.call(this,this.edge=0);}if(this.pack==undefined){this.$propHandlers.pack.call(this,this.edge="start");
}if(this.align==undefined){this.align="stretch";}if(!apf.hasFlexibleBox&&!this.$vbox&&!this.height&&this.align=="stretch"){myHeightHandler.call(this,{});
}};}).call(apf.vbox.prototype=new apf.GuiElement());apf.hbox.prototype=apf.vbox.prototype;
apf.aml.setElement("hbox",apf.hbox);apf.aml.setElement("vbox",apf.vbox);apf.iconmap=function(){this.$init("iconmap",apf.NODE_HIDDEN);
};(function(){this.$parsePrio="050";this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.id){throw new Error(apf.formatErrorString(0,this,"Creating icon map","Could not create iconmap. Missing id attribute",this.$aml));
}apf.skins.addIconMap({name:this.id,src:this.src,type:this.type,size:parseInt(this.size),width:parseInt(this.width),height:parseInt(this.height),offset:(this.offset||"0,0").splitSafe(",")});
});}).call(apf.iconmap.prototype=new apf.AmlElement());apf.aml.setElement("iconmap",apf.iconmap);
apf.img=function(struct,tagName){this.$init(tagName||"img",apf.NODE_VISIBLE,struct);
};apf.preview=function(struct,tagName){this.$init(tagName||"preview",apf.NODE_VISIBLE,struct);
};(function(){this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(value){return this.value;};this.$supportedProperties.push("value","src");
this.$propHandlers.src=this.$propHandlers.value=function(value){if(this.oImage.nodeType==1){this.oImage.style.backgroundImage="url("+value+")";
}else{this.oImage.nodeValue=value;}if(this.oImage.nodeType==2&&!this.$resize.done){if(this.oImg){var pNode=apf.hasSingleRszEvent?this.$pHtmlNode:this.$ext;
apf.layout.setRules(pNode,this.$uniqueId+"_image","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");
apf.layout.queue(pNode);this.oImg.onload=function(){apf.layout.forceResize(pNode);
};}this.$resize.done=true;}if(this.oImg){this.oImg.style.display=value?"block":"none";
}};this.refetch=function(){this.$propHandlers.value.call(this,"");this.$propHandlers.value.call(this,this.value||this.src);
};this.addEventListener("$clear",function(){this.value="";if(this.oImg){this.oImg.style.display="none";
}});this.$draw=function(){this.$ext=this.$getExternal();this.$ext.onclick=function(e){this.host.dispatchEvent("click",{htmlEvent:e||event});
};this.oImage=this.$getLayoutNode("main","image",this.$ext);if(this.oImage.nodeType==1){this.oImg=this.oImage.getElementsByTagName("img")[0];
}if(this.localName=="preview"){var _self=this;this.$ext.onclick=function(){if(!_self.sPreview){return;
}_self.$ext.innerHTML=_self.sPreview;this.onclick=null;};}var _self=this;apf.addListener(this.$ext,"mouseover",function(e){if(!_self.disabled){_self.dispatchEvent("mouseover",{htmlEvent:e});
}});apf.addListener(this.$ext,"mouseout",function(e){if(!_self.disabled){_self.dispatchEvent("mouseout",{htmlEvent:e});
}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(){var node,val="",i=this.childNodes.length;
for(;i>=0;--i){if((node=this.childNodes[i])&&node.nodeName&&node.nodeName=="#cdata-section"){val=node.nodeValue;
node.removeNode();}}this.sPreview=val;});this.$resize=function(){var diff=apf.getDiff(this.$ext);
var wratio=1,hratio=1;this.oImg.style.width="";this.oImg.style.height="";if(this.oImg.offsetWidth>this.$ext.offsetWidth){wratio=this.oImg.offsetWidth/(this.$ext.offsetWidth-diff[0]);
}if(this.oImg.offsetHeight>this.$ext.offsetHeight){hratio=this.oImg.offsetHeight/(this.$ext.offsetHeight-diff[1]);
}if(wratio>hratio&&wratio>1){this.oImg.style.width="100%";}else{if(hratio>wratio&&hratio>1){this.oImg.style.height="100%";
}}this.oImg.style.top=((this.$ext.offsetHeight-apf.getHeightDiff(this.$ext)-this.oImg.offsetHeight)/2)+"px";
};}).call(apf.img.prototype=new apf.BaseSimple());apf.preview.prototype=apf.img.prototype;
apf.aml.setElement("img",apf.img);apf.aml.setElement("preview",apf.preview);apf.aml.setElement("name",apf.BindingRule);
apf.aml.setElement("image",apf.BindingRule);apf.item=function(struct,tagName){this.$init(tagName||"item",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$childProperty="caption";this.$canLeechSkin="item";
this.checked=false;this.selected=false;this.implement(apf.ChildValue);this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);
this.$supportedProperties.push("submenu","value","match","group","icon","checked","selected","disabled","caption","type");
this.$propHandlers.submenu=function(value){apf.setStyleClass(this.$ext,"submenu");
};this.$propHandlers.select=function(value){this.select=value?"self::"+value.split("|").join("|self::"):value;
};this.$propHandlers.group=function(value){if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);
}if(!value){this.$group=null;return;}var group=typeof value=="string"?apf.nameserver.get("radiogroup",value):value;
if(!group){group=apf.nameserver.register("radiogroup",value,new apf.$group());group.setAttribute("id",value);
group.dispatchEvent("DOMNodeInsertedIntoDocument");group.parentNode=this;}this.$group=group;
this.$group.$addRadio(this);};this.$propHandlers.hotkey=function(value){if(this.$hotkey){apf.setNodeValue(this.$hotkey,apf.isMac?apf.hotkeys.toMacNotation(value):value);
}if(this.$lastHotkey){apf.hotkeys.remove(this.$lastHotkey);}if(value){this.$lastHotkey=value;
var _self=this;apf.hotkeys.register(value,function(){if(_self.disabled||!_self.visible){return;
}var buttons=apf.document.getElementsByTagNameNS(apf.ns.aml,"button");for(var i=0;
i<buttons.length;i++){if(buttons[i].submenu==_self.parentNode.name){var btn=buttons[i];
btn.$setState("Over",{});$setTimeout(function(){btn.$setState("Out",{});},200);
break;}}_self.$down();_self.$up();_self.$click();});}};this.$propHandlers.icon=function(value){if(this.$icon){apf.skins.setIcon(this.$icon,value,this.parentNode.iconPath);
}};this.$propHandlers.caption=function(value){if(this.$caption){apf.setNodeValue(this.$caption,value);
}};this.$propHandlers.type=function(value){apf.setStyleClass(this.$ext,value,["item","check","radio"]);
};this.$values=[1,0];this.$propHandlers.values=function(value){this.$values=value&&value.split("|");
};this.$propHandlers.value=function(value){if(this.type!="check"){return;}this.setProperty("checked",this.$values.indexOf(value)==0);
};this.$propHandlers.checked=function(value){if(this.type!="check"){return;}if(apf.isTrue(value)){apf.setStyleClass(this.$ext,"checked");
}else{apf.setStyleClass(this.$ext,"",["checked"]);}if(this.$values&&this.$values[value?0:1]!=this.value){return this.setProperty("value",this.$values[value?0:1]);
}};this.select=function(){this.parentNode.select(this.group,this.value||this.caption);
};this.check=function(){this.setProperty("checked",true);};this.uncheck=function(){this.setProperty("checked",false);
};this.$check=function(){apf.setStyleClass(this.$ext,"selected");};this.$uncheck=function(){apf.setStyleClass(this.$ext,"",["selected"]);
};this.$propHandlers.selected=function(value){if(this.type!="radio"){return;}if(this.$group){this.$group.setProperty("value",this.value);
}if(apf.isTrue(value)){this.$check();}else{this.$uncheck();}};this.$propHandlers.disabled=function(value){if(apf.isTrue(value)||value==-1){apf.setStyleClass(this.$ext,"disabled");
}else{apf.setStyleClass(this.$ext,"",["disabled"]);}};this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}if(!withinParent&&this.skinName!=pNode.skinName){this.loadAml();}});this.$down=function(){};
this.$up=function(){if(this.type=="radio"){this.parentNode.select(this.group,this.value||this.caption);
}else{if(this.type=="check"){this.setProperty("checked",!this.checked);}}if(this.submenu){this.$over(null,true);
return;}this.parentNode.$hideTree=true;this.parentNode.hide();this.parentNode.dispatchEvent("itemclick",{value:this.value||this.caption,relatedNode:this,checked:this.checked,selected:this.selected});
this.dispatchEvent("click",{xmlContext:this.parentNode.xmlReference,opener:this.parentNode.opener});
};this.$click=function(){};var timer;this.$out=function(e){if(apf.isChildOf(this.$ext,e.toElement||e.explicitOriginalTarget)||apf.isChildOf(this.$ext,e.srcElement||e.target)){return;
}clearTimeout(timer);if(!this.submenu||this.$submenu(true)){apf.setStyleClass(this.$ext,"",["hover"]);
var sel=this.parentNode.$selected;if(sel&&sel!=this){apf.setStyleClass(sel.$ext,"",["hover"]);
}this.parentNode.$selected=null;}};this.$over=function(e,force){if(this.parentNode.$selected==this&&e){return;
}if(this.parentNode.$selected){apf.setStyleClass(this.parentNode.$selected.$ext,"",["hover"]);
}apf.setStyleClass(this.$ext,"hover");this.parentNode.$selected=this;if(!force&&(apf.isChildOf(this.$ext,e.toElement||e.explicitOriginalTarget)||apf.isChildOf(this.$ext,e.fromElement||e.target))){return;
}var _self=this,ps=this.parentNode.$showingSubMenu;if(ps&&ps.name==this.submenu){this.parentNode.$selected=null;
this.parentNode.$showingSubMenu=null;_self.$submenu();return;}clearTimeout(timer);
function submenu(){if(ps&&ps.visible){ps.hide();if(_self.parentNode.$showingSubMenu==ps){_self.parentNode.$showingSubMenu=null;
}}if(_self.submenu&&_self.parentNode.opener&&_self.parentNode.opener.visible){_self.$submenu();
}}if(force){submenu();}else{timer=$setTimeout(function(){submenu();timer=null;},210);
}};this.$submenu=function(hide,force){if(!this.submenu){return true;}var menu=self[this.submenu];
if(!menu){throw new Error(apf.formatErrorString(0,this,"Displaying submenu","Could not find submenu '"+this.submenu+"'",this.$aml));
return;}if(!hide){this.parentNode.$showingSubMenu=menu;var pos=apf.getAbsolutePosition(this.$ext,this.parentNode.$ext.offsetParent);
menu.display(pos[0]+this.$ext.offsetWidth-3,pos[1]+3,true,this,this.parentNode.xmlReference,this.parentNode.$uniqueId);
menu.setAttribute("zindex",(this.parentNode.zindex||1)+1);}else{if(menu.visible&&!force){return false;
}if(this.parentNode.$showingSubMenu==menu){this.parentNode.$showingSubMenu=null;
}apf.setStyleClass(this.$ext,"",["hover"]);menu.hide();return true;}};this.$draw=function(isSkinSwitch){var p=this.parentNode;
while(p.$canLeechSkin=="item"){p=p.parentNode;}if(p.hasFeature(apf.__MULTISELECT__)){var _self=this;
if(!this.$hasSetSkinListener){var f;this.parentNode.addEventListener("$skinchange",f=function(){if(_self.$amlDestroyed){return;
}if(_self.$ext.parentNode){this.$deInitNode(_self,_self.$ext);}var oInt=p==_self.parentNode?p.$container:_self.parentNode.$container;
var node=oInt.lastChild;p.$add(_self,_self.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,_self.parentNode,oInt!=p.$container&&oInt,null);
p.$fill();if(p.$isTreeArch){_self.$container=p.$getLayoutNode("item","container",_self.$ext=node&&node.nextSibling||oInt.firstChild);
}else{_self.$ext=node&&node.nextSibling||oInt.firstChild;}var ns=_self;while((ns=ns.nextSibling)&&ns.nodeType!=1){}if(!ns||ns.$canLeechSkin!="item"){p.dispatchEvent("afterload");
}});this.addEventListener("DOMNodeRemoved",function(e){if(e.currentTarget==this){this.parentNode.removeEventListener("$skinchange",f);
}});this.$hasSetSkinListener=true;}if(!p.$itemInited){p.canrename=false;p.$removeClearMessage();
p.$itemInited=[p.getTraverseNodes,p.getFirstTraverseNode,p.getTraverseParent];p.getTraverseNodes=function(xmlNode){return(xmlNode||p).getElementsByTagNameNS(apf.ns.apf,"item");
};p.getFirstTraverseNode=function(xmlNode){return(xmlNode||p).getElementsByTagNameNS(apf.ns.apf,"item")[0];
};p.getTraverseParent=function(xmlNode){return xmlNode&&xmlNode.parentNode;};p.each=(this.prefix?this.prefix+":":"")+"item";
p.$preventDataLoad=true;p.$initingModel=true;p.$setDynamicProperty("icon","[@icon]");
p.$setDynamicProperty("image","[@image]");p.$setDynamicProperty("caption","[label/text()|@caption|text()]");
p.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");p.$canLoadDataAttr=false;
if(!p.xmlRoot){p.xmlRoot=p;}}this.$loadAml=function(){if(!this.getAttribute("caption")){this.setAttribute("caption",this.caption);
}var oInt=p==this.parentNode?p.$container:this.parentNode.$container;var node=oInt.lastChild;
if(!p.documentId){p.documentId=apf.xmldb.getXmlDocId(this);}p.$add(this,apf.xmldb.nodeConnect(p.documentId,this,null,p),this.parentNode,oInt!=p.$container&&oInt,null);
p.$fill();if(p.$isTreeArch){this.$container=p.$getLayoutNode("item","container",this.$ext=node&&node.nextSibling||oInt.firstChild);
}else{this.$ext=node&&node.nextSibling||oInt.firstChild;}var ns=this;while((ns=ns.nextSibling)&&ns.nodeType!=1){}if(!ns||ns.$canLeechSkin!="item"){p.dispatchEvent("afterload");
if(p.autoselect){p.$selectDefault(this.parentNode);}}};return;}this.$ext=this.$getExternal(this.$isLeechingSkin?"item":"main",null,function($ext){var o="var o = apf.lookup("+this.$uniqueId+"); if (o.disabled) return; o";
$ext.setAttribute("onmouseup",o+".$up(event)");$ext.setAttribute("onmousemove",o+".$over(event)");
$ext.setAttribute("onmouseout",o+".$out(event)");$ext.setAttribute("onmousedown",o+".$down()");
$ext.setAttribute("onclick",o+".$click()");});this.$caption=this.$getLayoutNode("item","caption",this.$ext);
this.$icon=this.$getLayoutNode("item","icon",this.$ext);this.$hotkey=this.$getLayoutNode("item","hotkey",this.$ext);
if(!isSkinSwitch&&this.nextSibling&&this.nextSibling.$ext){this.$ext.parentNode.insertBefore(this.$ext,this.nextSibling.$ext);
}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var isSkinSwitch=this.$ext?true:false;
if(isSkinSwitch){if(typeof this.checked!=="undefined"){this.$handlePropSet("checked",this.checked);
}else{if(typeof this.selected!=="undefined"){this.$handlePropSet("selected",this.selected);
}}if(this.disabled){this.$handlePropSet("disabled",this.disabled);}if(this.caption){this.$handlePropSet("caption",this.caption);
}}});}).call(apf.item.prototype=new apf.Presentation());apf.aml.setElement("item",apf.item);
apf.junction=function(){this.$init("junction",apf.NODE_HIDDEN);};(function(){this.$focussable=false;
this.autoshow=true;this.$booleanProperties.autoshow=true;this.$propHandlers["for"]=function(value){if(this.$amlLoaded){init.call(this);
}};function init(e){var _self=this;if(apf.window.vManager.permanent(this.parentNode,function(){_self.$reparent();
},function(){})){this.$reparent();}}this.$reparent=function(){var amlNode=self[this["for"]];
if(!amlNode){return;}if(this.autoshow){amlNode.show();}this.parentNode.insertBefore(amlNode,this);
};this.addEventListener("DOMNodeInsertedIntoDocument",init);}).call(apf.junction.prototype=new apf.AmlElement());
apf.aml.setElement("junction",apf.junction);apf.label=function(struct,tagName){this.$init(tagName||"label",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.ChildValue);var _self=this;this.$focussable=false;
var forElement;this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.value;};this.$supportedProperties.push("caption","for","textalign");
this.$propHandlers.caption=function(value){this.$caption.innerHTML=value;};this.$propHandlers["for"]=function(value){forElement=typeof value=="string"?self[value]:value;
};this.$propHandlers.textalign=function(value){this.$caption.style.textAlign=value||"";
};this.$draw=function(){this.$ext=this.$getExternal();this.$caption=this.$getLayoutNode("main","caption",this.$ext);
if(this.$caption.nodeType!=1){this.$caption=this.$caption.parentNode;}this.$ext.onmousedown=function(){if(forElement&&forElement.$focussable&&forElement.focussable){forElement.focus();
}};var _self=this;apf.addListener(this.$ext,"click",function(e){if(!_self.disabled){_self.dispatchEvent("click",{htmlEvent:e});
}});apf.addListener(this.$ext,"mouseover",function(e){if(!_self.disabled){_self.dispatchEvent("mouseover",{htmlEvent:e});
}});apf.addListener(this.$ext,"mouseout",function(e){if(!_self.disabled){_self.dispatchEvent("mouseout",{htmlEvent:e});
}});};this.$childProperty="caption";}).call(apf.label.prototype=new apf.BaseSimple());
apf.aml.setElement("label",apf.label);apf.lineselect=function(struct,tagName){this.$init(tagName||"lineselect",apf.NODE_VISIBLE,struct);
};(function(){this.deselect=function(){this.value=this.selected=null;};this.select=function(node){if(this.selected){this.selected.className=this.skin.clsItem;
}node.className=this.skin.clsSelected;this.selected=node;this.dispatchEvent("afterselect",node.innerHTML);
};this.$focus=function(){if(this.selected){this.selected.className=this.skin.clsSelected;
}};this.$blur=function(){if(this.selected){this.selected.className=this.skin.clsBlur;
}};this.$focussable=true;this.getHTML=function(t){t=t.replace(/</g,"&lt;");t=t.replace(/>/g,"&gt;");
t=t.replace(/(^|\n)[^\(]*\(/g,"\n(");return t;};this.loadText=function(text){var ar=this.getHTML(text).split("\n");
for(var i=0;i<ar.length;i++){if(ar[i].match(/error \E/)){var clr="red";}else{if(ar[i].match(/warning \P/)){var clr="yellow";
}else{var clr="white";}}ar[i]="<div style='color:"+clr+"' onmousedown='apf.lookup("+this.$uniqueId+").select(this)' ondblclick=\"apf.lookup("+this.$uniqueId+").dispatchEvent('onchoose', this.innerHTML)\" class='"+this.skin.clsItem+"'>"+ar[i]+"</div>";
}this.$ext.innerHTML="<div style='color:white' class='"+this.skin.clsItem+"'>APF Packager</div><div nowrap style='color:white' class='"+this.skin.clsItem+"'>(c) 2001-2003 All Rights Reserved.</div><br>"+ar.join("");
};this.addEventListener("keydown",function(e){var key=e.keyCode;if(this.renaming){if(key==27||key==13){this.stopRename();
if(key==13){this.stopRename();}}return;}if(!this.selected){return;}switch(key){case 13:this.dispatchEvent("choose");
break;case 38:if(!this.value){return;}var node=this.value;if(node.previousSibling){node=node.previousSibling;
}if(node&&node.nodeType==1){this.select(document.getElementById(node.getAttribute("id")));
}return false;break;case 40:if(!this.value){return;}var node=this.value;if(node.nextSibling){node=node.nextSibling;
}if(node&&node.nodeType==1){this.select(document.getElementById(node.getAttribute("id")));
}return false;break;}},true);this.$draw=function(clear,parentNode){this.$ext=this.$getExternal();
this.$int=this.$ext;};}).call(apf.lineselect.prototype=new apf.GuiElement());apf.aml.setElement("lineselect",apf.lineselect);
apf.list=function(struct,tagName){this.$init(tagName||"list",apf.NODE_VISIBLE,struct);
};apf.thumbnail=function(struct,tagName){this.$init(tagName||"thumbnail",apf.NODE_VISIBLE,struct);
};apf.select=function(struct,tagName){this.$init(tagName||"select",apf.NODE_VISIBLE,struct);
};apf.select1=function(struct,tagName){this.$init(tagName||"selectl",apf.NODE_VISIBLE,struct);
};(function(){this.morePos="end";if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;
}var x=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!x){return;
}return x.nodeType==1?x:x.parentNode;};this.$selectSeries=function(e){e=e||event;
var target=e.target||e.srcElement;if(e.type=="mouseover"){var target=(target.className||"").indexOf("item")!=-1?target:target.parentNode;
this.highlight(target);}else{target=e.toElement?e.toElement:(e.relatedTarget?e.relatedTarget:null);
if(!apf.isChildOf(this.$ext,target,true)){this.highlight(this.$selected);}}};this.highlight=function(target){var options=this.$ext.childNodes;
var options_len=options.length;var deselect=false;for(var i=0;i<options_len;i++){if((options[i].className||"").indexOf("item")!=-1){if(!deselect){this.$setStyleClass(options[i],"selected");
}else{this.$setStyleClass(options[i],"",["selected"]);}if(options[i]==target){deselect=true;
}}}};this.addEventListener("afterselect",function(e){if(this.hasFeature(apf.__VALIDATION__)){this.validate(true);
}});this.$supportedProperties.push("appearance","mode","more","thumbsize","morepos");
this.$propHandlers.morepos=function(value){this.morePos=value;};this.$propHandlers.thumbsize=function(value){var className=this.thumbclass;
if(apf.isIE){className=className.splitSafe(",");for(var i=0;i<className.length;
i++){apf.setStyleRule(className[i],"width",value+"px");apf.setStyleRule(className[i],"height",value+"px");
}return;}apf.setStyleRule(className,"width",value+"px");apf.setStyleRule(className,"height",value+"px");
};this.$propHandlers.appearance=function(value){};this.$propHandlers.more=function(value){if(value){this.delayedselect=false;
this.addEventListener("xmlupdate",$xmlUpdate);this.addEventListener("afterload",$xmlUpdate);
this.$addMoreItem=function(msg){if(!this.moreItem){this.$fill();}if(this.morePos=="begin"){this.$container.insertBefore(this.moreItem,this.$container.firstChild);
}else{this.$container.appendChild(this.moreItem);}};this.$updateClearMessage=function(){};
this.$removeClearMessage=function(){};}else{this.removeEventListener("xmlupdate",$xmlUpdate);
this.removeEventListener("afterload",$xmlUpdate);}};function $xmlUpdate(e){if((!e.action||"insert|add|synchronize|move".indexOf(e.action)>-1)&&this.moreItem){if(this.morePos=="begin"){this.$container.insertBefore(this.moreItem,this.$container.firstChild);
}else{this.$container.appendChild(this.moreItem);}}}this.addEventListener("keydown",this.$keyHandler,true);
this.$draw=function(){this.appearance=this.getAttribute("appearance")||"compact";
this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);
if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var _self=this;
this.$ext.onclick=function(e){_self.dispatchEvent("click",{htmlEvent:e||event});
};this.$gridlist=apf.isTrue(this.$getOption("main","grid"));if(this.$gridlist){this.$ext.setAttribute("onmouseout",this.$ext.getAttribute("onmouseout")+";var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");
}this.listtype=parseInt(this.$getOption("main","type"))||1;this.behaviour=parseInt(this.$getOption("main","behaviour"))||1;
this.thumbsize=this.$getOption("main","thumbsize");this.thumbclass=this.$getOption("main","thumbclass");
};this.$loadAml=function(x){};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;
}apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.list.prototype=new apf.BaseList());
apf.thumbnail.prototype=apf.select.prototype=apf.select1.prototype=apf.list.prototype;
apf.aml.setElement("thumbnail",apf.thumbnail);apf.aml.setElement("select",apf.select);
apf.aml.setElement("select1",apf.select1);apf.aml.setElement("list",apf.list);apf.loader=function(){this.$init("loader",apf.NODE_HIDDEN);
this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,pHtmlNode,null,(this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize()).replace(/^<[^>]*>\s*|\s*<[^>]*>$/g,""));
if(!apf.loaded){var _self=this;apf.addEventListener("load",function(){if(apf.config.autoHideLoading){apf.queue.empty();
_self.hide();}});}});};apf.loader.prototype=new apf.AmlElement();apf.aml.setElement("loader",apf.loader);
apf.loadindicator=function(struct,tagName){this.$init(tagName||"loadindicator",apf.NODE_VISIBLE,struct);
};(function(){this.spinnerspeed=66;this.$running=false;this.$loadingFrame=1;this.framelength=12;
this.frameheight=40;this.framewidth=40;this.$timer;this.$supportedProperties.push("framewidth","frameheight","src","framelength","spinnerspeed");
this.$propHandlers.framewidth=function(value){this.framewidth=value;this.oSpinner.style.width=value+"px";
this.oContainer.style.width=value+"px";};this.$propHandlers.frameheight=function(value){this.frameheight=value;
this.oContainer.style.height=value+"px";};this.$propHandlers.framelength=function(value){this.framelength=value;
this.oSpinner.style.height=value*this.frameheight+"px";};this.$propHandlers.spinnerspeed=function(value){this.spinnerspeed=value;
};this.$propHandlers.src=function(value){this.oSpinner.style.backgroundImage="url("+value+")";
};this.start=function(){if(this.$running){return;}this.$running=true;var _self=this;
this.oContainer.style.display="block";this.$timer=setInterval(function(){_self.oSpinner.style.top=(_self.$loadingFrame*-_self.frameheight)+"px";
_self.$loadingFrame=(_self.$loadingFrame+1)%_self.framelength;},this.spinnerspeed);
};this.stop=function(restart){clearInterval(this.$timer);this.oContainer.style.display="none";
if(restart){this.$loadingFrame=1;this.oSpinner.style.top=0;}this.$running=false;
};this.$draw=function(){this.$ext=this.$getExternal();this.oContainer=this.$getLayoutNode("main","container",this.$ext);
this.oSpinner=this.$getLayoutNode("main","spinner",this.$ext);var framewidth,frameheight,framelength,spinnerspeed;
if(framewidth=this.getAttribute("framewidth")){this.framewidth=framewidth;this.oSpinner.style.width=framewidth+"px";
this.oContainer.style.width=framewidth+"px";}if(frameheight=this.getAttribute("frameheight")){this.frameheight=frameheight;
this.oContainer.style.height=frameheight+"px";}if(framelength=this.getAttribute("framelength")){this.framelength=framelength;
this.oSpinner.style.height=framelength*this.frameheight+"px";}if(spinnerspeed=this.getAttribute("spinnerspeed")){this.spinnerspeed=spinnerspeed;
}};}).call(apf.loadindicator.prototype=new apf.Presentation());apf.aml.setElement("loadindicator",apf.loadindicator);
apf.map=function(struct,tagName){this.$init(tagName||"map",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.StandardBinding,apf.DataAction);this.$focussable=true;
this.$hasMaptypeControl=true;this.$hasNavigationControl=true;this.$hasScaleControl=true;
this.$mapTypeControl={};this.$navigationControl={};this.$scaleControl={};this.$markers={};
this.$map=null;this.$booleanProperties.draggable=true;this.$booleanProperties.loaded=true;
this.$supportedProperties.push("latitude","longitude","bgcolor","draggable","maptypecontrol","navigationcontrol","scalecontrol","type","zoom","marker","marker-icon","loaded");
this.latitude=0;this.longitude=0;this.bgcolor=null;this.draggable=true;this.maptypecontrol=true;
this.navigationcontrol=true;this.scalecontrol=true;this.type=null;this.zoom=9;this.loaded=false;
var timer,deltimer,lastpos,delegates=[],_slice=Array.prototype.slice,loaddone=false;
this.$propHandlers.latitude=this.$propHandlers.longitude=function(value,prop){if(!value){return;
}clearTimeout(timer);this[prop]=parseFloat(value);var _self=this;timer=setTimeout(function(){_self.setValue(_self.latitude,_self.longitude);
});};function delegate2(func,args){var _self=this;$setTimeout(function(){delegate.call(_self,func,args);
});}function delegate(func,args){clearTimeout(deltimer);args=_slice.call(args);
var i=delegates.indexOf(func),l=args.length;if(i>-1){if(l&&args[0]){delegates[i].$__args=args;
}return;}if(!l||!args[0]){return;}func.$__args=args;if(i===-1){delegates.push(func);
}}function callDelegates(){clearTimeout(deltimer);if(!loaddone){var _self=this;
deltimer=$setTimeout(function(){callDelegates.call(_self);},1000);return;}var d,i=0,l=delegates.length;
if(!l){return;}for(;i<l;++i){if(typeof(d=delegates[i])!="function"){continue;}d.apply(this,d.$__args);
delete d.$__args;}delegates=[];}function parseOptions(sOpts){sOpts=sOpts||"";var t,aOpts=sOpts.splitSafe(",|;"),oOpts={},i=0,l=aOpts.length;
for(;i<l;++i){if(!aOpts[i]){continue;}t=aOpts[i].splitSafe(":|=");if(t.length!=2){continue;
}oOpts[t[0]]=typeof t[1]=="string"?t[1].toLowerCase():t[1];}return oOpts;}this.$propHandlers.maptypecontrol=function(value){this.maptypecontrol=!apf.isFalse(value);
this.$mapTypeControl={};if(!this.maptypecontrol){return;}if(loaddone){var o=parseOptions(value),oPos=google.maps.ControlPosition,oStyle=google.maps.MapTypeControlStyle;
o.position=typeof o.position!="undefined"?o.position.replace(/\-/g,"_").toUpperCase():"TOP_RIGHT";
this.$mapTypeControl.position=oPos[o.position]||oPos.TOP_LEFT;switch(o.style){case"dropdown":this.$mapTypeControl.style=oStyle.DROPDOWN_MENU;
break;case"bar":this.$mapTypeControl.style=oStyle.HORIZONTAL_BAR;break;default:case"default":this.$mapTypeControl.style=oStyle.DEFAULT;
}}if(!this.$map){return delegate2.call(this,arguments.callee,arguments);}this.$map.setOptions({mapTypeControl:this.maptypecontrol,mapTypeControlOptions:this.$mapTypeControl});
};this.$propHandlers.navigationcontrol=function(value){this.navigationcontrol=!apf.isFalse(value);
this.$navigationControl={};if(!this.navigationcontrol){return;}if(loaddone){var o=parseOptions(value),oPos=google.maps.ControlPosition,oStyle=google.maps.NavigationControlStyle;
o.position=typeof o.position!="undefined"?o.position.replace(/\-/g,"_").toUpperCase():"TOP_LEFT";
this.$navigationControl.position=oPos[o.position]||oPos.TOP_LEFT;switch(o.style){case"android":this.$navigationControl.style=oStyle.ANDROID;
break;case"small":this.$navigationControl.style=oStyle.SMALL;break;case"zoompan":this.$navigationControl.style=oStyle.ZOOM_PAN;
break;default:case"default":this.$navigationControl.style=oStyle.DEFAULT;}}if(!this.$map){return delegate2.call(this,arguments.callee,arguments);
}this.$map.setOptions({navigationControl:this.navigationcontrol,navigationControlOptions:this.$navigationControl});
};this.$propHandlers.scalecontrol=function(value){this.scalecontrol=!apf.isFalse(value);
this.$scaleControl={};if(!this.scalecontrol){return;}if(loaddone){var o=parseOptions(value),oPos=google.maps.ControlPosition,oStyle=google.maps.ScaleControlStyle;
o.position=typeof o.position!="undefined"?o.position.replace(/\-/g,"_").toUpperCase():"BOTTOM_LEFT";
this.$scaleControl.position=oPos[o.position]||oPos.TOP_LEFT;switch(o.style){default:case"default":this.$scaleControl.style=oStyle.DEFAULT;
}}if(!this.$map){return delegate2.call(this,arguments.callee,arguments);}this.$map.setOptions({scaleControl:this.scalecontrol,scaleControlOptions:this.$scaleControl});
};this.$propHandlers.type=function(value){if(!value){return;}if(loaddone){this.type=google.maps.MapTypeId[value.toUpperCase()];
}if(!this.$map){return delegate2.call(this,arguments.callee,arguments);}this.$map.setMapTypeId(this.type);
};this.$propHandlers.zoom=function(value){this.zoom=parseInt(value);if(!this.$map){return delegate.call(this,arguments.callee,arguments);
}this.$map.setZoom(this.zoom);};this.$propHandlers.marker=function(value){this.addMarker(value);
};this.setValue=function(lat,lon){if(!lat||!lon){return;}if(!loaddone){return delegate.call(this,arguments.callee,arguments);
}if(lat){this.latitude=parseFloat(lat);}if(lon){this.longitude=parseFloat(lon);
}if(!this.$map){return delegate2.call(this,arguments.callee,arguments);}lastpos=new google.maps.LatLng(this.latitude,this.longitude);
this.$map.setCenter(lastpos);var _self=this;$setTimeout(function(){callDelegates.call(_self);
});};this.getValue=function(){return{latitude:this.latitude,longitude:this.longitude};
};var addressParts={street_number:1,route:1,sublocality:1,locality:1,administrative_area_level_1:1,country:1,postal_code:1};
function parseAddress(addr){var o,k,m,i=0,l=addr.address_components.length,res={};
for(;i<l;++i){o=addr.address_components[i];for(k=0,m=o.types.length;k<m;++k){if(!addressParts[o.types[k]]){continue;
}res[o.types[k]]={long_name:o.long_name,short_name:o.short_name};}}return res;}this.getLocation=function(cb,coords){if(!loaddone){return delegate.call(this,arguments.callee,arguments);
}if(!this.$geo){this.$geo=new google.maps.Geocoder();}var pos=lastpos;if(coords&&coords.latitude&&coords.longitude){pos=new google.maps.LatLng(coords.latitude,coords.longitude);
}if(!pos){return cb(null);}this.$geo.geocode({location:pos},function(res,st){if(st!=google.maps.GeocoderStatus.OK){return cb(null);
}cb(parseAddress(res[0]));});};function getFunctionPointer(name){var i,p=self,aName=name.splitSafe("."),sFunc=aName.pop();
while(p[i=aName.shift()]){p=p[i];}return p[sFunc]||apf.K;}function markerExists(lat,lon){for(var loc in this.$markers){if(loc[0]==lat&&loc[1]==lon){return this.$markers[loc];
}}return false;}this.addMarker=function(title,content,coords){if(!this.$map){delegate2.call(this,arguments.callee,arguments);
return false;}var pos=lastpos;if(coords&&coords.latitude&&coords.longitude){pos=new google.maps.LatLng(coords.latitude,coords.longitude);
}if(!pos){delegate2.call(this,arguments.callee,arguments);return false;}if(this["marker-icon"]&&!this.$markerIcon){this.$markerIcon=new apf.url(this["marker-icon"]).uri;
}var lat=pos.lat(),lon=pos.lng(),marker=markerExists(lat,lon);if(!marker){marker=this.$markers[[lat,lon]]=new google.maps.Marker({position:pos,map:this.$map,title:title||"Marker",icon:this.$markerIcon||null});
}if(!content){return marker;}if(marker.infowindow){marker.infowindow.setContent(content);
}else{var _self=this;marker.infowindow=new google.maps.InfoWindow({content:content});
google.maps.event.addListener(marker,"click",function(){marker.infowindow.open(_self.$map,marker);
});}return marker;};this.removeMarker=function(coords){if(!this.$map){return delegate2.call(this,arguments.callee,arguments);
}var pos=lastpos;if(coords&&coords.latitude&&coords.longitude){pos=new google.maps.LatLng(coords.latitude,coords.longitude);
}if(!pos){return delegate2.call(this,arguments.callee,arguments);}var lat=pos.lat(),lon=pos.lng();
for(var i in this.$markers){if(i[0]!==lat||i[1]!==lon){continue;}this.$markers[i].setMap(null);
if(this.$markers[i].infowindow){this.$markers[i].infowindow.close();delete this.$markers[i].infowindow;
}delete this.$markers[i];break;}};this.$draw=function(){if(!this.$ext){var doc=this.$pHtmlNode.ownerDocument;
this.$ext=this.$pHtmlNode.appendChild(doc.createElement("div"));this.$ext.className=this.localName;
}if(!loaddone){return;}callDelegates.call(this);this.$map=new google.maps.Map(this.$ext,{zoom:this.zoom,mapTypeControl:this.maptypecontrol,mapTypeControlOptions:this.$mapTypeControl,navigationControl:this.navigationcontrol,navigationControlOptions:this.$navigationControl,scaleControl:this.scalecontrol,scaleControlOptions:this.$scaleControl,mapTypeId:this.type||google.maps.MapTypeId.HYBRID});
var _self=this;$setTimeout(function(){callDelegates.call(_self);_self.setProperty("loaded",true);
_self.dispatchEvent("loaded");});};this.$destroy=function(){if(this.$map){var div=this.$map.getDiv();
div.parentNode.removeChild(div);delete this.$map;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(){var _self=this;
function loaded(){loaddone=true;if(apf.window.vManager.check(_self,"map",_self.$draw)){_self.$draw();
}try{delete self.google_maps_initialize;}catch(e){}}if(typeof google=="undefined"||typeof google.maps=="undefined"){self.google_maps_initialize=function(){loaded();
};var head=document.getElementsByTagName("head")[0],script=document.createElement("script");
script.type="text/javascript";script.src="http://maps.google.com/maps/api/js?sensor=true&callback=google_maps_initialize";
document.body.appendChild(script);}else{loaded();}});}).call(apf.map.prototype=new apf.GuiElement());
apf.aml.setElement("map",apf.map);var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;
apf.markupedit=function(struct,tagName){this.$init(tagName||"markupedit",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.Cache,apf.Rename);this.$isTreeArch=true;
this.$focussable=true;this.$preventRecursiveUpdate=true;this.$enableTextNodeHack=true;
this.startcollapsed=true;this.$animType=0;this.$animSteps=3;this.$animSpeed=20;
this.reselectable=true;this.autoselect=false;this.bufferselect=true;this.prerender=false;
this.each="node()[local-name(.) and not(@nomk = 'true')]";this.$dynCssClasses=[];
this.expandAndSelect=function(xmlNode){if(!this.xmlRoot){return;}var _self=this;
if((function _recur(loopNode){var pNode=_self.getTraverseParent(loopNode);if(!pNode||pNode!=_self.xmlRoot&&_recur(pNode)===false){return false;
}_self.slideToggle(apf.xmldb.getHtmlNode(pNode,_self),1,true);})(xmlNode)!==false){this.select(xmlNode);
var oExt=this.$container;var selHtml=this.$getLayoutNode("item","select",apf.xmldb.findHtmlNode(xmlNode,this));
var top=apf.getAbsolutePosition(selHtml,oExt)[1]+oExt.scrollTop;if(top<=oExt.scrollTop){oExt.scrollTop=top;
}else{top+=selHtml.offsetHeight;if(top>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=top-oExt.offsetHeight;
}}}};this.setAttributeValue=function(xmlNode,name,value){if(!xmlNode){xmlNode=this.caret||this.selected;
}if(!xmlNode||xmlNode.getAttribute(name)==value){return;}this.$executeAction("setAttribute",[xmlNode,name,value],"setAttributeValue",xmlNode);
};this.removeAttribute=function(xmlNode,name,value){if(!xmlNode){xmlNode=this.caret||this.selected;
}if(!xmlNode||xmlNode.getAttribute(name)==value){return;}this.$executeAction("removeAttribute",[xmlNode,name],"removeAttribute",xmlNode);
};this.renameAttribute=function(xmlNode,name,newName){if(!xmlNode){xmlNode=this.caret||this.selected;
}if(!xmlNode||name==newName){return;}this.$executeAction("multicall",[{action:"removeAttribute",args:[xmlNode,name]},{action:"setAttribute",args:[xmlNode,newName,xmlNode.getAttribute(name)]}],"renameAttribute",xmlNode);
};this.setTextNode=function(xmlNode,value){if(!xmlNode){xmlNode=this.caret||this.selected;
}if(!xmlNode||apf.queryValue(xmlNode,"text()")==value){return;}this.$executeAction("setTextNode",[xmlNode,value],"setTextNode",xmlNode);
};this.slideToggle=function(htmlNode,force,immediate){if(this.nocollapse){return;
}if(!htmlNode){htmlNode=this.$selected;}var id=htmlNode.getAttribute(apf.xmldb.htmlIdTag);
while(!id&&htmlNode.parentNode){var id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}var elClass,container=this.$getLayoutNode("item","container",htmlNode);if(apf.getStyle(container,"display")=="block"){if(force==1){return;
}elClass=this.$getLayoutNode("item","openclose",htmlNode);elClass.className=elClass.className.replace(/min/,"plus");
htmlNode.className=htmlNode.className.replace(/min/,"plus");this.slideClose(container,apf.xmldb.getNode(htmlNode),immediate);
}else{if(force==2){return;}elClass=this.$getLayoutNode("item","openclose",htmlNode);
elClass.className=elClass.className.replace(/plus/,"min");htmlNode.className=htmlNode.className.replace(/plus/,"min");
this.slideOpen(container,apf.xmldb.getNode(htmlNode),immediate);}};this.isCollapsed=function(xmlNode){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(xmlNode,this)),"display")=="none");
};var lastOpened={};this.slideOpen=function(container,xmlNode,immediate){if(!xmlNode){xmlNode=this.selected;
}var htmlNode=apf.xmldb.findHtmlNode(xmlNode,this);if(!container){container=this.$findContainer(htmlNode);
}if(!container.innerHTML&&!this.getTraverseNodes(xmlNode).length){return;}if(this.singleopen){var pNode=this.getTraverseParent(xmlNode),p=(pNode||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);
if(lastOpened[p]&&lastOpened[p][1]!=xmlNode&&this.getTraverseParent(lastOpened[p][1])==pNode){this.slideToggle(lastOpened[p][0],2);
}lastOpened[p]=[htmlNode,xmlNode];}container.style.display="block";if(!this.prerender&&this.$hasLoadStatus(xmlNode,"potential")){this.$extend(xmlNode,container,immediate);
return;}if(immediate){container.style.height="auto";return;}var _self=this;apf.tween.single(container,{type:"scrollheight",from:0,to:container.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(container){if(xmlNode&&_self.$hasLoadStatus(xmlNode,"potential")){$setTimeout(function(){_self.$extend(xmlNode,container);
});container.style.height="auto";}else{container.style.height="auto";}}});};this.slideClose=function(container,xmlNode){if(this.nocollapse){return;
}if(!xmlNode){xmlNode=this.selected;}if(this.singleopen){var p=(this.getTraverseParent(xmlNode)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);
lastOpened[p]=null;}container.style.height=container.offsetHeight;container.style.overflow="hidden";
apf.tween.single(container,{type:"scrollheight",from:container.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(container,data){container.style.display="none";
}});};this.doUpdate=function(xmlNode,container){var rule=this.$getBindRule("insert",xmlNode);
var xmlContext=rule&&rule[1]?rule[1](xmlNode):null;if(rule&&xmlContext){this.$setLoadStatus(xmlNode,"loading");
if(rule.getAttribute("get")){this.getModel().$insertFrom(rule.getAttribute("get"),{xmlNode:xmlContext,insertPoint:xmlContext,amlNode:this});
}else{var data=this.$applyBindRule("Insert",xmlNode);if(data){this.insert(data,{insertPoint:xmlContext});
}}}else{if(!this.prerender){this.$setLoadStatus(xmlNode,"loading");var result=this.$addNodes(xmlNode,container,true);
xmlUpdateHandler.call(this,"insert",xmlNode,result);}}};var treeState={};treeState[0]="";
treeState[HAS_CHILD]="min";treeState[HAS_CHILD|IS_CLOSED]="plus";treeState[IS_LAST]="last";
treeState[IS_LAST|HAS_CHILD]="minlast";treeState[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";
treeState[IS_ROOT]="root";this.$fixItem=function(xmlNode,htmlNode,isDeleting,oneLeft,noChildren){if(!htmlNode){return;
}if(isDeleting){var prevSib;if(prevSib=this.getNextTraverse(xmlNode,true)){this.$fixItem(prevSib,this.$findHtmlNode(prevSib.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);
}if(!this.emptyMessage&&xmlNode.parentNode.selectNodes(this.each).length==1){this.$fixItem(xmlNode.parentNode,this.$findHtmlNode(xmlNode.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);
}}else{var hasChildren,container=this.$getLayoutNode("item","container",htmlNode);
if(noChildren){hasChildren=false;}else{if(xmlNode.selectNodes(this.each).length>0){hasChildren=true;
}else{if(this.$getBindRule("insert",xmlNode)){hasChildren=true;}else{hasChildren=false;
}}}var isClosed=hasChildren&&container.style.display!="block";var isLast=this.getNextTraverse(xmlNode,null,oneLeft?2:1)?false:true;
var state=(hasChildren?HAS_CHILD:0)|(isClosed?IS_CLOSED:0)|(isLast?IS_LAST:0);this.$setStyleClass(this.$getLayoutNode("item","openclose",htmlNode),treeState[state],["min","plus","last","minlast","pluslast"]);
this.$setStyleClass(htmlNode,treeState[state],["min","plus","last","minlast","pluslast"]);
if(!hasChildren){container.style.display="none";}if(state&HAS_CHILD){}}};this.startRenameThis=function(oHtml,Lid,isName,id){if(this.renaming){this.stopRename(null,true);
var _self=this;return setTimeout(function(){_self.startRenameThis(oHtml,Lid,isName);
});}this.$getCaptionElement=function(){return oHtml;};var attrName=oHtml.getAttribute("aname");
var xmlNode=id?knownElements[id]:apf.xmldb.getNodeById(Lid);if(!xmlNode){throw new Error();
}this.$multiLineRename=id&&xmlNode.nodeType!=3?true:false;this.$getCaptionXml=function(){return xmlNode.nodeType!=1?xmlNode:(attrName?xmlNode.getAttributeNode(attrName):xmlNode.firstChild);
};this.getSelectFromRule=function(setname,cnode){return[null,xmlNode.nodeType!=1?xmlNode:(attrName?xmlNode.getAttributeNode(attrName):xmlNode.firstChild)];
};this.$validateRename=function(value){return !isName||!value||value.match(/^[a-z]/i);
};this.rename=function(x,value){this.$noanim=true;if(attrName){if(isName){if(value==""){this.removeAttribute(xmlNode,attrName);
}else{this.renameAttribute(xmlNode,attrName,value);}}else{this.setAttributeValue(xmlNode,attrName,value);
}}else{this.setTextNode(xmlNode,value);}this.$noanim=false;};this.startRename();
if(isName){this.$txt[apf.hasContentEditable?"innerHTML":"value"]=attrName;this.$txt.className="";
}else{this.$txt.className="attrvalue";}apf.selectTextHtml(this.$txt);};function addAttribute(pNode,name,value,htmlNode,Lid){this.$getNewContext("attribute");
var elName=this.$getLayoutNode("attribute","name");var elValue=this.$getLayoutNode("attribute","value");
apf.setNodeValue(elName,name);apf.setNodeValue(elValue,(value.length>50?"...":value));
if(value.length>50){elValue.setAttribute("title",value);}elName.setAttribute("aname",name);
elName.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+Lid+"', true);            apf.stopPropagation(event);");
elName.setAttribute("onmouseup","            apf.stopPropagation(event);            return false;");
elName.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            apf.stopPropagation(event);");
elName.setAttribute("onselectstart","event.cancelBubble = true;");elName.setAttribute("ondblclick","event.cancelBubble = true;");
elValue.setAttribute("aname",name);elValue.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+Lid+"');            apf.stopPropagation(event);");
elValue.setAttribute("onmouseup","            apf.stopPropagation(event);            return false;");
elValue.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            apf.stopPropagation(event);");
elValue.setAttribute("onselectstart","event.cancelBubble = true;");elValue.setAttribute("ondblclick","event.cancelBubble = true;");
if(pNode.style){this.$setStyleClass(this.$getLayoutNode("attribute"),"generated");
htmlNode=apf.insertHtmlNode(this.$getLayoutNode("attribute"),pNode,this.$getLayoutNode("item","begintag",htmlNode).nextSibling);
if(!this.$noanim){animHighlight(htmlNode);animHighlight(this.$getLayoutNode("attribute","name",htmlNode));
animHighlight(this.$getLayoutNode("attribute","value",htmlNode));}}else{pNode.appendChild(this.$getLayoutNode("attribute"));
}}function addTextnode(pNode,value,Lid){this.$getNewContext("textnode");var elTextNode=this.$getLayoutNode("textnode","text");
var elTag=this.$getLayoutNode("textnode","tag");apf.setNodeValue(elTextNode,(value.length>50?"...":value));
if(value.length>50){elTextNode.setAttribute("title",value);}elTextNode.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+Lid+"');");
elTextNode.setAttribute("onmouseup","            apf.stopPropagation(event);            return false;");
elTextNode.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            apf.stopPropagation(event);");
elTextNode.setAttribute("onselectstart","event.cancelBubble = true;");elTextNode.setAttribute("ondblclick","event.cancelBubble = true;");
apf.setNodeValue(elTag,"&gt;");if(pNode.style){var htmlNode=apf.insertHtmlNode(this.$getLayoutNode("textnode"),pNode,pNode.lastChild);
if(!this.$noanim){animHighlight(this.$getLayoutNode("textnode","text",htmlNode));
}}else{pNode.appendChild(this.$getLayoutNode("textnode"));}}this.$initNode=function(xmlNode,state,Lid){this.$getNewContext("item");
var hasChildren=(state&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",xmlNode));
var elItem=this.$getLayoutNode("item");elItem.setAttribute(apf.xmldb.htmlIdTag,Lid);
this.$setStyleClass(this.$getLayoutNode("item","openclose"),treeState[state]);this.$setStyleClass(this.$getLayoutNode("item"),treeState[state]);
var elOpenClose=this.$getLayoutNode("item","openclose");if(hasChildren){elOpenClose.setAttribute(this.opencloseaction||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this);                apf.cancelBubble(event,o);");
}var elSelect=this.$getLayoutNode("item","select");if(hasChildren){var strFunc2="var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, true);";
}elSelect.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            apf.cancelBubble(event, o);            if (o.hasFocus())                 o.select(this);"+(strFunc2&&this.opencloseaction=="onmousedown"?strFunc2:""));
var elBegin=this.$getLayoutNode("item","begintag");apf.setNodeValue(elBegin,"&lt;"+xmlNode.tagName);
var elAttributes=this.$getLayoutNode("item","attributes");var len=xmlNode.attributes.length;
if(typeof len=="function"){len=xmlNode.attributes.length();}for(var i=0;i<len;i++){var attr=xmlNode.attributes.item(i);
if(attr.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}addAttribute.call(this,elAttributes,attr.nodeName,attr.nodeValue,null,Lid);
}var elBeginTail=this.$getLayoutNode("item","begintail");var elEnd=this.$getLayoutNode("item","endtag");
if(!(state&HAS_CHILD)){elEnd.setAttribute("style","display:none");if(this.$enableTextNodeHack&&(xmlNode.childNodes.length>1||xmlNode.childNodes.length==1&&xmlNode.firstChild.nodeValue.trim())){addTextnode.call(this,elAttributes,xmlNode.childNodes[0].nodeValue,Lid);
apf.setNodeValue(elBeginTail,"&lt;/"+xmlNode.tagName+"&gt;");}else{apf.setNodeValue(elBeginTail," /&gt;");
}}else{apf.setNodeValue(elEnd,"&lt;/"+xmlNode.tagName+"&gt;");apf.setNodeValue(elBeginTail,"&gt;");
}elBeginTail.parentNode.appendChild(elBeginTail);elEnd.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");apf.cancelBubble(event, o);");
var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass){this.$setStyleClass(this.$getLayoutNode("item",null,this.$getLayoutNode("item")),cssClass);
if(cssClass){this.$dynCssClasses.push(cssClass);}}return this.$getLayoutNode("item");
};this.$deInitNode=function(xmlNode,htmlNode){var containerNode=this.$getLayoutNode("item","container",htmlNode);
var pContainer=htmlNode.parentNode;containerNode.parentNode.removeChild(containerNode);
pContainer.removeChild(htmlNode);if(xmlNode.parentNode!=this.xmlRoot){this.$fixItem(xmlNode,htmlNode,true);
}if(this.emptyMessage&&!pContainer.childNodes.length){this.setEmpty(pContainer);
}this.$fixItem(xmlNode,htmlNode,true);if(xmlNode==this.selected){this.clearSelection();
}};function animHighlight(oHtml){if(!oHtml.offsetHeight){return;}apf.setStyleClass(oHtml,"highlight");
$setTimeout(function(){apf.setStyleClass(oHtml,"",["highlight"]);},1000);}this.$updateNode=function(xmlNode,htmlNode){var len,i,aLookup={};
var elAttributes=this.$getLayoutNode("item","attributes",htmlNode);var elEnd=this.$getLayoutNode("item","endtag",htmlNode);
var elBeginTail=this.$getLayoutNode("item","begintail",htmlNode);len=xmlNode.attributes.length;
for(var i=0;i<len;i++){var attr=xmlNode.attributes.item(i);if(attr.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;
}aLookup[attr.nodeName]=attr.nodeValue;}var doneFirstChild=false;var deleteQueue=[];
var nodes=[],cnodes=elAttributes.childNodes;for(i=0;i<cnodes.length;i++){nodes.push(cnodes[i]);
}for(i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;}if(nodes[i].className.indexOf("textnode")>-1){if(xmlNode.childNodes.length==1&&xmlNode.childNodes[0].nodeType==3){var elText=this.$getLayoutNode("textnode","text",nodes[i]);
if(xmlNode.firstChild.nodeValue!=elText.innerHTML){elText.innerHTML=xmlNode.firstChild.nodeValue;
animHighlight(elText);}}else{nodes[i].parentNode.removeChild(nodes[i]);apf.setNodeValue(elBeginTail," /&gt;");
}doneFirstChild=true;}if(nodes[i].className.indexOf("attribute")==-1){continue;
}var elName=this.$getLayoutNode("attribute","name",nodes[i]);var elValue=this.$getLayoutNode("attribute","value",nodes[i]);
var name=elName.innerHTML;if(!aLookup[name]){deleteQueue.push(nodes[i]);}else{if(aLookup[name]!=elValue.innerHTML){elValue.innerHTML=aLookup[name];
animHighlight(elValue);delete aLookup[name];}else{if(aLookup[name]){delete aLookup[name];
}}}elName.setAttribute("aname",name);elValue.setAttribute("aname",name);}for(var attr in aLookup){if(deleteQueue.length){var html=deleteQueue.pop();
var elName=this.$getLayoutNode("attribute","name",html);var elValue=this.$getLayoutNode("attribute","value",html);
elName.setAttribute("aname",attr);elValue.setAttribute("aname",attr);elName.innerHTML=attr;
elValue.innerHTML=aLookup[attr];animHighlight(elName);}else{addAttribute.call(this,elAttributes,attr,aLookup[attr],htmlNode,xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}}for(var i=0;i<deleteQueue.length;i++){deleteQueue[i].parentNode.removeChild(deleteQueue[i]);
}if(this.$enableTextNodeHack&&!doneFirstChild&&xmlNode.childNodes.length==1&&xmlNode.childNodes[0].nodeType==3){addTextnode.call(this,elAttributes,xmlNode.childNodes[0].nodeValue);
apf.setNodeValue(elBeginTail,"</"+xmlNode.tagName+">");}var cssClass=this.$applyBindRule("css",xmlNode);
if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}};this.clearEmpty=function(container){container.innerHTML="";};this.setEmpty=function(container){this.$getNewContext("empty");
var oItem=this.$getLayoutNode("empty");this.$getLayoutNode("empty","caption").nodeValue=this.emptyMessage;
apf.insertHtmlNode(oItem,container);if(!this.startcollapsed){if(container.style){}}};
this.$setLoading=function(xmlNode,container){this.$getNewContext("loading");this.$setLoadStatus(xmlNode,"potential");
apf.insertHtmlNode(this.$getLayoutNode("loading"),container);};this.$removeLoading=function(htmlNode){if(!htmlNode){return;
}this.$getLayoutNode("item","container",htmlNode).innerHTML="";};this.$extend=function(xmlNode,container,immediate){var rule=this.$getBindRule("insert",xmlNode),xmlContext=rule&&rule.match?(rule.cmatch||rule.compile("match"))(xmlNode):xmlNode;
if(rule&&xmlContext){this.$setLoadStatus(xmlNode,"loading");if(rule.get){if(!apf.offline.onLine){apf.offline.transactions.actionNotAllowed();
this.slideClose(container,xmlNode);return;}this.getModel().$insertFrom(rule.getAttribute("get"),{xmlNode:xmlContext,insertPoint:xmlContext,amlNode:this});
}else{if(this.$applyBindRule("insert",xmlNode)){this.insert(data,{insertPoint:xmlContext});
}}}else{if(!this.prerender){this.$setLoadStatus(xmlNode,"loaded");this.$removeLoading(apf.xmldb.findHtmlNode(xmlNode,this));
this.$noanim=true;xmlUpdateHandler.call(this,{action:"insert",xmlNode:xmlNode,result:this.$addNodes(xmlNode,container,true),anim:!immediate});
delete this.$noanim;}}};function xmlUpdateHandler(e){if(e.action=="move-away"){this.$fixItem(e.xmlNode,apf.xmldb.findHtmlNode(e.xmlNode,this),true);
}if(e.action!="insert"){return;}var htmlNode=this.$findHtmlNode(e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(!htmlNode){return;}if(this.$hasLoadStatus(e.xmlNode,"loaded")&&e.result.length>0){var container=this.$getLayoutNode("item","container",htmlNode);
this.slideOpen(container,e.xmlNode);}else{this.$fixItem(e.xmlNode,htmlNode);}}this.addEventListener("xmlupdate",xmlUpdateHandler);
this.addEventListener("beforeload",function(e){this.$enableTextNodeHack=!e.xmlNode.$regbase;
this.each=e.xmlNode.$regbase?"node()[not(@nomk = 'true') and not(local-name() = 'include')]":"node()[local-name(.) and not(@nomk = 'true')]";
});this.addEventListener("keydown",function(e){var key=e.keyCode;var ctrlKey=e.ctrlKey;
var shiftKey=e.shiftKey;var selHtml=this.$caret||this.$selected;var pos,top,el,node,nodes,sNode,pNode,container;
if(!selHtml||this.renaming){return;}var selXml=this.caret||this.selected;var oExt=this.$container;
switch(key){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);
}this.choose(selHtml);break;case 32:if(ctrlKey){this.select(this.caret,true);}break;
case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.mode?this.caret:null);
break;case 109:case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,2);
}break;case 107:case 39:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,1);
}break;case 187:if(shiftKey){arguments.callee(39);}break;case 189:if(!shiftKey){arguments.callee(37);
}break;case 38:if(!selXml&&!this.$tempsel){return;}var node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
var sNode=this.getNextTraverse(node,true);if(sNode){var nodes=this.getTraverseNodes(sNode);
do{var container=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(sNode,this)));
if(container&&apf.getStyle(container,"display")=="block"&&nodes.length){sNode=nodes[nodes.length-1];
}else{break;}}while(sNode&&(nodes=this.getTraverseNodes(sNode)).length);}else{if(this.getTraverseParent(node)==this.xmlRoot){this.dispatchEvent("selecttop");
return;}else{sNode=this.getTraverseParent(node);}}if(sNode&&sNode.nodeType==1){this.$setTempSelected(sNode,ctrlKey,shiftKey);
}else{return false;}selHtml=this.$getLayoutNode("item","select",apf.xmldb.findHtmlNode(sNode,this));
top=apf.getAbsolutePosition(selHtml,oExt)[1]+oExt.scrollTop;if(top<=oExt.scrollTop){oExt.scrollTop=top;
}return false;case 40:if(!selXml&&!this.$tempsel){return;}var node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
var sNode=this.getFirstTraverseNode(node);if(sNode){var container=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(node,this)));
if(container&&apf.getStyle(container,"display")!="block"){sNode=null;}}while(!sNode){var pNode=this.getTraverseParent(node);
if(!pNode){break;}var i=0;var nodes=this.getTraverseNodes(pNode);while(nodes[i]&&nodes[i]!=node){i++;
}sNode=nodes[i+1];node=pNode;}if(sNode&&sNode.nodeType==1){this.$setTempSelected(sNode,ctrlKey,shiftKey);
}else{return false;}selHtml=this.$getLayoutNode("item","select",apf.xmldb.findHtmlNode(sNode,this));
top=apf.getAbsolutePosition(selHtml,oExt)[1]+selHtml.offsetHeight+oExt.scrollTop;
if(top>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=top-oExt.offsetHeight;}return false;
case 33:break;case 34:break;case 36:break;case 35:break;}},true);var nodes=[];this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode,isLast){var loadChildren=this.$getBindRule("insert",xmlNode)?true:false,traverseNodes=this.getTraverseNodes(xmlNode),hasTraverseNodes=traverseNodes.length?true:false,hasChildren=loadChildren||hasTraverseNodes,startcollapsed=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",xmlNode)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",xmlNode)?false:true):this.startcollapsed),state=(hasChildren?HAS_CHILD:0)|(startcollapsed&&hasChildren||loadChildren?IS_CLOSED:0)|(isLast?IS_LAST:0),htmlNode=this.$initNode(xmlNode,state,Lid),container=this.$getLayoutNode("item","container"),eachLength;
if(!startcollapsed&&!this.nocollapse){container.setAttribute("style","overflow:visible;height:auto;display:block;");
}if(!hasChildren||loadChildren){container.setAttribute("style","display:none;");
}if(!this.prerender){eachLength=traverseNodes.length;}if(hasChildren&&!this.prerender&&eachLength>0&&startcollapsed||loadChildren&&(!this.$hasLoadStatus(xmlNode)||this.$hasLoadStatus(xmlNode,"potential"))){this.$setLoading(xmlNode,container);
}else{if(!hasTraverseNodes&&(msg=this.$applyBindRule("empty",xmlNode))){this.setEmpty(container);
}}if(!htmlParentNode&&(xmlParentNode==this.xmlRoot||xmlNode==this.xmlRoot)){nodes.push(htmlNode);
if(!apf.isChildOf(htmlNode,container,true)){nodes.push(container);}this.$setStyleClass(htmlNode,"root");
this.$setStyleClass(container,"root");}else{if(!htmlParentNode){htmlParentNode=apf.xmldb.findHtmlNode(xmlNode.parentNode,this);
htmlParentNode=htmlParentNode?this.$getLayoutNode("item","container",htmlParentNode):this.$container;
}if(htmlParentNode==this.$container){this.$setStyleClass(htmlNode,"root");this.$setStyleClass(container,"root");
if(this.renderRoot){var realParent=apf.xmldb.findHtmlNode(this.xmlRoot,this);htmlParentNode=this.$getLayoutNode("item","container",realParent);
}}if(!beforeNode&&this.getNextTraverse(xmlNode)){beforeNode=apf.xmldb.findHtmlNode(this.getNextTraverse(xmlNode),this);
}if(beforeNode&&beforeNode.parentNode!=htmlParentNode){beforeNode=null;}if(htmlParentNode.style&&this.getTraverseNodes(xmlNode.parentNode).length==1){this.clearEmpty(htmlParentNode);
}if(htmlParentNode.style){var q=apf.insertHtmlNode(htmlNode,htmlParentNode,beforeNode);
if(!this.$noanim){animHighlight(this.$getLayoutNode("item","select",q));}if(!apf.isChildOf(htmlNode,container,true)){var container=apf.insertHtmlNode(container,htmlParentNode,beforeNode);
}}else{htmlParentNode.insertBefore(htmlNode,beforeNode);if(!apf.isChildOf(htmlParentNode,container,true)){htmlParentNode.insertBefore(container,beforeNode);
}}if(htmlParentNode.style){if(!startcollapsed&&this.openOnAdd&&htmlParentNode!=this.$container&&htmlParentNode.style.display!="block"){this.slideOpen(htmlParentNode,xmlParentNode);
}this.$fixItem(xmlParentNode,apf.xmldb.findHtmlNode(xmlParentNode,this));if(this.getNextTraverse(xmlNode,true)){this.$fixItem(this.getNextTraverse(xmlNode,true),apf.xmldb.findHtmlNode(this.getNextTraverse(xmlNode,true),this));
}}}if(this.prerender||eachLength<1||!startcollapsed){this.$addNodes(xmlNode,container,false);
}return container;};this.$fill=function(){var container;apf.insertHtmlNodes(nodes,container||this.$container);
nodes.length=0;};var typeName={};typeName[3]="textnode";typeName[4]="cdata";typeName[7]="procinstr";
typeName[8]="comment";var knownElements=[null];this.$addNonElement=function(xmlNode,pNode,checkChildren,insertBefore,depth){if(!xmlNode.$regbase){return;
}if(checkChildren){htmlNode=false;}if(htmlNode){return;}if(xmlNode.nodeType==3){this.$getNewContext("textnode");
var node=this.$getLayoutNode("textnode");var txtNode=this.$getLayoutNode("textnode","text");
}else{this.$getNewContext("anynode");var node=this.$getLayoutNode("anynode");var tagstart=this.$getLayoutNode("anynode","tagstart");
var tagend=this.$getLayoutNode("anynode","tagend");switch(xmlNode.nodeType){case 4:apf.setNodeValue(tagstart,"&lt;![CDATA[");
apf.setNodeValue(tagend,"]]&gt;");break;case 7:apf.setNodeValue(tagstart,"&lt;?"+xmlNode.target);
apf.setNodeValue(tagend,"?&gt;");break;case 8:apf.setNodeValue(tagstart,"&lt;!--");
apf.setNodeValue(tagend,"--&gt;");break;default:return;}this.$getLayoutNode("anynode","openclose").setAttribute("onmousedown","var o = this.parentNode;                 apf.setStyleClass(o, o.className.indexOf('open') > -1 ? '' : 'open', ['open']);");
var txtNode=this.$getLayoutNode("anynode","text");}var value=xmlNode.nodeValue;
if(value.trim().indexOf("\n")>-1){value=(xmlNode.nodeValue=apf.removeStartWhitespaces(value.replace(/^ *\n/,"").replace(/\n *$/,""))).replace(/</g,"&lt;").replace(/\n/g,"<br />");
}else{value=value.trim().replace(/</g,"&lt;");}apf.setNodeValue(txtNode,value);
this.$setStyleClass(node,typeName[xmlNode.nodeType],"");var Lid=xmlNode.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;
txtNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+Lid+"', false, "+(knownElements.push(xmlNode)-1)+");");
txtNode.setAttribute("onmouseup","            apf.stopPropagation(event);            return false;");
txtNode.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            apf.stopPropagation(event);");
txtNode.setAttribute("onselectstart","event.cancelBubble = true;");txtNode.setAttribute("ondblclick","event.cancelBubble = true;");
if(pNode.style){var htmlNode=apf.insertHtmlNode(node,pNode);}else{pNode.appendChild(node);
}};this.$getParentNode=function(htmlNode){return htmlNode?this.$getLayoutNode("item","container",htmlNode):this.$container;
};this.$calcSelectRange=function(xmlStartNode,xmlEndNode){return[xmlStartNode,xmlEndNode];
};this.$findContainer=function(htmlNode){return this.$getLayoutNode("item","container",htmlNode);
};this.multiselect=false;this.$selectDefault=function(xmlNode){if(this.select(this.getFirstTraverseNode(xmlNode),null,null,null,true)){return true;
}else{var nodes=this.getTraverseNodes(xmlNode);for(var i=0;i<nodes.length;i++){if(this.$selectDefault(nodes[i])){return true;
}}}};this.$select=function(o){if(!o||!o.style){return;}this.$setStyleClass(this.$getLayoutNode("item","class",o),"selected");
return o;};this.$deselect=function(o){if(!o){return;}this.$setStyleClass(this.$getLayoutNode("item","class",o),"",["selected","indicate"]);
return o;};this.$indicate=function(o){if(!o){return;}this.$setStyleClass(this.$getLayoutNode("item","class",o),"indicate");
return o;};this.$deindicate=function(o){if(!o){return;}this.$setStyleClass(this.$getLayoutNode("item","class",o),"",["indicate"]);
return o;};this.$draw=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);
this.opencloseaction=this.$getOption("Main","openclose");this.$ext.onclick=function(e){this.host.dispatchEvent("click",{htmlEvent:e||event});
};var _self=this;this.$ext.onmouseover=function(e){_self.dispatchEvent("mouseover",{htmlEvent:e||event});
};this.$ext.onmouseout=function(e){_self.dispatchEvent("mouseout",{htmlEvent:e||event});
};};this.$loadAml=function(x){this.openOnAdd=!apf.isFalse(x.getAttribute("openonadd"));
this.startcollapsed=!apf.isFalse(this.getAttribute("startcollapsed")||this.$getOption("Main","startcollapsed"));
this.nocollapse=apf.isTrue(this.getAttribute("nocollapse"));if(this.nocollapse){this.startcollapsed=false;
}this.singleopen=apf.isTrue(this.getAttribute("singleopen"));};this.$destroy=function(){if(!this.$ext){apf.console.error("destroy is called more than once for markupedit");
return;}this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;
};}).call(apf.markupedit.prototype=new apf.MultiSelect());apf.aml.setElement("markupedit",apf.markupedit);
apf.menu=function(struct,tagName){this.$init(tagName||"menu",apf.NODE_VISIBLE,struct);
this.animate=apf.enableAnim;};(function(){this.$focussable=apf.KEYBOARD;this.$positioning="basic";
this.zindex=10000000;this.visible=false;this.matchhide=false;this.$booleanProperties.animate=true;
this.$booleanProperties.pinned=true;this.$booleanProperties.matchhide=true;this.$propHandlers.visible=function(value,prop,force,nofocus,hideOpener){if(value){this.$ext.style.display="block";
if(this.opener&&this.opener.localName.indexOf("item")>-1){this.opener.parentNode.$showingSubMenu=this;
}}else{this.$ext.style.display="none";var lastFocus=apf.menu.lastFocus;if(lastFocus!=this.opener&&this.opener&&this.opener.$blur){this.opener.$blur();
}if(this.opener&&this.opener.parentNode&&this.opener.parentNode.localName=="menu"){if(!this.$hideTree){this.$hideTree=-1;
}this.opener.parentNode.focus();}else{if(lastFocus){if(apf.window.$settingFocus){if(apf.window.$settingFocus!=lastFocus&&lastFocus.$blur){lastFocus.$blur();
}this.$blur();if(apf.window.$settingFocus.localName!="menu"){apf.menu.lastFocus=null;
}}else{if(!apf.window.hasFocus()){if(lastFocus.$blur){lastFocus.$blur();}this.$blur();
apf.document.activeElement=lastFocus;if(lastFocus.$focusParent){lastFocus.$focusParent.$lastFocussed=lastFocus;
}apf.menu.lastFocus=null;}else{if(this.$hideTree){if(!this.$hideTree){this.$hideTree=-1;
}var visTest=(lastFocus.disabled||!lastFocus.visible)&&lastFocus!=apf.document.documentElement;
if(nofocus||visTest){if(lastFocus.$blur){lastFocus.$blur();}this.$blur();apf.document.activeElement=null;
if(visTest&&apf.window.moveNext()===false){apf.window.$focusRoot();}}else{lastFocus.focus(null,null,true);
}apf.menu.lastFocus=null;}}}}}clearTimeout(this.$submenuTimer);if(this.$showingSubMenu){this.$showingSubMenu.hide();
this.$showingSubMenu=null;}if(this.opener&&this.opener.$submenu){this.opener.$submenu(true,true);
if(this.$hideTree===true&&this.opener&&this.opener.parentNode&&this.opener.parentNode.localName=="menu"){this.opener.parentNode.$hideTree=true;
this.opener.parentNode.hide();}this.opener=null;}this.$hideTree=null;if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);
this.$selected=null;}}};var lastFocus;this.display=function(x,y,noanim,opener,xmlNode,openMenuId,btnWidth){this.opener=opener;
if(xmlNode&&!this.disabled){var last,i,node,nodes=this.childNodes,c=0,l=nodes.length,result;
for(i=0;i<l;i++){node=nodes[i];if(node.nodeType!=1||node.localName!="item"){continue;
}result=!xmlNode||!node.match||(node.cmatch||(node.cmatch=apf.lm.compile(node.match,{xpathmode:3,injectself:true})))(xmlNode);
if(result){if(this.matchhide){node.show();}else{node.enable();}if(node.localName=="divider"&&this.matchhide){last=node;
if(c==0){node.hide();}c=0;}else{c++;}}else{if(this.matchhide){node.hide();}else{node.disable();
}if(!node.nextSibling&&c==0){last.hide();}}}}if(this.oOverlay){if(btnWidth){this.oOverlay.style.display="block";
this.oOverlay.style.width=btnWidth+"px";}else{this.oOverlay.style.display="none";
}}function afterRender(){this.dispatchEvent("display",{opener:opener});if(x===null){apf.popup.show(this.$uniqueId,{x:0,y:this.ref?0:opener.$ext.offsetHeight,animate:noanim||!this.animate?false:"fade",steps:10,ref:(this.ref||opener).$ext,allowTogether:openMenuId,autohide:!this.pinned,noleft:this.left!==undefined});
}else{var bodyPos=apf.getAbsolutePosition(document.body);apf.popup.show(this.$uniqueId,{x:x-bodyPos[0],y:y-bodyPos[1]-(apf.isIE&&apf.isIE<8?1:0),animate:noanim||!this.animate?false:"fade",steps:10,allowTogether:openMenuId,autohide:!this.pinned});
}var lastFocus=apf.menu.lastFocus=opener&&opener.$focussable===true?opener:apf.menu.lastFocus||apf.document.activeElement;
apf.popup.last=null;this.focus();if(lastFocus&&lastFocus!=this&&lastFocus.$focus){lastFocus.$focus();
}this.xmlReference=xmlNode;}this.visible=false;if(this.$rendered!==false){this.show();
afterRender.call(this);}else{this.addEventListener("afterrender",afterRender);this.show();
}};this.getValue=function(group){return this.getSelected(group).value||"";};this.getSelected=function(group){var nodes=this.childNodes;
var i,l=nodes.length;for(i=0;i<l;i++){if(nodes[i].group!=group){continue;}if(nodes[i].selected){return nodes[i];
}}return false;};this.select=function(group,value){var nodes=this.childNodes;var i,l=nodes.length;
for(i=0;i<l;i++){if(nodes[i].group!=group){continue;}if(nodes[i].value==value||!nodes[i].value&&nodes[i].caption==value){nodes[i].$handlePropSet("selected",true);
}else{if(nodes[i].selected){nodes[i].$handlePropSet("selected",false);}}}};this.addEventListener("keydown",function(e){var node,key=e.keyCode;
switch(key){case 13:if(!this.$selected){return;}node=this.$selected;node.$down();
node.$up();node.$click();break;case 27:this.hide();break;case 38:node=this.$selected&&this.$selected.previousSibling||this.lastChild;
if(node&&node.localName=="divider"){node=node.previousSibling;}if(!node){return;
}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(node.$ext,"hover");
this.$selected=node;break;case 40:node=this.$selected&&this.$selected.nextSibling||this.firstChild;
if(node&&node.localName=="divider"){node=node.nextSibling;}if(!node){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);
}apf.setStyleClass(node.$ext,"hover");this.$selected=node;break;case 37:if(!this.opener){return;
}if(this.opener.localName=="button"){node=this.opener.previousSibling;while(node&&!node.submenu){node=node.previousSibling;
}if(node){node.dispatchEvent("mouseover");var btnMenu=node.parentNode.menuIsPressed;
if(btnMenu){self[btnMenu.submenu].dispatchEvent("keydown",{keyCode:40});}}}else{if(this.opener.parentNode.localName=="menu"){var op=this.opener;
this.hide();apf.setStyleClass(op.$ext,"hover");op.parentNode.$showingSubMenu=null;
}}break;case 39:if(this.$selected&&this.$selected.submenu){this.$selected.$submenu(null,true);
this.$showingSubMenu.dispatchEvent("keydown",{keyCode:40});return;}if(this.opener){var op=this.opener;
while(op&&op.parentNode&&op.parentNode.localName=="menu"){op=op.parentNode.opener;
}if(op&&op.localName=="button"){node=op.nextSibling;while(node&&!node.submenu){node=node.nextSibling;
}if(node){node.dispatchEvent("mouseover");var btnMenu=node.parentNode.menuIsPressed;
if(btnMenu){self[btnMenu.submenu].dispatchEvent("keydown",{keyCode:40});}return;
}}}if(!this.$selected){arguments.callee.call(this,{keyCode:40});}break;default:return;
}return false;},true);function forceHide(e){if(this.$showingSubMenu||this.pinned||apf.isChildOf(e.fromElement,e.toElement)||apf.isChildOf(this,e.toElement)||!e.toElement){return;
}if(this.$hideTree!=-1){this.$hideTree=true;this.hide();}return false;}this.addEventListener("focus",function(){apf.popup.last=this.$uniqueId;
});this.addEventListener("blur",forceHide);this.addEventListener("popuphide",forceHide);
this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();
this.oOverlay=this.$getLayoutNode("main","overlay",this.$ext);apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);
};this.$loadAml=function(x){this.$int=this.$getLayoutNode("main","container",this.$ext);
};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);};}).call(apf.menu.prototype=new apf.Presentation());
apf.aml.setElement("menu",apf.menu);apf.method=function(struct,tagName){this.$init(tagName||"method",apf.NODE_HIDDEN,struct);
this.async=true;this.caching=false;this["ignore-offline"]=false;};(function(){this.$parsePrio="002";
this.$booleanProperties.async=true;this.$booleanProperties.caching=true;this.$booleanProperties["ignore-offline"]=true;
this.$supportedProperties.push("name","receive","async","caching","ignore-offline","method-name","type","url");
this.$propHandlers["ignore-offline"]=function(value){this.ignoreOffline=value;};
this.$propHandlers["method-name"]=function(value){this.methodName=value;};this.addEventListener("DOMNodeInserted",function(e){if(this.parentNode.$addMethod&&e.currentTarget==this){this.parentNode.$addMethod(this);
}});this.addEventListener("DOMNodeRemoved",function(e){if(this.parentNode.$removeMethod&&e.currentTarget==this){this.parentNode.$removeMethod(this);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);
}});}).call(apf.method.prototype=new apf.AmlElement());apf.aml.setElement("method",apf.method);
apf.WinServer={count:9000,wins:[],setTop:function(win,norecur){if(win.zindex||win.modal){return;
}if(win.$opened){if(win.$opened.visible){return;}else{delete win.$opened;}}var topmost;
if(!norecur&&this.wins.length){var topmost=this.wins[this.wins.length-1];if(topmost==win){return;
}if(!topmost.modal||!topmost.visible){topmost=null;}else{if(topmost&&win.modal){win.$opener=topmost;
topmost.$opened=win;topmost=null;}}}this.count+=2;win.setProperty("zindex",this.count);
this.wins.remove(win);this.wins.push(win);if(topmost){this.setTop(topmost,true);
}return win;},setNext:function(){if(this.wins.length<2){return;}var nwin,start=this.wins.shift();
do{if(this.setTop(nwin||start).visible){break;}nwin=this.wins.shift();}while(start!=nwin);
},setPrevious:function(){if(this.wins.length<2){return;}this.wins.unshift(this.wins.pop());
var nwin,start=this.wins.pop();do{if(this.setTop(nwin||start).visible){break;}nwin=this.wins.pop();
}while(start!=nwin);},remove:function(win){this.wins.remove(win);}};apf.toolwindow=function(struct,tagName){this.$init(tagName||"toolwindow",apf.NODE_VISIBLE,struct);
};apf.modalwindow=function(struct,tagName){this.$init(tagName||"modalwindow",apf.NODE_VISIBLE,struct);
};apf.AmlWindow=function(struct,tagName){this.$init(tagName||"window",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.BaseStateButtons);this.$isWindowContainer=true;
this.collapsedHeight=30;this.canHaveChildren=2;this.visible=false;this.showdragging=false;
this.kbclose=false;this.$focussable=apf.KEYBOARD;this.$editableCaption=["title"];
this.setTitle=function(caption){this.setProperty("title",caption,false,true);return this;
};this.setIcon=function(icon){this.setProperty("icon",icon,false,true);return this;
};this.show=function(callback){this.execAction=callback;this.setProperty("visible",true,false,true);
return this;};this.slideIn=function(sFrom,bSticky){if(!sFrom){sFrom="bottom";}var _center=this.center;
this.center=false;this.setProperty("visible",true);this.center=_center;var iFrom=0,iTo=0,innerW=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth),innerH=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight),cX=Math.max(0,((innerW-this.$ext.offsetWidth)/2)),cY=Math.max(0,((innerH-this.$ext.offsetHeight)/3)),sType="top",pad=10;
switch(sFrom){case"top":iFrom=-(this.$ext.offsetHeight)-pad;iTo=bSticky?0:cY;break;
case"left":iFrom=-(this.$ext.offsetWidth)-pad;iTo=bSticky?0:cX;sType="left";break;
case"bottom":iFrom=innerH+this.$ext.offsetHeight+pad;iTo=bSticky?innerH-this.$ext.offsetHeight:cY;
break;case"right":iFrom=innerW+this.$ext.offsetLeft+pad;iTo=bSticky?innerW-this.$ext.offsetWidth:cX;
sType="left";break;}apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:iFrom,to:iTo,type:sType,anim:apf.tween.EASEIN});
return this;};this.slideOut=function(sTo){if(!sTo){sTo="bottom";}var iFrom=0,iTo=0,sType="top",pad=10;
switch(sTo){case"top":iFrom=this.$ext.offsetTop;iTo=-(this.$ext.offsetHeight)-pad;
break;case"left":iFrom=this.$ext.offsetLeft;iTo=-(this.$ext.offsetWidth)-pad;sType="left";
break;case"bottom":iFrom=this.$ext.offsetTop;iTo=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight)+this.$ext.offsetHeight+pad;
break;case"right":iFrom=this.$ext.offsetLeft;iTo=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth)+this.$ext.offsetLeft+pad;
sType="left";break;}var _self=this;apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:iFrom,to:iTo,type:sType,anim:apf.tween.EASEOUT,onfinish:function(){_self.setProperty("visible",false);
}});return this;};this.bringToFront=function(){apf.WinServer.setTop(this);return this;
};this.$booleanProperties.modal=true;this.$booleanProperties.center=true;this.$booleanProperties.transaction=true;
this.$booleanProperties.hideselects=true;this.$booleanProperties.showdragging=true;
this.$booleanProperties.kbclose=true;this.$supportedProperties.push("title","icon","modal","minwidth","minheight","hideselects","center","kbclose","maxwidth","maxheight","showdragging","transaction");
this.$propHandlers.modal=function(value){if(value){if(this.visible){apf.plane.show(this.$ext,false,null,null,{color:"black",opacity:0.5,protect:this.$uniqueId});
}}else{apf.plane.hide(this.$uniqueId);}};this.$propHandlers.center=function(value){this.$ext.style.position="absolute";
};this.$propHandlers.title=function(value){if(this.oTitle){this.oTitle.nodeValue=value;
}};this.$propHandlers.icon=function(value){if(!this.oIcon){return;}this.oIcon.style.display=value?"":"none";
apf.skins.setIcon(this.oIcon,value,this.iconPath);};this.$afterRender=function(){if(this.center&&!this.left&&!this.top&&!this.right&&!this.bottom&&!this.anchors){apf.layout.processQueue();
var size=!this.$ext.offsetParent||this.$ext.offsetParent.tagName=="BODY"?[apf.getWindowWidth(),apf.getWindowHeight()]:[this.$ext.offsetParent.offsetWidth,this.$ext.offsetParent.offsetHeight,0,0];
if(size.length==2){size.push(document.documentElement.scrollLeft,document.documentElement.scrollTop);
}this.$ext.style.left=(Math.max(0,((size[0]-parseInt(this.$ext.offsetWidth||0))/2))+size[2])+"px";
this.$ext.style.top=(Math.max(0,((size[1]-parseInt(this.$ext.offsetHeight||0))/3))+size[3])+"px";
}if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});
}this.dispatchEvent("show");};var hEls=[],wasVisible;this.$propHandlers.visible=function(value){if(apf.isTrue(value)){if(this.dispatchEvent("beforeshow")===false){return(this.visible=false);
}if(this.modal){apf.plane.show(this.$ext,false,null,null,{color:"black",opacity:0.5,protect:this.$uniqueId});
}this.state=this.state.split("|").remove("closed").join("|");this.$ext.style.display="";
if(!apf.canHaveHtmlOverSelects&&this.hideselects){hEls=[];var nodes=document.getElementsByTagName("select");
for(var i=0;i<nodes.length;i++){var oStyle=apf.getStyle(nodes[i],"display");hEls.push([nodes[i],oStyle]);
nodes[i].style.display="none";}}if(apf.isIE){var cls=this.$ext.className;this.$ext.className="rnd"+Math.random();
this.$ext.className=cls;}if(this.$rendered===false){this.addEventListener("afterrender",this.$afterRender);
}else{this.$afterRender();}}else{if(this.modal){apf.plane.hide(this.$uniqueId);
}this.$ext.style.display="none";if(!apf.canHaveHtmlOverSelects&&this.hideselects){for(var i=0;
i<hEls.length;i++){hEls[i][0].style.display=hEls[i][1];}}if(this.hasFocus()){apf.window.moveNext(true,this,true);
}this.visible=false;this.dispatchEvent("hide");}if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);
}wasVisible=value;};this.$propHandlers.zindex=function(value){this.$ext.style.zIndex=value+1;
};if(!apf.isIphone){this.addEventListener("keydown",function(e){var key=e.keyCode;
var ctrlKey=e.ctrlKey;var shiftKey=e.shiftKey;var retValue=false;switch(key){case 38:if(shiftKey&&this.resizable){this.setProperty("height",Math.max(this.minheight||0,this.$ext.offsetHeight-(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop-(ctrlKey?50:10));
}}break;case 37:if(shiftKey&&this.resizable){this.setProperty("width",Math.max(this.minwidth||0,this.$ext.offsetWidth-(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft-(ctrlKey?50:10));
}}break;case 39:if(shiftKey&&this.resizable){this.setProperty("width",Math.min(this.maxwidth||10000,this.$ext.offsetWidth+(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft+(ctrlKey?50:10));
}}break;case 40:if(shiftKey&&this.resizable){this.setProperty("height",Math.min(this.maxheight||10000,this.$ext.offsetHeight+(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop+(ctrlKey?50:10));
}}break;default:retValue=null;return;}if(apf.hasSingleRszEvent){apf.layout.forceResize(this.$int);
}return retValue;},true);this.addEventListener("keydown",function(e){if(e.keyCode==27&&this.buttons.indexOf("close")>-1&&(!this.dockable||!this.aData)&&this.kbclose){this.close();
}});}this.$draw=function(){this.popout=apf.isTrue(this.getAttribute("popout"));
if(this.popout){this.$pHtmlNode=document.body;}this.$ext=this.$getExternal(null,null,function(oExt){this.$initButtons(oExt);
});this.oTitle=this.$getLayoutNode("main","title",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);
this.oDrag=this.$getLayoutNode("main","drag",this.$ext);this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);
if(this.popout){this.$ext.style.position="absolute";}if(this.oIcon){this.oIcon.style.display="none";
}if(!apf.isIphone){var _self=this;if(this.oDrag){this.oDrag.host=this;this.oDrag.onmousedown=function(e){if(!e){e=event;
}if(!_self.$isWidget&&(!_self.aData||!_self.dockable||_self.aData.hidden==3)){apf.WinServer.setTop(_self);
}if(_self.$lastState.maximized){return false;}if(_self.aData&&_self.dockable){if(_self.$lastState.normal){_self.startDocking(e);
}return false;}};}this.$ext.onmousedown=function(){var p=apf.document.activeElement;
if(p&&p.$focusParent!=_self&&p.$focusParent.modal){return false;}if(!_self.$isWidget&&(!_self.aData||!_self.dockable||_self.aData.hidden==3)){apf.WinServer.setTop(_self);
}if(!_self.$lastState.normal){return false;}};this.$ext.onmousemove=function(){if(!_self.$lastState.normal){return false;
}};}};this.$loadAml=function(x){apf.WinServer.setTop(this);this.$int=this.$getLayoutNode("main","container",this.$ext);
if(!apf.isIphone){if(this.oTitle){var _self=this;(this.oTitle.nodeType!=1?this.oTitle.parentNode:this.oTitle).ondblclick=function(e){if(_self.state.indexOf("normal")==-1){_self.restore();
}else{if(_self.buttons.indexOf("max")>-1){_self.maximize();}else{if(_self.buttons.indexOf("min")>-1){_self.minimize();
}}}};}if(typeof this.draggable=="undefined"){(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,true);
this.draggable=true;}if(typeof this.buttons=="undefined"){this.buttons="";}}if(this.modal===undefined){this.$propHandlers.modal.call(this,true);
this.modal=true;}if(!this.visible){this.$ext.style.display="none";}else{if(this.modal){var _self=this;
apf.queue.add("focus",function(){_self.focus(false,{mouse:true});});}}if(this.minwidth===undefined){this.minwidth=this.$getOption("Main","min-width");
}if(this.minheight===undefined){this.minheight=this.$getOption("Main","min-height");
}if(this.maxwidth===undefined){this.maxwidth=this.$getOption("Main","max-width");
}if(this.maxheight===undefined){this.maxheight=this.$getOption("Main","max-height");
}if(this.center&&this.visible){this.visible=false;this.$ext.style.display="none";
var _self=this;$setTimeout(function(){_self.setProperty("visible",true);});}};this.addEventListener("$skinchange",function(){if(this.title){this.$propHandlers.title.call(this,this.title);
}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$destroy=function(skinChange){if(this.oDrag){this.oDrag.host=null;
this.oDrag.onmousedown=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}this.oTitle=this.oIcon=null;
if(this.$ext&&!skinChange){this.$ext.onmousedown=null;this.$ext.onmousemove=null;
}};}).call(apf.modalwindow.prototype=new apf.Presentation());apf.AmlWindow.prototype=apf.toolwindow.prototype=apf.modalwindow.prototype;
apf.aml.setElement("toolwindow",apf.toolwindow);apf.aml.setElement("modalwindow",apf.modalwindow);
apf.aml.setElement("window",apf.modalwindow);apf.model=function(struct,tagName){this.$init(tagName||"model",apf.NODE_HIDDEN,struct);
this.$amlNodes={};this.$propBinds={};this.$listeners={};this.$proplisteners={};
if(!apf.globalModel){apf.globalModel=this;apf.nameserver.register("model","@default",this);
}};(function(){this.$parsePrio="020";this.$isModel=true;this.canHaveChildren=false;
this.enablereset=false;this.$state=0;this.$attrExcludePropBind=apf.extend({submission:1,src:1,session:1},this.$attrExcludePropBind);
this.$booleanProperties.autoinit=true;this.$booleanProperties.enablereset=true;
this.$supportedProperties=["submission","src","session","autoinit","enablereset","remote"];
this.$propHandlers.src=this.$propHandlers.get=function(value,prop){if(this.$amlLoaded){this.$loadFrom(value);
}};this.$propHandlers.remote=function(value,prop){if(value){if(this.src&&this.src.indexOf("rdb://")===0){var _self=this;
apf.queue.add("rdb_load_"+this.$uniqueId,function(){_self.unshare();_self.share();
});}}else{this.unshare();}};this.share=function(xpath){this.rdb=typeof this.remote=="string"?apf.nameserver.get("remote",this.remote):this.remote;
if(!this.rdb||!this.rdb.$sessions){throw new Error(apf.formatErrorString(0,null,"Loading AML into model","Could not find reference to remote databinding: '"+this.remote+"'",this));
}this.rdb.createSession(this.src,this,xpath);};this.unshare=function(xpath){if(!this.rdb){return;
}this.rdb.endSession(this.src);this.rdb=null;};this.register=function(amlNode,xpath){if(!amlNode||!amlNode.load){return this;
}var isReloading=amlNode.$model==this;if(amlNode.$model&&!isReloading){amlNode.$model.unregister(amlNode);
}var item=this.$amlNodes[amlNode.$uniqueId]={amlNode:amlNode,xpath:xpath};amlNode.$model=this;
if(typeof amlNode.noloading=="undefined"&&amlNode.$setInheritedAttribute&&!amlNode.$setInheritedAttribute("noloading")){amlNode.noloading=false;
}if(this.$state==1){if(amlNode.clear&&!amlNode.noloading){amlNode.clear("loading");
}}else{if(this.data){this.$loadInAmlNode(item);}else{if(amlNode.hasFeature(apf.__CACHE__)){amlNode.clear("empty");
}}}var p,node,list=amlNode.$propsUsingMainModel,id=amlNode.$uniqueId;for(var prop in list){this.$unbindXmlProperty(amlNode,prop);
p=this.$bindXmlProperty(amlNode,prop,list[prop].xpath,list[prop].optimize);if(this.data){if(node=p.listen?this.data.selectSingleNode(p.listen):this.data){amlNode.$execProperty(prop,node);
}else{this.$waitForXml(amlNode,prop);}}}return this;};this.$register=function(amlNode,xpath){this.$amlNodes[amlNode.$uniqueId].xpath=xpath;
};this.unregister=function(amlNode){delete this.$amlNodes[amlNode.$uniqueId];var list=amlNode.$propsUsingMainModel;
for(var prop in list){this.$unbindXmlProperty(amlNode,prop);}amlNode.dispatchEvent("unloadmodel");
};this.getXpathByAmlNode=function(amlNode){var n=this.$amlNodes[amlNode.$uniqueId];
if(!n){return false;}return n.xpath;};this.$loadInAmlNode=function(item){var xmlNode;
var xpath=item.xpath;var amlNode=item.amlNode;if(this.data&&xpath){xmlNode=this.data.selectSingleNode(xpath);
}else{xmlNode=this.data||null;}if(xmlNode){delete this.$listeners[amlNode.$uniqueId];
amlNode.load(xmlNode);}else{this.$waitForXml(amlNode);}};this.$loadInAmlProp=function(id,xmlNode){var prop,node,p=this.$propBinds[id],amlNode=apf.all[id];
if(!amlNode){delete this.$propBinds[id];return;}if(amlNode.$noInitModel){delete amlNode.$noInitModel;
return;}for(prop in p){if(xmlNode&&(node=p[prop].listen?xmlNode.selectSingleNode(p[prop].listen):xmlNode)){apf.xmldb.addNodeListener(xmlNode,amlNode,"p|"+id+"|"+prop+"|"+this.$uniqueId);
delete this.$proplisteners[id+prop];amlNode.$execProperty(prop,node);}else{this.$waitForXml(amlNode,prop);
}}};this.$bindXmlProperty=function(amlNode,prop,xpath,optimize,listenRoot){var q,p,id=amlNode.$uniqueId;
if(!this.$propBinds[id]){this.$propBinds[id]={};}p=this.$propBinds[id][prop]={bind:xpath};
if(optimize&&false){if((q=this.$amlNodes[id])&&q.xpath){xpath=(p.root=q.xpath)+"/"+xpath;
}var l=xpath.split("/"),z=l.pop();if(z.indexOf("@")==0||z.indexOf("text()")>-1||z.indexOf("node()")>-1){p.listen=l.join("/");
}else{p.listen=xpath;}}else{if((q=this.$amlNodes[id])&&q.xpath){p.listen=q.xpath;
}}if(listenRoot){p.listen=".";}if(this.data){var xmlNode=amlNode.$noInitModel?amlNode.xmlRoot:(p.listen?this.data.selectSingleNode(p.listen):this.data);
if(xmlNode){apf.xmldb.addNodeListener(xmlNode,amlNode,"p|"+amlNode.$uniqueId+"|"+prop+"|"+this.$uniqueId);
return p;}}this.$waitForXml(amlNode,prop);return p;};this.$unbindXmlProperty=function(amlNode,prop){var id=amlNode.$uniqueId;
var p=this.$propBinds[id]&&this.$propBinds[id][prop];if(!p){return;}if(this.data){var xmlNode=p.listen?this.data.selectSingleNode(p.listen):this.data;
if(xmlNode){apf.xmldb.removeNodeListener(xmlNode,amlNode,"p|"+id+"|"+prop+"|"+this.$uniqueId);
}}delete this.$proplisteners[id+prop];delete this.$propBinds[id][prop];return p;
};this.getXml=function(){return this.data?apf.xmldb.cleanNode(this.data.cloneNode(true)):false;
};this.setQueryValue=function(xpath,value){if(!this.data){return false;}var node=apf.createNodeFromXpath(this.data,xpath);
if(!node){return null;}apf.setNodeValue(node,value,true);return node;};this.setQueryValues=function(xpath,value){if(!this.data){return[];
}var nodes=this.data.selectNodes(xpath);for(var i=0,l=nodes.length;i<l;i++){apf.setNodeValue(node,value,true);
}return nodes;};this.queryValue=function(xpath){if(!this.data){return false;}return apf.queryValue(this.data,xpath);
};this.queryValues=function(xpath){if(!this.data){return[];}return apf.queryValue(this.data,xpath);
};this.queryNode=function(xpath){if(!this.data){return null;}return this.data.selectSingleNode(xpath);
};this.queryNodes=function(xpath){if(!this.data){return[];}return this.data.selectNodes(xpath);
};this.appendXml=function(xmlNode,xpath){var insertNode=xpath?apf.createNodeFromXpath(this.data,xpath):this.data;
if(!insertNode){return null;}if(typeof xmlNode=="string"){xmlNode=apf.getXml(xmlNode);
}else{xmlNode=!xmlNode.nodeType?xmlNode.getXml():apf.xmldb.getCleanCopy(xmlNode);
}if(!xmlNode){return;}apf.xmldb.appendChild(insertNode,xmlNode);this.dispatchEvent("update",{xmlNode:xmlNode});
return xmlNode;};this.removeXml=function(xmlNode){if(typeof xmlNode=="string"){var xmlNodes=this.data.selectNodes(xmlNode);
}else{if(!xmlNode.length){xmlNodes=[xmlNode];}}if(xmlNodes.length){apf.xmldb.removeNodeList(xmlNodes);
}};this.clear=function(){this.load(null);doc=null;};this.reset=function(){var doc=this.data.ownerDocument;
this.data.parentNode.replaceChild(this.$copy,this.data);this.load(this.$copy);};
this.savePoint=function(){this.$copy=apf.xmldb.getCleanCopy(this.data);};this.reloadAmlNode=function(uniqueId){if(!this.data){return;
}var item=this.$amlNodes[uniqueId];var xmlNode=item.xpath?this.data.selectSingleNode(item.xpath):this.data;
item.amlNode.load(xmlNode);};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var x=this.$aml;
if(this.parentNode&&this.parentNode.hasFeature(apf.__DATABINDING__)){if(!this.name){this.setProperty("id","model"+this.parentNode.$uniqueId);
}this.register(this.parentNode);}if(!this.src){var strXml,xmlNode=x;if(xmlNode&&xmlNode.childNodes.length){if(apf.getNode(xmlNode,[0])){if((strXml=xmlNode.xml||xmlNode.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/)){strXml=RegExp.$1;
if(!apf.supportNamespaces){strXml=strXml.replace(/xmlns=\"[^"]*\"/g,"");}}return this.load(apf.getXmlDom(strXml).documentElement);
}else{if(apf.isJson(xmlNode.childNodes[0].nodeValue)){return this.load(apf.getXmlDom(xmlNode.childNodes[0].nodeValue).documentElement);
}}}if(this.submission){this.load("<data />");}}if(!apf.isFalse(this.autoinit)){this.init();
}return this;});this.init=function(callback){if(this.session){this.$loadFrom(this.session,{isSession:true});
}else{if(typeof apf.offline!="undefined"&&apf.offline.models.enabled){if(apf.offline.models.loadModel(this)){return;
}if(this.src&&!apf.offline.onLine){apf.offline.models.addToInitQueue(this);return;
}}if(this.src){this.$loadFrom(this.src,{callback:callback});}}};this.$loadFrom=function(instruction,options){if(instruction.indexOf("rdb://")===0){this.src=instruction;
return this.$propHandlers.remote.call(this,this.remote);}var data=instruction.split(":");
if(!options){options={};}if(!options.isSession){this.src=instruction;this.$srcOptions=[instruction,options];
}this.dispatchEvent("beforeretrieve");var uniqueId,item;for(uniqueId in this.$amlNodes){if(!(item=this.$amlNodes[uniqueId])||!item.amlNode){continue;
}if(!item.amlNode.noloading){item.amlNode.clear("loading");}}this.$state=1;if(!this.$callCount){this.$callCount=1;
}else{this.$callCount++;}var _self=this,callCount=this.$callCount,callback=options.callback;
options.callback=function(data,state,extra){if(callCount!=_self.$callCount){return;
}_self.dispatchEvent("afterretrieve");if(state==apf.OFFLINE){apf.offline.models.addToInitQueue(this);
return false;}if(state!=apf.SUCCESS){var oError;oError=new Error(apf.formatErrorString(1032,_self,"Loading xml data","Could not load data\nInstruction: "+instruction+"\nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+data));
if(callback&&callback.apply(this,arguments)===true){return true;}if(extra.tpModule&&extra.tpModule.retryTimeout(extra,state,_self,oError)===true){return true;
}_self.$state=0;throw oError;}if(options&&options.isSession&&!data){if(this.src){return _self.$loadFrom(this.src);
}}else{if(options&&options.cancel){return;}_self.load(data);_self.dispatchEvent("receive",{data:data});
if(callback){callback.apply(this,arguments);}}};return apf.getData(instruction,options);
};this.reload=function(){if(!this.data){return;}if(this.$srcOptions){this.$loadFrom.apply(this,this.$srcOptions);
}else{if(this.src){this.$loadFrom(this.src);}}};this.load=function(xmlNode,options){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){if(xmlNode.substr(0,5).toUpperCase()=="<!DOC"){xmlNode=xmlNode.substr(xmlNode.indexOf(">")+1);
}if(!apf.supportNamespaces){xmlNode=xmlNode.replace(/xmlns\=\"[^"]*\"/g,"");}xmlNode=apf.getXmlDom(xmlNode,null,true).documentElement;
}else{if(apf.isJson(xmlNode)){xmlNode=apf.json2Xml(xmlNode).documentElement;}else{return this.$loadFrom(xmlNode,options);
}}}if(this.ownerDocument&&this.ownerDocument.$domParser.$shouldWait){var _self=this;
this.data=xmlNode;apf.xmldb.getXmlDocId(xmlNode,this);this.$queueLoading=true;apf.queue.add("modelload"+this.$uniqueId,function(){if(_self.ownerDocument&&_self.ownerDocument.$domParser.$shouldWait){apf.queue.add("modelload"+_self.$uniqueId,arguments.callee);
}else{_self.load(xmlNode,options);_self.$queueLoading=false;}});return;}else{if(this.$queueLoading){apf.queue.remove("modelload"+this.$uniqueId);
}}this.$state=0;if(this.dispatchEvent("beforeload",{xmlNode:xmlNode})===false){return false;
}var doc=xmlNode?xmlNode.ownerDocument:null;if(xmlNode){if(!apf.supportNamespaces){var xmlns=[],attr=xmlNode.attributes;
for(var i=0,l=attr.length;i<l;i++){if(attr[i].nodeName.substr(0,5)=="xmlns"){xmlns.push(attr[i].xml);
}}if(xmlns.length){doc.setProperty("SelectionNamespaces",xmlns.join(" "));}}apf.xmldb.addNodeListener(xmlNode,this);
apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(xmlNode,this),xmlNode,null,this);if((!options||!options.nocopy)&&this.enablereset){this.$copy=apf.xmldb.getCleanCopy(xmlNode);
}}this.data=xmlNode;this.dispatchEvent("afterload",{xmlNode:xmlNode});this.dispatchEvent("update",{xmlNode:xmlNode});
for(var id in this.$amlNodes){this.$loadInAmlNode(this.$amlNodes[id]);}for(id in this.$propBinds){this.$loadInAmlProp(id,xmlNode);
}return this;};this.$waitForXml=function(amlNode,prop){if(prop){this.$proplisteners[amlNode.$uniqueId+prop]={id:amlNode.$uniqueId,amlNode:amlNode,prop:prop};
}else{this.$listeners[amlNode.$uniqueId]=amlNode;}if(amlNode.xmlRoot){amlNode.clear();
}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(action=="replacenode"&&xmlNode==this.data.ownerDocument.documentElement){var _self=this;
setTimeout(function(){_self.load(xmlNode);});return;}if(this.rdb&&!this.$at&&UndoObj){this.$at=UndoObj.at;
}var p,b;for(var id in this.$listeners){if(xmlNode=this.data.selectSingleNode(this.$amlNodes[id].xpath||".")){this.$listeners[id].load(xmlNode);
delete this.$listeners[id];}}for(id in this.$proplisteners){p=this.$proplisteners[id];
b=this.$propBinds[p.id][p.prop];if(xmlNode=b.listen?this.data.selectSingleNode(b.listen):this.data){delete this.$proplisteners[id];
apf.xmldb.addNodeListener(xmlNode,p.amlNode,"p|"+p.id+"|"+p.prop+"|"+this.$uniqueId);
p.amlNode.$execProperty(p.prop,b.root?this.data.selectSingleNode(b.root):this.data);
}}this.dispatchEvent("update",{xmlNode:xmlNode,action:action,undoObj:UndoObj});
};this.$insertFrom=function(instruction,options){if(!instruction){return false;
}this.dispatchEvent("beforeretrieve");var amlNode=options.amlNode;var callback=options.callback,_self=this;
options.callback=function(data,state,extra){_self.dispatchEvent("afterretrieve");
if(!extra){extra={};}if(state!=apf.SUCCESS){var oError;oError=new Error(apf.formatErrorString(0,_self,"Inserting xml data","Could not insert data\nInstruction:"+instruction+"\nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+data));
if(extra.tpModule.retryTimeout(extra,state,options.amlNode||_self,oError)===true){return true;
}if(callback&&callback.call(this,extra.data,state,extra)===false){return;}throw oError;
}if(typeof options.insertPoint=="string"){options.insertPoint=_self.data.selectSingleNode(options.insertPoint);
}if(typeof options.clearContents=="undefined"&&extra.userdata){options.clearContents=apf.isTrue(extra.userdata[1]);
}(options.amlNode||_self).insert(data,options);if(callback){callback.call(this,extra.data,state,extra);
}};apf.getData(instruction,options);};this.insert=function(xmlNode,options){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){if(xmlNode.substr(0,5).toUpperCase()=="<!DOC"){xmlNode=xmlNode.substr(xmlNode.indexOf(">")+1);
}if(!apf.supportNamespaces){xmlNode=xmlNode.replace(/xmlns\=\"[^"]*\"/g,"");}xmlNode=apf.getXmlDom(xmlNode).documentElement;
}else{if(apf.isJson(xmlNode)){xmlNode=apf.json2Xml(xmlNode).documentElement;}else{return this.$insertFrom(xmlNode,options);
}}}if(!options.insertPoint){options.insertPoint=this.data;}if(!options.insertPoint){throw new Error(apf.formatErrorString(0,amlNode||_self,"Inserting data","Could not determine insertion point for instruction: "+instruction));
}if(typeof options.copyAttributes=="undefined"){options.copyAttributes=true;}var newNode=apf.mergeXml(xmlNode,options.insertPoint,options);
apf.xmldb.applyChanges("insert",options.insertPoint);return xmlNode;};this.convertXml=function(type){if(!type){return this.data.xml;
}return apf.convertXml(this.data,type);};this.submit=function(instruction,type,xmlNode,options){if(!instruction){instruction=this.submission;
}if(!xmlNode){xmlNode=this.data;}if(!xmlNode){throw new Error(apf.formatErrorString(0,this,"Submitting model","Could not submit data, because no data was passed and the model does not have data loaded."));
}if(!type){type="form";}if(this.dispatchEvent("beforesubmit",{instruction:instruction})===false){return false;
}var model=this;function cbFunc(data,state,extra){if((state==apf.TIMEOUT||(model.retryOnError&&state==apf.ERROR))&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}else{if(state!=apf.SUCCESS){model.dispatchEvent("submiterror",extra);}else{model.dispatchEvent("submitsuccess",apf.extend({data:data},extra));
}}}var data;if(type.indexOf("xml")>-1){data=apf.getXmlString(xmlNode);}else{if(type.indexOf("form")>-1){data=apf.convertXml(apf.xmldb.getCleanCopy(xmlNode),"cgiobjects");
}else{if(type.indexOf("json")>-1){data=apf.convertXml(xmlNode,"json");}}}apf.saveData(instruction,apf.extend({xmlNode:xmlNode,data:data,callback:cbFunc},options));
this.dispatchEvent("aftersubmit");};this.$destroy=function(){if(this.session&&this.data){apf.saveData(this.session,{xmlNode:this.getXml()});
}};}).call(apf.model.prototype=new apf.AmlElement());apf.aml.setElement("model",apf.model);
apf.notifier=function(struct,tagName){this.$init(tagName||"notifier",apf.NODE_VISIBLE,struct);
};(function(){this.timeout=2000;this.position="top-right";this.columnsize=300;this.arrange="vertical";
this.margin="10 10 10 10";this.lastPos=null;this.showing=0;this.sign=1;this.$supportedProperties.push("margin","position","timeout","columnsize","arrange");
this.$propHandlers.position=function(value){this.lastPos=null;};this.$propHandlers.margin=function(value){this.margin=value;
};this.$propHandlers.timeout=function(value){this.timeout=parseInt(value)*1000;
};function getPageScroll(){return[document.documentElement.scrollTop||document.body.scrollTop,document.documentElement.scrollLeft||document.body.scrollLeft];
}function getStartPosition(x,wh,ww,nh,nw,margin){var scrolled=getPageScroll();return[(x[0]=="top"?margin[0]:(x[0]=="bottom"?wh-nh-margin[2]:wh/2-nh/2))+scrolled[0],(x[1]=="left"?margin[3]:(x[1]=="right"?ww-nw-margin[1]:ww/2-nw/2))+scrolled[1]];
}this.popup=function(message,icon,ev){if(!this.$ext){return;}this.$ext.style.width=this.columnsize+"px";
var _self=this,oNoti=this.$pHtmlNode.appendChild(this.$ext.cloneNode(true)),ww=apf.isIE?document.documentElement.offsetWidth:window.innerWidth,wh=apf.isIE?document.documentElement.offsetHeight:window.innerHeight,removed=false,oIcon=this.$getLayoutNode("notification","icon",oNoti),oBody=this.$getLayoutNode("notification","body",oNoti);
this.showing++;if(oIcon&&icon){if(oIcon.nodeType==1){oIcon.style.backgroundImage="url("+this.iconPath+icon+")";
}else{oIcon.nodeValue=this.iconPath+icon;}this.$setStyleClass(oNoti,this.$baseCSSname+"ShowIcon");
}oBody.insertAdjacentHTML("beforeend",message||"[No message]");oNoti.style.display="block";
var margin=apf.getBox(this.margin||"0"),nh=oNoti.offsetHeight,nw=oNoti.offsetWidth,x=this.position.split("-"),_reset=false;
if(x[1]=="top"||x[1]=="bottom"||x[0]=="left"||x[0]=="right"){x=[x[1],x[0]];}if((x[0]=="center"&&x[1]!=="center")||(x[0]!=="center"&&x[1]=="center")){x=["top","right"];
}if(!this.lastPos){this.lastPos=getStartPosition(x,wh,ww,nh,nw,margin);this.sign=1;
_reset=true;}if((!_reset&&x[0]=="bottom"&&this.sign==1)||(x[0]=="top"&&this.sign==-1)){if(this.arrange=="vertical"){this.lastPos[0]+=x[1]=="center"?0:this.sign*(x[0]=="top"?margin[0]+nh:(x[0]=="bottom"?-margin[2]-nh:0));
}else{this.lastPos[1]+=x[0]=="center"?0:this.sign*(x[1]=="left"?margin[3]+nw:(x[1]=="right"?-margin[1]-nw:0));
}}var scrolled=getPageScroll();if(this.lastPos[0]>wh+scrolled[0]-nh||this.lastPos[0]<scrolled[0]){this.lastPos[1]+=(x[1]=="left"?nw+margin[3]:(x[1]=="right"?-nw-margin[3]:0));
this.sign*=-1;this.lastPos[0]+=this.sign*(x[0]=="top"?margin[0]+nh:(x[0]=="bottom"?-margin[2]-nh:0));
}else{if(this.lastPos[1]>ww+scrolled[1]-nw||this.lastPos[1]<scrolled[1]){this.lastPos[0]+=(x[0]=="top"?nh+margin[0]:(x[0]=="bottom"?-nh-margin[0]:0));
this.sign*=-1;this.lastPos[1]+=x[0]=="center"?0:this.sign*(x[1]=="left"?margin[3]+nw:(x[1]=="right"?-margin[1]-nw:0));
}}if(this.lastPos){if((this.lastPos[0]>wh+scrolled[0]-nh||this.lastPos[0]<scrolled[1])&&this.arrange=="horizontal"){this.lastPos=getStartPosition(x,wh,ww,nh,nw,margin);
this.sign=1;}if((this.lastPos[1]>ww+scrolled[1]-nw||this.lastPos[1]<scrolled[1])&&this.arrange=="vertical"){this.lastPos=getStartPosition(x,wh,ww,nh,nw,margin);
this.sign=1;}}oNoti.style.left=this.lastPos[1]+"px";oNoti.style.top=this.lastPos[0]+"px";
if((x[0]=="top"&&this.sign==1)||(x[0]=="bottom"&&this.sign==-1)){if(this.arrange=="vertical"){this.lastPos[0]+=x[1]=="center"?0:this.sign*(x[0]=="top"?margin[0]+nh:(x[0]=="bottom"?-margin[2]-nh:0));
}else{this.lastPos[1]+=x[0]=="center"?0:this.sign*(x[1]=="left"?margin[3]+nw:(x[1]=="right"?-margin[1]-nw:0));
}}var isMouseOver=false;apf.tween.css(oNoti,"fade",{anim:apf.tween.NORMAL,steps:10,interval:10,onfinish:function(container){oNoti.style.filter="";
$setTimeout(hideWindow,_self.timeout);}});function hideWindow(){if(isMouseOver){return;
}apf.tween.css(oNoti,"notifier_hidden",{anim:apf.tween.NORMAL,steps:10,interval:20,onfinish:function(container){apf.setStyleClass(oNoti,"",["notifier_hover"]);
if(isMouseOver){return;}if(oNoti.parentNode){if(oNoti.parentNode.removeChild(oNoti)&&!removed){_self.showing--;
removed=true;}}if(_self.showing==0){this.lastPos=null;}}});}oNoti.onmouseover=function(e){e=(e||event);
var tEl=e.explicitOriginalTarget||e.toElement;if(isMouseOver){return;}if(tEl==oNoti||apf.isChildOf(oNoti,tEl)){apf.tween.css(oNoti,"notifier_hover",{anim:apf.tween.NORMAL,steps:10,interval:20,onfinish:function(container){apf.setStyleClass(oNoti,"",["notifier_shown"]);
}});isMouseOver=true;}};oNoti.onmouseout=function(e){e=(e||event);var tEl=e.explicitOriginalTarget||e.toElement;
if(!isMouseOver){return;}if(apf.isChildOf(tEl,oNoti)||(!apf.isChildOf(oNoti,tEl)&&oNoti!==tEl)){isMouseOver=false;
hideWindow();}};if(ev){oNoti.onclick=function(){ev.dispatchEvent("click");};}};
this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal("notification");
this.$ext.style.display="none";this.$ext.style.position="absolute";apf.window.zManager.set("notifier",this.$ext);
};}).call(apf.notifier.prototype=new apf.Presentation());apf.aml.setElement("notifier",apf.notifier);
apf.aml.setElement("event",apf.event);apf.page=function(struct,tagName){this.$init(tagName||"page",apf.NODE_VISIBLE,struct);
};(function(){this.canHaveChildren=true;this.$focussable=false;this.closebtn=false;
this.$getEditableCaption=function(){if(!this.parentNode.$hasButtons){return false;
}return[this.parentNode.$getLayoutNode("button","caption",this.$button),"caption"];
};this.setCaption=function(caption){this.setProperty("caption",caption,false,true);
};this.setIcon=function(icon){this.setProperty("icon",icon,false,true);};this.addEventListener("beforerender",function(){this.parentNode.dispatchEvent("beforerender",{page:this});
});this.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterrender",{page:this});
});this.$booleanProperties.visible=true;this.$booleanProperties.fake=true;this.$booleanProperties.closebtn=true;
this.$supportedProperties.push("fake","caption","icon","tooltip","type","buttons","closebtn","trans-in","trans-out");
this.$propHandlers.closebtn=function(value){this.closebtn=value;};this.$propHandlers.tooltip=function(value){if(!this.parentNode){return;
}var node=this.parentNode.$getLayoutNode("button","caption",this.$button);(node.nodeType==1?node:node.parentNode).setAttribute("title",value||"");
};this.$propHandlers.caption=function(value){if(!this.parentNode){return;}var node=this.parentNode.$getLayoutNode("button","caption",this.$button);
if(node.nodeType==1){node.innerHTML=value;}else{node.nodeValue=value;}};this.$propHandlers.icon=function(value){if(!this.parentNode){return;
}var node=this.parentNode.$getLayoutNode("button","icon",this.$button);if(node&&node.nodeType==1){apf.skins.setIcon(node,value,this.parentNode.iconPath);
}};this.$propHandlers.visible=function(value){if(!this.parentNode){return;}if(value){if(this.$fake){this.parentNode.set(this.$fake);
this.visible=false;return;}this.$ext.style.display="";if(this.parentNode.$hasButtons){this.$button.style.display="block";
}if(!this.parentNode.$activepage){this.parentNode.set(this);}}else{if(this.$active){this.$deactivate();
var nextPage=this.parentNode.activepagenr+1;var pages=this.parentNode.getPages();
var len=pages.length;while(nextPage<len&&!pages[nextPage].visible){nextPage++;}if(nextPage==len){nextPage=this.parentNode.activepagenr-1;
while(nextPage>=0&&len&&!pages[nextPage].visible){nextPage--;}}if(nextPage>=0){this.parentNode.set(nextPage);
}else{this.parentNode.activepage=this.parentNode.activepagenr=this.parentNode.$activepage=null;
}}this.$ext.style.display="none";if(this.parentNode.$hasButtons){this.$button.style.display="none";
}}};this.$propHandlers.fake=function(value){if(this.$ext){apf.destroyHtmlNode(this.$ext);
this.$int=this.$ext=null;}};this.$propHandlers.type=function(value){this.setProperty("fake",true);
if(this.relPage&&this.$active){this.relPage.$deactivate();}this.relPage=this.parentNode.getPage(value);
if(this.$active){this.$activate();}};this.addEventListener("DOMNodeRemoved",function(e){if(e&&e.currentTarget!=this){return;
}if(this.$button){if(this.$position&1){this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);
}if(this.$position&2){this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);
}}if(!e.$doOnlyAdmin){if(this.$button){this.$button.parentNode.removeChild(this.$button);
}if(this.parentNode&&this.parentNode.$activepage==this){if(this.$button){this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);
}this.parentNode.$setStyleClass(this.$ext,"",["curpage"]);}}});this.addEventListener("DOMNodeInserted",function(e){if(e&&e.currentTarget!=this||!this.$amlLoaded||!e.$oldParent){return;
}if(!e.$isMoveWithinParent&&this.skinName!=this.parentNode.skinName){this.$destroy();
}else{if(this.$button&&e.$oldParent.$hasButtons){this.parentNode.$buttons.insertBefore(this.$button,e.$beforeNode&&e.$beforeNode.$button||null);
}}},true);this.$position=0;this.$first=function(remove){if(remove){this.$isFirst=false;
this.$position-=1;this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);
}else{this.$isFirst=true;this.$position=this.$position|1;this.parentNode.$setStyleClass(this.$button,"firstbtn"+(this.parentNode.$activepage==this?" firstcurbtn":""));
}};this.$last=function(remove){if(remove){this.$isLast=false;this.$position-=2;
this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}else{this.$isLast=true;
this.$position=this.$position|2;this.parentNode.$setStyleClass(this.$button,"lastbtn");
}};this.$deactivate=function(fakeOther){this.$active=false;if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"",["firstcurbtn"]);
}this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}if((!this.fake||this.relPage)&&!fakeOther){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"",["curpage"]);
if(this.fake){if(!this.relPage.visible){this.relPage.$ext.style.display="none";
}this.relPage.dispatchEvent("prop.visible",{value:false});}this.dispatchEvent("prop.visible",{value:false});
}};this.$activate=function(){this.$active=true;if(!this.$drawn){var f;this.addEventListener("DOMNodeInsertedIntoDocument",f=function(e){this.removeEventListener("DOMNodeInsertedIntoDocument",f);
if(!this.$active){return;}this.$activate();});return;}if(this.parentNode.$hasButtons){if(this.$isFirst){this.parentNode.$setStyleClass(this.$button,"firstcurbtn");
}this.parentNode.$setStyleClass(this.$button,"curbtn");}if(!this.fake||this.relPage){if(this.fake){if(this.relPage){this.relPage.$ext.style.display="";
this.parentNode.$setStyleClass(this.relPage.$ext,"curpage");this.relPage.$fake=this;
if(this.relPage.$render){this.relPage.$render();}this.relPage.dispatchEvent("prop.visible",{value:true});
}}else{this.parentNode.$setStyleClass(this.$ext,"curpage");}if(apf.layout&&this.relPage){apf.layout.forceResize(this.fake?this.relPage.$int:this.$int);
}}if(this.$render){this.$render();}if(!this.fake){if(apf.isIE){var cls=this.$ext.className;
this.$ext.className="rnd"+Math.random();this.$ext.className=cls;}this.dispatchEvent("prop.visible",{value:true});
}};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);
}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$enable=function(){if(this.$button){this.$setStyleClass(this.$button,null,["btnDisabled"]);
}};this.$disable=function(){if(this.$button){this.$setStyleClass(this.$button,"btnDisabled");
}};this.$canLeechSkin=true;this.addEventListener("prop.class",function(e){apf.setStyleClass(this.$button,e.value,this.$lastClassValueBtn?[this.$lastClassValueBtn]:null);
this.$lastClassValueBtn=e.value;});this.$draw=function(isSkinSwitch){this.skinName=this.parentNode.skinName;
var sType=this.getAttribute("type");if(sType){this.fake=true;this.relPage=this.parentNode.getPage(sType)||null;
}if(this.parentNode.$hasButtons){this.parentNode.$getNewContext("button");var elBtn=this.parentNode.$getLayoutNode("button");
elBtn.setAttribute(this.parentNode.$getOption("main","select")||"onmousedown","var page = apf.lookup("+this.$uniqueId+');                 if (page.disabled) return;                 if (event.button == 2 &amp;&amp; page.parentNode.contextmenu) {                    page.parentNode.contextPage = page;                    return;                 }                 page.parentNode.set(page);                 page.canHaveChildren = 2;                 page.$setStyleClass(this, "down", null, true);');
elBtn.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+').parentNode.$setStyleClass(this, "", ["down"], true);');
elBtn.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+").parentNode;if(apf.lookup("+this.$uniqueId+') != o.$activepage) o.$setStyleClass(this, "over", null, true);');
elBtn.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+').parentNode;                  o.$setStyleClass(this, "", ["over"], true);                  var page = apf.lookup('+this.$uniqueId+");                  page.canHaveChildren = true;");
var closebtn=this.getAttribute("closebtn");if((apf.isTrue(closebtn)||((this.parentNode.buttons||"").indexOf("close")>-1&&!apf.isFalse(closebtn)))){var btncontainer=this.parentNode.$getLayoutNode("button","container");
this.parentNode.$getNewContext("btnclose");var elBtnClose=this.parentNode.$getLayoutNode("btnclose");
if(elBtnClose){apf.setStyleClass(elBtn,"btnclose");elBtnClose.setAttribute("onmousedown","apf.cancelBubble(event, apf.lookup("+this.$uniqueId+"));");
elBtnClose.setAttribute("onclick","var page = apf.lookup("+this.$uniqueId+");                         page.parentNode.remove(page, event);");
btncontainer.appendChild(elBtnClose);}else{apf.console.warn("Missing close button in tab skin");
}}this.$button=apf.insertHtmlNode(elBtn,this.parentNode.$buttons);if(this.parentNode.$scale){var w=apf.getHtmlInnerWidth(this.parentNode.$buttons);
var l=this.parentNode.getPages().length;this.$button.style.width=Math.round(Math.min(w/l,this.parentNode.$maxBtnWidth))+"px";
}if(!isSkinSwitch&&this.nextSibling&&this.nextSibling.$button){this.$button.parentNode.insertBefore(this.$button,this.nextSibling.$button);
}this.$button.host=this;}if(this.fake){return;}if(this.$ext){this.$ext.parentNode.removeChild(this.$ext);
}this.$ext=this.parentNode.$getExternal("page",this.parentNode.oPages,null,this);
this.$ext.host=this;this.$int=this.parentNode.$getLayoutNode("page","container",this.$ext);
if(this.$isLast){this.$last();}if(this.$isFirst){this.$first();}};this.$destroy=function(){if(this.$button){if(!this.parentNode.$amlDestroyed){this.$button.parentNode.removeChild(this.$button);
}this.$button.host=null;this.$button=null;}};}).call(apf.page.prototype=new apf.Presentation());
apf.aml.setElement("page",apf.page);apf.pager=function(struct,tagName){this.$init(tagName||"pager",apf.NODE_VISIBLE,struct);
};(function(){this.previous="Previous";this.next="Next";this.range=5;this.curpage=1;
this.totalpages=0;this.autohide=false;this.oEmpty=null;this.$attrExcludePropBind=apf.extend({pageload:1},this.$attrExcludePropBind);
this.$supportedProperties.push("range","curpage","totalpages","previous","next","autohide","pageload");
this.$booleanProperties.autohide=true;this.$propHandlers.curpage=function(value){this.gotoPage(value);
};this.gotoPage=function(pageNr,pageDelta,userAction){if(userAction&&this.disabled){return;
}var lastCurpage=this.curpage;this.curpage=pageNr||this.curpage+pageDelta;if(lastCurpage!=this.curpage){this.setProperty("curpage",this.curpage);
}if(this.curpage<1){this.curpage=1;}else{if(this.totalpages&&this.curpage>this.totalpages){this.curpage=this.totalpages;
}}if(this.dispatchEvent("beforepagechange",{page:this.curpage})===false){return false;
}var model=this.getModel(true),_self=this;if(model){model.$loadFrom(this.pageload,{xmlNode:this.xmlRoot,page:this.curpage,callback:function(){_self.dispatchEvent("afterpagechange",{page:_self.curpage});
}});}else{$setTimeout(function(){var model=_self.getModel(true);if(model){model.$loadFrom(_self.pageload,{xmlNode:_self.xmlRoot,page:_self.curpage,callback:function(){_self.dispatchEvent("afterpagechange",{page:_self.curpage});
}});}_self.removeEventListener("afterload",arguments.callee);});}};this.addEventListener("$clear",function(e){return false;
});this.$setClearMessage=function(msg,type){if(!this.$empty){this.$empty=this.$container.ownerDocument.createElement("span");
this.$setStyleClass(this.$empty,"loader");}if(type=="loading"){this.$setStyleClass(this.$ext,this.$baseCSSname+"Loading");
this.$container.appendChild(this.$empty);}};this.$removeClearMessage=function(){if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);
this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Loading"]);}};this.$draw=function(){this.$ext=this.$getExternal("main");
this.$container=this.$getLayoutNode("main","container",this.$ext);};this.$load=function(xmlRoot){this.setProperty("curpage",parseInt(this.$applyBindRule("current",xmlRoot)));
this.setProperty("totalpages",parseInt(this.$applyBindRule("total",xmlRoot)));var curpage=this.curpage,totalpages=this.totalpages,nodes=[],btn;
this.$container.innerHTML="";if(!totalpages){return;}if(curpage!=1||!this.autohide){this.$getNewContext("button");
btn=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=this.previous;
this.$setStyleClass(btn,"previous");if(curpage!=1){btn.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage(null, -1, true)");
btn.setAttribute("onmousedown",'apf.setStyleClass(this, "down");');btn.setAttribute("onmouseup",'apf.setStyleClass(this,"", ["down"]);');
}else{this.$setStyleClass(btn,"disabled");}nodes.push(btn);}var rlow=Math.floor(this.range/2),start=Math.max(1,curpage-rlow),end=Math.min(totalpages+1,start+this.range),i;
if(end-start<this.range&&start!=1){start=Math.max(end-this.range,1);}for(i=start;
i<end;i++){this.$getNewContext("button");btn=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=i;
btn.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage("+i+", null, true)");
btn.setAttribute("onmousedown",'apf.setStyleClass(this, "down");');btn.setAttribute("onmouseup",'apf.setStyleClass(this,"", ["down"]);');
nodes.push(btn);if(i==curpage){this.$setStyleClass(btn,"current");}}if(curpage!=totalpages||!this.autohide){this.$getNewContext("button");
btn=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=this.next;
this.$setStyleClass(btn,"next");if(curpage!=totalpages){btn.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage(null, 1, true)");
btn.setAttribute("onmousedown",'apf.setStyleClass(this, "down");');btn.setAttribute("onmouseup",'apf.setStyleClass(this,"", ["down"]);');
}else{this.$setStyleClass(btn,"disabled");}nodes.push(btn);}apf.insertHtmlNodes(nodes,this.$container);
if(this.$empty){this.$container.appendChild(this.$empty);}};}).call(apf.pager.prototype=new apf.StandardBinding());
apf.aml.setElement("pager",apf.pager);apf.aml.setElement("total",apf.BindingRule);
apf.aml.setElement("current",apf.BindingRule);apf.palette=function(struct,tagName){this.$init(tagName||"palette",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=true;this.value="ff0000";
this.direction="down";this.$supportedProperties.push("value");this.$propHandlers.value=function(value){this.oViewer.style.backgroundColor=value;
};this.setValue=function(value){this.setProperty("value",value,false,true);};this.getValue=function(){return this.value?this.value:"";
};this.$addColor=function(clr,oContainer){if(!oContainer){oContainer=this.oCustom;
}var oItem=this.$getLayoutNode("item");if(oContainer==this.oCustom){oItem.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").$doCustom(this, null, true)");
oItem.setAttribute("ondblclick","apf.lookup("+this.$uniqueId+").$doCustom(this, true, true)");
}else{oItem.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").change(this.style.backgroundColor.replace(/^#/, ''))");
}oItem=apf.insertHtmlNode(oItem,oContainer);this.$getLayoutNode("item","background",oItem).style.backgroundColor="#"+clr;
};this.$setCustom=function(oItem,clr){oItem.style.backgroundColor=clr;this.change(clr);
};this.$doCustom=function(oItem,force_create,userAction){if(userAction&&this.disabled){return;
}if(force_create||oItem.style.backgroundColor=="#ffffff"){this.dispatchEvent("createcustom",{htmlNode:oItem});
}else{this.change(oItem.style.backgroundColor.replace(/^#/,""));}};this.defaultValue="ff0000";
this.colors=["fc0025","ffd800","7dff00","32ffe0","0026ff","cd00ff","ffffff","e5e5e5","d9d9d9","de003a","ffc600","009022","00bee1","003e83","dc0098","737373","666666","000000"];
this.$draw=function(){this.$ext=this.$getExternal();this.oViewer=this.$getLayoutNode("main","viewer",this.$ext);
this.oStandard=this.$getLayoutNode("main","standard",this.$ext);this.oCustom=this.$getLayoutNode("main","custom",this.$ext);
var i;for(i=0;i<this.colors.length;i++){this.$addColor(this.colors[i],this.oStandard);
}for(i=0;i<9;i++){this.$addColor("ffffff");}};}).call(apf.palette.prototype=new apf.StandardBinding());
apf.aml.setElement("palette",apf.palette);apf.param=function(struct,tagName){this.$init(tagName||"param",apf.NODE_HIDDEN,struct);
};apf.param.prototype=new apf.AmlElement();apf.param.prototype.$parsePrio="002";
apf.aml.setElement("variable",apf.param);apf.aml.setElement("param",apf.param);
apf.persist=function(struct,tagName){this.$init(tagName||"persist",apf.NODE_HIDDEN,struct);
var _self=this;apf.addEventListener("exit",function(e){if(_self.listening){_self.disconnect();
}});};(function(){this.retryinterval=1000;this.PATHS={login:"/login",logout:"/logout",pipe:"/pipe"};
this.$supportedProperties.push("host","retry","retryinterval");this.$handleError=function(data,state,extra,callback){var oError,amlNode=this;
if(extra.http.readyState&&(extra.status==401||extra.status==403||extra.status==500)){oError=new Error(apf.formatErrorString(10000,amlNode,"Persist protocol",extra.statusText+" in "+amlNode.name+"["+amlNode.tagName+"] \nUrl: "+extra.url+"\nInfo: "+extra.message));
}else{oError=new Error(apf.formatErrorString(10001,amlNode,"Polling in persist protocol","Connection dissapeared "+amlNode.name+"["+amlNode.tagName+"] \nUrl: "+extra.url+"\nInfo: "+extra.message));
}if(typeof callback=="function"){return callback.call(amlNode,data,state,extra,oError);
}else{var result=amlNode.retryTimeout(extra,state,amlNode,oError);if(result===true){return true;
}else{if(result===2){this.dispatchEvent("disconnect");this.$stopListen();return true;
}}}this.dispatchEvent("disconnect");this.$stopListen();throw oError;};this.addEventListener("error",function(e){return this.dispatchEvent("connectionerror",e);
});this.normalizeEntity=function(id){return id;};this.isConnected=function(){return this.listening==true;
};this.$startListen=function(){this.listening=true;this.$poll();};this.$stopListen=function(){this.listening=false;
this.setProperty("sessionId","");this.cancel(this.$lastpoll);};this.$poll=function(){if(!this.sessionId||!this.listening){return;
}var _self=this;this.$lastpoll=this.get(this.host+this.PATHS.pipe+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"GET",callback:function(message,state,extra){if(state!=apf.SUCCESS){var knownError=extra.http.readyState&&(extra.status==401||extra.status==403||extra.status==500);
if(state==apf.TIMEOUT||!knownError&&extra.retries<(_self.maxretries||apf.maxHttpRetries)){setTimeout(function(){extra.tpModule.retry(extra.id);
},_self.retryinterval);return true;}_self.$stopListen();return _self.$handleError(message,state,extra);
}else{_self.$poll();if(message){var data=apf.unserialize(message);var body=[];for(var i=0,l=data.length;
i<l;i++){if(!data[i]){apf.console.warn("empty message received!");continue;}var d=data[i];
if(d.type=="update"){_self.dispatchEvent("update",{message:d.message,uri:d.uri,annotator:d.uId});
}else{if(d.type=="join"){_self.dispatchEvent("join",{uri:d.uri,basetime:d.basetime,document:d.document,annotator:d.uId});
}else{if(d.type=="leave"){_self.dispatchEvent("leave",{uri:d.uri});}}}}}}}});};
this.join=function(uri,callback){if(!this.sessionId){apf.console.warn("Could not start RDB session, missing session id.");
return false;}var _self=this;this.get(this.host+new apf.url(uri).path+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"LOCK",callback:function(data,state,extra){if(state!=apf.SUCCESS){return _self.$handleError(data,state,extra,callback);
}else{if(callback){callback(uri);}}}});};this.leave=function(uri){var _self=this;
this.get(this.host+new apf.url(uri).path+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"UNLOCK",callback:function(data,state,extra){if(state!=apf.SUCCESS){return _self.$handleError(data,state,extra);
}}});};this.sendUpdate=function(uri,message){var _self=this;this.contentType="application/json";
this.get(this.host+new apf.url(uri).path+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"PUT",data:message,callback:function(data,state,extra){if(state!=apf.SUCCESS){return _self.$handleError(data,state,extra);
}}});};this.login=this.connect=function(username,password,redirect,token,callback){var _self=this;
if(this.listening){this.$stopListen();_self.dispatchEvent("disconnect");}this.contentType="application/x-www-form-urlencoded";
this.get(this.host+this.PATHS.login+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"POST",data:"username="+encodeURIComponent(username)+"&password="+encodeURIComponent(password)+(redirect?"&redirect="+encodeURIComponent(redirect):"")+(token?"&token="+encodeURIComponent(token):""),callback:function(data,state,extra){if(state!=apf.SUCCESS){return _self.$handleError(data,state,extra,callback);
}else{data=apf.unserialize(data);_self.setProperty("sessionId",data.sId||data.pId);
if(!_self.sessionId){extra.message="Did not get a session id from the server";return _self.$handleError(data,apf.ERROR,extra,callback);
}else{var m=data.availableMethods;for(var i=0;i<m.length;i++){this[m[i]]=_self.$addMethod(m[i]);
}_self.$startListen();_self.dispatchEvent("connect",data);if(callback){callback(data,state,extra);
}}}}});};this.logout=this.disconnect=function(callback){if(!this.listening){return;
}var _self=this;this.contentType="application/x-www-form-urlencoded";this.get(this.host+this.PATHS.logout+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"POST",callback:function(data,state,extra){if(state!=apf.SUCCESS){return _self.$handleError(data,state,extra,callback);
}else{_self.dispatchEvent("disconnect");if(callback){callback(data,state,extra);
}}}});this.$stopListen();};this.pause=function(secs){};this.$addMethod=function(def){var funcName=def.name.replace(/\/(\w)/g,function(m,a){return a.toUpperCase();
});this[funcName]=function(){var args=def.args,out=[];for(var i=0;i<args.length;
i++){out.push(args[i]+"="+encodeURIComponent(arguments[i]));}var callback=arguments[arguments.length-1];
var _self=this;this.contentType="application/x-www-form-urlencoded";this.get(this.host+"/"+def.name+"?sid="+this.sessionId,{nocache:true,ignoreOffline:true,method:"POST",data:out.join("&"),callback:function(data,state,extra){if(state!=apf.SUCCESS){return _self.$handleError(data,state,extra,callback);
}else{if(typeof callback=="function"){callback(data,state,extra);}}}});};};this.$addMethod({name:"sendpassword",args:["username"]});
this.exec=function(method,args,callback){switch(method){case"login":this.connect(args[0],args[1],args[2],args[3],callback);
break;case"logout":this.disconnect(callback);break;default:if(typeof this[method]=="function"){args.push(callback);
this[method].apply(this,args);}else{throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Invalid XMPP method '"+method+"'"));
}break;}};}).call(apf.persist.prototype=new apf.Teleport());apf.aml.setElement("persist",apf.persist);
apf.portal=function(struct,tagName){this.$init(tagName||"portal",apf.NODE_VISIBLE,struct);
this.$columns=[];};(function(){this.implement(apf.DataAction);this.$focussable=false;
this.buttons="edit|min|close";this.$deInitNode=function(xmlNode,htmlNode){cacheDocklet.call(this,apf.findHost(htmlNode));
};this.$updateNode=function(xmlNode,htmlNode){var docklet=apf.findHost(htmlNode);
docklet.setProperty("buttons",this.$applyBindRule("buttons",xmlNode)||"");docklet.draggable=this.$applyBindRule("draggable",xmlNode);
};this.$moveNode=function(xmlNode,htmlNode){if(!htmlNode){return;}};this.select=function(){};
this.findColumnNr=function(x,y){var el=document.elementFromPoint(x,y);while(!el.isColumn&&el.parentNode){el=el.parentNode;
}return el.isColumn&&this.$columns.indexOf(el)||0;};this.$moveDocklet=function(docklet){var colNr=this.$columns.indexOf(docklet.$ext.parentNode)||0;
var dataNode=docklet.dataNode;dataNode.setAttribute("column",colNr);var nr=apf.xmldb.getChildNumber(docklet.oExt),nodes=dataNode.selectNodes("../node()[@column='"+colNr+"']");
if(nodes[nr]!=dataNode){var jmlNode=apf.findHost(docklet.oExt.nextSibling);dataNode.parentNode.insertBefore(dataNode,jmlNode&&jmlNode.dataNode||null);
}this.dispatchEvent("widgetmove");};this.columns="33.33%,33.33%,33.33%";this.$columnWidths=this.columns.splitSafe(",");
this.$propHandlers.columns=function(value){if(!value){return;}this.$columnWidths=value.splitSafe(",");
var col,nodes,pHtmlNode,amlNode,node;while(this.$columns.length>this.$columnWidths.length){col=this.$columns.pop();
col.host=null;nodes=col.childNodes;pHtmlNode=this.$columns[0];for(var i=nodes.length-1;
i>=0;i--){if((node=nodes[i]).nodeType!=1){continue;}pHtmlNode.appendChild(node);
amlNode=apf.findHost(node);amlNode.$pHtmlNode=pHtmlNode;amlNode.dataNode.setAttribute("column",0);
}apf.destroyHtmlNode(col);}for(var last,col,size,i=0;i<this.$columnWidths.length;
i++){size=this.$columnWidths[i];if(!this.$columns[i]){this.$getNewContext("column");
col=apf.insertHtmlNode(this.$getLayoutNode("column"),this.$int,this.$int.lastChild);
this.$columns.push(col);col.isColumn=true;col.host=this;}else{col=this.$columns[i];
this.oInt.insertBefore(col,this.oInt.lastChild);}this.$setStyleClass(col,(last=(i==this.$columnWidths.length-1))?"collast":"",["collast"]);
size.match(/(%|px|pt)/);var unit=RegExp.$1||"px";col.style.width=(parseInt(size)-(apf.isIE&&apf.isIE<8&&last?1:0))+unit;
}};this.addEventListener("keydown",function(e){var key=e.keyCode;var ctrlKey=e.ctrlKey;
var shiftKey=e.shiftKey;var altKey=e.altKey;if(!this.selected){return;}switch(key){default:break;
}},true);function cacheDocklet(docklet){var srcUrl=docklet.$srcUrl;if(!srcUrl){throw new Error("Something went terribly wrong");
}if(docklet.$dockletClass.$unload){docklet.$dockletClass.$unload();}var amlNodes=[],amlNode,widget=docklet_cache[srcUrl];
if(docklet.oSettings){var nodes=docklet.oSettings.childNodes;while(nodes.length){amlNode=apf.findHost(widget.fragSettings.appendChild(nodes[0]));
if(amlNode){amlNodes.push(amlNode.removeNode(null,true));}}}var nodes=docklet.$int.childNodes;
while(nodes.length){amlNode=apf.findHost(widget.fragInt.appendChild(nodes[0]));
if(amlNode){amlNodes.push(amlNode.removeNode(null,true));}}var nodes=docklet.childNodes;
for(var i=nodes.length-1;i>=0;i--){amlNodes.push(nodes[i].removeNode(null,true));
}widget.amlNodes=amlNodes;docklet.oSettings=docklet.$int=null;docklet.childNodes=[];
dockwin_cache.push(docklet);docklet.parentNode=null;docklet.$ext.parentNode.removeChild(docklet.$ext);
return srcUrl;}this.$getCurrentFragment=function(){var fr,col,fragment=[];for(var i=0,l=this.$columns.length;
i<l;i++){col=this.$columns[i];for(var j=col.childNodes.length-1;j>=0;j--){if(col.childNodes[j].nodeType!=1){continue;
}fragment.push(cacheDocklet.call(this,apf.findHost(col.childNodes[j])));}}return fragment;
};this.$setCurrentFragment=function(fragment){var dataNode,pHtmlNode,srcUrl,docklet,nodes=this.getTraverseNodes();
for(var i=0,l=nodes.length;i<l;i++){dataNode=nodes[i];pHtmlNode=this.$columns[this.$applyBindRule("column",dataNode)||0];
srcUrl=this.$applyBindRule("src",dataNode)||"file:"+this.$applyBindRule("url",dataNode);
docklet=getDockwin.call(this,dataNode,pHtmlNode);createWidget.call(this,srcUrl,null,docklet,dataNode);
}};var oEmpty;this.$setClearMessage=function(msg){if(!oEmpty){if(!this.$hasLayoutNode("empty")){return;
}this.$getNewContext("empty");var xmlEmpty=this.$getLayoutNode("empty");if(!xmlEmpty){return;
}oEmpty=apf.insertHtmlNode(xmlEmpty,this.$int);}else{if(!this.oInt.lastChild){this.oInt.appendChild(oEmpty);
}else{this.oInt.insertBefore(oEmpty,this.oInt.lastChild);}}var empty=this.$getLayoutNode("empty","caption",oEmpty);
if(empty){apf.setNodeValue(empty,msg||"");}if(oEmpty){oEmpty.setAttribute("id","empty"+this.$uniqueId);
}};this.$removeClearMessage=function(){var oEmpty=document.getElementById("empty"+this.$uniqueId);
if(oEmpty){oEmpty.parentNode.removeChild(oEmpty);}};var docklet_cache={};function createWidget(srcUrl,strXml,docklet,dataNode){var widget;
while(widget=docklet_cache[srcUrl]){if(!widget.fragInt.childNodes.length){srcUrl+="_";
}else{break;}}if(!widget&&!strXml){srcUrl="error";widget=docklet_cache.error;}docklet.$getLayoutNode("main","container",docklet.$ext).innerHTML="";
docklet.$srcUrl=srcUrl;if(widget){var xmlNode=widget.xmlNode;if(xmlNode.getAttribute("width")){docklet.setProperty("width",xmlNode.getAttribute("width"));
}else{docklet.$ext.style.width="auto";}docklet.oSettings=docklet.$getLayoutNode("main","settings_content",docklet.$ext);
docklet.$int=docklet.$getLayoutNode("main","container",docklet.$ext);docklet.$int.appendChild(widget.fragInt);
if(docklet.oSettings){docklet.oSettings.appendChild(widget.fragSettings);}var amlNodes=widget.amlNodes||[];
for(var i=0,l=amlNodes.length;i<l;i++){if(amlNodes[i].hasFeature){docklet.appendChild(amlNodes[i],null,true);
}}docklet.$dockletClass=widget.dockletClass;if(widget.dockletClass.load){widget.dockletClass.load(dataNode,docklet);
}}else{var uId=apf.all.length;var col=[];strXml=strXml.replace(/\b(id|actiontracker|group)="([^"]*)"|\b(id|actiontracker|group)='([^']*)''/g,function(m,n1,id1,n2,id2){var id=id1||id2;
col.push(id);if(id1){return n1+'="'+id+"_"+uId+'"';}if(id2){return n2+"='"+id+"_"+uId+"'";
}});if(col.length){strXml=strXml.replace(new RegExp("\\b("+col.join("|")+")\\b","g"),function(m,id){return id+"_"+uId;
});}var dockletWidget=this.ownerDocument.$domParser.parseFromString(strXml,"text/xml",{docFrag:docklet,doc:docklet.ownerDocument,htmlNode:docklet.$int}).firstChild;
var name=dockletWidget.name;if(dockletWidget.width){docklet.setProperty("width",dockletWidget.width);
}else{docklet.$ext.style.width="auto";}if(!self[name]){throw new Error("could not find docklet class '"+name+"'");
}var dockletClass=new self[name]().$init();this.docklets.push(dockletClass);dockletClass.create(dataNode,docklet,this);
if(dockletClass.load){dockletClass.load(dataNode,docklet);}docklet.$dockletClass=dockletClass;
docklet_cache[srcUrl]={srcUrl:srcUrl,xmlNode:dockletWidget.$aml,fragInt:document.createDocumentFragment(),fragSettings:document.createDocumentFragment(),dockletClass:dockletClass};
}docklet.$refParent=this.$int;}var dockwin_cache=[];function getDockwin(dataNode,pHtmlNode){var docklet;
var columns=this.$applyBindRule("columns",this.xmlRoot);if(columns!=this.columns){this.setProperty("columns",columns);
pHtmlNode=this.$columns[this.$applyBindRule("column",dataNode)||0];}if(docklet=dockwin_cache.pop()&&(typeof dockwin_cache.pop()=="function"&&dockwin_cache.pop().dataNode==dataNode)){docklet.parentNode=this;
pHtmlNode.appendChild(docklet.$ext);docklet.$pHtmlNode=pHtmlNode;var skin=this.$applyBindRule("dockskin",dataNode)||"docklet";
if(docklet.skin!=skin){docklet.$forceSkinChange(docklet.skin=skin);}docklet.show();
}else{docklet=new apf.modalwindow({htmlNode:pHtmlNode,skinset:apf.getInheritedAttribute(this.parentNode,"skinset"),skin:this.$applyBindRule("dockskin",dataNode)||"docklet",draggable:true,visible:true});
docklet.implement(apf.modalwindow.widget);docklet.parentNode=this;docklet.$create();
docklet.addEventListener("beforestatechange",function(e){if(e.to.maximized){docklet.$ext.parentNode.style.zIndex=100000;
}return this.$dockletClass.dispatchEvent("beforestatechange",e);});docklet.addEventListener("afterstatechange",function(e){if(e.from.maximized){docklet.$ext.parentNode.style.zIndex=1;
}this.$dockletClass.dispatchEvent("afterstatechange",e);if(e.to.closed){this.remove(this.dataNode);
}});}docklet.dataNode=dataNode;apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(dataNode),dataNode,docklet.$ext,this);
if(this.$hasBindRule("buttons")){docklet.setProperty("buttons",this.$applyBindRule("buttons",dataNode)||this.buttons);
}docklet.setProperty("state",this.$applyBindRule("state",dataNode)||"normal");docklet.setProperty("title",this.$applyBindRule("caption",dataNode));
docklet.setProperty("icon",this.$applyBindRule("icon",dataNode));docklet.show();
return docklet;}this.$clear=function(){};this.docklets=[];var xml_cache={};this.$add=function(dataNode,Lid,xmlParentNode,htmlParentNode,beforeNode){var pHtmlNode=this.$columns[this.$applyBindRule("column",dataNode)||0];
var srcUrl=this.$applyBindRule("src",dataNode)||"file:"+this.$applyBindRule("url",dataNode);
if(!pHtmlNode){var cols=this.$applyBindRule("columns",this.xmlRoot);if(cols&&cols!=this.columns){this.setProperty("columns",cols);
}pHtmlNode=this.$columns[this.$applyBindRule("column",dataNode)||0];if(!pHtmlNode){throw new Error(apf.formatErrorString(0,this,"Building docklet","Cannot find column to hook docklet on. Seems like a timing error"));
}}var docklet=getDockwin.call(this,dataNode,pHtmlNode);if(xml_cache[srcUrl]){var strXml=xml_cache[srcUrl];
createWidget.call(this,srcUrl,strXml,docklet,dataNode);}else{docklet.$getLayoutNode("main","container",docklet.$ext).innerHTML="<div class='loading'>Loading...</div>";
var model=new apf.model(),_self=this;model.$loadFrom(srcUrl,{callback:function(data,state,extra){if(!data||state!=apf.SUCCESS){createWidget.call(_self,"error","<a:docklet xmlns:a='"+apf.ns.apf+"' name='dockerror'>                        <a:script><![CDATA[                            function dockerror(){                                this.init = this.load = function(x,d){                                    d.setAttribute('buttons', '');                                    d.setAttribute('icon', '');                                    d.setAttribute('title', 'Error')                                }                            }                        ]]></a:script>                        <a:body>                            <a:label style='margin:0 auto 0 auto'>Error loading this widget</a:label>                        </a:body>                    </a:docklet>",docklet,dataNode);
return true;}var strXml=data;if(apf.isSafariOld){strXml=strXml.replace(/name/,"name='"+xmlNode.getAttribute("name")+"'");
xml_cache[srcUrl]=strXml;}else{xml_cache[srcUrl]=strXml;}createWidget.call(_self,srcUrl,strXml,docklet,dataNode);
this.isLoaded=true;}});}};this.$fill=function(){};this.addEventListener("beforeload",function(e){if(!this.$columns.length){var cols=this.$applyBindRule("columns",e.xmlNode);
if(cols&&cols!=this.columns){this.setProperty("columns",cols);}}});this.addEventListener("xmlupdate",function(e){var cols=this.$applyBindRule("columns",this.xmlRoot);
if(cols&&cols!=this.columns){this.setProperty("columns",cols);}});this.$selectDefault=function(xmlNode){if(this.select(this.getFirstTraverseNode(xmlNode),null,null,null,true)){return true;
}else{var nodes=this.getTraverseNodes(xmlNode);for(var i=0;i<nodes.length;i++){if(this.$selectDefault(nodes[i])){return true;
}}}};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
};this.$loadAml=function(x){if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);
}};}).call(apf.portal.prototype=new apf.MultiSelect());apf.aml.setElement("portal",apf.portal);
apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("column",apf.BindingRule);
apf.aml.setElement("draggable",apf.BindingRule);apf.aml.setElement("dockskin",apf.BindingRule);
apf.aml.setElement("buttons",apf.BindingRule);apf.aml.setElement("caption",apf.BindingRule);
apf.aml.setElement("traverse",apf.BindingRule);apf.portal.Docklet=function(){};
apf.portal.Docklet.prototype=new apf.Class();apf.portal.Docklet.prototype.create=function(xmlSettings,oWidget,oPortal){this.xmlSettings=xmlSettings;
this.oWidget=oWidget;if(this.$create){this.$create(xmlSettings,oWidget,oPortal);
}};apf.progress=function(struct,tagName){this.$init(tagName||"progress",apf.NODE_VISIBLE,struct);
};apf.progressbar=function(struct,tagName){this.$init(tagName||"progressbar",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=false;this.value=0;
this.min=0;this.max=100;this.$running=false;this.$timer;this.$booleanProperties.autostart=true;
this.$booleanProperties.autohide=true;this.$supportedProperties.push("value","min","max","autostart","autohide");
this.$propHandlers.value=function(value){this.value=parseInt(value)||this.min;if(this.value>=this.max){apf.setStyleClass(this.$ext,this.$baseCSSname+"Complete",[this.$baseCSSname+"Running",this.$baseCSSname+"Half"]);
}else{apf.setStyleClass(this.$ext,this.$baseCSSname+"Running",[this.$baseCSSname+"Complete"]);
}if(this.value>=this.max/2){apf.setStyleClass(this.$ext,this.$baseCSSname+"Half",[]);
}this.oSlider.style.width=(this.value*100/(this.max-this.min))+"%";this.oCaption.nodeValue=Math.round((this.value/(this.max-this.min))*100)+"%";
};this.$propHandlers.min=function(value){this.min=parseFloat(value);};this.$propHandlers.max=function(value){this.max=parseFloat(value);
};this.setValue=function(value){this.setProperty("value",value,false,true);};this.getValue=function(){return this.value;
};this.clear=function(){this.$clear();};this.$clear=function(restart,restart_time){clearInterval(this.$timer);
this.setValue(this.min);apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Running",this.$baseCSSname+"Complete"]);
if(restart){var _self=this;this.$timer=setInterval(function(){_self.start(restart_time);
});}if(this.autohide){this.hide();}this.$running=false;};this.start=function(time){if(this.autohide){this.show();
}clearInterval(this.$timer);var _self=this;this.$timer=setInterval(function(){if(_self.$amlDestroyed){clearInterval(_self.$timer);
}else{_self.$step();}},time||1000);this.$setStyleClass(this.$ext,this.$baseCSSname+"Running");
};this.pause=function(){clearInterval(this.$timer);};this.stop=function(restart,time,restart_time){clearInterval(this.$timer);
this.setValue(this.max);var _self=this;this.$timer=setInterval(function(){_self.$clear(restart,(restart_time||0));
},time||500);};this.$step=function(){if(this.value==this.max){return;}this.setValue(this.value+1);
};this.$draw=function(clear,parentNode,Node,transform){this.$ext=this.$getExternal();
this.oSlider=this.$getLayoutNode("main","progress",this.$ext);this.oCaption=this.$getLayoutNode("main","caption",this.$ext);
};this.$loadAml=function(x){if(this.autostart){this.start();}if(this.autohide){this.hide();
}};}).call(apf.progressbar.prototype=new apf.StandardBinding());apf.progress.prototype=apf.progressbar.prototype;
apf.aml.setElement("progress",apf.progress);apf.aml.setElement("progressbar",apf.progressbar);
apf.propedit=function(struct,tagName){this.$init(tagName||"propedit",apf.NODE_VISIBLE,struct);
this.$nodes=[];this.$editors={};this.$dynCssClasses=[];};(function(){this.$init(function(){this.addEventListener("keydown",keyHandler,true);
});this.implement(apf.Cache);this.implement(apf.DataAction);this.$focussable=true;
this.$isTreeArch=true;this.$isWindowContainer=-1;this.startClosed=true;this.$animType=apf.tween.NORMAL;
this.$animSteps=3;this.$animSpeed=20;this.$useiframe=0;this.$attrExcludePropBind=apf.extend({properties:3},this.$attrExcludePropBind);
this.$booleanProperties.iframe=true;this.$propHandlers.properties=function(value){if(!value){return this.clear();
}var _self=this;var propLoadObj={load:function(data){_self.$loadingProps=false;
if(typeof data=="string"){data=apf.getXml(data);}_self.$properties=data;_self.$allowLoad=true;
if(_self.$loadqueue){_self.$checkLoadQueue();}else{if(_self.xmlRoot){_self.load(_self.xmlRoot);
}}delete _self.$allowLoad;},clear:function(){_self.$loadingProps=false;},xmlRoot:this.xmlRoot};
var xml;this.$loadingProps=true;if(typeof value=="string"){if(value.substr(0,1)=="<"){propLoadObj.load(value);
}else{apf.setModel(value,propLoadObj);}}else{if(value.$isModel){value.register(propLoadObj);
}else{if(this.$properties==value&&!this.caching){return;}setTimeout(function(){propLoadObj.load(value);
});}}if(this.$properties){this.$prevProperties=this.$properties;}delete this.$properties;
};this.addEventListener("prop.properties",function(e){if(!e.changed&&this.$loadqueue){this.$propHandlers.properties.call(this,e.value);
}});this.$columns=["50%","50%"];this.$propHandlers.columns=function(value){this.$columns=value&&value.splitSafe(",")||["50%","50%"];
if(this.$headings){this.$headings[0].setProperty("width",this.$columns[0]);this.$headings[1].setProperty("width",this.$columns[1]);
}};this.$propHandlers.filter=function(value){if(!value){this.$allowLoad=2;var xmlRoot=this.xmlRoot;
this.clear();if(this.$searchProperties){this.$properties=this.$searchProperties;
delete this.$searchProperties;}this.load(xmlRoot);delete this.$allowLoad;return;
}var p=(this.$searchProperties||(this.$searchProperties=this.$getProperties())).cloneNode(true);
var nodes=p.selectNodes("//node()[not(local-name()='group' or contains(translate(@caption, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), '"+value+"'))]");
for(var i=nodes.length-1;i>=0;i--){nodes[i].parentNode.removeChild(nodes[i]);}nodes=p.selectNodes("//node()[local-name()='group' and not(node())]");
var parent;for(var i=nodes.length-1;i>=0;i--){parent=nodes[i].parentNode;parent.removeChild(nodes[i]);
if(!parent.childNodes.length&&parent.parentNode){parent.parentNode.removeChild(parent);
}}var xmlRoot=this.xmlRoot;this.clear();this.$properties=p;this.$allowLoad=2;this.load(xmlRoot,{force:true});
delete this.$allowLoad;};function scrollIntoView(){var Q=(this.current||this.$selected),o=this.$body;
o.scrollTop=(Q.offsetTop)-21;}this.$findHtmlNode=function(id){return this.$pHtmlDoc.getElementById(id);
};function keyHandler(e){var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey;
var selXml=this.$lastEditor&&this.$lastEditor[2],oInt=this.$useiframe?this.oDoc.documentElement:this.$body,margin,node,hasScroll,hasScrollX,hasScrollY,items,lines;
switch(key){case 36:return false;case 35:return false;case 107:break;case 37:this.$slideToggle(this.$selected.firstChild);
return false;case 107:case 39:this.$slideToggle(this.$selected.firstChild);return false;
case 38:var node=selXml;var sNode=selXml.previousSibling;while(sNode&&sNode.nodeType!=1){sNode=sNode.previousSibling;
}if(sNode){var last=sNode,nodes;while((nodes=last.selectNodes("prop")).length){last=nodes[nodes.length-1];
}sNode=last;}else{sNode=node.parentNode;if(sNode[apf.TAGNAME]!="prop"){sNode=sNode.previousSibling;
while(sNode&&sNode.nodeType!=1){sNode=sNode.previousSibling;}if(sNode&&sNode[apf.TAGNAME]!="prop"){sNode=(nodes=sNode.selectNodes("prop"))[nodes.length-1];
while(sNode&&sNode.nodeType!=1){sNode=sNode.previousSibling;}}}}if(!sNode){return;
}var selHtml=apf.xmldb.findHtmlNode(sNode,this);while(!selHtml.offsetWidth){selHtml=apf.xmldb.findHtmlNode(sNode=sNode.parentNode,this);
}var top=apf.getAbsolutePosition(selHtml,this.$body)[1]-(selHtml.offsetHeight/2);
if(top<=this.$ext.scrollTop){this.$ext.scrollTop=top;}this.select(selHtml);return false;
case 40:var node,sNode=(node=selXml).selectSingleNode("prop")||node.nextSibling;
do{while(sNode&&(sNode.nodeType!=1||sNode[apf.TAGNAME]!="prop")){sNode=sNode.nextSibling;
}if(!sNode){sNode=node.parentNode.nextSibling;if(sNode&&sNode[apf.TAGNAME]!="prop"){sNode=sNode.selectSingleNode("prop");
}}}while(sNode&&sNode.nodeType!=1);if(!sNode){return;}var selHtml=apf.xmldb.findHtmlNode(sNode,this);
while(!selHtml.offsetWidth){selHtml=apf.xmldb.findHtmlNode(sNode=sNode.parentNode,this);
}if(sNode==node){sNode=node.nextSibling;while(sNode&&(sNode.nodeType!=1||sNode[apf.TAGNAME]!="prop")){sNode=sNode.nextSibling;
}var selHtml=apf.xmldb.findHtmlNode(sNode,this);}var top=apf.getAbsolutePosition(selHtml,this.$body)[1]+(selHtml.offsetHeight/2);
if(top>this.$ext.scrollTop+this.$ext.offsetHeight){this.$ext.scrollTop=top-this.$ext.offsetHeight;
}this.select(selHtml);return false;}}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;
}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}if(this.$lastEditor){this.$lastEditor[0].$focus();}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);
}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);
if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);
}if(this.$lastEditor){this.$lastEditor[0].$blur();}};this.$slideToggle=function(htmlNode){container=htmlNode.parentNode.lastChild;
if(apf.getStyle(container,"display")=="block"){htmlNode.className=htmlNode.className.replace(/min/,"plus");
this.$slideClose(container);}else{htmlNode.className=htmlNode.className.replace(/plus/,"min");
this.$slideOpen(container);}};this.$slideOpen=function(container){container.style.display="";
apf.tween.single(container,{type:"scrollheight",from:3,diff:-2,to:container.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(container){container.style.overflow="visible";
container.style.height="auto";}});};this.$slideClose=function(container){container.style.height=container.offsetHeight;
container.style.overflow="hidden";apf.tween.single(container,{type:"scrollheight",from:container.scrollHeight,diff:-2,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(container,data){container.style.display="none";
}});};this.$findContainer=function(htmlNode){var node=htmlNode.nextSibling;if(!node){return htmlNode;
}return node.nodeType==1?node:node.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(e){var rules=e.bindings.properties;
if(!rules||!rules.length){return;}for(var i=0,l=rules.length;i<l;i++){}});this.$unloaddatabinding=function(){};
this.getColumn=function(nr){return this.$headings[nr||this.$lastcol||0];};this.resizeColumn=function(nr,newsize){var h=this.$headings[nr];
h.resize(newsize);};this.hideColumn=function(nr){var h=this.$headings[nr];h.hide();
};this.showColumn=function(nr){var h=this.$headings[nr];h.show();};this.$getProperties=function(xmlNode){if(this.properties){return this.$properties||false;
}else{if(this.$bindings.properties){var props=this.$bindings.properties;for(var i=0;
i<props.length;i++){if(!props[i].match){return xx;}}}}return false;};this.$canLoadData=function(){if(this.$allowLoad||!this.$attrBindings.properties){return this.$getProperties()?true:false;
}else{if(false){var _self=this;apf.queue.add("load"+this.$uniqueId,function(){_self.$allowLoad=true;
_self.$checkLoadQueue();delete _self.$allowLoad;});return false;}}};this.$generateCacheId=function(xmlNode){var node=this.$getProperties();
return node?node.getAttribute(apf.xmldb.xmlIdTag)||apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(node),node):0;
};this.$getCurrentFragment=function(){var fragment=this.$container.ownerDocument.createDocumentFragment();
fragment.properties=this.$searchProperties||this.$prevProperties||this.$properties;
while(this.$container.childNodes.length){fragment.appendChild(this.$container.childNodes[0]);
}this.clearSelection();return fragment;};this.$setCurrentFragment=function(fragment){this.$container.appendChild(fragment);
if(!apf.window.hasFocus(this)){this.blur();}apf.xmldb.addNodeListener(this.xmlRoot,this);
if(this.filter&&this.$allowLoad!=2){delete this.$searchProperties;this.$prevProperties=fragment.properties;
this.$propHandlers.filter.call(this,this.filter);}else{this.$xmlUpdate(null,this.xmlRoot);
this.$properties=fragment.properties;this.select(apf.xmldb.findHtmlNode(this.$properties.selectSingleNode(".//prop"),this));
}};this.$load=function(xmlNode){var p=this.$getProperties();if(!p){return false;
}var output=[];var docId=this.documentId=apf.xmldb.getXmlDocId(p);apf.xmldb.addNodeListener(xmlNode,this);
var _self=this,doc=p.ownerDocument;(function walk(nodes,parent,depth){for(var u,s,cell,sLid,pnode,html,node,i=0,l=nodes.length;
i<l;i++){node=nodes[i];_self.$getNewContext("row");html=_self.$getLayoutNode("row");
if(node[apf.TAGNAME]=="group"){_self.$getNewContext("cell");apf.setStyleClass(html,"heading");
cell=html.appendChild(_self.$getLayoutNode("cell"));apf.setNodeValue(_self.$getLayoutNode("cell","caption",cell),(node.getAttribute("caption")||"").trim()||"");
pnode=html.appendChild(doc.createElement("blockquote"));walk(node.selectNodes("prop"),pnode,depth);
html.insertBefore(u=doc.createElement("u"),html.firstChild).appendChild(doc.createTextNode(" "));
u.setAttribute("class","min");}else{apf.xmldb.nodeConnect(docId,node,html,_self);
_self.$getNewContext("cell");h=_self.$headings[0];cell=html.appendChild(_self.$setStyleClass(_self.$getLayoutNode("cell"),h.$className));
apf.setNodeValue(_self.$getLayoutNode("cell","caption",cell),(node.getAttribute("caption")||"").trim()||"");
if(depth){cell.firstChild.setAttribute("style","padding-left:"+(depth*15)+"px");
}_self.$getNewContext("cell");h=_self.$headings[1];cell=html.appendChild(_self.$setStyleClass(_self.$getLayoutNode("cell"),h.$className));
apf.setNodeValue(_self.$getLayoutNode("cell","caption",cell),((apf.lm.compile(node.getAttribute("value"),{nostring:true}))(_self.xmlRoot)||"")||"");
if((s=node.selectNodes("prop")).length){pnode=html.appendChild(doc.createElement("blockquote"));
pnode.setAttribute("style","display:none;overflow:hidden;height:0;");walk(s,_self.$getLayoutNode("heading","container",pnode),depth+1);
html.insertBefore(u=doc.createElement("u"),html.firstChild).appendChild(doc.createTextNode(" "));
u.setAttribute("class","plus");}}if(!parent){output.push(html);}else{parent.appendChild(html);
}}})(p.selectNodes("group|prop"),null,0);apf.insertHtmlNodes(output,this.$body);
this.setProperty("root",this.xmlRoot);var prop=p.selectSingleNode(".//prop");if(prop){this.select(this.$findHtmlNode(prop.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));
}if(this.filter&&this.$allowLoad!=2){delete this.$searchProperties;this.$propHandlers.filter.call(this,this.filter);
}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(xmlNode!=this.xmlRoot){return;
}if(UndoObj&&this.$lastEditor[0]==UndoObj.amlNode){this.$lastEditor[1].firstChild.innerHTML=((apf.lm.compile(this.$lastEditor[2].getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";
}else{var p=this.$getProperties();if(!p){return;}var node,htmlNode,nodes=p.selectNodes(".//group/prop");
for(var i=0,l=nodes.length;i<l;i++){node=nodes[i];htmlNode=this.$findHtmlNode(node.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
htmlNode.childNodes[htmlNode.firstChild.tagName=="U"?2:1].firstChild.innerHTML=((apf.lm.compile(node.getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";
}}};this.$hideEditor=function(remove){if(this.$lastEditor){this.$lastEditor[0].setProperty("visible",false);
if(remove){var pNode=this.$lastEditor[0].$ext.parentNode;pNode.removeChild(this.$lastEditor[0].$ext);
pNode.removeAttribute("id");delete pNode.onresize;}var nodes=this.$lastEditor[1].childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(!nodes[i].host){nodes[i].style.display="";
}}delete this.$lastEditor;}};this.clearSelection=function(){this.$setStyleClass(this.$selected,"",["selected"]);
delete this.$selected;this.$hideEditor();};this.select=function(htmlNode){if(this.disabled){return;
}if(this.$selected==htmlNode){return;}if(this.$selected){this.$setStyleClass(this.$selected,"",["selected"]);
}this.$setStyleClass(htmlNode,"selected");this.$selected=htmlNode;this.$hideEditor();
var prop=apf.xmldb.getNode(htmlNode);var _self=this;this.setProperty("selected",prop);
var editParent=this.$selected.childNodes[this.$selected.firstChild.tagName=="U"?2:1];
var oEditor,editor=prop.getAttribute("editor");var ceditor=apf.lm.compile(editor,{xpathmode:2});
if(ceditor.type==2){if(!editor){if(prop.childNodes.length){return;}else{throw new Error("Missing editor attribute on property element: "+prop.xml);
}}if(!this.$editors[editor]){var constr=apf.namespaces[apf.ns.aml].elements[editor];
var isTextbox="textarea|textbox|secret".indexOf(editor)>-1;var info={htmlNode:editParent,width:"100%+2",height:19,style:"position:relative;",value:"[{"+this.id+".root}::"+(v=prop.getAttribute("value")).substr(1,v.length-2)+"]",focussable:false,realtime:!isTextbox};
if(isTextbox){info.focusselect=true;info.onkeydown=function(e){if(e.keyCode==13){this.change(this.getValue());
}};}else{if(editor=="checkbox"){info.values="true|false";}}if(constr.prototype.hasFeature(apf.__MULTISELECT__)){info.caption="[text()]";
info.eachvalue="[@value]";info.each="item";info.model="{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}";
}oEditor=this.$editors[editor]=new constr(info);var box=apf.getBox(apf.getStyle(oEditor.$ext,"margin"));
if(box[1]||box[3]){oEditor.setAttribute("width","100%+2-"+(box[1]+box[3]));}else{if(!box[3]){oEditor.$ext.style.marginLeft="-1px";
}}oEditor.parentNode=this;oEditor.$focusParent=this;oEditor.setAttribute("focussable","true");
oEditor.$parentId=editParent.getAttribute("id");oEditor.$parentRsz=editParent.onresize;
oEditor.$executeAction=function(atAction,args,action,xmlNode,noevent,contextNode,multiple){if(atAction=="setAttribute"&&!args[2]){atAction="removeAttribute";
}this.parentNode.$executeAction.call(this.parentNode,atAction,args,action,xmlNode,noevent,contextNode,multiple);
};}else{oEditor=this.$editors[editor];if(oEditor.hasFeature(apf.__MULTISELECT__)){oEditor.setAttribute("model","{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}");
}oEditor.setAttribute("value","[{"+this.id+".root}::"+(v=prop.getAttribute("value")).substr(1,v.length-2)+"]");
oEditor.setProperty("visible",true);if(oEditor.$ext.parentNode&&oEditor.$ext.parentNode.nodeType==1&&!apf.hasSingleResizeEvent){if(!oEditor.$parentRsz){oEditor.$parentRsz=oEditor.$ext.parentNode.onresize;
}oEditor.$ext.parentNode.removeAttribute("id");delete oEditor.$ext.parentNode.onresize;
}editParent.appendChild(oEditor.$ext);editParent.setAttribute("id",editParent.$parentId);
if(oEditor.$parentRsz&&!apf.hasSingleResizeEvent){editParent.onresize=oEditor.$parentRsz;
editParent.onresize();}}}else{var obj=ceditor.call(this,this.xmlRoot);if(obj.localName=="template"){}else{}}var nodes=editParent.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(!nodes[i].host){nodes[i].style.display="none";
}}this.$lastEditor=[oEditor,editParent,prop];};this.addEventListener("$clear",function(e){this.$hideEditor(true);
});this.$draw=function(){this.$ext=this.$getExternal();this.$body=this.$getLayoutNode("main","body",this.$ext);
this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);
this.$container=this.$body;if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);
}if(this.$body.firstChild){this.$body.removeChild(this.$body.firstChild);}var widthdiff=this.$widthdiff=this.$getOption("main","widthdiff")||0;
this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);
var _self=this;if(this.$useiframe&&!this.oIframe){var sClass=this.$body.className;
this.oIframe=this.$body.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));
this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;
this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');
this.$body=this.oDoc.body;this.$body.className=sClass;this.oDoc.documentElement.className=this.$ext.className;
apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);
if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,"overflowY")=="auto"){this.oIframe.onresize=function(){_self.$head.style.marginRight=_self.oDoc.documentElement.scrollHeight>_self.oDoc.documentElement.offsetHeight?"16px":"0";
};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);
}this.oDoc.documentElement.onmousedown=function(e){if(!e){e=_self.oWin.event;}if((e.srcElement||e.target).tagName=="HTML"){apf.popup.forceHide();
}};this.oDoc.documentElement.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.oDoc.documentElement.scrollLeft;
}};}else{if(apf.getStyle(this.$body,"overflowY")=="auto"){this.$resize=function(){_self.$head.style.marginRight=_self.$body.scrollHeight>_self.$body.offsetHeight?"16px":"0";
};this.addEventListener("resize",this.$resize);this.addEventListener("afterload",this.$resize);
this.addEventListener("xmlupdate",this.$resize);}this.$body.onmousedown=function(e){if(!e){e=event;
}if((e.srcElement||e.target)==this){apf.popup.forceHide();}};this.$body.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.$body.scrollLeft;
}};}var _self=this;this.$body.onmousedown=function(e){if(!e){e=event;}var target=e.srcElement||e.target;
if(target==this){return;}if(target.tagName=="U"){_self.$slideToggle(target);return;
}while(target.host||(target.getAttribute(apf.xmldb.htmlIdTag)||"").indexOf("|")==-1){target=target.parentNode;
if(target==this){return;}}_self.select(target);};};this.$loadAml=function(x){this.$headings=[new apf.BindingColumnRule().$draw(this,"Property",this.$columns[0],"first"),new apf.BindingColumnRule().$draw(this,"Value",this.$columns[1])];
};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);for(var prop in this.$editors){this.$editors[prop].destroy();
}this.$ext.onclick=null;};}).call(apf.propedit.prototype=new apf.DataBinding());
apf.aml.setElement("propedit",apf.propedit);apf.aml.setElement("column",apf.BindingColumnRule);
apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);
apf.radiobutton=function(struct,tagName){this.$init(tagName||"radiobutton",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.ChildValue);this.$childProperty="label";this.$focussable=apf.KEYBOARD;
this.$booleanProperties.checked=true;this.$supportedProperties.push("value","background","group","label","checked","tooltip","icon");
this.$propHandlers.group=function(value){if(!this.$amlLoaded){return;}if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);
}if(!value){this.$group=null;return;}var group=typeof value=="string"?apf.nameserver.get("group",value):value;
if(!group){group=apf.nameserver.register("group",value,new apf.$group());group.setAttribute("id",value);
group.dispatchEvent("DOMNodeInsertedIntoDocument");group.parentNode=this;}this.$group=group;
if(this.oInput){this.oInput.setAttribute("name",value);}this.$group.$addRadio(this);
};this.$propHandlers.tooltip=function(value){this.$ext.setAttribute("title",value);
};this.$propHandlers.icon=function(value){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");
}if(value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);
}apf.skins.setIcon(this.oIcon,value,this.iconPath);};this.$propHandlers.label=function(value){if(value){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);
}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oLabel){this.oLabel.innerHTML=value;
}};this.$propHandlers.checked=function(value){if(!this.$group){return;}if(value){this.$group.setProperty("value",this.value);
}};this.$propHandlers.selected=function(value){this.setProperty("checked",value);
};this.addEventListener("prop.model",function(e){if(this.$group){this.$group.setProperty("model",e.value);
}});this.$propHandlers.background=function(value){var oNode=this.$getLayoutNode("main","background",this.$ext);
if(value){var b=value.split("|");this.$background=b.concat(["vertical",2,16].slice(b.length-1));
oNode.style.backgroundImage="url("+this.mediaPath+b[0]+")";oNode.style.backgroundRepeat="no-repeat";
}else{oNode.style.backgroundImage="";oNode.style.backgroundRepeat="";this.$background=null;
}};this.setValue=function(value){this.setProperty("value",value,false,true);};this.getValue=function(){return this.value;
};this.select=this.check=function(){this.setProperty("checked",true,false,true);
};this.uncheck=function(){this.setProperty("checked",false,false,true);};this.getGroup=function(){return this.$group;
};this.$check=function(visually){this.$setStyleClass(this.$ext,this.$baseCSSname+"Checked");
this.checked=true;if(this.oInput){this.oInput.checked=true;}this.doBgSwitch(2);
};this.$uncheck=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);
this.checked=false;if(this.oInput){this.oInput.checked=false;}this.doBgSwitch(1);
};this.$enable=function(){if(this.oInput){this.oInput.disabled=false;}var _self=this;
this.$ext.onclick=function(e){if(!e){e=event;}if((e.srcElement||e.target)==this){return;
}_self.dispatchEvent("click",{htmlEvent:e});_self.$group.change(_self.value);};
this.$ext.onmousedown=function(e){if(!e){e=event;}if((e.srcElement||e.target)==this){return;
}apf.setStyleClass(this,_self.$baseCSSname+"Down");};this.$ext.onmouseover=function(e){if(!e){e=event;
}if((e.srcElement||e.target)==this){return;}apf.setStyleClass(this,_self.$baseCSSname+"Over");
};this.$ext.onmouseout=this.$ext.onmouseup=function(){apf.setStyleClass(this,"",[_self.$baseCSSname+"Down",_self.$baseCSSname+"Over"]);
};};this.$disable=function(){if(this.oInput){this.oInput.disabled=true;}this.$ext.onclick=this.$ext.onmousedown=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onmouseup=null;
};this.doBgSwitch=function(nr){if(this.bgswitch&&(this.bgoptions[1]>=nr||nr==4)){if(nr==4){nr=this.bgoptions[1]+1;
}var strBG=this.bgoptions[0]=="vertical"?"0 -"+(parseInt(this.bgoptions[2])*(nr-1))+"px":"-"+(parseInt(this.bgoptions[2])*(nr-1))+"px 0";
this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=strBG;
}};this.$focus=function(){if(!this.$ext){return;}if(this.oInput&&this.oInput.disabled){return false;
}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(!this.$ext){return;
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.addEventListener("keydown",function(e){var key=e.keyCode;
if(key==13||key==32){this.$group.change(this.value);return false;}else{if(key==38){var node=this;
while(node&&node.previousSibling){node=node.previousSibling;if(node.localName=="radiobutton"&&!node.disabled&&node.$group==this.$group){node.check();
node.focus();return;}}}else{if(key==40){var node=this;while(node&&node.nextSibling){node=node.nextSibling;
if(node.localName=="radiobutton"&&!node.disabled&&node.$group==this.$group){node.check();
node.focus();return;}}}}}},true);this.$draw=function(){this.$ext=this.$getExternal();
this.oInput=this.$getLayoutNode("main","input",this.$ext);this.oLabel=this.$getLayoutNode("main","label",this.$ext);
this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.oLabel&&this.oLabel.nodeType!=1){this.oLabel=this.oLabel.parentNode;
}this.$enable();};this.$childProperty="label";this.$loadAml=function(x){if(this.group){this.$propHandlers.group.call(this,this.group);
}else{if(this.parentNode.localName=="group"){this.$propHandlers.group.call(this,this.parentNode);
}}if(!this.$group){this.$propHandlers.group.call(this,"group"+this.parentNode.$uniqueId);
}};this.$destroy=function(){if(this.$group){this.$group.$removeRadio(this);}};}).call(apf.radiobutton.prototype=new apf.Presentation());
apf.aml.setElement("radiobutton",apf.radiobutton);apf.$group=function(struct,tagName){this.$init(tagName||"group",apf.NODE_VISIBLE,struct);
this.implement(apf.StandardBinding,apf.DataAction);var radiobuttons=[];this.$supportedProperties.push("value","selectedItem");
this.$propHandlers.value=function(value){for(var i=0;i<radiobuttons.length;i++){if(radiobuttons[i].value==value){return this.setProperty("selectedItem",radiobuttons[i]);
}}return this.setProperty("selectedItem",null);};var lastSelected;this.$propHandlers.selectedItem=function(rb){if(lastSelected){lastSelected.$uncheck();
}if(!rb){return;}rb.$check();lastSelected=rb;for(var i=0;i<radiobuttons.length;
i++){radiobuttons[i].setProperty("selectedItem",rb);}};this.$addRadio=function(rb){var id=radiobuttons.push(rb)-1;
if(!rb.value){rb.setProperty("value",id);}if(this.value&&rb.value==this.value){this.setProperty("selectedItem",rb);
}else{if(rb.checked){this.setProperty("value",rb.value);}}};this.$removeRadio=function(rb){radiobuttons.remove(rb);
if(rb.value===rb.id){rb.setProperty("value","");}if(rb.selectedItem==rb){this.setProperty("value",null);
}};this.setValue=function(value){this.setProperty("value",value);};this.getValue=function(){return this.value;
};this.$draw=function(){this.$ext=this.$int=this.$pHtmlNode;};};apf.$group.prototype=new apf.GuiElement();
apf.aml.setElement("group",apf.$group);apf.remote=function(struct,tagName){this.$init(tagName||"remote",apf.NODE_HIDDEN,struct);
this.$sessions={};this.rdbQueue={};this.queueTimer=null;this.pendingTerminations={};
};apf.remote.SESSION_INITED=1;apf.remote.SESSION_STARTED=2;apf.remote.SESSION_TERMINATED=4;
(function(){this.discardBefore=null;this.logprefix="";if(!apf.isO3){this.log=function(msg){apf.console.log(msg);
};}this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.$supportedProperties.push("transport");
this.$propHandlers.transport=function(value){this.transport=typeof value=="object"?value:self[this["transport"]];
if(!this.transport){throw new Error(apf.formatErrorString(0,this,"RDB: Missing transport","A transport element with ID '"+value+"' could not be found."));
}var _self=this;this.transport.addEventListener("connect",function(){var uri,oSession;
for(uri in _self.$sessions){oSession=_self.$sessions[uri];if(oSession.state==apf.remote.SESSION_STARTED){continue;
}this.join(uri,function(uri,iTime){});}});this.transport.addEventListener("disconnect",function(){var uri,oSession;
for(uri in _self.$sessions){oSession=_self.$sessions[uri];oSession.state=apf.remote.SESSION_TERMINATED;
}});this.transport.addEventListener("update",function(e){_self.$update(e);});this.transport.addEventListener("join",function(e){if(!e.uri){return;
}var uri=e.uri,oSession=_self.$sessions[e.uri];if(!e.document){this.log&&this.log(_self.logprefix+"Did not receive a document with the join message.                                   Assuming a join request from a peer. If this                                   message originated from the server something                                   has gone wrong.");
return _self.dispatchEvent("joinrequest",e);}if(!oSession){oSession=_self.createSession(uri,null,null,e.document,e.basetime);
}else{oSession.model.load(e.document);_self.$startSession(uri,e.basetime);}});this.transport.addEventListener("leave",function(e){_self.endSession(e.uri);
});};this.$update=function(e){var sData=e.message.args?[e.message]:e.message,oData=typeof sData=="string"?apf.unserialize(sData):sData,oSession=this.$sessions[e.uri],i=0,l=oData.length;
for(;i<l;i++){this.$receiveChange(oData[i],oSession,e.annotator);}};this.clear=function(){this.$sessions={};
};this.createSession=function(uri,model,xpath,doc,iTime){this.log&&this.log(this.logprefix+"Creating session for "+uri);
if(!model){model=this.dispatchEvent("modelfind",{uri:uri});}if(model){delete model.src;
}else{model=new apf.model();}model.setProperty("remote",this);model.rdb=this;model.src=uri;
var oSession=this.$addSession(uri,model,xpath);if(doc){model.load(doc);this.$startSession(uri,iTime);
}else{if(this.transport&&this.transport.isConnected()){var _self=this;this.transport.join(uri,function(uri,iTime){_self.$startSession(uri,iTime);
});}}return oSession;};this.endSession=function(uri){if(!this.$sessions||!this.$sessions[uri]){return;
}var oSession=this.$sessions[uri];if(this.transport&&this.transport.isConnected()&&oSession.state!=apf.remote.SESSION_TERMINATED){this.transport.leave(uri);
}oSession.state=apf.remote.SESSION_TERMINATED;delete this.$sessions[uri];};this.$addSession=function(uri,model,xpath){delete this.$sessions[uri];
return this.$sessions[uri]={uri:uri,model:model,xpath:xpath,state:apf.remote.SESSION_INITED};
};this.$startSession=function(uri,basetime){var oSession=this.$sessions[uri];if(!oSession){this.log&&this.log(this.logprefix+"Could not find RDB session to start "+uri);
return false;}oSession.state=apf.remote.SESSION_STARTED;if(basetime&&!oSession.basetime){oSession.basetime=basetime;
}this.log&&this.log(this.logprefix+"session started: "+uri+", "+oSession.basetime);
};this.$queueMessage=function(args,model,qHost){if(!qHost.rdbQueue){qHost.rdbQueue={};
}var uri=model.src,oSession=this.$sessions[uri];if(!oSession){this.log&&this.log(this.logprefix+apf.formatErrorString(0,this,"RDB: sending message","No RDB session found. Please make sure a session is created for this model: "+model.serialize()));
return false;}if(!qHost.rdbQueue[uri]){qHost.rdbQueue[uri]=[];qHost.rdbModel=model;
}for(var node,i=0,l=args.length;i<l;++i){if((node=args[i])&&node.nodeType){if(args[0]=="setAttribute"&&args[2]=="level"&&args[1]==args[1].ownerDocument.documentElement){return false;
}args[i]=this.xmlToXpath(args[i],model.data);}else{if(node&&node.dataType==apf.ARRAY){for(var j=0;
j<node.length;j++){if(node[j]&&node[j].nodeType){node[j]=this.xmlToXpath(node[j],model.data);
}}}}}qHost.rdbQueue[uri].push({uri:uri,args:args,currdelta:(new Date()).getISOTime()-oSession.basetime});
};this.$processQueue=function(qHost){if(qHost===this){clearTimeout(this.queueTimer);
}if(apf.xmldb.disableRDB){return;}var list;for(var uri in qHost.rdbQueue){if(!(list=qHost.rdbQueue[uri]).length){continue;
}this.log&&this.log(this.logprefix+"Sending "+list.length+" RDB messages to "+uri);
if(this.transport){this.transport.sendUpdate(uri,apf.serialize(list));}this.dispatchEvent("rdbsend",{uri:uri,message:list});
}qHost.rdbQueue={};};this.$receiveChange=function(oMessage,oSession,sAnnotator){this.log&&this.log(this.logprefix+"Receiving change. disableRDB="+apf.xmldb.disableRDB);
if(apf.offline&&apf.offline.inProcess==2){queue.push(oMessage);this.log&&this.log(this.logprefix+"Not executing incoming change because we're offline. Action is queued.");
return;}if(!oSession&&oMessage.uri){oSession=this.$sessions[oMessage.uri];}if(!oSession){apf.console.error("Could not find session while receiving data for a session with id '"+oMessage.uri+"'");
return;}var model=oSession.model;if(!model){apf.console.error("Remote Databinding Received: Could not find model while receiving data for it with identifier '"+oMessage.model+"'");
return;}if(!model.$at){model.$at=apf.window.$at;}var oError,xmlNode,disableRDB=apf.xmldb.disableRDB;
apf.xmldb.disableRDB=2;var time=oSession.basetime+parseInt(oMessage.currdelta);
this.log&&this.log(this.logprefix+"timestamp comparison (base: "+oSession.basetime+") : "+new Date(new Date().getUTCTime()).toGMTString()+", "+(new Date(time).toGMTString()));
var aUndos=[],i=0,l=aUndos.length;if(l){for(;i<l;++i){aUndos[i].$dontapply=true;
}model.$at.undo(l);}var q=oMessage.args.slice(),xpath=q[1];xmlNode=q[1]=this.xpathToXml(xpath,model.data);
if(xmlNode){var action=q.shift();if(action=="addChildNode"){q[3]=this.xpathToXml(q[3],model.data);
}else{if(action=="appendChild"){q[1]=typeof q[1]=="string"?apf.getXml(q[1]):q[1];
q[2]=q[2]?this.xpathToXml(q[2],model.data):null;}else{if(action=="moveNode"){q[1]=this.xpathToXml(q[1],model.data);
q[2]=q[2]?this.xpathToXml(q[2],model.data):null;}else{if(action=="replaceNode"){q[0]=typeof q[1]=="string"?apf.getXml(q[1]):q[1];
q[1]=xmlNode;}else{if(action=="removeNodeList"){var arr=q[0];for(var i=0;i<arr.length;
i++){arr[i]=this.xpathToXml(arr[i],model.data);}}else{if(action=="setValueByXpath"){}}}}}}model.$at.execute({action:action,args:q,annotator:sAnnotator,message:oMessage,rdb:true});
this.dispatchEvent("change",{uri:oMessage.uri,model:model,xmlNode:xmlNode,message:oMessage});
}else{oError=new Error(apf.formatErrorString(0,this,"Remote Databinding Received","Could not get XML node from                  model with Xpath '"+xpath+"' for URI '"+oMessage.uri+"' "+apf.serialize(oMessage)));
}if(l){model.$at.redo(l);for(i=0;i<l;++i){delete aUndos[i].$dontapply;}}apf.xmldb.disableRDB=disableRDB;
if(oError){apf.console.error(this.logprefix+oError.message);}};this.xmlToXpath=apf.xmlToXpath;
this.xpathToXml=apf.xpathToXml;this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.log&&this.log(this.logprefix+(this.id?"Creating remote ["+this.id+"]":"Creating implicitly assigned remote"));
if(apf.offline&&apf.offline.enabled){var queue=[];apf.offline.addEventListener("afteronline",function(){for(var i=0,l=queue.length;
i<l;i++){_self.$receiveChange(queue[i]);}queue.length=0;});}});this.addEventListener("DOMNodeRemovedFromDocument",function(e){for(var i=0,l=this.$sessions.length;
i<l;++i){this.endSession(this.$sessions[i].uri);}});}).call(apf.remote.prototype=new apf.AmlElement());
apf.aml.setElement("remote",apf.remote);apf.rpc=function(struct,tagName){this.$init(tagName||"rpc",apf.NODE_HIDDEN,struct);
if(!this.supportMulticall){this.multicall=false;}this.stack={};this.urls={};this.$methods={};
};(function(){this.useHTTP=true;this.namedArguments=false;this["route-server"]=apf.host+"/cgi-bin/rpcproxy.cgi";
this.autoroute=false;this.$auth=false;this.$booleanProperties.multicall=true;this.$supportedProperties.push("protocol","type","multicall","http-method");
this.$propHandlers["route-server"]=function(value){this.autoroute=value?true:false;
};this.$propHandlers.protocol=function(value){if(!value){return;}if(!apf[value]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+value+"'",this));
return;}var _self=this;$setTimeout(function(){_self.implement(apf[value]);});};
this.$propHandlers.type=function(value){this.$useXml=(typeof value=="string"&&value.toUpperCase()=="XML");
};this.setCallback=function(name,func){if(!this.$methods[name]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));
}this.$methods[name].callback=func;};this.setUrl=function(name,url){if(!this.$methods[name]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));
}this.$methods[name].setProperty("url",url);};this.$convertArgs=function(name,args){if(!this.namedArguments){return Array.prototype.slice.call(args);
}var nodes=this.$methods[name].names;if(!nodes||!nodes.length){return{};}var value,j,i,l,result={};
for(j=0,i=0,l=nodes.length;i<l;i++){name=nodes[i].name;value=nodes[i].value;if(value){value=apf.parseExpression(value);
}else{value=args[j++];if(apf.isNot(value)&&nodes[i]["default"]){value=apf.parseExpression(nodes[i]["default"]);
}}value=apf.isTrue(nodes[i].encoded)?encodeURIComponent(value):value;result[name]=value;
}return result;};function getCallback(node){var p,f;if(typeof node.callback=="string"){p=node.callback.split("."),f=self[p.shift()];
while(f&&p.length){f=f[p.shift()];}}else{f=node.callback;}return f||apf.K;}this.call=function(name,args,options){var callback,node=this.$methods[name];
if(typeof args[args.length-1]=="function"){args=Array.prototype.slice.call(args);
callback=args.pop();}else{callback=getCallback(node);}args=this.$convertArgs(name,args);
if(this.multicall){if(!this.stack[this.url]){this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];
}this.getSingleCall(name,args,this.stack[this.url]);return true;}var _self=this,data=options&&options.message?options.message:this.createMessage(node["method-name"]||name,args);
function pCallback(data,state,extra){extra.data=data;if(state!=apf.SUCCESS){callback.call(_self,null,state,extra);
}else{if(_self.isValid&&!_self.isValid(extra)){callback.call(_self,null,apf.ERROR,extra);
}else{callback.call(_self,_self.unserialize(extra.data),state,extra);}}}var auth,url=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url),o=apf.extend({callback:pCallback,async:node.async,userdata:node.userdata,nocache:(this.nocache===false)?false:true,data:data,useXML:this.$useXml||node.type=="xml",caching:node.caching,ignoreOffline:node["ignore-offline"]},options);
if(node.auth&&this.$auth){if(auth=this.$auth.$credentials){o.username=auth.username;
o.password=auth.password;}else{return this.$auth.authRequired(function(){auth=_self.$auth.$credentials;
o.username=auth.username;o.password=auth.password;_self.$get(url,o);});}}return this.$get(url,o);
};this.purge=function(callback,userdata,async,extradata){if(!this.stack[this.url]||!this.stack[this.url].length){throw new Error(apf.formatErrorString(0,null,"Executing a multicall","No RPC calls where executed before calling purge()."));
}var data=this.createMessage("multicall",[this.stack[this.url]]),url=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url);
if(extradata){for(var vars=[],i=0;i<extradata.length;i++){vars.push(encodeURIComponent(extradata[i][0])+"="+encodeURIComponent(extradata[i][1]||""));
}url=url+(url.match(/\?/)?"&":"?")+vars.join("&");}var info=this.$get(url,{callback:callback,async:async,userdata:userdata,nocache:true,data:data,useXML:this.$useXml});
this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];};this.revert=function(modConst){this.stack[modConst.url]=this.getMulticallObject?this.getMulticallObject():[];
};this.getStackLength=function(){return this.stack[this.url]?this.stack[this.url].length:0;
};this.$addMethod=function(amlNode){if(amlNode.localName!="method"){throw new Error(apf.formatErrorString(0,this,"Parsing RPC Teleport node","Found element which is not a method",this));
return false;}var name=amlNode.name,cb=amlNode.receive||this.receive,i=0,l=amlNode.childNodes.length,node;
this[name]=function(){return this.call(name,arguments);};if(cb){amlNode.callback=cb;
}this.$methods[name]=amlNode;if(!amlNode.names){amlNode.names=[];}for(;i<l;i++){node=amlNode.childNodes[i];
if(node.localName=="param"||node.localName=="variable"){amlNode.names.push(node);
}}return true;};this.$removeMethod=function(amlNode){var name=amlNode.name;delete this[name];
delete this.$methods[name];};this.$setAuth=function(amlNode){this.$auth=amlNode;
};this.exec=function(method,args,callback,options){if(!options){options={};}if(options.multicall){this.forceMulticall=true;
}if(!this[method]){throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Could not find RPC function by name '"+method+"' in data instruction '"+options.instruction+"'"));
}var props=this.$methods[method];if(options.userdata){props.userdata=options.userdata;
}if(!this.multicall){props.callback=callback;}var retvalue=this.call(method,args,options);
if(this.multicall){return this.purge(callback,"&@^%!@");}else{if(options.multicall){this.forceMulticall=false;
return this;}}if(typeof apf.offline!="undefined"&&!apf.offline.onLine){return;}if(!this.multicall&&!props.async&&callback){callback(retvalue,apf.SUCCESS,{tpModule:this});
}};}).call(apf.rpc.prototype=new apf.Teleport());apf.config.$inheritProperties.baseurl=1;
apf.aml.setElement("rpc",apf.rpc);apf.script=function(){this.$init("script",apf.NODE_HIDDEN);
};(function(){this.$propHandlers.src=function(value){if(!this.type){this.type=this.getAttribute("type");
}if(!this.type||this.type=="text/javascript"){if(apf.isOpera){$setTimeout(function(){apf.window.loadCodeFile(apf.hostPath+value);
},1000);}else{apf.window.loadCodeFile(apf.getAbsolutePath(apf.hostPath,value));
}}else{var _self=this;apf.ajax(value,{callback:function(data,state,extra){if(state!=apf.SUCCESS){return apf.console.warn("Could not load script "+value);
}_self.$execute(data);}});}};this.$execute=function(code,e){if(!this.type||this.type=="text/javascript"){apf.jsexec(code);
}else{if(this.type.indexOf("livemarkup")>-1||this.type.indexOf("lm")>-1){var func=apf.lm.compile(code,{event:true,parsecode:true,funcglobal:true,nostring:true});
func(e||{});}}};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget.nodeType==3||e.currentTarget.nodeType==4){this.$execute(e.currentTarget.nodeValue,apf.isIE&&window.event);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var nodes=this.childNodes,s=[];
for(var i=0,l=nodes.length;i<l;i++){s[s.length]=nodes[i].nodeValue;}var code=s.join("\n");
this.$execute(code);});}).call(apf.script.prototype=new apf.AmlElement());apf.aml.setElement("script",apf.script);
apf.scrollbar=function(struct,tagName){this.$init(tagName||"scrollbar",apf.NODE_VISIBLE,struct);
};(function(){this.realtime=true;this.visible=false;this.$visible=true;this.overflow="scroll";
this.$scrollSizeValue=0;this.$stepValue=0.03;this.$bigStepValue=0.1;this.$curValue=0;
this.$timer=null;this.$scrollSizeWait;this.$slideMaxSize;this.addEventListener("focus",function(){if(this.$host.focus&&this.$host.$isWindowContainer!==true){this.$host.focus();
}});this.$propHandlers.overflow=function(value){if(value=="auto"){this.$ext.style.display="none";
this.$resize();}else{if(value=="scroll"){this.setProperty("visible",true);}}};this.$propHandlers["for"]=function(value){if(value){var amlNode=typeof value=="string"?self[value]:value;
if(!amlNode||!amlNode.$amlLoaded){var _self=this;apf.queue.add("scrollbar"+this.$uniqueId,function(){if(!amlNode){amlNode=typeof value=="string"?self[value]:value;
if(!amlNode){throw new Error(apf.formatErrorString(0,_self,"Attaching scrollbar to element","Could not find element to attach scrollbar to: "+value));
}}_self.$attach(amlNode);});}else{this.$attach(amlNode);}}};this.addEventListener("prop.visible",function(e){if(!this.$updating){this.$visible=e.value;
}});this.$detach=function(){};this.attach=function(oHtml,o,scroll_func){this.$attach(o);
this.addEventListener("scroll",scroll_func);};this.$getHtmlHost=function(){var h=this.$host&&(this.$host.$int||this.$host.$container);
return(h&&(h.tagName=="BODY"||h.tagName=="HTML")?(apf.isSafari||apf.isChrome?document.body:h.parentNode):h);
};this.$getViewPort=function(oHtml){return oHtml.tagName=="HTML"||oHtml.tagName=="BODY"?apf[this.$windowSize]():oHtml[this.$offsetSize];
};this.$getScrollHeight=function(oHtml){return(apf.isIE&&oHtml.lastChild?oHtml.lastChild[this.$offsetPos]+oHtml.lastChild[this.$offsetSize]+apf.getBox(apf.getStyle(oHtml,"padding"))[2]+(parseInt(apf.getStyle(oHtml,"marginBottom"))||0):oHtml[this.$scrollSize]);
};this.$attach=function(amlNode){if(!amlNode){return apf.console.warn("Scrollbar could not connect to amlNode");
}if(amlNode.host){amlNode=amlNode.host;}if(!amlNode.nodeFunc&&amlNode.style){this.$host={empty:true,$int:amlNode};
}else{this.$host=amlNode;}this.$recalc();var scrollFunc=function(e){if(e.returnValue===false){return;
}scrolling=apf.isIE;var oHtml=_self.$getHtmlHost();var div=(_self.$getScrollHeight(oHtml)-_self.$getViewPort(oHtml));
if(div){if(oHtml[_self.$scrollPos]==0&&e.delta>0){if(_self.$lastScrollState===0){return;
}setTimeout(function(){_self.$lastScrollState=0;},300);}else{if(oHtml[_self.$scrollPos]==_self.$getScrollHeight(oHtml)-oHtml[_self.$offsetSize]&&e.delta<0){if(_self.$lastScrollState===1){return;
}setTimeout(function(){_self.$lastScrollState=1;},300);}}delete _self.$lastScrollState;
_self.$curValue=(oHtml[_self.$scrollPos]+-1*e.delta*Math.min(45,apf[_self.$getInner](oHtml)/10))/div;
_self.setScroll();e.preventDefault();}};var _self=this,scrolling;if(!this.$host.empty){amlNode.addEventListener("resize",function(){_self.$update();
});if(amlNode.hasFeature(apf.__DATABINDING__)){amlNode.addEventListener("afterload",function(){_self.$update();
});amlNode.addEventListener("xmlupdate",function(){_self.$update();});}amlNode.addEventListener("prop.value",function(){_self.$update();
});if(amlNode.$isTreeArch){amlNode.addEventListener("collapse",function(){_self.$update();
});amlNode.addEventListener("expand",function(){_self.$update();});}if(!this.horizontal){amlNode.addEventListener("mousescroll",scrollFunc);
}}else{if(!this.horizontal){apf.addEventListener("mousescroll",function(e){if(amlNode==e.target||(amlNode==document.documentElement&&e.target==document.body)){scrollFunc(e);
}});}}var oHtml=_self.$getHtmlHost();oHtml.onscroll=function(){if(_self.animating||!_self.$visible){return;
}if(!scrolling){var oHtml=_self.$getHtmlHost();var m=_self.$getScrollHeight(oHtml)-_self.$getViewPort(oHtml);
var p=oHtml[_self.$scrollPos]/m;if(Math.abs(_self.$curValue-p)>1/m){_self.$curValue=p;
_self.setScroll();}return false;}scrolling=false;};if("HTML|BODY".indexOf(oHtml.tagName)>-1){var lastHeight=oHtml.scrollHeight;
setInterval(function(){if(lastHeight!=oHtml.scrollHeight){lastHeight=oHtml.scrollHeight;
_self.$recalc();_self.$update();}},100);}this.$update();return this;};this.$resize=function(){var oHtml=this.$getHtmlHost();
if(!oHtml||!oHtml.offsetHeight){return;}this.$recalc();this.$update();this.setScroll(null,true);
};this.$recalc=function(){var oHtml=this.$getHtmlHost();if(!oHtml){return;}this.$viewheight=this.$getViewPort(oHtml);
this.$scrollSizeheight=this.$viewheight;this.$scrollSizeWait=0;this.$stepValue=(this.$viewheight/this.$scrollSizeheight)/20;
this.$bigStepValue=this.$stepValue*3;this.$slideMaxSize=this.$caret.parentNode[this.$offsetSize]-(this.$btnDown?this.$btnDown[this.$offsetSize]:0)-(this.$btnUp?this.$btnUp[this.$offsetSize]:0);
};this.$update=function(){var oHtml=this.$getHtmlHost();if(!oHtml||!oHtml.offsetHeight){return;
}this.$updating=true;var vp=this.$getViewPort(oHtml);var sz=this.$getScrollHeight(oHtml);
if(vp>=sz){if(this.overflow=="scroll"){this.$caret.style.display="none";this.disable();
}else{if(this.visible){this.hide();}}}else{if(this.overflow=="scroll"){this.$caret.style.display="block";
this.enable();}else{if(!this.visible){this.show();}}if(!this.$slideMaxSize){this.$recalc();
}if(!this.$slideMaxSize){return;}this.$caret.style[this.$size]=(Math.max(5,(vp/sz*this.$slideMaxSize))-apf[this.$getDiff](this.$caret))+"px";
this.$curValue=oHtml[this.$scrollPos]/(sz-vp);var bUpHeight=this.$btnUp?this.$btnUp[this.$offsetSize]:0;
this.$caret.style[this.$pos]=(bUpHeight+(apf[this.$getInner](this.$caret.parentNode)-(bUpHeight*2)-this.$caret[this.$offsetSize])*this.$curValue)+"px";
}this.$updating=false;};this.setScroll=function(timed,noEvent){if(this.$curValue>1){this.$curValue=1;
}if(this.$curValue<0){this.$curValue=0;}if(this.$curValue==NaN){apf.console.warn("Scrollbar is hidden while scrolling.");
return;}var bUpHeight=this.$btnUp?this.$btnUp[this.$offsetSize]:0;this.$caret.style[this.$pos]=(bUpHeight+(apf[this.$getInner](this.$caret.parentNode)-(bUpHeight*2)-this.$caret[this.$offsetSize])*this.$curValue)+"px";
if(this.animating||!this.$visible){return;}if(!noEvent){var oHtml,from,viewport,to;
if(this.$host){oHtml=this.$getHtmlHost();from=oHtml[this.$scrollPos];viewport=this.$getViewPort(oHtml);
to=(this.$getScrollHeight(oHtml)-viewport)*this.$curValue;}if(this.$host){oHtml[this.$scrollPos]=to;
}(this.$host&&this.$host.dispatchEvent?this.$host:this).dispatchEvent("scroll",{timed:timed,viewportSize:viewport,scrollPos:to,scrollSize:this.$getScrollHeight(oHtml),from:from,pos:this.pos});
}this.pos=this.$curValue;};this.scrollUp=function(v){if(v>this.$caret[this.$offsetPos]){return this.$ext.onmouseup();
}this.$curValue-=this.$bigStepValue;this.setScroll();if(this.$slideFast){this.$slideFast.style[this.$size]=Math.max(1,this.$caret[this.$offsetPos]-this.$btnUp[this.$offsetSize])+"px";
this.$slideFast.style[this.$pos]=this.$btnUp[this.$offsetSize]+"px";}};this.scrollDown=function(v){if(v<this.$caret[this.$offsetPos]+this.$caret[this.$offsetSize]){return this.$ext.onmouseup();
}this.$curValue+=this.$bigStepValue;this.setScroll();if(this.$slideFast){this.$slideFast.style[this.$pos]=(this.$caret[this.$offsetPos]+this.$caret[this.$offsetSize])+"px";
this.$slideFast.style[this.$size]=Math.max(1,apf[this.$getInner](this.$caret.parentNode)-this.$slideFast[this.$offsetPos]-this.$btnUp[this.$offsetSize])+"px";
}};this.getPosition=function(){return this.pos;};this.setPosition=function(pos,noEvent){this.$curValue=pos;
this.setScroll(null,noEvent);};this.updatePos=function(){if(this.animating||!this.$visible){return;
}var o=this.$host;var indHeight=Math.round(Math.max(10,(((o.limit-1)/o.length)*this.$slideMaxSize)));
this.$caret.style[this.$pos]=(this.$curValue*(this.$slideMaxSize-indHeight)+this.$btnUp[this.$offsetSize])+"px";
};this.$onscroll=function(timed,perc){this.$host[this.$scrollPos]=(this.$host[this.$scrollSize]-this.$host[this.$offsetSize]+4)*this.$curValue;
};this.$draw=function(){this.$getNewContext("main");this.$ext=this.$getExternal();
this.$caret=this.$getLayoutNode("main","indicator",this.$ext);this.$slideFast=this.$getLayoutNode("main","slidefast",this.$ext);
this.$btnUp=this.$getLayoutNode("main","btnup",this.$ext);this.$btnDown=this.$getLayoutNode("main","btndown",this.$ext);
this.horizontal=apf.isTrue(this.$getOption("main","horizontal"));this.$windowSize=this.horizontal?"getWindowWidth":"getWindowHeight";
this.$offsetSize=this.horizontal?"offsetWidth":"offsetHeight";this.$size=this.horizontal?"width":"height";
this.$offsetPos=this.horizontal?"offsetLeft":"offsetTop";this.$pos=this.horizontal?"left":"top";
this.$scrollSize=this.horizontal?"scrollWidth":"scrollHeight";this.$scrollPos=this.horizontal?"scrollLeft":"scrollTop";
this.$getDiff=this.horizontal?"getWidthDiff":"getHeightDiff";this.$getInner=this.horizontal?"getHtmlInnerWidth":"getHtmlInnerHeight";
this.$eventDir=this.horizontal?(apf.isIE||apf.isWebkit?"offsetX":"layerX"):(apf.isIE||apf.isWebkit?"offsetY":"layerY");
this.$clientDir=this.horizontal?"clientX":"clientY";this.$posIndex=this.horizontal?0:1;
this.$startPos=false;this.$caret.ondragstart=function(){return false;};var _self=this;
if(this.$btnUp){this.$btnUp.onmousedown=function(e){if(_self.disabled){return;}if(!e){e=event;
}this.className="btnup btnupdown";clearTimeout(_self.$timer);_self.$curValue-=_self.$stepValue;
_self.setScroll();apf.stopPropagation(e);_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.$curValue-=_self.$stepValue;
_self.setScroll();},20);},300);};this.$btnUp.onmouseout=this.$btnUp.onmouseup=function(){if(_self.disabled){return;
}this.className="btnup";clearInterval(_self.$timer);};}if(this.$btnDown){this.$btnDown.onmousedown=function(e){if(_self.disabled){return;
}if(!e){e=event;}this.className="btndown btndowndown";clearTimeout(_self.$timer);
_self.$curValue+=_self.$stepValue;_self.setScroll();apf.stopPropagation(e);_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.$curValue+=_self.$stepValue;
_self.setScroll();},20);},300);};this.$btnDown.onmouseout=this.$btnDown.onmouseup=function(){if(_self.disabled){return;
}this.className="btndown";clearInterval(_self.$timer);};}this.$caret.onmousedown=function(e){if(_self.disabled){return;
}if(!e){e=event;}var tgt=e.target||e.srcElement;var pos=tgt!=this?[tgt.offsetLeft,tgt.offsetTop]:[0,0];
var relDelta=e[_self.$eventDir]+pos[_self.$posIndex];_self.$startPos=relDelta+(_self.$btnUp?_self.$btnUp[_self.$offsetSize]:0);
if(this.setCapture){this.setCapture();}_self.$setStyleClass(_self.$ext,_self.$baseCSSname+"Down");
document.onmousemove=function(e){if(!e){e=event;}if(_self.$startPos===false){return false;
}var bUpHeight=_self.$btnUp?_self.$btnUp[_self.$offsetSize]:0;var next=bUpHeight+(e[_self.$clientDir]-_self.$startPos+(apf.isWebkit?document.body:document.documentElement)[_self.$scrollPos]-apf.getAbsolutePosition(_self.$caret.parentNode)[_self.horizontal?0:1]);
var min=bUpHeight;if(next<min){next=min;}var max=(apf[_self.$getInner](_self.$caret.parentNode)-bUpHeight-_self.$caret[_self.$offsetSize]);
if(next>max){next=max;}_self.$curValue=(next-min)/(max-min);_self.setScroll(true);
};document.onmouseup=function(){_self.$startPos=false;if(!_self.realtime){_self.setScroll();
}if(this.releaseCapture){this.releaseCapture();}_self.$setStyleClass(_self.$ext,"",[_self.$baseCSSname+"Down"]);
document.onmouseup=document.onmousemove=null;};apf.stopPropagation(e);return false;
};this.$ext.onmousedown=function(e){if(_self.disabled){return;}if(!e){e=event;}clearInterval(_self.$timer);
var offset;if(e[_self.$eventDir]>_self.$caret[_self.$offsetPos]+_self.$caret[_self.$offsetSize]){_self.$curValue+=_self.$bigStepValue;
_self.setScroll(true);if(_self.$slideFast){_self.$slideFast.style.display="block";
_self.$slideFast.style[_self.$pos]=(_self.$caret[_self.$offsetPos]+_self.$caret[_self.$offsetSize])+"px";
_self.$slideFast.style[_self.$size]=(apf[_self.$getInner](_self.$caret.parentNode)-_self.$slideFast[_self.$offsetPos]-_self.$btnUp[_self.$offsetSize])+"px";
}offset=e[_self.$eventDir];_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.scrollDown(offset);
},20);},300);}else{if(e[_self.$eventDir]<_self.$caret[_self.$offsetPos]){_self.$curValue-=_self.$bigStepValue;
_self.setScroll(true);if(_self.$slideFast){_self.$slideFast.style.display="block";
_self.$slideFast.style[_self.$pos]=_self.$btnUp[_self.$offsetSize]+"px";_self.$slideFast.style[_self.$size]=(_self.$caret[_self.$offsetPos]-_self.$btnUp[_self.$offsetSize])+"px";
}offset=e[_self.$eventDir];_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.scrollUp(offset);
},20);},300);}}};this.$ext.onmouseup=function(){if(_self.disabled){return;}clearInterval(_self.$timer);
if(!_self.realtime){_self.setScroll();}if(_self.$slideFast){_self.$slideFast.style.display="none";
}};};this.$loadAml=function(){if(this.overflow=="scroll"){this.disable();}else{this.$caret.style.display="block";
this.enable();}this.addEventListener("resize",this.$resize);this.$update();};}).call(apf.scrollbar.prototype=new apf.Presentation());
apf.aml.setElement("scrollbar",apf.scrollbar);apf.services=function(struct,tagName){this.$init(tagName||"services",apf.NODE_VISIBLE,struct);
this.addEventListener("DOMNodeInsertedIntoDocument",function(aml){var pNode=this.parentNode;
if(pNode.register){pNode.register(this);}});};apf.services.prototype=new apf.AmlElement();
apf.aml.setElement("services",apf.services);apf.skin=function(struct,tagName){this.$init(tagName||"skin",apf.NODE_HIDDEN,struct);
};apf.aml.setElement("skin",apf.skin);(function(){this.$parsePrio="002";this.$includesRemaining=0;
this.$propHandlers.src=function(value){if(value.trim().charAt(0)=="<"){apf.skins.Init(apf.getXml(value),this,this.$path);
return;}this.$path=apf.getAbsolutePath(apf.hostPath,value);getSkin.call(this,this.$path);
};this.$propHandlers.name=function(value){if(!this.attributes.getNamedItem("src")){this.$path=apf.getAbsolutePath(apf.hostPath,value)+"/index.xml";
getSkin.call(this,this.$path);}};function checkForAmlNamespace(xmlNode){if(!xmlNode.ownerDocument.documentElement){return false;
}var nodes=xmlNode.ownerDocument.documentElement.attributes;for(var found=false,i=0;
i<nodes.length;i++){if(nodes[i].nodeValue==apf.ns.aml){found=true;break;}}if(!found){throw new Error(apf.formatErrorString(0,null,"Checking for the aml namespace","The Ajax.org Platform xml namespace was not found in "+(xmlNode.getAttribute("filename")?"in '"+xmlNode.getAttribute("filename")+"'":"")));
}return found;}function getSkin(path){var domParser=this.ownerDocument.$domParser;
if(!apf.skins.$first){apf.skins.$first=this;}var defer=this.attributes.getNamedItem("defer");
if(!defer||!apf.isTrue(defer.nodeValue)){domParser.$shouldWait++;this.$parseContext=domParser.$parseContext||[this.ownerDocument.documentElement];
}loadSkinFile.call(this,path);}function finish(xmlNode){if(xmlNode){apf.skins.Init(xmlNode,this,this.$path);
}if(!this.defer){var domParser=this.ownerDocument.$domParser;domParser.$continueParsing.apply(domParser,this.$parseContext);
}}function loadSkinInclude(includeNode,xmlNode,path){var _self=this;apf.console.info("Loading include file: "+apf.getAbsolutePath(path,includeNode.getAttribute("src")));
apf.getData(apf.getAbsolutePath(path,includeNode.getAttribute("src")),{callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,_self,"Loading skin includes","Could not load skin include: "+extra.url));
}var newPart=apf.getXml(xmlString.substr(0,8)=="<a:skin "?xmlString:'<a:skin xmlns:a="http://ajax.org/2005/aml">'+xmlString+"</a:skin>");
apf.mergeXml(newPart,xmlNode,{beforeNode:includeNode});includeNode.parentNode.removeChild(includeNode);
var includeNodes=$xmlns(newPart,"include",apf.ns.aml);_self.$includesRemaining+=includeNodes.length;
if(includeNodes.length){var path=apf.getDirname(extra.url);for(var i=0;i<includeNodes.length;
i++){loadSkinInclude.call(_self,includeNodes[i],xmlNode,path);}}else{if(--_self.$includesRemaining==0){apf.console.info("Loading of "+xmlNode[apf.TAGNAME].toLowerCase()+" skin done from file: "+extra.url);
finish.call(_self,xmlNode);}}}});}function loadSkinFile(path){apf.console.info("Loading include file: "+path);
var _self=this;apf.getData(path,{type:"skin",callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){var oError=new Error(apf.formatErrorString(1007,_self,"Loading skin file","Could not load skin file '"+(path||_self.src)+"'\nReason: "+extra.message));
if(extra.tpModule.retryTimeout(extra,state,null,oError)===true){return true;}if(this.autoload){apf.console.warn("Could not autload skin.");
return finish.call(_self);}throw oError;}xmlString=xmlString.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"").replace(/xmlns\=\"[^"]*\"/g,"");
if(!xmlString){throw new Error(apf.formatErrorString(0,_self,"Loading skin","Empty skin file. Maybe the file does not exist?",_self));
}var xmlNode=apf.getXml(xmlString);checkForAmlNamespace(xmlNode);if(!xmlNode){throw new Error(apf.formatErrorString(0,_self,"Loading skin","Could not parse skin. Maybe the file does not exist?",_self));
}xmlNode.setAttribute("filename",extra.url);var includeNodes=$xmlns(xmlNode,"include",apf.ns.aml);
_self.$includesRemaining+=includeNodes.length;if(includeNodes.length){var path=apf.getDirname(extra.url);
for(var i=0;i<includeNodes.length;i++){loadSkinInclude.call(_self,includeNodes[i],xmlNode,path);
}return;}else{apf.console.info("Loading of "+xmlNode[apf.TAGNAME].toLowerCase()+" skin done from file: "+extra.url);
finish.call(_self,xmlNode);}},async:true,ignoreOffline:true});}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.src||this.name){return;
}apf.skins.Init(this.$aml||this);});}).call(apf.skin.prototype=new apf.AmlElement());
apf.range=function(struct,tagName){this.$init(tagName||"range",apf.NODE_VISIBLE,struct);
};apf.slider=function(struct,tagName){this.$init(tagName||"slider",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$dragging=false;
this.$onlySetXml=false;this.disabled=false;this.realtime=true;this.balloon=true;
this.value=0;this.mask="%";this.min=0;this.max=1000001;this.isOpened=false;this.$hasTSlider=false;
this.$supportedProperties.push("step","mask","min","max","slide","value","markers");
this.$booleanProperties.realtime=true;this.$booleanProperties.markers=true;this.$booleanProperties.balloon=true;
this.$propHandlers.step=function(value){this.step=parseInt(value)||0;if(!this.$hasLayoutNode("marker")){return;
}if(!this.slider){this.slideDiscreet=true;}};this.$propHandlers.markers=function(value){var i,markers=this.oMarkers.childNodes;
for(i=markers.length-1;i>=0;i--){if(markers[i].tagName=="U"&&markers[i].nodeType==1){apf.destroyHtmlNode(markers[i]);
}}if(!this.step&&this.$aml){this.step=parseInt(this.getAttribute("step"))||0;}if(value&&this.step){var pos,o,nodes=[],max=(this.max==1000001)?1:this.max,count=(max-this.min)/this.step,prop=this.$dir=="horizontal"?"left":"top",size=this.$dir=="horizontal"?this.oSlider.offsetWidth-this.oKnob.offsetWidth-apf.getWidthDiff(this.oSlider):this.oSlider.offsetHeight-this.oKnob.offsetHeight;
for(i=0;i<count+1;i++){this.$getNewContext("marker");o=this.$getLayoutNode("marker");
pos=Math.max(0,(i*(1/(count))));o.setAttribute("style",prop+":"+Math.round(pos*size)+"px");
nodes.push(o);}apf.insertHtmlNodes(nodes,this.oMarkers);}};this.$resize=function(){this.$propHandlers.value.call(this,this.value);
var count=(this.max-this.min)/this.step;if(!count){return;}var pos,i,prop=this.$dir=="horizontal"?"left":"top",size=this.$dir=="horizontal"?this.oSlider.offsetWidth-this.oKnob.offsetWidth-apf.getWidthDiff(this.oSlider):this.oSlider.offsetHeight-this.oKnob.offsetHeight,nodes=this.oMarkers.getElementsByTagName("U");
for(i=nodes.length-1;i>=0;i--){pos=Math.max(0,i*(1/count));nodes[i].style[prop]=Math.round(pos*size)+"px";
}};this.$propHandlers.mask=function(value){if(!value){this.mask="%";}if(!this.mask.match(/^(%|#.?#*)$/)){this.mask=value.split(/\||;/);
}};this.$propHandlers.progress=function(value){if(!this.oProgress){this.oProgress=apf.insertHtmlNode(this.$getLayoutNode("progress"),this.$getLayoutNode("main","progress",this.$ext));
}this.oProgress.style.width=((value||0)*100)+"%";};this.$propHandlers.min=function(value){this.min=parseInt(value)||0;
if(this.markers){this.$propHandlers.markers.call(this,this.markers);}if(this.value<this.min||this.value!=this.$value){this.value=-1;
this.setProperty("value",this.$value);}};this.$propHandlers.max=function(value){this.max=parseInt(value)||1;
if(this.markers){this.$propHandlers.markers.call(this,this.markers);}if(this.value>this.min||this.value!=this.$value){this.value=-1;
this.setProperty("value",this.$value);}};this.$propHandlers.slide=function(value){this.slideDiscreet=value=="discrete";
this.slideSnap=value=="snap";};this.$propHandlers.value=function(value,prop,force,animate){if(!this.$dir||this.$onlySetXml){return;
}if(this.$dragging&&!force&&!this.realtime){return;}this.$value=value;var value=Math.max(this.min,Math.min(this.max,value))||0;
var max,min,offset,_self=this,multiplier=this.max==this.min?0:(value-this.min)/(this.max-this.min);
if(this.$dir=="horizontal"){max=(this.oSlider.offsetWidth-apf.getWidthDiff(this.oSlider))-this.oKnob.offsetWidth;
min=parseInt(apf.getBox(apf.getStyle(this.oSlider,"padding"))[3]);offset=Math.round(((max-min)*multiplier)+min);
if(animate){apf.tween.single(this.oKnob,{type:"left",steps:5,interval:10,from:this.oKnob.offsetLeft,to:offset,anim:apf.tween.NORMAL,oneach:function(oNode){if(_self.oFill){_self.oFill.style.width=(oNode.offsetLeft+3)+"px";
}}});}else{this.oKnob.style.left=offset+"px";if(this.oFill){this.oFill.style.width=(offset+3)+"px";
}}}else{max=(this.oSlider.offsetHeight-apf.getHeightDiff(this.oSlider))-this.oKnob.offsetHeight;
min=parseInt(apf.getBox(apf.getStyle(this.oSlider,"padding"))[0]);offset=(((max-min)*(1-multiplier))+min);
if(animate){apf.tween.single(this.oKnob,{type:"top",steps:5,interval:10,from:this.oKnob.offsetTop,to:offset,anim:apf.tween.NORMAL,oneach:function(oNode){if(_self.oFill){_self.oFill.style.height=(oNode.offsetTop+3)+"px";
}}});}else{this.oKnob.style.top=offset+"px";if(this.oFill){this.oFill.style.height=(offset+3)+"px";
}}}if(this.oLabel){var mask=typeof this.mask=="string"?this.mask.split("."):this.mask;
switch(mask[0]){case"%":var inputValue=Math.round(multiplier*100)+"%";break;case"#":var tempValue=(this.step?(Math.round(value/this.step)*this.step):value);
var inputValue=new Number(tempValue).toFixed(mask[1]?mask[1].length:0);break;default:var inputValue=this.mask[Math.round(value-this.min)/(this.step||1)];
break;}this.setProperty("valuemask",inputValue);if(this.oLabel.nodeValue!==null){this.oLabel.nodeValue=inputValue;
}else{this.oLabel.value=inputValue;}}};this.$setLabelValue=function(value){var mask=this.mask.split(".");
switch(mask[0]){case"%":value=parseInt(value)*(this.max-this.min)/100;break;case"#":value=new Number(value).toFixed(mask[1]?mask[1].length:0);
break;}this.$propHandlers.value.call(this,value);};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.step?Math.round(parseInt(this.value)/this.step)*this.step:this.value;
};this.addEventListener("keydown",function(e){var key=e.keyCode;var ctrlKey=e.ctrlKey;
switch(key){case 37:if(this.$dir!="horizontal"){return;}this.change(this.value-(ctrlKey?0.01:0.1));
break;case 38:if(this.$dir!="vertical"){return;}this.change(this.value+(ctrlKey?0.01:0.1));
break;case 39:if(this.$dir!="horizontal"){return;}this.change(this.value+(ctrlKey?0.01:0.1));
break;case 40:if(this.$dir!="vertical"){return;}this.change(this.value-(ctrlKey?0.01:0.1));
break;case 13:if(this.$hasTSlider){this.$setLabelValue(this.oLabel.value);}break;
default:return;}return false;},true);this.slideToggle=function(e,userAction){if(!e){e=event;
}if(userAction&&this.disabled){return;}if(this.isOpened){this.slideUp();}else{this.slideDown(e);
}};this.slideDown=function(e){if(this.dispatchEvent("slidedown")===false){return false;
}this.isOpened=true;this.oSliderContainer.style.display="block";this.oSliderContainer.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";
this.oSliderContainer.style.display="block";var scWidth=this.oSliderContainer.offsetWidth;
var scHeight=this.oSliderContainer.offsetHeight;var kWidth=this.oKnob.offsetWidth;
var diff=apf.getDiff(this.oSliderContainer);var right=scWidth-this.$ext.offsetWidth;
this.$setLabelValue(this.oLabel.value);this.oSliderContainer.style.display="none";
if(this.$hasTSlider){right-=scWidth-parseInt(this.oKnob.style.left)-kWidth;}this.oSliderContainer.style.display="";
this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");var _self=this;apf.popup.show(this.$uniqueId,{x:-1*right,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:scWidth+1,height:scHeight-diff[1],callback:function(container){container.style[apf.supportOverflowComponent?"overflowY":"overflow"]="hidden";
}});};this.slideUp=function(){if(!this.isOpened){return false;}if(this.dispatchEvent("slideup")===false){return false;
}this.isOpened=false;if(this.selected){var htmlNode=apf.xmldb.findHtmlNode(this.selected,this);
if(htmlNode){this.$setStyleClass(htmlNode,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);
apf.popup.hide();return false;};this.addEventListener("afterselect",function(e){if(!e){e=event;
}this.slideUp();if(!this.isOpened){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);
}});this.$blur=function(){this.slideUp();if(!this.isOpened){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus",this.$baseCSSname+"Down"]);
if(this.$hasTSlider){this.$setLabelValue(this.oLabel.value);}};this.$focus=function(){this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");
};this.$draw=function(){this.$getNewContext("main");this.$ext=this.$getExternal(null,null,function(oExt){var oButton=this.$getLayoutNode("main","button",oExt);
if(oButton){oButton.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}});this.$hasTSlider=this.$hasLayoutNode("container");if(this.$hasTSlider){this.$getNewContext("container");
this.oSliderContainer=this.$getExternal("container");this.$ext.onselectstart=function(e){if(!e){e=event;
}e.cancelBubble=true;};}this.oLabel=this.$getLayoutNode("main","status",this.$ext);
this.oFill=this.$getLayoutNode("main","fill",this.$ext);this.oBalloon=this.$getLayoutNode("main","balloon",this.$ext);
if(this.$hasTSlider){this.oMarkers=this.$getLayoutNode("container","markers",this.oSliderContainer);
this.oKnob=this.$getLayoutNode("container","grabber",this.oSliderContainer);this.oSlider=this.$getLayoutNode("container","slider",this.oSliderContainer);
this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSliderContainer,apf.skins.getCssString(this.skinName));
document.body.appendChild(this.oSliderContainer);}else{this.oMarkers=this.$getLayoutNode("main","markers",this.$ext);
this.oKnob=this.$getLayoutNode("main","slider",this.$ext);this.oSlider=this.$ext;
}this.$dir=this.$getOption("main","direction")||"horizontal";this.oKnob.style.left=(parseInt(apf.getBox(apf.getStyle(this.oSlider,"padding"))[3]))+"px";
var _self=this;function prepareKnob(e){this.x=(e.clientX||e.x);this.y=(e.clientY||e.y);
this.stX=this.offsetLeft;this.siX=this.offsetWidth;this.stY=this.offsetTop;this.siY=this.offsetheight;
this.startValue=_self.value;if(_self.$dir=="horizontal"){this.max=_self.oSlider.offsetWidth-apf.getWidthDiff(_self.oSlider)-this.offsetWidth;
this.min=parseInt(apf.getBox(apf.getStyle(_self.oSlider,"padding"))[3]);}else{this.max=_self.oSlider.offsetHeight-apf.getHeightDiff(_self.oSlider)-this.offsetHeight;
this.min=parseInt(apf.getBox(apf.getStyle(_self.oSlider,"padding"))[0]);}}function getKnobValue(o,e,slideDiscreet){var to=(_self.$dir=="horizontal")?(e.clientX||e.x)-o.x+o.stX:(e.clientY||e.y)-o.y+o.stY;
to=(to>o.max?o.max:(to<o.min?o.min:to));var value=(((to-o.min)*100/(o.max-o.min)/100)*(_self.max-_self.min))+_self.min;
value=slideDiscreet?(Math.round(value/_self.step)*_self.step):value;value=(_self.$dir=="horizontal")?value:1-value;
return value;}this.oKnob.onmousedown=function(e){if(_self.disabled){return false;
}e=e||window.event;document.dragNode=this;prepareKnob.call(this,e);_self.$setStyleClass(this,"btndown",["btnover"]);
apf.dragMode=true;_self.$dragging=true;if(_self.balloon&&_self.oBalloon){_self.oBalloon.style.display="block";
_self.oBalloon.style.left=(_self.oKnob.offsetLeft-(_self.oBalloon.offsetWidth-_self.oKnob.offsetWidth)/2)+"px";
}var startValue=this.value;document.onmousemove=function(e){e=e||window.event;var o=this.dragNode;
if(!o){apf.dragMode=document.onmousemove=document.onmouseup=null;return;}var knobValue=getKnobValue(o,e,_self.slideSnap);
if(_self.realtime){if(_self.slideDiscreet){this.$onlySetXml=true;var rValue=_self.change(Math.round((knobValue/_self.step)*_self.step));
this.$onlySetXml=false;if(rValue!==false){_self.$propHandlers.value.call(_self,knobValue,"value",true);
}}else{_self.change(knobValue);}}else{_self.$propHandlers.value.call(_self,knobValue,"value",true);
}if(_self.balloon&&_self.oBalloon){_self.oBalloon.style.left=(_self.oKnob.offsetLeft-(_self.oBalloon.offsetWidth-_self.oKnob.offsetWidth)/2)+"px";
}};document.onmouseup=function(e){var o=this.dragNode;this.dragNode=null;o.onmouseout();
_self.$dragging=false;var knobValue=getKnobValue(o,e||window.event,_self.slideDiscreet||_self.slideSnap);
_self.value=startValue;var rValue=startValue!=knobValue?_self.change(knobValue,true):false;
if(rValue!==false&&_self.slideDiscreet){_self.$propHandlers.value.call(_self,knobValue,"value",true);
}apf.dragMode=false;document.onmousemove=document.onmouseup=null;if(_self.balloon&&_self.oBalloon){_self.oBalloon.style.left=(_self.oKnob.offsetLeft-(_self.oBalloon.offsetWidth-_self.oKnob.offsetWidth)/2)+"px";
$setTimeout(function(){if(apf.isIE){_self.oBalloon.style.display="none";}else{apf.tween.single(_self.oBalloon,{type:"fade",from:1,to:0,steps:5,onfinish:function(){_self.oBalloon.style.display="none";
_self.oBalloon.style.opacity=1;}});}},_self.slideDiscreet?200:0);}};return false;
};this.oKnob.onmouseup=this.oKnob.onmouseover=function(){if(document.dragNode!=this){_self.$setStyleClass(this,"btnover",["btndown"]);
}};this.oKnob.onmouseout=function(){if(document.dragNode!=this){_self.$setStyleClass(this,"",["btndown","btnover"]);
}};this.oSlider.onmousedown=function(e){if(_self.disabled){return false;}e=e||window.event;
var o=_self.oKnob;if((e.srcElement||e.target)!=o){var p=apf.getAbsolutePosition(o);
prepareKnob.call(o,{x:p[0]+o.offsetWidth/2,y:p[1]+o.offsetHeight/2});var value=getKnobValue(o,e,_self.slideDiscreet||_self.slideSnap);
_self.$propHandlers.value.call(_self,getKnobValue(o,e,_self.slideDiscreet),"value",true,true);
_self.setValue(value);}};if(apf.isIphone){apf.iphone.linkEvents(this.oKnob);}};
this.$loadAml=function(){if(this.max==1000001){this.setProperty("max",1);}apf.layout.setRules(this.oSlider,"knob","apf.all["+this.$uniqueId+"].$resize()",true);
apf.layout.queue(this.$ext);};this.$destroy=function(){this.oKnob.onmousedown=this.oKnob.onmouseup=this.oKnob.onmouseover=this.oKnob.onmouseout=null;
apf.layout.removeRule(this.$ext,"knob");};}).call(apf.slider.prototype=new apf.StandardBinding());
apf.range.prototype=apf.slider.prototype;apf.aml.setElement("range",apf.range);
apf.aml.setElement("slider",apf.slider);apf.slideshow=function(struct,tagName){this.$init(tagName||"slideshow",apf.NODE_VISIBLE,struct);
this.title="number";this.thumbheight=50;this.loadmsg=null;this.defaultthumb=null;
this.defaultimage=null;this.defaulttitle=null;this.delay=5;this.scalewidth=false;
this.previous=null,this.next=null,this.current=null,this.last=null;this.inuse=false;
this.play=false;this.thumbnails=true;this.lastChoose=null;this.$vSpace=210;this.$hSpace=150;
this.tmrShowLast=null;this.tmrIsResized=null;this.tmrPlay=null;this.tmrKeyDown=null;
this.tmrOnScroll=null;this.tmrZoom=null;this.tmrHoverDelay=null;this.$imageWidth;
this.$imageHeight;this.viewPortWidth=0;this.viewPortHeight=0;this.$zooming=false;
this.$oEmpty;this.$IEResizeCounter=0;this.lastOverflow=null;this.$positioning="basic";
};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("model","thumbheight","title","loadmsg","defaultthumb","defaulttitle","defaultimage","scalewidth");
this.$booleanProperties.scalewidth=true;this.$propHandlers.thumbheight=function(value){if(parseInt(value)){this.thumbheight=parseInt(value);
}};this.$propHandlers.delay=function(value){if(parseInt(value)){this.delay=parseInt(value);
}};this.$setSiblings=function(){var temp_n=this.getNextTraverse(this.current),temp_p=this.getNextTraverse(this.current,true);
this.next=temp_n?temp_n:this.getFirstTraverseNode();this.previous=temp_p?temp_p:this.getLastTraverseNode();
};this.$showLast=function(){var _self=this;clearInterval(this.tmrShowLast);this.tmrShowLast=setInterval(function(){if(!_self.inuse){if(_self.lastChoose){_self.current=_self.lastChoose;
_self.lastChoose=null;_self.$refresh();}clearInterval(_self.tmrShowLast);}},100);
};this.$paint=function(){var _self=this;this.current=this.getFirstTraverseNode();
this.oImage.src="about:blank";this.oThumbnails.style.height=this.otBody.style.height=this.otPrevious.style.height=this.otNext.style.height=this.thumbheight+"px";
this.oLoading.innerHTML=this.loadmsg||apf.language.getWord("sub.slideshow.loadmsg")||"Loading...";
this.oImage.onload=function(){_self.last=_self.current;_self.oBody.style.display="block";
_self.oImageBase.style.display="block";_self.oImageBase.src=_self.oImage.src;this.style.display="block";
var imgWidth=_self.oImageBase.offsetWidth||_self.oImageBase.width;var imgHeight=_self.oImageBase.offsetHeight||_self.oImageBase.height;
this.style.display="none";_self.oImageBase.style.display="none";var windowWidth=apf.isIE?document.documentElement.offsetWidth:window.innerWidth;
windowHeight=apf.isIE?document.documentElement.offsetHeight:window.innerHeight;
var bottomPanel=_self.$getPanelSize();var oBodyDiff=apf.getDiff(_self.oBody);var checkWH=[false,false];
var viewPortHeight=windowHeight-bottomPanel/2-_self.$vSpace,viewPortWidth=windowWidth-_self.$hSpace;
var _imgHeight=imgHeight,_imgWidth=imgWidth;if(_imgHeight>viewPortHeight){_imgWidth=parseInt(_imgWidth*(viewPortHeight/_imgHeight));
_imgHeight=viewPortHeight;}if(_imgWidth>viewPortWidth){_imgHeight=parseInt(_imgHeight*(viewPortWidth/_imgWidth));
_imgWidth=viewPortWidth;}_self.viewPortHeight=_imgHeight;_self.viewPortWidth=_imgWidth;
apf.tween.single(_self.oBody,{steps:apf.isGecko?20:(Math.abs(imgWidth-_self.oBody.offsetWidth)>40?10:3),anim:apf.tween.EASEIN,type:"mwidth",from:_self.oBody.offsetWidth-oBodyDiff[0],to:_imgWidth,onfinish:function(){checkWH[0]=true;
}});apf.tween.single(_self.oBody,{steps:apf.isGecko?20:(Math.abs(imgHeight-_self.oBody.offsetHeight)>40?10:3),anim:apf.tween.EASEIN,type:"mheight",margin:-1*(bottomPanel/2-10),from:_self.oBody.offsetHeight-oBodyDiff[1],to:_imgHeight,onfinish:function(){checkWH[1]=true;
}});_self.oImage.style.display="block";_self.oImage.style.width=_imgWidth+"px";
_self.oImage.style.height=_imgHeight+"px";_self.oImage.style.display="none";clearInterval(_self.tmrIsResized);
_self.tmrIsResized=setInterval(function(){if(checkWH[0]&&checkWH[1]){clearInterval(_self.tmrIsResized);
if(_self.current){_self.$setSiblings();}_self.oConsole.style.visibility="visible";
_self.oImage.style.display="block";_self.oTitle.style.display="block";_self.$checkThumbSize();
if(_self.thumbnails){_self.oThumbnails.style.display="block";}apf.tween.single(_self.oImage,{steps:2,type:"fade",from:0,to:1});
apf.tween.single(_self.oTitle,{steps:10,type:"fade",from:0,to:1});_self.inuse=false;
_self.addSelection();if(_self.play){_self.$play();}}},30);};this.oImage.onerror=function(){_self.inuse=false;
};this.oImage.onabort=function(){_self.inuse=false;};this.oContent.innerHTML=_self.title=="text"?this.$applyBindRule("title",this.current):(this.title=="number+text"?"<b>"+(apf.language.getWord("sub.slideshow.image")||"Image")+" "+(this.getPos()+1)+" "+(apf.language.getWord("sub.slideshow.of")||"of")+" "+this.getTraverseNodes().length+"</b><br />"+(this.$applyBindRule("title",this.current)||(this.defaulttitle?this.defaulttitle:(apf.language.getWord("sub.slideshow.defaulttitle")||"No description"))):"Image "+(this.getPos()+1)+" of "+this.getTraverseNodes().length);
};this.getPos=function(){return Array.prototype.indexOf.call(this.getTraverseNodes(),this.current);
};this.addSelection=function(move){var htmlElement=apf.xmldb.findHtmlNode(this.current,this),ww=apf.isIE?document.documentElement.offsetWidth:window.innerWidth,diffp=apf.getDiff(this.otPrevious),diffn=apf.getDiff(this.otNext),bp=parseInt(apf.getStyle(this.otPrevious,"width")),bn=parseInt(apf.getStyle(this.otNext,"width")),ew=parseInt(apf.getStyle(htmlElement,"width"));
if(htmlElement.offsetLeft+ew+5>ww-bp-bn-diffp[0]-diffn[0]){if(move){if(move>0){this.$tPrevious();
}else{if(move<0){this.$tNext();}}this.addSelection(move);}}if(this.$selected){this.$selected.className="ssPicBox";
}if(htmlElement){htmlElement.className="ssPicBox ssselected";}this.$selected=htmlElement;
};this.$refresh=function(){var _self=this;if(this.inuse){this.lastChoose=this.current;
this.$showLast();return;}if(this.play){clearInterval(this.tmrPlay);}this.$setSiblings();
this.inuse=true;apf.tween.single(this.oImage,{steps:5,type:"fade",from:1,to:0});
this.oTitle.style.display="block";apf.tween.single(this.oTitle,{steps:3,type:"fade",from:1,to:0,onfinish:function(){_self.oImage.style.left="0px";
_self.oImage.style.top="0px";var _src=(_self.$applyBindRule("src",_self.current)||_self.defaultimage||_self.defaultthumb);
var _src_temp=_self.oImage.src;_self.oImage.src=_src;_self.oImage.style.display="none";
if(_self.oImage.src==_src_temp&&apf.isWebkit){_self.inuse=false;apf.tween.single(_self.oImage,{steps:5,type:"fade",from:0,to:1});
apf.tween.single(_self.oTitle,{steps:3,type:"fade",from:0,to:1});}_self.oContent.innerHTML=_self.title=="text"?_self.$applyBindRule("title",_self.current):(_self.title=="number+text"?"<b>"+(apf.language.getWord("sub.slideshow.image")||"Image")+" "+(_self.getPos()+1)+" "+(apf.language.getWord("sub.slideshow.of")||"of")+" "+_self.getTraverseNodes().length+"</b><br />"+(_self.$applyBindRule("title",_self.current)||(_self.defaulttitle?_self.defaulttitle:apf.language.getWord("sub.slideshow.defaulttitle")||"No description")):"Image "+(_self.getPos()+1)+" of "+_self.getTraverseNodes().length);
}});};this.select=function(badge){this.current=badge;this.$show();};this.$hideScrollbars=function(){this.lastOverflow=document.documentElement.style.overflow=="hidden"?"auto":document.documentElement.style.overflow;
document.documentElement.style.overflow="hidden";};this.$showScrollbars=function(){document.documentElement.style.overflow=this.lastOverflow;
};this.$show=function(){var _self=this;this.$hideScrollbars();this.oBeam.style.display="none";
this.oBody.style.display="none";this.$int.style.display="block";this.$ext.style.display="block";
apf.tween.single(_self.oCurtain,{steps:10,type:"fade",from:0,to:0.7,onfinish:function(){_self.oBeam.style.display="block";
apf.tween.single(_self.oBeam,{steps:10,type:"fade",from:0,to:1,onfinish:function(){_self.oBody.style.display="block";
_self.oBody.style.width="100px";_self.oBody.style.height="100px";_self.oBody.style.marginLeft="-50px";
_self.oBody.style.marginTop="-50px";apf.tween.single(_self.oBody,{steps:5,type:"fade",from:0,to:1,onfinish:function(){if(apf.isIE){_self.oBody.style.filter="";
_self.oBeam.style.filter="";}_self.$refresh();}});}});}});};this.$Next=function(){this.current=this.next;
this.addSelection(-1);this.$refresh();};this.$Previous=function(){this.current=this.previous;
this.addSelection(1);this.$refresh();};this.$tNext=function(){this.otBody.appendChild(this.otBody.childNodes[0]);
};this.$tPrevious=function(){this.otBody.insertBefore(this.otBody.childNodes[this.otBody.childNodes.length-1],this.otBody.firstChild);
};this.$play=function(){var _self=this;clearInterval(this.tmrPlay);this.tmrPlay=setInterval(function(){_self.play=true;
if(_self.inuse){return;}_self.$Next();},_self.delay*1000);};this.$stop=function(){clearInterval(this.tmrPlay);
this.tmrPlay=null;this.play=false;};this.$clickThumb=function(oThumb){this.current=apf.xmldb.getNode(oThumb);
this.addSelection();this.$refresh();};this.$getPanelSize=function(){var title_height=this.oTitle.offsetHeight||parseInt(apf.getStyle(this.oTitle,"height"))+apf.getDiff(this.oTitle)[1];
return Math.max(this.oBeam.offsetHeight,title_height+(this.thumbnails?this.thumbheight:0)+this.oConsole.offsetHeight);
};this.$resize=function(){if(apf.isIE){this.$IEResizeCounter++;if(this.$IEResizeCounter==2){this.$IEResizeCounter=0;
return;}}var _self=this;_self.oImage.style.display="none";var windowWidth=apf.isIE?document.documentElement.offsetWidth:window.innerWidth,windowHeight=apf.isIE?document.documentElement.offsetHeight:window.innerHeight;
var imgWidth=_self.oImageBase.offsetWidth||_self.oImageBase.width;var imgHeight=_self.oImageBase.offsetHeight||_self.oImageBase.height;
var oBodyDiff=apf.getDiff(this.oBody);var bottomPanel=this.$getPanelSize();var viewPortHeight=windowHeight-bottomPanel/2-_self.$vSpace;
var viewPortWidth=windowWidth-_self.$hSpace;var _imgHeight=imgHeight;var _imgWidth=imgWidth;
if(_imgHeight>viewPortHeight){_imgWidth=parseInt(_imgWidth*(viewPortHeight/_imgHeight));
_imgHeight=viewPortHeight;}if(_imgWidth>viewPortWidth){_imgHeight=parseInt(_imgHeight*(viewPortWidth/_imgWidth));
_imgWidth=viewPortWidth;}this.viewPortHeight=_imgHeight;this.viewPortWidth=_imgWidth;
var checkWH=[false,false];apf.tween.single(_self.oBody,{steps:5,anim:apf.tween.EASEIN,type:"mwidth",from:_self.oBody.offsetWidth-oBodyDiff[0],to:_imgWidth,onfinish:function(){checkWH[0]=true;
}});apf.tween.single(_self.oBody,{steps:5,anim:apf.tween.EASEIN,type:"mheight",margin:-1*(bottomPanel/2-10),from:_self.oBody.offsetHeight-oBodyDiff[1],to:_imgHeight,onfinish:function(){checkWH[1]=true;
}});clearInterval(_self.tmrIsResized);_self.tmrIsResized=setInterval(function(){if(checkWH[0]&&checkWH[1]){clearInterval(_self.tmrIsResized);
_self.oImage.style.display="block";_self.oImage.style.width=_imgWidth+"px";_self.oImage.style.height=_imgHeight+"px";
apf.tween.single(_self.oImage,{steps:2,type:"fade",from:0,to:1});}},30);};this.$draw=function(){this.$pHtmlNode=document.body;
this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
this.oCurtain=this.$getLayoutNode("main","curtain",this.$ext);this.oBody=this.$getLayoutNode("main","body",this.$ext);
this.oContent=this.$getLayoutNode("main","content",this.$ext);this.oImage=this.$getLayoutNode("main","image",this.$ext);
this.oImageBase=this.$getLayoutNode("main","image_base",this.$ext);this.oClose=this.$getLayoutNode("main","close",this.$ext);
this.oBeam=this.$getLayoutNode("main","beam",this.$ext);this.oTitle=this.$getLayoutNode("main","title",this.$ext);
this.oThumbnails=this.$getLayoutNode("main","thumbnails",this.$ext);this.otBody=this.$getLayoutNode("main","tbody",this.$ext);
this.otPrevious=this.$getLayoutNode("main","tprevious",this.$ext);this.otNext=this.$getLayoutNode("main","tnext",this.$ext);
this.oLoading=this.$getLayoutNode("main","loading",this.$ext);this.oEmpty=this.$getLayoutNode("main","empty",this.$ext);
this.oConsole=this.$getLayoutNode("main","console",this.$ext);this.oPrevious=this.$getLayoutNode("main","previous",this.$ext);
this.oPlay=this.$getLayoutNode("main","play",this.$ext);this.oNext=this.$getLayoutNode("main","next",this.$ext);
var _self=this;var rules="var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()";
apf.layout.setRules(this.$pHtmlNode,this.$uniqueId+"_scaling",rules,true);apf.layout.queue(this.$pHtmlNode);
this.oPrevious.onclick=this.oNext.onclick=function(e){if(_self.disabled){return;
}if((this.className||"").indexOf("ssprevious")!=-1){_self.$Previous();}else{if((this.className||"").indexOf("ssnext")!=-1){_self.$Next();
}}};var tmrThumbButton=null;this.otPrevious.onmousedown=function(e){if(_self.disabled){return;
}tmrThumbButton=setInterval(function(){_self.$tPrevious();},50);};this.otNext.onmousedown=function(e){if(_self.disabled){return;
}tmrThumbButton=setInterval(function(){_self.$tNext();},50);};this.otNext.onmouseover=function(e){_self.$setStyleClass(_self.otNext,"ssnhover",null,true);
};this.otPrevious.onmouseover=function(e){_self.$setStyleClass(_self.otPrevious,"ssphover",null,true);
};this.otNext.onmouseout=function(e){_self.$setStyleClass(_self.otNext,"",["ssnhover"],true);
};this.otPrevious.onmouseout=function(e){_self.$setStyleClass(_self.otPrevious,"",["ssphover"],true);
};this.oPlay.onclick=function(e){if(_self.disabled){return;}if(_self.tmrPlay){_self.$stop();
_self.$setStyleClass(_self.oPlay,"",["ssstop"]);_self.$setStyleClass(_self.oPlay,"ssplay");
_self.oNext.style.visibility="visible";_self.oPrevious.style.visibility="visible";
_self.oThumbnails.style.display="block";}else{_self.$play();_self.$setStyleClass(_self.oPlay,"",["ssplay"]);
_self.$setStyleClass(_self.oPlay,"ssstop");_self.oNext.style.visibility="hidden";
_self.oPrevious.style.visibility="hidden";_self.oThumbnails.style.display="none";
}};this.oClose.onclick=function(){_self.$hide();_self.$showScrollbars();};document.onmouseup=function(e){clearInterval(tmrThumbButton);
return false;};this.oImage.onmouseover=function(e){if(_self.disabled){return;}_self.inuse=true;
var e=e||event;var target=e.target||e.srcElement;var imgWidth=_self.oImageBase.offsetWidth||_self.oImageBase.width;
var imgHeight=_self.oImageBase.offsetHeight||_self.oImageBase.height;var windowWidth=apf.isIE?document.documentElement.offsetWidth:window.innerWidth;
var windowHeight=apf.isIE?document.documentElement.offsetHeight:window.innerHeight;
var diff=apf.getDiff(_self.oBody);var posX=_self.oBody.offsetLeft+diff[0]/2;var posY=_self.oBody.offsetTop+diff[1]/2;
var dx=0,dy=0;var w,h,ml,mt;var sx=e.clientX-posX;var sy=e.clientY-posY;w=_self.$imageWidth=parseInt(_self.oImage.style.width);
h=_self.$imageHeight=parseInt(_self.oImage.style.height);var percent_posX=sx/_self.$imageWidth;
var percent_posY=sy/_self.$imageHeight;this.onmousemove=function(e){var e=e||event;
sx=e.clientX-posX;sy=e.clientY-posY;percent_posX=sx/_self.$imageWidth;percent_posY=sy/_self.$imageHeight;
if((_self.$imageWidth==parseInt(_self.oImage.style.width)&&_self.$imageHeight==parseInt(_self.oImage.style.height))||_self.$zooming){return;
}ml=-1*(percent_posX*w-sx);mt=-1*(percent_posY*h-sy);if(ml<=0&&ml>=-1*(w-_self.viewPortWidth)){_self.oImage.style.left=ml+"px";
}if(mt<=0&&mt>=-1*(h-_self.viewPortHeight)){_self.oImage.style.top=mt+"px";}};clearInterval(_self.tmrHoverDelay);
_self.tmrHoverDelay=setInterval(function(){clearInterval(_self.tmrHoverDelay);clearInterval(_self.tmrZoom);
_self.tmrZoom=setInterval(function(){_self.$zooming=true;w=parseInt(_self.oImage.style.width);
h=parseInt(_self.oImage.style.height);var l=parseInt(_self.oImage.style.left);var t=parseInt(_self.oImage.style.top);
var ratio=apf.isIE?0.03:0.01;if(w<imgWidth){_self.oImage.style.width=(w+w*ratio)+"px";
_self.oImage.style.left=-1*(percent_posX*w-sx)+"px";}if(h<imgHeight){_self.oImage.style.height=(h+h*ratio)+"px";
_self.oImage.style.top=-1*(percent_posY*h-sy)+"px";}if(w>=imgWidth&&h>=imgHeight){clearInterval(_self.tmrZoom);
_self.$zooming=false;}},apf.isIE?5:10);},1000);};this.oImage.onmouseout=function(e){if(_self.disabled){return;
}_self.inuse=false;clearInterval(_self.tmrZoom);clearInterval(_self.tmrHoverDelay);
_self.oImage.style.width=_self.$imageWidth+"px";_self.oImage.style.height=_self.$imageHeight+"px";
_self.oImage.style.top="0px";_self.oImage.style.left="0px";document.onmousemove=null;
};var SafariChromeFix=false;apf.addEventListener("mousescroll",function(e){if(!_self.xmlRoot||_self.$ext.style.display=="none"||_self.disabled){return;
}e=e||event;if(apf.isWebkit){SafariChromeFix=SafariChromeFix?false:true;if(!SafariChromeFix){return;
}}var delta=e.delta;var curNode=_self.current;var nextNode=_self.getNextTraverse(curNode);
var prevNode=_self.getNextTraverse(curNode,true);_self.next=nextNode?nextNode:_self.getFirstTraverseNode();
_self.previous=prevNode?prevNode:_self.getLastTraverseNode();_self.current=delta<0?_self.next:_self.previous;
_self.addSelection(delta);if(_self.current!==curNode){clearInterval(_self.tmrOnScroll);
_self.tmrOnScroll=setInterval(function(){_self.$refresh();clearInterval(_self.tmrOnScroll);
},400);}return false;});apf.addEventListener("onkeydown",function(e){e=(e||event);
if(_self.disabled){return;}var key=e.keyCode;var curNode=_self.current;var nextNode=_self.getNextTraverse(curNode);
var prevNode=_self.getNextTraverse(curNode,true);_self.next=nextNode?nextNode:_self.getFirstTraverseNode();
_self.previous=prevNode?prevNode:_self.getLastTraverseNode();_self.current=key==39?_self.next:(key==37?_self.previous:_self.current);
_self.addSelection(key==39?-1:(key==37?1:0));if(_self.current!==curNode){clearInterval(_self.tmrKeyDown);
_self.tmrKeyDown=setInterval(function(){_self.$refresh();clearInterval(_self.tmrKeyDown);
},550);}return false;});};this.$hide=function(){var _self=this;_self.$ext.style.display="block";
apf.tween.single(_self.oBody,{steps:10,type:"fade",from:1,to:0,onfinish:function(){_self.oBody.style.display="none";
}});apf.tween.single(_self.oBeam,{steps:10,type:"fade",from:1,to:0,onfinish:function(){_self.oBeam.style.display="none";
apf.tween.single(_self.oCurtain,{steps:10,type:"fade",from:0.7,to:0,onfinish:function(){_self.$int.style.display="none";
_self.$ext.style.display="none";}});}});};this.$checkThumbSize=function(){var nodes=this.getTraverseNodes();
var nodes_len=nodes.length;var picBoxes=this.otBody.childNodes;var picBoxed_len=picBoxes.length;
var widthSum=0;var boxDiff,srcThumb,htmlPicBox,h,w,bh,testImg,counter=0;for(var i=0;
i<picBoxed_len;i++){if((picBoxes[i].className||"").indexOf("ssPicBox")>-1){htmlPicBox=picBoxes[i];
srcThumb=this.$applyBindRule("thumb",nodes[counter]);boxDiff=apf.getDiff(htmlPicBox);
bh=this.thumbheight-10-boxDiff[1];if(this.scalewidth){testImg=new Image();document.body.appendChild(testImg);
testImg.src=srcThumb?srcThumb:this.defaultthumb;h=bh;if(testImg.height<bh){w=testImg.width;
}else{testImg.setAttribute("height",bh);w=testImg.width;}document.body.removeChild(testImg);
}else{h=w=bh;}widthSum+=w+boxDiff[0]+(parseInt(apf.getStyle(htmlPicBox,"marginLeft")))+(parseInt(apf.getStyle(htmlPicBox,"marginRight")));
htmlPicBox.style.width=w+"px";counter++;}}var thumbDiff=apf.getDiff(this.otBody);
this.otPrevious.style.visibility=this.otNext.style.visibility=widthSum<this.oThumbnails.offsetWidth-thumbDiff[0]?"hidden":"visible";
};this.$load=function(xmlRoot){apf.xmldb.addNodeListener(xmlRoot,this);var nodes=this.getTraverseNodes();
var nodes_len=nodes.length;var boxDiff,srcThumb,htmlPicBox,h,w,bh,testImg=null;
for(var i=0;i<nodes_len;i++){htmlPicBox=this.otBody.appendChild(document.createElement("div"));
srcThumb=this.$applyBindRule("thumb",nodes[i]);htmlPicBox.style.backgroundImage="url("+(srcThumb?srcThumb:this.defaultthumb)+")";
htmlPicBox.className="ssPicBox";boxDiff=apf.getDiff(htmlPicBox);bh=this.thumbheight-10-boxDiff[1];
if(this.scalewidth){testImg=new Image();document.body.appendChild(testImg);testImg.src=srcThumb?srcThumb:this.defaultthumb;
h=bh;if(testImg.height<bh){w=testImg.width;}else{testImg.setAttribute("height",bh);
w=testImg.width;}document.body.removeChild(testImg);}else{h=w=bh;}htmlPicBox.style.height=h+"px";
htmlPicBox.style.width=w+"px";htmlPicBox.style.marginTop=htmlPicBox.style.marginBottom="5px";
apf.xmldb.nodeConnect(this.documentId,nodes[i],htmlPicBox,this);var _self=this;
htmlPicBox.onclick=function(e){_self.$clickThumb(this);};}if(nodes_len!=this.length){this.setProperty("length",nodes_len);
}this.$paint();};this.addEventListener("$clear",function(){return false;});this.$destroy=function(){this.otNext.onmouseover=this.otPrevious.onmouseover=this.otNext.onmouseout=this.otPrevious.onmouseout=this.$ext.onresize=this.oImage.onmousedown=this.otNext.onmousedown=this.otPrevious.onmousedown=this.oNext.onclick=this.oPrevious.onclick=null;
this.x=null;};this.$setClearMessage=function(msg,className){var ww=apf.isIE?document.documentElement.offsetWidth:window.innerWidth;
var bp=parseInt(apf.getStyle(this.otPrevious,"width"));var bn=parseInt(apf.getStyle(this.otNext,"width"));
var ew=parseInt(apf.getStyle(this.oEmpty,"width"));this.$oEmpty=this.oCurtain.appendChild(this.oEmpty.cloneNode(true));
apf.setNodeValue(this.$oEmpty,msg||"");this.$oEmpty.setAttribute("id","empty"+this.$uniqueId);
this.$oEmpty.style.display="block";this.$oEmpty.style.left=((ww-ew)/2-bp-bn)+"px";
apf.setStyleClass(this.$oEmpty,className,["ssloading","ssempty","offline"]);};this.$removeClearMessage=function(){if(!this.$oEmpty){this.$oEmpty=document.getElementById("empty"+this.$uniqueId);
}if(this.$oEmpty&&this.$oEmpty.parentNode){this.$oEmpty.parentNode.removeChild(this.$oEmpty);
}};this.$setCurrentFragment=function(fragment){this.otBody.appendChild(fragment);
this.dataset=fragment.dataset;if(!apf.window.hasFocus(this)){this.blur();}};this.$getCurrentFragment=function(){var fragment=document.createDocumentFragment();
while(this.otBody.childNodes.length){fragment.appendChild(this.otBody.childNodes[0]);
}fragment.dataset=this.dataset;return fragment;};}).call(apf.slideshow.prototype=new apf.MultiselectBinding());
apf.aml.setElement("slideshow",apf.slideshow);apf.aml.setElement("src",apf.BindingRule);
apf.aml.setElement("title",apf.BindingRule);apf.aml.setElement("thumb",apf.BindingRule);
apf.smartbinding=function(struct,tagName){this.$init(tagName||"smartbinding",apf.NODE_HIDDEN,struct);
this.$bindNodes={};};(function(){this.$supportedProperties=["bindings","actions","model"];
this.$handlePropSet=function(prop,value,force){switch(prop){case"model":if(typeof value=="string"){value=apf.nameserver.get("model",value);
}this.model=apf.nameserver.register("model",this.name,value);var amlNode;for(var uniqueId in this.$bindNodes){amlNode=this.$bindNodes[uniqueId];
this.model.unregister(amlNode);this.model.register(amlNode,this.$modelXpath[amlNode.getHost?amlNode.getHost().$uniqueId:amlNode.$uniqueId]||this.modelBaseXpath);
}break;case"bindings":if(this.$bindings){this.remove(this.$bindings);}this.$bindings=typeof value=="object"?value:apf.nameserver.lookup("bindings",value);
this.add(this.$bindings);break;case"actions":if(this.$actions){this.remove(this.$actions);
}this.$actions=typeof value=="object"?value:apf.nameserver.lookup("actions",value);
this.add(this.$actions);break;}this[prop]=value;};this.add=function(node){for(var uId in this.$bindNodes){node.register(this.$bindNodes[uId]);
}this["$"+node.localName]=node;};this.remove=function(node){for(var uId in this.$bindNodes){node.unregister(this.$bindNodes[uId]);
}};this.register=function(amlNode){this.$bindNodes[amlNode.$uniqueId]=amlNode;if(this.$bindings){this.$bindings.register(amlNode);
}if(this.$actions){this.$actions.register(amlNode);}if(this.$model){this.$model.register(amlNode);
}};this.unregister=function(amlNode){this.$bindNodes[amlNode.$uniqueId]=null;delete this.$bindNodes[amlNode.$uniqueId];
if(this.$bindings){this.$bindings.unregister(amlNode);}if(this.$actions){this.$actions.unregister(amlNode);
}if(this.$model){this.$model.unregister(amlNode);}};this.load=function(xmlNode){new apf.model().register(this).load(xmlNode);
};this.clear=function(state){};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.hasFeature(apf.__DATABINDING__)){this.register(this.parentNode);
}apf.console.info(this.name?"Creating SmartBinding ["+this.name+"]":"Creating implicitly assigned SmartBinding");
});}).call(apf.smartbinding.prototype=new apf.AmlElement());apf.aml.setElement("smartbinding",apf.smartbinding);
apf.source=function(struct,tagName){this.$init(tagName||"source",apf.NODE_HIDDEN,struct);
};(function(){this.$supportedProperties.push("src","type");this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.$addSource){this.parentNode.$addSource(this);
}});}).call(apf.source.prototype=new apf.AmlElement());apf.aml.setElement("source",apf.source);
apf.spinner=function(struct,tagName){this.$init(tagName||"spinner",apf.NODE_VISIBLE,struct);
this.max=64000;this.min=-64000;this.focused=false;this.value=0;this.realtime=false;
};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("width","value","max","min","caption","realtime");
this.$booleanProperties.realtime=true;this.$propHandlers.value=function(value){value=parseInt(value)||0;
this.value=this.oInput.value=(value>this.max?this.max:(value<this.min?this.min:value));
};this.$propHandlers.min=function(value){if(!(value=parseInt(value))){return;}this.min=value;
if(value>this.value){this.change(value);}};this.$propHandlers.max=function(value){if(!(value=parseInt(value))){return;
}this.max=value;if(value<this.value){this.change(value);}};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.value;};this.increment=function(){this.change(parseInt(this.oInput.value)+1);
};this.decrement=function(){this.change(parseInt(this.oInput.value)-1);};this.$enable=function(){this.oInput.disabled=false;
this.$setStyleClass(this.oInput,"",["inputDisabled"]);};this.$disable=function(){this.oInput.disabled=true;
this.$setStyleClass(this.oInput,"inputDisabled");};this.$focus=function(e){if(!this.$ext||this.focused){return;
}if(apf.hasFocusBug){apf.sanitizeTextbox(this.oInput);}this.focused=true;this.$setStyleClass(this.oInput,"focus");
this.$setStyleClass(this.$buttonPlus,"plusFocus");this.$setStyleClass(this.$buttonMinus,"minusFocus");
if(this.oLeft){this.$setStyleClass(this.oLeft,"leftFocus");}};this.$blur=function(e){if(!this.$ext&&!this.focused){return;
}this.$setStyleClass(this.oInput,"",["focus"]);this.$setStyleClass(this.$buttonPlus,"",["plusFocus"]);
this.$setStyleClass(this.$buttonMinus,"",["minusFocus"]);if(this.oLeft){this.$setStyleClass(this.oLeft,""["leftFocus"]);
}this.setValue(this.oInput.value);this.focused=false;};this.addEventListener("keydown",function(e){var key=e.keyCode,keyAccess=(key<8||(key>9&&key<37&&key!==12)||(key>40&&key<46)||(key>46&&key<48)||(key>57&&key<96)||(key>105&&key<109&&key!==107)||(key>109&&key!==189));
if(keyAccess){return false;}switch(key){case 38:this.increment();break;case 40:this.decrement();
break;}},true);this.addEventListener("keyup",function(e){},true);this.increment=function(){this.change(parseInt(this.oInput.value)+1);
};this.decrement=function(){this.change(parseInt(this.oInput.value)-1);};this.$draw=function(){var _self=this;
this.$ext=this.$getExternal(null,null,function(oExt){oExt.setAttribute("onmousedown",'if (!this.host.disabled)                     this.host.dispatchEvent("mousedown", {htmlEvent : event});');
oExt.setAttribute("onmouseup",'if (!this.host.disabled)                     this.host.dispatchEvent("mouseup", {htmlEvent : event});');
oExt.setAttribute("onclick",'if (!this.host.disabled)                     this.host.dispatchEvent("click", {htmlEvent : event});');
});this.$int=this.$getLayoutNode("main","container",this.$ext);this.oInput=this.$getLayoutNode("main","input",this.$ext);
this.$buttonPlus=this.$getLayoutNode("main","buttonplus",this.$ext);this.$buttonMinus=this.$getLayoutNode("main","buttonminus",this.$ext);
this.oLeft=this.$getLayoutNode("main","left",this.$ext);apf.sanitizeTextbox(this.oInput);
var timer,doc=(!document.compatMode||document.compatMode=="CSS1Compat")?document.html:document.body,z=0;
this.oInput.value=this.value;this.oInput.onmousedown=function(e){if(_self.disabled){return;
}e=e||window.event;clearTimeout(timer);var newval,value=parseInt(this.value)||0,step=0,cy=e.clientY,ot=_self.$int.offsetTop,ol=_self.$int.offsetLeft,ow=_self.$int.offsetWidth,oh=_self.$int.offsetHeight,func=function(){clearTimeout(timer);
timer=$setTimeout(func,10);if(!step){return;}newval=value+step;if(newval<=_self.max&&newval>=_self.min){value+=step;
value=Math.round(value);_self.oInput.value=value;if(_self.realtime){_self.change(value);
}}else{_self.oInput.value=step<0?_self.min:_self.max;}};func();function calcStep(e){e=e||window.event;
var x=e.pageX||e.clientX+(doc?doc.scrollLeft:0),y=e.pageY||e.clientY+(doc?doc.scrollTop:0),nrOfPixels=cy-y;
if((y>ot&&x>ol)&&(y<ot+oh&&x<ol+ow)){step=0;return;}step=Math.pow(Math.min(200,Math.abs(nrOfPixels))/10,2)/10;
if(nrOfPixels<0){step=-1*step;}}document.onmousemove=calcStep;document.onmouseup=function(e){clearTimeout(timer);
var value=parseInt(_self.oInput.value);if(value!=_self.value){_self.change(value);
}document.onmousemove=document.onmouseup=null;};};var buttonDown=false;this.$buttonPlus.onmousedown=function(e){if(_self.disabled){return;
}e=e||window.event;buttonDown=true;var value=(parseInt(_self.oInput.value)||0)+1,func=function(){clearTimeout(timer);
timer=$setTimeout(func,50);z++;value+=Math.pow(Math.min(200,z)/10,2)/10;value=Math.round(value);
_self.oInput.value=value<=_self.max?value:_self.max;if(_self.realtime){_self.change(value<=_self.max?value:_self.max);
}};apf.setStyleClass(this,"plusDown",["plusHover"]);func();};this.$buttonMinus.onmousedown=function(e){if(_self.disabled){return;
}e=e||window.event;buttonDown=true;var value=(parseInt(_self.oInput.value)||0)-1,func=function(){clearTimeout(timer);
timer=$setTimeout(func,50);z++;value-=Math.pow(Math.min(200,z)/10,2)/10;value=Math.round(value);
_self.oInput.value=value>=_self.min?value:_self.min;if(_self.realtime){_self.change(value>=_self.min?value:_self.min);
}};apf.setStyleClass(this,"minusDown",["minusHover"]);func();};this.$buttonMinus.onmouseout=function(e){if(_self.disabled){return;
}clearTimeout(timer);z=0;var value=parseInt(_self.oInput.value);if(value!=_self.value){_self.change(value);
}apf.setStyleClass(this,"",["minusHover"]);if(!_self.focused){_self.$blur(e);}};
this.$buttonPlus.onmouseout=function(e){if(_self.disabled){return;}clearTimeout(timer);
z=0;var value=parseInt(_self.oInput.value);if(value!=_self.value){_self.change(value);
}apf.setStyleClass(this,"",["plusHover"]);if(!_self.focused){_self.$blur(e);}};
this.$buttonMinus.onmouseover=function(e){if(_self.disabled){return;}apf.setStyleClass(this,"minusHover");
};this.$buttonPlus.onmouseover=function(e){if(_self.disabled){return;}apf.setStyleClass(this,"plusHover");
};this.$buttonPlus.onmouseup=function(e){if(_self.disabled){return;}e=e||event;
apf.cancelBubble(e,this);apf.setStyleClass(this,"plusHover",["plusDown"]);clearTimeout(timer);
z=0;var value=parseInt(_self.oInput.value);if(!buttonDown){value++;_self.oInput.value=value;
}else{buttonDown=false;}if(value!=_self.value){_self.change(value);}};this.$buttonMinus.onmouseup=function(e){if(_self.disabled){return;
}e=e||event;apf.cancelBubble(e,this);apf.setStyleClass(this,"minusHover",["minusDown"]);
clearTimeout(timer);z=0;var value=parseInt(_self.oInput.value);if(!buttonDown){value--;
_self.oInput.value=value;}else{buttonDown=false;}if(value!=_self.value){_self.change(value);
}};this.oInput.onselectstart=function(e){e=e||event;e.cancelBubble=true;};this.oInput.host=this;
};this.$destroy=function(){this.oInput.onkeypress=this.oInput.onmousedown=this.oInput.onkeydown=this.oInput.onkeyup=this.oInput.onselectstart=this.$buttonPlus.onmouseover=this.$buttonPlus.onmouseout=this.$buttonPlus.onmousedown=this.$buttonPlus.onmouseup=this.$buttonMinus.onmouseover=this.$buttonMinus.onmouseout=this.$buttonMinus.onmousedown=this.$buttonMinus.onmouseup=null;
};}).call(apf.spinner.prototype=new apf.StandardBinding());apf.aml.setElement("spinner",apf.spinner);
apf.splitbutton=function(struct,tagName){this.$init(tagName||"splitbutton",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$propHandlers.caption=function(value){this.$button1.setProperty("caption",value);
};this.$propHandlers.icon=function(value){this.$button1.setProperty("icon",value);
};this.$propHandlers.disabled=function(value){this.$button1.setProperty("disabled",value);
this.$button2.setProperty("disabled",value);};this.$propHandlers.submenu=function(value){this.$button2.setProperty("submenu",value);
var _self=this;self[value].addEventListener("display",function(){this.$ext.style.marginLeft="-"+_self.$button1.$ext.offsetWidth+"px";
});};this.$draw=function(){var _self=this;this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));
this.$ext.style.overflow="hidden";var skin=this.getAttribute("skin")||this.localName;
this.$button1=new apf.button({htmlNode:this.$ext,parentNode:this,skin:skin,"class":"main",onmouseover:function(){apf.setStyleClass(this.$ext,"primary");
_self.$button2.$setState("Over",{});},onmouseout:function(){apf.setStyleClass(this.$ext,"",["primary"]);
_self.$button2.$setState("Out",{});},onclick:function(e){_self.dispatchEvent("click");
}});this.$button2=new apf.button({htmlNode:this.$ext,parentNode:this,skin:skin,"class":"arrow",onmouseover:function(){apf.setStyleClass(this.$ext,"primary");
_self.$button1.$setState("Over",{});},onmouseout:function(){if(!_self.$button2.value){apf.setStyleClass(this.$ext,"",["primary"]);
_self.$button1.$setState("Out",{});}else{apf.setStyleClass(this.$ext,"primary");
_self.$button1.$setState("Over",{});}}});};this.$loadAml=function(x){};}).call(apf.splitbutton.prototype=new apf.GuiElement());
apf.aml.setElement("splitbutton",apf.splitbutton);apf.splitter=function(struct,tagName){this.$init(tagName||"splitter",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$splitter=true;this.$booleanProperties.realtime=true;
this.$propHandlers.realtime=function(value){this.$setStyleClass(this.$ext,value&&(this.$baseCSSname+"Realtime")||"",[this.$baseCSSname+"Realtime"]);
};this.$propHandlers.type=function(value){this.$setStyleClass(this.$ext,value,[value=="horizontal"?"vertical":"horizontal"]);
if(value=="vertical"){this.$setStyleClass(this.$ext,"w-resize",["n-resize"]);}else{this.$setStyleClass(this.$ext,"n-resize",["w-resize"]);
}if(value=="horizontal"){this.$info={pos:"top",opos:"left",size:"width",osize:"height",offsetPos:"offsetTop",offsetSize:"offsetHeight",oOffsetPos:"offsetLeft",oOffsetSize:"offsetWidth",clientPos:"clientY",d1:1,d2:0,x1:0,x2:2};
}else{this.$info={pos:"left",opos:"top",size:"height",osize:"width",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oOffsetPos:"offsetTop",oOffsetSize:"offsetHeight",clientPos:"clientX",d1:0,d2:1,x1:3,x2:1};
}};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget!=this){return;
}this.init();});this.update=function(newPos,finalPass){with(this.$info){var max=this.$previous.$ext[offsetSize]+this.$next.$ext[offsetSize];
var method=finalPass?"setAttribute":"setProperty";if(apf.hasFlexibleBox){newPos-=apf.getAbsolutePosition(this.$previous.$ext,this.parentNode.$int)[d1];
}if((this.$previous.flex||this.$previous.flex===0)&&(this.$next.flex||this.$next.flex===0)){if(!finalPass&&!this.realtime){newPos-=this.$ext[offsetSize];
}this.$previous[method]("flex",newPos);this.$next[method]("flex",this.$totalFlex-newPos);
}else{if(!this.$next.flex){this.$next[method](osize,max-newPos);}if(!this.$previous.flex){this.$previous[method](osize,newPos);
}}}if(apf.hasSingleResizeEvent){apf.layout.forceResize(this.$ext.parentNode);}};
this.$setSiblings=function(){this.$previous=this.previousSibling;while(this.$previous&&(this.$previous.nodeType!=1||this.$previous.visible===false||this.$previous.nodeFunc!=apf.NODE_VISIBLE)){this.$previous=this.$previous.previousSibling;
}this.$next=this.nextSibling;while(this.$next&&(this.$next.nodeType!=1||this.$next.visible===false||this.$next.nodeFunc!=apf.NODE_VISIBLE)){this.$next=this.$next.nextSibling;
}};this.init=function(size,refNode,oItem){this.$setSiblings();this.$thickness=null;
if(this.parentNode.$box){this.setProperty("type",this.parentNode.localName=="vbox"?"horizontal":"vertical");
this.$thickness=parseInt(this.parentNode.padding);}if(!this.$previous||!this.$next){return this;
}with(this.$info){var diff=apf.getDiff(this.$ext);if(!this.parentNode.$box){var iSize=Math.max(this.$previous.$ext[offsetSize],this.$next.$ext[offsetSize]);
this.$ext.style[size]=(iSize-diff[d1])+"px";}var iThick=this[osize]=this.$thickness||(this.$next[oOffsetPos]-this.$previous[oOffsetPos]-this.$previous[oOffsetSize]);
this.$ext.style[osize]=(iThick-diff[d2])+"px";}return this;};this.$draw=function(){this.$ext=this.$getExternal();
var _self=this;this.$ext.onmousedown=function(e){if(!e){e=event;}_self.$setSiblings();
var changedPosition,pHtml=_self.parentNode.$int;if("absolute|fixed|relative".indexOf(apf.getStyle(pHtml,"position"))==-1){pHtml.style.position="relative";
changedPosition=true;}_self.$totalFlex=0;with(_self.$info){var posPrev=apf.getAbsolutePosition(_self.$previous.$ext,_self.parentNode.$int);
var min=posPrev[d1]||0;var posNext=apf.getAbsolutePosition(_self.$next.$ext,_self.parentNode.$int);
var max=posNext[d1]+_self.$next.$ext[offsetSize]-this[offsetSize];if((_self.$previous.flex||_self.$previous.flex===0)&&(_self.$next.flex||_self.$next.flex===0)){var set=[],nodes=_self.parentNode.childNodes,padding=0;
for(var node,i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).visible===false||node.nodeFunc!=apf.NODE_VISIBLE||node.$splitter){continue;
}if(node.flex){set.push(node,node.$ext[offsetSize]+(apf.hasFlexibleBox&&!_self.realtime&&node==_self.$previous?2*_self.parentNode.padding:0));
}}for(var i=0,l=set.length;i<l;i+=2){set[i].setAttribute("flex",set[i+1]);}}_self.$totalFlex+=_self.$next.flex+_self.$previous.flex;
var startPos,startOffset;if(apf.hasFlexibleBox){var coords=apf.getAbsolutePosition(this);
startPos=e[clientPos]-coords[d1];if(!_self.realtime){if(apf.hasFlexibleBox){if(_self.$previous.flex&&!_self.$next.flex){var mBox=apf.getBox(_self.$next.margin);
mBox[x1]=_self.parentNode.padding;_self.$next.$ext.style.margin=mBox.join("px ")+"px";
}else{var mBox=apf.getBox(_self.$previous.margin);mBox[x2]=_self.parentNode.padding;
_self.$previous.$ext.style.margin=mBox.join("px ")+"px";}}var diff=apf.getDiff(this);
this.style.left=coords[0]+"px";this.style.top=coords[1]+"px";this.style.width=(this.offsetWidth-diff[0])+"px";
this.style.height=(this.offsetHeight-diff[1])+"px";this.style.position="absolute";
}}else{var coords=apf.getAbsolutePosition(this.offsetParent);startOffset=apf.getAbsolutePosition(_self.$previous.$ext)[d1];
startPos=e[clientPos]-coords[d1];if(!_self.realtime){this.style.left="0px";this.style.top="0px";
this.style.position="relative";}min=-1000;}}e.returnValue=false;e.cancelBubble=true;
apf.plane.show(this);_self.$setStyleClass(this,_self.$baseCSSname+"Moving");_self.$setStyleClass(document.body,_self.type=="vertical"?"w-resize":"n-resize",[_self.type=="vertical"?"n-resize":"w-resize"]);
document.onmouseup=function(e){if(!e){e=event;}with(_self.$info){var newPos;if(e[clientPos]>=0){var coords=apf.getAbsolutePosition(_self.$ext.offsetParent);
newPos=(Math.min(max,Math.max(min,(e[clientPos]-coords[d1])-(apf.hasFlexibleBox?startPos:startOffset))));
}}_self.$setStyleClass(_self.$ext,"",[_self.$baseCSSname+"Moving"]);_self.$setStyleClass(document.body,"",["n-resize","w-resize"]);
if(changedPosition){pHtml.style.position="";}if(apf.hasFlexibleBox&&!_self.realtime){(_self.$previous.flex&&!_self.$next.flex?_self.$next:_self.$previous).$ext.style.margin=apf.getBox(_self.$previous.margin).join("px ")+"px";
}if(newPos){_self.update(newPos,true);}apf.plane.hide();if(!_self.realtime){_self.$ext.style.left="";
_self.$ext.style.top="";_self.$ext.style[_self.$info.size]="";_self.$ext.style.position="";
}document.onmouseup=document.onmousemove=null;};document.onmousemove=function(e){if(!e){e=event;
}with(_self.$info){var newPos;if(e[clientPos]>=0){var coords=apf.getAbsolutePosition(_self.$ext.offsetParent);
newPos=(Math.min(max,Math.max(min,(e[clientPos]-coords[d1])-(apf.hasFlexibleBox||!_self.realtime?startPos:startOffset))));
if(_self.realtime){_self.update(newPos);}else{_self.$ext.style[pos]=newPos+"px";
}}}e.returnValue=false;e.cancelBubble=true;};};apf.queue.add("splitter"+this.$uniqueId,function(){_self.init();
});};this.$loadAml=function(x){if(this.realtime!==false){this.$propHandlers.realtime.call(this,this.realtime=true);
}};}).call(apf.splitter.prototype=new apf.Presentation());apf.aml.setElement("splitter",apf.splitter);
apf.stateGroup=function(){this.$init("state-group",apf.NODE_HIDDEN);};apf.aml.setElement("state-group",apf.stateGroup);
(function(){this.$handlePropSet=function(prop,value,force){if(prop=="id"){return;
}var node,nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.nodeType!=1||node.localName!="state"){continue;}if(!node[prop]||node.$inheritProperties[prop]==2){node.$inheritProperties[prop]=2;
node.setProperty(prop,value);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.id){this.id="stategroup"+this.$uniqueId;
}var nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){nodes[i].setProperty("group",this.id);
}});}).call(apf.stateGroup.prototype=new apf.AmlElement());apf.StateServer={states:{},groups:{},locs:{},removeGroup:function(name,elState){this.groups[name].remove(elState);
if(!this.groups[name].length){if(self[name]){self[name].destroy();self[name]=null;
}delete this.groups[name];}},addGroup:function(name,elState,pNode){if(!this.groups[name]){this.groups[name]=[];
var pState=new apf.state({id:name});pState.parentNode=pNode;pState.toggle=function(){for(var next=0,i=0;
i<apf.StateServer.groups[name].length;i++){if(apf.StateServer.groups[name][i].active){next=i+1;
break;}}apf.StateServer.groups[name][(next==apf.StateServer.groups[name].length)?0:next].activate();
};this.groups[name].pState=self[name]=pState;}if(elState){this.groups[name].push(elState);
}return this.groups[name].pState;},removeState:function(elState){delete this.states[elState.name];
},addState:function(elState){this.states[elState.name]=elState;}};apf.state=function(struct,tagName){this.$init(tagName||"state",apf.NODE_HIDDEN,struct);
this.$signalElements=[];this.$groupAdded={};this.$locationAdded="";};(function(){this.$supportedProperties.push("active");
this.$booleanProperties.active=true;this.$propHandlers.active=function(value){if(apf.isTrue(value)){if(this.group){var nodes=apf.StateServer.groups[this.group];
if(!nodes){apf.StateServer.addGroup(this.group,this);nodes=apf.StateServer.groups[this.group];
}for(var i=0;i<nodes.length;i++){if(nodes[i]!=this&&nodes[i].active!==false){nodes[i].deactivate();
}}}var q=this.$signalElements;for(var i=0;i<q.length;i++){if(!self[q[i][0]]||!self[q[i][0]].setProperty){apf.console.warn("Could not find object to give state: "+q[i][0]+"' on property '"+q[i][1]+"'");
continue;}self[q[i][0]].setProperty(q[i][1],this[q[i].join(".")]);}if(this.group){var attr=this.attributes;
for(var i=0;i<attr.length;i++){if(attr[i].nodeName.match(/^on|^(?:group|id)$|^.*\..*$/)){continue;
}self[this.group].setProperty(attr[i].nodeName,attr[i].nodeValue);}apf.StateServer.groups[this.group].pState.dispatchEvent("change");
}this.dispatchEvent("activate");apf.console.info("Setting state '"+this.name+"' to ACTIVE");
}else{this.setProperty("active",false);this.dispatchEvent("deactivate");apf.console.info("Setting state '"+this.name+"' to INACTIVE");
}};this.setValue=function(value){this.active=9999;this.setProperty("active",value,false,true);
};this.activate=function(){this.active=9999;this.setProperty("active",true,false,true);
};this.deactivate=function(){this.setProperty("active",false,false,true);};this.$propHandlers.group=function(value){if(value){apf.StateServer.addGroup(value,this);
this.$groupAdded={value:value,elState:this};}else{apf.StateServer.removeGroup(this.$groupAdded.value,this.$groupAdded.elState);
this.$groupAdded={};}};this.$propHandlers.location=function(value){if(value){apf.StateServer.locs[value]=this;
this.$locationAdded=value;}else{delete apf.StateServer.locs[this.$locationAdded];
this.$locationAdded="";}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){apf.StateServer.addState(this);
var attr=this.attributes;for(var s,i=0;i<attr.length;i++){s=attr[i].nodeName.split(".");
if(s.length==2){this.$signalElements.push(s);}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$signalElements=null;
apf.StateServer.removeState(this);if(this.group){apf.StateServer.removeGroup(this.group,this);
}});}).call(apf.state.prototype=new apf.AmlElement());apf.aml.setElement("state",apf.state);
apf.statusbar=function(struct,tagName){this.$init(tagName||"statusbar",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;var insertChild;this.addEventListener("AMLRemoveChild",function(amlNode,doOnlyAdmin){if(doOnlyAdmin){return;
}});this.addEventListener("AMLInsert",insertChild=function(amlNode,beforeNode,withinParent){if(amlNode.tagName!="bar"){return;
}amlNode.$propHandlers.caption=function(value){apf.setNodeValue(this.$getLayoutNode("bar","caption",this.$ext),value);
};amlNode.$propHandlers.icon=function(value){var oIcon=this.$getLayoutNode("bar","icon",this.$ext);
if(!oIcon){return;}if(value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");
}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}if(oIcon.tagName=="img"){oIcon.setAttribute("src",value?this.iconPath+value:"");
}else{oIcon.style.backgroundImage=value?"url("+this.iconPath+value+")":"";}};});
this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
};this.$loadAml=function(x){var nodes=this.childNodes;for(var i=nodes.length-1;
i>=0;i--){if(nodes[i].localName=="section"){nodes[i].addEventListener("DOMNodeInsertedIntoDocument",function(){this.$setStyleClass(this.$ext,this.$baseCSSname+"Last");
});break;}}};}).call(apf.statusbar.prototype=new apf.Presentation());apf.aml.setElement("statusbar",apf.statusbar);
apf.style=function(struct,tagName){this.$init(tagName||"style",apf.NODE_HIDDEN,struct);
};(function(){this.$focussable=false;this.$propHandlers.src=function(value){apf.getData(value,{callback:function(data,state){if(state==apf.SUCCESS){apf.importCssString(data);
}}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.type!="text/chartcss"&&this.firstChild){apf.importCssString(this.firstChild.nodeValue);
}});}).call(apf.style.prototype=new apf.AmlElement());apf.aml.setElement("style",apf.style);
apf.xhtml.setElement("style",apf.style);apf.xforms=function(struct,tagName){this.$init(tagName||"xforms",apf.NODE_VISIBLE,struct);
};apf.submitform=function(struct,tagName){this.$init(tagName||"submitform",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.BaseTab,apf.ValidationGroup);this.$focussable=false;
this.elements={};var buttons={next:[],previous:[],submit:[],follow:[]};this.$focussable=false;
this.inputs=[];this.errorEl={};this.cq={};this.reqs=[];this.conditionDeps={};this.depends={};
this.loadValueDeps={};this.loadValues={};this.listsHeldBack={};this.nextHeldBack={};
this.activepagenr=0;this.zCount=1000000;this.clear=function(){};this.showLoader=function(checked,nr){if(checked){var page=nr?this.getPage(nr):this.getNextPage();
if(!page||page.$rendered){return;}}if(this.loadState){this.loadState.style.display="block";
var message=this.getPage().getAttribute("loadmessage");if(message){(apf.queryNode(this.loadState,"div[@class='msg']")||this.loadState).innerHTML=message;
}}};this.hideLoader=function(){if(this.loadState){this.loadState.style.display="none";
}};var nextpagenr;this.getNextPage=function(){var nextpage,pageNr=this.activepagenr;
do{nextpage=this.getPage(++pageNr);}while(nextpage&&!this.testCondition(nextpage.condition));
nextpagenr=pageNr;return nextpage;};this.next=function(no_error){if(!this.testing&&!this.isValid(null,null,this.getPage())){this.hideLoader();
return;}this.set(this.activepagenr+1);for(var prop in buttons){if(!prop.match(/next|previous|submit/)){continue;
}this.updateButtons(prop);}nextpagenr=null;};this.previous=function(){this.set(this.activepagenr-1);
for(var prop in buttons){if(!prop.match(/next|previous|submit/)){continue;}this.updateButtons(prop);
}};this.$enable=function(){forbuttons("enable");};this.$disable=function(){forbuttons("disable");
};function forbuttons(feat){var arr=["next","previous","submit","follow"];for(var k=0;
k<arr.length;k++){for(var i=0;i<buttons[arr[k]].length;i++){buttons[arr[k]][i][feat]();
}}}this.processValueChange=function(oFormEl){if(this.conditionDeps[oFormEl.name]){var c=this.conditionDeps[oFormEl.name];
for(var i=0;i<c.length;i++){if(this.testCondition(c[i].condition)){c[i].setActive();
}else{c[i].setInactive();}}}for(var prop in buttons){if(!prop.match(/next|previous|submit/)){continue;
}this.updateButtons(prop);}this.setLoadValues(oFormEl.name);};this.addInput=function(objEl){var name=objEl.name;
objEl.$validgroup=this;if(this.elements[name]&&!this.elements[name].length){this.elements[name]=[this.elements[name]];
this.elements[name].getValue=new Function("for (var i = 0; i < this.length; i++)                     if (this[i].$int.checked)                         return this[i].getValue();");
}if(this.elements[name]){this.elements[name].push(objEl);}else{this.elements[name]=objEl;
}if(this.cq[name]){for(var i=0;i<this.cq[name].length;i++){this.cq[name][i][1].call(this.cq[name][i][0],objEl);
objEl.labelEl=this.cq[name][i][0];}}if(objEl.getAttribute("dependson")){var o=self[objEl.getAttribute("dependson")];
if(!this.depends[o.name]){this.depends[o.name]=[];}this.depends[o.name].push(objEl);
objEl.setInactive();}if(objEl.nodeFunc==apf.NODE_VISIBLE){objEl.setZIndex(--this.zCount);
}if(this.listsHeldBack[name]){var ld=this.listsHeldBack[name];this.loadLists(ld[0],ld[1],ld[2]);
this.listsHeldBack[name]=null;}if(this.nQuest&&objEl.getAttribute("checknext")=="true"){if(this.lastEl){this.lastEl.nextEl=objEl;
objEl.prevEl=this.lastEl;}this.lastEl=objEl;if(objEl.prevEl&&objEl.getAttribute("show")!="true"&&!this.nextHeldBack[name]&&!objHasValue(objEl)){objEl.setInactive(true);
}else{if(this.condActiveCheck[objEl.name]){this.condActiveCheck[objEl.name].setActive();
}}if(this.condActiveCheck[objEl.name]){objEl.container=this.condActiveCheck[objEl.name];
function activateHandler(){if(this.form.hasActiveElement(this.container)){this.container.setActive();
}else{this.container.setInactive();}}objEl.addEventListener("activate",activateHandler);
objEl.addEventListener("deactivate",activateHandler);}}};this.hasActiveElement=function(objEl){var nodes=objEl.$aml.getElementsByTagName("*");
for(var i=0;i<nodes.length;i++){if(!nodes[i].getAttribute("id")){continue;}var comp=this.elements[nodes[i].getAttribute("id")];
if(comp&&comp.form==this&&comp.isActive){return true;}}return false;};this.condActiveCheck={};
this.getButtons=function(action){return buttons[action];};this.registerButton=function(action,oBtn){buttons[action].push(oBtn);
if(oBtn.condition){this.parseCondition(oBtn,oBtn.condition);}this.updateButtons(action,oBtn);
if(action=="follow"){return;}var amlNode=this;oBtn.onclick=function(){amlNode.showLoader(true);
$setTimeout(function(){amlNode[action]();},10);};};this.updateButtons=function(action,singleBtn){return false;
if(!buttons[action]){return false;}var result=true;if(action=="previous"&&this.activepagenr==0){result=false;
}else{if(!this.testing&&action=="next"&&!this.isValid()){result=false;}else{if(action=="next"){var cp=this.activepagenr;
do{var nextpage=this.getPage(++cp);}while(nextpage&&!this.testCondition(nextpage.condition));
if(!nextpage){result=false;}}}}if(this.testing){return true;}var buttons=singleBtn?[singleBtn]:buttons[action];
for(var i=0;i<buttons.length;i++){if(result&&(!buttons[i].condition||this.testCondition(buttons[i].condition))){buttons[i].setActive();
}else{buttons[i].setInactive();}}return true;};this.setLoadValues=function(item,clearElements,noload){var lvDep=this.loadValueDeps[item];
if(!lvDep){return;}for(var i=0;i<lvDep.length;i++){try{if(!eval(lvDep[i][1])){throw new Error();
}}catch(e){if(clearElements){var oEl=self[lvDep[i][0].getAttribute("element")];
if(oEl){this.clearNextQuestionDepencies(oEl,true);}if(lvDep[i][0].tagName=="LoadValue"){this.dispatchEvent("clearloadvalue",lvDep[i][0]);
}}continue;}if(noload){continue;}if(lvDep[i][0].getAttribute("runonrequest")!="true"){this.processLoadRule(lvDep[i][0],lvDep[i][2],lvDep[i]);
}else{if(self[lvDep[i][0].getAttribute("element")]){self[lvDep[i][0].getAttribute("element")].clear();
}}}};this.processLoadRule=function(xmlCommNode,isList,data){if(!apf.teleport.hasLoadRule(xmlCommNode)){return;
}this.dispatchEvent(isList?"beforeloadlist":"beforeloadvalue");var nodes=xmlCommNode.childNodes;
if(nodes.length){var arr,arg=xmlCommNode.getAttribute(apf.teleport.lastRuleFound.args);
arg=arg?arg.split(";"):[];if(xmlCommNode.getAttribute("argarray")){arr=[];}for(var j=0;
j<nodes.length;j++){if(nodes[j].nodeType!=1){continue;}if(nodes[j].getAttribute("argtype").match(/fixed|param|nocheck/)){var el=self[nodes[j].getAttribute("element")];
var xpath=el.getMainBindXpath();var xNode=apf.createNodeFromXpath(this.xmlRoot,xpath);
var nType=xNode.nodeType;(arr||arg)[nodes[j].getAttribute("argnr")||j]="xpath:"+xpath+(nType==1?"/text()":"");
}else{if(nodes[j].getAttribute("argtype")=="xpath"){(arr||arg)[nodes[j].getAttribute("argnr")||j]="xpath:"+nodes[j].getAttribute("select");
}}}if(xmlCommNode.getAttribute("argarray")){arg[xmlCommNode.getAttribute("argarray")]="("+arr.join(",")+")";
}xmlCommNode.setAttribute(apf.teleport.lastRuleFound.args,arg.join(";"));}var jNode=self[xmlCommNode.getAttribute("element")];
if(jNode&&jNode.nodeFunc==apf.NODE_VISIBLE){jNode.$setStyleClass(jNode.$ext,"loading",["loaded"]);
}apf.teleport.callMethodFromNode(xmlCommNode,this.xmlRoot,Function("data","state","extra","apf.lookup("+this.$uniqueId+")."+(isList?"loadLists":"loadValues")+"(data, state, extra)"),null,data);
};this.registerCondition=function(objEl,strCondition,no_parse){if(!no_parse){this.parseCondition(objEl,strCondition);
}var forceActive=false;if(objEl.onlyWhenActive){var nodes=objEl.$aml.getElementsByTagName("*");
for(var i=0;i<nodes.length;i++){if(!nodes[i].getAttribute("id")){continue;}if(this.nextHeldBack[nodes[i].getAttribute("id")]){forceActive=true;
}else{if(nodes[i].getAttribute("ref")&&this.xmlRoot&&apf.queryValue(this.xmlRoot.selectSingleNode(nodes[i].getAttribute("ref")))!=""){forceActive=true;
nodes[i].setAttribute("show","true");}}this.condActiveCheck[nodes[i].getAttribute("id")]=objEl;
}}if(forceActive||this.testCondition(objEl.condition)&&(!objEl.onlyWhenActive||this.hasActiveElement(objEl,true))){objEl.setActive();
}else{objEl.setInactive();}var matches=!no_parse?strCondition.match(/(\W|^)(\w+)(?:\=|\!\=)/g):strCondition.match(/(\b|^)([\w\.]+)/g);
if(!matches){return;}for(var i=0;i<matches.length;i++){if(!no_parse){var m=matches[i].replace(/(?:\=|\!\=)$/,"").replace(/(^\s+|\s+$)/g,"");
}else{var m=matches[i].split(".");if(m.length<2){continue;}m=m[0];}if(!this.conditionDeps[m]){this.conditionDeps[m]=Array();
}this.conditionDeps[m].push(objEl);}};this.testCondition=function(strCondition){try{return eval(strCondition);
}catch(e){return false;}};this.loadValues=function(data,state,extra){if(state!=apf.SUCCESS){if(extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}else{throw new Error(apf.formatErrorString(1010,this,"LoadVaLue","Could not load values with LoadValue query :\n\n"+extra.message));
}}if(extra.userdata[0].getAttribute("returntype")=="array"){for(var i=0;i<data.length;
i++){var pnode=this.xmlRoot.selectSingleNode("//"+data[i][0]);apf.xmldb.setTextNode(pnode,data[i][1]||"");
}}else{if(typeof data!="object"){data=apf.getXmlDom(data).documentElement;}var nodes=data.childNodes;
var strUnique=extra.userdata[0].getAttribute("unique");for(var i=nodes.length-1;
i>=0;i--){var xmlNode=nodes[i];var unique=strUnique?xmlNode.selectSingleNode(strUnique):false;
var node=unique?this.xmlRoot.selectSingleNode("node()["+strUnique+" = '"+unique.nodeValue+"']"):null;
if(node){apf.xmldb.copyConnections(node,xmlNode);apf.xmldb.notifyListeners(xmlNode);
var valueNode=xmlNode.selectSingleNode("value");if(valueNode){apf.xmldb.copyConnections(node.selectSingleNode("value"),valueNode);
apf.xmldb.notifyListeners(valueNode);}}this.xmlRoot.insertBefore(xmlNode,node);
if(node){this.xmlRoot.removeChild(node);}apf.xmldb.applyChanges("attribute",xmlNode);
}}this.dispatchEvent("afterloadvalue");};this.loadLists=function(data,state,extra){if(state!=apf.SUCCESS){if(extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}else{throw new Error(apf.formatErrorString(1011,this,"Load List","Could not load data with LoadList query :\n\n"+extra.message));
}}if(!self[extra.userdata[0].getAttribute("element")]){return this.listsHeldBack[extra.userdata[0].getAttribute("element")]=[data,state,extra];
}var jNode=self[extra.userdata[0].getAttribute("element")];if(jNode&&jNode.nodeFunc==apf.NODE_VISIBLE){jNode.$setStyleClass(jNode.$ext,"loaded",["loading"]);
$setTimeout("var jNode = apf.lookup("+jNode.$uniqueId+");                jNode.$setStyleClass(jNode.$ext, '', ['loading', 'loaded']);",500);
}if(extra.userdata[0].getAttribute("clearonload")=="true"){jNode.clearSelection();
this.clearNextQuestionDepencies(jNode,true);}jNode.load(data);this.dispatchEvent("afterloadlist");
};this.reset=function(){var name,el;for(name in this.elements){el=this.elements[name];
if(el.length){throw new Error(apf.formatErrorString(this,"clearing form","Found controls without a name or with a name that isn't unique. Please give all elements of your submitform an id: '"+name+"'"));
}el.clearError();if(this.errorEl[name]){this.errorEl[name].hide();}el.clear();}};
this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){this.dispatchEvent("xmlupdate");
};this.smartBinding={};this.$load=function(XMLRoot,id){apf.xmldb.addNodeListener(XMLRoot,this);
};function objHasValue(objEl){var oCheck=objEl;if(!oCheck){return false;}return oCheck.$applyBindRule(oCheck.$mainBind,oCheck.xmlRoot,null,true);
}function onafterload(){for(var name in this.elements){if(apf.isWebkit&&(!this.elements[name]||!this.elements[name].$amlLoaders)){continue;
}if(this.elements[name].length){throw new Error(apf.formatErrorString(1012,this,"clearing form","Found controls without a name or with a name that isn't unique("+name+"). Please give all elements of your submitform an id: '"+name+"'"));
}this.elements[name].clearError();if(this.errorEl[name]){this.errorEl[name].hide();
}}if(this.nQuest){for(name in this.elements){var objEl=this.elements[name];if(objEl.getAttribute("checknext")=="true"){if(objHasValue(objEl)){objEl.setActive();
if(this.condActiveCheck[name]){this.condActiveCheck[name].setActive();}}else{objEl.setInactive(true);
}}else{if(objEl.tagName=="Radiogroup"&&objEl.current){objEl.current.uncheck();}}}}if(this.nQuest&&this.xmlRoot.childNodes.length>0){var element=this.nQuest.getAttribute("final"),amlNode=self[element].$aml;
if(amlNode&&!apf.getBoundValue(amlNode,this.xmlRoot)){var fNextQNode=apf.xmldb.selectSingleNode(".//node()[@checknext='true']",this.$aml);
if(!fNextQNode){return;}self[fNextQNode.getAttribute("id")].dispatchEvent("afterchange");
}}}this.addEventListener("afterload",onafterload);this.addEventListener("afterinsert",onafterload);
this.addEventListener("beforeload",function(){if(!this.smartBinding||!this.smartBinding.actions){return;
}var nodes=this.smartBinding.actions.LoadList;if(nodes){for(var objEl,i=0;i<nodes.length;
i++){if(!nodes[i].getAttribute("element")||!(objEl=this.elements[nodes[i].getAttribute("element")])){continue;
}objEl.clear();}}var nodes=this.smartBinding.actions.NextQuestion;if(nodes){for(var objEl,i=0;
i<nodes.length;i++){if(!nodes[i].getAttribute("final")||!(objEl=this.elements[nodes[i].getAttribute("element")])){continue;
}objEl.clear();}}});this.implement(apf.GuiElement);this.addOther=function(tagName,oAml){if(tagName=="loadstate"){var htmlNode=apf.getFirstElement(oAml);
this.loadState=apf.insertHtmlNode(htmlNode,this.$int);this.loadState.style.display="none";
}};this.$draw=function(){this.oPages=this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
this.$ext.host=this;};this.submit=function(submissionId){if(!this.isValid()){return;
}if(!this.$model){return;}var type=this.method=="urlencoded-post"?"native":(this.type||"xml");
var instruction=submissionId||this.action?((this.method.match(/post/)?"url.post:":"")+this.action):"";
this.$model.submit(instruction,type,this.useComponents,this.ref);};this.setModel=function(model,xpath){this.$model=model;
};this.$loadAml=function(x){this.testing=x.getAttribute("testing")=="true";this.action=this.getAttribute("action");
this.ref=this.getAttribute("ref");this.type=this.getAttribute("submittype")||"native";
this.method=(this.getAttribute("method")||"get").toLowerCase();this.useComponents=this.getAttribute("usecomponents")||true;
apf.setModel(x.getAttribute("model"),this);this.$loadChildren(function(xmlPage){this.validation=xmlPage.getAttribute("validation")||"true";
this.invalidmsg=xmlPage.getAttribute("invalidmsg");});};}).call(apf.submitform.prototype=new apf.StandardBinding());
apf.xforms.prototype=apf.submitform.prototype;apf.aml.setElement("xforms",apf.xforms);
apf.aml.setElement("submitform",apf.submitform);apf["switch"]=function(struct,tagName){this.$hasButtons=false;
this.$init(tagName||"switch",apf.NODE_VISIBLE,struct);};apf.pages=function(struct,tagName){this.$hasButtons=false;
this.$init(tagName||"pages",apf.NODE_VISIBLE,struct);this.$focussable=false;};apf.tab=function(struct,tagName){this.$hasButtons=true;
this.$init(tagName||"tab",apf.NODE_VISIBLE,struct);};(function(){this.$focussable=apf.KEYBOARD;
this.$draw=function(bSkinChange){this.$ext=this.$getExternal();this.$loadChildren();
};}).call(apf.tab.prototype=new apf.BaseTab());apf["switch"].prototype=apf.pages.prototype=apf.tab.prototype;
apf.aml.setElement("switch",apf["switch"]);apf.aml.setElement("pages",apf.pages);
apf.aml.setElement("tab",apf.tab);apf.table=function(struct,tagName){this.$init(tagName||"table",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$useLateDom=true;this.$layout=true;this.columns=null;
this.padding=2;this.$edge=[5,5,5,5];this.cellheight=19;this.$supportedProperties.push("columns","padding","edge","cellheight","span");
this.$propHandlers.columns=function(value){if(!value.match(/^((?:\d+\%?|\*)\s*(?:,\s*|\s*$))+$/)){apf.console.warn("Invalid column string found for table: "+value);
return;}var col,colsize=this.$columns=value.splitSafe(",");var total=0,cols=this.$table.getElementsByTagName("col");
if(cols.length){for(var sz,i=0,l=Math.min(cols.length,colsize.length);i<l;i++){cols[i].style.width=(sz=colsize[i]).indexOf("%")>-1?sz:sz+"px";
total+=parseInt(sz);}}var start=cols.length-colsize.length;if(start>0){for(var i=cols.length-start;
i<cols.length;i++){cols[i].parentNode.removeChild(cols[i]);}}else{if(start<0){for(var i=colsize.length+start;
i<colsize.length;i++){col=this.$table.appendChild(document.createElement("col"));
col.style.width=(sz=colsize[i]).indexOf("%")>-1?sz:sz+"px";col.setAttribute("valign","top");
total+=parseInt(sz);}}}this.$table.style.width=String(value).indexOf("%")>-1?"auto":(total+((colsize.length-1)*this.padding)+this.$edge[0]+this.$edge[2])+"px";
var cells=this.$tbody.firstChild.getElementsByTagName("td");for(var i=cells.length-1;
i>=0;i--){cells[i].parentNode.removeChild(cells[i]);}for(var c,i=0;i<colsize.length;
i++){c=this.$tbody.firstChild.appendChild(document.createElement("td"));if(colsize[i].indexOf("%")>-1){c.appendChild(document.createElement("div")).style.width="50px";
}}if(start&&this.$amlLoaded){visibleHandler({sync:true,parentNode:this});}this.$resize();
};this.$propHandlers.padding=function(value){if(!this.$columns){return;}var cells=this.$table.getElementsByTagName("td");
var lastCol,lastRow,cell,lRow=this.$tbody.lastChild;for(var i=this.$columns.length,l=cells.length;
i<l;i++){lastCol=(cell=cells[i]).parentNode.lastChild==cell;lastRow=cell.parentNode==lRow;
cell.style.padding="0px "+(lastCol?0:value)+"px "+(lastRow?0:value)+"px 0px";}this.$resize();
};this.$propHandlers.edge=function(value){this.$table.style.padding=(this.$edge=apf.getBox(value)).join("px ")+"px";
this.$resize();};function visibleHandler(e){var table=e.parentNode||this.parentNode;
if(e.sync||e.value&&!this.$altExt||!e.value&&this.$altExt){var nodes=table.childNodes;
var cells=apf.getArrayFromNodelist(table.$tbody.getElementsByTagName("td"));var rows=table.$tbody.getElementsByTagName("tr");
var empty=[],row=1,cs,rs,collen=table.$columns.length;var z=table.$columns.length,lastCol;
for(var node,td,last,l=nodes.length,i=0;i<l;i++){if((node=nodes[i]).visible===false){continue;
}td=node.$altExt=last=cells[z++];if(!td){break;}if(!rows[row]){table.$tbody.appendChild(document.createElement("tr"));
}rows[row].appendChild(td);td.appendChild(node.$ext);td.setAttribute("colspan",cs=Math.min(collen-(empty[0]||0),parseInt(node.colspan||node.span||1)));
td.setAttribute("rowspan",rs=parseInt(node.rowspan||1));if(!empty[0]){empty[0]=0;
}empty[0]+=cs;if(rs>1){for(var k=1;k<rs;k++){if(!empty[k]){empty[k]=0;}empty[k]+=cs;
}}if(empty[0]>=collen){lastCol=true;empty.shift();row++;}else{lastCol=false;}td.style.padding="0px "+(lastCol?0:table.padding)+"px "+(i==l-1?0:table.padding)+"px 0px";
}var lastCells=rows[rows.length-1].getElementsByTagName("td");for(i=0,il=lastCells.length;
i<il;i++){lastCells[i].style.padding="0 "+(i==il-1?0:table.padding)+"px 0 0";}for(;
z<cells.length;z++){cells[z].parentNode.removeChild(cells[z]);}if(e.sync){return;
}if(e.value){table.$addTd(nodes[l-1]);}else{this.$altExt=null;}}}this.$addTd=function(amlNode){var cells=this.$table.getElementsByTagName("td");
var total=0,collen=this.$columns.length;for(var cell,i=0;i<cells.length;i++){total+=Math.min(collen,(parseInt((cell=cells[i]).getAttribute("colspan")||1)*parseInt(cell.getAttribute("rowspan")||1)));
}if(total%collen==0){var row=this.$tbody.appendChild(document.createElement("tr"));
}else{row=cells[cells.length-1].parentNode;}var cel=row.appendChild(document.createElement("td"));
cel.style.position="relative";if(amlNode.colspan||amlNode.span){cel.setAttribute("colspan",amlNode.colspan||amlNode.span);
}if(amlNode.rowspan){cel.setAttribute("rowspan",amlNode.rowspan);}cel.appendChild(amlNode.$ext);
amlNode.$altExt=cel;};var propHandlers={width:function(value){this.$ext.style.width="";
},height:function(value){this.$ext.style.height=value?Math.max(0,value-apf.getHeightDiff(this.$ext))+"px":"";
this.parentNode.$resize();},margin:function(value){this.$ext.style.margin=apf.getBox(value).join("px ")+"px";
this.parentNode.$resize();},colspan:function(value){if(!value){this.$altExt.removeAttribute("colspan");
}else{this.$altExt.setAttribute("colspan",value);}visibleHandler.call(this,{sync:true});
this.parentNode.$resize();},rowspan:function(value){if(!value){this.$altExt.removeAttribute("rowspan");
}else{this.$altExt.setAttribute("rowspan",value);}visibleHandler.call(this,{sync:true});
this.parentNode.$resize();},valign:function(value){this.$altExt.valign=value;},align:function(value){if("left|right".indexOf(value)==-1){return;
}this.$altExt.align=value;}};propHandlers.span=propHandlers.colspan;this.register=function(amlNode){if(amlNode.$altExt){return;
}amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=apf.K;
for(var prop in propHandlers){amlNode.$propHandlers[prop]=propHandlers[prop];}amlNode.addEventListener("prop.visible",visibleHandler);
this.$addTd(amlNode);this.$noResize=true;if(amlNode.margin){propHandlers.margin.call(amlNode,amlNode.margin);
}if(amlNode.$ext.tagName=="INPUT"){}else{amlNode.$ext.style.width="auto";}if(this.lastChild==amlNode){this.$propHandlers.padding.call(this,this.padding);
}delete this.$noResize;};this.unregister=function(amlNode){amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=null;
for(var prop in propHandlers){delete amlNode.$propHandlers[prop];}amlNode.removeEventListener("prop.visible",visibleHandler);
visibleHandler.call(amlNode,{value:false});if(amlNode.margin){amlNode.$ext.style.margin="";
}if(amlNode.width){amlNode.$ext.style.width="";}};this.addEventListener("DOMNodeRemoved",function(e){if(e.$doOnlyAdmin||e.currentTarget==this){return;
}if(e.relatedNode==this){this.unregister(e.currentTarget);}});this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this||e.currentTarget.nodeType!=1){return;
}if(e.relatedNode==this){if(e.$isMoveWithinParent){visibleHandler.call(e.currentTarget,{sync:true});
}else{e.currentTarget.$setLayout("table");if(e.currentTarget.nextSibling){visibleHandler.call(e.currentTarget,{sync:true});
}}}});this.$draw=function(){this.$ext=apf.insertHtmlNode(null,this.$pHtmlNode,null,"<div><table cellSpacing='0' cellPadding='0'><tbody><tr class='first'></tr></tbody></table></div>");
this.$table=this.$ext.firstChild;this.$tbody=this.$table.firstChild;this.$ext.className="table "+(this.getAttribute("class")||"");
this.$int=this.$ext;this.$ext.host=this;if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));
}this.addEventListener("resize",this.$resize);this.$originalMin=[this.minwidth||0,this.minheight||0];
};this.$resize=function(){if(!this.$amlLoaded||this.$noResize){return;}if(this.$table.offsetWidth>=this.$ext.offsetWidth){this.$ext.style.minWidth=(this.minwidth=Math.max(0,this.$table.offsetWidth-apf.getWidthDiff(this.$ext)))+"px";
}else{this.$ext.style.minWidth="";this.minwidth=this.$originalMin[0];}if(this.$table.offsetHeight>=this.$ext.offsetHeight){this.$ext.style.minHeight=(this.minheight=Math.max(0,this.$table.offsetHeight-apf.getHeightDiff(this.$ext)))+"px";
}else{this.$ext.style.minHeight="";this.minheight=this.$originalMin[1];}};this.$loadAml=function(x){this.$amlLoaded=false;
if(!this.$columns){this.$propHandlers.columns.call(this,this.columns="150, 200");
}this.$amlLoaded=true;};}).call(apf.table.prototype=new apf.GuiElement());apf.aml.setElement("table",apf.table);
apf.aml.setElement("teleport",apf.AmlElement);apf.template=function(struct,tagName){this.$init(tagName||"template",apf.NODE_HIDDEN,struct);
};(function(){this.$focussable=false;this.$frags={};this.getNewInstance=function(htmlNode,id,xmlNode,preventLastPass){if(this.$frags[id]){var frag=this.$frags[id];
}else{var model,xpath,attr,frag=this.$frags[id]=this.cloneNode(true);frag.$int=htmlNode;
if(xmlNode){model=apf.xmldb.findModel(xmlNode);xpath=apf.xmlToXpath(xmlNode,model.data,true)||".";
frag.attributes.push(attr=new apf.AmlAttr(frag,"model",""));attr.inheritedValue=[model.name,xpath];
}frag.ownerDocument.$domParser.$continueParsing(frag,{delay:true});}return frag;
};this.destroyInstance=function(id){var frag=this.$frags[id];delete this.$frags[id];
frag.destroy(true);};}).call(apf.template.prototype=new apf.AmlElement());apf.aml.setElement("template",apf.template);
apf.text=function(struct,tagName){this.$init(tagName||"text",apf.NODE_VISIBLE,struct);
this.$nodes=[];};(function(){this.implement(apf.Cache,apf.ChildValue);this.$focussable=true;
this.focussable=false;this.textselect=true;this.$hasStateMessages=true;this.$textTimer=this.$lastMsg=this.$lastClass=this.$changedHeight=null;
this.$booleanProperties.scrolldown=true;this.$booleanProperties.secure=true;this.$booleanProperties.textselect=true;
this.$supportedProperties.push("behavior","scrolldown","secure","value");this.$isTextInput=function(){return this.textselect;
};this.$propHandlers.scrolldown=function(value){var _self=this;if(value){this.$scrolldown=true;
this.$scrollArea.onscroll=function(){_self.$scrolldown=this.scrollTop>=this.scrollHeight-this.offsetHeight+apf.getVerBorders(this);
};this.addEventListener("scroll",this.$scroll);this.addEventListener("afterload",this.$scroll);
clearInterval(this.$textTimer);this.$textTimer=setInterval(function(){if(_self.$scrollArea&&_self.$scrolldown&&_self.scrolldown){_self.$scrollArea.scrollTop=_self.$scrollArea.scrollHeight;
}},1000);}else{this.removeEventListener("scroll",this.$scroll);this.removeEventListener("afterload",this.$scroll);
clearInterval(this.$textTimer);if(this.$scrollArea){this.$scrollArea.onscoll=null;
}}};this.$scroll=function(e){var html=this.$scrollArea;if(e.name=="afterload"){this.$scrolldown=true;
html.scrollTop=html.scrollHeight;return;}this.$scrolldown=html.scrollTop>=html.scrollHeight-html.offsetHeight+apf.getVerBorders(html);
};this.$propHandlers.value=function(value,prop,force,forceAdd){if(this.each){return;
}if(typeof value!="string"){if(value.nodeType){value=value.nodeType>1&&value.nodeType<5?value.nodeValue:value.firstChild&&value.firstChild.nodeValue||"";
}else{value=value?value.toString():"";}}if(this.secure){value=value.replace(/<a /gi,"<a target='_blank' ").replace(/<object.*?\/object>/g,"").replace(/<script.*?\/script>/g,"").replace(new RegExp("ondblclick|onclick|onmouseover|onmouseout|onmousedown|onmousemove|onkeypress|onkeydown|onkeyup|onchange|onpropertychange","g"),"ona");
}value=value.replace(/\<\?xml version="1\.0" encoding="UTF-16"\?\>/,"");if(forceAdd){apf.insertHtmlNodes(null,this.$container,null,value);
if(!this.value){this.value="";}this.value+=value;}else{this.$container.innerHTML=value;
}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";
}if(this.scrolldown&&this.$scrolldown){this.$scrollArea.scrollTop=this.$scrollArea.scrollHeight;
}};this.$eachHandler=function(value){this.$attrExcludePropBind=apf.extend({},this.$attrExcludePropBind);
this.$attrExcludePropBind.value=value?2:0;};this.addEventListener("prop.each",this.$eachHandler);
this.addEventListener("$clear",function(){this.$container.innerHTML="";this.value="";
this.dispatchEvent("prop.value",{value:""});});this.$moveNode=function(){};this.addValue=function(value){this.$propHandlers.value.call(this,value,null,null,true);
this.dispatchEvent("prop.value",{value:this.value});};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.$container.innerHTML;};this.addEventListener("keydown",function(e){var key=e.keyCode;
switch(key){case 33:this.$container.scrollTop-=this.$container.offsetHeight;break;
case 34:this.$container.scrollTop+=this.$container.offsetHeight;break;case 35:this.$container.scrollTop=this.$container.scrollHeight;
break;case 36:this.$container.scrollTop=0;break;case 38:this.$container.scrollTop-=10;
break;case 40:this.$container.scrollTop+=10;break;default:return;}return false;
},true);this.$canLoadData=function(){return this.$attrBindings.value?true:false;
};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){var f=this.$attrBindings.value.cvalue;
var html=f(xmlNode);html="<div id='"+Lid+"'>"+html+"</div>";if(htmlParentNode){if(beforeNode){beforeNode.insertAdjacentHTML("beforebegin",html);
}else{this.$container.insertAdjacentHTML("beforeend",html);}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";
}if(this.scrolldown&&this.$scrolldown){this.$scrollArea.scrollTop=this.$scrollArea.scrollHeight;
}}else{this.$nodes.push(html);}};this.$fill=function(){this.$container.insertAdjacentHTML("beforeend",this.$nodes.join(""));
this.$nodes=[];};this.$deInitNode=this.$updateNode=this.$moveNode=apf.K;this.$draw=function(){this.$ext=this.$getExternal();
this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!apf.getStyle(this.$container,"padding")){this.$fixScrollBug();
}this.$scrollArea=this.oFocus?this.oFocus.parentNode:this.$container;if(this.$container.tagName.toLowerCase()=="iframe"){if(apf.isIE){this.oIframe=this.$container;
var iStyle=this.skin.selectSingleNode("iframe_style");this.oIframe.contentWindow.document.write("<!DOCTYPE html>                    <head>                        <style>"+(iStyle?iStyle.firstChild.nodeValue:"")+"</style>                        <script>                            document.onkeydown = function(e){                                if (!e) e = event;                                if (top.apf.disableF5 && e.keyCode == 116) {                                    e.keyCode = 0;                                    return false;                                }                            }                        <\/script>                    </head>                    <body oncontextmenu='return false'></body>");
this.$container=this.oIframe.contentWindow.document.body;}else{var node=document.createElement("div");
this.$ext.parentNode.replaceChild(node,this.$ext);node.className=this.$ext.className;
this.$ext=this.$container=node;}}if(this.getAttribute("each")){this.$eachHandler();
}};this.addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(this.$textTimer);
apf.destroyHtmlNode(this.oDrag);if(this.$scrollArea){this.$scrollArea.onscoll=this.$scrollArea=null;
}this.oDrag=this.oIframe=this.oFocus=this.$container=this.$ext=null;});}).call(apf.text.prototype=new apf.MultiselectBinding());
apf.aml.setElement("text",apf.text);apf.input=function(struct,tagName){this.$init(tagName||"input",apf.NODE_VISIBLE,struct);
};apf.secret=function(struct,tagName){this.$init(tagName||"secret",apf.NODE_VISIBLE,struct);
};apf.password=function(struct,tagName){this.$init(tagName||"password",apf.NODE_VISIBLE,struct);
};apf.textarea=function(struct,tagName){this.$init(tagName||"textarea",apf.NODE_VISIBLE,struct);
this.multiline=true;};apf.email=function(struct,tagName){this.$init(tagName||"email",apf.NODE_VISIBLE,struct);
};apf.textbox=function(struct,tagName){this.$init(tagName||"textbox",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$masking=false;
this.$autoComplete=false;this.$childProperty="value";this.value="";this.$isTextInput=true;
this.multiline=false;this.$booleanProperties.focusselect=true;this.$booleanProperties.realtime=true;
this.$supportedProperties.push("value","mask","initial-message","focusselect","realtime","type");
this.$propHandlers.value=function(value,prop,force,initial){if(!this.$input||!initial&&this.getValue()==value){return;
}if(!initial&&!value&&!this.hasFocus()){return this.$clear();}else{if(this.isHTMLBox){if(this.$input.innerHTML!=value){this.$input.innerHTML=value;
}}else{if(this.$input.value!=value){this.$input.value=value;}}}if(!initial){apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);
}if(this.$button){this.$button.style.display=value&&!initial?"block":"none";}};
this.addEventListener("prop.maxlength",function(e){if(this.$input.tagName.toLowerCase().match(/input|textarea/)){this.$input.maxLength=parseInt(e.value)||null;
}});this.addEventListener("prop.editable",function(e){if(apf.isIE){this.$input.unselectable=e.value?"On":"Off";
}else{if(e.value){apf.addListener(this.$input,"mousedown",apf.preventDefault);}else{apf.removeListener(this.$input,"mousedown",apf.preventDefault);
}}});this.$propHandlers.mask=function(value){if(this.mask.toLowerCase()=="password"){return;
}if(!value){throw new Error("Not Implemented");}if(!this.$masking){this.$masking=true;
this.implement(apf.textbox.masking);this.focusselect=false;}this.setMask(this.mask);
};this.$propHandlers["initial-message"]=function(value){if(value){if(apf.hasFocusBug){this.$input.onblur();
}}if(!this.value){this.$clear(true);}if(this.type=="password"&&this.$inputInitFix){this.$inputInitFix.innerHTML=value;
apf.setStyleClass(this.$inputInitFix,"initFxEnabled");}};this.$propHandlers.focusselect=function(value){var _self=this;
this.$input.onmousedown=function(){_self.focusselect=false;};this.$input.onmouseup=this.$input.onmouseout=function(){_self.focusselect=value;
};};this.$propHandlers.type=function(value){if(value&&"password|username".indexOf(value)>-1&&typeof this.focusselect=="undefined"){this.focusselect=true;
this.$propHandlers.focusselect.call(this,true);}};this.$isTextInput=function(e){return true;
};this.setValue=function(value){return this.setProperty("value",value,false,true);
};this.clear=function(){this.setProperty("value","");};this.$clear=function(noEvent){if(this["initial-message"]){apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");
this.$propHandlers.value.call(this,this["initial-message"],null,null,true);}else{this.$propHandlers.value.call(this,"",null,null,true);
}if(!noEvent){this.dispatchEvent("clear");}};this.getValue=function(){var v=this.isHTMLBox?this.$input.innerHTML:this.$input.value;
return v==this["initial-message"]?"":v.replace(/\r/g,"");};this.select=function(){try{this.$input.select();
}catch(e){}};this.deselect=function(){this.$input.deselect();};this.$enable=function(){this.$input.disabled=false;
};this.$disable=function(){this.$input.disabled=true;};this.$insertData=function(str){return this.setValue(str);
};this.insert=function(text){if(apf.hasMsRangeObject){try{this.$input.focus();}catch(e){}var range=document.selection.createRange();
if(this.oninsert){text=this.oninsert(text);}range.pasteHTML(text);range.collapse(true);
range.select();}else{this.$input.value+=text;}};this.addEventListener("$clear",function(){this.value="";
if(this["initial-message"]&&apf.document.activeElement!=this){this.$propHandlers.value.call(this,this["initial-message"],null,null,true);
apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"");
}if(!this.$input.tagName.toLowerCase().match(/input|textarea/i)){if(apf.hasMsRangeObject){try{var range=document.selection.createRange();
range.moveStart("sentence",-1);range.select();}catch(e){}}}this.dispatchEvent("clear");
});this.$keyHandler=function(key,ctrlKey,shiftKey,altKey,e){if(this.$button&&key==27){if(this.value){this.change("");
e.stopPropagation();}}};this.$registerElement=function(oNode){if(!oNode){return;
}if(oNode.localName=="autocomplete"){this.$autoComplete=oNode;}};var fTimer;this.$focus=function(e){if(!this.$ext||this.$ext.disabled){return;
}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this["initial-message"]&&this.$input.value==this["initial-message"]){this.$propHandlers.value.call(this,"",null,null,true);
apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);}var _self=this;function delay(){try{if(!fTimer||document.activeElement!=_self.$input){_self.$input.focus();
}else{clearInterval(fTimer);return;}}catch(e){}if(_self.$masking){_self.setPosition();
}if(_self.focusselect){_self.select();}}if((!e||e.mouse)&&apf.isIE){clearInterval(fTimer);
fTimer=setInterval(delay,1);}else{delay();}};this.$blur=function(e){if(!this.$ext){return;
}if(!this.realtime){this.change(this.getValue());}if(e){e.cancelBubble=true;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus","capsLock"]);
if(this["initial-message"]&&this.$input.value==""){this.$propHandlers.value.call(this,this["initial-message"],null,null,true);
apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}try{if(apf.isIE||!e||e.srcElement!=apf.window){this.$input.blur();
}}catch(e){}if(this.oContainer){$setTimeout("var o = apf.lookup("+this.$uniqueId+");                o.oContainer.style.display = 'none'",100);
}clearInterval(fTimer);};this.$draw=function(){var _self=this,typedBefore=false;
if(this.localName=="codeeditor"){this.skin="textarea";this.$loadSkin();}this.$ext=this.$getExternal(null,null,function(oExt){var mask=this.getAttribute("mask");
if((typeof mask=="string"&&mask.toLowerCase()=="password")||"secret|password".indexOf(this.localName)>-1){this.type="password";
this.$getLayoutNode("main","input").setAttribute("type","password");}else{if(this.localName=="email"){this.datatype=(this.prefix?this.prefix+":":"")+"email";
this.$propHandlers.datatype.call(this,this.datatype,"datatype");}else{if(this.localName=="url"){this.datatype=(this.prefix?this.prefix+":":"")+"url";
this.$propHandlers.datatype.call(this,this.datatype,"datatype");}}}oExt.setAttribute("onmousedown","if (!this.host.disabled)                 this.host.dispatchEvent('mousedown', {htmlEvent : event});");
oExt.setAttribute("onmouseup","if (!this.host.disabled)                 this.host.dispatchEvent('mouseup', {htmlEvent : event});");
oExt.setAttribute("onclick","if (!this.host.disabled)                 this.host.dispatchEvent('click', {htmlEvent : event});");
});this.$input=this.$getLayoutNode("main","input",this.$ext);this.$button=this.$getLayoutNode("main","button",this.$ext);
this.$inputInitFix=this.$getLayoutNode("main","initialfix",this.$ext);if(this.type=="password"){this.$propHandlers.type.call(this,"password");
}if(!apf.hasContentEditable&&"input|textarea".indexOf(this.$input.tagName.toLowerCase())==-1){var node=this.$input;
this.$input=node.parentNode.insertBefore(document.createElement("textarea"),node);
node.parentNode.removeChild(node);this.$input.className=node.className;if(this.$ext==node){this.$ext=this.$input;
}}if(this.$button){this.$button.onmousedown=function(){_self.$clear();_self.change("");
_self.focus({mouse:true});};}if(this.$input.tagName.toLowerCase()=="textarea"){this.addEventListener("focus",function(e){});
}this.$input.onselectstart=function(e){if(!e){e=event;}e.cancelBubble=true;};this.$input.host=this;
this.$input.onkeydown=function(e){e=e||window.event;if(this.host.disabled){e.returnValue=false;
return false;}if(!_self.realtime){var value=_self.getValue();if(e.keyCode==13&&value!=_self.value){_self.change(value);
}}else{if(apf.isWebkit&&_self.xmlRoot&&_self.getValue()!=_self.value){$setTimeout("var o = apf.lookup("+_self.$uniqueId+");                    o.change(o.getValue())");
}}if(_self.multiline=="optional"&&e.keyCode==13&&!e.shiftKey||e.ctrlKey&&(e.keyCode==66||e.keyCode==73||e.keyCode==85)){e.returnValue=false;
return false;}if(typedBefore&&this.getAttribute("type")=="password"&&this.value!=""){var hasClass=(_self.$ext.className.indexOf("capsLock")>-1),capsKey=(e.keyCode===20);
if(capsKey){apf.setStyleClass(_self.$ext,hasClass?null:"capsLock",hasClass?["capsLock"]:null);
}}if(_self.$autoComplete||_self.oContainer){var keyCode=e.keyCode;$setTimeout(function(){if(_self.$autoComplete){_self.$autoComplete.fillAutocomplete(keyCode);
}else{_self.fillAutocomplete(keyCode);}});}if(!_self.mask){return _self.$keyHandler(e.keyCode,e.ctrlKey,e.shiftKey,e.altKey,e);
}};this.$input.onkeyup=function(e){if(!e){e=event;}if(this.host.disabled){return false;
}var keyCode=e.keyCode;if(_self.$button){_self.$button.style.display=this.value?"block":"none";
}if(_self.realtime){$setTimeout(function(){var v;if(!_self.mask&&(v=_self.getValue())!=_self.value){_self.change(v);
}if(apf.isIE){_self.dispatchEvent("keyup",{keyCode:keyCode});}});}else{if(apf.isIE){_self.dispatchEvent("keyup",{keyCode:keyCode});
}}if(_self.isValid&&_self.isValid()&&e.keyCode!=13&&e.keyCode!=17){_self.clearError();
}};if(apf.hasFocusBug){apf.sanitizeTextbox(this.$input);}if(apf.hasAutocompleteXulBug){this.$input.setAttribute("autocomplete","off");
}if("INPUT|TEXTAREA".indexOf(this.$input.tagName)==-1){this.isHTMLBox=true;this.$input.unselectable="Off";
this.$input.contentEditable=true;this.$input.style.width="1px";this.$input.select=function(){var r=document.selection.createRange();
r.moveToElementText(this);r.select();};}this.$input.deselect=function(){if(!document.selection){return;
}var r=document.selection.createRange();r.collapse();r.select();};var f;apf.addListener(this.$input,"keypress",f=function(e){if(_self.$input.getAttribute("type")!="password"){return apf.removeListener(_self.$input,"keypress",f);
}e=e||window.event;var which=-1;if(e.which){which=e.which;}else{if(e.keyCode){which=e.keyCode;
}}var shift_status=false;if(e.shiftKey){shift_status=e.shiftKey;}else{if(e.modifiers){shift_status=!!(e.modifiers&4);
}}if(((which>=65&&which<=90)&&!shift_status)||((which>=97&&which<=122)&&shift_status)){apf.setStyleClass(_self.$ext,"capsLock");
}else{apf.setStyleClass(_self.$ext,null,["capsLock"]);}typedBefore=true;});};this.$loadAml=function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");
}if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");
}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.$button){this.$button.onmousedown=null;
}if(this.$input){this.$input.onkeypress=this.$input.onmouseup=this.$input.onmouseout=this.$input.onmousedown=this.$input.onkeydown=this.$input.onkeyup=this.$input.onselectstart=null;
}});}).call(apf.textbox.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;
apf.config.$inheritProperties.realtime=1;apf.input.prototype=apf.secret.prototype=apf.password.prototype=apf.textarea.prototype=apf.email.prototype=apf.textbox.prototype;
apf.aml.setElement("input",apf.input);apf.aml.setElement("secret",apf.secret);apf.aml.setElement("password",apf.password);
apf.aml.setElement("textarea",apf.textarea);apf.aml.setElement("textbox",apf.textbox);
apf.toc=function(struct,tagName){this.$init(tagName||"toc",apf.NODE_VISIBLE,struct);
};(function(){this.$supportedProperties.push("represent");this.$propHandlers.represent=function(value){var _self=this;
$setTimeout(function(){var amlNode=_self.$represent=self[value];amlNode.addEventListener("afterswitch",function(e){_self.$setActivePage(e.nextId);
});if(amlNode.$drawn){_self.$createReflection();}else{amlNode.$amlLoaders.push(function(){toc.$createReflection();
});}});};this.gotoPage=function(nr,userAction){if(userAction&&this.disabled){return false;
}if(this.$represent.isValid&&!this.$represent.testing){var i,test,pages=this.$represent.getPages(),activepagenr=this.$represent.activepagenr;
for(i=activepagenr;i<nr;i++){pages[i].$ext.style.position="absolute";pages[i].$ext.style.top="-10000px";
pages[i].$ext.style.display="block";test=!this.$represent.isValid||this.$represent.isValid(i<activepagenr,i<activepagenr,pages[i]);
pages[i].$ext.style.display="";pages[i].$ext.style.position="";pages[i].$ext.style.top="";
pages[i].$ext.style.left="";pages[i].$ext.style.width="1px";pages[i].$ext.style.width="";
if(!test){return this.$represent.set(i);}}}if(this.$represent.showLoader){this.$represent.showLoader(true,nr);
}var _self=this;$setTimeout(function(){_self.$represent.set(nr);},1);};this.$setActivePage=function(active){if(!this.pagelookup[active]){var page,last,is_between;
for(page in this.pagelookup){if(page<active){last=page;}if(page>active){is_between=true;
}}if(!last||!is_between){return;}active=last;}for(var isPast=true,i=0;i<this.pages.length;
i++){this.$setStyleClass(this.pages[i],"",["future","past","hover","present"]);
if(this.pagelookup[active]==this.pages[i]){this.$setStyleClass(this.pages[i],"present",[]);
isPast=false;}else{if(isPast){this.$setStyleClass(this.pages[i],"past",[]);}else{this.$setStyleClass(this.pages[i],"future",[]);
}}if(i==this.pages.length-1){this.$setStyleClass(this.pages[i],"last");}}};this.$createReflection=function(){var i,oCaption,oPage,l={},pages=this.$represent.getPages(),l2=pages.length,p=[];
for(i=0;i<l2;i++){this.$getNewContext("page");oCaption=this.$getLayoutNode("page","caption");
oPage=this.$getLayoutNode("page");this.$setStyleClass(oPage,"page"+i);oPage.setAttribute("onmouseover","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "hover", null, true);');
oPage.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["hover"], true);');
if(!pages[i].getAttribute("caption")){apf.console.warn("Page element without caption found.");
}else{apf.setNodeValue(oCaption,pages[i].getAttribute("caption")||"");}oPage.setAttribute("onmousedown","setTimeout(function(){                    apf.lookup("+this.$uniqueId+").gotoPage("+i+", true);                });");
p.push(apf.insertHtmlNode(oPage,this.$int));l[i]=p[p.length-1];}this.pages=p;this.pagelookup=l;
this.$setActivePage(0);if(apf.isGecko){var tocNode=this;$setTimeout(function(){tocNode.$ext.style.height=tocNode.$ext.offsetHeight+1+"px";
tocNode.$ext.style.height=tocNode.$ext.offsetHeight-1+"px";},10);}};this.$draw=function(){this.$ext=this.$getExternal();
this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$int=this.$getLayoutNode("main","container",this.$ext);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!this.represent){throw new Error(apf.formatErrorString(1013,this,"Find representation","Could not find representation for the Toc: '"+this.name+"'",this));
}});}).call(apf.toc.prototype=new apf.Presentation());apf.aml.setElement("toc",apf.toc);
apf.toolbar=function(struct,tagName){this.$init(tagName||"toolbar",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$draw=function(){this.$ext=this.$getExternal();
this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toolbar.prototype=new apf.Presentation());
apf.aml.setElement("toolbar",apf.toolbar);apf.tree=function(struct,tagName){this.$init(tagName||"tree",apf.NODE_VISIBLE,struct);
};(function(){var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4,treeState=this.$treeState;
this.$mode=0;this.$propHandlers.mode=function(value){if("check|radio".indexOf(value)>-1){if(!this.hasFeature(apf.__MULTICHECK__)){this.implement(apf.MultiCheck);
}this.addEventListener("afterrename",$afterRenameMode);this.multicheck=value=="check";
this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",$afterRenameMode);
this.$mode=0;}};function $afterRenameMode(){}this.$initNode=function(xmlNode,state,Lid){this.$getNewContext("item");
var hasChildren=state&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",xmlNode),oItem=this.$getLayoutNode("item");
oItem.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, 'hover', null, true);");
oItem.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, '', ['hover'], true);");
this.$setStyleClass(this.$getLayoutNode("item","class"),treeState[state]).setAttribute(apf.xmldb.htmlIdTag,Lid);
this.$setStyleClass(this.$getLayoutNode("item","container"),treeState[state]);var elOpenClose=this.$getLayoutNode("item","openclose");
if(elOpenClose){elOpenClose.setAttribute("children",hasChildren);elOpenClose.setAttribute("onmousedown","if (this.getAttribute('children') == false) return;                var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, null, null, true);                apf.cancelBubble(event, o);");
elOpenClose.setAttribute("ondblclick","event.cancelBubble = true");}if(this.$mode){var elCheck=this.$getLayoutNode("item","check");
if(elCheck){elCheck.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.checkToggle(this, true);o.$skipSelect = true;");
if(apf.isTrue(this.$applyBindRule("checked",xmlNode))){this.$checkedList.push(xmlNode);
this.$setStyleClass(oItem,"checked");}else{if(this.isChecked(xmlNode)){this.$setStyleClass(oItem,"checked");
}}}else{throw new Error(apf.formatErrorString(0,this,"Could not find check attribute",'Maybe the attribute check is missing from your skin file:                            <a:item                              class        = "."                              caption      = "label/u/text()"                              icon         = "label"                              openclose    = "span"                              select       = "label"                              check        = "label/b"                              container    = "following-sibling::blockquote"                            >                                <div><span> </span><label><b> </b><u>-</u></label></div>                                <blockquote> </blockquote>                            </a:item>                        '));
return false;}}var ocAction=this.opencloseaction||"ondblclick";var elIcon=this.$getLayoutNode("item","icon");
if(elIcon&&elIcon!=elOpenClose){if(ocAction!="ondblclick"){elIcon.setAttribute(ocAction,"var o = apf.lookup("+this.$uniqueId+");"+(ocAction=="onmousedown"?"o.select(this, event.ctrlKey, event.shiftKey, event.button);":"")+(true?"o.slideToggle(this, null, null, true);":""));
}if(ocAction!="onmousedown"){elIcon.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").select(this, event.ctrlKey, event.shiftKey, event.button);");
}elIcon.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");              o.choose(null, true);o.stopRename();"+(true&&!ocAction=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");
}var elSelect=this.$getLayoutNode("item","select"),strMouseDown;if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){strMouseDown="var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, event.button);                 apf.cancelBubble(event, o);";
elSelect.setAttribute("onmouseout","this.hasPassedDown = false;"+(elSelect.getAttribute("onmouseout")||""));
elSelect.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (this.dorename && !o.mode)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, event.button);");
}else{strMouseDown="o.select(this, event.ctrlKey, event.shiftKey, event.button);                            apf.cancelBubble(event, o);";
}if(ocAction!="ondblclick"){elSelect.setAttribute(ocAction,"var o = apf.lookup("+this.$uniqueId+");"+(ocAction=="onmousedown"?strMouseDown:"")+(true?"o.slideToggle(this, null, null, true);":""));
}if(ocAction!="onmousedown"){elSelect.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");"+strMouseDown);
}elSelect.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");          o.choose(null, true);o.stopRename();this.dorename=false;"+(ocAction=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event, o);");
if(elIcon){var iconURL=this.$applyBindRule("icon",xmlNode);if(iconURL){if(elIcon.tagName.match(/^img$/i)){elIcon.setAttribute("src",apf.getAbsolutePath(this.iconPath,iconURL));
}else{elIcon.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,iconURL)+")");
}}}var elCaption=this.$getLayoutNode("item","caption");if(elCaption){if(elCaption.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var q=(this.$amlBindQueue||(this.$amlBindQueue={}));
elCaption.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.caption||(q.caption=[])).push(xmlNode)-1));
apf.setNodeValue(elCaption,"");}else{apf.setNodeValue(elCaption,this.$applyBindRule("caption",xmlNode));
}}var strTooltip=this.$applyBindRule("tooltip",xmlNode);if(strTooltip){oItem.setAttribute("title",strTooltip);
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass){this.$setStyleClass(this.$getLayoutNode("item",null,oItem),cssClass);
this.$setStyleClass(this.$getLayoutNode("item","container",oItem),cssClass);this.$dynCssClasses.push(cssClass);
}return oItem;};this.$updateNode=function(xmlNode,htmlNode){var elIcon=this.$getLayoutNode("item","icon",htmlNode),iconURL=this.$applyBindRule("icon",xmlNode);
if(elIcon&&iconURL){if(elIcon.tagName&&elIcon.tagName.match(/^img$/i)){elIcon.src=apf.getAbsolutePath(this.iconPath,iconURL);
}else{elIcon.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,iconURL)+")";
}}var elCaption=this.$getLayoutNode("item","caption",htmlNode);if(elCaption){if(elCaption.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){elCaption.innerHTML=this.$applyBindRule("caption",xmlNode);
}}else{elCaption.nodeValue=this.$applyBindRule("caption",xmlNode);}}var strTooltip=this.$applyBindRule("tooltip",xmlNode);
if(strTooltip){htmlNode.setAttribute("title",strTooltip);}var cssClass=this.$applyBindRule("css",xmlNode);
if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}};this.$draw=function(){this.$drawBase();};}).call(apf.tree.prototype=new apf.BaseTree());
apf.aml.setElement("tree",apf.tree);apf.aml.setElement("checked",apf.BindingRule);
apf.upload=function(struct,tagName){this.$init(tagName||"upload",apf.NODE_HIDDEN,struct);
var o,i=0,a=["html5","flash","html4"];for(;i<4&&!this.$method;++i){o=apf.upload[a[i]];
if(typeof o!="undefined"&&o.isSupported()){this.$method=new o(this);}}if(!this.$method){throw new Error(apf.formatErrorString(0,this,"upload","No upload method found that us supported by your browser!"));
}};apf.upload.STOPPED=1;apf.upload.STARTED=2;apf.upload.QUEUED=4;apf.upload.UPLOADING=8;
apf.upload.FAILED=16;apf.upload.DONE=32;apf.upload.ERROR_CODES={GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-700};
(function(constants){this.implement(apf.DataAction,apf.Validation);this.state=constants.STOPPED;
this.size=this.loaded=this.uploaded=this.failed=this.queued=this.percent=this.bitrate=this.chunksize=this.total=0;
this.maxfilesize=1073741824;this.multiple=true;this.multipart=true;this.filedataname="Filedata";
this.$method=null;this.$filter=[];this.$booleanProperties.multiple=true;this.$booleanProperties.multipart=true;
this.$supportedProperties.push("state","total","chunksize","maxfilesize","multiple","filedataname","target","filter","multipart","size","loaded","percent","bitrate","uploaded","failed","queued","button","model");
var startTime,fileIndex;this.$propHandlers.state=function(value){if(this.state&constants.STARTED){startTime=(+new Date());
}};this.$propHandlers.chunksize=function(value){this.chunksize=parseSize(value);
};this.$propHandlers.maxfilesize=function(value){this.chunksize=parseSize(value);
};this.$propHandlers.filter=function(value){this.$filter=value.splitSafe(",");};
this.$propHandlers.button=function(value){this.$button=self[value];if(!this.$button){throw new Error(apf.formatErrorString(0,this,"upload init","No valid identifier for a Button element passed to the 'button' attribute."));
}if(!this.$method.refresh){return;}var _self=this;if(!this.$button.$amlLoaded){this.$button.addEventListener("DOMNodeInsertedIntoDocument",function(){if(_self.button==value){_self.$propHandlers.button.call(_self,value);
}});return;}if(!apf.window.vManager.check(this.$button,this.$uniqueId,function(){_self.$method.refresh();
})){return;}this.$method.refresh();};this.$propHandlers.model=function(value){this.$files=new constants.files(this,value);
};this.$propHandlers.target=function(value){var oUrl=new apf.url(value);this.target=oUrl.uri;
if(oUrl.protocol=="file"){apf.console.warn("Upload: files uploaded to URL '"+this.src+"'\nwill be loaded through the 'file://' protocol.\nThis may be unsupported by your browser.","upload");
}else{if(!oUrl.isSameLocation()){apf.console.warn("Upload: the upload target with URL '"+this.src+"'\ndoes not have the same origin as your web application.\nThis may be unsupported by your browser.","upload");
}}};this.$mimeTypes={doc:"application/msword",dot:"application/msword",pdf:"application/pdf",pgp:"application/pgp-signature",ps:"application/postscript",ai:"application/postscript",eps:"application/postscript",rtf:"text/rtf",xls:"application/vnd.ms-excel",xlb:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",pot:"application/vnd.ms-powerpoint",zip:"application/zip",swf:"application/x-shockwave-flash",swfl:"application/x-shockwave-flash",docx:"application/vnd.openxmlformats",pptx:"application/vnd.openxmlformats",xlsx:"application/vnd.openxmlformats",mpga:"audio/mpeg",mpega:"audio/mpeg",mp2:"audio/mpeg",mp3:"audio/mpeg",wav:"audio/x-wav",bmp:"image/bmp",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",jpe:"image/jpeg",png:"image/png",svg:"image/svg+xml",svgz:"image/svg+xml",tiff:"image/tiff",tif:"image/tiff",htm:"text/html",html:"text/html",xhtml:"text/html",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",qt:"video/quicktime",mov:"video/quicktime",flv:"video/x-flv",rv:"video/vnd.rn-realvideo",asc:"text/plain",txt:"text/plain",text:"text/plain",diff:"text/plain",log:"text/plain",exe:"application/octet-stream"};
function parseSize(size){var mul;if(typeof size=="string"){size=/^([0-9]+)([mgk]+)$/.exec(size.toLowerCase().replace(/[^0-9mkg]/g,""));
mul=size[2];size=+size[1];if(mul=="g"){size*=1073741824;}if(mul=="m"){size*=1048576;
}if(mul=="k"){size*=1024;}}return size;}function calc(){if(!this.$files){return;
}var file,size=0,loaded=0,uploaded=0,failed=0,queued=0,percent=0,bitrate=0,files=this.$files.toArray(),i=0,l=files.length;
for(;i<l;++i){file=files[i];if(typeof file.size!="undefined"){size+=file.size;loaded+=file.loaded;
}if(file.status&constants.DONE){uploaded++;}else{if(file.status&constants.FAILED){failed++;
}else{queued++;}}}if(size===0){percent=files.length>0?Math.ceil(uploaded/files.length*100):0;
}else{bitrate=Math.ceil(loaded/((+new Date()-startTime||1)/1000));percent=Math.ceil(loaded/size*100);
}this.setProperty("size",size);this.setProperty("loaded",loaded);this.setProperty("uploaded",uploaded);
this.setProperty("failed",failed);this.setProperty("queued",queued);this.setProperty("percent",percent);
this.setProperty("bitrate",bitrate);}function nextQueue(file){var files=this.$files.toArray();
if(this.state&constants.STARTED&&fileIndex<files.length){file=files[fileIndex++];
if(file.status&constants.QUEUED){this.$method.upload(file);}else{nextQueue.call(this);
}}else{if(!(this.state&constants.STOPPED)){this.dispatchEvent("uploaded",{files:files});
this.stop();}}}this.$buildUrl=function(url,items){var query="";for(var i in items){query+=(query?"&":"")+encodeURIComponent(i)+"="+encodeURIComponent(items[i]);
}if(query){url+=(url.indexOf("?")>0?"&":"?")+query;}return url;};this.$queue=function(selected_files){var i,l,file,extensionsMap,count=0;
if(l=this.$filter.length){extensionsMap={};for(i=0;i<l;++i){extensionsMap[this.$filter[i].toLowerCase()]=true;
}}if((l=selected_files.length)>1&&!this.multiple){selected_files=[selected_files[0]],l=1;
}for(i=0;i<l;++i){file=selected_files[i];file.loaded=0;file.percent=0;file.status=constants.QUEUED;
if(extensionsMap&&!extensionsMap[file.name.toLowerCase().split(".").slice(-1)]){this.dispatchEvent("error",{code:constants.ERROR.FILE_EXTENSION_ERROR,message:"File extension error.",file:file});
continue;}if(typeof file.size!="undefined"&&file.size>this.maxfilesize){this.dispatchEvent("error",{code:constants.ERROR_CODES.FILE_SIZE_ERROR,message:"File size error.",file:file});
continue;}if(!this.multiple){this.$files.reset();}this.$files.create(file);count++;
}this.dispatchEvent("queue",{files:selected_files});if(count){calc.call(this);if(this.$method.refresh){this.$method.refresh();
}}};this.$triggerCalc=function(){calc.call(this);};this.$progress=function(file){if(file.status&constants.QUEUED){file.status=constants.UPLOADING;
}file.percent=file.size>0?Math.ceil(file.loaded/file.size*100):100;this.$files.update(file);
calc.call(this);};this.$fileDone=function(file,e){file.status=constants.DONE;file.response=e.response;
this.$progress(file);nextQueue.call(this,file);};this.$fileRemove=function(file){if(this.$method.removeFile){this.$method.removeFile(file);
}this.$files.remove(file);calc.call(this);};this.$draw=function(){if(!this.$method.draw){return;
}var parentVis=true,p=this.parentNode;while((parentVis=typeof p.visible=="undefined"?true:p.visible)&&p!=apf.document.documentElement){p=p.parentNode;
}if(!parentVis){var f,_self=this;p.addEventListener("prop.visible",f=function(e){if(!e.value){return;
}if(_self.$method.refresh){_self.$method.refresh();}p.removeEventListener("prop.visible",f);
});}p=this.parentNode;while(p.$layout){p=p.parentNode;}this.$pHtmlNode=p;this.$ext=p.$int.appendChild(p.$int.ownerDocument.createElement("div"));
this.$method.draw();};var states={buttonEnter:"Over",buttonLeave:"Out",buttonDown:"Down"};
this.$setButtonState=function(state){if(!this.$button){return null;}if(state=="buttonDisabled"){return this.$button.setProperty("disabled",true);
}else{if(this.$button.disabled){this.$button.setProperty("disabled",false);}}return this.$button.$setState(states[state]);
};this.start=function(){if(!(this.state&constants.STARTED)){fileIndex=0;this.setProperty("state",constants.STARTED);
nextQueue.call(this);}};this.stop=function(){if(!(this.state&constants.STOPPED)){this.setProperty("state",constants.STOPPED);
this.setProperty("bitrate",0);}};this.formatSize=function(bytes,precision){var test,res=null;
["B","kB","mB","gB"].forEach(function(size,index){test=bytes/Math.pow(1024,index);
if(Math.floor(test)<=1024&&!res){res=test.toFixed(precision||0)+size;}});return res;
};this.addEventListener("error",function(e){if(e.file){e.file.status=constants.FAILED;
calc.call(this);var _self=this;$setTimeout(function(){nextQueue.call(_self);});
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!this.$files){this.$files=new constants.files(this,"apfupload".appendRandomNumber(5));
}if(!this.$button){throw new Error(apf.formatErrorString(0,this,"upload init","Required: 'button' attribute not set, no button element available."));
}if(!this.target){throw new Error(apf.formatErrorString(0,this,"upload init","Required: 'target' attribute not set, thus no valid uri to send files to."));
}if(!this.$method){return;}var _self=this;$setTimeout(function(){calc.call(_self);
if(_self.$method.refresh){_self.$method.refresh();$setTimeout(function(){_self.$method.refresh();
},1000);}});});}).call(apf.upload.prototype=new apf.GuiElement(),apf.upload);apf.upload.files=function(oUpload,model){if(typeof model=="string"){var sModel=model;
if(!(model=apf.nameserver.get(sModel))){model=apf.setReference(sModel,apf.nameserver.register("model",sModel,new apf.model()));
if(model===0){model=self[sModel];}else{model.id=model.name=sModel;}}}if(!model){throw new Error(apf.formatErrorString(0,oUpload,"upload","For the upload control to work, you MUST specify a valid value for the 'model' attribute!"));
}var oFiles={},aFiles=[],_self=this,userProps={addDate:1,creationDate:1,extension:1,id:1,modificationDate:1,name:1,size:1,status:1,validationError:1,loaded:1};
model.load("<files/>");model.addEventListener("update",function(e){if(e.action=="add"||e.action=="synchronize"){return;
}var id=e.xmlNode.getAttribute("id");if(e.action=="remove"){_self.remove({id:id},true);
oUpload.$triggerCalc();}});this.create=function(file){if(!file||!file.id||oFiles[file.id]){return null;
}oFiles[file.id]=file;aFiles.pushUnique(file);if(model){file.xml=model.data.ownerDocument.createElement("file");
apf.xmldb.appendChild(model.data,file.xml);}return this.update(file);};this.createMany=function(arr){if(!arr||!arr.length){return;
}for(var i=0,l=arr.length;i<l;i++){if(arr[i]){this.create(arr[i]);}}};this.read=function(filename){};
this.update=function(file){if(!file||!file.id){return null;}var i;if(!file.xml){var t=file;
file=oFiles[file.id];for(i in userProps){file[i]=t[i];}}if(!model||!file.xml){return null;
}for(i in userProps){if(typeof file[i]=="undefined"){continue;}if(i.indexOf("Date")!=-1&&typeof file[i]=="number"){file[i]=new Date(file[i]);
}file.xml.setAttribute(i,file[i]);}apf.xmldb.applyChanges("synchronize",file.xml);
return file;};this.remove=function(file,noXml){if(!file||!file.id||!oFiles[file.id]){return;
}file=oFiles[file.id];if(model&&file.xml&&!noXml){apf.xmldb.removeNode(file.xml);
}aFiles.remove(file);delete oFiles[file.id];};this.removeMany=function(arr,noXml){if(!arr||!arr.length){return;
}for(var i=0,l=arr.length;i<l;i++){if(arr[i]){this.remove(arr[i],noXml);}}};this.get=function(){var l;
if(l=arguments.length){if(l===1){return oFiles[arguments[0]];}var res={},i=0;for(;
i<l;++i){if(oFiles[i]){res[oFiles[i].id]=oFiles[i];}}return res;}return oFiles;
};this.toArray=function(){return aFiles;};this.getValue=function(){var i,a=[];for(i in oFiles){a.push(oFiles[i].name);
}return a.join("|");};this.reset=function(){model.load("<files/>");oFiles={};aFiles=[];
};};apf.aml.setElement("upload",apf.upload);apf.video=function(struct,tagName){this.$init(tagName||"video",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$booleanProperties.fullscreen=true;
var oldStyle=null;this.$propHandlers.fullscreen=function(value){if(!this.player){return;
}if(typeof this.player.setFullscreen=="function"){this.player.setFullscreen(value);
}else{if(this.parentNode&&this.parentNode.tagName!="application"&&this.parentNode.setWidth){var i,node,oParent=this.parentNode.$ext;
if(value){oldStyle={width:this.parentNode.getWidth(),height:this.parentNode.getHeight(),top:this.parentNode.getTop(),left:this.parentNode.getLeft(),position:apf.getStyle(oParent,"position"),zIndex:apf.getStyle(oParent,"zIndex"),resizable:this.parentNode.resizable,nodes:[]};
if(oParent!=document.body){while(oParent.parentNode!=document.body){var node=oParent.parentNode;
i=oldStyle.nodes.push({pos:apf.getSyle(node,"position")||"",top:apf.getSyle(node,"top")||node.offsetTop+"px",left:apf.getSyle(node,"left")||node.offsetLeft+"px",node:node})-1;
node.style.position="absolute";node.style.top="0";node.style.left="0";}}this.parentNode.$ext.style.position="absolute";
this.parentNode.$ext.style.zIndex="1000000";this.parentNode.setWidth("100%");this.parentNode.setHeight("100%");
this.parentNode.setTop("0");this.parentNode.setLeft("0");if(this.parentNode.resizable){this.parentNode.setAttribute("resizable",false);
}}else{if(oldStyle){var coll;if(oldStyle.nodes.length){for(i=oldStyle.nodes.length-1;
i>=0;i--){coll=oldStyle.nodes[i];node=coll.node;node.style.position=coll.pos;node.style.top=coll.top;
node.style.left=coll.left;}}this.parentNode.$ext.style.zIndex=oldStyle.zIndex;this.parentNode.$ext.style.position=oldStyle.position;
this.parentNode.setWidth(oldStyle.width);this.parentNode.setHeight(oldStyle.height);
this.parentNode.setTop(oldStyle.top);this.parentNode.setLeft(oldStyle.left);if(oldStyle.resizable){this.parentNode.setAttribute("resizable",true);
}oldStyle=null;delete oldStyle;}}if(this.player.onAfterFullscreen){this.player.onAfterFullscreen(value);
}var _self=this;window.setTimeout(function(){apf.layout.forceResize(_self.parentNode.$ext);
},100);}}};this.addEventListener("keydown",function(e){switch(e.keyCode){case 13&&(e.ctrlKey||e.altKey):case 70:this.setPropery("fullscreen",true);
return false;break;case 80:this.setProperty("paused",!this.paused);return false;
break;case 27:this.setProperty("fullscreen",false);return false;break;default:break;
}},true);this.$mainBind="src";this.loadMedia=function(){if(this.player){this.setProperty("currentSrc",this.src);
this.setProperty("networkState",apf.Media.NETWORK_LOADING);this.player.load(this.src);
}return this;};this.seek=function(iTo){if(this.player&&iTo>=0&&iTo<=this.duration){this.player.seek(iTo);
}};this.setVolume=function(iVolume){if(this.player){this.player.setVolume(iVolume);
}};var typesQT="mov",typesFLV="flv",typesWMP="asf|asx|avi|wmv",typesNtv="ogg",typesVLC="3gp|3gpp|3g2|3gpp2|divx|mp4|mpg4|mpg|mpeg|mpe|ogg|vob";
this.$guessType=function(path){var ext=path.substr(path.lastIndexOf(".")+1),type="";
if(typesQT.indexOf(ext)!=-1){type="video/quicktime";}else{if(typesFLV.indexOf(ext)!=-1){type="video/flv";
}else{if(typesWMP.indexOf(ext)!=-1){type="video/wmv";}else{if(typesNtv.indexOf(ext)!=-1&&apf.hasVideo){type="video/ogg";
}else{if(typesVLC.indexOf(ext)!=-1){type="video/vlc";}}}}}if(ext=="mpg"||ext=="mpeg"||ext=="mpe"){type=apf.isMac?"video/quicktime":"video/wmv";
}if(!apf.isWin&&!apf.isMac&&type=="video/wmv"){type="video/vlc";}return type;};
this.$getPlayerType=function(mimeType){if(!mimeType){return null;}var playerType=null;
var aMimeTypes=mimeType.splitSafe(",");if(aMimeTypes.length==1){aMimeTypes=aMimeTypes[0].splitSafe(";");
}for(var i=0;i<aMimeTypes.length;i++){mimeType=aMimeTypes[i];if(mimeType.indexOf("ogg")>-1){playerType="TypeNative";
}else{if(mimeType.indexOf("flv")>-1){playerType="TypeFlv";}else{if(mimeType.indexOf("quicktime")>-1){playerType="TypeQT";
}else{if(mimeType.indexOf("wmv")>-1){playerType="TypeWmp";}else{if(mimeType.indexOf("silverlight")>-1){playerType="TypeSilverlight";
}else{if(mimeType.indexOf("vlc")>-1){playerType="TypeVlc";}}}}}}if(playerType=="TypeWmp"){if(!apf.isIE&&typeof apf.video.TypeVlc!="undefined"&&apf.video.TypeVlc.isSupported()){playerType="TypeVlc";
}else{if(apf.isMac){playerType="TypeQT";}}}if(playerType&&apf.video[playerType]&&apf.video[playerType].isSupported()){this.$lastMimeType=i;
return playerType;}}this.$lastMimeType=-1;return null;};this.$isSupported=function(sType){sType=sType||this.playerType;
return(apf.video[sType]&&apf.video[sType].isSupported());};this.$initPlayer=function(){this.player=new apf.video[this.playerType](this,this.$ext,{src:this.src.splitSafe(",")[this.$lastMimeType]||this.src,width:this.width,height:this.height,autoLoad:true,autoPlay:this.autoplay,showControls:this.controls,volume:this.volume,mimeType:this.type});
return this;};this.$initHook=function(){this.loadMedia();};this.$cuePointHook=function(){};
this.$playheadUpdateHook=function(){};this.$errorHook=function(e){apf.console.error(e.error);
};this.$progressHook=function(e){this.setProperty("bufferedBytes",{start:0,end:e.bytesLoaded});
this.setProperty("totalBytes",e.totalBytes);var iDiff=Math.abs(e.bytesLoaded-e.totalBytes);
if(iDiff<=20){this.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);}};this.$stateChangeHook=function(e){if(e.state=="loading"){this.setProperty("networkState",this.networkState=apf.Media.NETWORK_LOADING);
}else{if(e.state=="connectionError"){this.$propHandlers.readyState.call(this,this.networkState=apf.Media.HAVE_NOTHING);
}else{if(e.state=="playing"||e.state=="paused"){if(e.state=="playing"){this.$readyHook({type:"ready"});
}this.paused=Boolean(e.state=="paused");this.setProperty("paused",this.paused);
}else{if(e.state=="seeking"){this.seeking=true;this.setProperty("seeking",true);
}}}}};this.$changeHook=function(e){if(typeof e.volume!="undefined"){this.volume=e.volume;
if(!this.muted){this.setProperty("volume",this.volume);}}else{this.duration=this.player.getTotalTime();
this.position=e.playheadTime/this.duration;if(isNaN(this.position)){return;}this.setProperty("position",this.position);
this.currentTime=e.playheadTime;this.setProperty("currentTime",this.currentTime);
}};this.$completeHook=function(e){this.paused=true;this.setProperty("paused",true);
};this.$readyHook=function(e){this.setProperty("networkState",apf.Media.NETWORK_LOADED);
this.setProperty("readyState",apf.Media.HAVE_FUTURE_DATA);this.setProperty("duration",this.player.getTotalTime());
this.seeking=false;this.seekable=true;this.setProperty("seeking",false);return this;
};this.$metadataHook=function(e){this.oVideo.setProperty("readyState",apf.Media.HAVE_METADATA);
};this.stopListening=function(){if(!this.player){return this;}return this;};this.$draw=function(){this.$ext=this.$getExternal();
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.$int=this.$getLayoutNode("main","container",this.$ext);
this.width=parseInt(this.width)||null;this.height=parseInt(this.height)||null;});
this.addEventListener("AMLMediaReady",function(){if(this.setSource()){this.$propHandlers.type.call(this,this.type);
}});this.$destroy=function(bRuntime){if(this.player&&this.player.$destroy){this.player.$destroy();
}delete this.player;this.player=null;if(bRuntime){this.$ext.innerHTML="";}};}).call(apf.video.prototype=new apf.Media());
apf.aml.setElement("video",apf.video);apf.video.TypeInterface={properties:["src","width","height","volume","showControls","autoPlay","totalTime","mimeType"],setOptions:function(options){if(options==null){return this;
}var hash=this.properties;for(var i=0;i<hash.length;i++){var prop=hash[i];if(options[prop]==null){continue;
}this[prop]=options[prop];}return this;},getElement:function(id){var elem;if(typeof id=="object"){return id;
}if(apf.isIE){return window[id];}else{elem=document[id]?document[id]:document.getElementById(id);
if(!elem){elem=apf.lookup(id);}return elem;}}};apf.viewport=function(struct,tagName){this.$init(tagName||"viewport",apf.NODE_VISIBLE,struct);
if(document.documentElement){this.$ext=this.$int=document.documentElement.appendChild(document.createElement("div"));
}};(function(){this.$focussable=false;this.$draw=function(){if(!this.$ext){this.$ext=this.$int=document.documentElement.appendChild(document.createElement("div"));
}};this.$loadAml=function(x){};}).call(apf.viewport.prototype=new apf.AmlElement());
apf.aml.setElement("viewport",apf.viewport);apf.webdav=function(struct,tagName){this.$init(tagName||"webdav",apf.NODE_HIDDEN,struct);
this.$locks={};this.$lockedStack=[];this.$lockId=0;this.$serverVars={};this.$fsCache={};
};(function(){this.useHTTP=true;this.method="GET";this.$showHidden=false;this.$booleanProperties.showhidden=true;
this.$supportedProperties.push("showhidden");this.$propHandlers.showhidden=function(value){this.$showHidden=value;
};this.$regVar=function(name,value){this.$serverVars[name]=value;return value;};
function unregister(){for(var i=0;i<arguments.length;i++){if(typeof this.$serverVars[arguments[i]]!="undefined"){this.$serverVars[arguments[i]]=null;
delete this.$serverVars[arguments[i]];}}}this.$getVar=function(name){return this.$serverVars[name]||"";
};this.doRequest=function(fCallback,sPath,sBody,oHeaders,bUseXml,oBinary,fCallback2){if(!this.$getVar("authenticated")){return onAuth.call(this,{method:this.doRequest,context:this,args:arguments});
}if(bUseXml){if(!oHeaders){oHeaders={};}oHeaders["Content-type"]="text/xml; charset=utf-8";
}var _self=this;return this.get(sPath||this.$server,{callback:function(data,state,extra){if(state!=apf.SUCCESS){var oError;
oError=WebDAVError.call(_self,"Url: "+extra.url+"\nInfo: "+extra.message);if(fCallback){return fCallback.call(_self,data,state,extra,fCallback2);
}else{throw oError;}}extra.headers=oHeaders;var iStatus=parseInt(extra.status);
if(iStatus==401){return;}var sResponse=(extra.http.responseText||"");if(sResponse.replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")!=""&&sResponse.indexOf("<?xml version=")==0){try{data=(extra.http.responseXML&&extra.http.responseXML.documentElement)?apf.xmlParseError(extra.http.responseXML):apf.getXmlDom(extra.http.responseText);
if(!apf.supportNamespaces){data.setProperty("SelectionLanguage","XPath");}data=data.documentElement;
extra.data=data;}catch(e){if(fCallback){return fCallback.call(_self,data,state,extra,fCallback2);
}else{throw WebDAVError.call(_self,"Received invalid XML\n\n"+e.message);}}}if(typeof fCallback=="function"){fCallback.call(_self,data,state,extra,fCallback2);
}},nocache:false,useXML:false,ignoreOffline:true,data:sBody||"",binary:oBinary||false,headers:oHeaders,username:this.$getVar("auth-username")||null,password:this.$getVar("auth-password")||null});
};function notAuth(msg){unregister.call(this,"auth-password");var extra={username:this.$getVar("auth-username"),server:this.$server,message:msg||"Access denied. Please check you username or password."};
var cb=this.$getVar("auth-callback");if(cb){cb(null,apf.ERROR,extra);unregister.call(this,"auth-callback");
}try{apf.console.error(extra.message.toString()+" (username: "+extra.username+", server: "+extra.server+")","webdav");
}catch(ex){}return this.dispatchEvent("authfailure",extra);}function connError(msg){unregister.call(this,"auth-password");
var extra={username:this.$getVar("auth-username"),server:this.$server,message:msg||"Could not connect to server, please contact your System Administrator."};
var cb=this.$getVar("auth-callback");if(cb){cb(null,apf.ERROR,extra);unregister.call(this,"auth-callback");
}apf.console.error(extra.message+" (username: "+extra.username+", server: "+extra.server+")","webdav");
return this.dispatchEvent("connectionerror",extra);}function WebDAVError(sMsg){return new Error(apf.formatErrorString(0,this,"WebDAV Communication error",sMsg));
}function onAuth(callback){var oDoc,authRequired=false;if(apf.isIE){try{oDoc=new ActiveXObject("Msxml2.DOMDocument");
}catch(e){}}else{if(document.implementation&&document.implementation.createDocument){try{oDoc=document.implementation.createDocument("","",null);
}catch(e){}}}try{if(apf.isIE){oDoc.async=false;oDoc.load(this.$rootPath);}}catch(e){authRequired=true;
}var auth=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(authRequired){auth.authRequired(callback);
}else{this.$regVar("authenticated",true);if(callback&&callback.method){callback.method.apply(callback.context,callback.args);
}}}this.authenticate=function(username,password,callback){this.$regVar("auth-username",username);
this.$regVar("auth-password",password);this.$regVar("auth-callback",callback);var auth=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}this.doRequest(function(data,state,extra){if(extra.status==401){return auth.authRequired();
}this.$regVar("authenticated",true);var cb=this.$getVar("auth-callback");if(cb){cb(null,state,extra);
unregister.call(this,"auth-callback");}},this.$rootPath,null,{},false,null);};this.reset=function(){unregister.call(this,"authenticated");
unregister.call(this,"auth-username");unregister.call(this,"auth-password");unregister.call(this,"auth-callback");
};this.exists=function(sPath,callback){this.getProperties(sPath,0,function(data,state,extra){callback(state===apf.SUCCESS);
});};this.readFile=this.read=function(sPath,callback){this.method="GET";this.doRequest(function(data,state,extra){var iStatus=parseInt(extra.status);
if(iStatus==403){var oError=WebDAVError.call(this,"Unable to read file. Server says: "+apf.webdav.STATUS_CODES["403"]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}else{callback?callback.call(this,extra.http.responseText,state,extra):this.dispatchEvent("onfilecontents",{data:extra.http.responseTex});
}},sPath);};this.readdir=function(sPath,callback){if(sPath.charAt(sPath.length-1)!="/"){sPath+="/";
}return this.getProperties(sPath,1,callback);};this.mkdir=function(sPath,bLock,callback){if(bLock){var oLock=this.lock(sPath);
if(!oLock.token){return updateLockedStack.call(this,oLock,"mkdir",arguments);}}var _self=this;
this.method="MKCOL";this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sPath);
var iStatus=parseInt(extra.status);if(iStatus==201){_self.readdir(sPath.substr(0,sPath.lastIndexOf("/")),callback);
}else{if(iStatus==400||iStatus==403||iStatus==405||iStatus==409||iStatus==415||iStatus==507){var oError=WebDAVError.call(this,"Unable to create directory '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&callback){callback(oError);
}}}},sPath,null,bLock&&oLock.token?{If:"<"+oLock.token+">"}:null,true);};this.list=function(sPath,callback){return this.getProperties(sPath,0,callback);
};this.writeFile=this.write=function(sPath,sContent,bLock,oBinary,callback){if(bLock){var oLock=this.lock(sPath);
if(!oLock.token){return updateLockedStack.call(this,oLock,"write",arguments);}}if(typeof callback=="undefined"&&typeof oBinary=="function"){callback=oBinary;
oBinary=null;}this.method="PUT";var _self=this;this.doRequest(function(data,state,extra){var iStatus=parseInt(extra.status);
if(state!=apf.SUCCESS){var oError=WebDAVError.call(this,"Unable to write to file. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}callback&&callback.call(this,data,apf.ERROR,extra);}else{_self.getProperties(sPath,0,callback);
}},sPath,sContent,bLock&&oLock.token?{If:"<"+oLock.token+">"}:null,null,oBinary);
};this.copy=function(sFrom,sTo,bOverwrite,bLock,callback){if(!sTo||sFrom==sTo){return(callback&&callback("",apf.SUCCESS,{}));
}if(bLock){var oLock=this.lock(sFrom);if(!oLock.token){return updateLockedStack.call(this,oLock,"copy",arguments);
}}this.method="COPY";var oHeaders={Destination:sTo||this.$server};if(typeof bOverwrite=="undefined"){bOverwrite=true;
}if(!bOverwrite){oHeaders.Overwrite="F";}if(bLock&&oLock.token){oHeaders.If="<"+oLock.token+">";
}this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sFrom);
var iStatus=parseInt(extra.status);if(iStatus==400||iStatus==403||iStatus==409||iStatus==412||iStatus==423||iStatus==424||iStatus==502||iStatus==507){var oError=WebDAVError.call(this,"Unable to copy file '"+sFrom+"' to '"+sTo+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}callback&&callback.call(this,data,state,extra);}else{this.getProperties(sTo,0,callback);
}},sFrom,null,oHeaders);};this.rename=this.move=function(sFrom,sTo,bOverwrite,bLock,callback){if(!sTo||sFrom==sTo){return(callback&&callback("",apf.SUCCESS,{}));
}if(bLock){var oLock=this.lock(sFrom);if(!oLock.token){return updateLockedStack.call(this,oLock,"move",arguments);
}}this.method="MOVE";var oHeaders={Destination:sTo||this.$server};if(typeof bOverwrite=="undefined"){bOverwrite=true;
}if(!bOverwrite){oHeaders.Overwrite="F";}if(bLock&&oLock.token){oHeaders.If="<"+oLock.token+">";
}this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sFrom);
var iStatus=parseInt(extra.status);if(iStatus==400||iStatus==403||iStatus==409||iStatus==412||iStatus==423||iStatus==424||iStatus==502||iStatus==500){var oError=WebDAVError.call(this,"Unable to move file '"+sFrom+"' to '"+sTo+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}else{if(this.$fsCache[sFrom]){this.$fsCache[sTo]=this.$fsCache[sFrom];this.$fsCache[sTo].path=sTo;
delete this.$fsCache[sFrom];}}callback&&callback.call(this,data,state,extra);},sFrom,null,oHeaders);
};this.remove=function(sPath,bLock,callback){if(bLock){var oLock=this.lock(sPath);
if(!oLock.token){return updateLockedStack.call(this,oLock,"remove",arguments);}}this.method="DELETE";
this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sPath);
var iStatus=parseInt(extra.status);if(iStatus==400||iStatus==423||iStatus==424){var oError=WebDAVError.call(this,"Unable to remove file '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}callback&&callback.call(this,data,state,extra);},sPath,null,bLock&&oLock.token?{If:"<"+oLock.token+">"}:null);
};this.report=function(sPath,reportName,oProperties,callback){var aCont=['<?xml version="1.0" encoding="utf-8" ?>',"<D:"+reportName+' xmlns:D="',apf.webdav.NS.D,'">'];
if(oProperties){for(var prop in oProperties){aCont.push("<D:"+prop,(oProperties[prop]?">"+apf.xmlentities(apf.escapeXML(oProperties[prop]))+"</D:"+prop+">":"/>"));
}}aCont.push("</D:",reportName,">");this.method="REPORT";this.doRequest(function(data,state,extra){var iStatus=parseInt(extra.status);
if(state!=apf.SUCCESS){var oError=WebDAVError.call(this,"Unable to fetch report on '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}callback&&callback.call(this,data,state,extra);},sPath,aCont.join(""));};this.lock=function(sPath,iDepth,iTimeout,sLock,callback){var oLock=this.$locks[sPath];
if(oLock&&oLock.token){return oLock;}this.method="LOCK";iTimeout=iTimeout?"Infinite, Second-4100000000":"Second-"+iTimeout;
var oHeaders={Timeout:iTimeout};if(iDepth){oHeaders.Depth=iDepth||"Infinity";}if(sLock){oHeaders.If="<"+sLock+">";
}var xml='<?xml version="1.0" encoding="utf-8"?><D:lockinfo xmlns:D="'+apf.webdav.NS.D+'"><D:lockscope><D:exclusive /></D:lockscope><D:locktype><D:write /></D:locktype><D:owner><D:href>'+document.location.toString().escapeHTML()+ +"</D:href></D:owner></D:lockinfo>";
this.doRequest(registerLock,sPath,xml,oHeaders,true,null,callback);return newLock.call(this,sPath);
};this.unlock=function(oLock,callback){if(typeof oLock=="string"){oLock=this.$locks[oLock];
}if(!oLock||!oLock.token){return;}this.method="UNLOCK";this.doRequest(function(data,state,extra){unregisterLock.call(this,extra.url.replace(this.$server,""));
},oLock.path,null,{"Lock-Token":"<"+oLock.token+">"},true,callback);};function newLock(sPath){return this.$locks[sPath]={path:sPath,id:this.$lockId++,token:null};
}function registerLock(data,state,extra){var iStatus=parseInt(extra.status),sPath=extra.url.replace(this.$server,""),oLock=this.$locks[sPath]||newLock.call(this,sPath);
if(iStatus==400||iStatus==409||iStatus==423||iStatus==412){unregisterLock.call(this,extra.url.replace(this.$server,""));
var oError=WebDAVError.call(this,"Unable to apply lock to '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false){throw oError;
}}var NS=apf.webdav.NS,oOwner=$xmlns(data,"owner",NS.ns0)[0],oToken=$xmlns(data,"locktoken",NS.D)[0];
oLock.path=sPath;oLock.type="write";oLock.scope=$xmlns(data,"exclusive",NS.D).length?"exclusive":"shared";
oLock.depth=$xmlns(data,"depth",NS.D)[0].firstChild.nodeValue;oLock.owner=$xmlns(oOwner,"href",NS.ns0)[0].firstChild.nodeValue;
oLock.timeout=$xmlns(data,"timeout",NS.D)[0].firstChild.nodeValue;oLock.token=$xmlns(oToken,"href",NS.D)[0].firstChild.nodeValue.split(":")[1];
purgeLockedStack.call(this,oLock);}function unregisterLock(sPath){var oLock=this.$locks[sPath];
if(!oLock){return;}purgeLockedStack.call(this,oLock,true);this.$locks[sPath]=oLock=null;
delete this.$locks[sPath];}function updateLockedStack(oLock,sFunc,aArgs){return this.$lockedStack.push({lockId:oLock.id,func:sFunc,args:aArgs});
}function purgeLockedStack(oLock,bFailed){for(var i=this.$lockedStack.length-1;
i>=0;i--){if(this.$lockedStack[i].lockId!=oLock.id){continue;}if(!bFailed){this[this.$lockedStack[i].func].apply(this,this.$lockedStack[i].args);
}this.$lockedStack.remove(i);}}this.getProperties=function(sPath,iDepth,callback,oHeaders){this.method="PROPFIND";
var xml='<?xml version="1.0" encoding="utf-8" ?><D:propfind xmlns:D="'+apf.webdav.NS.D+'"><D:allprop /></D:propfind>';
oHeaders=oHeaders||{};oHeaders.Depth=typeof iDepth!="undefined"?iDepth:1;this.doRequest(parsePropertyPackets,sPath,xml,oHeaders,true,null,callback);
};this.setProperties=function(sPath,oPropsSet,oPropsDel,sLock){this.method="PROPPATCH";
this.doRequest(function(data,state,extra){apf.console.dir(data);},sPath,buildPropertiesBlock.call(this,oPropsSet,oPropsDel),sLock?{If:"<"+sLock+">"}:null,true);
};function buildPropertiesBlock(oPropsSet,oPropsDel){var aOut=['<?xml version="1.0" encoding="utf-8" ?>','<D:propertyupdate xmlns:D="',apf.webdav.NS.D,'">'];
var bHasProps=false,ns,i,j;for(ns in oPropsSet){bHasProps=true;break;}if(bHasProps){aOut.push("<D:set>");
for(ns in oPropsSet){for(i in oPropsSet[ns]){aOut.push("<D:prop>",oPropsSet[ns][i],"</D:prop>");
}}aOut.push("</D:set>");}bHasProps=false;for(ns in oPropsDel){bHasProps=true;break;
}if(bHasProps){aOut.push("<D:remove><D:prop>");for(ns in oPropsDel){for(i=0,j=oPropsDel[ns].length;
i<j;i++){aOut.push("<",oPropsDel[ns][i],' xmlns="',ns,'"/>');}}aOut.push("</D:prop></D:remove>");
}aOut.push("</D:propertyupdate>");return aOut.join("");}function parsePropertyPackets(oXml,state,extra,callback){var status=parseInt(extra.status);
if(status==403||status==401||!oXml){return callback?callback.call(this,null,state,extra):notAuth.call(this);
}if(typeof oXml=="string"){oXml=apf.getXml(oXml);}var aResp=$xmlns(oXml,"response",apf.webdav.NS.D),aOut=[];
if(aResp.length){this.$regVar("authenticated",true);}var start=(extra.headers&&typeof extra.headers.Depth!="undefined"&&extra.headers.Depth==0)?0:1;
for(var i=start,j=aResp.length;i<j;i++){aOut.push(parseItem.call(this,aResp[i]));
}callback&&callback.call(this,"<files>"+aOut.join("")+"</files>",state,extra);}function parseItem(oNode){var NS=apf.webdav.NS,sPath=decodeURIComponent($xmlns(oNode,"href",NS.D)[0].firstChild.nodeValue.replace(/[\\\/]+$/,"")),sName=sPath.split("/").pop(),bHidden=(sName.charAt(0)==".");
if(!this.$showHidden&&bHidden){return"";}var t,oItem,sType=$xmlns(oNode,"collection",NS.D).length>0?"folder":"file",aCType=$xmlns(oNode,"getcontenttype",NS.D),aExec=$xmlns(oNode,"executable",NS.lp2);
oItem=this.$fsCache[sPath]=apf.extend(this.$fsCache[sPath]||{},{path:sPath,type:sType,size:parseInt(sType=="file"?(t=$xmlns(oNode,"getcontentlength",NS.lp1)).length?t[0].firstChild.nodeValue:0:0),name:sName,contentType:(sType=="file"&&aCType.length?aCType[0].firstChild.nodeValue:""),creationDate:(t=$xmlns(oNode,"creationdate",NS.lp1)).length?t[0].firstChild.nodeValue:"",lastModified:(t=$xmlns(oNode,"getlastmodified",NS.lp1)).length?t[0].firstChild.nodeValue:"",etag:(t=$xmlns(oNode,"getetag",NS.lp1)).length?t[0].firstChild.nodeValue:"",lockable:($xmlns(oNode,"locktype",NS.D).length>0),executable:(aExec.length>0&&aExec[0].firstChild.nodeValue=="T")});
return oItem.xml="<"+sType+" path='"+sPath+"'  type='"+sType+"' size='"+oItem.size+"' name='"+oItem.name+"' contenttype='"+oItem.contentType+"' modifieddate='"+oItem.lastModified+"' creationdate='"+oItem.creationDate+"' lockable='"+oItem.lockable.toString()+"' hidden='"+bHidden.toString()+"' executable='"+oItem.executable.toString()+"'/>";
}this.exec=function(method,args,callback){var cb=function(data,state,extra){extra.originalArgs=args;
if(typeof args[args.length-1]=="function"){args[args.length-1](data,state,extra);
}callback&&callback(data,state,extra);};switch(method){case"login":case"authenticate":this.authenticate(args[0],args[1],cb);
break;case"logout":this.reset();break;case"exists":this.exists(args[0],cb);break;
case"read":this.readFile(args[0],cb);break;case"create":var path=args[0]?args[0]:"";
if(path.charAt(path.length-1)!="/"){path=path+"/";}this.writeFile(path+args[1],args[2],args[3]||false,cb);
break;case"write":case"store":case"save":this.writeFile(args[0],args[1],args[2]||false,cb);
break;case"copy":case"cp":this.copy(args[0],args[1],args[2]||true,args[3]||false,cb);
break;case"rename":var sBasepath=args[1].substr(0,args[1].lastIndexOf("/")+1);this.rename(args[1],sBasepath+args[0],args[2]||false,args[3]||false,cb);
break;case"move":case"mv":path=args[1];if(path.charAt(path.length-1)!="/"){path=path+"/";
}this.rename(args[0],path+args[0].substr(args[0].lastIndexOf("/")+1),args[2]||false,args[3]||false,cb);
break;case"remove":case"rmdir":case"rm":this.remove(args[0],args[1]||false,cb);
break;case"readdir":case"scandir":this.readdir(args[0],cb);break;case"getroot":this.getProperties(this.$rootPath,0,cb);
break;case"mkdir":path=args[0]?args[0]:"";if(path.charAt(path.length-1)!="/"){path=path+"/";
}this.mkdir(path+args[1],args[2]||false,cb);break;case"lock":this.lock(args[0],null,null,null,cb);
break;case"unlock":this.unlock(args[0],cb);break;case"report":this.report(args[0],args[1],args[2],cb);
break;default:throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Invalid WebDAV method '"+method+"'"));
break;}};}).call(apf.webdav.prototype=new apf.Teleport());apf.aml.setElement("webdav",apf.webdav);
apf.webdav.NS={D:"DAV:",ns0:"DAV:",lp1:"DAV:",lp2:"http://apache.org/dav/props/"};
apf.webdav.STATUS_CODES={"100":"Continue","101":"Switching Protocols","102":"Processing","200":"OK","201":"Created","202":"Accepted","203":"None-Authoritive Information","204":"No Content","1223":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Time-out","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Request Entity Too Large","414":"Request-URI Too Large","415":"Unsupported Media Type","416":"Requested range not satisfiable","417":"Expectation Failed","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Time-out","505":"HTTP Version not supported","507":"Insufficient Storage"};
apf.xmpp=function(struct,tagName){this.$init(tagName||"xmpp",apf.NODE_HIDDEN,struct);
this.$serverVars={};this.$reqCount=0;this.$reqStack=[];this.$listening=false;this.$listener=null;
this.$sAJAX_ID=this.$makeUnique("ajaxRDB");this.$retryCount=0;this.$RID=null;this.$activeReq=null;
};(function(){var constants={NS:{sasl:"urn:ietf:params:xml:ns:xmpp-sasl",httpbind:"http://jabber.org/protocol/httpbind",feature_reg:"http://jabber.org/features/iq-register",bosh:"urn:xmpp:xbosh",time:"urn:xmpp:time",jabber:"jabber:client",bind:"urn:ietf:params:xml:ns:xmpp-bind",session:"urn:ietf:params:xml:ns:xmpp-session",auth:"jabber:iq:auth",roster:"jabber:iq:roster",register:"jabber:iq:register",datastatus:"jabber:iq:rdbstatus",data:"jabber:x:data",stream:"http://etherx.jabber.org/streams",disco_info:"http://jabber.org/protocol/disco#info",disco_items:"http://jabber.org/protocol/disco#items",muc:"http://jabber.org/protocol/muc",muc_user:"http://jabber.org/protocol/muc#user",muc_owner:"http://jabber.org/protocol/muc#owner",muc_admin:"http://jabber.org/protocol/muc#admin",commands:"http://jabber.org/protocol/commands"},CONN_POLL:1,CONN_BOSH:2,CONN_SOCKET:4,ERROR_AUTH:4,ERROR_CONN:8,ERROR_MUC:16,ERROR_REG:17,SUBSCR_FROM:"from",SUBSCR_TO:"to",SUBSCR_BOTH:"both",SUBSCR_NONE:"none",TYPE_AVAILABLE:"",TYPE_UNAVAILABLE:"unavailable",TYPE_PROBE:"probe",TYPE_SUBSCRIBED:"subscribed",TYPE_SUBSCRIBE:"subscribe",TYPE_UNSUBSCRIBE:"unsubscribe",TYPE_UNSUBSCRIBED:"unsubscribed",STATUS_ONLINE:"online",STATUS_OFFLINE:"offline",STATUS_SHOW:"show",STATUS_AWAY:"away",STATUS_XA:"xa",STATUS_DND:"dnd",STATUS_INVISIBLE:"invisible",STATUS_FFC:"chat",MSG_CHAT:"chat",MSG_GROUPCHAT:"groupchat",MSG_ERROR:"error",MSG_HEADLINE:"headline",MSG_NORMAL:"normal"};
apf.extend(apf.xmpp,constants);this.$server=null;this.timeout=10000;this.maxrequests=2;
this.useHTTP=true;this.method="POST";this.auth="DIGEST-MD5";this.connected=false;
this.$xmppMethod=constants.CONN_BOSH;this.$isPoll=false;this["poll-timeout"]=2000;
this["auto-register"]=false;this["auto-confirm"]=true;this["auto-deny"]=false;this.$canMuc=false;
this.$canRDB=false;this.$modelContent={roster:true,chat:true,typing:true};var SASL_MECHS={PLAIN:1,"DIGEST-MD5":1,ANONYMOUS:1},SID="SID",JID="JID",CONN="connected",ROSTER="roster",COOKIE="ajaxorg_xmpp";
this.$booleanProperties["auto-register"]=true;this.$booleanProperties["auto-confirm"]=true;
this.$booleanProperties["auto-deny"]=true;this.$booleanProperties[CONN]=true;this.$supportedProperties.push("type","auth","poll-timeout","resource","host","auto-register","auto-confirm","auto-deny",CONN,"model","model-contents","muc-host","muc-model");
this.$propHandlers.type=function(value){this.$xmppMethod=(value=="polling")?constants.CONN_POLL:(value=="socket")?constants.CONN_SOCKET:constants.CONN_BOSH;
this.$isPoll=Boolean(this.$xmppMethod&constants.CONN_POLL)||Boolean(this.$xmppMethod&constants.CONN_SOCKET);
};this.$propHandlers.auth=function(value){value=(value||"").toUpperCase();this.auth=SASL_MECHS[value]?value:"DIGEST_MD5";
};this.$propHandlers["poll-timeout"]=function(value){this["poll-timeout"]=parseInt(value)||2000;
};this.$propHandlers.resource=function(value){this.resource=value||apf.config.name||"apf".appendRandomNumber(5);
};this.$propHandlers["model-contents"]=function(value){var aContents=(value||"all").splitSafe("\\|",0,true),i=0,l=aContents.length;
this.$modelContent={roster:aContents[0]=="all",chat:aContents[0]=="all",typing:aContents[0]=="all"};
for(;i<l;i++){aContents[i]=aContents[i].trim();if(!this.$modelContent[aContents[i]]){this.$modelContent[aContents[i]]=true;
}}if(this.$serverVars[ROSTER]){this.$serverVars[ROSTER].rebuild(this.$modelContent);
}};this.$propHandlers["muc-model"]=function(value){this["muc-host"]=this["muc-host"]||"conference."+this.host;
if(!this.$canMuc){this.$canMuc=true;this.implement(apf.xmpp_muc);}};this.$initMuc=function(){if(this.$canMuc){return;
}this.setProperty("muc-model","$apf_muc");};function makeUnique(s){if(typeof s!="string"){throw new Error("Dependencies not met, please provide a string");
}return(s+"_").appendRandomNumber(5);}function createBodyElement(options,content){var i,aOut=["<body "];
for(i in options){if(options[i]==null){continue;}aOut.push(i,"='",options[i],"' ");
}aOut.push(">",content||"","</body>");return aOut.join("");}function createStreamElement(options,content){if(!options){options={};
}var aOut=this.$xmppMethod&constants.CONN_SOCKET?[]:[this.$serverVars[SID]||"0",","];
if(options.doOpen){aOut.push("<stream:stream");for(var i in options){if(i=="doOpen"||i=="doClose"||options[i]==null){continue;
}aOut.push(" ",i,"='",options[i],"'");}aOut.push(">");}aOut.push(content||"");if(options.doClose){aOut.push("</stream:stream>");
}return aOut.join("");}function generateCnonce(size){var sTab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i,sCnonce="";
for(i=0;i<size;i++){sCnonce+=sTab.charAt(apf.randomGenerator.generate(0,61));}return sCnonce;
}function createAuthBlock(parts){var i,aOut=[];for(i in parts){if(parts[i]==null){continue;
}aOut.push(i,'="',parts[i],'",');}var sOut=aOut.join("").replace(/,$/,"");return"<response xmlns='"+constants.NS.sasl+"'>"+apf.crypto.Base64.encode(sOut)+"</response>";
}function createIqBlock(parts,content){var i,aOut=["<iq "];for(i in parts){if(parts[i]==null){continue;
}aOut.push(i,"='",parts[i],"' ");}aOut.push(">",content||"","</iq>");return aOut.join("");
}function createPresenceBlock(options,content){var aOut=["<presence xmlns='",constants.NS.jabber,"'"];
if(options.type){aOut.push(" type='",options.type,"'");}if(options.to){aOut.push(" to='",options.to,"'");
}if(options.from){aOut.push(" from='",options.from,"'");}if(options.join){aOut.push(" join='",options.join,"'");
}if(options.prio){aOut.push(" prio='",options.prio,"'");}aOut.push(">");if(options.status){aOut.push("<show>",options.status,"</show>");
}if(options.custom){aOut.push("<status>",options.custom,"</status>");}aOut.push(content||"");
aOut.push("</presence>");return aOut.join("");}function createMessageBlock(options){var aOut=["<message xmlns='",constants.NS.jabber,"' from='",this.$serverVars[JID],"' to='",options.to,"' id='message_",++this.$serverVars.mess_count,"' xml:lang='",options["xml:lang"],"'"];
if(options.type){aOut.push(" type='",options.type,"'");}aOut.push(">");if(options.subject){aOut.push("<subject>",options.subject,"</subject>");
}if(options.thread){aOut.push("<thread>",options.thread,"</thread>");}if(options.x){aOut.push("<x xmlns='",constants.NS.data,"' type='",options.xtype||"submit","'>",options.x,"</x>");
}if(options.message){aOut.push("<body><![CDATA[",encodeCDATA(options.message.trim()),"]]></body>");
}aOut.push("</message>");return aOut.join("");}var encRE=/<\!\[CDATA\[([\S\s]*?)\]\]>/g,decRE=/&lt;\[CDATA\[([\S\s]*?)\]\]&gt;/g;
function encodeCDATA(s){if(typeof s!="string"){return s;}return s.replace(encRE,"&lt;[CDATA[$1]]&gt;");
}function decodeCDATA(s){if(typeof s!="string"){return s;}return s.replace(decRE,"<![CDATA[$1]]>");
}this.$getRID=function(){if(this.$RID===null){this.$RID=parseInt("".appendRandomNumber(10));
}return this.$RID++;};this.$makeUnique=makeUnique,this.$createBodyElement=createBodyElement,this.$createStreamElement=createStreamElement,this.$createIqBlock=createIqBlock,this.$createPresenceBlock=createPresenceBlock,this.$createMessageBlock=createMessageBlock,this.$encodeCDATA=encodeCDATA,this.$decodeCDATA=decodeCDATA;
this.$doXmlRequest=function(cb,s){if(cb&&typeof s!="undefined"){this.$reqStack.push({callback:cb,body:s});
}if(this.$reqCount>=this.maxrequests){return null;}var _self=this,sock=this.$xmppMethod&constants.CONN_SOCKET,req=this.$reqStack.shift();
if(!req){return null;}apf.console.log("sending request: "+req.body);if(!sock){++this.$reqCount;
}return this.$activeReq=this.get(this.url,{callback:function(data,state,extra){if(!sock){--_self.$reqCount;
}_self.$activeReq=null;if(_self.$reqStack.length){_self.$doXmlRequest();}apf.console.log("receiving data: "+data);
if(_self.$isPoll){if(!data||data.replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){}else{var start="<stream:stream",end="</stream:stream>";
if(data.indexOf(start)>-1){if(data.indexOf(end)==-1){data=data+end;}}else{if(_self.$xmppMethod&constants.CONN_SOCKET){data=start+" xmlns:stream='"+constants.NS.stream+"'>"+data+(data.indexOf(end)==-1?end:"");
}}data=apf.getXmlDom(data);if(!apf.supportNamespaces){data.setProperty("SelectionLanguage","XPath");
}}}if(state!=apf.SUCCESS){var oError;oError=new Error(apf.formatErrorString(0,_self,"XMPP Communication error","Url: "+extra.url+"\nInfo: "+extra.message));
if(typeof req.callback=="function"){req.callback.call(_self,data,state,extra);return true;
}else{if(extra.tpModule.retryTimeout(extra,state,_self,oError)===true){return true;
}}onError.call(_self,!this.connected?constants.ERROR_AUTH:constants.ERROR_CONN,extra.message,state);
throw oError;}if(typeof req.callback=="function"){req.callback.call(_self,data,state,extra);
}},nocache:true,useXML:!this.$isPoll,ignoreOffline:true,data:req.body||""});};function onError(nType,sMsg,nState){var bIsAuth=nType&constants.ERROR_AUTH,bIsConn=nType&constants.ERROR_CONN;
if(bIsConn){if(this.$retryCount==3){this.$retryCount=0;clearTimeout(this.$listener);
this.$listener=null;this.setProperty(CONN,false);this.dispatchEvent("reconnect",{username:this.$serverVars.username,server:this.url});
return this.connect(this.$serverVars.username,this.$serverVars.password,this.$serverVars.login_callback,this.$serverVars.register||this["auto-register"]);
}this.$retryCount++;this.$listen();}else{this.$retryCount=0;}apf.console.log("[XMPP-"+(bIsAuth?"AUTH":bIsConn?"CONN":"REG")+"] onError called.","xmpp");
clearTimeout(this.$listener);this.$listener=null;var extra={username:this.$serverVars.username,server:this.url,message:sMsg||(bIsAuth?"Access denied. Please check your username or password.":bIsConn?"Could not connect to server, please contact your System Administrator.":"Could not register for a new user account")},cb=this.$serverVars.login_callback;
if(cb){delete this.$serverVars.login_callback;return cb(null,nState||apf.ERROR,extra);
}return this.dispatchEvent(bIsAuth?"authfailure":bIsConn?"connectionerror":"registererror",extra);
}this.connect=function(username,password,callback,reg){this.reset();this.$serverVars.username=username||this.resource;
this.$serverVars.password=password||"";this.$serverVars.login_callback=callback;
this.$serverVars.register=reg||this["auto-register"];this.$serverVars.previousMsg=[];
this.$serverVars[ROSTER].registerAccount(username,this.host);if(this.$canMuc){this.$mucRoster.registerAccount(username,this.host);
}this.$doXmlRequest(processConnect,this.$isPoll?createStreamElement.call(this,{doOpen:true,to:this.host,xmlns:constants.NS.jabber,"xmlns:stream":constants.NS.stream,version:"1.0"}):createBodyElement({content:"text/xml; charset=utf-8",hold:"1",rid:this.$getRID(),to:this.host,route:"xmpp:jabber.org:9999",secure:"true",wait:"120",ver:"1.6","xml:lang":"en","xmpp:version":"1.0",xmlns:constants.NS.httpbind,"xmlns:xmpp":constants.NS.bosh}));
};this.disconnect=function(callback){if(this.connected){if(callback){this.$serverVars.logout_callback=callback;
}if(this.$canMuc){this.leaveAllRooms();}var sPresence=createPresenceBlock({type:constants.TYPE_UNAVAILABLE});
this.$doXmlRequest(processDisconnect,this.$isPoll?createStreamElement.call(this,{doClose:true},sPresence):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],type:"terminate",xmlns:constants.NS.httpbind},sPresence));
}else{this.reset();if(callback){callback(null,apf.SUCCESS);}}};this.pause=function(secs){var max,v=this.$serverVars;
if(!this.connected||this.$isPoll||!(max=v.MAXPAUSE)){return;}secs=parseInt(secs)||max;
this.$doXmlRequest(processBindingResult,createBodyElement({rid:this.$getRID(),sid:v[SID],pause:secs>max?max:secs,xmlns:constants.NS.httpbind}));
};function processDisconnect(oXml,state,extra){apf.console.dir(oXml);var cb=this.$serverVars.logout_callback;
this.reset();if(this.$activeReq){this.cancel(this.$activeReq);}if(cb){cb(oXml,state,extra);
}}this.isConnected=function(){return this.connected;};this.reset=function(){var oRoster=this.$serverVars[ROSTER];
if(oRoster){oRoster.reset();}if(this.$canMuc&&this.$mucRoster){this.$mucRoster.reset();
}for(var i in this.$serverVars){delete this.$serverVars[i];}this.$RID=null;this.$serverVars.cnonce=generateCnonce(14);
this.$serverVars.nc="00000001";this.setProperty(CONN,false);this.$serverVars[ROSTER]=new apf.xmpp_roster(this.model,this.$modelContent,this.resource);
this.$serverVars.bind_count=0;this.$serverVars.mess_count=0;this.host=this.host||this.$host;
if(!this.$canMuc){this.$initMuc();}};function processConnect(oXml,state,extra){if(state!=apf.SUCCESS){return onError.call(this,constants.ERROR_AUTH,extra.message,state);
}this.$retryCount=0;if(!this.$isPoll){this.$serverVars[SID]=oXml.getAttribute("sid");
this.$serverVars.AUTH_ID=oXml.getAttribute("authid");this.$serverVars.WAIT=(parseInt(oXml.getAttribute("wait"))||0)*1000;
this.$serverVars.REQUESTS=parseInt(oXml.getAttribute("requests"))||0;this.$serverVars.INACTIVITY=(parseInt(oXml.getAttribute("inactivity"))||0)*1000;
this.$serverVars.MAXPAUSE=(parseInt(oXml.getAttribute("maxpause"))||0)*1000;this.$serverVars.POLLING=parseInt(oXml.getAttribute("polling"))||0;
this.$serverVars.VER=parseFloat(oXml.getAttribute("ver"))||1.1;}else{if(this.$xmppMethod&constants.CONN_POLL){var aCookie=extra.http.getResponseHeader("Set-Cookie").splitSafe(";");
this.$serverVars[SID]=aCookie[0].splitSafe("=")[1];}this.$serverVars.AUTH_ID=oXml.firstChild.getAttribute("id");
}var oMech=oXml.getElementsByTagName("mechanisms")[0],sXmlns=oMech.getAttribute("xmlns");
this.$serverVars.AUTH_SASL=apf.isO3||(sXmlns&&sXmlns==constants.NS.sasl);var aNodes=oXml.getElementsByTagName("mechanism"),i=0,l=aNodes.length,found=false,sMech;
for(;i<l;i++){sMech=aNodes[i].firstChild.nodeValue||"";if(sMech==this.auth){this.$serverVars.AUTH_TYPE=sMech;
found=true;}}if(!found){apf.console.error("No supported authentication protocol found.                                Falling back to anonymous authentication, but                                that could fail!","xmpp");
this.$serverVars.AUTH_TYPE="ANONYMOUS";}aNodes=oXml.getElementsByTagName("register");
for(i=0,l=aNodes.length;i<l;i++){this.$serverVars.AUTH_REG=(aNodes[i].getAttribute("xmlns")==constants.NS.feature_reg);
}return(this.$serverVars.AUTH_REG&&this.$serverVars.register)?doRegRequest.call(this):doAuthRequest.call(this);
}function doRegRequest(){var sIq=createIqBlock({type:"set",id:makeUnique("reg")},"<query xmlns='"+constants.NS.register+"'><username>"+this.$serverVars.username+"</username><password>"+this.$serverVars.password+"</password></query>"),_self=this;
this.$doXmlRequest(function(oXml){if(oXml&&oXml.nodeType){var iq=oXml.getElementsByTagName("iq")[0];
if((iq&&iq.getAttribute("type")=="error")||oXml.getElementsByTagName("error").length){onError.call(_self,constants.ERROR_REG,"New account registration for account '"+this.$serverVars.username+" failed.");
}doAuthRequest.call(_self);}else{if(!_self.$isPoll){onError.call(_self,constants.ERROR_REG,null,apf.OFFLINE);
}}},_self.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
}function doAuthRequest(){if(this.$serverVars.AUTH_SASL){var sType=this.$serverVars.AUTH_TYPE,sAuth="<auth xmlns='"+constants.NS.sasl+"' mechanism='"+sType+(sType=="PLAIN"||sType=="ANONYMOUS"?"'>"+apf.crypto.Base64.encode(sType=="ANONYMOUS"?this.resource:this.$serverVars.username+"@"+this.host+String.fromCharCode(0)+this.$serverVars.username+String.fromCharCode(0)+this.$serverVars.password)+"</auth>":"'/>");
this.$doXmlRequest((sType=="ANONYMOUS"||sType=="PLAIN")?reOpenStream:processAuthRequest,this.$isPoll?createStreamElement.call(this,null,sAuth):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sAuth));
}else{var sIq=createIqBlock({type:"get",id:makeUnique("auth")},"<query xmlns='"+constants.NS.auth+"'><username>"+this.$serverVars.username+"</username></query>");
this.$doXmlRequest(processAuthRequest,this.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
}}function processChallenge(oXml){if(!oXml||oXml.getElementsByTagName("failure").length){return false;
}var oChallenge=oXml.getElementsByTagName("challenge");if(oChallenge.length&&(oChallenge=oChallenge[0])){var i,l,aChunk,b64_challenge=oChallenge.firstChild.nodeValue,aParts=apf.crypto.Base64.decode(b64_challenge).split(",");
for(i=0,l=aParts.length;i<l;i++){aChunk=aParts[i].split("=");this.$serverVars[aChunk[0]]=aChunk[1].trim().replace(/[\"\']/g,"");
}apf.console.info("processChallenge: "+aParts.join("    "),"xmpp");}return true;
}function processAuthRequest(oXml){if(this.$serverVars.AUTH_SASL){if(!processChallenge.call(this,oXml)){return onError.call(this,constants.ERROR_AUTH);
}var sRealm=this.$serverVars.realm,md5=apf.crypto.MD5;if(!sRealm){this.$serverVars.realm=sRealm=this.host;
}if(sRealm){this.$serverVars["digest-uri"]="xmpp/"+sRealm;}apf.console.info("auth - digest-uri: "+this.$serverVars["digest-uri"],"xmpp");
var A1=md5.str_md5(this.$serverVars.username+":"+this.host+":"+this.$serverVars.password)+":"+this.$serverVars.nonce+":"+this.$serverVars.cnonce,A2="AUTHENTICATE:"+this.$serverVars["digest-uri"],sResp=md5.hex_md5(md5.hex_md5(A1)+":"+this.$serverVars.nonce+":"+this.$serverVars.nc+":"+this.$serverVars.cnonce+":"+this.$serverVars.qop+":"+md5.hex_md5(A2));
apf.console.info("response: "+sResp,"xmpp");var sAuth=createAuthBlock({username:this.$serverVars.username,realm:sRealm,nonce:this.$serverVars.nonce,cnonce:this.$serverVars.cnonce,nc:this.$serverVars.nc,qop:this.$serverVars.qop,"digest-uri":this.$serverVars["digest-uri"],response:sResp,charset:this.$serverVars.charset});
this.$doXmlRequest(processFinalChallenge,this.$isPoll?createStreamElement.call(this,null,sAuth):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sAuth));
}else{if(oXml&&oXml.nodeType){var iq=oXml.getElementsByTagName("iq")[0];if((iq&&iq.getAttribute("type")=="error")||oXml.getElementsByTagName("error").length){return onError.call(this,constants.ERROR_AUTH);
}var aDigest,bDigest=(aDigest=oXml.getElementsByTagName("digest")&&aDigest[0]),sIq=createIqBlock({type:"set",id:makeUnique("auth")},"<query xmlns='"+constants.NS.auth+"'><username>"+this.$serverVars.username+"</username><resource>"+this.resource+"</resource>"+(bDigest?"<digest xmlns='"+constants.NS.auth+">"+apf.crypto.SHA1(this.$serverVars.AUTH_ID+this.$serverVars.password)+"</digest>":"<password xmlns='"+constants.NS.auth+"'>"+this.$serverVars.password+"</password>")+"</query>");
this.$doXmlRequest(reOpenStream,this.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
}else{if(!this.$isPoll){onError.call(this,constants.ERROR_AUTH,null,apf.OFFLINE);
}}}}function processFinalChallenge(oXml){if(!processChallenge.call(this,oXml)){return onError.call(this,constants.ERROR_AUTH);
}var sAuth=createAuthBlock({});this.$doXmlRequest(reOpenStream,this.$isPoll?createStreamElement.call(this,null,sAuth):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sAuth));
}function reOpenStream(oXml){if(this.$serverVars.AUTH_SASL){if(!processChallenge.call(this,oXml)){return onError.call(this,constants.ERROR_AUTH);
}}else{if(oXml&&oXml.nodeType){var iq=oXml.getElementsByTagName("iq")[0];if((iq&&iq.getAttribute("type")=="error")||oXml.getElementsByTagName("error").length){return onError.call(this,constants.ERROR_AUTH);
}delete this.$serverVars.password;}else{if(!this.$isPoll){onError.call(this,constants.ERROR_AUTH,null,apf.OFFLINE);
}}}var _self=this;this.$doXmlRequest(function(oXml){if(_self.$isPoll||oXml.getElementsByTagName("bind").length){_self.bind();
}},this.$isPoll?createStreamElement.call(this,{doOpen:true,to:this.host,xmlns:constants.NS.jabber,"xmlns:stream":constants.NS.stream,version:"1.0"}):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],to:this.host,"xml:lang":"en","xmpp:restart":"true",xmlns:constants.NS.httpbind,"xmlns:xmpp":constants.NS.bosh}));
}this.bind=function(){var sIq=createIqBlock({id:"bind_"+ ++this.$serverVars.bind_count,type:"set",xmlns:this.$isPoll?null:constants.NS.jabber},"<bind xmlns='"+constants.NS.bind+"'><resource>"+this.resource+"</resource></bind>");
this.$doXmlRequest(processBindingResult,this.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
};function processBindingResult(oXml){var oJID=oXml.getElementsByTagName("jid")[0];
if(oJID){this.$serverVars[JID]=oJID.firstChild.nodeValue;var sIq=createIqBlock({from:this.$serverVars[JID],id:this.$sAJAX_ID,to:this.host,type:"set",xmlns:constants.NS.jabber},"<session xmlns='"+constants.NS.session+"'/>"),_self=this;
this.$doXmlRequest(function(oXml){parseData.call(_self,oXml);setInitialPresence.call(_self);
},this.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
}else{onError.call(this,constants.ERROR_AUTH);}}function setInitialPresence(){var sPresence=createPresenceBlock({type:constants.TYPE_AVAILABLE}),_self=this;
this.$doXmlRequest(function(oXml){parseData.call(_self,oXml);if(_self.model){getRoster.call(_self);
}else{connected.call(_self);}},this.$isPoll?createStreamElement.call(this,null,sPresence):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sPresence));
}function getRoster(){var sIq=createIqBlock({from:this.$serverVars[JID],type:"get",id:makeUnique("roster")},"<query xmlns='"+constants.NS.roster+"'/>"),_self=this;
this.$doXmlRequest(function(oXml){parseData.call(_self,oXml);connected.call(_self);
},this.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
}function connected(){var v=this.$serverVars,cb=v.login_callback,msg=v.previousMsg;
if(cb){cb(null,apf.SUCCESS,{username:v.username});delete v.login_callback;}if(msg&&msg.length){for(var i=0,l=msg.length;
i<l;i++){this.sendMessage.apply(this,msg[i]);}delete msg;v.previousMsg=[];}this.setProperty(CONN,true);
this.dispatchEvent(CONN,{username:v.username});this.$listen();}this.$listen=function(){if((!(this.$xmppMethod&constants.CONN_SOCKET)&&this.$listening===true)||!this.connected){return;
}clearTimeout(this.$listener);this.$listener=null;this.$listening=true;apf.console.info("XMPP: Listening for messages...","xmpp");
this.$doXmlRequest(processStream,this.$isPoll?createStreamElement.call(this):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},""));
};function restartListener(data,state,extra){clearTimeout(this.$listener);this.$listener=null;
var _self=this;this.$listener=$setTimeout(function(){_self.$listen();},this["poll-timeout"]||0);
if(data||state){if(state!=apf.SUCCESS){return onError.call(this,constants.ERROR_CONN,extra.message,state);
}else{parseData.call(this,data);}}}this.$restartListener=restartListener;function processStream(oXml,state){clearTimeout(this.$listener);
this.$listener=null;var bNoListener=(this.$listening===false);this.$listening=false;
if(this.connected&&!bNoListener){var _self=this;this.$listener=$setTimeout(function(){_self.$listen();
},this["poll-timeout"]||0);}parseData.call(this,oXml);}function parseData(oXml){if(this.$serverVars.muc_callback){this.$serverVars.muc_callback(oXml);
delete this.$serverVars.muc_callback;}if(oXml&&oXml.nodeType){this.$serverVars.previousMsg=[];
var aMessages=oXml.getElementsByTagName("message");if(aMessages.length){parseMessagePackets.call(this,aMessages);
}var aPresence=oXml.getElementsByTagName("presence");if(aPresence.length){parsePresencePackets.call(this,aPresence);
}var aIQs=oXml.getElementsByTagName("iq");if(aIQs.length){parseIqPackets.call(this,aIQs);
}if(!aMessages.length&&!aPresence.length&&!aIQs.length){this.dispatchEvent("unknownstanza",{data:oXml});
}}else{if(!this.$isPoll){onError.call(this,constants.ERROR_CONN,null,apf.OFFLINE);
}}}this.$parseData=parseData;function getMessage(oNode){if(!oNode){return null;
}var node,msg=[],i=0,l=oNode.childNodes.length;for(i=0;i<l;i++){if((node=oNode.childNodes[i])&&node.nodeType==3){msg.push(node.nodeValue);
}}return decodeCDATA(msg.join("").replace(/\&quot;/g,'"'));}function fieldsToObject(aFields){if(!aFields||!aFields.length){return{};
}var oField,oVal,res={},i=0,l=aFields.length;for(;i<l;++i){oField=aFields[i],oVal=oField.getElementsByTagName("value")[0];
if(oVal.firstChild.nodeType==4){oVal=oVal.firstChild;}res[oField.getAttribute("var")]={type:oField.getAttribute("type"),value:oVal.firstChild.nodeValue};
}return res;}function parseMessagePackets(aMessages){var oMsg,sJID,sType,oThread,sThread,sMsg,sFrom,oBody,bRoom,i=0,l=aMessages.length;
apf.console.info("parseMessagePackets: "+l,"xmpp");for(;i<l;i++){oMsg=aMessages[i];
sJID=oMsg.getAttribute("from");sType=oMsg.getAttribute("type");bRoom=(sType=="groupchat");
if(sJID&&!bRoom){this.$serverVars[ROSTER].getEntityByJID(sJID);}oBody=oMsg.getElementsByTagName("body")[0];
oThread=oMsg.getElementsByTagName("thread");if(oThread.length){sThread=oThread[0].firstChild.nodeValue.trim();
}sFrom=oMsg.getAttribute("from");sMsg=getMessage(oBody);if(bRoom&&sFrom==this.$mucRoster.fullJID){return;
}if((bRoom?this.$mucRoster:this.$serverVars[ROSTER]).updateMessageHistory(sFrom,sMsg,sThread)){if(sMsg&&sType==constants.MSG_CHAT&&sThread!="rdb"){this.dispatchEvent("receivechat",{from:sFrom,message:sMsg});
}else{if(sType==constants.MSG_NORMAL){var oX=oMsg.getElementsByTagName("x")[0];
if(!oX){continue;}sType=oX.getAttribute("type");this.dispatchEvent("datastatuschange",{type:sType,annotator:sFrom,fields:fieldsToObject(oX.getElementsByTagName("field"))});
}else{if(sMsg&&sThread=="rdb"){apf.console.info("received the following from the server: "+sMsg,"xmpp");
this.$rdbSignal(oMsg,sMsg);}}}}}}function parsePresencePackets(aPresence){apf.console.info("parsePresencePackets: "+aPresence.length,"xmpp");
var oP,sType,sJID,aX,bMuc,bRDB,o,k,l2,sRoom,i=0,l=aPresence.length;for(;i<l;i++){oP=aPresence[i],sType=oP.getAttribute("type"),sJID=oP.getAttribute("from"),aX=oP.getElementsByTagName("x"),bMuc=(sJID.indexOf(this["muc-host"])>-1),bRDB=(sJID.indexOf(this["rdb-host"])>-1||sType=="rpc"||sType=="result");
if(aX.length){for(k=0,l2=aX.length;k<l2;k++){switch(aX[k].getAttribute("xmlns")){case constants.NS.muc_user:if(this.$getStatusCode(aX[k],201)){this.$mucSignal(apf.xmpp_muc.ROOM_CREATE,sJID);
break;}if(!this.$isRoom(sJID)||this.$getStatusCode(aX[k],110)){break;}o=aX[k].getElementsByTagName("item")[0];
if(!o){break;}sRoom=sJID.substring(0,sJID.indexOf("/"));this.$mucSignal(apf.xmpp_muc.ROOM_JOINED,sRoom,{fullJID:sJID,roomJID:o.getAttribute("jid")||null,affiliation:o.getAttribute("affiliation"),role:o.getAttribute("role"),status:oP.getAttribute("type")||constants.TYPE_AVAILABLE});
break;}}}if(sJID&&!bMuc&&!bRDB){var oRoster=this.$serverVars[ROSTER],oUser=oRoster.getEntityByJID(sJID);
if(sType==constants.TYPE_SUBSCRIBE){incomingAdd.call(this,aPresence[i].getAttribute("from"));
}if(oUser){oRoster.update(oUser,sType||constants.TYPE_AVAILABLE);}}}}function parseIqPackets(aIQs){apf.console.info("parseIqPackets: "+aIQs.length,"xmpp");
for(var i=0,l=aIQs.length;i<l;i++){if(aIQs[i].getAttribute("type")!="result"&&aIQs[i].getAttribute("type")!="error"){continue;
}var aQueries=aIQs[i].getElementsByTagName("query"),sFrom=aIQs[i].getAttribute("from");
for(var j=0,l2=aQueries.length;j<l2;j++){var aItems,k,l3;switch(aQueries[j].getAttribute("xmlns")){case constants.NS.roster:aItems=aQueries[j].getElementsByTagName("item");
var oRoster=this.$serverVars[ROSTER],pBlocks=[];for(k=0,l3=aItems.length;k<l3;k++){var sSubscr=aItems[k].getAttribute("subscription"),sGroup=(aItems[k].childNodes.length>0)?aItems[k].firstChild.firstChild.nodeValue:"",sJid=aItems[k].getAttribute("jid");
var oContact=oRoster.getEntityByJID(sJid,{subscription:sSubscr,group:sGroup});if(sSubscr==constants.SUBSCR_TO||sSubscr==constants.SUBSCR_BOTH){pBlocks.push(oContact);
}else{if(oContact.subscription==constants.TYPE_SUBSCRIBED){confirmAdd.call(this,oContact);
}}}if(pBlocks.length){this.requestPresence(pBlocks);}break;case constants.NS.disco_items:if(!this.$canMuc){break;
}var aErrors=aIQs[i].getElementsByTagName("error");if(aErrors.length&&parseInt(aErrors[0].getAttribute("code"))==404){this.$mucSignal(apf.xmpp_muc.ROOM_NOTFOUND,sFrom);
break;}aItems=aQueries[j].getElementsByTagName("item");var oRoom=this.$addRoom(sFrom,sFrom.split("@")[0]),sJID;
this.$mucSignal(apf.xmpp_muc.ROOM_EXISTS,sFrom);for(k=0,l3=aItems.length;k<l3;k++){sJID=aItems[k].getAttribute("jid");
if(sJID.indexOf("/")!=-1){this.$addRoomOccupant(sJID);}else{if(aItems[k].hasAttribute("name")){oRoom.subscription=aItems[k].getAttribute("name");
}}}break;case constants.NS.muc_user:break;case constants.NS.muc_owner:this.$mucSignal(apf.xmpp_muc.ROOM_CREATE,sFrom);
break;case constants.NS.datastatus:this.$mucSignal(constants.NS.datastatus,sFrom,aIQs[i]);
break;default:break;}}}}this.setPresence=function(type,status,custom){if(!this.connected){return false;
}this.$doXmlRequest(restartlistener,createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},createPresenceBlock({type:type||constants.TYPE_AVAILABLE,status:status,custom:custom})));
};this.requestPresence=function(from){if(!this.connected){return false;}var oRoster=this.$serverVars[ROSTER];
if(typeof from=="string"){from=oRoster.getEntityByJID(from);}if(!from){return false;
}var sPresence,aPresence=[];if(apf.isArray(from)){for(var i=0,l=from.length;i<l;
i++){aPresence.push(createPresenceBlock({type:constants.TYPE_PROBE,to:from[i].fullJID,from:oRoster.fullJID}));
}}else{aPresence.push(createPresenceBlock({type:constants.TYPE_PROBE,to:from.fullJID,from:oRoster.fullJID}));
}sPresence=aPresence.join("");this.$doXmlRequest(restartListener,this.$isPoll?createStreamElement.call(this,null,sPresence):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sPresence));
};this.addContact=function(jid,callback){if(typeof jid!="string"){return false;
}var oRoster=this.$serverVars[ROSTER],oContact=oRoster.getEntityByJID(jid);if(oContact&&(oContact.subscription==constants.SUBSCR_TO||oContact.subscription==constants.SUBSCR_BOTH)){return this.requestPresence(oContact);
}var sIq=createIqBlock({type:"set",id:makeUnique("set")},"<query xmlns='"+constants.NS.roster+"'><item jid='"+jid+"' /></query>"),_self=this;
this.$doXmlRequest(function(oXml){_self.$listen();parseData.call(_self,oXml);var sPresence=createPresenceBlock({type:constants.TYPE_SUBSCRIBE,to:jid});
_self.$doXmlRequest(function(oXml){if(!oXml||!oXml.nodeType){return !_self.$isPoll?onError.call(_self,constants.ERROR_CONN,null,apf.OFFLINE):null;
}_self.$listen();var oPresence=oXml.getElementsByTagName("presence")[0];if(oPresence.getAttribute("error")){sPresence=createPresenceBlock({type:constants.TYPE_UNSUBSCRIBE,to:jid});
_self.$doXmlRequest(function(data,state,extra){if(callback){callback.call(_self,data,state,extra);
}restartListener.call(_self,data,state,extra);},_self.$isPoll?createStreamElement.call(this,null,sPresence):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sPresence));
}},_self.$isPoll?createStreamElement.call(_self,null,sPresence):createBodyElement({rid:_self.$getRID(),sid:_self.$serverVars[SID],xmlns:constants.NS.httpbind},sPresence));
},this.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
};function incomingAdd(sJID){if(this["auto-confirm"]){var sMsg=createIqBlock({from:this.$serverVars[JID],type:"get",id:makeUnique("roster")},"<query xmlns='"+constants.NS.roster+"'><item jid='"+sJID+"' /></query>")+createPresenceBlock({type:constants.TYPE_SUBSCRIBED,to:sJID});
this.$doXmlRequest(restartListener,this.$isPoll?createStreamElement.call(this,null,sMsg):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sMsg));
}if(this["auto-deny"]){var sPresence=createPresenceBlock({type:constants.TYPE_UNSUBSCRIBED,to:sJID});
this.$doXmlRequest(restartListener,this.$isPoll?createStreamElement.call(this,null,sPresence):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sPresence));
}}function confirmAdd(oContact){var sPresence=createPresenceBlock({type:constants.TYPE_SUBSCRIBED,to:oContact.jid});
this.$doXmlRequest(restartListener,this.$isPoll?createStreamElement.call(this,null,sPresence):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sPresence));
}var statusMap={online:constants.STATUS_ONLINE,offline:constants.STATUS_OFFLINE,away:constants.STATUS_AWAY,xa:constants.STATUS_XA,extendedaway:constants.STATUS_XA,onvacation:constants.STATUS_XA,dnd:constants.STATUS_DND,donotdisturb:constants.STATUS_DND,invisible:constants.STATUS_INVISIBLE,ffc:constants.STATUS_FFC,chatty:constants.STATUS_FFC,freeforchat:constants.STATUS_FFC};
this.setStatus=function(sStatus){sStatus=statusMap[sStatus]||constants.STATUS_ONLINE;
return this.setPresence(sStatus,sStatus);};this.sendMessage=function(options){if(!options||!(options.message||options.x)){return false;
}var _self=this;if(typeof apf.offline!="undefined"&&!apf.offline.onLine){if(apf.offline.queue.enabled){var info={options:options,retry:function(){_self.sendMessage(this.options);
},$object:[this.name,"new apf.xmpp()"],$retry:"this.object.sendMessage(this.options)"};
apf.offline.queue.add(info);return true;}apf.console.warn("Trying to sent XMPP message even though                               application is offline.","xmpp");
}if(!this.connected){return false;}var bRoom=(this.$canMuc&&options.type==constants.MSG_GROUPCHAT),aArgs=Array.prototype.slice.call(arguments),oUser;
if(!bRoom){oUser=this.$serverVars[ROSTER].getEntityByJID(options.to);}if(!oUser&&!bRoom){apf.console.error("XMPP sendMessage error: no valid 'to' address provided"+options.to+"\nMessage: "+options.message,"xmpp");
}var sMsg=createMessageBlock.call(this,apf.extend({type:constants.MSG_CHAT,"xml:lang":"en"},options));
this.$doXmlRequest(function(data,state,extra){if(options.callback){options.callback.call(_self,data,state,extra);
}_self.$serverVars.previousMsg=aArgs;restartListener.call(_self,data,state,extra);
},this.$isPoll?createStreamElement.call(this,null,sMsg):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sMsg));
};this.sendXml=function(options){if(!options||!(options.message||options.x)){return false;
}var _self=this;if(typeof apf.offline!="undefined"&&!apf.offline.onLine){if(apf.offline.queue.enabled){var info={options:options,retry:function(){_self.sendMessage(this.options);
},$object:[this.name,"new apf.xmpp()"],$retry:"this.object.sendMessage(this.options)"};
apf.offline.queue.add(info);return true;}apf.console.warn("Trying to sent XMPP message even though                               application is offline.","xmpp");
}if(!this.connected){return false;}this.$doXmlRequest(function(data,state,extra){if(options.callback){options.callback.call(_self,data,state,extra);
}restartListener.call(_self,data,state,extra);},this.$isPoll?createStreamElement.call(this,null,options.message):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},options.message));
};this.getTime=function(sEntity,fCallback){var sIq=createIqBlock({type:"get",id:makeUnique("time"),from:this.$serverVars[ROSTER].fullJID,to:sEntity},"<time xmlns='"+constants.NS.time+"'/>"),_self=this;
this.$doXmlRequest(function(oXml){if(oXml&&oXml.nodeType){var iq=oXml.getElementsByTagName("iq")[0];
if(iq&&iq.getAttribute("type")=="result"&&iq.getElementsByTagName("time").length){return fCallback({tzo:iq.getElementsByTagName("tzo")[0].firstChild.nodeValue,utc:iq.getElementsByTagName("utc")[0].firstChild.nodeValue});
}}fCallback(false);},_self.$isPoll?createStreamElement.call(this,null,sIq):createBodyElement({rid:this.$getRID(),sid:this.$serverVars[SID],xmlns:constants.NS.httpbind},sIq));
};this.normalizeEntity=function(sEnt){return this.$serverVars[ROSTER].sanitizeJID(sEnt);
};this.$headerHook=function(http){if(!apf.isWebkit){http.setRequestHeader("Host",this.$host);
}http.setRequestHeader("Content-Type",this.$isPoll?"application/x-www-form-urlencoded":"text/xml; charset=utf-8");
};this.addEventListener("DOMNodeRemovedFromDocument",function(){var v=this.$serverVars;
if(v.MAXPAUSE&&this.connected&&this.auth.toLowerCase()!="anonymous"){delete v[ROSTER];
apf.setcookie(COOKIE,apf.serialize(v)+"|"+(new Date()).valueOf()+"|"+this.resource+"|"+this.$RID);
this.pause();}else{apf.delcookie(COOKIE);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(){var c=apf.getcookie?apf.getcookie(COOKIE):null;
if(c&&(c=c.split("|")).length==4){var v=apf.unserialize(c[0]),max=v.MAXPAUSE,t=parseInt(c[1]),now=(new Date()).valueOf();
if(!this.connected||!max||Math.abs(now-t)>=max){return;}this.setAttribute("resource",c[2]);
this.setProperty(CONN,false);this.$serverVars=v;this.$RID=parseInt(c[3]);this.$serverVars[ROSTER]=new apf.xmpp_roster(this.model,this.$modelContent,this.resource);
this.host=this.host||this.$host;if(!this.$canMuc){this.$initMuc();}}});this.exec=function(method,args,callback){switch(method){case"login":this.connect(args[0],args[1],callback);
break;case"logout":this.disconnect();break;case"notify":this.sendMessage({to:args[1],message:args[0],thread:args[2],type:args[3],callback:callback});
break;case"sendXml":this.sendXml(args[0]);break;default:throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Invalid XMPP method '"+method+"'"));
break;}};}).call(apf.xmpp.prototype=new apf.Teleport());apf.aml.setElement("xmpp",apf.xmpp);
apf.UndoData=function(settings,at){this.localName="UndoData";this.extra={};this.rdbQueue={};
apf.extend(this,settings);if(!this.timestamp){this.timestamp=(new Date()).getUTCTime();
}if(at){this.at=at;}else{if(settings&&settings.tagName=="UndoData"){this.args=settings.args.slice();
this.rdbArgs=settings.rdbArgs.slice();}else{this.selNode=this.selNode||(this.action=="removeNode"?this.args[0]:(this.amlNode?this.amlNode.selected:null));
}}var options,_self=this;var serialState;this.$export=function(){if(serialState){return serialState;
}serialState={action:this.action,rdbModel:this.rdbModel?this.rdbModel.name:null,rdbQueue:this.rdbQueue,at:this.at.name,timestamp:this.timestamp,parsed:options?options.parsed:null,userdata:options?options.userdata:null,extra:{}};
var rdb=this.rdbModel?this.rdbModel.rdb:apf.remote;var sLookup=(typeof apf.offline!="undefined"&&apf.offline.sLookup)?apf.offline.sLookup:(apf.offline.sLookup={});
if(!sLookup.count){sLookup.count=0;}var xmlNode,xmlId,args=this.args.slice();for(var i=0;
i<args.length;i++){if(args[i]&&args[i].nodeType){if(!serialState.argsModel){var model=apf.nameserver.get("model",apf.xmldb.getXmlDocId(args[i]));
if(model){serialState.argsModel=model.name||model.$uniqueId;}}args[i]=serializeNode(args[i]);
}}var item,name;for(name in this.extra){item=this.extra[name];serialState.extra[name]=item&&item.nodeType?serializeNode(item):item;
}serialState.args=args;if(!serialState.argsModel){apf.console.warn("Could not determine model for serialization                 of undo state. Will not be able to undo the state when the                 server errors. This creates a potential risk of loosing                 all changes on sync!");
}return serialState;function serializeNode(xmlNode){if(xmlNode.nodeType==2||apf.isChildOf(model.data,xmlNode,true)){xmlId=xmlNode.getAttribute(apf.xmldb.xmlIdTag);
return{xpath:rdb.xmlToXpath(xmlNode,model.data,true),lookup:xmlId};}else{var contextNode=xmlNode;
while(contextNode.parentNode&&contextNode.parentNode.nodeType==1){contextNode=xmlNode.parentNode;
}xmlId=contextNode.getAttribute(apf.xmldb.xmlIdTag);if(!xmlId){xmlId="serialize"+sLookup.count++;
contextNode.setAttribute(apf.xmldb.xmlIdTag,xmlId);}var obj={xpath:rdb.xmlToXpath(xmlNode,contextNode,true),lookup:xmlId};
if(!sLookup[xmlId]){contextNode.setAttribute(apf.xmldb.xmlDocTag,apf.xmldb.getXmlDocId(contextNode));
sLookup[xmlId]=contextNode;obj.xml=contextNode.xml||contextNode.serialize();}return obj;
}}};this.$import=function(){if(this.rdbModel){this.rdbModel=apf.nameserver.get("model",this.rdbModel);
}if(this.argsModel){var model=apf.nameserver.get("model",this.argsModel)||apf.lookup(this.argsModel);
var sLookup=(typeof apf.offline!="undefined"&&apf.offline.sLookup)?apf.offline.sLookup:(apf.offline.sLookup={});
if(!sLookup.count){sLookup.count=0;}var args=this.args,rdb=this.rdbModel?this.rdbModel.rdb:apf.remote,xmlNode,i,l,item,name;
for(i=0,l=args.length;i<l;i++){if(args[i]&&args[i].xpath){args[i]=unserializeNode(args[i],model);
}}for(name in this.extra){item=this.extra[name];if(item&&item.xpath){this.extra[name]=unserializeNode(item,model);
}}this.args=args;}options={undoObj:this,userdata:this.userdata,parsed:this.parsed};
if(this.timestamp){options.actionstart=this.timestamp;options.headers={"X-APF-ActionStart":this.timestamp};
}return this;function unserializeNode(xmlSerial,model){if(xmlSerial.xml){xmlNode=apf.xmldb.getXml(xmlSerial.xml);
sLookup[xmlNode.getAttribute(apf.xmldb.xmlIdTag)]=xmlNode;}else{if(xmlSerial.lookup){xmlNode=sLookup[xmlSerial.lookup];
if(!xmlSerial.xpath){throw new Error("Serialization error");}}else{xmlNode=null;
}}return rdb.xpathToXml(xmlSerial.xpath,xmlNode||model.data);}};this.processRsbQueue=function(){if(this.rdbModel){this.rdbModel.rdb.$processQueue(this);
}};this.clearRsbQueue=function(){this.rdbQueue=this.rdbModel=null;};this.saveChange=function(undo,at,callback){if(this.action=="group"){var rpcNodes=this.args[1];
at.$addToQueue(rpcNodes,undo,true);return at.$queueNext(this);}var dataInstruction;
if(this.xmlActionNode){dataInstruction=this.xmlActionNode.getAttribute(undo?"undo":"set");
if(undo&&!dataInstruction){dataInstruction=this.xmlActionNode.getAttribute("set");
}}if(!dataInstruction){this.processRsbQueue();return at.$queueNext(this);}this.state=undo?"restoring":"saving";
if(!options.asyncs){return at.$receive(null,apf.SUCCESS,{amlNode:this.amlNode},this,callback);
}options.ignoreOffline=true;apf.saveData(dataInstruction,options);};this.preparse=function(undo,at,multicall,callback){var dataInstruction;
if(this.xmlActionNode){dataInstruction=this.xmlActionNode.getAttribute(undo?"undo":"set");
if(undo&&!dataInstruction){dataInstruction=this.xmlActionNode.getAttribute("set");
}}if(!dataInstruction){return this;}options=apf.extend({xmlNode:this.action=="multicall"?this.args[0].xmlNode:this.selNode||this.xmlNode,userdata:apf.isTrue(this.xmlActionNode.getAttribute("ignore-fail")),multicall:multicall,undo:undo,precall:true,callback:function(data,state,extra){if(options.asyncs){extra.amlNode=_self.amlNode;
return at.$receive(data,state,extra,_self,callback);}}},this.extra);if(this.timestamp){options.actionstart=this.timestamp;
options.headers={"X-JPF-ActionStart":this.timestamp};}apf.saveData(dataInstruction,options);
return this;};};apf.actiontracker.actions={setTextNode:function(undoObj,undo){var q=undoObj.args;
if(!undo){apf.xmldb.setTextNode(q[0],q[1],q[2],undoObj);}else{apf.xmldb.setTextNode(q[0],undoObj.extra.oldValue,q[2],undoObj);
}},setAttribute:function(undoObj,undo){var q=undoObj.args;if(!undo){undoObj.extra.name=q[1];
undoObj.extra.oldValue=q[0].getAttribute(q[1]);apf.xmldb.setAttribute(q[0],q[1],q[2],q[3],undoObj);
}else{if(!undoObj.extra.oldValue){apf.xmldb.removeAttribute(q[0],q[1],null,undoObj);
}else{apf.xmldb.setAttribute(q[0],q[1],undoObj.extra.oldValue,q[3],undoObj);}}},removeAttribute:function(undoObj,undo){var q=undoObj.args;
if(!undo){undoObj.extra.name=q[1];undoObj.extra.oldValue=q[0].getAttribute(q[1]);
apf.xmldb.removeAttribute(q[0],q[1],q[2],undoObj);}else{apf.xmldb.setAttribute(q[0],q[1],undoObj.extra.oldValue,q[2],undoObj);
}},replaceNode:function(undoObj,undo){var q=undoObj.args;if(!undo){apf.xmldb.replaceNode(q[0],q[1],q[2],undoObj);
}else{apf.xmldb.replaceNode(q[1],q[0],q[2],undoObj);}},addChildNode:function(undoObj,undo){var q=undoObj.args;
if(!undo){apf.xmldb.addChildNode(q[0],q[1],q[2],q[3],undoObj);}else{apf.xmldb.removeNode(undoObj.extra.addedNode,null,undoObj);
}},appendChild:function(undoObj,undo){var q=undoObj.args;if(!undo){apf.xmldb.appendChild(q[0],q[1],q[2],q[3],q[4],undoObj);
}else{apf.xmldb.removeNode(undoObj.xmlNode,null,undoObj);}},moveNode:function(undoObj,undo){var q=undoObj.args;
if(!undo){apf.xmldb.moveNode(q[0],q[1],q[2],q[3],undoObj);}else{apf.xmldb.moveNode(undoObj.extra.oldParent,q[1],undoObj.extra.beforeNode,q[3],undoObj);
}},removeNode:function(undoObj,undo){var q=undoObj.args;if(!undo){apf.xmldb.removeNode(q[0],q[1],undoObj);
}else{apf.xmldb.appendChild(undoObj.extra.parent,undoObj.extra.removedNode,undoObj.extra.beforeNode,null,null,undoObj);
}},removeNodeList:function(undoObj,undo){if(undo){var d=undoObj.extra.removeList;
for(var i=d.length-1;i>=0;i--){apf.xmldb.appendChild(d[i].pNode,d[i].removedNode,d[i].beforeNode,null,null,undoObj);
}}else{apf.xmldb.removeNodeList(undoObj.args,undoObj);}},group:function(undoObj,undo,at){if(!undoObj.$undostack){var done=undoObj.args[0];
undoObj.$undostack=done;undoObj.$redostack=[];}at[undo?"undo":"redo"](undoObj.$undostack.length,false,undoObj.$undostack,undoObj.$redostack);
},setValueByXpath:function(undoObj,undo){var newNode,q=undoObj.args;if(!undo){if(newNode=undoObj.extra.newNode){if(newNode.nodeType==2){apf.xmldb.setAttribute(undoObj.extra.ownerElement,newNode.nodeName,newNode.nodeValue);
undoObj.extra.newNode=undoObj.extra.ownerElement.getAttributeNode(newNode.nodeName);
}else{apf.xmldb.appendChild(undoObj.extra.parentNode,undoObj.extra.newNode,null,null,null,undoObj);
}}else{var newNodes=[];apf.setNodeValue(q[0],q[1],true,{undoObj:undoObj,xpath:q[2],newNodes:newNodes,forceNew:q[3]});
newNode=undoObj.extra.newNode=newNodes[0];if(newNode){if(newNode.nodeType==2){undoObj.extra.ownerElement=newNode.ownerElement||newNode.selectSingleNode("..");
}else{undoObj.extra.parentNode=undoObj.extra.newNode.parentNode;}}}}else{if(newNode=undoObj.extra.newNode){if(newNode.nodeType==2){apf.xmldb.removeAttribute(undoObj.extra.ownerElement,newNode.nodeName,null,undoObj);
}else{apf.xmldb.removeNode(undoObj.extra.newNode,null,undoObj);}}else{apf.setNodeValue(undoObj.extra.appliedNode,undoObj.extra.oldValue,true,{undoObj:undoObj});
}}},multicall:function(undoObj,undo,at){var q=undoObj.args;var dUpdate=apf.xmldb.delayUpdate;
apf.xmldb.delayUpdate=true;if(!undo){for(var i=0;i<q.length;i++){if(!q[i].extra){q[i].extra={};
}if(q[0].rdbModel){q[i].rdbQueue=q[0].rdbQueue;}apf.actiontracker.actions[q[i].action](q[i],false,at);
}if(q[0].rdbModel){undoObj.rdbModel=q[0].rdbModel;undoObj.rdbQueue=q[0].rdbQueue;
}}else{for(var i=q.length-1;i>=0;i--){apf.actiontracker.actions[q[i].action](q[i],true,at);
}}apf.xmldb.delayUpdate=dUpdate;}};apf.audio.TypeFlash=function(oAudio,oNode,options){this.oAudio=oAudio;
this.isNine=apf.flash.isAvailable("9.0.0");this.DEFAULT_SWF_PATH=(apf.config.resourcePath||apf.basePath)+"resources/soundmanager2"+(this.isNine?"_flash9":"")+".swf";
this.NULL_MP3_PATH=(apf.config.resourcePath||apf.basePath)+"resources/null.mp3";
this.id=apf.flash.addPlayer(this);this.inited=false;this.divName=oAudio.$uniqueId;
this.htmlElement=oNode;this.name="soundmgr_"+oAudio.$uniqueId;this.audioPath=options.src;
this.paused=false;this.player=null;apf.extend(this,apf.audio.TypeInterface);this.delayCalls=[];
this.totalTime=this.bytesLoaded=this.totalBytes=0;this.state=null;this.autoPlay=this.autoLoad=this.firstLoad=true;
this.volume=50;this.playheadTime=null;this.bufferTime=0.1;this.playheadUpdateInterval=1000;
this.setOptions(options).createPlayer();};apf.audio.TypeFlash.isSupported=function(){return apf.flash.isAvailable();
};apf.audio.TypeFlash.prototype={properties:["volume","autoPlay","autoLoad","playHeadTime","totalTime","bufferTime","playheadUpdateInterval"],load:function(audioPath,totalTime){this.setTotalTime(totalTime);
if(audioPath!=null){this.audioPath=audioPath;}if(this.audioPath==null&&!this.firstLoad){return this.oAudio.$errorHook({type:"error",error:"SoundManager::play - No audioPath has been set."});
}if(audioPath==null&&this.firstLoad&&!this.autoLoad){audioPath=this.audioPath;}this.firstLoad=false;
this.callMethod("unloadSound",this.NULL_MP3_PATH);if(this.isNine){this.callMethod("createSound",this.audioPath,0,true,true,true,false,false);
}else{this.callMethod("createSound",0);}this.callMethod("setVolume",this.volume).callMethod("loadSound",this.audioPath,true,this.autoPlay);
return this;},play:function(){if(!this.paused){return this.callMethod("startSound",1,0);
}return this.pause();},pause:function(){this.paused=!this.paused;return this.callMethod("pauseSound");
},stop:function(){return this.callMethod("stopSound",true);},seek:function(seconds){return this.callMethod("setPosition",seconds,this.paused);
},setVolume:function(iVol){return this.callMethod("setVolume",iVol);},getPlayheadTime:function(){return this.playheadTime;
},setPlayheadTime:function(value){return this.playheadTime=value;},getTotalTime:function(){return this.totalTime;
},setTotalTime:function(value){if(!value){return;}return this.totalTime=value;},callMethod:function(){if(!this.inited||!this.player||!this.player.callMethod){this.delayCalls.push(arguments);
}else{var args=Array.prototype.slice.call(arguments);args.unshift(this.player,"callMethod");
apf.flash.remote.apply(null,args);}return this;},makeDelayCalls:function(){for(var i=0,l=this.delayCalls.length;
i<l;i++){this.callMethod.apply(this,this.delayCalls[i]);}return this;},event:function(eventName,evtObj){switch(eventName){case"progress":this.bytesLoaded=evtObj.bytesLoaded;
this.totalBytes=evtObj.totalBytes;this.oAudio.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});
break;case"playheadUpdate":this.playheadTime=evtObj.playheadTime;this.totalTime=evtObj.totalTime;
this.oAudio.$changeHook({type:"change",playheadTime:this.playheadTime,totalTime:this.totalTime});
if(evtObj.waveData||evtObj.peakData||evtObj.eqData){this.oAudio.$metadataHook({type:"metadata",waveData:evtObj.waveData,peakData:evtObj.peakData,eqData:evtObj.eqData});
}break;case"stateChange":this.state=evtObj.state;this.oAudio.$stateChangeHook({type:"stateChange",state:this.state});
break;case"change":this.oAudio.$changeHook({type:"change"});break;case"complete":this.oAudio.$completeHook({type:"complete"});
break;case"ready":this.callMethod("setPan",0);if(this.paused&&this.autoPlay){this.paused=false;
}this.oAudio.$readyHook({type:"ready"});break;case"metaData":this.oAudio.$metadataHook({type:"metaData",infoObject:evtObj});
break;case"cuePoint":this.oAudio.$cuePointHook({type:"cuePoint",infoObject:evtObj});
break;case"init":if(this.inited){return;}this.inited=true;this.makeDelayCalls();
this.player.callMethod("setPolling",true);this.oAudio.$initHook(apf.extend(evtObj,apf.flash.getSandbox(evtObj.sandboxType)));
break;case"id3":this.oAudio.$metadataHook({type:"metadata",id3Data:evtObj});break;
case"debug":apf.console.log(">> SWF DBUG: "+evtObj.msg);break;}},createPlayer:function(){var div=this.htmlElement;
if(div==null){return this;}div.style.position="absolute";div.style.width="1px";
div.style.height="1px";div.style.left="-2000px";apf.flash.embed({context:this,htmlNode:div,property:"player",src:this.DEFAULT_SWF_PATH,align:"middle",id:this.name,quality:"high",name:this.name,flashvars:"playerID="+this.id,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",menu:"true"});
return this;},$destroy:function(){this.callMethod("destroySound");if(this.player){delete this.player;
this.player=null;}}};apf.audio.TypeNative=function(oAudio,oNode,options){this.oAudio=oAudio;
this.inited=false;this.divName=oAudio.$uniqueId;this.htmlElement=oNode;this.name="soundmgr_"+oAudio.$uniqueId;
this.audioPath=options.src;this.paused=false;this.player=null;apf.extend(this,apf.audio.TypeInterface);
this.setOptions(options).createPlayer();};apf.audio.TypeNative.isSupported=function(){return apf.hasAudio;
};apf.audio.TypeNative.prototype={load:function(audioPath,totalTime){if(totalTime!=null){this.setTotalTime(totalTime);
}if(audioPath!=null){this.audioPath=audioPath;}if(this.audioPath==null&&!this.firstLoad){return this.oAudio.$errorHook({type:"error",error:"SoundManager::play - No audioPath has been set."});
}if(audioPath==null&&this.firstLoad&&!this.autoLoad){audioPath=this.audioPath;}this.firstLoad=false;
this.setVolume(this.volume);return this;},play:function(){if(!this.paused){return this.player.play();
}return this.pause();},pause:function(){return this.player.pause();},stop:function(){return this.player.stop();
},seek:function(ms){return this.player.currentTime=parseInt(ms)/1000;},setVolume:function(iVol){this.player.volume=parseInt(iVol)/100;
return this;},getPlayheadTime:function(){return this.player.playheadTime;},setPlayheadTime:function(value){this.playheadTime=parseInt(value);
return this;},getTotalTime:function(){return this.totalTime;},setTotalTime:function(value){this.totalTime=parseInt(value);
return this;},event:function(eventName,evtObj){switch(eventName){case"progress":this.bytesLoaded=evtObj.bytesLoaded;
this.totalBytes=evtObj.totalBytes;this.oAudio.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});
break;case"playheadUpdate":this.playheadTime=evtObj.playheadTime;this.totalTime=evtObj.totalTime;
this.oAudio.$changeHook({type:"change",playheadTime:this.playheadTime,totalTime:this.totalTime});
if(evtObj.waveData||evtObj.peakData||evtObj.eqData){this.oAudio.$metadataHook({type:"metadata",waveData:evtObj.waveData,peakData:evtObj.peakData,eqData:evtObj.eqData});
}break;case"stateChange":this.state=evtObj.state;this.oAudio.$stateChangeHook({type:"stateChange",state:this.state});
break;case"change":this.oAudio.$changeHook({type:"change"});break;case"complete":this.oAudio.$completeHook({type:"complete"});
break;case"ready":if(this.paused&&this.autoPlay){this.paused=false;}this.oAudio.$readyHook({type:"ready"});
break;case"metaData":this.oAudio.$metadataHook({type:"metaData",infoObject:evtObj});
break;case"cuePoint":this.oAudio.$cuePointHook({type:"cuePoint",infoObject:evtObj});
break;case"init":this.inited=true;this.oAudio.$initHook(apf.extend(evtObj,apf.flash.getSandbox(evtObj.sandboxType)));
break;case"id3":this.oAudio.$metadataHook({type:"metadata",id3Data:evtObj});break;
case"debug":apf.console.log(">> SWF DBUG: "+evtObj.msg);break;}},createPlayer:function(){var div=this.htmlElement;
if(div==null){return this;}div.style.position="absolute";div.style.width="1px";
div.style.height="1px";div.style.left="-2000px";var a=this.player=document.createElement("audio");
a.setAttribute("src",this.audioPath);a.setAttribute("volume",this.volume);if(this.autoPlay){a.setAttribute("autoplay","true");
}div.appendChild(a);var _self=this,timeHandler;a.addEventListener("canplay",function(){_self.oAudio.$readyHook({type:"ready"});
},false);a.addEventListener("timeupdate",timeHandler=function(e){_self.playheadTime=parseInt(_self.player.currentTime||0)*1000;
_self.totalTime=parseInt(_self.player.duration)*1000;_self.oAudio.$changeHook({type:"change",playheadTime:_self.playheadTime,totalTime:_self.totalTime});
},false);a.addEventListener("duration",timeHandler,false);a.addEventListener("volumechange",function(){_self.oAudio.$changeHook({type:"change",volume:_self.player.muted?0:parseInt(_self.player.volume)*100});
},false);a.addEventListener("progress",function(e){_self.bytesLoaded=e.loaded;_self.totalBytes=e.total;
_self.oAudio.$progressHook({type:"progress",bytesLoaded:_self.bytesLoaded,totalBytes:_self.totalBytes});
},false);a.addEventListener("ended",function(){_self.oAudio.$completeHook({type:"complete"});
},false);a.addEventListener("error",function(e){throw new Error(apf.formatErrorString(0,_self,"Audio playback",e.message,_self.oAudio));
},false);a.load();return this;},$destroy:function(){if(!this.player){return;}this.player.setAttribute("src","");
delete this.player;this.player=null;}};if(apf.hasRequireJS){require.def("apf/elements/dbg/chromedebughost",["debug/ChromeDebugMessageStream","debug/WSChromeDebugMessageStream","debug/DevToolsService","debug/V8DebuggerService","debug/V8Debugger","apf/elements/dbg/v8debugger"],function(ChromeDebugMessageStream,WSChromeDebugMessageStream,DevToolsService,V8DebuggerService,V8Debugger,APFV8Debugger){var ChromeDebugHost=function(hostname,port,o3obj,ws){this.$hostname=hostname;
this.$port=port;this.$o3obj=o3obj;this.$ws=ws;this.$debuggers={};this.$init();this.$connect(function(){});
};(function(){this.$connect=function(callback){var self=this;if(this.state=="connected"){return callback.call(this);
}else{this.addEventListener("connect",function(){self.removeEventListener("connect",arguments.callee);
callback.call(self);});}if(this.state=="connecting"){return;}this.state="connecting";
if(!this.$ws){var socket=this.$socket=new O3Socket(this.$hostname,this.$port,this.$o3obj);
var msgStream=new ChromeDebugMessageStream(socket);}else{var msgStream=new WSChromeDebugMessageStream(this.$ws);
}msgStream.addEventListener("connect",function(){self.$dts=new DevToolsService(msgStream);
self.$v8ds=new V8DebuggerService(msgStream);self.state="connected";self.dispatchEvent("connect");
window.onunload=self.disconnect.bind(self);});msgStream.connect();};this.loadTabs=function(model){var self=this;
this.$connect(function(){self.$dts.listTabs(function(tabs){var xml=[];for(var i=0;
i<tabs.length;i++){xml.push("<tab id='",tabs[i][0],"' url='",apf.escapeXML(tabs[i][1]+""),"' />");
}model.load("<tabs>"+xml.join("")+"</tabs>");});});};this.attach=function(tabId,callback){var dbg;
if(dbg=this.$debuggers[tabId]){return callback(null,dbg);}var self=this;this.$connect(function(){self.$v8ds.attach(tabId,function(){dbg=new APFV8Debugger(new V8Debugger(tabId,self.$v8ds),this);
self.$debuggers[tabId]=dbg;callback(null,dbg);});});};this.detach=function(dbg,callback){var self=this;
for(var id in this.$debuggers){if(this.$debuggers[id]==dbg){this.$v8ds.detach(id,function(err){delete self.$debuggers[id];
dbg.dispatchEvent("detach");callback&&callback(err);});break;}}};this.disconnect=function(callback){var debuggers=[];
for(var id in this.$debuggers){debuggers.push(id);}var self=this;var detachNext=function(){if(debuggers.length){var id=debuggers.shift();
var dbg=self.$debuggers[id];self.$v8ds.detach(id,function(){detachNext();dbg.dispatchEvent("detach");
});}else{self.$socket.close();self.$debuggers={};self.dispatchEvent("disconnect",{});
callback&&callback();}};detachNext();};}).call(ChromeDebugHost.prototype=new apf.Class());
return ChromeDebugHost;});}if(apf.hasRequireJS){require.def("apf/elements/dbg/v8debugger",["debug/Breakpoint"],function(Breakpoint){var V8Debugger=function(dbg,host){this.$init();
this.$debugger=dbg;this.$host=host;this.$breakpoints={};var _self=this;dbg.addEventListener("changeRunning",function(e){_self.dispatchEvent("changeRunning",e);
if(dbg.isRunning()){_self.setFrame(null);}});dbg.addEventListener("break",function(e){_self.dispatchEvent("break",e);
});dbg.addEventListener("afterCompile",function(e){_self.dispatchEvent("afterCompile",{script:apf.getXml(_self.$getScriptXml(e.data.script))});
});this.setFrame(null);};(function(){var hasChildren={object:8,"function":4};this.stripPrefix="";
this.setStrip=function(stripPrefix){this.stripPrefix=stripPrefix;};this.$strip=function(str){if(!this.stripPrefix){return str;
}if(str.indexOf(this.stripPrefix)==0){return str.slice(this.stripPrefix.length);
}else{return str;}};this.isRunning=function(){return this.$debugger.isRunning();
};this.scripts=function(model,callback){var _self=this;this.$debugger.scripts(4,null,false,function(scripts){var xml=[];
for(var i=0;i<scripts.length;i++){var script=scripts[i];if(script.name&&script.name.indexOf("chrome-extension://")==0){continue;
}xml.push(_self.$getScriptXml(script));}model.load("<sources>"+xml.join("")+"</sources>");
callback();});};this.$getScriptXml=function(script){return["<file scriptid='",script.id,"' scriptname='",apf.escapeXML(script.name||"anonymous"),"' text='",this.$strip(apf.escapeXML(script.text||"anonymous")),"' lineoffset='",script.lineOffset,"' debug='true' />"].join("");
};function getId(frame){return(frame.func.name||frame.func.inferredName||(frame.line+frame.position));
}this.$isEqual=function(xmlFrameSet,frameSet){if(xmlFrameSet.length!=frameSet.length){return false;
}var xmlFirst=xmlFrameSet[0];var first=frameSet[0];if(xmlFirst.getAttribute("scriptid")!=first.func.scriptId){return false;
}if(xmlFirst.getAttribute("id")!=getId(first)){return false;}return true;};this.$updateFrame=function(xmlFrame,frame){xmlFrame.setAttribute("line",frame.line);
xmlFrame.setAttribute("column",frame.column);var vars=xmlFrame.selectNodes("vars/item");
var fVars=frame.arguments;for(var i=1,j=0;j<fVars.length;j++){if(fVars[j].name){this.$updateVar(vars[i++],fVars[j]);
}}var fVars=frame.locals;for(var j=0;j<frame.locals.length;j++){if(fVars[j].name!==".arguments"){this.$updateVar(vars[i++],fVars[j]);
}}},this.$updateVar=function(xmlVar,fVar){xmlVar.setAttribute("value",this.$valueString(fVar.value));
xmlVar.setAttribute("type",fVar.value.type);xmlVar.setAttribute("ref",fVar.value.ref);
apf.xmldb.setAttribute(xmlVar,"children",hasChildren[fVar.value.type]?"true":"false");
};this.$buildFrame=function(frame,ref,xml){var script=ref(frame.script.ref);xml.push("<frame index='",frame.index,"' name='",apf.escapeXML(apf.escapeXML(this.$frameToString(frame))),"' column='",frame.column,"' id='",getId(frame),"' ref='",frame.ref,"' line='",frame.line,"' script='",this.$strip(script.name),"' scriptid='",frame.func.scriptId,"'>");
xml.push("<vars>");var receiver={name:"this",value:frame.receiver};xml.push(this.$serializeVariable(receiver));
for(var j=0;j<frame.arguments.length;j++){if(frame.arguments[j].name){xml.push(this.$serializeVariable(frame.arguments[j]));
}}for(var j=0;j<frame.locals.length;j++){if(frame.locals[j].name!==".arguments"){xml.push(this.$serializeVariable(frame.locals[j]));
}}xml.push("<globals />");xml.push("</vars>");xml.push("<scopes>");var scopes=frame.scopes;
for(var j=0;j<scopes.length;j++){var scope=scopes[j];xml.push("<scope index='",scope.index,"' type='",scope.type,"' />");
}xml.push("</scopes>");xml.push("</frame>");};this.backtrace=function(model,callback){var _self=this;
this.$debugger.backtrace(null,null,null,true,function(body,refs){function ref(id){for(var i=0;
i<refs.length;i++){if(refs[i].handle==id){return refs[i];}}return{};}var frames=body.frames;
var xmlFrames=model.queryNodes("frame");if(xmlFrames.length&&_self.$isEqual(xmlFrames,frames)){for(var i=0;
i<frames.length;i++){_self.$updateFrame(xmlFrames[i],frames[i]);}_self.setFrame(xmlFrames[0]);
}else{var xml=[];if(frames){for(var i=0;i<frames.length;i++){_self.$buildFrame(frames[i],ref,xml);
}}model.load("<frames>"+xml.join("")+"</frames>");_self.setFrame(model.data.firstChild);
}callback();});};this.loadScript=function(script,callback){var id=script.getAttribute("scriptid");
var _self=this;this.$debugger.scripts(4,[id],true,function(scripts){if(scripts.length){var script=scripts[0];
callback(script.source);}});};this.loadObjects=function(item,callback){var ref=item.getAttribute("ref");
var _self=this;this.$debugger.lookup([ref],false,function(body){var refs=[];var props=body[ref].properties;
for(var i=0;i<props.length;i++){refs.push(props[i].ref);}_self.$debugger.lookup(refs,false,function(body){var xml=["<item>"];
for(var i=0;i<props.length;i++){props[i].value=body[props[i].ref];xml.push(_self.$serializeVariable(props[i]));
}xml.push("</item>");callback(xml.join(""));});});};this.loadFrame=function(frame,callback){var scopes=frame.getElementsByTagName("scope");
var frameIndex=parseInt(frame.getAttribute("index"));var _self=this;var processed=0;
var expected=0;var xml=["<vars>"];for(var i=0;i<scopes.length;i++){var scope=scopes[i];
var type=parseInt(scope.getAttribute("type"));if(type>1){expected+=1;var index=parseInt(scope.getAttribute("index"));
this.$debugger.scope(index,frameIndex,true,function(body){var props=body.object.properties;
for(j=0;j<props.length;j++){xml.push(_self.$serializeVariable(props[j]));}processed+=1;
if(processed==expected){xml.push("</vars>");callback(xml.join(""));}});}}if(expected==0){return callback("<vars />");
}};this.setFrame=function(frame){this.$activeFrame=frame;this.dispatchEvent("changeFrame",{data:frame});
};this.getActiveFrame=function(){return this.$activeFrame;};this.setBreakpoints=function(model,callback){var _self=this;
var breakpoints=model.queryNodes("breakpoint");_self.$debugger.listbreakpoints(function(v8Breakpoints){if(v8Breakpoints.breakpoints){for(var id in _self.$breakpoints){_self.$breakpoints[id].destroy();
}_self.$breakpoints={};for(var i=0,l=v8Breakpoints.breakpoints.length;i<l;i++){if(v8Breakpoints.breakpoints[i].type=="scriptId"){continue;
}var breakpoint=Breakpoint.fromJson(v8Breakpoints.breakpoints[i],_self.$debugger);
var id=breakpoint.source+"|"+breakpoint.line;_self.$breakpoints[id]=breakpoint;
model.removeXml("breakpoint[@script='"+breakpoint.source+"' and @line='"+breakpoint.line+"']");
model.appendXml(_self.$getBreakpointXml(breakpoint,0));}}var modelBps=model.queryNodes("breakpoint")||[];
apf.asyncForEach(Array.prototype.slice.call(modelBps,0),function(modelBp,next){var script=modelBp.getAttribute("script");
var line=modelBp.getAttribute("line");var id=script+"|"+line;var bp=_self.$breakpoints[id];
if(!bp){bp=_self.$breakpoints[id]=new Breakpoint(script,line,modelBp.getAttribute("column"));
bp.condition=modelBp.getAttribute("condition");bp.ignoreCount=parseInt(modelBp.getAttribute("ignorecount")||0);
bp.enabled=modelBp.getAttribute("enabled")=="true";bp.attach(_self.$debugger,function(){if(modelBp.parentNode){model.removeXml(modelBp);
}model.appendXml(_self.$getBreakpointXml(bp,0));next();});}else{if(modelBp.parentNode){model.removeXml(modelBp);
}model.appendXml(_self.$getBreakpointXml(bp,0));next();}},callback);});};this.toggleBreakpoint=function(script,relativeRow,model){var _self=this;
var name=script.getAttribute("scriptname");var lineOffset=parseInt(script.getAttribute("lineoffset")||"0");
var row=lineOffset+relativeRow;var id=name+"|"+row;var breakpoint=this.$breakpoints[id];
if(breakpoint){delete this.$breakpoints[id];breakpoint.clear(function(){model.removeXml(model.queryNode("breakpoint[@id="+breakpoint.$id+"]"));
});}else{breakpoint=this.$breakpoints[id]=new Breakpoint(name,row);breakpoint.attach(this.$debugger,function(){model.appendXml(_self.$getBreakpointXml(breakpoint,lineOffset,script.getAttribute("scriptid")));
});}};this.$getBreakpointXml=function(breakpoint,lineOffset,scriptId){var xml=[];
xml.push("<breakpoint"," id='",breakpoint.$id,"' text='",this.$strip(apf.escapeXML(breakpoint.source)),":",breakpoint.line,"' script='",apf.escapeXML(breakpoint.source),scriptId?"' scriptid='"+scriptId:"","' lineoffset='",lineOffset||0,"' line='",breakpoint.line,"' condition='",apf.escapeXML(breakpoint.condition||""),"' ignorecount='",breakpoint.ignoreCount||0,"' enabled='",breakpoint.enabled,"' />");
return(xml.join(""));};this.continueScript=function(callback){this.$debugger.continueScript(null,null,callback);
};this.stepInto=function(callback){this.$debugger.continueScript("in",1,callback);
};this.stepNext=function(callback){this.$debugger.continueScript("next",1,callback);
};this.stepOut=function(callback){this.$debugger.continueScript("out",1,callback);
};this.suspend=function(){this.$debugger.suspend();};this.changeLive=function(scriptId,newSource,previewOnly,callback){this.$debugger.changelive(scriptId,newSource,previewOnly,callback);
};this.evaluate=function(expression,frame,global,disableBreak,callback){this.$debugger.evaluate(expression,frame,global,disableBreak,function(body,refs,error){var str=[];
var name=expression.trim().split(/;|\n/).pop().trim().replace(/"/g,"&quot;");if(error){str.push("<item type='.error' name=\"",apf.escapeXML(name),"\" value='",error.message,"' />");
}else{str.push('<item name="',apf.escapeXML(name),"\" value='",apf.escapeXML(body.text),"' type='",body.type,"' ref='",body.handle,body.constructorFunction?"' constructor='"+body.constructorFunction.ref:"",body.prototypeObject?"' prototype='"+body.prototypeObject.ref:"",body.properties&&body.properties.length?"' children='true":"","' />");
}callback(apf.getXml(str.join("")),body,refs,error);});};this.$valueString=function(value){switch(value.type){case"undefined":case"null":return value.type;
case"boolean":case"number":case"string":return value.value+"";case"object":return"["+value.className+"]";
case"function":return"function "+value.inferredName+"()";default:return value.type;
}};this.$frameToString=function(frame){var str=[];str.push(frame.func.name||frame.func.inferredName||"anonymous","(");
var args=frame.arguments;var argsStr=[];for(var i=0;i<args.length;i++){var arg=args[i];
if(!arg.name){continue;}argsStr.push(arg.name);}str.push(argsStr.join(", "),")");
return str.join("");};this.$serializeVariable=function(item,name){var str=[];str.push("<item name='",apf.escapeXML(name||item.name),"' value='",apf.escapeXML(this.$valueString(item.value)),"' type='",item.value.type,"' ref='",typeof item.value.ref=="number"?item.value.ref:item.value.handle,hasChildren[item.value.type]?"' children='true":"","' />");
return str.join("");};}).call(V8Debugger.prototype=new apf.Class());return V8Debugger;
});}if(apf.hasRequireJS){require.def("apf/elements/dbg/v8debughost",["debug/StandaloneV8DebuggerService","debug/V8Debugger","apf/elements/dbg/v8debugger"],function(StandaloneV8DebuggerService,V8Debugger,APFV8Debugger){var V8DebugHost=function(hostname,port,o3obj){this.$hostname=hostname;
this.$port=port;this.$o3obj=o3obj;this.$debugger=null;this.$init();};(function(){this.$connect=function(callback){var self=this;
if(this.state=="connected"){return callback.call(this);}else{this.addEventListener("connect",function(){self.removeEventListener("connect",arguments.callee);
callback.call(self);});}if(this.state=="connecting"){return;}this.state="connecting";
var socket=this.$socket=new O3Socket(this.$hostname,this.$port,this.$o3obj);this.$v8ds=new StandaloneV8DebuggerService(socket);
this.state="connected";this.dispatchEvent("connect");window.onunload=this.disconnect.bind(this);
callback.call(this);};this.loadTabs=function(model){model.load("<tabs><tab id='0'>V8</tab></tabs>");
};this.attach=function(tabId,callback){var dbg=this.$debugger;if(dbg){return callback(null,dbg);
}var self=this;this.$connect(function(){self.$v8ds.attach(0,function(){dbg=new APFV8Debugger(new V8Debugger(0,self.$v8ds),this);
self.$debugger=dbg;callback(null,dbg);});});};this.detach=function(dbg,callback){if(!dbg||this.$debugger!==dbg){return callback();
}this.$debugger=null;var self=this;this.$v8ds.detach(0,function(err){dbg.dispatchEvent("detach");
self.$socket.close();self.dispatchEvent("disconnect",{});callback&&callback(err);
});};this.disconnect=function(callback){this.detach(this.$debugger,callback);};
}).call(V8DebugHost.prototype=new apf.Class());return V8DebugHost;});}if(apf.hasRequireJS){require.def("apf/elements/dbg/v8websocketdebughost",["debug/WSV8DebuggerService","debug/V8Debugger","apf/elements/dbg/v8debugger"],function(WSV8DebuggerService,V8Debugger,APFV8Debugger){var V8WebSocketDebugHost=function(socket){this.$socket=socket;
this.$debugger=null;this.$init();};(function(){this.$connect=function(callback){if(this.state!="connected"){this.$v8ds=new WSV8DebuggerService(this.$socket);
}this.state="connected";this.dispatchEvent("connect");callback.call(this);};this.loadTabs=function(model){model.load("<tabs><tab id='0'>V8</tab></tabs>");
};this.attach=function(tabId,callback){var dbg=this.$debugger;if(dbg){return callback(null,dbg);
}var self=this;this.$connect(function(){self.$v8ds.attach(0,function(){dbg=new APFV8Debugger(new V8Debugger(0,self.$v8ds),this);
self.$debugger=dbg;callback(null,dbg);});});};this.detach=function(dbg,callback){if(!dbg||this.$debugger!==dbg){return callback();
}this.$debugger=null;var self=this;this.$v8ds.detach(0,function(err){dbg.dispatchEvent("detach");
self.dispatchEvent("disconnect",{});callback&&callback(err);});};this.disconnect=function(callback){this.detach(this.$debugger,callback);
};}).call(V8WebSocketDebugHost.prototype=new apf.Class());return V8WebSocketDebugHost;
});}apf.modalwindow.widget=function(){var nX,nY,verdiff,hordiff,cData;var _self=this;
this.$isWindowContainer=false;this.kbclose=false;this.$isWidget=true;this.dragStart=function(e){if(!e){e=event;
}if(_self.state.indexOf("maximized")>-1||!_self.draggable){return;}nX=_self.$ext.offsetLeft-e.clientX-document.documentElement.scrollLeft;
nY=_self.$ext.offsetTop-e.clientY-document.documentElement.scrollTop;var htmlNode=_self.$ext;
var p=_self.positionHolder;if(!p){var p=this.positionHolder=document.body.appendChild(document.createElement("div"));
}p.className="position_holder";htmlNode.parentNode.insertBefore(p,htmlNode);p.style.height=(htmlNode.offsetHeight-(apf.isIE6?0:apf.getHeightDiff(p)))+"px";
var lastSize=[htmlNode.style.width,htmlNode.style.height];htmlNode.style.width=(htmlNode.offsetWidth-apf.getWidthDiff(htmlNode))+"px";
htmlNode.style.left=(e.clientX+nX)+"px";htmlNode.style.top=(e.clientY+nY)+"px";
htmlNode.style.position="absolute";htmlNode.style.zIndex=htmlNode.parentNode.style.zIndex=100000;
htmlNode.parentNode.style.left="0";htmlNode.parentNode.style.minHeight=(htmlNode.parentNode.offsetHeight-apf.getHeightDiff(htmlNode.parentNode))+"px";
if(apf.isIE<8){apf.setStyleClass(htmlNode,"dockletDrag");}if(!apf.hasStyleFilters){apf.tween.fade(htmlNode,0.8);
}apf.dragMode=true;cData=[htmlNode,p];document.onmousemove=_self.dragMove;document.onmouseup=function(){document.onmousemove=document.onmouseup=null;
htmlNode.style.position="";htmlNode.style.left=0;htmlNode.style.top=0;htmlNode.style.width=lastSize[0];
htmlNode.style.zIndex=htmlNode.parentNode.style.zIndex=1;htmlNode.parentNode.style.minHeight="";
p.parentNode.insertBefore(htmlNode,p);p.parentNode.removeChild(p);apf.tween.fade(htmlNode,1);
if(apf.isIE<8){apf.setStyleClass(htmlNode,"",["dockletDrag"]);}_self.parentNode.$moveDocklet(_self);
if(!apf.supportOpacity||htmlNode.className.indexOf("dockblank")>-1){htmlNode.style.filter="";
}if(_self.$ext){apf.layout.forceResize(_self.$ext);}apf.dragMode=false;};if(apf.isIE){document.onmousemove();
}e.cancelBubble=true;return false;};function insertInColumn(el,ey){var pos=apf.getAbsolutePosition(el);
var cy=ey-pos[1];var nodes=el.childNodes;for(var th=0,i=0,l=nodes.length;i<l;i++){var node=nodes[i];
if(node.nodeType!=1||apf.getStyle(node,"position")=="absolute"){continue;}th=node.offsetTop+node.offsetHeight;
if(th>cy){el.insertBefore(cData[1],th-(node.offsetHeight/2)>cy?node:node.nextSibling);
break;}}if(i==nodes.length){el.appendChild(cData[1]);}}this.dragMove=function(e){if(!e){e=event;
}_self.$ext.style.top="10000px";var ex=e.clientX;var ey=e.clientY;var el=document.elementFromPoint(ex,ey);
if(el){if(el.isColumn){insertInColumn(el,ey);}else{while(el.parentNode&&!el.isColumn){el=el.parentNode;
}if(el.isColumn){insertInColumn(el,ey);}}}_self.$ext.style.left=(e.clientX+nX+document.documentElement.scrollLeft)+"px";
_self.$ext.style.top=(e.clientY+nY+document.documentElement.scrollTop)+"px";e.cancelBubble=true;
};this.$loadAml=function(x){this.$create();};this.$create=function(){apf.WinServer.setTop(this);
var diff=apf.getDiff(this.$ext);hordiff=diff[0];verdiff=diff[1];this.oDrag.onmousedown=this.dragStart;
this.collapsedHeight=this.$getOption("Main","collapsed-height");if(this.resizable){this.resizable=false;
}if(this.draggable===undefined){this.draggable=true;}this.minwidth=this.$getOption("Main","min-width");
this.minheight=this.$getOption("Main","min-height");};};apf.cgi=function(){this.supportMulticall=false;
this.namedArguments=true;this.unserialize=function(str){return str;};this.getSingleCall=function(name,args,obj){obj.push(args);
};this.createMessage=function(functionName,args){var prop,vars=[];function recur(o,stack){if(o&&o.dataType==apf.ARRAY){for(var j=0;
j<o.length;j++){recur(o[j],stack+"%5B"+j+"%5D");}}else{if(o&&typeof o=="object"){if(o.nodeType){try{var s=o.outerHTML||o.serialize&&o.serialize()||apf.getCleanCopy(o).xml;
}catch(e){var s="Could not serialize object";}vars.push(stack+"="+encodeURIComponent(s));
}else{for(prop in o){if(apf.isSafariOld&&(!o[prop]||typeof o[prop]!="object")){continue;
}if(typeof o[prop]=="function"){continue;}recur(o[prop],stack+"%5B"+encodeURIComponent(prop)+"%5D");
}}}else{if(typeof o!="undefined"&&o!==null){vars.push(stack+"="+encodeURIComponent(o));
}}}}if(this.multicall){vars.push("func="+this.mcallname);for(var i=0;i<args[0].length;
i++){recur(args[0][i],"f%5B"+i+"%5D");}}else{for(prop in args){if(apf.isSafariOld&&(!args[prop]||typeof args[prop]=="function")){continue;
}recur(args[prop],prop);}}if(!this.baseUrl){this.baseUrl=this.url;}this.url=this.$methods[functionName].url?this.$methods[functionName].url:this.baseUrl;
if(this.method!="GET"){return vars.join("&");}this.url=this.url+(vars.length?(this.url.indexOf("?")>-1?"&":"?")+vars.join("&"):"");
return"";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.method=(this["http-method"]||"GET").toUpperCase();
this.contentType=this.method=="GET"?null:"application/x-www-form-urlencoded";});
this.submitForm=function(form,callback){if(!this["postform"]){this.addMethod("postform",callback);
}var args=[];for(var i=0,l=form.elements.length;i<l;i++){if(!form.elements[i].name){continue;
}if(form.elements[i].tagname=="input"&&(form.elements[i].type=="checkbox"||form.elements[i].type=="radio")&&!form.elements[i].checked){continue;
}if(form.elements[i].tagname="select"&&form.elements[i].multiple){for(var j=0;j<form.elements[i].options.length;
j++){if(form.elements[i].options[j].selected){args.push(form.elements[i].name+"="+encodeURIComponent(form.elements[i].options[j].value));
}}}else{args.push(form.elements[i].name+"="+encodeURIComponent(form.elements[i].value));
}}var loc=(form.action||location.href);this.urls.postform=loc+(loc.indexOf("?")>-1?"&":"?")+args.join("&");
this["postform"].call(this);return false;};};apf.header=function(){this.supportMulticall=false;
this.method="GET";this.vartype="header";this.isXML=true;this.namedArguments=true;
this.unserialize=function(str){return str;};this.createMessage=function(functionName,args){for(var hFunc=[],i=0,l=args.length;
i<l;i++){if(!args[i][0]||!args[i][1]){continue;}apf.console.info("<strong>"+args[i][0]+":</strong> "+args[i][1]+"<br />","teleport");
http.setRequestHeader(args[i][0],args[i][1]);}this.$HeaderHook=new Function("http",hFunc.join("\n"));
return"";};};apf.jphp=function(){this.supportMulticall=true;this.multicall=false;
this.mcallname="multicall";this.method="POST";this.useXML=true;this.namedArguments=false;
var createMessage={host:this,0:function(ob){var ob=ob.valueOf();var length=0,x="",prop;
for(prop in ob){if(typeof this[prop]!="function"){length++;var r=prop;x+=this.host.doSerialize(r)+";"+this.host.doSerialize(ob[r])+(typeof ob[r]=="object"||typeof ob[r]=="array"?"":";");
}}if(ob.className){return"O:"+ob.className.length+':"'+ob.className+'":'+length+":{"+x.substr(0,x.length)+"}";
}return"a:"+length+":{"+x.substr(0,x.length)+"}";},5:function(str){var str=str.replace(/[\r]/g,"");
str=str.replace(/\]\]/g,"]-]-]").replace(/\]\]/g,"]-]-]");return"s:"+str.length+':"'+str+'"';
},2:function(nr){if(nr==parseInt(nr)){return"i:"+nr;}else{if(nr==parseFloat(nr)){return"d:"+nr;
}else{return this["boolean"](false);}}},4:function(b){return"b:"+(b==true?1:0);
},1:function(ar){var x="a:"+ar.length+":{";for(var i=0;i<ar.length;i++){x+="i:"+i+";"+this.host.doSerialize(ar[i])+(i<ar.length&&typeof ar[i]!="object"&&typeof ar[i]!="array"?";":"");
}return x+"}";}};this.unserialize=function(str){return eval(str.replace(/\|-\|-\|/g,"]]").replace(/\|\|\|/g,"\\n"));
};this.doSerialize=function(args){if(typeof args=="function"){throw new Error("Cannot Parse functions");
}else{if(apf.isNot(args)){return createMessage["boolean"](false);}}return createMessage[args.dataType||0](args);
};this.createMessage=function(functionName,args){return"<?xml version='1.0' encoding='UTF-16'?><run m='"+functionName+"'><![CDATA["+this.doSerialize(args)+"]]></run>";
};this.isValid=function(extra){var data=extra.data;if(data&&data.tagName=="data"){data=data.firstChild.nodeValue;
if(data&&data[0]=="error"){extra.message=data[1];return false;}}else{extra.message="Malformed RPC Message: Parse Error\n\n:'"+http.responseText+"'";
return false;}extra.data=data;return true;};};apf.jsonrpc=function(){this.supportMulticall=false;
this.multicall=false;this.method="POST";this.useXML=false;this.id=0;this.namedArguments=false;
this.getSingleCall=function(name,args,obj){obj.push({method:name,params:args});
};this.createMessage=function(functionName,args){this.fName=functionName;this.id++;
var message="{'method':'"+functionName+"','params':"+apf.serialize(args)+",'id':"+this.id+"}";
return message;};this.$headerHook=function(http){http.setRequestHeader("X-JSON-RPC",this.fName);
};this.unserialize=function(str){var obj=JSON.parse(str);return obj.result;};};
apf.rdb=function(){this.supportMulticall=false;this.namedArguments=true;this.queue=[];
this.unserialize=function(str){return str;};this.getSingleCall=function(name,args,obj){obj.push(args);
};this.createMessage=function(functionName,args){var prop,vars={};function recur(o,stack){if(o&&o.dataType==apf.ARRAY){for(var j=0,l=o.length;
j<l;j++){recur(o[j],stack);}}else{if(o&&typeof o=="object"){if(o.nodeType){var s;
try{s=o.outerHTML||o.serialize&&o.serialize()||apf.getCleanCopy(o).xml;}catch(e){s="Could not serialize object";
}vars[stack]=s;}else{for(prop in o){if(apf.isSafariOld&&(!o[prop]||typeof o[prop]!="object")){continue;
}if(typeof o[prop]=="function"){continue;}recur(o[prop],prop);}}}else{if(typeof o!="undefined"&&o!==null){vars[stack]=o;
}}}}if(this.multicall){vars.func=this.mcallname;for(var i=0;i<args[0].length;i++){recur(args[0][i]);
}}else{for(prop in args){if(apf.isSafariOld&&(!args[prop]||typeof args[prop]=="function")){continue;
}recur(args[prop],prop);}}vars.command=functionName;return vars;};this.$get=function(url,options){if(!this["remote"]){throw new Error(apf.formatErrorString(0,this,"Sending RDB-RPC request","No remote element found. Please specify one prior to making a request."));
}if(!this.$remote){this.$remote=apf.nameserver.get(this.remote)||self[this.remote];
var _self=this;this.$remote.transport.addEventListener("rpcresult",function(e){if(!e.sid){return;
}var t=_self.queue[parseInt(e.sid)],log=t?t.log:null;if(!log){return;}log.response({http:{getAllResponseHeaders:apf.K,status:e.status,statusText:"",responseText:JSON.stringify(e.data)}});
});}var id=this.queue.push({options:options})-1;if(!options.hideLogMessage){var data=options.data||"";
this.queue[id]={options:options};apf.console.teleport(this.queue[id].log=new apf.teleportLog({id:id,tp:this,type:"rpc",method:"GET",url:data.command,data:JSON.stringify(data),start:new Date()}));
this.queue[id].log.request([]);}this.$remote.sendRPC(id,options);};this.submitForm=function(form,callback){return false;
if(!this["postform"]){this.addMethod("postform",callback);}var args=[];for(var i=0,l=form.elements.length;
i<l;i++){if(!form.elements[i].name){continue;}if(form.elements[i].tagname=="input"&&(form.elements[i].type=="checkbox"||form.elements[i].type=="radio")&&!form.elements[i].checked){continue;
}if(form.elements[i].tagname="select"&&form.elements[i].multiple){for(var j=0;j<form.elements[i].options.length;
j++){if(form.elements[i].options[j].selected){args.push(form.elements[i].name+"="+form.elements[i].options[j].value);
}}}else{args.push(form.elements[i].name+"="+form.elements[i].value);}}var loc=(form.action||location.href);
this.urls.postform=loc+(loc.indexOf("?")>-1?"&":"?")+args.join("&");this["postform"].call(this);
return false;};};apf.rest=function(){this.supportMulticall=false;this.namedArguments=false;
this.nocache=false;this.unserialize=function(str){return str;};this.getSingleCall=function(name,args,obj){obj.push(args);
};this.createMessage=function(functionName,args){if(!this.baseUrl){this.baseUrl=this.url;
}var options=this.$methods[functionName];if("NOTIFY|SEND|POST|PUT".indexOf(options["http-method"])>-1){apf.console.log("Found method "+options["http-method"]+". Taking body from last argument");
}var body="NOTIFY|SEND|POST|PUT".indexOf(options["http-method"].toUpperCase())>-1?args.pop():"",url;
this.method=options["http-method"];if(options["content-type"]){this.contentType=options["content-type"];
}var i=0,l=args.length;for(;i<l;++i){args[i]=encodeURIComponent(args[i]);}this.url=(url=options.url?options.url:this.baseUrl)+(l?(url.charAt(url.length-1)=="/"?"":"/")+args.join("/"):"");
this.contentType=body?"application/x-www-form-urlencoded":null;return body;};};
apf.soap=function(){this.supportMulticall=false;this.method="POST";this.useXML=true;
this.nsName="m";this.nsURL="http://www.ajax.org";this.namedArguments=true;var createMessage={host:this,0:function(o){var prop,retstr,wo=o;
for(prop in wo){if(typeof wo[prop]!="function"&&prop!="type"){retstr+=this.host.doSerialize(wo[prop],prop);
}}return retstr;},5:function(s){return s.replace(/\]\]/g,"] ]");},2:function(i){return i;
},4:function(b){return b==true?1:0;},3:function(d){return doYear(d.getUTCYear())+doZero(d.getMonth())+doZero(d.getUTCDate())+"T"+doZero(d.getHours())+":"+doZero(d.getMinutes())+":"+doZero(d.getSeconds());
function doZero(nr){nr=String("0"+nr);return nr.substr(nr.length-2,2);}function doYear(year){if(year>9999||year<0){XMLRPC.handleError(new Error("Unsupported year: "+year));
}year=String("0000"+year);return year.substr(year.length-4,4);}},1:function(a){var retstr="";
for(var i=0;i<a.length;i++){retstr+=this.host.doSerialize(a[i],"item");}return retstr;
}};this.doSerialize=function(args,name){var c=name?args:args[1],name=name?name:args[0];
if(typeof c=="function"){throw new Error("Cannot Parse functions");}if(c===false){return"<"+name+' xsi:null="1"/>';
}else{return"<"+name+" "+this.getXSIType(c)+">"+createMessage[c.dataType||0](c)+"</"+name+">";
}};this.getXSIType=function(c){if(!c.dataType){return"";}else{if(c.dataType==apf.ARRAY){return'xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="xsd:ur-type['+c.length+']"';
}else{if(c.dataType==apf.NUMBER){return'xsi:type="'+(parseInt(c)==c?"xsd:int":"xsd:float")+'"';
}else{if(c.dataType=="data"){return'xsi:type="xsd:timeInstant"';}else{return'xsi:type="xsd:'+c.dataType+'"';
}}}}};this.createMessage=function(functionName,args){var message=['<?xml version="1.0"?>','<SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"',' xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"',' xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"',' xmlns:xsd="http://www.w3.org/1999/XMLSchema"',' xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance">',"<SOAP-ENV:Body><",this.nsName,":",functionName," xmlns:",this.nsName,'="',this.nsURL,'">'];
for(var param in args){message.push(this.doSerialize(args[param],param));}message.push("</",this.nsName,":",functionName,"></SOAP-ENV:Body></SOAP-ENV:Envelope>");
return message.join("");};this.$headerHook=function(http){http.setRequestHeader("SOAPAction",'"'+this.url.replace(/http:\/\/.*\/([^\/]*)$/,"$1")+'"');
};this.unserialize=function(data){return data;var ret,i,nodes;var type=data.getAttribute("xsi:type");
switch(type){case"xsd:string":return(data.firstChild)?new String(data.firstChild.nodeValue):"";
break;case"xsd:int":case"xsd:double":case"xsd:float":return(data.firstChild)?parseFloat(data.firstChild.nodeValue):0;
break;case"xsd:timeInstant":var sn=apf.dateSeparator;if(/^(\d{4})(\d{2})(\d{2})T(\d{2}):(\d{2}):(\d{2})/.test(data.firstChild.nodeValue)){return new Date(RegExp.$2+sn+RegExp.$3+sn+RegExp.$1+" "+RegExp.$4+":"+RegExp.$5+":"+RegExp.$6);
}else{return new Date();}break;case"xsd:boolean":return Boolean(isNaN(parseInt(data.firstChild.nodeValue))?(data.firstChild.nodeValue=="true"):parseInt(data.firstChild.nodeValue));
break;case"SOAP-ENC:base64":return apf.crypt.Base64.decode(data.firstChild.nodeValue);
break;case"SOAP-ENC:Array":nodes=data.childNodes;ret=[];for(i=0;i<nodes.length;
i++){if(nodes[i].nodeType!=1){continue;}ret.push(this.unserialize(nodes[i]));}return ret;
break;default:if(type&&!self[type]){throw new Error(apf.formatErrorString(1084,null,"SOAP","Invalid Object Specified in SOAP message: "+type));
}nodes=data.childNodes;var o=type?new self[type]:{};ret=[];for(i=0;i<nodes.length;
i++){if(nodes[i].nodeType!=1){continue;}ret[nodes[i].tagName]=this.unserialize(nodes[i]);
}return ret;break;}};this.isValid=function(extra){var data=extra.data;if(!apf.supportNamespaces){data.ownerDocument.setProperty("SelectionNamespaces","xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xds='http://www.w3.org/2001/XMLSchema' xmlns:SOAP-ENV='http://schemas.xmlsoap.org/soap/envelope/'");
}var rvalue=data.getElementsByTagName("SOAP-ENV:Body")[0];if(!rvalue&&data.getElementsByTagNameNS){rvalue=data.getElementsByTagNameNS("http://schemas.xmlsoap.org/soap/envelope/","Body")[0];
}extra.data=rvalue;return true;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.nsName=this["soap-prefix"]||this.nsName;
this.nsURL=this["soap-xmlns"]||this.nsURL;});};apf.xmlrpc=function(){this.supportMulticall=true;
this.multicall=false;this.mcallname="system.multicall";this.method="POST";this.useXML=true;
this.namedArguments=false;var createMessage={host:this,0:function(o){var prop,retstr="<struct>",wo=o;
for(prop in wo){if(typeof wo[prop]!="function"&&prop!="type"){retstr+="<member><name>"+prop+"</name><value>"+this.host.doSerialize(wo[prop])+"</value></member>";
}}retstr+="</struct>";return retstr;},5:function(s){return"<string><![CDATA["+apf.xmlentities(s)+"]]></string>";
},2:function(i){if(i==parseInt(i)){return"<int>"+i+"</int>";}else{if(i==parseFloat(i)){return"<double>"+i+"</double>";
}else{return this["boolean"](false);}}},4:function(b){if(b==true){return"<boolean>1</boolean>";
}else{return"<boolean>0</boolean>";}},3:function(d){return"<dateTime.iso8601>"+doYear(d.getUTCYear())+doZero(d.getMonth())+doZero(d.getUTCDate())+"T"+doZero(d.getHours())+":"+doZero(d.getMinutes())+":"+doZero(d.getSeconds())+"</dateTime.iso8601>";
function doZero(nr){nr=String("0"+nr);return nr.substr(nr.length-2,2);}function doYear(year){if(year>9999||year<0){XMLRPC.handleError(new Error(apf.formatErrorString(1085,null,"XMLRPC serialization","Unsupported year: "+year)));
}year=String("0000"+year);return year.substr(year.length-4,4);}},1:function(a){var retstr="<array><data>";
for(var i=0;i<a.length;i++){retstr+="<value>";retstr+=this.host.doSerialize(a[i]);
retstr+="</value>";}return retstr+"</data></array>";}};this.getSingleCall=function(name,args,obj){obj.push({m:name,p:args});
};this.doSerialize=function(args){if(typeof args=="function"){throw new Error(apf.formatErrorString(1086,null,"XMLRPC serialization","Cannot Parse functions"));
}else{if(apf.isNot(args)){return createMessage["boolean"](false);}}return createMessage[args.dataType||0](args);
};this.createMessage=function(functionName,args){var message=['<?xml version="1.0" encoding="UTF-8"?><methodCall><methodName>',functionName,"</methodName><params>"];
for(var i=0;i<args.length;i++){message.push("<param><value>",this.doSerialize(args[i]),"</value></param>");
}message.push("</params></methodCall>");return message.join("");};this.unserialize=function(data){var ret,i;
switch(data.tagName){case"string":if(apf.isGecko){data=(new XMLSerializer()).serializeToString(data);
data=data.replace(/^\<string\>/,"");data=data.replace(/\<\/string\>$/,"");data=data.replace(/\&lt;/g,"<");
data=data.replace(/\&gt;/g,">");return data;}return(data.firstChild)?data.firstChild.nodeValue:"";
break;case"int":case"i4":case"double":return(data.firstChild)?new Number(data.firstChild.nodeValue):0;
break;case"dateTime.iso8601":var sn=apf.dateSeparator;if(/^(\d{4})(\d{2})(\d{2})T(\d{2}):(\d{2}):(\d{2})/.test(data.firstChild.nodeValue)){return new Date(RegExp.$2+sn+RegExp.$3+sn+RegExp.$1+" "+RegExp.$4+":"+RegExp.$5+":"+RegExp.$6);
}else{return new Date();}break;case"array":data=apf.getNode(data,[0]);if(data&&data.tagName=="data"){ret=new Array();
var child;i=0;while(child=apf.getNode(data,[i++])){ret.push(this.unserialize(child));
}return ret;}else{this.handleError(new Error(apf.formatErrorString(1087,null,"","Malformed XMLRPC Message")));
return false;}break;case"struct":ret={};i=0;while(child=apf.getNode(data,[i++])){if(child.tagName=="member"){ret[apf.getNode(child,[0]).firstChild.nodeValue]=this.unserialize(apf.getNode(child,[1]));
}else{this.handleError(new Error(apf.formatErrorString(1087,null,"","Malformed XMLRPC Message2")));
return false;}}return ret;break;case"boolean":return Boolean(isNaN(parseInt(data.firstChild.nodeValue))?(data.firstChild.nodeValue=="true"):parseInt(data.firstChild.nodeValue));
break;case"base64":return apf.crypt.Base64.decode(data.firstChild.nodeValue);break;
case"value":child=apf.getNode(data,[0]);return(!child)?((data.firstChild)?new String(data.firstChild.nodeValue):""):this.unserialize(child);
break;default:throw new Error(apf.formatErrorString(1088,null,"","Malformed XMLRPC Message: "+data.tagName));
return false;break;}};this.isValid=function(extra){var data=extra.data;if(apf.getNode(data,[0]).tagName=="fault"){var nr,msg;
if(!apf.isWebkit){nr=data.selectSingleNode("//member[name/text()='faultCode']/value/int/text()").nodeValue;
msg="\n"+data.selectSingleNode("//member[name/text()='faultString']/value/string/text()").nodeValue;
}else{nr=msg="";}extra.message=msg;extra.errorcode=nr;return false;}extra.data=apf.getNode(data,[0,0,0]);
return true;};};apf.yql=function(){this.supportMulticall=false;this.namedArguments=true;
this.nocache=false;this.format="xml";this.diagnostics=true;this.debug=false;this.$booleanProperties.diagnostics=true;
this.$booleanProperties.debug=true;this.$supportedProperties.push("diagnostics","debug","format");
this.$propHandlers.format=function(value){if(!apf.yql.FORMATS[value]){this.format="xml";
}};this.unserialize=function(str){return str;};this.getSingleCall=function(name,args,obj){obj.push(args);
};this.createMessage=function(functionName,args){var options=this.$methods[functionName],body="POST|PUT".indexOf(options["http-method"])>-1?args.pop():"";
this.method=options["http-method"];if(options["content-type"]){this.contentType=options["content-type"];
}this.url=apf.yql.PUBLIC+"?q="+encodeURIComponent(this.query)+"&format="+(options.format||this.format)+(typeof options.callback=="string"?"&callback="+encodeURIComponent(options.callback):"")+"&diagnostics="+(options.diagnostics||this.diagnostics)+"&debug="+(options.debug||this.debug);
return body;};};apf.yql.PUBLIC="http://query.yahooapis.com/v1/public/yql";apf.yql.PRIVATE="http://query.yahooapis.com/v1/yql";
apf.yql.FORMATS={xml:1,json:1};apf.textbox.autocomplete=function(){var autocomplete={};
this.initAutocomplete=function(ac){ac.parentNode.removeChild(ac);autocomplete.nodeset=ac.getAttribute("nodeset").split(":");
autocomplete.method=ac.getAttribute("method");autocomplete.value=ac.getAttribute("value");
autocomplete.count=parseInt(ac.getAttribute("count"))||5;autocomplete.sort=ac.getAttribute("sort");
autocomplete.lastStart=-1;this.oContainer=apf.insertHtmlNode(this.$getLayoutNode("container"),this.$ext.parentNode,this.$ext.nextSibling);
};this.fillAutocomplete=function(keyCode){if(keyCode){switch(keyCode){case 9:case 27:case 13:return this.oContainer.style.display="none";
case 40:if(autocomplete.suggestData&&autocomplete.lastStart<autocomplete.suggestData.length){this.clear();
var value=autocomplete.suggestData[autocomplete.lastStart++];this.$int.value=value;
this.change(value);this.oContainer.style.display="none";return;}break;case 38:if(autocomplete.lastStart>0){if(autocomplete.lastStart>=autocomplete.suggestData.length){autocomplete.lastStart=autocomplete.suggestData.length-1;
}this.clear();var value=autocomplete.suggestData[autocomplete.lastStart--];this.$int.value=value;
this.change(value);this.oContainer.style.display="none";return;}break;}if(keyCode>10&&keyCode<20){return;
}}if(autocomplete.method){var start=0,suggestData=self[autocomplete.method]();autocomplete.count=suggestData.length;
}else{if(this.$int.value.length==0){this.oContainer.style.display="none";return;
}if(!autocomplete.suggestData){var nodes=self[autocomplete.nodeset[0]].data.selectNodes(autocomplete.nodeset[1]);
for(var value,suggestData=[],i=0;i<nodes.length;i++){value=apf.queryValue(nodes[i],autocomplete.value);
if(value){suggestData.push(value.toLowerCase());}}if(autocomplete.sort){suggestData.sort();
}autocomplete.suggestData=suggestData;}else{suggestData=autocomplete.suggestData;
}var value=this.$int.value.toUpperCase();for(var start=suggestData.length-autocomplete.count,i=0;
i<suggestData.length;i++){if(value<=suggestData[i].toUpperCase()){start=i;break;
}}autocomplete.lastStart=start;}this.oContainer.innerHTML="";this.oContainer.style.left=this.$int.offsetLeft+"px";
this.oContainer.style.top=this.$int.offsetTop+"px";for(var arr=[],j=start;j<Math.min(start+autocomplete.count,suggestData.length);
j++){this.$getNewContext("item");var oItem=this.$getLayoutNode("item");apf.setNodeValue(this.$getLayoutNode("item","caption"),suggestData[j]);
oItem.setAttribute("onmouseover",'this.className = "hover"');oItem.setAttribute("onmouseout",'this.className = ""');
oItem.setAttribute("onmousedown","event.cancelBubble = true");oItem.setAttribute("onclick","var o = apf.lookup("+this.$uniqueId+");                o.$int.value = this.innerHTML;                o.change(this.innerHTML);                o.$int.select();                o.$int.focus();                o.oContainer.style.display = 'none';");
arr.push(this.$getLayoutNode("item"));}apf.insertHtmlNode(arr,this.oContainer);
this.oContainer.style.display="block";};this.setAutocomplete=function(model,each,value){autocomplete.lastStart=-1;
autocomplete.suggestData=null;autocomplete.nodeset=[model,each];autocomplete.value=value;
this.oContainer.style.display="none";};};apf.textbox.masking=function(){var _FALSE_=9128748732;
var _REF={"0":"\\d","1":"[12]","9":"[\\d ]","#":"[\\d +-]",L:"[A-Za-z]","?":"[A-Za-z ]",A:"[A-Za-z0-9]",a:"[A-Za-z0-9 ]",X:"[0-9A-Fa-f]",x:"[0-9A-Fa-f ]","&":"[^s]",C:"."};
var lastPos=-1;var masking=false;var oExt=this.$ext;var initial,pos=[],myvalue,format,fcase,replaceChar;
this.setPosition=function(setpos){setPosition(setpos||lastPos||0);};this.addEventListener("$clear",function(){this.value="";
if(this.mask){return this.setValue("");}});this.$propHandlers.value=function(value){var data="";
if(this.includeNonTypedChars){for(var i=0;i<initial.length;i++){if(initial.substr(i,1)!=value.substr(i,1)){data+=value.substr(i,1);
}}}this.$insertData(data||value);};var numpadKeys={"96":"0","97":"1","98":"2","99":"3","100":"4","101":"5","102":"6","103":"7","104":"8","105":"9","106":"*","107":"+","109":"-","110":".","110":"/"};
this.addEventListener("keydown",function(e){var key=e.keyCode,stop=false;switch(key){case 39:setPosition(lastPos+1);
stop=true;break;case 37:setPosition(lastPos-1);stop=true;break;case 35:case 34:setPosition(myvalue.length);
stop=true;break;case 33:case 36:setPosition(0);stop=true;break;case 8:deletePosition(lastPos-1);
setPosition(lastPos-1);stop=true;break;case 46:deletePosition(lastPos);setPosition(lastPos);
stop=true;break;default:if(key==67&&e.ctrlKey){window.clipboardData.setData("Text",this.getValue());
stop=true;}break;}var chr=numpadKeys[key]||String.fromCharCode(key);if(setCharacter(chr)){setPosition(lastPos+1);
}var value,pos=lastPos;if(this.realtime&&(value=this.getValue())!=this.value){this.change(value);
setPosition(pos);}if(apf.isCharacter(e.keyCode)||stop){return false;}},true);this.$initMasking=function(){this.$keyHandler=null;
masking=true;this.$ext[apf.isIphone?"onclick":"onmouseup"]=function(e){var pos=Math.min(calcPosFromCursor(),myvalue.length);
setPosition(pos);return false;};this.$ext.onpaste=function(e){e=e||window.event;
e.returnValue=false;this.host.setValue(window.clipboardData.getData("Text")||"");
$setTimeout(function(){setPosition(lastPos);},1);};this.getValue=function(){if(this.includeNonTypedChars){return initial==this.$ext.value?"":this.$ext.value.replace(new RegExp(replaceChar,"g"),"");
}else{return myvalue.join("");}};this.setValue=function(value){if(this.includeNonTypedChars){for(var data="",i=0;
i<initial.length;i++){if(initial.substr(i,1)!=value.substr(i,1)){data+=value.substr(i,1);
}}}this.$insertData(data);};};this.setMask=function(m){if(!masking){this.$initMasking();
}m=m.split(";");replaceChar=m.pop();this.includeNonTypedChars=parseInt(m.pop())!==0;
var mask=m.join("");var validation="",visual="",mode_case="-",strmode=false,startRight=false,chr;
pos=[],format="",fcase="";for(var looppos=-1,i=0;i<mask.length;i++){chr=mask.substr(i,1);
if(!chr.match(/[\!\'\"\>\<\\]/)){looppos++;}else{if(chr=="!"){startRight=true;}else{if(chr=="<"||chr==">"){mode_case=chr;
}else{if(chr=="'"||chr=='"'){strmode=!strmode;}}}continue;}if(!strmode&&_REF[chr]){pos.push(looppos);
visual+=replaceChar;format+=chr;fcase+=mode_case;validation+=_REF[chr];}else{visual+=chr;
}}this.$ext.value=visual;initial=visual;myvalue=[];replaceChar=replaceChar;};function checkChar(chr,p){var f=format.substr(p,1);
var c=fcase.substr(p,1);if(chr.match(new RegExp(_REF[f]))==null){return _FALSE_;
}if(c==">"){return chr.toUpperCase();}if(c=="<"){return chr.toLowerCase();}return chr;
}function setPosition(p){if(p<0){p=0;}if(apf.hasMsRangeObject){var range=oExt.createTextRange();
range.expand("textedit");range.select();if(pos[p]==null){range.collapse(false);
range.select();lastPos=pos.length;return false;}range.collapse();range.moveStart("character",pos[p]);
range.moveEnd("character",1);range.select();}else{if(typeof pos[p]=="undefined"){oExt.selectionStart=oExt.selectionEnd=pos[pos.length-1]+1;
lastPos=pos.length;return false;}oExt.selectionStart=pos[p];oExt.selectionEnd=pos[p]+1;
}lastPos=p;}function setCharacter(chr){if(pos.length&&pos[lastPos]==null){return false;
}chr=checkChar(chr,lastPos);if(chr==_FALSE_){return false;}if(apf.hasMsRangeObject){var range=oExt.createTextRange();
range.expand("textedit");range.collapse();range.moveStart("character",pos[lastPos]);
range.moveEnd("character",1);range.text=chr;if(apf.document.activeElement==this){range.select();
}}else{var val=oExt.value,start=oExt.selectionStart,end=oExt.selectionEnd;oExt.value=val.substr(0,start)+chr+val.substr(end);
oExt.selectionStart=start;oExt.selectionEnd=end;}myvalue[lastPos]=chr;return true;
}function deletePosition(p){if(pos[p]==null){return false;}if(apf.hasMsRangeObject){var range=oExt.createTextRange();
range.expand("textedit");range.collapse();range.moveStart("character",pos[p]);range.moveEnd("character",1);
range.text=replaceChar;range.select();}else{var val=oExt.value,start=pos[p],end=pos[p]+1;
oExt.value=val.substr(0,start)+replaceChar+val.substr(end);oExt.selectionStart=start;
oExt.selectionEnd=end;}myvalue[p]=" ";}this.$insertData=function(str){if(str==this.getValue()){return;
}var i,j;try{if(!apf.hasMsRangeObject&&oExt.selectionStart==oExt.selectionEnd){setPosition(0);
}}catch(ex){if(!str){return;}var chr,val;for(i=0,j=str.length;i<j;i++){lastPos=i;
if(pos[lastPos]==null){continue;}chr=checkChar(str.substr(i,1),i);if(chr==_FALSE_){continue;
}val=oExt.value;oExt.value=val.substr(0,pos[i])+chr+val.substr(pos[i]+1);}if(str.length){lastPos++;
}return;}str=this.dispatchEvent("insert",{data:str})||str;if(!str){if(!this.getValue()){return;
}for(i=this.getValue().length-1;i>=0;i--){deletePosition(i);}setPosition(0);return;
}for(i=0,j=str.length;i<j;i++){lastPos=i;setCharacter(str.substr(i,1));if(!apf.hasMsRangeObject){setPosition(i+1);
}}if(str.length){lastPos++;}};function calcPosFromCursor(){var range,lt=0;if(!apf.hasMsRangeObject){lt=oExt.selectionStart;
}else{range=document.selection.createRange();var r2=range.duplicate();r2.expand("textedit");
r2.setEndPoint("EndToStart",range);lt=r2.text.length;}for(var i=0;i<pos.length;
i++){if(pos[i]>lt){return(i==0)?0:i-1;}}return myvalue.length;}};apf.upload.flash=function(oUpload){this.oUpload=oUpload;
this.DEFAULT_SWF_PATH=(apf.config.resourcePath||apf.basePath)+"resources/Swiff.Uploader.swf?noCache=".appendRandomNumber(5);
this.$playerId=apf.flash.addPlayer(this);};apf.upload.flash.isSupported=function(){return !apf.isIE&&apf.flash.isAvailable("9.0.0");
};(function(){var oCont;this.event=function(name,o){var file,files=this.oUpload.$files;
if(o&&o.id){file=files.get(o.id);}switch(name){case"load":var filter=this.oUpload.$filter,oFilter=null;
if(filter.length){oFilter={};oFilter["*."+filter.join(", *.")]="*."+filter.join("; *.");
}apf.flash.remote(this.$player,"initialize",{typeFilter:oFilter,multiple:this.oUpload.multiple,queued:1,url:this.oUpload.target,method:"post",data:null,mergeData:true,fieldName:this.oUpload.filedataname,verbose:true,fileSizeMin:1,fileSizeMax:this.oUpload.maxfilesize,allowDuplicates:false,timeLimit:apf.isLinux?0:30,policyFile:null});
break;case"buttonEnter":case"buttonLeave":case"buttonDown":case"buttonDisable":this.oUpload.$setButtonState(name);
break;case"browse":case"disabledBrowse":this.oUpload.$setButtonState("buttonDisable");
break;case"selectSuccess":this.oUpload.$queue(o);break;case"selectFail":this.$files.removeMany(o);
break;case"fileProgress":file.loaded=o.progress.bytesLoaded;this.oUpload.$progress(file);
break;case"fileComplete":var httpStatus=o.response&&o.response.error?500:200;file.status=httpStatus==500?apf.upload.FAILED:apf.upload.DONE;
file.loaded=httpStatus==500?0:file.size;this.oUpload.$progress(file);this.oUpload.$fileDone(file,{response:o.response?o.response.text:"",status:httpStatus});
if(httpStatus>=400){this.oUpload.dispatchEvent("error",{code:apf.upload.ERROR_CODES.HTTP_ERROR,message:"HTTP Error: "+o.response.error+", "+o.response.text,file:file,status:httpStatus});
}break;case"complete":case"fail":case"queue":case"cancel":case"fileStart":case"fileStop":case"fileRequeue":case"fileOpen":case"fileRemove":default:break;
}};this.draw=function(){var uid=this.oUpload.$uniqueId+"_swfupload",_self=this;
oCont=this.oUpload.$ext;document.body.appendChild(oCont);oCont.style.position="absolute",oCont.style.background="transparent",oCont.style.width="100px",oCont.style.height="100px",oCont.style.zIndex=99999;
apf.flash.embed({context:this,htmlNode:oCont,onError:function(e){_self.oUpload.dispatchEvent("error",e);
},src:this.DEFAULT_SWF_PATH,width:"100%",height:"100%",id:uid,quality:"high",name:uid,flashvars:"playerID="+this.$playerId,allowScriptAccess:"always",wMode:"transparent",swLiveConnect:"true",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",menu:"false"});
};this.refresh=function(){var oBtn=this.oUpload.$button.$ext;if(!oBtn){return;}var btnPos=apf.getAbsolutePosition(oBtn),btnDims=[oBtn.offsetWidth,oBtn.offsetHeight],contPos=apf.getAbsolutePosition(oCont);
if(btnPos[0]!=contPos[0]){oCont.style.left=btnPos[0]+"px";}if(btnPos[1]!=contPos[1]){oCont.style.top=btnPos[1]+"px";
}if(btnDims[0]!=oCont.offsetWidth){oCont.style.width=btnDims[0]+"px";}if(btnDims[1]!=oCont.offsetHeight){oCont.style.height=btnDims[1]+"px";
}};this.upload=function(file){apf.flash.remote(this.$player,"fileStart",file.id);
};this.removeFile=function(file){apf.flash.remote(this.$player,"fileRemove",file.id);
};}).call(apf.upload.flash.prototype=new apf.Class());apf.upload.html4=function(oUpload){this.oUpload=oUpload;
this.$files={};};apf.upload.html4.isSupported=function(){return true;};(function(){function addSelectedFiles(element){var file,id,name,uid=this.oUpload.$uniqueId,files=[];
name=element.value.replace(/\\/g,"/");name=name.substring(name.length,name.lastIndexOf("/")+1);
id=uid+"_html4_".appendRandomNumber(5);this.$files[id]=file={id:id,name:name};file.input=element;
files.push(file);if(files.length){this.oUpload.$queue(files);}}this.draw=function(){var inputContainer,type,node,mimes=[],uid=this.oUpload.$uniqueId,filter=this.oUpload.$filter,i=0,l=filter.length,_self=this;
this.$cont=this.oUpload.$ext;for(;i<l;++i){if(type=this.oUpload.mimeTypes[filter[i]]){mimes.push(type);
}}$setTimeout(function(){_self.$form=document.createElement("form");_self.$form.style.display="inline";
node=_self.oUpload.$button.$ext;node.parentNode.insertBefore(_self.$form,node);
_self.$form.appendChild(node);_self.$form.setAttribute("method","post");_self.$form.setAttribute("enctype","multipart/form-data");
_self.$iframe=document.createElement("iframe");_self.$iframe.setAttribute("src",'javascript:""');
_self.$iframe.setAttribute("name",uid+"_iframe");_self.$iframe.setAttribute("id",uid+"_iframe");
_self.$iframe.style.display="none";apf.addListener(_self.$iframe,"load",function(e){e=e||window.event;
var el,n=e.srcElement||e.target,file=_self.currentfile;try{el=n.contentWindow.document||n.contentDocument||window.frames[n.id].document;
}catch(ex){_self.dispatchEvent("error",{code:apf.upload.ERROR_CODES.SECURITY_ERROR,message:"Security error.",file:file});
return;}if(el.location.href=="about:blank"||!file){return;}var result=el.documentElement.innerText||el.documentElement.textContent;
if(result!=""){file.status=apf.upload.DONE;file.loaded=1025;file.percent=100;if(file.input){file.input.removeAttribute("name");
}_self.oUpload.$progress(file);_self.oUpload.$fileDone(file,{response:result});
if(_self.$form.tmpAction){_self.$form.setAttribute("action",_self.$form.tmpAction);
}if(_self.$form.tmpTarget){_self.$form.setAttribute("target",_self.$form.tmpTarget);
}}});_self.$form.appendChild(_self.$iframe);_self.$inputContainer=inputContainer=document.createElement("div");
inputContainer.id=uid+"_iframe_container";with(inputContainer.style){position="absolute",background="transparent",width="100px",height="100px",overflow="hidden",zIndex=99999,opacity=0;
}_self.$form.appendChild(inputContainer);function createInput(){var input=document.createElement("input");
input.setAttribute("type","file");input.setAttribute("accept",mimes.join(","));
input.setAttribute("size",1);input.style.width="100%",input.style.height="100%",apf.setOpacity(input,0);
input.onchange=function(e){e=e||window.event;var n=e.srcElement||e.target;if(n.value){createInput();
n.style.display="none";addSelectedFiles.call(_self,n);}};inputContainer.appendChild(input);
return true;}createInput();_self.refresh();});};this.refresh=function(){if(this.$inputContainer){var oBtn=this.oUpload.$button.$ext,pos=apf.getAbsolutePosition(oBtn,this.$inputContainer.offsetParent);
if(apf.isIE&&oBtn.offsetWidth>81){apf.console.warn("Button found for upload element with a width greater than 81 pixels. This sadly will not work: "+this.oUpload.$button.serialize());
}this.$inputContainer.style.left=pos[0]+"px",this.$inputContainer.style.top=pos[1]+"px",this.$inputContainer.style.width=(apf.isIE?"81px":oBtn.offsetWidth+"px"),this.$inputContainer.style.height=oBtn.offsetHeight+"px";
}};this.upload=function(file){var u=apf.upload;if(file.status&u.DONE||file.status&u.FAILED||this.oUpload.state&u.STOPPED){return;
}if(!file.input){file.status=u.ERROR;return;}file.input.setAttribute("name",this.oUpload.filedataname);
this.$form.tmpAction=this.$form.getAttribute("action");this.$form.setAttribute("action",this.oUpload.$buildUrl(this.oUpload.target,{name:file.target_name||file.name}));
this.$form.tmpTarget=this.$form.getAttribute("target");this.$form.setAttribute("target",this.$iframe.name);
this.currentfile=file;this.$form.appendChild(file.input);this.$form.submit();};
this.removeFile=function(file){if(file.input){file.input.parentNode.removeChild(file.input);
}};}).call(apf.upload.html4.prototype=new apf.Class());apf.upload.html5=function(oUpload){this.oUpload=oUpload;
};apf.upload.html5.isSupported=function(){return apf.hasXhrBinary;};(function(){var oCont,oInput,html5files={};
function addSelectedFiles(native_files){var file,id,uid=this.oUpload.$uniqueId,i=0,l=native_files.length,files=[];
for(i=0;i<native_files.length;i++){file=native_files[i];id=uid+"_html5_".appendRandomNumber(5);
html5files[id]=file;files.push({id:id,name:file.fileName,size:file.fileSize});}if(files.length){this.oUpload.$queue(files);
}}this.draw=function(){var type,mimes=[],uid=this.oUpload.$uniqueId,filter=this.oUpload.$filter,i=0,l=filter.length;
oCont=this.oUpload.$ext;for(;i<l;++i){if(type=this.oUpload.mimeTypes[filter[i]]){mimes.push(type);
}}if(oInput&&oInput.parentNode&&oCont&&oCont.parentNode){try{oCont.removeChild(oInput);
}catch(ex){}oInput=null;}oCont.style.position="absolute",oCont.style.background="transparent",oCont.style.width="100px",oCont.style.height="100px",oCont.style.overflow="hidden",oCont.style.zIndex=99999,oCont.style.cursor="default",oCont.style.opacity="0";
oCont.innerHTML='<input id="'+uid+'_html5" style="width:100%;" type="file" accept="'+mimes.join(",")+'" '+(this.oUpload.multiple?'multiple="multiple"':"")+" />";
oInput=document.getElementById(uid+"_html5");var _self=this;oInput.onchange=function(){addSelectedFiles.call(_self,this.files);
this.value="";};oInput.onmouseover=function(){_self.oUpload.$setButtonState("mouseEnter");
};oInput.onmouseout=function(){_self.oUpload.$setButtonState("mouseLeave");};oInput.onmousedown=function(){_self.oUpload.$setButtonState("buttonDown");
};};this.refresh=function(){var oBtn=this.oUpload.$button.$ext,pos=apf.getAbsolutePosition(oBtn,oCont.offsetParent);
oCont.style.left=pos[0]+"px",oCont.style.top=pos[1]+"px",oCont.style.width=oBtn.offsetWidth+"px",oCont.style.height=oBtn.offsetHeight+"px";
};this.upload=function(file){var nativeFile,xhr=new XMLHttpRequest(),upload=xhr.upload,multipartSize=0,_self=this;
function sendBinaryBlob(blob){var boundary="----apfbound".appendRandomNumber(5),dashdash="--",crlf="\r\n",multipartBlob="";
if(_self.oUpload.multipart){xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary);
multipartBlob+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+_self.oUpload.filedataname+'"; filename="'+file.name+'"'+crlf+"Content-Type: application/octet-stream"+crlf+crlf+blob+crlf+dashdash+boundary+dashdash+crlf;
multipartSize=multipartBlob.length-blob.length;blob=multipartBlob;}try{xhr.sendAsBinary(blob);
}catch(ex){_self.oUpload.dispatchEvent("error",{code:apf.upload.ERROR_CODES.HTTP_ERROR,message:ex.message,file:file});
}}if(file.status&apf.upload.DONE||file.status&apf.upload.FAILED||this.oUpload.state&apf.upload.STOPPED){return;
}if(upload){upload.onprogress=function(e){file.loaded=e.loaded-multipartSize;_self.oUpload.$progress(file);
};}xhr.onreadystatechange=function(){if(xhr.readyState!=4){return;}var httpStatus;
try{httpStatus=xhr.status;}catch(ex){httpStatus=0;}var bError=(httpStatus>=400||httpStatus==0);
file.status=bError?apf.upload.FAILED:apf.upload.DONE;file.loaded=bError?0:file.size;
_self.oUpload.$progress(file);_self.oUpload.$fileDone(file,{response:xhr.responseText,status:httpStatus});
if(bError){apf.console.error("File upload failed "+httpStatus+" with message "+xhr.responseText);
_self.oUpload.dispatchEvent("error",{code:apf.upload.ERROR_CODES.HTTP_ERROR,message:"HTTP Error: "+xhr.responseText,file:file,status:httpStatus});
}else{if(apf.isGecko){_self.draw();$setTimeout(function(){_self.refresh();});}}};
nativeFile=html5files[file.id];xhr.open("post",this.oUpload.$buildUrl(this.oUpload.target,{name:file.target_name||file.name}),true);
xhr.setRequestHeader("Cache-Control","no-cache");xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");
xhr.setRequestHeader("X-File-Name",nativeFile.fileName);xhr.setRequestHeader("X-File-Size",nativeFile.fileSize);
xhr.setRequestHeader("Content-Type","application/octet-stream");if(xhr.sendAsBinary){sendBinaryBlob(nativeFile.getAsBinary());
}else{xhr.send(nativeFile);}};}).call(apf.upload.html5.prototype=new apf.Class());
apf.video.TypeFlv=function(oVideo,node,options){this.oVideo=oVideo;this.DEFAULT_SWF_PATH=(apf.config.resourcePath||apf.basePath)+"resources/FAVideo.swf";
this.id=apf.flash.addPlayer(this);this.inited=false;this.resizeTimer=null;this.divName=this.oVideo.$uniqueId;
this.htmlElement=node;this.name="FAVideo_"+this.oVideo.$uniqueId;this.videoPath=options.src;
this.width="100%";this.height="100%";this.player=null;apf.extend(this,apf.video.TypeInterface);
this.initProperties().setOptions(options).createPlayer();};apf.video.TypeFlv.isSupported=function(){return apf.flash.isAvailable();
};apf.video.TypeFlv.prototype={load:function(videoPath,totalTime){videoPath=videoPath.splitSafe(",")[this.oVideo.$lastMimeType]||videoPath;
if(totalTime!=null){this.setTotalTime(totalTime);}if(videoPath!=null){this.videoPath=videoPath;
}if(this.videoPath==null&&!this.firstLoad){return this.oVideo.$errorHook({type:"error",error:"FAVideo::play - No videoPath has been set."});
}if(videoPath==null&&this.firstLoad&&!this.autoLoad){videoPath=this.videoPath;}this.firstLoad=false;
if(this.autoPlay){this.callMethod("playVideo",videoPath,totalTime);}else{this.callMethod("loadVideo",this.videoPath);
}return this;},play:function(){return this.pause(false);},pause:function(pauseState){if(typeof pauseState=="undefined"){pauseState=true;
}this.callMethod("pause",pauseState);return this;},stop:function(){this.callMethod("stop");
return this;},seek:function(millis){this.callMethod("seek",millis/1000);return this;
},setVolume:function(iVolume){this.callMethod("setVolume",iVolume);return this;
},onResize:function(){clearTimeout(this.resizeTimer);var _self=this;this.resizeTimer=window.setTimeout(function(){_self.setSize();
},20);},setSize:function(){this.callMethod("setSize",this.htmlElement.offsetWidth,this.htmlElement.offsetHeight);
return this;},getPlayheadTime:function(){return this.playheadTime;},setPlayheadTime:function(value){return this.setProperty("playheadTime",value);
},getTotalTime:function(){return this.totalTime;},setTotalTime:function(value){return this.setProperty("totalTime",value);
},callMethod:function(){if(!this.inited||!this.player||!this.player.callMethod){this.delayCalls.push(arguments);
}else{var args=Array.prototype.slice.call(arguments);args.unshift(this.player,"callMethod");
apf.flash.remote.apply(null,args);}return this;},makeDelayCalls:function(){for(var i=0,l=this.delayCalls.length;
i<l;i++){this.callMethod.apply(this,this.delayCalls[i]);}return this;},update:function(props){for(var n in props){if(n.indexOf("Time")!=-1&&typeof props[n]=="number"){props[n]=props[n]*1000;
}this[n]=props[n];}props.type="change";this.oVideo.$changeHook(props);},event:function(eventName,evtObj){apf.console.log("[FLASH] video event: "+eventName+", "+evtObj);
switch(eventName){case"progress":this.bytesLoaded=evtObj.bytesLoaded;this.totalBytes=evtObj.bytesTotal;
this.oVideo.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});
break;case"playheadUpdate":this.playheadTime=evtObj.playheadTime*1000;this.totalTime=evtObj.totalTime*1000;
this.oVideo.$playheadUpdateHook({type:"playheadUpdate",playheadTime:this.playheadTime,totalTime:this.totalTime});
break;case"stateChange":this.state=evtObj.state;this.oVideo.$stateChangeHook({type:"stateChange",state:this.state});
break;case"change":this.oVideo.$changeHook({type:"change"});break;case"complete":this.oVideo.$completeHook({type:"complete"});
break;case"ready":this.oVideo.$readyHook({type:"ready"});break;case"metaData":this.oVideo.$metadataHook({type:"metadata",infoObject:evtObj});
break;case"cuePoint":this.oVideo.$cuePointHook({type:"cuePoint",infoObject:evtObj});
break;case"fullscreen":apf.console.log("fullscreen: ",evtObj.state);this.oVideo.fullscreen=false;
case"init":this.inited=true;this.invalidateProperty("clickToTogglePlay","skinVisible","skinAutoHide","autoPlay","autoLoad","volume","bufferTime","videoScaleMode","videoAlign","playheadUpdateInterval","previewImagePath").validateNow().makeDelayCalls();
this.oVideo.$initHook({type:"init"});this.onResize();var node=this.oVideo.$int;
$setTimeout(function(){apf.layout.forceResize(node);},1000);break;case"debug":apf.console.log("Flash debug: "+evtObj.msg);
break;}},initProperties:function(){this.delayCalls=[];this.videoWidth=this.videoHeight=this.totalTime=this.bytesLoaded=this.totalBytes=0;
this.state=null;this.clickToTogglePlay=this.autoPlay=this.autoLoad=this.skinVisible=true;
this.volume=50;this.skinVisible=false;this.skinAutoHide=false;this.playheadTime=null;
this.bufferTime=0.1;this.videoScaleMode="maintainAspectRatio";this.videoAlign="center";
this.playheadUpdateInterval=1000;this.previewImagePath=this.themeColor=null;this.firstLoad=true;
this.pluginError=false;this.properties=["volume","skinAutoHide","showControls","autoPlay","clickToTogglePlay","autoLoad","playHeadTime","totalTime","bufferTime","videoScaleMode","videoAlign","playheadUpdateInterval","previewImagePath"];
apf.layout.setRules(this.oVideo.$ext,this.oVideo.$uniqueId+"_favideo","(apf.all["+this.oVideo.$uniqueId+"].player && apf.all["+this.oVideo.$uniqueId+"].player.onResize                 ? apf.all["+this.oVideo.$uniqueId+"].player                 : {onResize:apf.K}).onResize()");
apf.layout.queue(this.oVideo.$ext);return this;},createPlayer:function(){if(this.htmlElement==null){return this;
}this.pluginError=false;apf.flash.embed({context:this,htmlNode:this.htmlElement,property:"player",src:this.DEFAULT_SWF_PATH,width:"100%",height:"100%",align:"middle",id:this.name,quality:"high",bgcolor:"#000000",allowFullScreen:"true",name:this.name,flashvars:"playerID="+this.id+"&volume="+this.volume,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",menu:"true"});
return this;},invalidateProperty:function(){if(this.invalidProperties==null){this.invalidProperties={};
}for(var i=0;i<arguments.length;i++){this.invalidProperties[arguments[i]]=true;
}if(this.validateInterval==null&&this.inited){var _this=this;this.validateInterval=$setTimeout(function(){_this.validateNow();
},100);}return this;},validateNow:function(){this.validateInterval=null;var props={};
for(var n in this.invalidProperties){props[n]=this[n];}this.invalidProperties={};
this.callMethod("update",props);return this;},setProperty:function(property,value){this[property]=value;
if(this.inited){this.invalidateProperty(property);}return this;},$destroy:function(){if(apf.layout){apf.layout.removeRule(this.oVideo.$ext,this.oVideo.$uniqueId+"_favideo");
}if(this.player){try{this.stop();}catch(e){}this.player=null;delete this.player;
}this.htmlElement.innerHTML="";this.oVideo=this.htmlElement=null;delete this.oVideo;
delete this.htmlElement;}};apf.video.TypeNative=function(oVideo,oNode,options){this.oVideo=oVideo;
this.inited=false;this.divName=oVideo.$uniqueId;this.htmlElement=oNode;this.name="soundmgr_"+oVideo.$uniqueId;
this.videoPath=options.src;this.paused=false;this.player=null;apf.extend(this,apf.video.TypeInterface);
this.setOptions(options).createPlayer();};apf.video.TypeNative.isSupported=function(){return apf.hasVideo;
};apf.video.TypeNative.prototype={load:function(videoPath,totalTime){if(totalTime!=null){this.setTotalTime(totalTime);
}if(videoPath!=null){this.videoPath=videoPath;}if(this.videoPath==null&&!this.firstLoad){return this.oVideo.$errorHook({type:"error",error:"SoundManager::play - No videoPath has been set."});
}if(videoPath==null&&this.firstLoad&&!this.autoLoad){videoPath=this.videoPath;}this.firstLoad=false;
this.setVolume(this.volume);return this;},play:function(){if(!this.paused){return this.player.play();
}return this.pause();},pause:function(){return this.player.pause();},stop:function(){return this.player.stop();
},seek:function(ms){return this.player.currentTime=parseInt(ms)/1000;},setVolume:function(iVol){this.player.volume=parseInt(iVol)/100;
return this;},getPlayheadTime:function(){return this.player.playheadTime;},setPlayheadTime:function(value){this.playheadTime=parseInt(value);
return this;},getTotalTime:function(){return this.totalTime;},setTotalTime:function(value){this.totalTime=parseInt(value);
return this;},event:function(eventName,evtObj){switch(eventName){case"progress":this.bytesLoaded=evtObj.bytesLoaded;
this.totalBytes=evtObj.totalBytes;this.oVideo.$progressHook({type:"progress",bytesLoaded:this.bytesLoaded,totalBytes:this.totalBytes});
break;case"playheadUpdate":this.playheadTime=evtObj.playheadTime;this.totalTime=evtObj.totalTime;
this.oVideo.$changeHook({type:"change",playheadTime:this.playheadTime,totalTime:this.totalTime});
if(evtObj.waveData||evtObj.peakData||evtObj.eqData){this.oVideo.$metadataHook({type:"metadata",waveData:evtObj.waveData,peakData:evtObj.peakData,eqData:evtObj.eqData});
}break;case"stateChange":this.state=evtObj.state;this.oVideo.$stateChangeHook({type:"stateChange",state:this.state});
break;case"change":this.oVideo.$changeHook({type:"change"});break;case"complete":this.oVideo.$completeHook({type:"complete"});
break;case"ready":if(this.paused&&this.autoPlay){this.paused=false;}this.oVideo.$readyHook({type:"ready"});
break;case"metaData":this.oVideo.$metadataHook({type:"metaData",infoObject:evtObj});
break;case"cuePoint":this.oVideo.$cuePointHook({type:"cuePoint",infoObject:evtObj});
break;case"init":this.inited=true;this.oVideo.$initHook(apf.extend(evtObj,apf.flash.getSandbox(evtObj.sandboxType)));
break;case"id3":this.oVideo.$metadataHook({type:"metadata",id3Data:evtObj});break;
case"debug":apf.console.log(">> SWF DBUG: "+evtObj.msg);break;}},createPlayer:function(){var div=this.htmlElement;
if(div==null){return this;}var a=this.player=document.createElement("video");a.setAttribute("src",this.videoPath);
a.setAttribute("volume",this.volume);if(this.autoPlay){a.setAttribute("autoplay","true");
}div.appendChild(a);var _self=this,timeHandler;a.addEventListener("canplay",function(){_self.oVideo.$readyHook({type:"ready"});
},false);a.addEventListener("timeupdate",timeHandler=function(e){_self.playheadTime=parseInt(_self.player.currentTime||0)*1000;
_self.totalTime=parseInt(_self.player.duration)*1000;_self.oVideo.$changeHook({type:"change",playheadTime:_self.playheadTime,totalTime:_self.totalTime});
},false);a.addEventListener("duration",timeHandler,false);a.addEventListener("volumechange",function(){_self.oVideo.$changeHook({type:"change",volume:_self.player.muted?0:parseInt(_self.player.volume)*100});
},false);a.addEventListener("progress",function(e){_self.bytesLoaded=e.loaded;_self.totalBytes=e.total;
_self.oVideo.$progressHook({type:"progress",bytesLoaded:_self.bytesLoaded,totalBytes:_self.totalBytes});
},false);a.addEventListener("ended",function(){_self.oVideo.$completeHook({type:"complete"});
},false);a.addEventListener("error",function(e){throw new Error(apf.formatErrorString(0,_self,"Audio playback",e.message,_self.oVideo));
},false);a.load();return this;},$destroy:function(){if(!this.player){return;}this.player.setAttribute("src","");
delete this.player;this.player=null;}};apf.video.TypeQTCompat=(function(){var gTagAttrs=null;
var gQTBehaviorID="qt_event_source";var gQTEventsEnabled=true;function _QTGenerateBehavior(){return apf.isIE?'<object id="'+gQTBehaviorID+'" classid="clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598"               codebase="http://www.apple.com/qtactivex/qtplugin.cab#version=7,3,0,0"></object>':"";
}function _QTPageHasBehaviorObject(callingFcnName,args){var haveBehavior=false;
var objects=document.getElementsByTagName("object");for(var ndx=0,obj;obj=objects[ndx];
ndx++){if(obj.getAttribute("classid")=="clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598"){if(obj.getAttribute("id")==gQTBehaviorID){haveBehavior=false;
}break;}}return haveBehavior;}function _QTShouldInsertBehavior(){var shouldDo=false;
if(gQTEventsEnabled&&apf.isIE&&!_QTPageHasBehaviorObject()){shouldDo=true;}return shouldDo;
}function _QTAddAttribute(prefix,slotName,tagName){var value;value=gTagAttrs[prefix+slotName];
if(null==value){value=gTagAttrs[slotName];}if(null!=value){if(0==slotName.indexOf(prefix)&&(null==tagName)){tagName=slotName.substring(prefix.length);
}if(null==tagName){tagName=slotName;}return" "+tagName+'="'+value+'"';}else{return"";
}}function _QTAddObjectAttr(slotName,tagName){if(0==slotName.indexOf("emb#")){return"";
}if(0==slotName.indexOf("obj#")&&(null==tagName)){tagName=slotName.substring(4);
}return _QTAddAttribute("obj#",slotName,tagName);}function _QTAddEmbedAttr(slotName,tagName){if(0==slotName.indexOf("obj#")){return"";
}if(0==slotName.indexOf("emb#")&&(null==tagName)){tagName=slotName.substring(4);
}return _QTAddAttribute("emb#",slotName,tagName);}function _QTAddObjectParam(slotName,generateXHTML){var paramValue;
var paramStr="";var endTagChar=(generateXHTML)?" />":">";if(-1==slotName.indexOf("emb#")){paramValue=gTagAttrs["obj#"+slotName];
if(null==paramValue){paramValue=gTagAttrs[slotName];}if(0==slotName.indexOf("obj#")){slotName=slotName.substring(4);
}if(null!=paramValue){paramStr='<param name="'+slotName+'" value="'+paramValue+'"'+endTagChar;
}}return paramStr;}function _QTDeleteTagAttrs(){for(var ndx=0;ndx<arguments.length;
ndx++){var attrName=arguments[ndx];delete gTagAttrs[attrName];delete gTagAttrs["emb#"+attrName];
delete gTagAttrs["obj#"+attrName];}}function _QTGenerate(callingFcnName,generateXHTML,args){gTagAttrs={src:args[0],width:args[1],height:args[2],classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",pluginspage:"http://www.apple.com/quicktime/download/"};
var activexVers=args[3];if((null==activexVers)||(""==activexVers)){activexVers="7,3,0,0";
}gTagAttrs.codebase="http://www.apple.com/qtactivex/qtplugin.cab#version="+activexVers;
var attrName,attrValue;for(var ndx=4;ndx<args.length;ndx+=2){attrName=args[ndx].toLowerCase();
attrValue=args[ndx+1];gTagAttrs[attrName]=attrValue;if(("postdomevents"==attrName)&&(attrValue.toLowerCase()!="false")){gQTEventsEnabled=true;
if(apf.isIE){gTagAttrs["obj#style"]="behavior:url(#"+gQTBehaviorID+")";}}}var objTag=["<object ",_QTAddObjectAttr("classid"),_QTAddObjectAttr("width"),_QTAddObjectAttr("height"),_QTAddObjectAttr("codebase"),_QTAddObjectAttr("name"),_QTAddObjectAttr("id"),_QTAddObjectAttr("tabindex"),_QTAddObjectAttr("hspace"),_QTAddObjectAttr("vspace"),_QTAddObjectAttr("border"),_QTAddObjectAttr("align"),_QTAddObjectAttr("class"),_QTAddObjectAttr("title"),_QTAddObjectAttr("accesskey"),_QTAddObjectAttr("noexternaldata"),_QTAddObjectAttr("obj#style"),">",_QTAddObjectParam("src",generateXHTML)];
var embedTag=["<embed ",_QTAddEmbedAttr("src"),_QTAddEmbedAttr("width"),_QTAddEmbedAttr("height"),_QTAddEmbedAttr("pluginspage"),_QTAddEmbedAttr("name"),_QTAddEmbedAttr("id"),_QTAddEmbedAttr("align"),_QTAddEmbedAttr("tabindex")];
_QTDeleteTagAttrs("src","width","height","pluginspage","classid","codebase","name","tabindex","hspace","vspace","border","align","noexternaldata","class","title","accesskey","id","style");
for(var attrName in gTagAttrs){attrValue=gTagAttrs[attrName];if(null!=attrValue){embedTag.push(_QTAddEmbedAttr(attrName));
objTag.push(_QTAddObjectParam(attrName,generateXHTML));}}return objTag.join("")+embedTag.join("")+"></embed></object>";
}function QT_GenerateOBJECTText(){var txt=_QTGenerate("QT_GenerateOBJECTText_XHTML",true,arguments);
if(_QTShouldInsertBehavior()){txt=_QTGenerateBehavior()+txt;}return txt;}function QT_IsInstalled(){var U=false;
if(navigator.plugins&&navigator.plugins.length){for(var M=0;M<navigator.plugins.length;
M++){var g=navigator.plugins[M];if(g.name.indexOf("QuickTime")>-1){U=true;}}}else{var qtObj=false;
execScript('on error resume next: qtObj = IsObject(CreateObject("QuickTimeCheckObject.QuickTimeCheck.1"))',"VBScript");
U=qtObj;}return U;}function QT_GetVersion(){var U="0";if(navigator.plugins&&navigator.plugins.length){for(var g=0;
g<navigator.plugins.length;g++){var S=navigator.plugins[g];var M=S.name.match(/quicktime\D*([\.\d]*)/i);
if(M&&M[1]){U=M[1];}}}else{var ieQTVersion=null;execScript('on error resume next: ieQTVersion = CreateObject("QuickTimeCheckObject.QuickTimeCheck.1").QuickTimeVersion',"VBScript");
if(ieQTVersion){var temp="";U=(ieQTVersion).toString(16)/1000000+"";temp+=parseInt(U)+".";
temp+=((parseFloat(U)-parseInt(U))*1000)/100+"";U=temp;}}return U;}function QT_IsCompatible(g,j){function M(w,R){var i=parseInt(w[0],10);
if(isNaN(i)){i=0;}var V=parseInt(R[0],10);if(isNaN(V)){V=0;}if(i===V){if(w.length>1){return M(w.slice(1),R.slice(1));
}else{return true;}}else{return(i<V);}}var S=g.split(/\./);var U=j?j.split(/\./):QT_GetVersion().split(/\./);
return M(S,U);}var aIsAvailable={};function QT_IsValidAvailable(sVersion){if(typeof sVersion=="undefined"){sVersion="7.2.1";
}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=QT_IsInstalled()&&QT_IsCompatible(sVersion);
}return aIsAvailable[sVersion];}return{generateOBJECTText:QT_GenerateOBJECTText,isAvailable:QT_IsValidAvailable};
})();apf.video.TypeQT=function(oVideo,node,options){this.oVideo=oVideo;this.name="QT_"+this.oVideo.$uniqueId;
this.htmlElement=node;this.videoWidth=this.videoHeight=this.totalTime=this.bytesLoaded=this.totalBytes=0;
this.state=null;this.autoPlay=this.autoLoad=this.showControls=true;this.volume=50;
this.mimeType="video/quicktime";this.firstLoad=true;this.pluginError=false;this.pollTimer=null;
this.videoPath=options.src;this.player=null;apf.extend(this,apf.video.TypeInterface);
this.setOptions(options);var _self=this;window.setTimeout(function(){_self.oVideo.$initHook({state:1});
},1);};apf.video.TypeQT.isSupported=function(){return apf.video.TypeQTCompat.isAvailable();
};apf.video.TypeQT.prototype={load:function(videoPath){this.videoPath=videoPath.splitSafe(",")[this.oVideo.$lastMimeType]||videoPath;
return this.$draw().attachEvents();},play:function(){if(this.player){try{this.player.Play();
if(apf.isIE){this.handleEvent({type:"qt_play"});}}catch(e){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});
}}return this;},pause:function(){if(this.player){try{this.player.Stop();if(apf.isIE){this.handleEvent({type:"qt_pause"});
}}catch(e){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});
}}return this;},stop:function(){return this.pause();},seek:function(iTo){if(!this.player){return;
}try{this.player.SetTime(iTo);}catch(e){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});
}return this;},setVolume:function(iVolume){if(this.player){try{this.player.SetVolume(Math.round((iVolume/100)*256));
}catch(e){this.oVideo.$stateChangeHook({type:"stateChange",state:"connectionError"});
}}return this;},getTotalTime:function(){if(!this.player){return 0;}return this.player.GetDuration();
},$draw:function(){if(this.player){this.stopPlayPoll();delete this.player;this.player=null;
}this.htmlElement.innerHTML=apf.video.TypeQTCompat.generateOBJECTText(this.videoPath,"100%","100%","","autoplay",apf.isIE?"false":this.autoPlay.toString(),"controller",this.showControls.toString(),"kioskmode","true","showlogo","true","bgcolor","black","scale","aspect","align","middle","EnableJavaScript","True","postdomevents","True","target","myself","cache","false","qtsrcdontusebrowser","true","type",this.mimeType.splitSafe(",")[this.oVideo.$lastMimeType]||this.mimeType,"obj#id",this.name,"emb#NAME",this.name,"emb#id",this.name+"emb");
this.player=document[this.name];return this;},events:["qt_begin","qt_abort","qt_canplay","qt_canplaythrough","qt_durationchange","qt_ended","qt_error","qt_load","qt_loadedfirstframe","qt_loadedmetadata","qt_pause","qt_play","qt_progress","qt_stalled","qt_timechanged","qt_volumechange","qt_waiting"],attachEvents:function(){var nodeEvents=document.getElementById(this.name);
if(!nodeEvents){nodeEvents=document.getElementById(this.name+"emb");}var _self=this;
function exec(e){if(!e){e=window.event;}_self.handleEvent(e);}var hook=nodeEvents.addEventListener?"addEventListener":"attachEvent";
var pfx=nodeEvents.addEventListener?"":"on";this.events.forEach(function(evt){nodeEvents[hook](pfx+evt,exec,false);
});if(apf.isIE&&this.autoPlay){this.handleEvent({type:"qt_play"});}return this;
},handleEvent:function(e){switch(e.type){case"qt_play":this.oVideo.$stateChangeHook({type:"stateChange",state:"playing"});
this.startPlayPoll();break;case"qt_pause":this.oVideo.$stateChangeHook({type:"stateChange",state:"paused"});
this.stopPlayPoll();break;case"qt_volumechange":this.oVideo.$changeHook({type:"change",volume:Math.round((this.player.GetVolume()/256)*100)});
break;case"qt_timechanged":this.oVideo.$changeHook({type:"change",playheadTime:this.player.GetTime()});
break;case"qt_stalled":this.oVideo.$completeHook({type:"complete"});this.stopPlayPoll();
break;case"qt_canplay":this.oVideo.$readyHook({type:"ready"});break;case"qt_load":case"qt_canplaythrough":this.oVideo.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);
if(this.autoPlay&&apf.isIE){this.player.Play();}break;}return this;},startPlayPoll:function(){clearTimeout(this.pollTimer);
var _self=this;this.pollTimer=$setTimeout(function(){if(!_self.player){return;}try{_self.handleEvent({type:"qt_timechanged"});
var iLoaded=_self.player.GetMaxBytesLoaded();var iTotal=_self.player.GetMovieSize();
_self.oVideo.$progressHook({bytesLoaded:iLoaded,totalBytes:iTotal});if(!_self.oVideo.ready&&Math.abs(iLoaded-iTotal)<=20){_self.handleEvent({type:"qt_load"});
}}catch(e){}_self.startPlayPoll();},100);return this;},stopPlayPoll:function(){clearTimeout(this.pollTimer);
return this;},$destroy:function(){this.stopPlayPoll();if(this.player){try{this.player.Stop();
}catch(e){}this.player=null;delete this.player;}this.oVideo=this.htmlElement=null;
delete this.oVideo;delete this.htmlElement;}};apf.video.TypeSilverlight=function(oVideo,node,options){this.oVideo=oVideo;
if(!apf.video.TypeSilverlight.INITED){apf.silverlight.startup();apf.video.TypeSilverlight.INITED=true;
}this.DEFAULT_PLAYER=(apf.config.resourcePath||apf.basePath)+"resources/wmvplayer.xaml";
this.htmlElement=node;this.options={backgroundcolor:"000000",windowless:"false",file:"",image:"",backcolor:"000000",frontcolor:"FFFFFF",lightcolor:"FFFFFF",screencolor:"FFFFFF",width:"100%",height:"100%",logo:"",overstretch:"true",shownavigation:"false",showstop:"false",showdigits:"true",usefullscreen:"true",usemute:"false",autostart:"true",bufferlength:"3",duration:"0",repeat:"false",sender:"",start:"0",volume:"90",link:"",linkfromdisplay:"false",linktarget:"_self"};
this.options.file=options.src;for(var itm in this.options){if(options[itm]!=undefined){if(itm.indexOf("color")>0){this.options[itm]=options[itm].substr(options[itm].length-6);
}else{this.options[itm]=options[itm];}}}apf.silverlight.createObjectEx({id:this.oVideo.$uniqueId+"_Player",source:this.DEFAULT_PLAYER,parentElement:node,properties:{width:"100%",height:"100%",version:"1.0",inplaceInstallPrompt:true,isWindowless:this.options.windowless,background:"#"+this.options.backgroundcolor},events:{onLoad:this.onLoadHandler,onError:apf.silverlight.default_error_handler},context:this});
apf.layout.setRules(this.oVideo.$ext,this.oVideo.$uniqueId+"_silverlight","apf.all["+this.oVideo.$uniqueId+"].player.resizePlayer()");
apf.layout.queue(this.oVideo.$ext);};apf.video.TypeSilverlight.isSupported=function(){return apf.silverlight.isAvailable("1.0");
};apf.video.TypeSilverlight.INITED=false;apf.video.TypeSilverlight.prototype={load:function(videoPath){this.video.Source=this.options.file;
this.oVideo.$readyHook({type:"ready"});if(this.options.usemute=="true"){this.setVolume(0);
}else{this.setVolume(this.options.volume);}if(this.options.autostart=="true"){this.play();
}else{this.pause();}return this;},play:function(){if(this.state=="buffering"||this.state=="playing"){if(this.options.duration==0){this.stop();
}else{this.pause();}}else{this.video.Visibility="Visible";this.preview.Visibility="Collapsed";
if(this.state=="closed"){this.video.Source=this.options.file;}else{this.video.play();
}}return this;},pause:function(){if(!this.video){return this;}this.video.pause();
return this;},stop:function(){if(!this.video){return;}this.stopPlayPoll();this.video.Visibility="Collapsed";
this.preview.Visibility="Visible";this.pause().seek(0);this.video.Source="null";
return this;},seek:function(iTo){if(!this.video){return;}this.stopPlayPoll();if(iTo<2){iTo=0;
}else{if(iTo>this.options.duration-4){iTo=this.options.duration-4;}}if(!isNaN(iTo)){try{this.video.Position=this.oVideo.getCounter(iTo,"%H:%M:%S");
}catch(e){}}if(this.state=="buffering"||this.state=="playing"){this.play();}else{this.pause();
}return this;},setVolume:function(iVolume){if(!this.video){return;}this.video.Volume=iVolume/100;
return this;},getTotalTime:function(){if(!this.video){return 0;}return this.options.duration||0;
},spanstring:function(stp){var hrs=Math.floor(stp/3600);var min=Math.floor(stp%3600/60);
var sec=Math.round(stp%60*10)/10;var str=hrs+":"+min+":"+sec;return str;},onLoadHandler:function(pId,_self,sender){_self.options.sender=sender;
_self.video=_self.options.sender.findName("VideoWindow");_self.preview=_self.options.sender.findName("PlaceholderImage");
var str={"true":"UniformToFill","false":"Uniform",fit:"Fill",none:"None"};_self.state=_self.video.CurrentState.toLowerCase();
_self.pollTimer;_self.video.Stretch=str[_self.options.overstretch];_self.preview.Stretch=str[_self.options.overstretch];
_self.display=sender.findName("PlayerDisplay");_self.display.Visibility="Visible";
_self.video.BufferingTime=_self.spanstring(_self.options.bufferlength);_self.video.AutoPlay=true;
_self.video.AddEventListener("CurrentStateChanged",function(){_self.handleState("CurrentStateChanged");
});_self.video.AddEventListener("MediaEnded",function(){_self.handleState("MediaEnded");
});_self.video.AddEventListener("DownloadProgressChanged",function(o){_self.oVideo.$progressHook({bytesLoaded:Math.round(o.downloadProgress*100),totalBytes:100});
});if(_self.options.image!=""){_self.preview.Source=_self.options.image;}_self.resizePlayer();
_self.oVideo.$initHook({state:_self.state});},handleState:function(sEvent){var state=this.video.CurrentState.toLowerCase();
if(sEvent=="MediaEnded"){this.stopPlayPoll();this.oVideo.$changeHook({type:"change",playheadTime:Math.round(this.video.Position.Seconds*1000)});
if(this.options.repeat=="true"){this.seek(0).play();}else{this.state="completed";
this.video.Visibility="Collapsed";this.preview.Visibility="Visible";this.seek(0).pause().oVideo.$completeHook({type:"complete"});
}}else{if(state!=this.state){this.state=state;this.options.duration=Math.round(this.video.NaturalDuration.Seconds*1000);
if(state!="playing"&&state!="buffering"&&state!="opening"){this.oVideo.$stateChangeHook({type:"stateChange",state:"paused"});
this.stopPlayPoll();}else{this.oVideo.$stateChangeHook({type:"stateChange",state:"playing"});
this.startPlayPoll();}}}},startPlayPoll:function(){clearTimeout(this.pollTimer);
var _self=this;this.pollTimer=$setTimeout(function(){if(_self.oVideo&&!_self.oVideo.ready&&_self.video.CanSeek){_self.oVideo.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);
}_self.oVideo.$changeHook({type:"change",playheadTime:Math.round(_self.video.Position.Seconds*1000)});
_self.startPlayPoll();},100);return this;},stopPlayPoll:function(){clearTimeout(this.pollTimer);
return this;},resizePlayer:function(){var oSender=this.options.sender;if(!oSender){return;
}var oContent=this.display.getHost().content;var width=oContent.actualWidth;var height=oContent.actualHeight;
this.stretchElement("PlayerDisplay",width,height).stretchElement("VideoWindow",width,height).stretchElement("PlaceholderImage",width,height).centerElement("BufferIcon",width,height).centerElement("BufferText",width,height);
this.display.findName("OverlayCanvas")["Canvas.Left"]=width-this.display.findName("OverlayCanvas").Width-10;
this.display.Visibility="Visible";return this;},centerElement:function(sName,iWidth,iHeight){var elm=this.options.sender.findName(sName);
elm["Canvas.Left"]=Math.round(iWidth/2-elm.Width/2);elm["Canvas.Top"]=Math.round(iHeight/2-elm.Height/2);
return this;},stretchElement:function(sName,iWidth,iHeight){var elm=this.options.sender.findName(sName);
elm.Width=iWidth;if(iHeight!=undefined){elm.Height=iHeight;}return this;},$destroy:function(){apf.layout.removeRule(this.oVideo.$ext,this.oVideo.$uniqueId+"_silverlight");
this.stopPlayPoll();if(this.player){this.player=this.video=this.preview=null;delete this.player;
delete this.video;delete this.preview;}this.htmlElement.innerHTML="";this.oVideo=this.htmlElement=null;
delete this.oVideo;delete this.htmlElement;}};apf.video.TypeWmpCompat=(function(){var hasWMP=false;
function WMP_getVersion(){var is_WMP64=false,is_WMP7up=false;if(apf.isWin&&apf.isIE){var oMP;
try{oMP=new ActiveXObject("MediaPlayer.MediaPlayer.1");hasWMP=true;is_WMP64=true;
}catch(objError){hasWMP=false;is_WMP64=false;}if(hasWMP){try{oMP=new ActiveXObject("WMPlayer.OCX");
is_WMP7up=true;}catch(objError){is_WMP7up=false;}}}else{for(var i=0,j=navigator.plugins.length;
i<j;i++){if(navigator.plugins[i].name.indexOf("Windows Media Player")!=-1){hasWMP=true;
is_WMP64=true;is_WMP7up=true;oMP={versionInfo:"7.3"};}}}var WMPVer;if(is_WMP7up){WMPVer=oMP.versionInfo;
oMP=null;}else{WMPVer="6.4";}return parseFloat(WMPVer);}function WMP_generateParamTag(name,value){if(!name||!value){return"";
}return'<param name="'+name+'" value="'+value+'" />';}function WMP_generateOBJECTText(id,url,width,height,params){params.URL=url;
params.src=url;params.SendPlayStateChangeEvents="true";params.StretchToFit="true";
var out=['<object id="',id,'" width="',width,'" height="',height,'"             classid="clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6"             type="application/x-oleobject">'];
var emb=['<embed id="',id,'emb" width="',width,'" height="',height,'"'];for(var param in params){if(!param||!params[param]){continue;
}out.push('<param name="',param,'" value="',params[param],'" />');emb.push(" ",param,'="',params[param],'"');
}return out.join("")+emb.join("")+" /></object>";}var bIsAvailable=null;function WMP_isAvailable(){if(bIsAvailable===null){bIsAvailable=WMP_getVersion()>=7&&hasWMP;
}return bIsAvailable;}return{isAvailable:WMP_isAvailable,generateOBJECTText:WMP_generateOBJECTText};
})();apf.video.TypeWmp=function(oVideo,node,options){this.oVideo=oVideo;this.name="WMP_"+this.oVideo.$uniqueId;
this.htmlElement=node;this.player=this.pollTimer=null;this.volume=50;this.videoPath=options.src;
apf.extend(this,apf.video.TypeInterface);this.setOptions(options);var _self=this;
window.setTimeout(function(){_self.oVideo.$initHook({state:1});},1);};apf.video.TypeWmp.isSupported=function(){return apf.video.TypeWmpCompat.isAvailable();
};apf.video.TypeWmp.prototype={load:function(videoPath){this.videoPath=videoPath.splitSafe(",")[this.oVideo.$lastMimeType]||videoPath;
return this.$draw();},play:function(){if(this.player){this.player.controls.play();
}return this;},pause:function(){if(this.player){this.player.controls.pause();}return this;
},stop:function(){if(this.player){this.player.controls.stop();}return this;},seek:function(iTo){if(this.player){this.player.controls.pause();
this.player.controls.currentPosition=iTo/1000;if(!this.oVideo.paused){this.player.controls.play();
}}return this;},fullscreen:function(value){this.player.fullscreen=value?true:false;
},setVolume:function(iVolume){if(this.player){this.player.settings.volume=iVolume;
}return this;},getTotalTime:function(){if(!this.player){return 0;}return Math.round(this.player.controls.currentItem.duration*1000);
},$draw:function(){if(this.player){this.stopPlayPoll();delete this.player;this.player=null;
}var playerId=this.name+"_Player";this.htmlElement.innerHTML=apf.video.TypeWmpCompat.generateOBJECTText(playerId,this.videoPath,"100%","100%",{AutoStart:this.autoPlay.toString(),uiMode:this.showControls?"mini":"none",PlayCount:1});
this.player=this.getElement(playerId);var _self=this;try{this.player[window.addEventListener?"addEventListener":"attachEvent"]("PlayStateChange",function(iState){_self.handleEvent(iState);
});}catch(e){this.player.onplaystatechange=function(iState){_self.handleEvent(iState);
};}return this;},handleEvent:function(iState){switch(iState){case 1:case 8:this.oVideo.$completeHook({type:"complete"});
this.stopPlayPoll();break;case 2:this.oVideo.$stateChangeHook({type:"stateChange",state:"paused"});
this.stopPlayPoll();break;case 3:this.oVideo.$stateChangeHook({type:"stateChange",state:"playing"});
if(!this.oVideo.ready){this.oVideo.setProperty("readyState",apf.Media.HAVE_ENOUGH_DATA);
}this.startPlayPoll();break;case 10:this.oVideo.$stateChangeHook({type:"ready"});
break;case 4:case 5:case 6:case 7:case 9:case 11:break;}return this;},startPlayPoll:function(){clearTimeout(this.pollTimer);
var _self=this;this.pollTimer=$setTimeout(function(){if(!_self.player||!_self.player.controls){return;
}_self.oVideo.$changeHook({type:"change",playheadTime:Math.round(_self.player.controls.currentPosition*1000)});
_self.startPlayPoll();},200);return this;},stopPlayPoll:function(){clearTimeout(this.pollTimer);
return this;},$destroy:function(){this.stopPlayPoll();if(this.player){try{this.player.controls.stop();
}catch(e){}this.player=null;delete this.player;}this.htmlElement.innerHTML="";this.oVideo=this.htmlElement=null;
delete this.oVideo;delete this.htmlElement;}};apf.xmpp_muc=function(){var _self=this,mucVars={created:{}},oXmpp=apf.xmpp,SID="SID",JID="JID",CONN="connected";
this.$mucRoster=new apf.xmpp_roster(this["muc-model"],{muc:true},this.resource);
function doRequest(sBody,fCallback){if(!sBody){return;}if(fCallback){_self.$serverVars.muc_callback=fCallback;
}_self.$doXmlRequest(_self.$restartListener,_self.$isPoll?_self.$createStreamElement(null,sBody):_self.$createBodyElement({rid:_self.$getRID(),sid:_self.$serverVars[SID],xmlns:oXmpp.NS.httpbind},sBody));
}this.$getStatusCode=function(oXml,iStatus){var aStatuses=oXml.getElementsByTagName("status");
for(var i=0,l=aStatuses.length;i<l;i++){if(aStatuses[i]&&parseInt(aStatuses[i].getAttribute("code"))==iStatus){return iStatus;
}}return false;};this.queryRooms=function(){if(!this.$canMuc||!this.connected){return;
}doRequest(this.$createIqBlock({from:this.$serverVars[JID],to:this["muc-host"],type:"get",id:this.$makeUnique("disco")},"<query xmlns='"+oXmpp.NS.disco_items+"'/>"));
};this.$addRoom=function(sJID,sName){return this.$mucRoster.getEntityByJID(sJID.replace(/\/.*$/,""),sName);
};this.$isRoom=function(sJID){var parts=sJID.replace(/\/.*$/,"").split("@");return this.$mucRoster.getEntity(parts[0],parts[1],null,true)?true:false;
};this.$addRoomOccupant=function(sJID){return this.$mucRoster.getEntityByJID(sJID);
};this.queryRoomInfo=function(sRoom){};this.getRoom=function(sRoom,callback){if(!this.$canMuc||!this.connected){return;
}mucVars["room_cb_"+sRoom]=callback;doRequest(this.$createIqBlock({from:this.$serverVars[JID],to:sRoom,type:"get",id:this.$makeUnique("disco")},"<query xmlns='"+oXmpp.NS.disco_items+"'/>"));
};this.$mucSignal=function(iType,sRoom,oData){sRoom=sRoom.replace(/\/.*$/,"");var f="room_cb_"+sRoom,cb=mucVars[f];
delete mucVars[f];switch(iType){case apf.xmpp_muc.ROOM_CREATE:case apf.xmpp_muc.ROOM_EXISTS:if(typeof cb=="function"){cb(true);
}break;case apf.xmpp_muc.ROOM_NOTFOUND:if(typeof cb=="function"){cb(false);}break;
case apf.xmpp_muc.ROOM_JOINED:case apf.xmpp_muc.ROOM_LEFT:var oEnt=this.$mucRoster.getEntityByJID(oData.fullJID,{room:sRoom,roomJID:oData.roomJID,affiliation:oData.affiliation,role:oData.role,status:oData.status});
var oOwner=this.$mucRoster.getRoomOwner(sRoom),oRoster=this.$serverVars.roster;
if(!oOwner||oEnt.nick==oRoster.username||oOwner.nick!=oRoster.username||!oEnt.roomJID||oEnt.role=="none"){return;
}this.dispatchEvent("datastatuschange",{annotator:oEnt.roomJID,session:sRoom.substring(0,sRoom.indexOf("@")),type:"submit",baseline:1,modeldata:1,fields:{}});
break;case oXmpp.NS.datastatus:this.dispatchEvent("datachange",{annotator:sRoom.substr(sRoom.lastIndexOf("/")+1),session:sRoom.split("@")[0],body:oData});
break;}};this.joinRoom=function(sRoom,sPassword,sNick,fCallback){if(!sRoom||!this.$canMuc||!this.connected){return;
}if(!sNick){sNick=this.$serverVars.username;}var parts=sRoom.split("@");this.$mucRoster.registerAccount(parts[0],parts[1],sNick);
doRequest(this.$createPresenceBlock({from:this.$serverVars[JID],to:sRoom+"/"+sNick},"<x xmlns='"+oXmpp.NS.muc+(sPassword?"'><password>"+sPassword+"</x>":"'/>")),fCallback);
};this.leaveRoom=function(sRoom,sMsg,sNick,fCallback){if(!sRoom||!this.$canMuc||!this.connected){return;
}if(!sNick){sNick=this.$serverVars.username;}doRequest(this.$createPresenceBlock({from:this.$serverVars[JID],to:sRoom+"/"+sNick,type:oXmpp.TYPE_UNAVAILABLE},sMsg?"<status>"+sMsg+"</status>":""),fCallback);
};this.leaveAllRooms=function(sMsg,sNick){if(!this.$canMuc||!this.connected){return;
}if(!sNick){sNick=this.$serverVars.username;}var i,l,aRooms=this.$mucRoster.getRooms();
for(i=0,l=aRooms.length;i<l;i++){this.leaveRoom(aRooms[i].bareJID,sMsg,sNick);}};
this.changeNick=function(sRoom,sNewNick,fCallback){if(!sRoom||!this.$canMuc||!this.connected){return;
}if(!sNewNick){sNewNick=this.username;}var parts=sRoom.split("@");this.$mucRoster.registerAccount(parts[0],parts[1],sNewNick);
doRequest(this.$createPresenceBlock({from:this.$serverVars[JID],to:sRoom+"/"+sNewNick}),fCallback);
};this.invite=function(sRoom,sJID,sReason,fCallback){var oUser=this.$serverVars.roster.getEntityByJID(sJID);
if(!oUser){return;}doRequest(createMessageBlock({from:_self.$serverVars[JID],to:sRoom},"<x xmlns='"+oXmpp.NS.muc_user+"'><invite to='"+oUser.bareJID+(sReason?"'><reason>"+sReason+"</reason></invite>":"'/>")+"</x>"),fCallback);
};this.declineInvite=function(sRoom,sJID,sReason,fCallback){var oUser=this.$serverVars.roster.getEntityByJID(sJID);
if(!oUser){return;}doRequest(createMessageBlock({from:_self.$serverVars[JID],to:sRoom},"<x xmlns='"+oXmpp.NS.muc_user+"'><decline to='"+oUser.bareJID+(sReason?"'><reason>"+sReason+"</reason></invite>":"'/>")+"</x>"),fCallback);
};this.moderate=function(action,options){};this.createRoom=function(sRoom,sNick,fCallback){if(!sRoom||!this.$canMuc||!this.connected){return;
}if(!sNick){sNick=this.$serverVars.username;}sRoom=this.$mucRoster.sanitizeJID(sRoom);
var parts=sRoom.split("@"),f="room_cb_"+sRoom;this.$mucRoster.registerAccount(parts[0],parts[1],sNick);
mucVars.created[sRoom]=false;mucVars[f]=function(bSuccess){delete mucVars[f];if(!bSuccess){return(typeof callback=="function"?callback(bSuccess):false);
}mucVars[f]=function(bSuccess){delete mucVars[f];_self.$addRoom(sRoom,sRoom.substr(0,sRoom.indexOf("@")));
mucVars.created[sRoom]=true;if(fCallback){fCallback(bSuccess);}};doRequest(_self.$createIqBlock({from:_self.$serverVars[JID],to:sRoom,type:"set",id:_self.$makeUnique("create")},"<query xmlns='"+oXmpp.NS.muc_owner+"'><x xmlns='"+oXmpp.NS.data+"' type='submit'/></query>"));
};doRequest(this.$createPresenceBlock({from:this.$serverVars[JID],to:sRoom+"/"+sNick},"<x xmlns='"+oXmpp.NS.muc+"'/>"));
};this.joinOrCreateRoom=function(sRoom,sNick,fCallback){if(!sRoom||!this.$canMuc||!this.connected){return;
}if(!sNick){sNick=this.$serverVars.username;}var parts=sRoom.split("@");this.$mucRoster.registerAccount(parts[0],parts[1],sNick);
sRoom=this.$mucRoster.sanitizeJID(sRoom);mucVars.created[sRoom]=false;this.getRoom(sRoom,function(bSuccess){if(bSuccess){_self.joinRoom(sRoom,_self.dispatchEvent("muc-password")||null,sNick,fCallback);
}else{_self.createRoom(sRoom,sNick,function(bSuccess2){if(bSuccess2){_self.joinRoom(sRoom,null,sNick,fCallback);
}});}});};this.setPrivileges=function(sRoom,sTo,sAffiliation,fCallback){var oOwner=this.$mucRoster.getRoomOwner(sRoom),oRoster=this.$serverVars.roster,sType=oOwner.nick==oRoster.username?"owner":"admin",sNS=oOwner.nick==oRoster.username?oXmpp.NS.muc_owner:oXmpp.NS.muc_admin;
doRequest(_self.$createIqBlock({from:_self.$serverVars[JID],to:sRoom,type:"set",id:_self.$makeUnique(sType)},"<query xmlns='"+sNS+"'><item affiliation='"+sAffiliation+"' jid='"+sTo+"'/></query>"),fCallback);
};this.destroyRoom=function(sRoom,sReason){if(!sRoom||!this.$canMuc||!this.connected){return;
}doRequest(this.$createIqBlock({from:this.$serverVars[JID],to:sRoom,type:"set",id:this.$makeUnique("destroy")},"<query xmlns='"+oXmpp.NS.muc_owner+"'><destroy jid='"+sRoom+(sReason?"'><reason>"+sReason+"</reason></destroy>":"'/>")+"</query>"));
};this.startRDB=function(sSession,fCallback){if(!sSession){throw new Error(apf.formatErrorString(0,this,"Initiating RDB session","Invalid model provided."));
}var sRoom=this.$mucRoster.sanitizeJID(sSession+"@"+this["muc-host"]);this.joinOrCreateRoom(sRoom,this.$serverVars.roster.username,function(){if(mucVars.created[sRoom]){fCallback(sRoom.substring(0,sRoom.indexOf("@")));
}});};this.endRDB=function(sSession){if(!sSession){throw new Error(apf.formatErrorString(0,this,"Ending RDB session","Invalid model provided."));
}var oOwner=this.$mucRoster.getRoomOwner(sSession);if(!oOwner||oOwner.nick!=this.$serverVars.roster.username){this.leaveRoom(sSession);
}else{this.destroyRoom(sSession);}};this.syncRDB=function(oData){var _self=this,oRoster=this.$serverVars.roster,oOwner=this.$mucRoster.getRoomOwner(oData.room);
if(!oOwner||oOwner.nick==oRoster.username){return;}$setTimeout(function(){_self.sendMessage({to:oRoster.getEntity(oData.owner).fullJID,x:"<field type='text-single' var='session'><value>"+oData.room.substring(0,oData.room.indexOf("@"))+"</value></field><field type='text-single' var='baseline'><value>get</value></field><field type='text-multi' var='modeldata'><value>"+oData.model+"</value></field>",xtype:"submit",type:oXmpp.MSG_NORMAL});
});};this.sendSyncRDB=function(sTo,sSession,iBaseline,sData){var _self=this;$setTimeout(function(){_self.sendMessage({to:sTo,x:"<field type='text-single' var='session'><value>"+sSession+"</value></field><field type='text-single' var='baseline'><value>"+iBaseline+"</value></field>"+(sData?"<field type='text-multi' var='modeldata'><value><![CDATA["+this.$encodeCDATA[sData]+"]]></value></field>":""),xtype:"result",type:oXmpp.MSG_NORMAL});
});};this.sendRDB=function(sModel,sMsg){var sRoom=this.$mucRoster.sanitizeJID(sModel+"@"+this["muc-host"]);
this.sendMessage({to:sRoom,message:sMsg,thread:"rdb",type:oXmpp.MSG_GROUPCHAT});
};};apf.xmpp_muc.ROOM_CREATE=1;apf.xmpp_muc.ROOM_EXISTS=2;apf.xmpp_muc.ROOM_NOTFOUND=3;
apf.xmpp_muc.ROOM_JOINED=4;apf.xmpp_muc.ROOM_LEFT=5;apf.xmpp_muc.ROOM_RDB=6;apf.xmpp_muc.ACTION_SUBJECT=1;
apf.xmpp_muc.ACTION_KICK=2;apf.xmpp_muc.ACTION_BAN=4;apf.xmpp_muc.ACTION_GRANT=8;
apf.xmpp_muc.ACTION_REVOKE=16;apf.xmpp_roster=function(model,modelContent,res){this.resource=res;
this.username=this.host=this.fullJID="";var bMuc=(modelContent.muc||modelContent.rdb),aEntities=[],aRooms=[],userProps={node:1,host:1,resource:1,bareJID:1,fullJID:1,status:1,affiliation:1,role:1,nick:1};
if(typeof model=="string"){var sModel=model;if(!(model=apf.nameserver.get(sModel))){model=apf.setReference(sModel,apf.nameserver.register("model",sModel,new apf.model()));
if(model===0){model=self[sModel];}else{model.id=model.name=sModel;}}model.load("<xmpp/>");
}this.registerAccount=function(username,host,resource){if(!resource){resource=this.resource;
}else{this.resource=resource;}this.username=username||"";this.host=host||"";this.bareJID=this.username+"@"+this.host;
this.fullJID=this.username+"@"+this.host+(resource?"/"+resource:"");};this.getEntity=function(node,host,resource,bRoom){if(typeof node=="undefined"){return null;
}var aResult=[];if(node.indexOf("@")!=-1){var aTemp=node.split("@");node=aTemp[0];
host=aTemp[1];}host=host||this.host;var n,i,l,oExact,bResource=(resource&&!bRoom),fullJID=node+"@"+host+(resource?"/"+resource:"");
for(i=0,l=aEntities.length;i<l;i++){n=aEntities[i];if(n&&n.node==node&&n.host==host&&(!bResource||n.resource==resource)&&(!bRoom||n.isRoom)){aResult.push(n);
if(n.fullJID==fullJID){oExact=n;}}}if(aResult.length===0){return null;}if(aResult.length>1&&oExact){return oExact;
}return(aResult.length==1)?aResult[0]:aResult;};this.getEntityByJID=function(jid,options){var resource=null,node;
if(!options){options={};}if(jid.indexOf("/")!=-1){resource=jid.substring(jid.indexOf("/")+1)||"";
jid=jid.substring(0,jid.indexOf("/"));}if(jid.indexOf("@")!=-1){node=jid.substring(0,jid.indexOf("@"));
jid=jid.substring(jid.indexOf("@")+1);}var host=jid,oEnt=this.getEntity(node,host,resource),bareJID=node+"@"+host;
if(!resource){apf.console.warn("No resource provided for Jabber entity '"+bareJID+"'. Roster may get corrupted this way!","xmpp");
}else{if(oEnt){if(!apf.isArray(oEnt)){oEnt=[oEnt];}for(var i=0,l=oEnt.length;i<l;
++i){if(!oEnt[i]||oEnt[i].resource){continue;}oEnt=oEnt[i];oEnt.resource=resource;
oEnt.fullJID=bareJID+"/"+resource;break;}}}if(apf.isArray(oEnt)){oEnt=oEnt[0];}if(!oEnt){var bIsRoom=(bMuc&&!resource);
oEnt=this.update({node:node,host:host,resource:resource||null,bareJID:bareJID,fullJID:bareJID+(resource?"/"+resource:""),isRoom:bIsRoom,isRDB:options.isRDB?true:false,room:(bMuc&&resource)?bareJID:null,nick:(bMuc&&resource)?resource:null,roomJID:options.roomJID,subscription:options.subscription||"",affiliation:options.affiliation||null,role:options.role||null,group:options.group||"",status:(bIsRoom||(bMuc&&resource))?apf.xmpp.TYPE_AVAILABLE:apf.xmpp.TYPE_UNAVAILABLE});
}else{this.update(apf.extend(oEnt,options));}return oEnt;};this.update=function(oEnt,status){if(bMuc&&oEnt.room&&oEnt.role=="none"){if(oEnt.xml){apf.xmldb.removeNode(oEnt.xml);
aEntities.remove(oEnt);}return oEnt;}if(!oEnt.xml){var bIsAccount=(oEnt.node==this.username&&oEnt.host==this.host&&(!bMuc||oEnt.resource==this.resource));
aEntities.push(oEnt);if(oEnt.isRoom){aRooms.push(oEnt);}if(model&&(modelContent.roster||bMuc)){oEnt.xml=model.data.ownerDocument.createElement(bIsAccount?"account":oEnt.isRoom?"room":"user");
this.updateEntityXml(oEnt);var oRoom,room=oEnt.roomJID?oEnt.roomJID.split("@"):null,node=(oEnt.room&&!oEnt.isRoom&&oEnt.isRDB)?room[0]:oEnt.node,host=(oEnt.room&&!oEnt.isRoom&&oEnt.isRDB)?room[1]:oEnt.host;
apf.xmldb.appendChild((oEnt.room&&!oEnt.isRoom)?(oRoom=this.getEntity(node,host,null,true))?oRoom.xml:model.data:model.data,oEnt.xml);
}}if(typeof status!="undefined"){oEnt.status=status;}return this.updateEntityXml(oEnt);
};this.updateEntityXml=function(oEnt){if(!oEnt||!oEnt.xml){return null;}for(var i in userProps){if(typeof oEnt[i]!="undefined"&&oEnt[i]!==null){oEnt.xml.setAttribute(i,oEnt[i]);
}}apf.xmldb.applyChanges("synchronize",oEnt.xml);return oEnt;};this.updateMessageHistory=function(sJID,sMsg,sThread){if(sThread=="rdb"){return true;
}if(!model||!(modelContent.chat||bMuc)){return false;}var oEnt,oRoom;if(bMuc){oRoom=this.getEntityByJID(sJID.replace(/\/.*$/,""));
}oEnt=this.getEntityByJID(sJID);if(!oEnt||!oEnt.xml){return false;}var oDoc=model.data.ownerDocument,oMsg=oDoc.createElement("message");
oMsg.setAttribute("from",sJID);oMsg.appendChild(oDoc.createTextNode(sMsg));apf.xmldb.appendChild((oRoom?oRoom.xml:oEnt.xml),oMsg);
apf.xmldb.applyChanges("synchronize",oEnt.xml);return !(oEnt.node==this.username&&oEnt.host==this.host);
};this.getLastAvailableEntity=function(){for(var i=aEntities.length-1;i>=0;i--){if(aEntities[i].status!==apf.xmpp.TYPE_UNAVAILABLE){return aEntities[i];
}}return null;};this.getRooms=function(){return aRooms;};this.getRoomParticipants=function(sRoom){var o,res=[],i=0,l=aEntities.length;
for(;i<l;i++){if((o=aEntities[i]).room==sRoom){res.push(o);}}return res;};this.getRoomOwner=function(sRoom){var o,i=0,l=aEntities.length;
for(;i<l;i++){if((o=aEntities[i]).room==sRoom&&o.affiliation=="owner"){return o;
}}return null;};this.getAllEntities=function(iStatus,bIncSelf){if(typeof iStatus!="string"){return aEntities;
}var o=[],i=0,l=aEntities.length;for(;i<l;i++){if(!bIncSelf&&aEntities[i].bareJID==this.bareJID){continue;
}if(aEntities[i].status==iStatus){o.push(aEntities[i]);}}return o;};this.rebuild=function(mc){if(mc){modelContent=mc;
bMuc=(modelContent.muc||modelContent.rdb);}if(!model||!(modelContent.roster||bMuc)){return;
}model.load("<xmpp/>");var i=0,l=aEntities.length;for(;i<l;i++){delete aEntities[i].xml;
this.updateEntityXml(aEntities[i]);}};this.reset=function(){if(model){model.reset();
}aEntities=[];aRooms=[];this.username=this.host=this.fullJID="";};this.sanitizeJID=function(sJID){return sJID.replace(/[\"\s\&\\\:<>]+/g,"").replace(/\//g,"_").toLowerCase();
};};apf.LiveMarkupPi=function(){this.$init();};(function(){this.mainBind="data";
this.implement(apf.StandardBinding);this.getDocument=function(){return this.$data&&this.$data.ownerDocument;
};this.clear=function(msg){if(msg=="loading"&&apf.getInheritedAttribute(this,"loading-message")){this.$propHandlers.calcdata.call(this,"<span class='loading'>Loading...</span>");
this.calcdata="";}};this.$propHandlers.calcdata=function(data){if(this.$skipChange){return;
}if(this.$data){if(this.$useXmlDiff){var newXml=apf.getXml("<a:application xmlns:a='"+apf.ns.apf+"'>"+apf.xmlentities(data)+"</a:application>",null,this.ownerDocument.$domParser.preserveWhiteSpace);
var oldXml=this.$data;apf.xmlDiff(oldXml,newXml);return;}var nodes=this.$data.childNodes;
for(var i=nodes.length-1;i>=0;i--){nodes[i].destroy(true);}}if(typeof data=="string"&&data.indexOf("<a:")>-1){this.$ext.innerHTML="";
var doc=this.ownerDocument.$domParser.parseFromString("<a:application xmlns:a='"+apf.ns.apf+"'>"+data+"</a:application>","text/xml",{htmlNode:this.$ext,host:this});
this.$data=doc.documentElement;}else{if(this.$data){var nodes=this.$data.childNodes;
for(var i=0;i<nodes.length;i++){nodes[i].destroy(true);}}if(this.$ext){this.$ext.innerHTML=data||"";
}}};}).call(apf.LiveMarkupPi.prototype=new apf.AmlProcessingInstruction(true));
apf.aml.setProcessingInstruction("lm",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("lm-debug",apf.LiveMarkupPi);
apf.aml.setProcessingInstruction("livemarkup",apf.LiveMarkupPi);if(document.all){var oldWinError=window.onerror,z;
window.onerror=z=function(m){apf.console.error("Error caught from early startup. Might be a html parser syntax error (not your fault). "+m);
if(!arguments.caller){return true;}};}apf.Init.addConditional(function(){if(document.all&&window.onerror==z){window.onerror=oldWinError;
}apf.dispatchEvent("domready");},null,["body","class"]);apf.addDomLoadEvent(function(){apf.Init.run("body");
});if(window.require&&typeof require.def=="function"){require(["apf/elements/codeeditor","apf/elements/debugger","apf/elements/debughost"],function(){apf.start();
});}else{apf.start();}
